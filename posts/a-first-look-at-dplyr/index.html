<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="A look at the R package dplyr.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>A First Look at dplyr | Bowling For Data</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://necromuralist.github.io/Bowling-For-Data/posts/a-first-look-at-dplyr/index.html">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="The Cloistered Monkey">
<link rel="prev" href="../r-for-data-science/index.html" title="R For Data Science" type="text/html">
<link rel="next" href="../decrease-and-conquer/index.html" title="Decrease And Conquer" type="text/html">
<meta property="og:site_name" content="Bowling For Data">
<meta property="og:title" content="A First Look at dplyr">
<meta property="og:url" content="https://necromuralist.github.io/Bowling-For-Data/posts/a-first-look-at-dplyr/index.html">
<meta property="og:description" content="A look at the R package dplyr.">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2021-12-16T16:59:04-08:00">
<meta property="article:tag" content="data transformation">
<meta property="article:tag" content="dplyr">
<meta property="article:tag" content="r">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-light
bg-light
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href="../../">

            <span id="blog-title">Bowling For Data</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../pages/" class="nav-link">Pages</a>
                </li>
<li class="nav-item">
<a href="../../archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="../../categories/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="../../rss.xml" class="nav-link">RSS feed</a>
            </li>
<li class="nav-item dropdown">
<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Monkey Pages</a>
            <div class="dropdown-menu">
                    <a href="https://necromuralist.github.io/" class="dropdown-item">The Cloistered Monkey</a>
                    <a href="https://necromuralist.github.io/Ape-Iron/" class="dropdown-item">Ape Iron</a>
                    <a href="https://necromuralist.github.io/Beach-Pig-Thigh/" class="dropdown-item">Beach-Pig Rump &amp; Thigh</a>
                    <a href="https://necromuralist.github.io/Neurotic-Networking/" class="dropdown-item">Neurotic Networking</a>
                    <a href="https://necromuralist.github.io/Terribilis-Ludum/" class="dropdown-item">Terribilis Ludum</a>
                    <a href="https://necromuralist.github.io/Visions-Voices-Data/" class="dropdown-item">Visions, Voices, Data</a>
            </div>

                
            </li>
</ul>
<!-- DuckDuckGo custom search --><form method="get" id="search" action="https://duckduckgo.com/" class="navbar-form pull-left">
 <input type="hidden" name="sites" value="https://necromuralist.github.io/Bowling-For-Data/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="Search…" class="span2" style="margin-top: 4px;"><input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
</form>
 <!-- End of custom search -->
 

            <ul class="navbar-nav navbar-right">
<li class="nav-item">
    <a href="index.org" id="sourcelink" class="nav-link">Source</a>
    </li>


                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">A First Look at dplyr</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="#" rel="bookmark">
            <time class="published dt-published" datetime="2021-12-16T16:59:04-08:00" itemprop="datePublished" title="2021-12-16 16:59">2021-12-16 16:59</time></a>
            </p>
            
        <p class="sourceline"><a href="index.org" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li>
<a href="index.html#org088c0b2">In the Beginning</a>
<ul>
<li><a href="index.html#orgcc21234">Imports</a></li>
</ul>
</li>
<li><a href="index.html#orge00ba2b">The Data</a></li>
<li>
<a href="index.html#org3fccdcd">Filter</a>
<ul>
<li><a href="index.html#org55ea5db">The Basic Filter</a></li>
<li><a href="index.html#orge67d4e5">Or, Not And</a></li>
<li><a href="index.html#org7223c0d">And and Or</a></li>
</ul>
</li>
<li>
<a href="index.html#orge9a41a2">Arrange</a>
<ul>
<li><a href="index.html#org43dcfa5">Ascending Order</a></li>
<li><a href="index.html#org306fe46">Descending Order</a></li>
</ul>
</li>
<li>
<a href="index.html#org936c95b">Select</a>
<ul>
<li><a href="index.html#org5ce9eea">Grab Some Columns</a></li>
<li><a href="index.html#orgfaf3ea1">A Range of Columns</a></li>
<li><a href="index.html#org9a40f5d">Helper Functions</a></li>
</ul>
</li>
<li>
<a href="index.html#orgc54c441">Renaming</a>
<ul>
<li>
<ul>
<li><a href="index.html#org26b9419">Some More Useful Renaming</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="index.html#org5778ed3">Mutate</a>
<ul>
<li><a href="index.html#org2f9e7c0">Transmute</a></li>
</ul>
</li>
<li>
<a href="index.html#orge64b82c">Summarize</a>
<ul>
<li><a href="index.html#orgfd2c380">Grouping</a></li>
<li><a href="index.html#org0a2c67e">Hitting the Pipe</a></li>
</ul>
</li>
<li><a href="index.html#org7bd5924">Link Collection</a></li>
</ul>
</div>
</div>
<div id="outline-container-org088c0b2" class="outline-2">
<h2 id="org088c0b2">In the Beginning</h2>
<div class="outline-text-2" id="text-org088c0b2">
<p>
This is a look at <a href="https://dplyr.tidyverse.org/">dplyr</a> based on Chapter Three of <a href="../r-for-data-science/">R For Data Science</a>. It focuses on what the book identifies as the six key <code>dplyr</code> functions.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Function</th>
<th scope="col" class="org-left">What It Does</th>
<th scope="col" class="org-left">By Another Name</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left"><code>filter</code></td>
<td class="org-left">Pick out rows based on their values.</td>
<td class="org-left">Boolean Slice</td>
</tr>
<tr>
<td class="org-left"><code>arrange</code></td>
<td class="org-left">Re-order the rows.</td>
<td class="org-left">Sort</td>
</tr>
<tr>
<td class="org-left"><code>select</code></td>
<td class="org-left">Pick out variables by their names.</td>
<td class="org-left">Column subset</td>
</tr>
<tr>
<td class="org-left"><code>mutate</code></td>
<td class="org-left">Create new variables using existing ones.</td>
<td class="org-left">Feature Engineering</td>
</tr>
<tr>
<td class="org-left"><code>summarize</code></td>
<td class="org-left">Summarize many values as a single value.</td>
<td class="org-left">Statistic</td>
</tr>
<tr>
<td class="org-left"><code>group_by</code></td>
<td class="org-left">Changes scope of other functions to operate on group.</td>
<td class="org-left"> </td>
</tr>
</tbody>
</table>
</div>

<div id="outline-container-orgcc21234" class="outline-3">
<h3 id="orgcc21234">Imports</h3>
<div class="outline-text-3" id="text-orgcc21234">
<div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">ascii</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">assertthat</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">knitr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">nycflights13</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
</pre></div>

<p>
<b><b>Note:</b></b> The stuff in the tidyverse tends to clobber built-in functions, which can make it hard to understand sometimes when things go wrong. If you forget to load <code>dplyer</code>, for instance, there's already a <code>filter</code> function, but it doesn't do the same thing as the one you load with <code>dplyr</code> so you'll get weird error messages if you try to use it. Notably I was getting this message:
</p>

<div class="highlight"><pre><span></span><span class="n">Error</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">airlines</span><span class="p">,</span><span class="w"> </span><span class="n">carrier</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"US"</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="s">'carrier'</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">found</span>
</pre></div>

<p>
Anyway, now some options for the packages.
</p>

<div class="highlight"><pre><span></span><span class="nf">options</span><span class="p">(</span><span class="n">asciiType</span><span class="o">=</span><span class="s">"org"</span><span class="p">)</span>
<span class="nf">theme_set</span><span class="p">(</span><span class="nf">theme_minimal</span><span class="p">(</span><span class="n">base_family</span><span class="o">=</span><span class="s">"Palatino"</span><span class="p">))</span>
</pre></div>

<p>
And a couple of helpers to print (the <code>tibble</code> objects dump weird characters into the org-mode output).
</p>

<div class="highlight"><pre><span></span><span class="n">khead</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">#' Prints a table of the first lines of the dataframe</span>
<span class="w">  </span><span class="c1">#'</span>
<span class="w">  </span><span class="c1">#' @param data The data to print</span>
<span class="w">  </span><span class="n">table</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">kable</span><span class="p">(</span><span class="nf">head</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="w">  </span><span class="n">table</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">gsub</span><span class="p">(</span><span class="s">":"</span><span class="p">,</span><span class="w"> </span><span class="s">"-"</span><span class="p">,</span><span class="w"> </span><span class="n">table</span><span class="p">[</span><span class="m">2</span><span class="p">])</span>
<span class="w">  </span><span class="n">table</span>
<span class="p">}</span>

<span class="n">okable</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">#' Prints data as an org-mode table</span>
<span class="w">  </span><span class="c1">#'</span>
<span class="w">  </span><span class="c1">#' @param data The data to print</span>
<span class="w">  </span><span class="n">table</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">kable</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="w">  </span><span class="n">table</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">gsub</span><span class="p">(</span><span class="s">":"</span><span class="p">,</span><span class="w"> </span><span class="s">"-"</span><span class="p">,</span><span class="w"> </span><span class="n">table</span><span class="p">[</span><span class="m">2</span><span class="p">])</span>
<span class="w">  </span><span class="n">table</span>
<span class="p">}</span>

<span class="n">got_all_your_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">#' Checks if there's any missing values</span>
<span class="w">  </span><span class="c1">#'</span>
<span class="w">  </span><span class="c1">#' @param data The vector of data to check</span>
<span class="w">  </span><span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-orge00ba2b" class="outline-2">
<h2 id="orge00ba2b">The Data</h2>
<div class="outline-text-2" id="text-orge00ba2b">
<p>
We're going to look at the <code>flights</code> dataframe loaded by the <a href="https://www.rdocumentation.org/packages/nycflights13/versions/1.0.1"><code>nycflights13</code></a> package (which, curiously, R loads using the <code>library</code> function).
</p>

<div class="highlight"><pre><span></span><span class="nf">str</span><span class="p">(</span><span class="n">flights</span><span class="p">)</span>
</pre></div>

<pre class="example" id="org75908c5">
tibble [336,776 × 19] (S3: tbl_df/tbl/data.frame)
 $ year          : int [1:336776] 2013 2013 2013 2013 2013 2013 2013 2013 2013 2013 ...
 $ month         : int [1:336776] 1 1 1 1 1 1 1 1 1 1 ...
 $ day           : int [1:336776] 1 1 1 1 1 1 1 1 1 1 ...
 $ dep_time      : int [1:336776] 517 533 542 544 554 554 555 557 557 558 ...
 $ sched_dep_time: int [1:336776] 515 529 540 545 600 558 600 600 600 600 ...
 $ dep_delay     : num [1:336776] 2 4 2 -1 -6 -4 -5 -3 -3 -2 ...
 $ arr_time      : int [1:336776] 830 850 923 1004 812 740 913 709 838 753 ...
 $ sched_arr_time: int [1:336776] 819 830 850 1022 837 728 854 723 846 745 ...
 $ arr_delay     : num [1:336776] 11 20 33 -18 -25 12 19 -14 -8 8 ...
 $ carrier       : chr [1:336776] "UA" "UA" "AA" "B6" ...
 $ flight        : int [1:336776] 1545 1714 1141 725 461 1696 507 5708 79 301 ...
 $ tailnum       : chr [1:336776] "N14228" "N24211" "N619AA" "N804JB" ...
 $ origin        : chr [1:336776] "EWR" "LGA" "JFK" "JFK" ...
 $ dest          : chr [1:336776] "IAH" "IAH" "MIA" "BQN" ...
 $ air_time      : num [1:336776] 227 227 160 183 116 150 158 53 140 138 ...
 $ distance      : num [1:336776] 1400 1416 1089 1576 762 ...
 $ hour          : num [1:336776] 5 5 5 5 6 5 6 6 6 6 ...
 $ minute        : num [1:336776] 15 29 40 45 0 58 0 0 0 0 ...
 $ time_hour     : POSIXct[1:336776], format: "2013-01-01 05:00:00" "2013-01-01 05:00:00" ...
</pre>

<p>
The dataset lists all the flights that left New York City airports in 2013 heading to destinations in the United States, Puerto Rico, and the American Virgin Islands.
</p>
</div>
</div>

<div id="outline-container-org3fccdcd" class="outline-2">
<h2 id="org3fccdcd">Filter</h2>
<div class="outline-text-2" id="text-org3fccdcd">
</div>
<div id="outline-container-org55ea5db" class="outline-3">
<h3 id="org55ea5db">The Basic Filter</h3>
<div class="outline-text-3" id="text-org55ea5db">
<p>
<code>filter</code> takes the dataframe as the first argument and every argument after that has to be a boolean expression based on the dataframe. If you pass in more than one condition <code>dplyr</code> will and them. Let's see the flights on Christmas.
</p>

<div class="highlight"><pre><span></span><span class="n">christmas</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="n">month</span><span class="o">==</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">day</span><span class="o">==</span><span class="m">25</span><span class="p">)</span>
<span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">christmas</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_bar</span><span class="p">(</span>
<span class="w">    </span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">carrier</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Christmas Flights"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="s">"Origin"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">"Count"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"christmas_flights_counts.png"</span><span class="p">)</span>
</pre></div>

<p>
<img src="christmas_flights_counts.png" alt="nil"></p>
</div>
</div>

<div id="outline-container-orge67d4e5" class="outline-3">
<h3 id="orge67d4e5">Or, Not And</h3>
<div class="outline-text-3" id="text-orge67d4e5">
<p>
   Since the default is for the <code>filter</code> to and everything together, if you want to use something else (like <code>OR</code>) you need to create a single argument built with the OR operator (<code>|</code>). If you're using a single column for the OR, there's actually a (possibly) easier way that works like python's <code>in</code> where you check if the value is in a collection. Let's see the flights on Christmas and on Christmas Eve
.
</p>

<div class="highlight"><pre><span></span><span class="n">both_days</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="n">month</span><span class="o">==</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">day</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">24</span><span class="p">,</span><span class="w"> </span><span class="m">25</span><span class="p">))</span>

<span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">both_days</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_bar</span><span class="p">(</span>
<span class="w">    </span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">day</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">origin</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Christmas Eve and Day Flights"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="s">"Day"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">"Count"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"christmas_day_and_eve.png"</span><span class="p">)</span>
</pre></div>

<p>
<img src="christmas_day_and_eve.png" alt="nil"></p>
</div>
</div>

<div id="outline-container-org7223c0d" class="outline-3">
<h3 id="org7223c0d">And and Or</h3>
<div class="outline-text-3" id="text-org7223c0d">
<p>
What if we want New-Years Day and Christmas? In this case we need to keep the month with the day so we can't just use the <code>in</code> operator, but we can use the AND and OR operators to make it work.
</p>

<div class="highlight"><pre><span></span><span class="n">and_new_years</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">month</span><span class="o">==</span><span class="m">12</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">day</span><span class="o">==</span><span class="m">25</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">month</span><span class="o">==</span><span class="m">1</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">day</span><span class="o">==</span><span class="m">1</span><span class="p">))</span>

<span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">and_new_years</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_bar</span><span class="p">(</span>
<span class="w">    </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">day</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">origin</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Christmas and New Years Day"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="s">"Date"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">"Count"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"christmas_new_years.png"</span><span class="p">)</span>
</pre></div>

<p>
<img src="christmas_new_years.png" alt="nil"></p>

<div class="highlight"><pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">and_new_years</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_boxplot</span><span class="p">(</span>
<span class="w">    </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">dep_delay</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">origin</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Christmas and New Years Day Delays"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="s">"Departure Airport"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">"Delay (Minutes)"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"christmas_new_years_delay.png"</span><span class="p">)</span>
</pre></div>

<p>
<img src="christmas_new_years_delay.png" alt="nil"></p>
</div>
</div>
</div>

<div id="outline-container-orge9a41a2" class="outline-2">
<h2 id="orge9a41a2">Arrange</h2>
<div class="outline-text-2" id="text-orge9a41a2">
<p>
<code>arrange</code> is a function to sort the rows. By default it sorts then in non-decreasing (ascending) order using a column you give it. You can givie it multiple columns in which case whenever there's a tie it will look in the next column you gave it to see if it can break it (the tie, I mean).
</p>
</div>

<div id="outline-container-org43dcfa5" class="outline-3">
<h3 id="org43dcfa5">Ascending Order</h3>
<div class="outline-text-3" id="text-org43dcfa5">
<p>
What are the shortest flights?
</p>

<div class="highlight"><pre><span></span><span class="nf">khead</span><span class="p">(</span><span class="nf">arrange</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="n">distance</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-right">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">year</th>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">day</th>
<th scope="col" class="org-right">dep_time</th>
<th scope="col" class="org-right">sched_dep_time</th>
<th scope="col" class="org-right">dep_delay</th>
<th scope="col" class="org-right">arr_time</th>
<th scope="col" class="org-right">sched_arr_time</th>
<th scope="col" class="org-right">arr_delay</th>
<th scope="col" class="org-left">carrier</th>
<th scope="col" class="org-right">flight</th>
<th scope="col" class="org-left">tailnum</th>
<th scope="col" class="org-left">origin</th>
<th scope="col" class="org-left">destination</th>
<th scope="col" class="org-right">air_time</th>
<th scope="col" class="org-right">distance</th>
<th scope="col" class="org-right">hour</th>
<th scope="col" class="org-right">minute</th>
<th scope="col" class="org-left">time_hour</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">2013</td>
<td class="org-right">7</td>
<td class="org-right">27</td>
<td class="org-right">NA</td>
<td class="org-right">106</td>
<td class="org-right">NA</td>
<td class="org-right">NA</td>
<td class="org-right">245</td>
<td class="org-right">NA</td>
<td class="org-left">US</td>
<td class="org-right">1632</td>
<td class="org-left">NA</td>
<td class="org-left">EWR</td>
<td class="org-left">LGA</td>
<td class="org-right">NA</td>
<td class="org-right">17</td>
<td class="org-right">1</td>
<td class="org-right">6</td>
<td class="org-left">2013-07-27 01:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">3</td>
<td class="org-right">2127</td>
<td class="org-right">2129</td>
<td class="org-right">-2</td>
<td class="org-right">2222</td>
<td class="org-right">2224</td>
<td class="org-right">-2</td>
<td class="org-left">EV</td>
<td class="org-right">3833</td>
<td class="org-left">N13989</td>
<td class="org-left">EWR</td>
<td class="org-left">PHL</td>
<td class="org-right">30</td>
<td class="org-right">80</td>
<td class="org-right">21</td>
<td class="org-right">29</td>
<td class="org-left">2013-01-03 21:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">4</td>
<td class="org-right">1240</td>
<td class="org-right">1200</td>
<td class="org-right">40</td>
<td class="org-right">1333</td>
<td class="org-right">1306</td>
<td class="org-right">27</td>
<td class="org-left">EV</td>
<td class="org-right">4193</td>
<td class="org-left">N14972</td>
<td class="org-left">EWR</td>
<td class="org-left">PHL</td>
<td class="org-right">30</td>
<td class="org-right">80</td>
<td class="org-right">12</td>
<td class="org-right">0</td>
<td class="org-left">2013-01-04 12:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">4</td>
<td class="org-right">1829</td>
<td class="org-right">1615</td>
<td class="org-right">134</td>
<td class="org-right">1937</td>
<td class="org-right">1721</td>
<td class="org-right">136</td>
<td class="org-left">EV</td>
<td class="org-right">4502</td>
<td class="org-left">N15983</td>
<td class="org-left">EWR</td>
<td class="org-left">PHL</td>
<td class="org-right">28</td>
<td class="org-right">80</td>
<td class="org-right">16</td>
<td class="org-right">15</td>
<td class="org-left">2013-01-04 16:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">4</td>
<td class="org-right">2128</td>
<td class="org-right">2129</td>
<td class="org-right">-1</td>
<td class="org-right">2218</td>
<td class="org-right">2224</td>
<td class="org-right">-6</td>
<td class="org-left">EV</td>
<td class="org-right">4645</td>
<td class="org-left">N27962</td>
<td class="org-left">EWR</td>
<td class="org-left">PHL</td>
<td class="org-right">32</td>
<td class="org-right">80</td>
<td class="org-right">21</td>
<td class="org-right">29</td>
<td class="org-left">2013-01-04 21:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">5</td>
<td class="org-right">1155</td>
<td class="org-right">1200</td>
<td class="org-right">-5</td>
<td class="org-right">1241</td>
<td class="org-right">1306</td>
<td class="org-right">-25</td>
<td class="org-left">EV</td>
<td class="org-right">4193</td>
<td class="org-left">N14902</td>
<td class="org-left">EWR</td>
<td class="org-left">PHL</td>
<td class="org-right">29</td>
<td class="org-right">80</td>
<td class="org-right">12</td>
<td class="org-right">0</td>
<td class="org-left">2013-01-05 12:00:00</td>
</tr>
</tbody>
</table>
<p>
The data uses the three-letter airport codes, but there's another dataframe loaded with <code>ggplot2</code> named <code>airports</code> that we can use to translate them to airport names.
</p>

<div class="highlight"><pre><span></span><span class="nf">okable</span><span class="p">(</span><span class="nf">filter</span><span class="p">(</span><span class="n">airports</span><span class="p">,</span><span class="w"> </span><span class="n">faa</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">"PHL"</span><span class="p">,</span><span class="w"> </span><span class="s">"LGA"</span><span class="p">,</span><span class="w"> </span><span class="s">"EWR"</span><span class="p">)))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">faa</th>
<th scope="col" class="org-left">name</th>
<th scope="col" class="org-right">lat</th>
<th scope="col" class="org-right">lon</th>
<th scope="col" class="org-right">alt</th>
<th scope="col" class="org-right">tz</th>
<th scope="col" class="org-left">dst</th>
<th scope="col" class="org-left">tzone</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">EWR</td>
<td class="org-left">Newark Liberty Intl</td>
<td class="org-right">40.69250</td>
<td class="org-right">-74.16867</td>
<td class="org-right">18</td>
<td class="org-right">-5</td>
<td class="org-left">A</td>
<td class="org-left">America/New_York</td>
</tr>
<tr>
<td class="org-left">LGA</td>
<td class="org-left">La Guardia</td>
<td class="org-right">40.77725</td>
<td class="org-right">-73.87261</td>
<td class="org-right">22</td>
<td class="org-right">-5</td>
<td class="org-left">A</td>
<td class="org-left">America/New_York</td>
</tr>
<tr>
<td class="org-left">PHL</td>
<td class="org-left">Philadelphia Intl</td>
<td class="org-right">39.87194</td>
<td class="org-right">-75.24114</td>
<td class="org-right">36</td>
<td class="org-right">-5</td>
<td class="org-left">A</td>
<td class="org-left">America/New_York</td>
</tr>
</tbody>
</table>
<p>
So the shortest flights are from Newark Liberty International to La Guardia airport and the Philadelphia International Airport. I wonder why someone would take a plane to go 17 miles? I guess the traffic must be really bad, or some people just have money (and jet fuel) to burn.
</p>
</div>
</div>

<div id="outline-container-org306fe46" class="outline-3">
<h3 id="org306fe46">Descending Order</h3>
<div class="outline-text-3" id="text-org306fe46">
<p>
To get the data to sort in descending order you have to pass in another function call (<code>desc</code>). Weird.
</p>

<p>
What are the longest flights?
</p>

<div class="highlight"><pre><span></span><span class="nf">khead</span><span class="p">(</span><span class="nf">arrange</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="nf">desc</span><span class="p">(</span><span class="n">distance</span><span class="p">)))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-right">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">year</th>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">day</th>
<th scope="col" class="org-right">dep_time</th>
<th scope="col" class="org-right">sched_dep_time</th>
<th scope="col" class="org-right">dep_delay</th>
<th scope="col" class="org-right">arr_time</th>
<th scope="col" class="org-right">sched_arr_time</th>
<th scope="col" class="org-right">arr_delay</th>
<th scope="col" class="org-left">carrier</th>
<th scope="col" class="org-right">flight</th>
<th scope="col" class="org-left">tailnum</th>
<th scope="col" class="org-left">origin</th>
<th scope="col" class="org-left">destination</th>
<th scope="col" class="org-right">air_time</th>
<th scope="col" class="org-right">distance</th>
<th scope="col" class="org-right">hour</th>
<th scope="col" class="org-right">minute</th>
<th scope="col" class="org-left">time_hour</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">857</td>
<td class="org-right">900</td>
<td class="org-right">-3</td>
<td class="org-right">1516</td>
<td class="org-right">1530</td>
<td class="org-right">-14</td>
<td class="org-left">HA</td>
<td class="org-right">51</td>
<td class="org-left">N380HA</td>
<td class="org-left">JFK</td>
<td class="org-left">HNL</td>
<td class="org-right">659</td>
<td class="org-right">4983</td>
<td class="org-right">9</td>
<td class="org-right">0</td>
<td class="org-left">2013-01-01 09:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">2</td>
<td class="org-right">909</td>
<td class="org-right">900</td>
<td class="org-right">9</td>
<td class="org-right">1525</td>
<td class="org-right">1530</td>
<td class="org-right">-5</td>
<td class="org-left">HA</td>
<td class="org-right">51</td>
<td class="org-left">N380HA</td>
<td class="org-left">JFK</td>
<td class="org-left">HNL</td>
<td class="org-right">638</td>
<td class="org-right">4983</td>
<td class="org-right">9</td>
<td class="org-right">0</td>
<td class="org-left">2013-01-02 09:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">3</td>
<td class="org-right">914</td>
<td class="org-right">900</td>
<td class="org-right">14</td>
<td class="org-right">1504</td>
<td class="org-right">1530</td>
<td class="org-right">-26</td>
<td class="org-left">HA</td>
<td class="org-right">51</td>
<td class="org-left">N380HA</td>
<td class="org-left">JFK</td>
<td class="org-left">HNL</td>
<td class="org-right">616</td>
<td class="org-right">4983</td>
<td class="org-right">9</td>
<td class="org-right">0</td>
<td class="org-left">2013-01-03 09:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">4</td>
<td class="org-right">900</td>
<td class="org-right">900</td>
<td class="org-right">0</td>
<td class="org-right">1516</td>
<td class="org-right">1530</td>
<td class="org-right">-14</td>
<td class="org-left">HA</td>
<td class="org-right">51</td>
<td class="org-left">N384HA</td>
<td class="org-left">JFK</td>
<td class="org-left">HNL</td>
<td class="org-right">639</td>
<td class="org-right">4983</td>
<td class="org-right">9</td>
<td class="org-right">0</td>
<td class="org-left">2013-01-04 09:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">5</td>
<td class="org-right">858</td>
<td class="org-right">900</td>
<td class="org-right">-2</td>
<td class="org-right">1519</td>
<td class="org-right">1530</td>
<td class="org-right">-11</td>
<td class="org-left">HA</td>
<td class="org-right">51</td>
<td class="org-left">N381HA</td>
<td class="org-left">JFK</td>
<td class="org-left">HNL</td>
<td class="org-right">635</td>
<td class="org-right">4983</td>
<td class="org-right">9</td>
<td class="org-right">0</td>
<td class="org-left">2013-01-05 09:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">6</td>
<td class="org-right">1019</td>
<td class="org-right">900</td>
<td class="org-right">79</td>
<td class="org-right">1558</td>
<td class="org-right">1530</td>
<td class="org-right">28</td>
<td class="org-left">HA</td>
<td class="org-right">51</td>
<td class="org-left">N385HA</td>
<td class="org-left">JFK</td>
<td class="org-left">HNL</td>
<td class="org-right">611</td>
<td class="org-right">4983</td>
<td class="org-right">9</td>
<td class="org-right">0</td>
<td class="org-left">2013-01-06 09:00:00</td>
</tr>
</tbody>
</table>
<p>
You can probably guess the airports from the codes, but we'll look them up anyway.
</p>

<div class="highlight"><pre><span></span><span class="nf">okable</span><span class="p">(</span><span class="nf">filter</span><span class="p">(</span><span class="n">airports</span><span class="p">,</span><span class="w"> </span><span class="n">faa</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">"JFK"</span><span class="p">,</span><span class="w"> </span><span class="s">"HNL"</span><span class="p">)))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">faa</th>
<th scope="col" class="org-left">name</th>
<th scope="col" class="org-right">lat</th>
<th scope="col" class="org-right">lon</th>
<th scope="col" class="org-right">alt</th>
<th scope="col" class="org-right">tz</th>
<th scope="col" class="org-left">dst</th>
<th scope="col" class="org-left">tzone</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">HNL</td>
<td class="org-left">Honolulu Intl</td>
<td class="org-right">21.31868</td>
<td class="org-right">-157.92243</td>
<td class="org-right">13</td>
<td class="org-right">-10</td>
<td class="org-left">N</td>
<td class="org-left">Pacific/Honolulu</td>
</tr>
<tr>
<td class="org-left">JFK</td>
<td class="org-left">John F Kennedy Intl</td>
<td class="org-right">40.63975</td>
<td class="org-right">-73.77893</td>
<td class="org-right">13</td>
<td class="org-right">-5</td>
<td class="org-left">A</td>
<td class="org-left">America/New_York</td>
</tr>
</tbody>
</table>
<p>
And the longest flights are from John F. Kennedy International airport to Honolulu International airport.
</p>
</div>
</div>
</div>

<div id="outline-container-org936c95b" class="outline-2">
<h2 id="org936c95b">Select</h2>
<div class="outline-text-2" id="text-org936c95b">
<p>
<code>select</code> helps with getting subsets of columns. At first glance this seems like something that should be easy to do without needing a separate function, but it adds more ways to grab the columns than just passing in the names.
</p>
</div>

<div id="outline-container-org5ce9eea" class="outline-3">
<h3 id="org5ce9eea">Grab Some Columns</h3>
<div class="outline-text-3" id="text-org5ce9eea">
<p>
The basic way to get a subset of columns is to pass them in as arguments.
</p>

<div class="highlight"><pre><span></span><span class="nf">khead</span><span class="p">(</span><span class="nf">select</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="n">flight</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">flight</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">1545</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">1714</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">1141</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">725</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">461</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">1696</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgfaf3ea1" class="outline-3">
<h3 id="orgfaf3ea1">A Range of Columns</h3>
<div class="outline-text-3" id="text-orgfaf3ea1">
<p>
If you want to grab a section of contiguous columns you can pass in the first and last ones separated by a colon (the `:` character, not the vital organ).
</p>

<div class="highlight"><pre><span></span><span class="nf">khead</span><span class="p">(</span><span class="nf">select</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="n">dep_time</span><span class="o">:</span><span class="n">arr_time</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">dep_time</th>
<th scope="col" class="org-right">sched_dep_time</th>
<th scope="col" class="org-right">dep_delay</th>
<th scope="col" class="org-right">arr_time</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">517</td>
<td class="org-right">515</td>
<td class="org-right">2</td>
<td class="org-right">830</td>
</tr>
<tr>
<td class="org-right">533</td>
<td class="org-right">529</td>
<td class="org-right">4</td>
<td class="org-right">850</td>
</tr>
<tr>
<td class="org-right">542</td>
<td class="org-right">540</td>
<td class="org-right">2</td>
<td class="org-right">923</td>
</tr>
<tr>
<td class="org-right">544</td>
<td class="org-right">545</td>
<td class="org-right">-1</td>
<td class="org-right">1004</td>
</tr>
<tr>
<td class="org-right">554</td>
<td class="org-right">600</td>
<td class="org-right">-6</td>
<td class="org-right">812</td>
</tr>
<tr>
<td class="org-right">554</td>
<td class="org-right">558</td>
<td class="org-right">-4</td>
<td class="org-right">740</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org9a40f5d" class="outline-3">
<h3 id="org9a40f5d">Helper Functions</h3>
<div class="outline-text-3" id="text-org9a40f5d">
<p>
Like <code>arrange</code> <code>select</code> uses functions passed in to alter the behavior. Most of them are string-methods-ish.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Function</th>
<th scope="col" class="org-left">What it does</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left"><code>starts_with("&lt;prefix&gt;")</code></td>
<td class="org-left">Pick columns by a prefix.</td>
</tr>
<tr>
<td class="org-left"><code>ends_with("&lt;suffix&gt;")</code></td>
<td class="org-left">Pick columns with a suffix.</td>
</tr>
<tr>
<td class="org-left"><code>contains("&lt;sub-string&gt;")</code></td>
<td class="org-left">Pick columns with a sub-string of the name.</td>
</tr>
<tr>
<td class="org-left"><code>matches("&lt;regular-expression&gt;")</code></td>
<td class="org-left">Pick out stuff using a regular expression.</td>
</tr>
<tr>
<td class="org-left"><code>num_range("&lt;prefix&gt;", &lt;number range&gt;)</code></td>
<td class="org-left">Grab columns with the prefix followed by each of the numbers</td>
</tr>
<tr>
<td class="org-left"><code>last_col()</code></td>
<td class="org-left">Get the last column (negative index).</td>
</tr>
<tr>
<td class="org-left"><code>all_of(&lt;vector&gt;)</code></td>
<td class="org-left">Grab the columns in the vector.</td>
</tr>
<tr>
<td class="org-left"><code>any_of(&lt;vector&gt;)</code></td>
<td class="org-left">Same as <code>all_of</code> but ignores non-existent columns in the vector</td>
</tr>
<tr>
<td class="org-left"><code>where(&lt;function&gt;)</code></td>
<td class="org-left">Applies the function to the columns and picks the ones that return true</td>
</tr>
</tbody>
</table>
<p>
You can also use logical AND and OR operators or a vector to combine the selections, but we'll just do a basic one-function call. Let's grab all the columns with an underscore in their name.
</p>

<div class="highlight"><pre><span></span><span class="nf">khead</span><span class="p">(</span><span class="nf">select</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="nf">contains</span><span class="p">(</span><span class="s">"_"</span><span class="p">)))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">dep_time</th>
<th scope="col" class="org-right">sched_dep_time</th>
<th scope="col" class="org-right">dep_delay</th>
<th scope="col" class="org-right">arr_time</th>
<th scope="col" class="org-right">sched_arr_time</th>
<th scope="col" class="org-right">arr_delay</th>
<th scope="col" class="org-right">air_time</th>
<th scope="col" class="org-left">time_hour</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">517</td>
<td class="org-right">515</td>
<td class="org-right">2</td>
<td class="org-right">830</td>
<td class="org-right">819</td>
<td class="org-right">11</td>
<td class="org-right">227</td>
<td class="org-left">2013-01-01 05:00:00</td>
</tr>
<tr>
<td class="org-right">533</td>
<td class="org-right">529</td>
<td class="org-right">4</td>
<td class="org-right">850</td>
<td class="org-right">830</td>
<td class="org-right">20</td>
<td class="org-right">227</td>
<td class="org-left">2013-01-01 05:00:00</td>
</tr>
<tr>
<td class="org-right">542</td>
<td class="org-right">540</td>
<td class="org-right">2</td>
<td class="org-right">923</td>
<td class="org-right">850</td>
<td class="org-right">33</td>
<td class="org-right">160</td>
<td class="org-left">2013-01-01 05:00:00</td>
</tr>
<tr>
<td class="org-right">544</td>
<td class="org-right">545</td>
<td class="org-right">-1</td>
<td class="org-right">1004</td>
<td class="org-right">1022</td>
<td class="org-right">-18</td>
<td class="org-right">183</td>
<td class="org-left">2013-01-01 05:00:00</td>
</tr>
<tr>
<td class="org-right">554</td>
<td class="org-right">600</td>
<td class="org-right">-6</td>
<td class="org-right">812</td>
<td class="org-right">837</td>
<td class="org-right">-25</td>
<td class="org-right">116</td>
<td class="org-left">2013-01-01 06:00:00</td>
</tr>
<tr>
<td class="org-right">554</td>
<td class="org-right">558</td>
<td class="org-right">-4</td>
<td class="org-right">740</td>
<td class="org-right">728</td>
<td class="org-right">12</td>
<td class="org-right">150</td>
<td class="org-left">2013-01-01 05:00:00</td>
</tr>
</tbody>
</table>
<p>
You can also negate the selections using an exclamation point (<code>!</code>), so we can grab all the columns that don't have an underscore in their name like this.
</p>

<div class="highlight"><pre><span></span><span class="nf">khead</span><span class="p">(</span><span class="nf">select</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="o">!</span><span class="nf">contains</span><span class="p">(</span><span class="s">"_"</span><span class="p">)))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-right">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">year</th>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">day</th>
<th scope="col" class="org-left">carrier</th>
<th scope="col" class="org-right">flight</th>
<th scope="col" class="org-left">tailnum</th>
<th scope="col" class="org-left">origin</th>
<th scope="col" class="org-left">dest</th>
<th scope="col" class="org-right">distance</th>
<th scope="col" class="org-right">hour</th>
<th scope="col" class="org-right">minute</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-left">UA</td>
<td class="org-right">1545</td>
<td class="org-left">N14228</td>
<td class="org-left">EWR</td>
<td class="org-left">IAH</td>
<td class="org-right">1400</td>
<td class="org-right">5</td>
<td class="org-right">15</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-left">UA</td>
<td class="org-right">1714</td>
<td class="org-left">N24211</td>
<td class="org-left">LGA</td>
<td class="org-left">IAH</td>
<td class="org-right">1416</td>
<td class="org-right">5</td>
<td class="org-right">29</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-left">AA</td>
<td class="org-right">1141</td>
<td class="org-left">N619AA</td>
<td class="org-left">JFK</td>
<td class="org-left">MIA</td>
<td class="org-right">1089</td>
<td class="org-right">5</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-left">B6</td>
<td class="org-right">725</td>
<td class="org-left">N804JB</td>
<td class="org-left">JFK</td>
<td class="org-left">BQN</td>
<td class="org-right">1576</td>
<td class="org-right">5</td>
<td class="org-right">45</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-left">DL</td>
<td class="org-right">461</td>
<td class="org-left">N668DN</td>
<td class="org-left">LGA</td>
<td class="org-left">ATL</td>
<td class="org-right">762</td>
<td class="org-right">6</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-left">UA</td>
<td class="org-right">1696</td>
<td class="org-left">N39463</td>
<td class="org-left">EWR</td>
<td class="org-left">ORD</td>
<td class="org-right">719</td>
<td class="org-right">5</td>
<td class="org-right">58</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-orgc54c441" class="outline-2">
<h2 id="orgc54c441">Renaming</h2>
<div class="outline-text-2" id="text-orgc54c441">
<p>
The book mentions renaming under the <code>select</code> section because it says that it is a special case of selection, but it has a dedicated function to do that named <code>rename</code> that you should use instead. Let's rename the first column (<code>year</code>).
</p>

<div class="highlight"><pre><span></span><span class="nf">khead</span><span class="p">(</span><span class="nf">rename</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="n">Jahr</span><span class="o">=</span><span class="n">year</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-right">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">Jahr</th>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">day</th>
<th scope="col" class="org-right">dep_time</th>
<th scope="col" class="org-right">sched_dep_time</th>
<th scope="col" class="org-right">dep_delay</th>
<th scope="col" class="org-right">arr_time</th>
<th scope="col" class="org-right">sched_arr_time</th>
<th scope="col" class="org-right">arr_delay</th>
<th scope="col" class="org-left">carrier</th>
<th scope="col" class="org-right">flight</th>
<th scope="col" class="org-left">tailnum</th>
<th scope="col" class="org-left">origin</th>
<th scope="col" class="org-left">dest</th>
<th scope="col" class="org-right">air_time</th>
<th scope="col" class="org-right">distance</th>
<th scope="col" class="org-right">hour</th>
<th scope="col" class="org-right">minute</th>
<th scope="col" class="org-left">time_hour</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">517</td>
<td class="org-right">515</td>
<td class="org-right">2</td>
<td class="org-right">830</td>
<td class="org-right">819</td>
<td class="org-right">11</td>
<td class="org-left">UA</td>
<td class="org-right">1545</td>
<td class="org-left">N14228</td>
<td class="org-left">EWR</td>
<td class="org-left">IAH</td>
<td class="org-right">227</td>
<td class="org-right">1400</td>
<td class="org-right">5</td>
<td class="org-right">15</td>
<td class="org-left">2013-01-01 05:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">533</td>
<td class="org-right">529</td>
<td class="org-right">4</td>
<td class="org-right">850</td>
<td class="org-right">830</td>
<td class="org-right">20</td>
<td class="org-left">UA</td>
<td class="org-right">1714</td>
<td class="org-left">N24211</td>
<td class="org-left">LGA</td>
<td class="org-left">IAH</td>
<td class="org-right">227</td>
<td class="org-right">1416</td>
<td class="org-right">5</td>
<td class="org-right">29</td>
<td class="org-left">2013-01-01 05:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">542</td>
<td class="org-right">540</td>
<td class="org-right">2</td>
<td class="org-right">923</td>
<td class="org-right">850</td>
<td class="org-right">33</td>
<td class="org-left">AA</td>
<td class="org-right">1141</td>
<td class="org-left">N619AA</td>
<td class="org-left">JFK</td>
<td class="org-left">MIA</td>
<td class="org-right">160</td>
<td class="org-right">1089</td>
<td class="org-right">5</td>
<td class="org-right">40</td>
<td class="org-left">2013-01-01 05:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">544</td>
<td class="org-right">545</td>
<td class="org-right">-1</td>
<td class="org-right">1004</td>
<td class="org-right">1022</td>
<td class="org-right">-18</td>
<td class="org-left">B6</td>
<td class="org-right">725</td>
<td class="org-left">N804JB</td>
<td class="org-left">JFK</td>
<td class="org-left">BQN</td>
<td class="org-right">183</td>
<td class="org-right">1576</td>
<td class="org-right">5</td>
<td class="org-right">45</td>
<td class="org-left">2013-01-01 05:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">554</td>
<td class="org-right">600</td>
<td class="org-right">-6</td>
<td class="org-right">812</td>
<td class="org-right">837</td>
<td class="org-right">-25</td>
<td class="org-left">DL</td>
<td class="org-right">461</td>
<td class="org-left">N668DN</td>
<td class="org-left">LGA</td>
<td class="org-left">ATL</td>
<td class="org-right">116</td>
<td class="org-right">762</td>
<td class="org-right">6</td>
<td class="org-right">0</td>
<td class="org-left">2013-01-01 06:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">554</td>
<td class="org-right">558</td>
<td class="org-right">-4</td>
<td class="org-right">740</td>
<td class="org-right">728</td>
<td class="org-right">12</td>
<td class="org-left">UA</td>
<td class="org-right">1696</td>
<td class="org-left">N39463</td>
<td class="org-left">EWR</td>
<td class="org-left">ORD</td>
<td class="org-right">150</td>
<td class="org-right">719</td>
<td class="org-right">5</td>
<td class="org-right">58</td>
<td class="org-left">2013-01-01 05:00:00</td>
</tr>
</tbody>
</table>
<p>
<b><b>Note:</b></b> Pay attention to the funky syntax - the new name comes first and the original name comes after the equal sign.
</p>
</div>

<div id="outline-container-org26b9419" class="outline-4">
<h4 id="org26b9419">Some More Useful Renaming</h4>
<div class="outline-text-4" id="text-org26b9419">
<p>
That wasn't really helpful, so how about we rename some other columns?
</p>

<div class="highlight"><pre><span></span><span class="n">flights</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rename</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="n">destination</span><span class="o">=</span><span class="n">dest</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div id="outline-container-org5778ed3" class="outline-2">
<h2 id="org5778ed3">Mutate</h2>
<div class="outline-text-2" id="text-org5778ed3">
<p>
The <code>mutate</code> function adds a column (or columns) to the end of the dataframe based on things you tell it to do to one or more other columns. 
</p>

<p>
First, we'll grabs a subset of columns to make this easier to see.
</p>

<div class="highlight"><pre><span></span><span class="n">subset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="nf">ends_with</span><span class="p">(</span><span class="s">"delay"</span><span class="p">),</span><span class="w"> </span><span class="n">air_time</span><span class="p">,</span><span class="w"> </span><span class="n">distance</span><span class="p">)</span>
<span class="nf">khead</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">dep_delay</th>
<th scope="col" class="org-right">arr_delay</th>
<th scope="col" class="org-right">air_time</th>
<th scope="col" class="org-right">distance</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">2</td>
<td class="org-right">11</td>
<td class="org-right">227</td>
<td class="org-right">1400</td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-right">20</td>
<td class="org-right">227</td>
<td class="org-right">1416</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-right">33</td>
<td class="org-right">160</td>
<td class="org-right">1089</td>
</tr>
<tr>
<td class="org-right">-1</td>
<td class="org-right">-18</td>
<td class="org-right">183</td>
<td class="org-right">1576</td>
</tr>
<tr>
<td class="org-right">-6</td>
<td class="org-right">-25</td>
<td class="org-right">116</td>
<td class="org-right">762</td>
</tr>
<tr>
<td class="org-right">-4</td>
<td class="org-right">12</td>
<td class="org-right">150</td>
<td class="org-right">719</td>
</tr>
</tbody>
</table>
<p>
Now to add a couple of columns giving the difference between how late they arrived and how late they left and the average speed.
</p>

<div class="highlight"><pre><span></span><span class="nf">khead</span><span class="p">(</span><span class="nf">mutate</span><span class="p">(</span><span class="n">subset</span><span class="p">,</span>
<span class="w">	     </span><span class="n">Time_Made_Up</span><span class="o">=</span><span class="n">dep_delay</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">arr_delay</span><span class="p">,</span>
<span class="w">	     </span><span class="n">Miles_Per_Minute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">distance</span><span class="o">/</span><span class="n">air_time</span>
<span class="w">	     </span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">dep_delay</th>
<th scope="col" class="org-right">arr_delay</th>
<th scope="col" class="org-right">air_time</th>
<th scope="col" class="org-right">distance</th>
<th scope="col" class="org-right">Time_Made_Up</th>
<th scope="col" class="org-right">Miles_Per_Minute</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">2</td>
<td class="org-right">11</td>
<td class="org-right">227</td>
<td class="org-right">1400</td>
<td class="org-right">-9</td>
<td class="org-right">6.167401</td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-right">20</td>
<td class="org-right">227</td>
<td class="org-right">1416</td>
<td class="org-right">-16</td>
<td class="org-right">6.237885</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-right">33</td>
<td class="org-right">160</td>
<td class="org-right">1089</td>
<td class="org-right">-31</td>
<td class="org-right">6.806250</td>
</tr>
<tr>
<td class="org-right">-1</td>
<td class="org-right">-18</td>
<td class="org-right">183</td>
<td class="org-right">1576</td>
<td class="org-right">17</td>
<td class="org-right">8.612022</td>
</tr>
<tr>
<td class="org-right">-6</td>
<td class="org-right">-25</td>
<td class="org-right">116</td>
<td class="org-right">762</td>
<td class="org-right">19</td>
<td class="org-right">6.568966</td>
</tr>
<tr>
<td class="org-right">-4</td>
<td class="org-right">12</td>
<td class="org-right">150</td>
<td class="org-right">719</td>
<td class="org-right">-16</td>
<td class="org-right">4.793333</td>
</tr>
</tbody>
</table>
</div>

<div id="outline-container-org2f9e7c0" class="outline-3">
<h3 id="org2f9e7c0">Transmute</h3>
<div class="outline-text-3" id="text-org2f9e7c0">
<p>
This is like the <code>mutate</code> function but it only keeps the new columns you created, not the original columns.
</p>

<div class="highlight"><pre><span></span><span class="nf">khead</span><span class="p">(</span><span class="nf">transmute</span><span class="p">(</span><span class="n">subset</span><span class="p">,</span>
<span class="w">       </span><span class="n">Time_Made_Up</span><span class="o">=</span><span class="n">dep_delay</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">arr_delay</span><span class="p">,</span>
<span class="w">       </span><span class="n">Miles_Per_Hour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">distance</span><span class="o">/</span><span class="p">(</span><span class="n">air_time</span><span class="o">/</span><span class="m">60</span><span class="p">)</span>
<span class="w">       </span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">Time_Made_Up</th>
<th scope="col" class="org-right">Miles_Per_Hour</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">-9</td>
<td class="org-right">370.0441</td>
</tr>
<tr>
<td class="org-right">-16</td>
<td class="org-right">374.2731</td>
</tr>
<tr>
<td class="org-right">-31</td>
<td class="org-right">408.3750</td>
</tr>
<tr>
<td class="org-right">17</td>
<td class="org-right">516.7213</td>
</tr>
<tr>
<td class="org-right">19</td>
<td class="org-right">394.1379</td>
</tr>
<tr>
<td class="org-right">-16</td>
<td class="org-right">287.6000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-orge64b82c" class="outline-2">
<h2 id="orge64b82c">Summarize</h2>
<div class="outline-text-2" id="text-orge64b82c">
<p>
<code>summarize</code> reduces a collection of numbers to a single summary statistic. As an example we can look at the median departure delay. First, let's check if it has any missing values.
</p>

<div class="highlight"><pre><span></span><span class="nf">got_all_your_data</span><span class="p">(</span><span class="n">flights</span><span class="o">$</span><span class="n">dep_delay</span><span class="p">)</span>
</pre></div>

<pre class="example">
[1] FALSE
attr(,"msg")
[1] "data contains 8255 missing values"
</pre>


<p>
Okay, so we'll just tell <code>median</code> to ignore it.
</p>

<div class="highlight"><pre><span></span><span class="nf">okable</span><span class="p">(</span><span class="nf">summarize</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="n">median_departure_delay</span><span class="o">=</span><span class="nf">median</span><span class="p">(</span><span class="n">dep_delay</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="org-right"></colgroup>
<thead><tr>
<th scope="col" class="org-right">median_departure_delay</th>
</tr></thead>
<tbody><tr>
<td class="org-right">-2</td>
</tr></tbody>
</table>
<p>
What if we hadn't ignored the missing?
</p>

<div class="highlight"><pre><span></span><span class="nf">okable</span><span class="p">(</span><span class="nf">summarize</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="n">median_departure_delay</span><span class="o">=</span><span class="nf">median</span><span class="p">(</span><span class="n">dep_delay</span><span class="p">)))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="org-left"></colgroup>
<thead><tr>
<th scope="col" class="org-left">median_departure_delay</th>
</tr></thead>
<tbody><tr>
<td class="org-left">NA</td>
</tr></tbody>
</table>
<p>
The R summary functions like <code>median</code> and <code>mean</code> consider any missing data invalid unless you tell it to ignore the missing. How is this use of <code>summarize</code> different from just calling <code>median</code>?
</p>

<div class="highlight"><pre><span></span><span class="nf">median</span><span class="p">(</span><span class="n">flights</span><span class="o">$</span><span class="n">dep_delay</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
</pre></div>

<pre class="example">
[1] -2
</pre>


<p>
Well, it doesn't look quite as nice. So, you might think, well, all we did was add a columns name, was that useful?
</p>
</div>

<div id="outline-container-orgfd2c380" class="outline-3">
<h3 id="orgfd2c380">Grouping</h3>
<div class="outline-text-3" id="text-orgfd2c380">
<p>
The reason for <code>summarize</code> is that it works in tandem with groups. Instead of finding the median for the whole column, we can find the median by group.
</p>

<div class="highlight"><pre><span></span><span class="n">by_month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">group_by</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="n">month</span><span class="p">)</span>

<span class="nf">okable</span><span class="p">(</span><span class="nf">summarize</span><span class="p">(</span><span class="n">by_month</span><span class="p">,</span><span class="w"> </span><span class="n">median_monthly_delay</span><span class="o">=</span><span class="nf">median</span><span class="p">(</span><span class="n">dep_delay</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">median_monthly_delay</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">-2</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-right">-2</td>
</tr>
<tr>
<td class="org-right">3</td>
<td class="org-right">-1</td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-right">-2</td>
</tr>
<tr>
<td class="org-right">5</td>
<td class="org-right">-1</td>
</tr>
<tr>
<td class="org-right">6</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">7</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">8</td>
<td class="org-right">-1</td>
</tr>
<tr>
<td class="org-right">9</td>
<td class="org-right">-3</td>
</tr>
<tr>
<td class="org-right">10</td>
<td class="org-right">-3</td>
</tr>
<tr>
<td class="org-right">11</td>
<td class="org-right">-3</td>
</tr>
<tr>
<td class="org-right">12</td>
<td class="org-right">0</td>
</tr>
</tbody>
</table>
<p>
Is that right? Let's look at a boxplot of the dataset and check.
</p>

<div class="highlight"><pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">by_month</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_boxplot</span><span class="p">(</span>
<span class="w">    </span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">dep_delay</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="nf">factor</span><span class="p">(</span><span class="n">month</span><span class="p">)),</span><span class="w"> </span>
<span class="w">    </span><span class="n">outlier.shape</span><span class="o">=</span><span class="kc">NA</span><span class="p">,</span>
<span class="w">    </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">limits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">quantile</span><span class="p">(</span><span class="n">by_month</span><span class="o">$</span><span class="n">dep_delay</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0.9</span><span class="p">),</span>
<span class="w">				       </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Monthly Delays"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="s">"Month"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">"Delay (Minutes)"</span><span class="p">)</span>


<span class="nf">ggsave</span><span class="p">(</span><span class="s">"monthly_delay_boxplot.png"</span><span class="p">)</span>
</pre></div>

<p>
<img src="monthly_delay_boxplot.png" alt="nil"></p>

<p>
So, that isn't so exciting, but it does show that the median values tend to be negative (meaning they left early) like our summary said.
</p>
</div>
</div>

<div id="outline-container-org0a2c67e" class="outline-3">
<h3 id="org0a2c67e">Hitting the Pipe</h3>
<div class="outline-text-3" id="text-org0a2c67e">
<p>
<code>dplyr</code> adds an operator called the "pipe" (<code>%&gt;%</code>) that works like a unix pipe does, sending the output of one function to another, allowing you to save some keystrokes adding temporary variables or nesting function calls.
</p>

<p>
So, here's what we're going to do. 
</p>

<ul class="org-ul">
<li>We're going to pass the <code>flights</code> dataset to the <code>group_by</code> function and group the data by destination</li>
<li>Then we're going to pass that output to the <code>summarize</code> function and summarize by:
<ul class="org-ul">
<li>the counts</li>
<li>mean distance of the flight</li>
<li>and the mean arrival delay of each group</li>
</ul>
</li>
<li>Then we're going to pass the summarized data to <code>filter</code> to get the top 20 that didn't go to Honolulu.</li>
</ul>
<p>
First let's do a check for missing values.
</p>

<div class="highlight"><pre><span></span><span class="nf">got_all_your_data</span><span class="p">(</span><span class="n">flights</span><span class="o">$</span><span class="n">arr_delay</span><span class="p">)</span>
<span class="nf">got_all_your_data</span><span class="p">(</span><span class="n">flights</span><span class="o">$</span><span class="n">distance</span><span class="p">)</span>
</pre></div>

<pre class="example">
[1] FALSE
attr(,"msg")
[1] "data contains 9430 missing values"
[1] TRUE
</pre>


<p>
There's no missing distances but there are missing arrival delays.
</p>

<div class="highlight"><pre><span></span><span class="n">delays_vs_distance</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">flights</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">summarize</span><span class="p">(</span>
<span class="w">    </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">n</span><span class="p">(),</span>
<span class="w">    </span><span class="n">distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span>
<span class="w">    </span><span class="n">delay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">arr_delay</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">destination</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">"HNL"</span><span class="p">)</span>

<span class="nf">khead</span><span class="p">(</span><span class="n">delays_vs_distance</span><span class="p">)</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">destination</th>
<th scope="col" class="org-right">count</th>
<th scope="col" class="org-right">distance</th>
<th scope="col" class="org-right">delay</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">ABQ</td>
<td class="org-right">254</td>
<td class="org-right">1826.0000</td>
<td class="org-right">4.381890</td>
</tr>
<tr>
<td class="org-left">ACK</td>
<td class="org-right">265</td>
<td class="org-right">199.0000</td>
<td class="org-right">4.852273</td>
</tr>
<tr>
<td class="org-left">ALB</td>
<td class="org-right">439</td>
<td class="org-right">143.0000</td>
<td class="org-right">14.397129</td>
</tr>
<tr>
<td class="org-left">ATL</td>
<td class="org-right">17215</td>
<td class="org-right">757.1082</td>
<td class="org-right">11.300113</td>
</tr>
<tr>
<td class="org-left">AUS</td>
<td class="org-right">2439</td>
<td class="org-right">1514.2530</td>
<td class="org-right">6.019909</td>
</tr>
<tr>
<td class="org-left">AVL</td>
<td class="org-right">275</td>
<td class="org-right">583.5818</td>
<td class="org-right">8.003831</td>
</tr>
</tbody>
</table>
<p>
Note that we're using the mean here, not the median, so there's going to be more variation because of all the outliers. Also, because there are some missing values we had to tell the <code>mean</code> function to ignore them - otherwise the default is to return <code>NA</code> if any values are missing. There weren't any missing <code>distance</code> rows, but passing that argument in doesn't do any harm, I don't think. Now let's plot it.
</p>

<div class="highlight"><pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">delays_vs_distance</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">distance</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">delay</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">count</span><span class="p">),</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">0.4</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_smooth</span><span class="p">(</span><span class="n">se</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Distance Traveled vs Arrival Delay"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="s">"Distance (Miles)"</span><span class="p">,</span>
<span class="w">       </span><span class="n">y</span><span class="o">=</span><span class="s">"Delay (Minutes)"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"distance_vs_delay.png"</span><span class="p">)</span>
</pre></div>

<p>
<img src="distance_vs_delay.png" alt="nil"></p>

<p>
It looks like up to a point the further you travel the worse the delay, and then it starts going in the opposite direction, with longer flights having shorter delays in their arrival times.
</p>
</div>
</div>
</div>
<div id="outline-container-org7bd5924" class="outline-2">
<h2 id="org7bd5924">Link Collection</h2>
<div class="outline-text-2" id="text-org7bd5924">
<ul class="org-ul">
<li>
<a href="https://cran.r-project.org/web/packages/ascii/index.html">ascii</a>: The R package to help change R-output to work better with org-mode.</li>
<li>
<a href="https://github.com/hadley/assertthat">assertthat</a>: R assertions.</li>
<li>
<a href="https://www.bts.gov/">Bureau of Transportation Statistics</a>: This is where the <code>flights</code> dataset originally comes from.</li>
<li>
<a href="https://dplyr.tidyverse.org/">dplyr</a>: the tidyverse page for this package</li>
<li>
<a href="https://bookdown.org/yihui/rmarkdown-cookbook/kable.html">rmarkdown-cookbook</a>: This page is about <code>knitr's</code> <code>kable</code> command.</li>
<li>
<a href="https://www.rdocumentation.org/packages/nycflights13/versions/1.0.1"><code>nycflights13</code></a>: A description of the datasets in this package.</li>
</ul>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/data-transformation/index.html" rel="tag">data transformation</a></li>
            <li><a class="tag p-category" href="../../categories/dplyr/index.html" rel="tag">dplyr</a></li>
            <li><a class="tag p-category" href="../../categories/r/index.html" rel="tag">r</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../r-for-data-science/index.html" rel="prev" title="R For Data Science">Previous post</a>
            </li>
            <li class="next">
                <a href="../decrease-and-conquer/index.html" rel="next" title="Decrease And Conquer">Next post</a>
            </li>
        </ul></nav></aside></article><!--End of body content--><footer id="footer">
            Scribbles by <a href="mailto:cloisteredmonkey.jmark@slmail.me">The Cloistered Monkey</a> © 2023 - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
<div id="license" xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/">
<span property="dct:title">Ape-Iron</span> is licensed under
<a href="http://creativecommons.org/licenses/by-sa/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY-SA 4.0
<img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"><img src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1"></a> 

            
            
        
    </div>
</footer>
</div>


        <script src="../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</div>
</body>
</html>
