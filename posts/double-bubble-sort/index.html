<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Another look at Bubble Sort.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Bubble-Sort Revisited | Bowling For Data</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://necromuralist.github.io/Bowling-For-Data/posts/double-bubble-sort/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="The Cloistered Monkey">
<link rel="prev" href="../bubble-sort-an-empirical-look/" title="Bubble Sort: An Empirical Look" type="text/html">
<link rel="next" href="../selection-sort/" title="Selection Sort" type="text/html">
<meta property="og:site_name" content="Bowling For Data">
<meta property="og:title" content="Bubble-Sort Revisited">
<meta property="og:url" content="https://necromuralist.github.io/Bowling-For-Data/posts/double-bubble-sort/">
<meta property="og:description" content="Another look at Bubble Sort.">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2021-11-19T17:14:43-08:00">
<meta property="article:tag" content="algorithms">
<meta property="article:tag" content="brute-force">
<meta property="article:tag" content="sorting">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-light
bg-light
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href="../../">

            <span id="blog-title">Bowling For Data</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../pages/" class="nav-link">Pages</a>
                </li>
<li class="nav-item">
<a href="../../archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="../../categories/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="../../rss.xml" class="nav-link">RSS feed</a>

                
            </li>
</ul>
<!-- DuckDuckGo custom search --><form method="get" id="search" action="https://duckduckgo.com/" class="navbar-form pull-left">
 <input type="hidden" name="sites" value="https://necromuralist.github.io/Bowling-For-Data/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="Searchâ€¦" class="span2" style="margin-top: 4px;"><input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
</form>
 <!-- End of custom search -->
 

            <ul class="navbar-nav navbar-right">
<li class="nav-item">
    <a href="index.org" id="sourcelink" class="nav-link">Source</a>
    </li>


                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Bubble-Sort Revisited</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2021-11-19T17:14:43-08:00" itemprop="datePublished" title="2021-11-19 17:14">2021-11-19 17:14</time></a>
            </p>
            
        <p class="sourceline"><a href="index.org" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li>
<a href="#org8247f95">In the Beginning</a>
<ul>
<li>
<a href="#org79f0780">Some Setup</a>
<ul>
<li><a href="#org154467b">Imports</a></li>
<li><a href="#orge15fb2c">Stuff For Later</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#orgf8b4fba">The Sorters</a>
<ul>
<li>
<a href="#org8a0a5c2">Bubba Sort</a>
<ul>
<li><a href="#orgcc87480">Bubba</a></li>
<li><a href="#org1cfc61a">Bubble</a></li>
<li><a href="#orgd2fb889">Test It Out</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#org92e58aa">Counting Comparisons</a>
<ul>
<li><a href="#org66a9c87">Set Up Numba</a></li>
<li><a href="#org37d9c94">Run The Bubble Counter</a></li>
<li><a href="#org18439a7">Run the Bubba Counter</a></li>
<li><a href="#org1b7a66c">Best Case, Worst Case</a></li>
</ul>
</li>
<li><a href="#org28c342a">The End, The End</a></li>
</ul>
</div>
</div>
<p>
This is a continuation of a <a href="../the-bubble-sort/">series on the Bubble Sort</a>.
</p>

<div id="outline-container-org8247f95" class="outline-2">
<h2 id="org8247f95">In the Beginning</h2>
<div class="outline-text-2" id="text-org8247f95">
<p>
In the <a href="../bubble-sort-an-empirical-look/">previous bubble sort post</a> I implemented the basic bubble sort, but there is a variation of it where you short-circuit the search if the collection is already sorted which is what I'll look at here. The short-circuiting means that the bubble sort can sometimes do better than other methods, but only when the data is mostly sorted so it's still not a practical algorithm.
Why do this, then? Eh,  why not?
</p>
</div>

<div id="outline-container-org79f0780" class="outline-3">
<h3 id="org79f0780">Some Setup</h3>
<div class="outline-text-3" id="text-org79f0780">
</div>
<div id="outline-container-org154467b" class="outline-4">
<h4 id="org154467b">Imports</h4>
<div class="outline-text-4" id="text-org154467b">
<div class="highlight"><pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="c1"># pypi</span>
<span class="c1"># from bokeh.models import HoverTool</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">be_below</span><span class="p">,</span> <span class="n">contain_exactly</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">njit</span>
<span class="kn">from</span> <span class="nn">numba.typed</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">default_rng</span>

<span class="kn">import</span> <span class="nn">altair</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># this project</span>
<span class="kn">from</span> <span class="nn">graeae.visualization.altair_helpers</span> <span class="kn">import</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">save_chart</span>
<span class="kn">from</span> <span class="nn">bowling.sort.bubble</span> <span class="kn">import</span> <span class="n">bubble</span><span class="p">,</span> <span class="n">BubbleOutput</span>

<span class="c1"># my other stuff</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">Timer</span>
</pre></div>
</div>
</div>

<div id="outline-container-orge15fb2c" class="outline-4">
<h4 id="orge15fb2c">Stuff For Later</h4>
<div class="outline-text-4" id="text-orge15fb2c">
<div class="highlight"><pre><span></span><span class="n">TIMER</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
<span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"double-bubble-sort"</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="n">output_path</span><span class="p">(</span><span class="n">SLUG</span><span class="p">)</span>
<span class="n">random</span> <span class="o">=</span> <span class="n">default_rng</span><span class="p">(</span><span class="mi">2021</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div id="outline-container-orgf8b4fba" class="outline-2">
<h2 id="orgf8b4fba">The Sorters</h2>
<div class="outline-text-2" id="text-orgf8b4fba">
</div>
<div id="outline-container-org8a0a5c2" class="outline-3">
<h3 id="org8a0a5c2">Bubba Sort</h3>
<div class="outline-text-3" id="text-org8a0a5c2">
<p>
This will be the short-circuiting version of the bubble sort.
</p>
</div>

<div id="outline-container-orgcc87480" class="outline-4">
<h4 id="orgcc87480">Bubba</h4>
<div class="outline-text-4" id="text-orgcc87480">
<p>
This is the short-circuiter. It works pretty much the same way with just an extra if-statement to break out of the loop if nothing was swapped.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">bubba</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BubbleOutput</span><span class="p">:</span>
    <span class="sd">"""Sorts the list in place</span>

<span class="sd">    Args:</span>
<span class="sd">     elements: list of (in-place) sortable elements</span>

<span class="sd">    Returns:</span>
<span class="sd">     number of elements, count of comparisons</span>
<span class="sd">    """</span>
    <span class="n">all_but_one</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">comparisons</span> <span class="o">=</span> <span class="n">swaps</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">items_sorted</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">all_but_one</span><span class="p">):</span>
	<span class="n">swapped_at_least_once</span> <span class="o">=</span> <span class="kc">False</span>
	<span class="k">for</span> <span class="n">in_front_of_us</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">all_but_one</span> <span class="o">-</span> <span class="n">items_sorted</span><span class="p">):</span>
	    <span class="n">comparisons</span> <span class="o">+=</span> <span class="mi">1</span>
	    <span class="n">to_the_right</span> <span class="o">=</span> <span class="n">in_front_of_us</span> <span class="o">+</span> <span class="mi">1</span>
	    <span class="k">if</span> <span class="n">elements</span><span class="p">[</span><span class="n">to_the_right</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">elements</span><span class="p">[</span><span class="n">in_front_of_us</span><span class="p">]:</span>
		<span class="p">(</span><span class="n">elements</span><span class="p">[</span><span class="n">in_front_of_us</span><span class="p">],</span>
		 <span class="n">elements</span><span class="p">[</span><span class="n">to_the_right</span><span class="p">])</span> <span class="o">=</span> <span class="p">(</span><span class="n">elements</span><span class="p">[</span><span class="n">to_the_right</span><span class="p">],</span>
					  <span class="n">elements</span><span class="p">[</span><span class="n">in_front_of_us</span><span class="p">])</span>
		<span class="n">swapped_at_least_once</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="n">swaps</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">swapped_at_least_once</span><span class="p">:</span>
	    <span class="k">break</span>
    <span class="k">return</span> <span class="n">BubbleOutput</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">),</span> <span class="n">comparisons</span><span class="p">,</span> <span class="n">swaps</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div id="outline-container-org1cfc61a" class="outline-4">
<h4 id="org1cfc61a">Bubble</h4>
<div class="outline-text-4" id="text-org1cfc61a">
<p>
I showed how I implement the bubble sort in the <a href="../bubble-sort-an-empirical-look/">previous bubble sort post</a> so, since I imported it up above, I'm just going to run it.
</p>
</div>
</div>
<div id="outline-container-orgd2fb889" class="outline-4">
<h4 id="orgd2fb889">Test It Out</h4>
<div class="outline-text-4" id="text-orgd2fb889">
<p>
Once again, let's just make sure everything works.
</p>

<div class="highlight"><pre><span></span><span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>

<span class="n">expected</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">inputs</span><span class="p">))</span>

<span class="n">test_1</span><span class="p">,</span> <span class="n">test_2</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">inputs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">bubba_output</span> <span class="o">=</span> <span class="n">bubba</span><span class="p">(</span><span class="n">test_1</span><span class="p">)</span>
<span class="n">original_output</span> <span class="o">=</span> <span class="n">bubble</span><span class="p">(</span><span class="n">test_2</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">test_1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">test_2</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>

<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">worst</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span>
<span class="n">expect</span><span class="p">(</span><span class="n">bubba_output</span><span class="o">.</span><span class="n">comparisons</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_below</span><span class="p">(</span><span class="n">worst</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">bubba_output</span><span class="o">.</span><span class="n">comparisons</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">15</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">bubba_output</span><span class="o">.</span><span class="n">swaps</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">original_output</span><span class="o">.</span><span class="n">swaps</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">original_output</span><span class="o">.</span><span class="n">comparisons</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">worst</span><span class="p">))</span>

<span class="c1"># try a bigger input</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)),</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">inputs</span><span class="p">))</span>

<span class="n">test_1</span><span class="p">,</span> <span class="n">test_2</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">inputs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">bubba_output</span> <span class="o">=</span> <span class="n">bubba</span><span class="p">(</span><span class="n">test_1</span><span class="p">)</span>
<span class="n">original_output</span> <span class="o">=</span> <span class="n">bubble</span><span class="p">(</span><span class="n">test_2</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">test_1</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">test_2</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>

<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">worst</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span>
<span class="n">expect</span><span class="p">(</span><span class="n">bubba_output</span><span class="o">.</span><span class="n">comparisons</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_below</span><span class="p">(</span><span class="n">worst</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">original_output</span><span class="o">.</span><span class="n">comparisons</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">worst</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">bubba_output</span><span class="o">.</span><span class="n">swaps</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">original_output</span><span class="o">.</span><span class="n">swaps</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">original_output</span><span class="o">.</span><span class="n">comparisons</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">worst</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>

<div id="outline-container-org92e58aa" class="outline-2">
<h2 id="org92e58aa">Counting Comparisons</h2>
<div class="outline-text-2" id="text-org92e58aa">
<p>
Since the actual method of sorting is the same the swaps should be the same in either case (the new version doesn't quit until there's no more swaps to be done) so I'll just look at the comparisons and see if it made any real difference.
</p>
</div>

<div id="outline-container-org66a9c87" class="outline-3">
<h3 id="org66a9c87">Set Up Numba</h3>
<div class="outline-text-3" id="text-org66a9c87">
<div class="highlight"><pre><span></span><span class="n">bubba</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="n">bubba</span><span class="p">,</span> <span class="n">nogil</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">bubble</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="n">bubble</span><span class="p">,</span> <span class="n">nogil</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-org37d9c94" class="outline-3">
<h3 id="org37d9c94">Run The Bubble Counter</h3>
<div class="outline-text-3" id="text-org37d9c94">
<div class="highlight"><pre><span></span><span class="n">things_to_sort</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">)),</span> <span class="n">size</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>
		  <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)]</span>

<span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">bubbles_counts_and_comparisons</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
	<span class="n">delayed</span><span class="p">(</span><span class="n">bubble</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">)</span>
</pre></div>

<pre class="example">
Started: 2022-01-12 23:40:18.730737
Ended: 2022-01-12 23:41:51.143272
Elapsed: 0:01:32.412535
</pre>
</div>
</div>

<div id="outline-container-org18439a7" class="outline-3">
<h3 id="org18439a7">Run the Bubba Counter</h3>
<div class="outline-text-3" id="text-org18439a7">
<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">bubbas_counts_and_comparisons</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">2</span><span class="p">)(</span>
	<span class="n">delayed</span><span class="p">(</span><span class="n">bubba</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">)</span>
</pre></div>

<pre class="example">
Started: 2022-01-12 23:41:58.766180
Ended: 2022-01-12 23:43:38.475355
Elapsed: 0:01:39.709175
</pre>


<p>
Time-wise it seems to have done about the same as the original bubble sort.
</p>


<div class="highlight"><pre><span></span><span class="n">SIZE</span><span class="p">,</span> <span class="n">COMPARISONS</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
<span class="n">bubble_unzipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">bubbles_counts_and_comparisons</span><span class="p">))</span>
<span class="n">bubba_unzipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">bubbas_counts_and_comparisons</span><span class="p">))</span>
<span class="n">bubba_frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"Elements"</span><span class="p">:</span> <span class="n">bubble_unzipped</span><span class="p">[</span><span class="n">SIZE</span><span class="p">],</span>
				<span class="s2">"Bubble"</span><span class="p">:</span> <span class="n">bubble_unzipped</span><span class="p">[</span><span class="n">COMPARISONS</span><span class="p">],</span>
				<span class="s2">"Bubba"</span><span class="p">:</span> <span class="n">bubba_unzipped</span><span class="p">[</span><span class="n">COMPARISONS</span><span class="p">]})</span>

<span class="n">melted</span> <span class="o">=</span> <span class="n">bubba_frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Elements"</span><span class="p">],</span>
			  <span class="n">var_name</span><span class="o">=</span><span class="s2">"Sorter"</span><span class="p">,</span>
			  <span class="n">value_name</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Elements"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Sorter"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Elements"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span> <span class="s2">"Sorter"</span><span class="p">,</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Comparisons"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">)]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Bubble Sort Comparisons (with and without short-circuiting)"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">save_chart</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"bubble_comparisons"</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
</pre></div>


<object type="text/html" data="bubble_comparisons.html" style="width:100%" height="400">
  <p>Figure Missing</p>
</object>

<p>
At first glance it looks like there's only one grey set of points, but if you zoom in (using the mouse's scroll wheel) you'll see that the grey points are actually (sometimes) created by adjacent points with the short-circuiting version's point (the blue point) slightly lower than the non-short-ciruiting orange point. So there is a difference, but it's small enough that it isn't easy to see.
</p>

<p>
Let's see if it becomes more obvious using the difference between the points instead.
</p>
<div class="highlight"><pre><span></span><span class="n">bubba_frame</span><span class="p">[</span><span class="s2">"Difference"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">bubba_frame</span><span class="p">[</span><span class="s2">"Bubble"</span><span class="p">]</span> <span class="o">-</span>
			     <span class="n">bubba_frame</span><span class="p">[</span><span class="s2">"Bubba"</span><span class="p">])</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">bubba_frame</span><span class="p">)</span><span class="o">.</span><span class="n">mark_trail</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Elements:O"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Difference:Q"</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="s2">"Difference:Q"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Elements"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Difference"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Bubble"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Bubba"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">)]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Difference In Comparisons Between the Bubble Sorts"</span><span class="p">,</span>
	     <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
	     <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">save_chart</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"bubble_differences"</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="bubble_differences.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>

<p>
So, it looks like there are sometimes significant differences between the two sorts, but how do they appear given the total number of comparisons made?
</p>

<div class="highlight"><pre><span></span><span class="n">bubba_frame</span><span class="p">[</span><span class="s2">"Difference/Comparisons"</span><span class="p">]</span> <span class="o">=</span> <span class="n">bubba_frame</span><span class="o">.</span><span class="n">Difference</span><span class="o">/</span><span class="n">bubba_frame</span><span class="o">.</span><span class="n">Bubba</span>
<span class="n">sub_bubba</span> <span class="o">=</span> <span class="n">bubba_frame</span><span class="p">[[</span><span class="s2">"Elements"</span><span class="p">,</span> <span class="s2">"Difference/Comparisons"</span><span class="p">]]</span>
<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">sub_bubba</span><span class="p">)</span><span class="o">.</span><span class="n">mark_trail</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Elements:O"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Difference/Comparisons:Q"</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="s2">"Difference/Comparisons:Q"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Elements"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Difference/Comparisons"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">".4f"</span><span class="p">)]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Proportion of Difference Between the Bubble Sorts"</span><span class="p">,</span>
	     <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
	     <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">save_chart</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"bubble_difference_proportions"</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">,</span>
	   <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="bubble_difference_proportions.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>

<p>
It looks like as the amount of sorting that's needed goes up, the difference made by the short-circuiting becomes smaller in comparison to the total number of comparisons made, but even the biggest effect proportional to the amount of comparisons made by the short-circuiting sorter only comes to the difference being 0.2% of the total comparisons.
</p>
</div>
</div>

<div id="outline-container-org1b7a66c" class="outline-3">
<h3 id="org1b7a66c">Best Case, Worst Case</h3>
<div class="outline-text-3" id="text-org1b7a66c">
<p>
Now that we know that the short-circuiting isn't that big a deal I'll add some plotting showing how our random cases compare to the best-case and worst case sorting inputs.
</p>

<div class="highlight"><pre><span></span><span class="n">best_things</span> <span class="o">=</span> <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)]</span>
<span class="n">worst_things</span> <span class="o">=</span> <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">things</span><span class="p">)</span> <span class="k">for</span> <span class="n">things</span> <span class="ow">in</span> <span class="n">best_things</span><span class="p">]</span>

<span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">worst_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
	<span class="n">delayed</span><span class="p">(</span><span class="n">bubba</span><span class="p">)(</span><span class="n">thing</span><span class="p">)</span> <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="n">worst_things</span>
<span class="p">)</span>
</pre></div>

<pre class="example">
Started: 2022-01-13 00:01:27.932132
Ended: 2022-01-13 00:02:08.108278
Elapsed: 0:00:40.176146
</pre>


<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">best_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
	<span class="n">delayed</span><span class="p">(</span><span class="n">bubba</span><span class="p">)(</span><span class="n">thing</span><span class="p">)</span> <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="n">best_things</span>
<span class="p">)</span>
</pre></div>

<pre class="example">
Started: 2022-01-13 00:08:59.231664
Ended: 2022-01-13 00:09:00.409103
Elapsed: 0:00:01.177439
</pre>


<div class="highlight"><pre><span></span><span class="n">worst_unzipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">worst_output</span><span class="p">))</span>
<span class="n">best_unzipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">best_output</span><span class="p">))</span>

<span class="k">del</span> <span class="n">bubba_frame</span><span class="p">[</span><span class="s2">"Bubble"</span><span class="p">]</span>
<span class="k">del</span> <span class="n">bubba_frame</span><span class="p">[</span><span class="s2">"Difference"</span><span class="p">]</span>
<span class="k">del</span> <span class="n">bubba_frame</span><span class="p">[</span><span class="s2">"Difference/Comparisons"</span><span class="p">]</span>
<span class="n">bubba_frame</span> <span class="o">=</span> <span class="n">bubba_frame</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"Bubba"</span><span class="p">:</span> <span class="s2">"Random"</span><span class="p">})</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">bubba_frame</span><span class="p">[</span><span class="s2">"Worst Case"</span><span class="p">]</span> <span class="o">=</span> <span class="n">worst_unzipped</span><span class="p">[</span><span class="n">COMPARISONS</span><span class="p">]</span>
<span class="n">bubba_frame</span><span class="p">[</span><span class="s2">"Best Case"</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_unzipped</span><span class="p">[</span><span class="n">COMPARISONS</span><span class="p">]</span>

<span class="n">melted</span> <span class="o">=</span> <span class="n">bubba_frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Elements"</span><span class="p">],</span>
			  <span class="n">var_name</span><span class="o">=</span><span class="s2">"Input"</span><span class="p">,</span>
			  <span class="n">value_name</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Elements"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Input"</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">550</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Bubble Sort Best, Worst, and Random Input Comparisons"</span>
<span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">save_chart</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"best-worst-random"</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="best-worst-random.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>

<p>
Once again we run into the problem/case that it looks like the Random input is missing, but if you zoom way in you'll see it does <i>slightly</i> better than the <i>worst-case</i>, but the difference is so small that when you zoom back out they look like they did exactly the same. The <i>best-case</i> does much better, since it only has to pass through the data once to see that it's already sorted and then quit (which isn't really reflected in the plot because our increment of <i>comparisons</i> only happens if the inner loop is entered), but except for this unusual case, random inputs don't do enough better than the worst-case examples to make short-circuiting a noteworthy improvement.
</p>
</div>
</div>
</div>

<div id="outline-container-org28c342a" class="outline-2">
<h2 id="org28c342a">The End, The End</h2>
<div class="outline-text-2" id="text-org28c342a">
<p>
Well, I think I've beaten this dead horse enough for now. The overview for all the posts is <a href="../the-bubble-sort/">here</a>, if you didn't get enough of it. Up next: <a href="../selection-sort/">Selection Sort</a>.
</p>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/algorithms/" rel="tag">algorithms</a></li>
            <li><a class="tag p-category" href="../../categories/brute-force/" rel="tag">brute-force</a></li>
            <li><a class="tag p-category" href="../../categories/sorting/" rel="tag">sorting</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../bubble-sort-an-empirical-look/" rel="prev" title="Bubble Sort: An Empirical Look">Previous post</a>
            </li>
            <li class="next">
                <a href="../selection-sort/" rel="next" title="Selection Sort">Next post</a>
            </li>
        </ul></nav></aside></article><!--End of body content--><footer id="footer"><a href="mailto:cloisteredmonkey.jmark@slmail.me">The Cloistered Monkey</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
 <img alt="Creative Commons License BY-NC-SA" style="border-width:0; margin-bottom:12px;" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"></a>
            
            
        </footer>
</div>
</div>


        <script src="../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
