<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Another look at Bubble Sort." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Bubble-Sort Revisited | Bowling For Data</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Bowling-For-Data/posts/double-bubble-sort/index.html" rel="canonical"><!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]-->
<meta content="The Cloistered Monkey" name="author">
<link href="../bubble-sort-an-empirical-look/index.html" rel="prev" title="Bubble Sort: An Empirical Look" type="text/html">
<link href="../selection-sort/index.html" rel="next" title="Selection Sort" type="text/html">
<meta content="Bowling For Data" property="og:site_name">
<meta content="Bubble-Sort Revisited" property="og:title">
<meta content="https://necromuralist.github.io/Bowling-For-Data/posts/double-bubble-sort/index.html" property="og:url">
<meta content="Another look at Bubble Sort." property="og:description">
<meta content="article" property="og:type">
<meta content="2021-11-19T17:14:43-08:00" property="article:published_time">
<meta content="algorithms" property="article:tag">
<meta content="brute-force" property="article:tag">
<meta content="sorting" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="../../"><span id="blog-title">Bowling For Data</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="../../pages/">Pages</a></li>
<li class="nav-item"><a class="nav-link" href="../../archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="../../categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="../../rss.xml">RSS feed</a></li>
<li class="nav-item dropdown"><a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Monkey Pages</a>
<div class="dropdown-menu"><a class="dropdown-item" href="https://necromuralist.github.io/">The Cloistered Monkey</a> <a class="dropdown-item" href="https://necromuralist.github.io/Ape-Iron/">Ape Iron</a> <a class="dropdown-item" href="https://necromuralist.github.io/Beach-Pig-Thigh/">Beach-Pig Rump & Thigh</a> <a class="dropdown-item" href="https://necromuralist.github.io/Neurotic-Networking/">Neurotic Networking</a> <a class="dropdown-item" href="https://necromuralist.github.io/Terribilis-Ludum/">Terribilis Ludum</a> <a class="dropdown-item" href="https://necromuralist.github.io/Visions-Voices-Data/">Visions, Voices, Data</a></div>
</li>
</ul>
<!-- DuckDuckGo custom search -->
<form action="https://duckduckgo.com/" class="navbar-form pull-left" id="search" method="get" name="search"><input name="sites" type="hidden" value="https://necromuralist.github.io/Bowling-For-Data/"><input name="k8" type="hidden" value="#444444"><input name="k9" type="hidden" value="#D51920"><input name="kt" type="hidden" value="h"><input class="span2" maxlength="255" name="q" placeholder="Search…" style="margin-top: 4px;" type="text"><input style="visibility: hidden;" type="submit" value="DuckDuckGo Search"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href="#">Bubble-Sort Revisited</a></h1>
<div class="metadata">
<p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="#" rel="bookmark"><time class="published dt-published" datetime="2021-11-19T17:14:43-08:00" itemprop="datePublished" title="2021-11-19 17:14">2021-11-19 17:14</time></a></p>
<p class="sourceline"><a class="sourcelink" href="index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="index.html#orgf97d049">In the Beginning</a>
<ul>
<li><a href="index.html#org63d29cc">Some Setup</a>
<ul>
<li><a href="index.html#orgae21335">Imports</a></li>
<li><a href="index.html#orgd6f6f4d">Stuff For Later</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="index.html#orga4ddc04">The Sorters</a>
<ul>
<li><a href="index.html#org35f6ab4">Bubba Sort</a>
<ul>
<li><a href="index.html#org189cece">Bubba</a></li>
<li><a href="index.html#org48db080">Bubble</a></li>
<li><a href="index.html#orgc05f7b9">Test It Out</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="index.html#org40a7d80">Counting Comparisons</a>
<ul>
<li><a href="index.html#org6f1a749">Set Up Numba</a></li>
<li><a href="index.html#org359e477">Run The Bubble Counter</a></li>
<li><a href="index.html#orgb2068b4">Run the Bubba Counter</a></li>
<li><a href="index.html#org688c7cf">Best Case, Worst Case</a></li>
</ul>
</li>
<li><a href="index.html#orge13a756">The End, The End</a></li>
</ul>
</div>
</div>
<p>This is a continuation of a <a href="../../pages/the-bubble-sort/index.html">series on the Bubble Sort</a>.</p>
<div class="outline-2" id="outline-container-orgf97d049">
<h2 id="orgf97d049">In the Beginning</h2>
<div class="outline-text-2" id="text-orgf97d049">
<p>In the <a href="../bubble-sort-an-empirical-look/index.html">previous bubble sort post</a> I implemented the basic bubble sort, but there is a variation of it where you short-circuit the search if the collection is already sorted which is what I'll look at here. The short-circuiting means that the bubble sort can sometimes do better than other methods, but only when the data is mostly sorted so it's still not a practical algorithm. Why do this, then? Eh, why not?</p>
</div>
<div class="outline-3" id="outline-container-org63d29cc">
<h3 id="org63d29cc">Some Setup</h3>
<div class="outline-text-3" id="text-org63d29cc"></div>
<div class="outline-4" id="outline-container-orgae21335">
<h4 id="orgae21335">Imports</h4>
<div class="outline-text-4" id="text-orgae21335">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="c1"># pypi</span>
<span class="c1"># from bokeh.models import HoverTool</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">be_below</span><span class="p">,</span> <span class="n">contain_exactly</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">njit</span>
<span class="kn">from</span> <span class="nn">numba.typed</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">default_rng</span>

<span class="kn">import</span> <span class="nn">altair</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># this project</span>
<span class="kn">from</span> <span class="nn">graeae.visualization.altair_helpers</span> <span class="kn">import</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">save_chart</span>
<span class="kn">from</span> <span class="nn">bowling.sort.bubble</span> <span class="kn">import</span> <span class="n">bubble</span><span class="p">,</span> <span class="n">BubbleOutput</span>

<span class="c1"># my other stuff</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">Timer</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgd6f6f4d">
<h4 id="orgd6f6f4d">Stuff For Later</h4>
<div class="outline-text-4" id="text-orgd6f6f4d">
<div class="highlight">
<pre><span></span><span class="n">TIMER</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
<span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"double-bubble-sort"</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="n">output_path</span><span class="p">(</span><span class="n">SLUG</span><span class="p">)</span>
<span class="n">random</span> <span class="o">=</span> <span class="n">default_rng</span><span class="p">(</span><span class="mi">2021</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orga4ddc04">
<h2 id="orga4ddc04">The Sorters</h2>
<div class="outline-text-2" id="text-orga4ddc04"></div>
<div class="outline-3" id="outline-container-org35f6ab4">
<h3 id="org35f6ab4">Bubba Sort</h3>
<div class="outline-text-3" id="text-org35f6ab4">
<p>This will be the short-circuiting version of the bubble sort.</p>
</div>
<div class="outline-4" id="outline-container-org189cece">
<h4 id="org189cece">Bubba</h4>
<div class="outline-text-4" id="text-org189cece">
<p>This is the short-circuiter. It works pretty much the same way with just an extra if-statement to break out of the loop if nothing was swapped.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">bubba</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BubbleOutput</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Sorts the list in place</span>

<span class="sd">    Args:</span>
<span class="sd">     elements: list of (in-place) sortable elements</span>

<span class="sd">    Returns:</span>
<span class="sd">     number of elements, count of comparisons</span>
<span class="sd">    """</span>
    <span class="n">all_but_one</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">comparisons</span> <span class="o">=</span> <span class="n">swaps</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">items_sorted</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">all_but_one</span><span class="p">):</span>
        <span class="n">swapped_at_least_once</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">in_front_of_us</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">all_but_one</span> <span class="o">-</span> <span class="n">items_sorted</span><span class="p">):</span>
            <span class="n">comparisons</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">to_the_right</span> <span class="o">=</span> <span class="n">in_front_of_us</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">elements</span><span class="p">[</span><span class="n">to_the_right</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">elements</span><span class="p">[</span><span class="n">in_front_of_us</span><span class="p">]:</span>
                <span class="p">(</span><span class="n">elements</span><span class="p">[</span><span class="n">in_front_of_us</span><span class="p">],</span>
                 <span class="n">elements</span><span class="p">[</span><span class="n">to_the_right</span><span class="p">])</span> <span class="o">=</span> <span class="p">(</span><span class="n">elements</span><span class="p">[</span><span class="n">to_the_right</span><span class="p">],</span>
                                          <span class="n">elements</span><span class="p">[</span><span class="n">in_front_of_us</span><span class="p">])</span>
                <span class="n">swapped_at_least_once</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">swaps</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">swapped_at_least_once</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">BubbleOutput</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">),</span> <span class="n">comparisons</span><span class="p">,</span> <span class="n">swaps</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org48db080">
<h4 id="org48db080">Bubble</h4>
<div class="outline-text-4" id="text-org48db080">
<p>I showed how I implement the bubble sort in the <a href="../bubble-sort-an-empirical-look/index.html">previous bubble sort post</a> so, since I imported it up above, I'm just going to run it.</p>
</div>
</div>
<div class="outline-4" id="outline-container-orgc05f7b9">
<h4 id="orgc05f7b9">Test It Out</h4>
<div class="outline-text-4" id="text-orgc05f7b9">
<p>Once again, let's just make sure everything works.</p>
<div class="highlight">
<pre><span></span><span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>

<span class="n">expected</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">inputs</span><span class="p">))</span>

<span class="n">test_1</span><span class="p">,</span> <span class="n">test_2</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">inputs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">bubba_output</span> <span class="o">=</span> <span class="n">bubba</span><span class="p">(</span><span class="n">test_1</span><span class="p">)</span>
<span class="n">original_output</span> <span class="o">=</span> <span class="n">bubble</span><span class="p">(</span><span class="n">test_2</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">test_1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">test_2</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>

<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">worst</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span>
<span class="n">expect</span><span class="p">(</span><span class="n">bubba_output</span><span class="o">.</span><span class="n">comparisons</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_below</span><span class="p">(</span><span class="n">worst</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">bubba_output</span><span class="o">.</span><span class="n">comparisons</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">15</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">bubba_output</span><span class="o">.</span><span class="n">swaps</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">original_output</span><span class="o">.</span><span class="n">swaps</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">original_output</span><span class="o">.</span><span class="n">comparisons</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">worst</span><span class="p">))</span>

<span class="c1"># try a bigger input</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)),</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">inputs</span><span class="p">))</span>

<span class="n">test_1</span><span class="p">,</span> <span class="n">test_2</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">inputs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">bubba_output</span> <span class="o">=</span> <span class="n">bubba</span><span class="p">(</span><span class="n">test_1</span><span class="p">)</span>
<span class="n">original_output</span> <span class="o">=</span> <span class="n">bubble</span><span class="p">(</span><span class="n">test_2</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">test_1</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">test_2</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>

<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">worst</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span>
<span class="n">expect</span><span class="p">(</span><span class="n">bubba_output</span><span class="o">.</span><span class="n">comparisons</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_below</span><span class="p">(</span><span class="n">worst</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">original_output</span><span class="o">.</span><span class="n">comparisons</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">worst</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">bubba_output</span><span class="o">.</span><span class="n">swaps</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">original_output</span><span class="o">.</span><span class="n">swaps</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">original_output</span><span class="o">.</span><span class="n">comparisons</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">worst</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org40a7d80">
<h2 id="org40a7d80">Counting Comparisons</h2>
<div class="outline-text-2" id="text-org40a7d80">
<p>Since the actual method of sorting is the same the swaps should be the same in either case (the new version doesn't quit until there's no more swaps to be done) so I'll just look at the comparisons and see if it made any real difference.</p>
</div>
<div class="outline-3" id="outline-container-org6f1a749">
<h3 id="org6f1a749">Set Up Numba</h3>
<div class="outline-text-3" id="text-org6f1a749">
<div class="highlight">
<pre><span></span><span class="n">bubba</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="n">bubba</span><span class="p">,</span> <span class="n">nogil</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">bubble</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="n">bubble</span><span class="p">,</span> <span class="n">nogil</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org359e477">
<h3 id="org359e477">Run The Bubble Counter</h3>
<div class="outline-text-3" id="text-org359e477">
<div class="highlight">
<pre><span></span><span class="n">things_to_sort</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">)),</span> <span class="n">size</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>
                  <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)]</span>

<span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">bubbles_counts_and_comparisons</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
        <span class="n">delayed</span><span class="p">(</span><span class="n">bubble</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">)</span>
</pre></div>
<pre class="example">
Started: 2022-01-12 23:40:18.730737
Ended: 2022-01-12 23:41:51.143272
Elapsed: 0:01:32.412535
</pre></div>
</div>
<div class="outline-3" id="outline-container-orgb2068b4">
<h3 id="orgb2068b4">Run the Bubba Counter</h3>
<div class="outline-text-3" id="text-orgb2068b4">
<div class="highlight">
<pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">bubbas_counts_and_comparisons</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">2</span><span class="p">)(</span>
        <span class="n">delayed</span><span class="p">(</span><span class="n">bubba</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">)</span>
</pre></div>
<pre class="example">
Started: 2022-01-12 23:41:58.766180
Ended: 2022-01-12 23:43:38.475355
Elapsed: 0:01:39.709175
</pre>
<p>Time-wise it seems to have done about the same as the original bubble sort.</p>
<div class="highlight">
<pre><span></span><span class="n">SIZE</span><span class="p">,</span> <span class="n">COMPARISONS</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
<span class="n">bubble_unzipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">bubbles_counts_and_comparisons</span><span class="p">))</span>
<span class="n">bubba_unzipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">bubbas_counts_and_comparisons</span><span class="p">))</span>
<span class="n">bubba_frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"Elements"</span><span class="p">:</span> <span class="n">bubble_unzipped</span><span class="p">[</span><span class="n">SIZE</span><span class="p">],</span>
                                <span class="s2">"Bubble"</span><span class="p">:</span> <span class="n">bubble_unzipped</span><span class="p">[</span><span class="n">COMPARISONS</span><span class="p">],</span>
                                <span class="s2">"Bubba"</span><span class="p">:</span> <span class="n">bubba_unzipped</span><span class="p">[</span><span class="n">COMPARISONS</span><span class="p">]})</span>

<span class="n">melted</span> <span class="o">=</span> <span class="n">bubba_frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Elements"</span><span class="p">],</span>
                          <span class="n">var_name</span><span class="o">=</span><span class="s2">"Sorter"</span><span class="p">,</span>
                          <span class="n">value_name</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Elements"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Sorter"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Elements"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span> <span class="s2">"Sorter"</span><span class="p">,</span>
             <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Comparisons"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">)]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Bubble Sort Comparisons (with and without short-circuiting)"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">save_chart</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"bubble_comparisons"</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
</pre></div>
<object data="bubble_comparisons.html" height="400" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>At first glance it looks like there's only one grey set of points, but if you zoom in (using the mouse's scroll wheel) you'll see that the grey points are actually (sometimes) created by adjacent points with the short-circuiting version's point (the blue point) slightly lower than the non-short-ciruiting orange point. So there is a difference, but it's small enough that it isn't easy to see.</p>
<p>Let's see if it becomes more obvious using the difference between the points instead.</p>
<div class="highlight">
<pre><span></span><span class="n">bubba_frame</span><span class="p">[</span><span class="s2">"Difference"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">bubba_frame</span><span class="p">[</span><span class="s2">"Bubble"</span><span class="p">]</span> <span class="o">-</span>
                             <span class="n">bubba_frame</span><span class="p">[</span><span class="s2">"Bubba"</span><span class="p">])</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">bubba_frame</span><span class="p">)</span><span class="o">.</span><span class="n">mark_trail</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Elements:O"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Difference:Q"</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="s2">"Difference:Q"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Elements"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
             <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Difference"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
             <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Bubble"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
             <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Bubba"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">)]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Difference In Comparisons Between the Bubble Sorts"</span><span class="p">,</span>
             <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
             <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">save_chart</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"bubble_differences"</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
<object data="bubble_differences.html" height="600" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>So, it looks like there are sometimes significant differences between the two sorts, but how do they appear given the total number of comparisons made?</p>
<div class="highlight">
<pre><span></span><span class="n">bubba_frame</span><span class="p">[</span><span class="s2">"Difference/Comparisons"</span><span class="p">]</span> <span class="o">=</span> <span class="n">bubba_frame</span><span class="o">.</span><span class="n">Difference</span><span class="o">/</span><span class="n">bubba_frame</span><span class="o">.</span><span class="n">Bubba</span>
<span class="n">sub_bubba</span> <span class="o">=</span> <span class="n">bubba_frame</span><span class="p">[[</span><span class="s2">"Elements"</span><span class="p">,</span> <span class="s2">"Difference/Comparisons"</span><span class="p">]]</span>
<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">sub_bubba</span><span class="p">)</span><span class="o">.</span><span class="n">mark_trail</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Elements:O"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Difference/Comparisons:Q"</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="s2">"Difference/Comparisons:Q"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Elements"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
             <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Difference/Comparisons"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">".4f"</span><span class="p">)]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Proportion of Difference Between the Bubble Sorts"</span><span class="p">,</span>
             <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
             <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">save_chart</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"bubble_difference_proportions"</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">,</span>
           <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
<object data="bubble_difference_proportions.html" height="600" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>It looks like as the amount of sorting that's needed goes up, the difference made by the short-circuiting becomes smaller in comparison to the total number of comparisons made, but even the biggest effect proportional to the amount of comparisons made by the short-circuiting sorter only comes to the difference being 0.2% of the total comparisons.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org688c7cf">
<h3 id="org688c7cf">Best Case, Worst Case</h3>
<div class="outline-text-3" id="text-org688c7cf">
<p>Now that we know that the short-circuiting isn't that big a deal I'll add some plotting showing how our random cases compare to the best-case and worst case sorting inputs.</p>
<div class="highlight">
<pre><span></span><span class="n">best_things</span> <span class="o">=</span> <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)]</span>
<span class="n">worst_things</span> <span class="o">=</span> <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">things</span><span class="p">)</span> <span class="k">for</span> <span class="n">things</span> <span class="ow">in</span> <span class="n">best_things</span><span class="p">]</span>

<span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">worst_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
        <span class="n">delayed</span><span class="p">(</span><span class="n">bubba</span><span class="p">)(</span><span class="n">thing</span><span class="p">)</span> <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="n">worst_things</span>
<span class="p">)</span>
</pre></div>
<pre class="example">
Started: 2022-01-13 00:01:27.932132
Ended: 2022-01-13 00:02:08.108278
Elapsed: 0:00:40.176146
</pre>
<div class="highlight">
<pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">best_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
        <span class="n">delayed</span><span class="p">(</span><span class="n">bubba</span><span class="p">)(</span><span class="n">thing</span><span class="p">)</span> <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="n">best_things</span>
<span class="p">)</span>
</pre></div>
<pre class="example">
Started: 2022-01-13 00:08:59.231664
Ended: 2022-01-13 00:09:00.409103
Elapsed: 0:00:01.177439
</pre>
<div class="highlight">
<pre><span></span><span class="n">worst_unzipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">worst_output</span><span class="p">))</span>
<span class="n">best_unzipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">best_output</span><span class="p">))</span>

<span class="k">del</span> <span class="n">bubba_frame</span><span class="p">[</span><span class="s2">"Bubble"</span><span class="p">]</span>
<span class="k">del</span> <span class="n">bubba_frame</span><span class="p">[</span><span class="s2">"Difference"</span><span class="p">]</span>
<span class="k">del</span> <span class="n">bubba_frame</span><span class="p">[</span><span class="s2">"Difference/Comparisons"</span><span class="p">]</span>
<span class="n">bubba_frame</span> <span class="o">=</span> <span class="n">bubba_frame</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"Bubba"</span><span class="p">:</span> <span class="s2">"Random"</span><span class="p">})</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">bubba_frame</span><span class="p">[</span><span class="s2">"Worst Case"</span><span class="p">]</span> <span class="o">=</span> <span class="n">worst_unzipped</span><span class="p">[</span><span class="n">COMPARISONS</span><span class="p">]</span>
<span class="n">bubba_frame</span><span class="p">[</span><span class="s2">"Best Case"</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_unzipped</span><span class="p">[</span><span class="n">COMPARISONS</span><span class="p">]</span>

<span class="n">melted</span> <span class="o">=</span> <span class="n">bubba_frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Elements"</span><span class="p">],</span>
                          <span class="n">var_name</span><span class="o">=</span><span class="s2">"Input"</span><span class="p">,</span>
                          <span class="n">value_name</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Elements"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Input"</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">550</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Bubble Sort Best, Worst, and Random Input Comparisons"</span>
<span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">save_chart</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"best-worst-random"</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
<object data="best-worst-random.html" height="600" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>Once again we run into the problem/case that it looks like the Random input is missing, but if you zoom way in you'll see it does <i>slightly</i> better than the <i>worst-case</i>, but the difference is so small that when you zoom back out they look like they did exactly the same. The <i>best-case</i> does much better, since it only has to pass through the data once to see that it's already sorted and then quit (which isn't really reflected in the plot because our increment of <i>comparisons</i> only happens if the inner loop is entered), but except for this unusual case, random inputs don't do enough better than the worst-case examples to make short-circuiting a noteworthy improvement.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orge13a756">
<h2 id="orge13a756">The End, The End</h2>
<div class="outline-text-2" id="text-orge13a756">
<p>Well, I think I've beaten this dead horse enough for now. The overview for all the posts is <a href="../../pages/the-bubble-sort/index.html">here</a>, if you didn't get enough of it. Up next: <a href="../selection-sort/index.html">Selection Sort</a>.</p>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="../../categories/algorithms/index.html" rel="tag">algorithms</a></li>
<li><a class="tag p-category" href="../../categories/brute-force/index.html" rel="tag">brute-force</a></li>
<li><a class="tag p-category" href="../../categories/sorting/index.html" rel="tag">sorting</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="../bubble-sort-an-empirical-look/index.html" rel="prev" title="Bubble Sort: An Empirical Look">Previous post</a></li>
<li class="next"><a href="../selection-sort/index.html" rel="next" title="Selection Sort">Next post</a></li>
</ul>
</nav>
</aside>
</article>
<!--End of body content-->
<footer id="footer">Scribbles by <a href="mailto:cloisteredmonkey.jmark@slmail.me">The Cloistered Monkey</a> © 2024 - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a>
<div id="license" xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/"><span property="dct:title">Ape-Iron</span> is licensed under <a href="http://creativecommons.org/licenses/by-sa/4.0/?ref=chooser-v1" rel="license noopener noreferrer" style="display:inline-block;" target="_blank">CC BY-SA 4.0 <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"><img src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1"></a></div>
</footer>
</div>
<script src="../../assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script></div>
</body>
</html>
