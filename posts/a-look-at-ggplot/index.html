<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="A look at ggplot." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>A Look At ggplot | Bowling For Data</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="../../rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Bowling-For-Data/posts/a-look-at-ggplot/index.html" rel="canonical"><!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]-->
<meta content="The Cloistered Monkey" name="author">
<link href="../nypd-shooting-incident-data/index.html" rel="prev" title="NYPD Shooting Incident Data" type="text/html">
<link href="../r-for-data-science/index.html" rel="next" title="R For Data Science" type="text/html">
<meta content="Bowling For Data" property="og:site_name">
<meta content="A Look At ggplot" property="og:title">
<meta content="https://necromuralist.github.io/Bowling-For-Data/posts/a-look-at-ggplot/index.html" property="og:url">
<meta content="A look at ggplot." property="og:description">
<meta content="article" property="og:type">
<meta content="2021-12-13T14:34:19-08:00" property="article:published_time">
<meta content="ggplot" property="article:tag">
<meta content="r" property="article:tag">
<meta content="visualization" property="article:tag">
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="../../"><span id="blog-title">Bowling For Data</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="../../pages/">Pages</a></li>
<li class="nav-item"><a class="nav-link" href="../../archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="../../categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="../../rss.xml">RSS feed</a></li>
<li class="nav-item dropdown"><a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Monkey Pages</a>
<div class="dropdown-menu"><a class="dropdown-item" href="https://necromuralist.github.io/">The Cloistered Monkey</a> <a class="dropdown-item" href="https://necromuralist.github.io/Ape-Iron/">Ape Iron</a> <a class="dropdown-item" href="https://necromuralist.github.io/Beach-Pig-Thigh/">Beach-Pig Rump & Thigh</a> <a class="dropdown-item" href="https://necromuralist.github.io/Neurotic-Networking/">Neurotic Networking</a> <a class="dropdown-item" href="https://necromuralist.github.io/Terribilis-Ludum/">Terribilis Ludum</a> <a class="dropdown-item" href="https://necromuralist.github.io/Visions-Voices-Data/">Visions, Voices, Data</a></div>
</li>
</ul>
<!-- DuckDuckGo custom search -->
<form action="https://duckduckgo.com/" class="navbar-form pull-left" id="search" method="get" name="search"><input name="sites" type="hidden" value="https://necromuralist.github.io/Bowling-For-Data/"><input name="k8" type="hidden" value="#444444"><input name="k9" type="hidden" value="#D51920"><input name="kt" type="hidden" value="h"><input class="span2" maxlength="255" name="q" placeholder="Searchâ€¦" style="margin-top: 4px;" type="text"><input style="visibility: hidden;" type="submit" value="DuckDuckGo Search"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right">
<li class="nav-item"><a class="nav-link" href="index.org" id="sourcelink">Source</a></li>
</ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title" itemprop="headline name"><a class="u-url" href="#">A Look At ggplot</a></h1>
<div class="metadata">
<p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="#" rel="bookmark"><time class="published dt-published" datetime="2021-12-13T14:34:19-08:00" itemprop="datePublished" title="2021-12-13 14:34">2021-12-13 14:34</time></a></p>
<p class="sourceline"><a class="sourcelink" href="index.org">Source</a></p>
</div>
</header>
<div class="e-content entry-content" itemprop="articleBody text">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="index.html#org72f76ba">Introduction</a></li>
<li><a href="index.html#orgfac81e7">Set Up Stuff</a>
<ul>
<li><a href="index.html#org54b53f8">Imports</a></li>
<li><a href="index.html#orga77a128">Constants</a></li>
<li><a href="index.html#org2bc5e3f">The GGPlot2 Theme</a></li>
</ul>
</li>
<li><a href="index.html#orgabb7a30">The MPG Dataset</a>
<ul>
<li><a href="index.html#orgb5ef995">The Variables</a></li>
<li><a href="index.html#org616a5e2">Renaming Some Columns</a></li>
<li><a href="index.html#orgb5a65ba">Looking at the Data</a></li>
<li><a href="index.html#org311cc30">Some Renaming</a>
<ul>
<li><a href="index.html#org83a3f84">The Drive Trains</a></li>
<li><a href="index.html#org2b5c419">Fuel Types</a></li>
<li><a href="index.html#org26a7eec">Transmission</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="index.html#orga8a93f9">Displacement Vs Highway Mileage</a></li>
<li><a href="index.html#org865a3b8">Ditching the Highway (Mileage)</a>
<ul>
<li><a href="index.html#orgdb85834">Combined Mileage</a></li>
<li><a href="index.html#orgc5c95b3">Comparing the Two</a></li>
<li><a href="index.html#orgc3571ed">Gallons Per Mile</a></li>
</ul>
</li>
<li><a href="index.html#org951f1ce">Displacement With Class</a>
<ul>
<li><a href="index.html#org62f681a">Efficiency</a></li>
<li><a href="index.html#org8fa6ab1">Faceting The Classes</a></li>
<li><a href="index.html#org169a75d">Smoothing the Line</a></li>
<li><a href="index.html#org7531845">Different Datasets to the Geometries</a></li>
<li><a href="index.html#org0dc1fcd">Small Four-Wheel Drive Automobiles</a></li>
</ul>
</li>
<li><a href="index.html#org597e438">Bar Plots</a>
<ul>
<li><a href="index.html#org8f1c12a">By Count</a></li>
<li><a href="index.html#org2231a04">By Proportion</a></li>
<li><a href="index.html#orgb6b544f">Un-Stacked</a></li>
<li><a href="index.html#org2edbb30">Proportions Not Counts</a></li>
</ul>
</li>
<li><a href="index.html#org9667a4c">Stat Summary</a>
<ul>
<li><a href="index.html#org842385e">Boxplot</a></li>
</ul>
</li>
<li><a href="index.html#org449a289">The End</a></li>
<li><a href="index.html#org45647f2">Link Collection</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org72f76ba">
<h2 id="org72f76ba">Introduction</h2>
<div class="outline-text-2" id="text-org72f76ba">
<p>This is a quick walk-through of some aspects of <a href="https://ggplot2.tidyverse.org/">ggplot2</a> based on the first chapter of {% doc %}r-for-data-science{% /doc %}.</p>
</div>
</div>
<div class="outline-2" id="outline-container-orgfac81e7">
<h2 id="orgfac81e7">Set Up Stuff</h2>
<div class="outline-text-2" id="text-orgfac81e7"></div>
<div class="outline-3" id="outline-container-org54b53f8">
<h3 id="org54b53f8">Imports</h3>
<div class="outline-text-3" id="text-org54b53f8">
<p><b>Note:</b> When you run the first code block to start the session, remember to give it the path to the posts-output folder so you don't need the path when saving the plots.</p>
<div class="highlight">
<pre><span></span><span class="nf">library</span><span class="p">(</span><span class="s">"assertthat"</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="s">"ggplot2"</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="s">"knitr"</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="s">"tidyverse"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orga77a128">
<h3 id="orga77a128">Constants</h3>
<div class="outline-text-3" id="text-orga77a128">
<p>These are stuff that get re-used in the plotting.</p>
<div class="highlight">
<pre><span></span><span class="n">DISPLACEMENT</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">"Engine Displacement (Liters)"</span>
<span class="n">EFFICIENCY</span><span class="w"> </span><span class="o">&lt;-</span><span class="s">"Gallons Per Mile (Combined)"</span>
<span class="n">DISPLACEMENT_VS_EFFICIENCY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">partial</span><span class="p">(</span><span class="n">labs</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="n">DISPLACEMENT</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">EFFICIENCY</span><span class="p">)</span>

<span class="n">BLUE</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">"#4687b7"</span>
<span class="n">RED</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">"#ce7b6d"</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org2bc5e3f">
<h3 id="org2bc5e3f">The GGPlot2 Theme</h3>
<div class="outline-text-3" id="text-org2bc5e3f">
<div class="highlight">
<pre><span></span><span class="nf">theme_set</span><span class="p">(</span><span class="nf">theme_minimal</span><span class="p">(</span><span class="n">base_family</span><span class="o">=</span><span class="s">"Palatino"</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgabb7a30">
<h2 id="orgabb7a30">The MPG Dataset</h2>
<div class="outline-text-2" id="text-orgabb7a30">
<p>For some reason loading <code>ggplot2</code> also loads this dataset. Its short description is "Fuel economy data from 1999 to 2008 for 38 popular models of cars". The long description:</p>
<blockquote>
<p>This dataset contains a subset of the fuel economy data that the EPA makes available on &lt;URL: <a href="https://fueleconomy.gov/">https://fueleconomy.gov/</a>&gt;. It contains only models which had a new release every year between 1999 and 2008 - this was used as a proxy for the popularity of the car.</p>
</blockquote>
</div>
<div class="outline-3" id="outline-container-orgb5ef995">
<h3 id="orgb5ef995">The Variables</h3>
<div class="outline-text-3" id="text-orgb5ef995">
<p>It's a data frame with 234 rows and 11 variables:</p>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Variable</th>
<th class="org-left" scope="col">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">manufacturer</td>
<td class="org-left">manufacturer name</td>
</tr>
<tr>
<td class="org-left">model</td>
<td class="org-left">model name</td>
</tr>
<tr>
<td class="org-left">displ</td>
<td class="org-left">engine displacement, in litres</td>
</tr>
<tr>
<td class="org-left">year</td>
<td class="org-left">year of manufacture</td>
</tr>
<tr>
<td class="org-left">cyl</td>
<td class="org-left">number of cylinders</td>
</tr>
<tr>
<td class="org-left">trans</td>
<td class="org-left">type of transmission</td>
</tr>
<tr>
<td class="org-left">drv</td>
<td class="org-left">drive train (<a href="index.html#org83a3f84">listed below</a>)</td>
</tr>
<tr>
<td class="org-left">cty</td>
<td class="org-left">city miles per gallon</td>
</tr>
<tr>
<td class="org-left">hwy</td>
<td class="org-left">highway miles per gallon</td>
</tr>
<tr>
<td class="org-left">fl</td>
<td class="org-left">fuel type</td>
</tr>
<tr>
<td class="org-left">class</td>
<td class="org-left">"type" of car</td>
</tr>
</tbody>
</table>
<p>I'll do some column renaming here since I keep forgetting what abbreviations they used.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org616a5e2">
<h3 id="org616a5e2">Renaming Some Columns</h3>
<div class="outline-text-3" id="text-org616a5e2">
<div class="highlight">
<pre><span></span><span class="n">mpg</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mpg</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">rename</span><span class="p">(</span>
<span class="w">    </span><span class="n">displacement</span><span class="o">=</span><span class="n">displ</span><span class="p">,</span>
<span class="w">    </span><span class="n">cylinders</span><span class="o">=</span><span class="n">cyl</span><span class="p">,</span>
<span class="w">    </span><span class="n">transmission</span><span class="o">=</span><span class="n">trans</span><span class="p">,</span>
<span class="w">    </span><span class="n">drive_train</span><span class="o">=</span><span class="n">drv</span><span class="p">,</span>
<span class="w">    </span><span class="n">city_mpg</span><span class="o">=</span><span class="n">cty</span><span class="p">,</span>
<span class="w">    </span><span class="n">highway_mpg</span><span class="o">=</span><span class="n">hwy</span><span class="p">,</span>
<span class="w">    </span><span class="n">fuel_type</span><span class="o">=</span><span class="n">fl</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>

<span class="nf">str</span><span class="p">(</span><span class="n">mpg</span><span class="p">)</span>
</pre></div>
<pre class="example" id="orgc3667dc">
tibble [234 Ã— 11] (S3: tbl_df/tbl/data.frame)
 $ manufacturer: chr [1:234] "audi" "audi" "audi" "audi" ...
 $ model       : chr [1:234] "a4" "a4" "a4" "a4" ...
 $ displacement: num [1:234] 1.8 1.8 2 2 2.8 2.8 3.1 1.8 1.8 2 ...
 $ year        : int [1:234] 1999 1999 2008 2008 1999 1999 2008 1999 1999 2008 ...
 $ cylinders   : int [1:234] 4 4 4 4 6 6 6 4 4 4 ...
 $ transmission: chr [1:234] "auto(l5)" "manual(m5)" "manual(m6)" "auto(av)" ...
 $ drive_train : chr [1:234] "f" "f" "f" "f" ...
 $ city_mpg    : int [1:234] 18 21 20 21 16 18 18 18 16 20 ...
 $ highway_mpg : int [1:234] 29 29 31 30 26 26 27 26 25 28 ...
 $ fuel_type   : chr [1:234] "p" "p" "p" "p" ...
 $ class       : chr [1:234] "compact" "compact" "compact" "compact" ...
</pre></div>
</div>
<div class="outline-3" id="outline-container-orgb5a65ba">
<h3 id="orgb5a65ba">Looking at the Data</h3>
<div class="outline-text-3" id="text-orgb5a65ba">
<div class="highlight">
<pre><span></span><span class="nf">kable</span><span class="p">(</span><span class="nf">head</span><span class="p">(</span><span class="n">mpg</span><span class="p">),</span><span class="w"> </span><span class="n">caption</span><span class="o">=</span><span class="s">"MPG Dataset (EPA Automobile Data)"</span><span class="p">)</span>
</pre></div>
<p>Table: MPG Dataset (EPA Automobile Data)</p>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">manufacturer</th>
<th class="org-left" scope="col">model</th>
<th class="org-right" scope="col">displacement</th>
<th class="org-right" scope="col">year</th>
<th class="org-right" scope="col">cylinders</th>
<th class="org-left" scope="col">transmission</th>
<th class="org-left" scope="col">drive_train</th>
<th class="org-right" scope="col">city_mpg</th>
<th class="org-right" scope="col">highway_mpg</th>
<th class="org-left" scope="col">fuel_type</th>
<th class="org-left" scope="col">class</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">audi</td>
<td class="org-left">a4</td>
<td class="org-right">1.8</td>
<td class="org-right">1999</td>
<td class="org-right">4</td>
<td class="org-left">auto(l5)</td>
<td class="org-left">f</td>
<td class="org-right">18</td>
<td class="org-right">29</td>
<td class="org-left">p</td>
<td class="org-left">compact</td>
</tr>
<tr>
<td class="org-left">audi</td>
<td class="org-left">a4</td>
<td class="org-right">1.8</td>
<td class="org-right">1999</td>
<td class="org-right">4</td>
<td class="org-left">manual(m5)</td>
<td class="org-left">f</td>
<td class="org-right">21</td>
<td class="org-right">29</td>
<td class="org-left">p</td>
<td class="org-left">compact</td>
</tr>
<tr>
<td class="org-left">audi</td>
<td class="org-left">a4</td>
<td class="org-right">2.0</td>
<td class="org-right">2008</td>
<td class="org-right">4</td>
<td class="org-left">manual(m6)</td>
<td class="org-left">f</td>
<td class="org-right">20</td>
<td class="org-right">31</td>
<td class="org-left">p</td>
<td class="org-left">compact</td>
</tr>
<tr>
<td class="org-left">audi</td>
<td class="org-left">a4</td>
<td class="org-right">2.0</td>
<td class="org-right">2008</td>
<td class="org-right">4</td>
<td class="org-left">auto(av)</td>
<td class="org-left">f</td>
<td class="org-right">21</td>
<td class="org-right">30</td>
<td class="org-left">p</td>
<td class="org-left">compact</td>
</tr>
<tr>
<td class="org-left">audi</td>
<td class="org-left">a4</td>
<td class="org-right">2.8</td>
<td class="org-right">1999</td>
<td class="org-right">6</td>
<td class="org-left">auto(l5)</td>
<td class="org-left">f</td>
<td class="org-right">16</td>
<td class="org-right">26</td>
<td class="org-left">p</td>
<td class="org-left">compact</td>
</tr>
<tr>
<td class="org-left">audi</td>
<td class="org-left">a4</td>
<td class="org-right">2.8</td>
<td class="org-right">1999</td>
<td class="org-right">6</td>
<td class="org-left">manual(m5)</td>
<td class="org-left">f</td>
<td class="org-right">18</td>
<td class="org-right">26</td>
<td class="org-left">p</td>
<td class="org-left">compact</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-3" id="outline-container-org311cc30">
<h3 id="org311cc30">Some Renaming</h3>
<div class="outline-text-3" id="text-org311cc30"></div>
<div class="outline-4" id="outline-container-org83a3f84">
<h4 id="org83a3f84">The Drive Trains</h4>
<div class="outline-text-4" id="text-org83a3f84">
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Abbreviation</th>
<th class="org-left" scope="col">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">f</td>
<td class="org-left">Front-Wheel Drive</td>
</tr>
<tr>
<td class="org-left">r</td>
<td class="org-left">Rear-Wheel Drive</td>
</tr>
<tr>
<td class="org-left">4</td>
<td class="org-left">Four-Wheel Drive</td>
</tr>
</tbody>
</table>
<p>These aren't too obscure, but I think I'll rename them anyway.</p>
<div class="highlight">
<pre><span></span><span class="n">mpg</span><span class="o">$</span><span class="n">drive_train</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">recode</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">drive_train</span><span class="p">,</span>
<span class="w">                          </span><span class="n">f</span><span class="o">=</span><span class="s">"Front-Wheel"</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="o">=</span><span class="s">"Rear-Wheel"</span><span class="p">,</span><span class="w"> </span><span class="n">`4`</span><span class="o">=</span><span class="s">"Four-Wheel"</span><span class="w"> </span><span class="p">)</span>
<span class="nf">kable</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">drive_train</span><span class="p">),</span><span class="w"> </span><span class="n">col.names</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">"Drives"</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Drives</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Front-Wheel</td>
</tr>
<tr>
<td class="org-left">Four-Wheel</td>
</tr>
<tr>
<td class="org-left">Rear-Wheel</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="nf">assert_that</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">drive_train</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org2b5c419">
<h4 id="org2b5c419">Fuel Types</h4>
<div class="outline-text-4" id="text-org2b5c419">
<p>Although this is about <code>ggplot2</code>, and the data is sort of a side effect, since I had to look some of this data up to figure out what it meant (at <a href="https://www.fueleconomy.gov/">fueleconomy.gov</a>) I'll use this opportunity to document it by updating the data.</p>
<div class="highlight">
<pre><span></span><span class="n">mpg</span><span class="o">$</span><span class="n">fuel_type</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">recode</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">fuel_type</span><span class="p">,</span>
<span class="w">                        </span><span class="n">p</span><span class="o">=</span><span class="s">"Premium Unleaded"</span><span class="p">,</span>
<span class="w">                        </span><span class="n">r</span><span class="o">=</span><span class="s">"Regular Unleaded"</span><span class="p">,</span>
<span class="w">                        </span><span class="n">e</span><span class="o">=</span><span class="s">"Ethanol"</span><span class="p">,</span>
<span class="w">                        </span><span class="n">d</span><span class="o">=</span><span class="s">"Diesel Fuel"</span><span class="p">,</span>
<span class="w">                        </span><span class="n">c</span><span class="o">=</span><span class="s">"Compressed Natural Gas"</span><span class="p">)</span>

<span class="nf">kable</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">fuel_type</span><span class="p">),</span><span class="w"> </span><span class="n">col.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">"Fuel Type"</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Fuel Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Premium Unleaded</td>
</tr>
<tr>
<td class="org-left">Regular Unleaded</td>
</tr>
<tr>
<td class="org-left">Ethanol</td>
</tr>
<tr>
<td class="org-left">Diesel Fuel</td>
</tr>
<tr>
<td class="org-left">Compressed Natural Gas</td>
</tr>
</tbody>
</table>
<p>For some reason I couldn't find a table that directly mapped to the data set so I'm sort of guessing that this is what they stood for based on the 1999 guide on their <a href="https://www.fueleconomy.gov/feg/download.shtml">download page</a>. There's also a <code>L</code> for <b>Liquified Petroleum Gas (Propane)</b> in the guide but it's not in the data set.</p>
<div class="highlight">
<pre><span></span><span class="nf">assert_that</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">fuel_type</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org26a7eec">
<h4 id="org26a7eec">Transmission</h4>
<div class="outline-text-4" id="text-org26a7eec">
<div class="highlight">
<pre><span></span><span class="n">mpg</span><span class="o">$</span><span class="n">transmission</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">recode</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">transmission</span><span class="p">,</span>
<span class="w">                           </span><span class="n">`auto(av)`</span><span class="o">=</span><span class="s">"Continuously Variable"</span><span class="p">,</span>
<span class="w">                           </span><span class="n">`auto(s4)`</span><span class="o">=</span><span class="s">"Automatic 4-Speed"</span><span class="p">,</span>
<span class="w">                           </span><span class="n">`auto(s5)`</span><span class="o">=</span><span class="s">"Automatic 5-Speed"</span><span class="p">,</span>
<span class="w">                           </span><span class="n">`auto(s6)`</span><span class="o">=</span><span class="s">"Automatic 6-Speed"</span><span class="p">,</span>
<span class="w">                           </span><span class="n">`auto(l3)`</span><span class="o">=</span><span class="s">"Automatic Lockup 3-Speed"</span><span class="p">,</span>
<span class="w">                           </span><span class="n">`auto(l4)`</span><span class="o">=</span><span class="s">"Automatic Lockup 4-Speed"</span><span class="p">,</span>
<span class="w">                           </span><span class="n">`auto(l5)`</span><span class="o">=</span><span class="s">"Automatic Lockup 5-Speed"</span><span class="p">,</span>
<span class="w">                           </span><span class="n">`auto(l6)`</span><span class="o">=</span><span class="s">"Automatic Lockup 6-Speed"</span><span class="p">,</span>
<span class="w">                           </span><span class="n">`manual(m5)`</span><span class="o">=</span><span class="s">"Manual 5-Speed"</span><span class="p">,</span>
<span class="w">                           </span><span class="n">`manual(m6)`</span><span class="o">=</span><span class="s">"Manual 6-Speed"</span>
<span class="w">                           </span><span class="p">)</span>

<span class="nf">kable</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">transmission</span><span class="p">),</span><span class="w"> </span><span class="n">col.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">"Transmission"</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Transmission</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Automatic Lockup 5-Speed</td>
</tr>
<tr>
<td class="org-left">Manual 5-Speed</td>
</tr>
<tr>
<td class="org-left">Manual 6-Speed</td>
</tr>
<tr>
<td class="org-left">Continuously Variable</td>
</tr>
<tr>
<td class="org-left">Automatic 6-Speed</td>
</tr>
<tr>
<td class="org-left">Automatic Lockup 4-Speed</td>
</tr>
<tr>
<td class="org-left">Automatic Lockup 3-Speed</td>
</tr>
<tr>
<td class="org-left">Automatic Lockup 6-Speed</td>
</tr>
<tr>
<td class="org-left">Automatic 5-Speed</td>
</tr>
<tr>
<td class="org-left">Automatic 4-Speed</td>
</tr>
</tbody>
</table>
<p>Strangely, there's no listing for 4-speed manual transmissions.</p>
<div class="highlight">
<pre><span></span><span class="nf">assert_that</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">transmission</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orga8a93f9">
<h2 id="orga8a93f9">Displacement Vs Highway Mileage</h2>
<div class="outline-text-2" id="text-orga8a93f9">
<p>Now we come to the basic thing that the chapter in <code>R For Data Science</code> looks at (mostly) - what affects mileage for automobiles. The first thing we'll do is look at how the size of the engine affects the mileage.</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displacement</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">highway_mpg</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">highway_mpg</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">DISPLACEMENT</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">"Highway MPG"</span><span class="p">,</span>
<span class="w">       </span><span class="n">title</span><span class="o">=</span><span class="s">"Displacement vs Mileage"</span><span class="p">)</span>

<span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"displacement_vs_mileage.png"</span>
<span class="nf">ggsave</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="displacement_vs_mileage.png"></p>
<p>It has a roughly linear relationship, as you might expect, but the rest of this post is about how to get more information out of the data using <code>ggplot2</code>.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org865a3b8">
<h2 id="org865a3b8">Ditching the Highway (Mileage)</h2>
<div class="outline-text-2" id="text-org865a3b8"></div>
<div class="outline-3" id="outline-container-orgdb85834">
<h3 id="orgdb85834">Combined Mileage</h3>
<div class="outline-text-3" id="text-orgdb85834">
<p>The EPA uses a weighted average to create a combined metric that uses both Highway and City mileage.</p>
<p>\[ \textrm{Combined Fuel Economy} = 0.55 \times \textit{city} + 0.45 \times \textit{highway} \]</p>
<p>I've also seen it done as the harmonic mean (<a href="https://tasks.illustrativemathematics.org/content-standards/tasks/825">on Illustrative Mathematics</a>), but if you round to the nearest whole number it comes out about the same.</p>
<div class="highlight">
<pre><span></span><span class="n">mpg</span><span class="o">$</span><span class="n">combined_fuel_economy</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.55</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">mpg</span><span class="o">$</span><span class="n">city_mpg</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0.45</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">mpg</span><span class="o">$</span><span class="n">highway_mpg</span>

<span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displacement</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">combined_fuel_economy</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">combined_fuel_economy</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">DISPLACEMENT</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">"Combined MPG"</span><span class="p">,</span>
<span class="w">       </span><span class="n">title</span><span class="o">=</span><span class="s">"Displacement vs Mileage"</span><span class="p">)</span>

<span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"displacement_vs_combined_mileage.png"</span>
<span class="nf">ggsave</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="displacement_vs_combined_mileage.png"></p>
</div>
</div>
<div class="outline-3" id="outline-container-orgc5c95b3">
<h3 id="orgc5c95b3">Comparing the Two</h3>
<div class="outline-text-3" id="text-orgc5c95b3">
<p>We can plot them together to see how much the combined MPG differs from the highway MPG.</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_smooth</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displacement</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">combined_fuel_economy</span><span class="p">),</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s">"red"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_smooth</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displacement</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">highway_mpg</span><span class="p">),</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s">"blue"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">DISPLACEMENT</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">"MPG"</span><span class="p">,</span>
<span class="w">       </span><span class="n">title</span><span class="o">=</span><span class="s">"Displacement vs Mileage (Highway and Combined)"</span><span class="p">)</span>

<span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"highway_vs_combined_mileage.png"</span>
<span class="nf">ggsave</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="highway_vs_combined_mileage.png"></p>
<p>Adding the city mileage drops the mileage somewhat, although the line looks to be about the same shape.</p>
</div>
</div>
<div class="outline-3" id="outline-container-orgc3571ed">
<h3 id="orgc3571ed">Gallons Per Mile</h3>
<div class="outline-text-3" id="text-orgc3571ed">
<p>The EPA's explanation of their <a href="https://www.epa.gov/fueleconomy/text-version-gasoline-label">vehicle labels</a> mentions that the reason why they put a <b>Fuel Consumption Rate</b> is that the <b>Miles Per Gallon</b> metric is actually not a good way to compare mileage - it is subject to a "Miles Per Gallon Illusion" (<a href="https://www.realclearscience.com/blog/2019/02/14/the_miles_per_gallon_illusion.html#!">ReaClearScience</a> has an article about it). Here's how the number of gallons used per 1,000 miles driven changes with miles-per-gallon.</p>
<div class="highlight">
<pre><span></span><span class="n">mileage</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">)</span>
<span class="n">miles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000</span>
<span class="n">gallons_per_1000_miles</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">miles</span><span class="o">/</span><span class="n">mileage</span>

<span class="n">improvement</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">MPG</span><span class="o">=</span><span class="n">mileage</span><span class="p">,</span>
<span class="w">                          </span><span class="n">gallons</span><span class="o">=</span><span class="n">gallons_per_1000_miles</span><span class="p">)</span>
<span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">improvement</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">mileage</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">gallons</span><span class="p">),</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s">"blue"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_line</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">mileage</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">gallons</span><span class="p">),</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s">"blue"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Fuel Consumption vs MPG"</span><span class="p">,</span>
<span class="w">       </span><span class="n">x</span><span class="o">=</span><span class="s">"Miles Per Gallon"</span><span class="p">,</span>
<span class="w">       </span><span class="n">y</span><span class="o">=</span><span class="s">"Gallons Used Per 1,000 Miles"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"gallons_vs_mpg.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="gallons_vs_mpg.png"></p>
<p>As you can see the improvement in the number of gallons used goes down pretty fast as the miles-per-gallon goes up. Let's see about adding a fuel-efficency column. What happens when you switch to Gallons Per Mile?</p>
<div class="highlight">
<pre><span></span><span class="n">gallons_per_mile</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mileage</span>
<span class="n">gallons_per_1000_miles</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">miles</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gallons_per_mile</span>

<span class="n">improvement</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">gpm</span><span class="o">=</span><span class="n">gallons_per_mile</span><span class="p">,</span>
<span class="w">                          </span><span class="n">gallons</span><span class="o">=</span><span class="n">gallons_per_1000_miles</span><span class="p">)</span>
<span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">improvement</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">gpm</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">gallons</span><span class="p">),</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s">"blue"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_line</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">gpm</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">gallons</span><span class="p">),</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s">"blue"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Fuel Consumption vs Gallons Per Mile"</span><span class="p">,</span>
<span class="w">       </span><span class="n">x</span><span class="o">=</span><span class="s">"Gallons Per Mile"</span><span class="p">,</span>
<span class="w">       </span><span class="n">y</span><span class="o">=</span><span class="s">"Gallons Used Per 1,000 Miles"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"gallons_vs_efficiency.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="gallons_vs_efficiency.png"></p>
<p>I suppose you could just figure that that'd be the case, but this <i>is</i> about plotting.</p>
<div class="highlight">
<pre><span></span><span class="n">mpg</span><span class="o">$</span><span class="n">gallons_per_mile</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="n">mpg</span><span class="o">$</span><span class="n">combined_fuel_economy</span>

<span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displacement</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">gallons_per_mile</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">DISPLACEMENT_VS_EFFICIENCY</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Displacement vs Fuel Efficiency"</span><span class="p">)</span>

<span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"displacement_vs_fuel_efficiency.png"</span>
<span class="nf">ggsave</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="displacement_vs_fuel_efficiency.png"></p>
<p>Even though this is just the inverse of the MPG plot it seems more intuitive to me. I didn't really notice that big outlier at the top when I plotted it using MPG, so I think I'll stick with this.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org951f1ce">
<h2 id="org951f1ce">Displacement With Class</h2>
<div class="outline-text-2" id="text-org951f1ce">
<p>The displacement seems to mostly have a linear relationship with mileage, but there's exceptions, let's see if showing the class of the car reveals any interesting patterns.</p>
<div class="highlight">
<pre><span></span><span class="nf">unique</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">class</span><span class="p">)</span>
</pre></div>
<pre class="example">
[1] "compact"    "midsize"    "suv"        "2seater"    "minivan"   
[6] "pickup"     "subcompact"
</pre></div>
<div class="outline-3" id="outline-container-org62f681a">
<h3 id="org62f681a">Efficiency</h3>
<div class="outline-text-3" id="text-org62f681a">
<div class="highlight">
<pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displacement</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">gallons_per_mile</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">class</span><span class="p">),</span>
<span class="w">             </span><span class="n">position</span><span class="o">=</span><span class="s">"jitter"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">DISPLACEMENT_VS_EFFICIENCY</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Displacement vs Fuel Efficiency"</span><span class="p">)</span>

<span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"displacement_vs_mileage_with_class.png"</span>
<span class="nf">ggsave</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="displacement_vs_mileage_with_class.png"></p>
<p>I added a little jitter because it looked like the top outlier was just one point. It looks like 2-seaters and one of the mid-sized cars had unusually good mileage given their engine displacement. What's a two-seater?</p>
<div class="highlight">
<pre><span></span><span class="nf">kable</span><span class="p">(</span><span class="nf">filter</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">class</span><span class="o">==</span><span class="s">"2seater"</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">manufacturer</th>
<th class="org-left" scope="col">model</th>
<th class="org-right" scope="col">displacement</th>
<th class="org-right" scope="col">year</th>
<th class="org-right" scope="col">cylinders</th>
<th class="org-left" scope="col">transmission</th>
<th class="org-left" scope="col">drive_train</th>
<th class="org-right" scope="col">city_mpg</th>
<th class="org-right" scope="col">highway_mpg</th>
<th class="org-left" scope="col">fuel_type</th>
<th class="org-left" scope="col">class</th>
<th class="org-right" scope="col">combined_fuel_economy</th>
<th class="org-right" scope="col">gallons_per_mile</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">chevrolet</td>
<td class="org-left">corvette</td>
<td class="org-right">5.7</td>
<td class="org-right">1999</td>
<td class="org-right">8</td>
<td class="org-left">Manual 6-Speed</td>
<td class="org-left">Rear-Wheel</td>
<td class="org-right">16</td>
<td class="org-right">26</td>
<td class="org-left">Premium Unleaded</td>
<td class="org-left">2seater</td>
<td class="org-right">20.50</td>
<td class="org-right">0.0487805</td>
</tr>
<tr>
<td class="org-left">chevrolet</td>
<td class="org-left">corvette</td>
<td class="org-right">5.7</td>
<td class="org-right">1999</td>
<td class="org-right">8</td>
<td class="org-left">Automatic Lockup 4-Speed</td>
<td class="org-left">Rear-Wheel</td>
<td class="org-right">15</td>
<td class="org-right">23</td>
<td class="org-left">Premium Unleaded</td>
<td class="org-left">2seater</td>
<td class="org-right">18.60</td>
<td class="org-right">0.0537634</td>
</tr>
<tr>
<td class="org-left">chevrolet</td>
<td class="org-left">corvette</td>
<td class="org-right">6.2</td>
<td class="org-right">2008</td>
<td class="org-right">8</td>
<td class="org-left">Manual 6-Speed</td>
<td class="org-left">Rear-Wheel</td>
<td class="org-right">16</td>
<td class="org-right">26</td>
<td class="org-left">Premium Unleaded</td>
<td class="org-left">2seater</td>
<td class="org-right">20.50</td>
<td class="org-right">0.0487805</td>
</tr>
<tr>
<td class="org-left">chevrolet</td>
<td class="org-left">corvette</td>
<td class="org-right">6.2</td>
<td class="org-right">2008</td>
<td class="org-right">8</td>
<td class="org-left">Automatic 6-Speed</td>
<td class="org-left">Rear-Wheel</td>
<td class="org-right">15</td>
<td class="org-right">25</td>
<td class="org-left">Premium Unleaded</td>
<td class="org-left">2seater</td>
<td class="org-right">19.50</td>
<td class="org-right">0.0512821</td>
</tr>
<tr>
<td class="org-left">chevrolet</td>
<td class="org-left">corvette</td>
<td class="org-right">7.0</td>
<td class="org-right">2008</td>
<td class="org-right">8</td>
<td class="org-left">Manual 6-Speed</td>
<td class="org-left">Rear-Wheel</td>
<td class="org-right">15</td>
<td class="org-right">24</td>
<td class="org-left">Premium Unleaded</td>
<td class="org-left">2seater</td>
<td class="org-right">19.05</td>
<td class="org-right">0.0524934</td>
</tr>
</tbody>
</table>
<p>Just Corvettes here.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org8fa6ab1">
<h3 id="org8fa6ab1">Faceting The Classes</h3>
<div class="outline-text-3" id="text-org8fa6ab1">
<p>While the use of color is useful for comparing the classes on the same plot, sometimes it can be easier to interpret plots that have the categorical classes separated into sub-plots (called <b>facets</b>).</p>
<p>By default the faceting functions use aphabetical order, I'm going to use a slightly different ordering to see if it makes it clearer how the classes compare (this is based on the medians that I plotted <a href="index.html#org9667a4c">below</a>).</p>
<div class="highlight">
<pre><span></span><span class="n">mpg</span><span class="o">$</span><span class="n">class_order</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">class</span><span class="p">,</span>
<span class="w">                          </span><span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">"compact"</span><span class="p">,</span><span class="w"> </span><span class="s">"subcompact"</span><span class="p">,</span><span class="w"> </span><span class="s">"midsize"</span><span class="p">,</span>
<span class="w">                                   </span><span class="s">"2seater"</span><span class="p">,</span>
<span class="w">                                   </span><span class="s">"minivan"</span><span class="p">,</span><span class="w"> </span><span class="s">"suv"</span><span class="p">,</span><span class="w"> </span><span class="s">"pickup"</span><span class="p">))</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displacement</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">gallons_per_mile</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">gallons_per_mile</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">facet_grid</span><span class="p">(</span><span class="n">.</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">class_order</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">  </span><span class="nf">DISPLACEMENT_VS_EFFICIENCY</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Displacement vs Efficiency"</span><span class="p">)</span>

<span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"displacement_vs_mileage_faceted_classes.png"</span>
<span class="nf">ggsave</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
<p>I'm using <code>facet_grid</code> here, which is actually meant to use two variables (creating row and column separation). By putting the <code>.</code> before the <code>~</code> we're telling it to only facet using columns. There's also a <code>facet_wrap</code> function that only does one variable but adds the ability to specify the number of rows you want to use, which might be helpful if you have a lot of classes.</p>
<p><img alt="nil" src="displacement_vs_mileage_faceted_classes.png"></p>
<p>I wouldn't have thought it, but the Corvette falls between the minivan and the sub-compact for fuel efficiency. I guess when you consider that it can only be used to transport two people and not anything relatively large it's still inefficient, just not as much if you're only using it to commute.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org169a75d">
<h3 id="org169a75d">Smoothing the Line</h3>
<div class="outline-text-3" id="text-org169a75d">
<p>Instead of plotting a scatterpoint, you can use <code>geom_smooth</code> to fit a single line representing the trend for the data (using a linear model).</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displacement</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">gallons_per_mile</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_smooth</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">facet_grid</span><span class="p">(</span><span class="n">class_order</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">drive_train</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">DISPLACEMENT_VS_EFFICIENCY</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Displacement vs Efficiency By Type"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"displacement_vs_mileage_smooth.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="displacement_vs_mileage_smooth.png"></p>
<p>One interesting thing here is that the four-wheel-drive compact and sub-compact cars did better than some of the front-wheel drive cars in the same class.</p>
<p>If you look at the front-wheel-drive sub-compact cars you'll see that the curve-fitting can get a little funky if you're not careful.</p>
<p>Note the syntax for the plot. Before we were passing the <code>aes</code> mapping to the geometry object. You can do that here too, but if you pass it to the <code>ggplot</code> call then it will automatically apply it to all the geometries. If you wanted to then change one of them you could pass in the <code>aes</code> mapping to it and override the base mapping you gave to <code>ggplot</code>.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org7531845">
<h3 id="org7531845">Different Datasets to the Geometries</h3>
<div class="outline-text-3" id="text-org7531845">
<p>Besides passing in different <code>aes</code> mappings, you can also pass in different sub-sets of the data to each geometry (using <a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr's filter</a> to isolate the SUVs here).</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displacement</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">gallons_per_mile</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_smooth</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nf">filter</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">class</span><span class="o">==</span><span class="s">"suv"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">class</span><span class="p">),</span><span class="w"> </span><span class="n">position</span><span class="o">=</span><span class="s">"jitter"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">DISPLACEMENT_VS_EFFICIENCY</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Displacement vs Fuel Efficiency"</span><span class="p">)</span>

<span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"displacement_vs_mileage_subsets.png"</span>
<span class="nf">ggsave</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="displacement_vs_mileage_subsets.png"></p>
<p>Looking at the trend-line for <b>SUVs</b> you can see that it encompasses a surprising swath of the displacements, and it is mostly upwardly linear to begin with but then flattens out.</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span>
<span class="w">  </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mpg</span><span class="p">,</span>
<span class="w">  </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">displacement</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gallons_per_mile</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">drive_train</span><span class="p">)</span>
<span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_smooth</span><span class="p">(</span><span class="n">se</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">DISPLACEMENT_VS_EFFICIENCY</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Effect of Drive (Four, Front, or Rear) on Mileage"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"displacement_exercise_2.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="displacement_exercise_2.png"></p>
<p>It kind of looks like an emerging pattern that up to a point gasoline consumption goes up with engine size but then once a certain point is passed consumption flattens out, even as the engines get bigger.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org0dc1fcd">
<h3 id="org0dc1fcd">Small Four-Wheel Drive Automobiles</h3>
<div class="outline-text-3" id="text-org0dc1fcd">
<p>Just out of curiosity, I'd like to see what those small four-wheel drive cars are.</p>
<div class="highlight">
<pre><span></span><span class="n">small</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">displacement</span><span class="o">&lt;</span><span class="m">3</span><span class="w"> </span><span class="o">&</span><span class="w"> </span><span class="n">drive_train</span><span class="o">==</span><span class="s">"Four-Wheel"</span><span class="p">)</span>
<span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span>
<span class="w">  </span><span class="n">data</span><span class="o">=</span><span class="n">small</span><span class="p">,</span>
<span class="w">  </span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displacement</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">gallons_per_mile</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>
<span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">facet_grid</span><span class="p">(</span><span class="n">class_order</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">manufacturer</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">DISPLACEMENT_VS_EFFICIENCY</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"4WD Less Than 3 Liters"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"small_4wd.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="small_4wd.png"></p>
<p>There are only three companies making these small four-wheel-drive automobiles, with Audi being the one focused on sedans.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org597e438">
<h2 id="org597e438">Bar Plots</h2>
<div class="outline-text-2" id="text-org597e438"></div>
<div class="outline-3" id="outline-container-org8f1c12a">
<h3 id="org8f1c12a">By Count</h3>
<div class="outline-text-3" id="text-org8f1c12a">
<p>The Bar Plot is an example of what the Grammar of Graphics calls a Statistical Transformation (I guess the scatter plots are so called "Identity" transformations, but, whatever). It doesn't display the values in the data (unless you tell it to) but instead shows how often categorical values appear in the data. We can also have it set the color to create a stacked bar plot.</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_bar</span><span class="p">(</span>
<span class="w">    </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class_order</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">drive_train</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Count of Cars by Class"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="s">"Class Ordered by Median MPG"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">"Count"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"class_count.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="class_count.png"></p>
<p>So most models of car are SUVs, how disheartening. This is only a sub-set of cars, though, and it doesn't reflect sales, just model counts.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org2231a04">
<h3 id="org2231a04">By Proportion</h3>
<div class="outline-text-3" id="text-org2231a04">
<p>Instead of using counts we can use proportions to show how the sub-category portions compare across categories.</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_bar</span><span class="p">(</span>
<span class="w">    </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class_order</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">drive_train</span><span class="p">),</span>
<span class="w">    </span><span class="n">position</span><span class="o">=</span><span class="s">"fill"</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Proportion of Drives by Class"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="s">"Class Ordered by Median MPG"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">"Proportion"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"class_count_filled.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="class_count_filled.png"></p>
<p>This shows what proportion if each class of car has what type of drive.</p>
</div>
</div>
<div class="outline-3" id="outline-container-orgb6b544f">
<h3 id="orgb6b544f">Un-Stacked</h3>
<div class="outline-text-3" id="text-orgb6b544f">
<p>To make it easier to see how sub-categories compare within the class, we can change the positioning so that the bars are put side-by-side.</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_bar</span><span class="p">(</span>
<span class="w">    </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class_order</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">drive_train</span><span class="p">),</span>
<span class="w">    </span><span class="n">position</span><span class="o">=</span><span class="s">"dodge"</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Count of Model Drives by Class"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="s">"Class Ordered by Median MPG"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">"Count"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"class_count_dodged.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="class_count_dodged.png"></p>
</div>
</div>
<div class="outline-3" id="outline-container-org2edbb30">
<h3 id="org2edbb30">Proportions Not Counts</h3>
<div class="outline-text-3" id="text-org2edbb30">
<p>Our original bar graph showed the counts, but we can show the same plot using the proportion that each categories' count is of the total count as the y-axis.</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">class</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_bar</span><span class="p">(</span>
<span class="w">    </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class_order</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">..prop..</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="m">1</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Proportion of Cars by Class"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="s">"Class Ordered by Median MPG"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">"Proportion"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"class_proportion.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="class_proportion.png"></p>
<p>Two things:</p>
<ul class="org-ul">
<li>That funky <code>..prop..</code> is really how R specifies that argument</li>
<li>The <code>group=1</code> argument tells ggplot that there's only one group for the whole dataset, otherwise each category is taken as a separate group and they are all end up as 100% of their group.</li>
<li>I couldn't get ggplot to set the colors based on the class</li>
</ul>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org9667a4c">
<h2 id="org9667a4c">Stat Summary</h2>
<div class="outline-text-2" id="text-org9667a4c">
<p>This is a way to plot different kinds of summary statistics for the dataset.</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">stat_summary</span><span class="p">(</span>
<span class="w">    </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class_order</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">gallons_per_mile</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">class_order</span><span class="p">),</span>
<span class="w">    </span><span class="n">fun.min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">min</span><span class="p">,</span>
<span class="w">    </span><span class="n">fun.max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">,</span>
<span class="w">    </span><span class="n">fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">median</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Spread of Efficiency by Class"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">EFFICIENCY</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="s">"Class"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"mpg_class_spread.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="mpg_class_spread.png"></p>
</div>
<div class="outline-3" id="outline-container-org842385e">
<h3 id="org842385e">Boxplot</h3>
<div class="outline-text-3" id="text-org842385e">
<p>That was a nice clean way to show it, and it's flexible, but maybe a good old-fashioned box-plot is the best, in the end.</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_boxplot</span><span class="p">(</span>
<span class="w">    </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class_order</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">gallons_per_mile</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">class_order</span><span class="p">),</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Spread of Efficiency by Class"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">EFFICIENCY</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="s">"Class"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"mpg_class_boxplot.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="mpg_class_boxplot.png"></p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org449a289">
<h2 id="org449a289">The End</h2>
<div class="outline-text-2" id="text-org449a289">
<p>Well, that's more than enough of that. The Chapter in <a href="../r-for-data-science/index.html">R For Data Science</a> has other stuff in there, in particular there's a section on changing the coordinate system, but I think it's time to move on.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org45647f2">
<h2 id="org45647f2">Link Collection</h2>
<div class="outline-text-2" id="text-org45647f2">
<ul class="org-ul">
<li><a href="https://fueleconomy.gov/">fueleconomy.gov</a>: the federal government's site on fuel efficiency for cars sold in the United States</li>
<li><a href="https://ggplot2.tidyverse.org/">ggplot2</a> main page</li>
<li><a href="https://www.realclearscience.com/blog/2019/02/14/the_miles_per_gallon_illusion.html#!">RealClear Science</a> on the MPG Illusion</li>
<li><a href="https://cfss.uchicago.edu/notes/grammar-of-graphics/">The Grammar of Graphics:</a> This is a page on the University of Chicago's <a href="https://cfss.uchicago.edu/">Computing For Social Sciences</a> site that has an explanation of what makes up the Layered Grammar of Graphics that <code>ggplot2</code> is based on.</li>
</ul>
</div>
</div>
</div>
<aside class="postpromonav">
<nav>
<ul class="tags" itemprop="keywords">
<li><a class="tag p-category" href="../../categories/ggplot/index.html" rel="tag">ggplot</a></li>
<li><a class="tag p-category" href="../../categories/r/index.html" rel="tag">r</a></li>
<li><a class="tag p-category" href="../../categories/visualization/index.html" rel="tag">visualization</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous"><a href="../nypd-shooting-incident-data/index.html" rel="prev" title="NYPD Shooting Incident Data">Previous post</a></li>
<li class="next"><a href="../r-for-data-science/index.html" rel="next" title="R For Data Science">Next post</a></li>
</ul>
</nav>
</aside>
<script crossorigin="anonymous" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">

      MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],

            displayMath: [['$$','$$'], ['\\[','\\]']],
            processEscapes: true,
            processEnvironments: true,
        }
    });
</script></article>
<!--End of body content-->
<footer id="footer">Scribbles by <a href="mailto:cloisteredmonkey.jmark@slmail.me">The Cloistered Monkey</a> Â© 2024 - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a>
<div id="license" xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/"><span property="dct:title">Ape-Iron</span> is licensed under <a href="http://creativecommons.org/licenses/by-sa/4.0/?ref=chooser-v1" rel="license noopener noreferrer" style="display:inline-block;" target="_blank">CC BY-SA 4.0 <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"><img src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1"></a></div>
</footer>
</div>
<script src="../../assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script></div>
</body>
</html>
