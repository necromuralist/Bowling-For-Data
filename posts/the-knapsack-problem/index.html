<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="A look at the Knapsack Problem">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>The Knapsack Problem | Bowling For Data</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://necromuralist.github.io/Bowling-For-Data/posts/the-knapsack-problem/index.html">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="The Cloistered Monkey">
<link rel="prev" href="../latpaps/index.html" title="Learning Algorithms Through Programming and Problem Solving" type="text/html">
<link rel="next" href="../algorithms-illuminated-part-3/index.html" title="Algorithms Illuminated - Part III: Greedy Algorithms and Dynamic Programming" type="text/html">
<meta property="og:site_name" content="Bowling For Data">
<meta property="og:title" content="The Knapsack Problem">
<meta property="og:url" content="https://necromuralist.github.io/Bowling-For-Data/posts/the-knapsack-problem/index.html">
<meta property="og:description" content="A look at the Knapsack Problem">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2022-06-27T12:42:46-07:00">
<meta property="article:tag" content="algorithms">
<meta property="article:tag" content="dynamic programming">
<meta property="article:tag" content="optimization">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.css">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-light
bg-light
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href="../../">

            <span id="blog-title">Bowling For Data</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../pages/" class="nav-link">Pages</a>
                </li>
<li class="nav-item">
<a href="../../archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="../../categories/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="../../rss.xml" class="nav-link">RSS feed</a>
            </li>
<li class="nav-item dropdown">
<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Monkey Pages</a>
            <div class="dropdown-menu">
                    <a href="https://necromuralist.github.io/" class="dropdown-item">The Cloistered Monkey</a>
                    <a href="https://necromuralist.github.io/Ape-Iron/" class="dropdown-item">Ape Iron</a>
                    <a href="https://necromuralist.github.io/Beach-Pig-Thigh/" class="dropdown-item">Beach-Pig Rump &amp; Thigh</a>
                    <a href="https://necromuralist.github.io/Neurotic-Networking/" class="dropdown-item">Neurotic Networking</a>
                    <a href="https://necromuralist.github.io/Visions-Voices-Data/" class="dropdown-item">Visions, Voices, Data</a>
            </div>

                
            </li>
</ul>
<!-- DuckDuckGo custom search --><form method="get" id="search" action="https://duckduckgo.com/" class="navbar-form pull-left">
 <input type="hidden" name="sites" value="https://necromuralist.github.io/Bowling-For-Data/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="Searchâ€¦" class="span2" style="margin-top: 4px;"><input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
</form>
 <!-- End of custom search -->
 

            <ul class="navbar-nav navbar-right">
<li class="nav-item">
    <a href="index.org" id="sourcelink" class="nav-link">Source</a>
    </li>


                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">The Knapsack Problem</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="#" rel="bookmark">
            <time class="published dt-published" datetime="2022-06-27T12:42:46-07:00" itemprop="datePublished" title="2022-06-27 12:42">2022-06-27 12:42</time></a>
            </p>
            
        <p class="sourceline"><a href="index.org" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li>
<a href="index.html#orgb832ab1">The Knapsack Problem(s)</a>
<ul>
<li><a href="index.html#org3c58965">Imports</a></li>
<li><a href="index.html#orgf796144">Setup</a></li>
</ul>
</li>
<li>
<a href="index.html#org2fee089">The Brute Force Solution</a>
<ul>
<li><a href="index.html#org6e1bf62">An Iterative Brute-Force Version</a></li>
<li><a href="index.html#org78014c3">Checking the Brute</a></li>
<li><a href="index.html#org2474a4a">A Recursive Exhaustive Search</a></li>
<li><a href="index.html#orge5b508e">Checking The Exhaustive</a></li>
</ul>
</li>
<li>
<a href="index.html#org42ecb1c">Levitin's Memory Function</a>
<ul>
<li>
<a href="index.html#orgf41d990">Some Pseudocode</a>
<ul>
<li><a href="index.html#org763e225">The Memoizer</a></li>
<li><a href="index.html#org269333b">A Reconstructor</a></li>
</ul>
</li>
<li>
<a href="index.html#orgc7ee35b">Memory-Function Knapsack</a>
<ul>
<li><a href="index.html#org1e9c8b9">Check the table maker</a></li>
<li><a href="index.html#org9d6d0dc">Check the Final Table</a></li>
<li><a href="index.html#orgcbaece4">Check the Recovered Solution</a></li>
<li><a href="index.html#org6de6d84">Check It Against The Examples</a></li>
</ul>
</li>
<li><a href="index.html#orgb2f0f9c">Compared to the Exhaustive Search</a></li>
</ul>
</li>
<li>
<a href="index.html#orgef2acd6">Dynamic Programming</a>
<ul>
<li><a href="index.html#org2eafc33">Some Pseudocode</a></li>
<li>
<a href="index.html#org5f53537">In Python</a>
<ul>
<li><a href="index.html#org99e857b">Check the table maker</a></li>
<li><a href="index.html#org4522fa8">Check the Recovered Solution</a></li>
<li><a href="index.html#org333d286">Check It Against The Examples</a></li>
</ul>
</li>
<li><a href="index.html#org94d3175">Compared</a></li>
</ul>
</li>
<li><a href="index.html#org96ae0f4">Sources</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgb832ab1" class="outline-2">
<h2 id="orgb832ab1">The Knapsack Problem(s)</h2>
<div class="outline-text-2" id="text-orgb832ab1">
<p>
The basic premise of the <i>Knapsack Problem</i> is that we have a knapsack with a maximum capacity (<i>C</i>) and a selection of <i>n</i> items, each item having a weight (\(w_i\)) and a value (\(v_i\)), and we want to pick the items that give us the most total value without exceeding the capacity of our knapsack.
</p>

<p>
There are two forms of the problem. The first form is what <a href="../clrs/index.html">CLRS</a> 
calls the \(\textit{0-1 Knapsack Problem}\) because we can either take the item (\(1\)) or not take the item (\(0\)) as opposed to the \(\textit{Fractional Knapsack Problem}\) where the "items" are things that we can take fractional portions of (if we're loading up on spices the \(\textit{0-1}\) problem might be pre-packaged spices while the \(\textit{fractional}\) problem involves scooping spices out of the bulk bins).
</p>

<p>
Although the problems look more or less the same, the fractional problem is one that can be solved using a greedy algorithm while the 0-1 problem can fail if you use a greedy approach so the all-or-nothing version is the more interesting case and the one we'll look at here.
</p>
</div>

<div id="outline-container-org3c58965" class="outline-3">
<h3 id="org3c58965">Imports</h3>
<div class="outline-text-3" id="text-org3c58965">
<div class="highlight"><pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">attrs</span> <span class="kn">import</span> <span class="n">define</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="p">(</span><span class="n">be_below_or_equal</span><span class="p">,</span> <span class="n">contain_exactly</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span><span class="p">,</span>
		     <span class="n">raise_error</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>

<span class="kn">import</span> <span class="nn">altair</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># other monkey stuff</span>
<span class="kn">from</span> <span class="nn">graeae.visualization.altair_helpers</span> <span class="kn">import</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">save_chart</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">Timer</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgf796144" class="outline-3">
<h3 id="orgf796144">Setup</h3>
<div class="outline-text-3" id="text-orgf796144">
<div class="highlight"><pre><span></span><span class="n">Solution</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">"Solution"</span><span class="p">,</span> <span class="s2">"value inventory count"</span><span class="p">)</span>
<span class="n">TableSolution</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">"TableSolution"</span><span class="p">,</span> <span class="s2">"value inventory count table"</span><span class="p">)</span>
<span class="n">NEGATIVE_INFINITY</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">"-inf"</span><span class="p">)</span>
<span class="n">TIMER</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>

<span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"the-knapsack-problem"</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="n">output_path</span><span class="p">(</span><span class="n">SLUG</span><span class="p">)</span>
<span class="n">save_it</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">save_chart</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div id="outline-container-org2fee089" class="outline-2">
<h2 id="org2fee089">The Brute Force Solution</h2>
<div class="outline-text-2" id="text-org2fee089">
<p>
One way to find the optimal load for our knapsack is to find all the possible loads and taking the best load from those that will fit in the knapsack. This requires us to calculate the values for <a href="../number-of-subsets-in-a-set/index.html">every subset</a> of items which means we'll have to do \(2^n\) calculations.
</p>
</div>

<div id="outline-container-org6e1bf62" class="outline-3">
<h3 id="org6e1bf62">An Iterative Brute-Force Version</h3>
<div class="outline-text-3" id="text-org6e1bf62">
<p>
To have a reference solution I'll make a brute-force iterative version of the knapsack solver. This will have a greater runtime (\(n 2^n\)) but sometimes starting with something easy is useful, even if it's not the solution we ultimately want.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">brute_knapsack</span><span class="p">(</span><span class="n">capacity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">weights</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Solution</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Finds the best selection of items to maximize value</span>

<span class="sd">    Args:</span>
<span class="sd">     capacity: maximum weight allowed</span>
<span class="sd">     values: value for each item available</span>
<span class="sd">     weights: how much each item weighs</span>

<span class="sd">    Returns:</span>
<span class="sd">     best-value, count of each item, count of loops</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>

    <span class="n">number_of_items</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">number_of_items</span>
    <span class="n">best_value</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">combination</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">number_of_items</span><span class="p">)):</span>
	<span class="n">value</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">carry</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
	<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_items</span><span class="p">):</span>
	    <span class="n">increment</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">+</span> <span class="n">carry</span>
	    <span class="n">keep</span> <span class="o">=</span> <span class="n">increment</span> <span class="o">%</span> <span class="mi">2</span>
	    <span class="n">carry</span> <span class="o">=</span> <span class="n">increment</span><span class="o">//</span><span class="mi">2</span>
	    <span class="k">if</span> <span class="n">keep</span><span class="p">:</span>
		<span class="n">value</span> <span class="o">+=</span> <span class="n">values</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
		<span class="n">weight</span> <span class="o">+=</span> <span class="n">weights</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
	    <span class="n">items</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">keep</span>
	    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="k">if</span> <span class="n">weight</span> <span class="o">&lt;=</span> <span class="n">capacity</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="n">best_value</span><span class="p">:</span>
	    <span class="n">best_value</span> <span class="o">=</span> <span class="n">value</span>
	    <span class="n">solution</span> <span class="o">=</span> <span class="n">items</span><span class="p">[:]</span>

    <span class="k">return</span> <span class="n">Solution</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">best_value</span><span class="p">,</span> <span class="n">inventory</span><span class="o">=</span><span class="n">solution</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-org78014c3" class="outline-3">
<h3 id="org78014c3">Checking the Brute</h3>
<div class="outline-text-3" id="text-org78014c3">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">totals</span><span class="p">(</span><span class="n">inventory</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">weights</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Reduce the inventory values and weights to a total value and a total weight</span>

<span class="sd">    Args:</span>
<span class="sd">     inventory: list of item counts</span>
<span class="sd">     values: list of values for the items</span>
<span class="sd">     list of weights for the items</span>

<span class="sd">    Returns:</span>
<span class="sd">     value, weight for the inventory</span>
<span class="sd">    """</span>
    <span class="n">value</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">value</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="k">if</span> <span class="n">inventory</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">weight</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="k">if</span> <span class="n">inventory</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">value</span><span class="p">,</span> <span class="n">weight</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_solution</span><span class="p">(</span><span class="n">solution</span><span class="p">:</span> <span class="n">Solution</span><span class="p">,</span>
		   <span class="n">expected_inventory</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
		   <span class="n">values</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">weights</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">capacity</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Check that the solution matches the expected</span>

<span class="sd">    Args:</span>
<span class="sd">     solution: namedtuple with the knapsack solution</span>
<span class="sd">     expected_inventory: list of 0's and 1's representing which items to keep</span>
<span class="sd">     expected_value: total value expected for the solution</span>
<span class="sd">     values: values for the items</span>
<span class="sd">     weights: weights for the items</span>
<span class="sd">     capacity: maximum weight for the knapsack</span>

<span class="sd">    Raises:</span>
<span class="sd">     AssertionError if something isn't the expected</span>
<span class="sd">    """</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">inventory</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected_inventory</span><span class="p">))</span>
    <span class="n">value</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">totals</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">inventory</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
    <span class="n">expected_value</span><span class="p">,</span> <span class="n">expected_weight</span> <span class="o">=</span> <span class="n">totals</span><span class="p">(</span><span class="n">expected_inventory</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_below_or_equal</span><span class="p">(</span><span class="n">capacity</span><span class="p">))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">expected_weight</span><span class="p">))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">expected_value</span><span class="p">))</span>
    <span class="k">return</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_examples</span><span class="p">(</span><span class="n">solver</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Check the toy examples</span>

<span class="sd">    Args:</span>
<span class="sd">     solver: function to find the optimal knapsack load</span>
<span class="sd">    """</span>
    <span class="c1"># values and weights don't match</span>
    <span class="c1"># broken = lambda : solver(5, [0, 1], [2, 1, 3])</span>
    <span class="c1"># expect(broken).to(raise_error(AssertionError))</span>

    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">42</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">25</span><span class="p">]</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">solution</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
    <span class="n">check_solution</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">capacity</span><span class="p">)</span>

    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

    <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">solution</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
    <span class="n">check_solution</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">capacity</span><span class="p">)</span>

    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">18</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">solution</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
    <span class="n">check_solution</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">capacity</span><span class="p">)</span>

    <span class="c1"># this won't work for greedy algorithms</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">42</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span>

<span class="n">check_examples</span><span class="p">(</span><span class="n">brute_knapsack</span><span class="p">)</span>
</pre></div>

<p>
Let's look at a particular solution.
</p>

<div class="highlight"><pre><span></span><span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">capacity</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">solution</span> <span class="o">=</span> <span class="n">brute_knapsack</span><span class="p">(</span><span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Call Count: </span><span class="si">{</span><span class="n">solution</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Chosen knapsack value </span><span class="si">{</span><span class="n">solution</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Item inventory: </span><span class="si">{</span><span class="n">solution</span><span class="o">.</span><span class="n">inventory</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">inventory</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>

<pre class="example">
Call Count: 64
Chosen knapsack value 8
Item inventory: [0, 1, 0, 1]
</pre>


<p>
We have a solution that works, but the runtime is \(n2^n\) so let's make a version that does a little better.
</p>
</div>
</div>

<div id="outline-container-org2474a4a" class="outline-3">
<h3 id="org2474a4a">A Recursive Exhaustive Search</h3>
<div class="outline-text-3" id="text-org2474a4a">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">exhausted</span><span class="p">(</span><span class="n">capacity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">weights</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">this_item</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Solution</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Find the optimal knapsack using an exhaustive search</span>

<span class="sd">    Args:</span>
<span class="sd">     capacity: how much weight the knapsack can hold</span>
<span class="sd">     values: how much the items are worth</span>
<span class="sd">     weights: hom much the items weigh</span>
<span class="sd">     this_item: index of the current item in the values and weights</span>
<span class="sd">     count: number of times this function is called</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>

    <span class="n">next_item</span> <span class="o">=</span> <span class="n">this_item</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="c1"># quit this branch if the knapsack is already out of space</span>
    <span class="k">if</span> <span class="n">capacity</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
	 <span class="k">return</span> <span class="n">Solution</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">-</span> <span class="n">this_item</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># to save on an extra base-case call handle the last item separately here</span>
    <span class="k">if</span> <span class="n">next_item</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">):</span>
	<span class="n">skip_this_item</span> <span class="o">=</span> <span class="n">Solution</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">weights</span><span class="p">[</span><span class="n">this_item</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">capacity</span><span class="p">:</span>
	    <span class="k">return</span> <span class="n">skip_this_item</span>

	<span class="n">use_this_item</span> <span class="o">=</span> <span class="n">Solution</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="n">this_item</span><span class="p">],</span>
				 <span class="n">inventory</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
	<span class="k">return</span> <span class="nb">max</span><span class="p">((</span><span class="n">skip_this_item</span><span class="p">,</span> <span class="n">use_this_item</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="c1"># now on to the recursive cases</span>
    <span class="n">descendant_solution</span> <span class="o">=</span> <span class="n">exhausted</span><span class="p">(</span><span class="n">this_item</span><span class="o">=</span><span class="n">next_item</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
				    <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>

    <span class="n">skip_count</span> <span class="o">=</span> <span class="n">descendant_solution</span><span class="o">.</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">skip_this_item</span> <span class="o">=</span> <span class="n">Solution</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">descendant_solution</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
			      <span class="n">inventory</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">descendant_solution</span><span class="o">.</span><span class="n">inventory</span><span class="p">,</span>
			      <span class="n">count</span><span class="o">=</span><span class="n">skip_count</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">capacity</span> <span class="o">&lt;</span> <span class="n">weights</span><span class="p">[</span><span class="n">this_item</span><span class="p">]:</span>
	<span class="n">solution</span> <span class="o">=</span> <span class="n">skip_this_item</span>
	<span class="n">count</span> <span class="o">=</span> <span class="n">skip_count</span>
    <span class="k">else</span><span class="p">:</span>
	<span class="n">capacity_after_this_item_is_added</span> <span class="o">=</span> <span class="n">capacity</span> <span class="o">-</span> <span class="n">weights</span><span class="p">[</span><span class="n">this_item</span><span class="p">]</span>
	<span class="n">descendant_solution</span> <span class="o">=</span> <span class="n">exhausted</span><span class="p">(</span>
	    <span class="n">this_item</span><span class="o">=</span><span class="n">next_item</span><span class="p">,</span>
	    <span class="n">capacity</span><span class="o">=</span><span class="n">capacity_after_this_item_is_added</span><span class="p">,</span>
	    <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span>
	    <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>

	<span class="n">check_count</span> <span class="o">=</span> <span class="n">skip_count</span> <span class="o">+</span> <span class="n">descendant_solution</span><span class="o">.</span><span class="n">count</span>

	<span class="n">include_this_item</span> <span class="o">=</span> <span class="n">Solution</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="n">this_item</span><span class="p">]</span> <span class="o">+</span> <span class="n">descendant_solution</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
				     <span class="n">inventory</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">descendant_solution</span><span class="o">.</span><span class="n">inventory</span><span class="p">,</span>
				     <span class="n">count</span><span class="o">=</span><span class="n">check_count</span><span class="p">)</span>

	<span class="n">skip_this_item</span> <span class="o">=</span> <span class="n">Solution</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">skip_this_item</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
				  <span class="n">inventory</span><span class="o">=</span><span class="n">skip_this_item</span><span class="o">.</span><span class="n">inventory</span><span class="p">,</span>
				  <span class="n">count</span><span class="o">=</span><span class="n">check_count</span><span class="p">)</span>
	<span class="n">solution</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="n">skip_this_item</span><span class="p">,</span> <span class="n">include_this_item</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
	<span class="n">count</span> <span class="o">=</span> <span class="n">check_count</span>
    <span class="k">return</span> <span class="n">solution</span>

<span class="n">check_examples</span><span class="p">(</span><span class="n">exhausted</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-orge5b508e" class="outline-3">
<h3 id="orge5b508e">Checking The Exhaustive</h3>
<div class="outline-text-3" id="text-orge5b508e">
<p>
Let's look at that example that we looked at for the iterative brute-force version.
</p>

<div class="highlight"><pre><span></span><span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">capacity</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">solution</span> <span class="o">=</span> <span class="n">exhausted</span><span class="p">(</span><span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>
<span class="n">brute_solution</span> <span class="o">=</span> <span class="n">brute_knapsack</span><span class="p">(</span><span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Call Count: </span><span class="si">{</span><span class="n">solution</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Chosen knapsack value </span><span class="si">{</span><span class="n">solution</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Item inventory: </span><span class="si">{</span><span class="n">solution</span><span class="o">.</span><span class="n">inventory</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">brute_solution</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">inventory</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">brute_solution</span><span class="o">.</span><span class="n">inventory</span><span class="p">))</span>
</pre></div>

<pre class="example">
Call Count: 12
Chosen knapsack value 8
Item inventory: [0, 1, 0, 1]
</pre>


<p>
So now the number calls has gone down to \(\approx 2^n\), which is better, but not what we want just yet.
</p>
</div>
</div>
</div>
<div id="outline-container-org42ecb1c" class="outline-2">
<h2 id="org42ecb1c">Levitin's Memory Function</h2>
<div class="outline-text-2" id="text-org42ecb1c">
<p>
This is a memoized function that is in <a href="../itdaa/index.html">Levitin's book</a>. It looks slightly different from the other memoized functions in the other books (but they all look slightly different from each other anyway) but it's only cosmetic. I've been creating the final solution list of items to use in the functions themselves but I'm going to try doing it the way the books do and separate out the solution using a re-creation function afterwards.
</p>
</div>

<div id="outline-container-orgf41d990" class="outline-3">
<h3 id="orgf41d990">Some Pseudocode</h3>
<div class="outline-text-3" id="text-orgf41d990">
</div>
<div id="outline-container-org763e225" class="outline-4">
<h4 id="org763e225">The Memoizer</h4>
<div class="outline-text-4" id="text-org763e225">
<p>
<b><b>Note:</b></b> Levitin keeps the weights, values, and solution table in the global space so it doesn't appear in the pseudocode. I'm going to copy that here but change it when I get to implementing it.
I'm also going to change the variables a little to get them a little closer to the names I use. I'll call the eternal collections \(\textit{Table, Weights}\), and \(\textit{Values}\).
</p>

<p>
The \(Table\) is an \(items \times capacity\) table, with from 0 to number of items rows and 0 to the capacity columns. The 0 row and 0 column get initialized with 0 and the other cells with -1. If we have 4 items and a knapsack capacity of 5 we'd have an initial table like this.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="org-right"></colgroup>
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">Â </th>
<th scope="col" class="org-right">0</th>
<th scope="col" class="org-right">1</th>
<th scope="col" class="org-right">2</th>
<th scope="col" class="org-right">3</th>
<th scope="col" class="org-right">4</th>
<th scope="col" class="org-right">5</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-right">0</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
</tr>
<tr>
<td class="org-right">3</td>
<td class="org-right">0</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-right">0</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
</tr>
</tbody>
</table>
<p>
Where the rows are the items and the columns are the used-capacities for the knapsack.
</p>

<pre id="memory-function-algorithm" style="display:hidden;">
\begin{algorithm}
\caption{Memory Function Knapsack Solver}
\begin{algorithmic}
\INPUT $i$: the number of the first items to consider.
\INPUT $c$: the knapsack's capacity.
\OUTPUT Value of the optimal subset of the first $i$ items that fit in the knapsack.
\PROCEDURE{MFKnapsack}{$i, c$}
\IF {\textit{Table}$[i, c] &lt; 0$}
 \IF {$c &lt; \textit{Weights}[i]$}
  \STATE $v \gets $ \textsc{MFKnapsack}($i - 1, c$)
 \ELSE
  \STATE $v \gets $ \textsc{Max}(\textsc{MFKnapsack}($i - 1, c$), $\textit{Values}[i] + $ \textsc{MFKnapsack}($i - 1, c - \textit{Weights}[i]$))
 \ENDIF
 \STATE $\textit{Table}[i, c] \gets v$
\ENDIF
\RETURN $\textit{Table}[i, c]$
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>

<p>
To start the function you would pass in the total number of items as the argument for \(i\). Since we initialized the cells (other than the zero row and column) with -1 the initial <i>if</i> is a check to see if the item and capacity passed to the function is already in the table and if it isn't we run the body but if it is we can just return the value from the table.
</p>

<p>
In the body if the weight of the current item is beyond the remaining capacity of the knapsack we pick the value for the previous item using the current capacity. If the current item will fit in the knapsack then we pick the larger of the previous item's entry with the current capacity and the value of the current item plus the previous item's entry for the current capacity minus the weight of the current item - meaning we pick the bigger of the values we get if we skip this item or keep it.
</p>

<ol class="org-ol">
<li>If the item and capacity aren't in the table:
<ul class="org-ul">
<li>If the item's weight is greater than the remaining capacity use the previous item's value for the current capacity.</li>
<li>Otherwise use the greater of the previous item's value and this item's value plus the previous item's value for the current capacity minus the current item's weight (the capacity if you use the current item)</li>
<li>Whichever value you use, set it to the table's entry for this item and the current capacity</li>
</ul>
</li>
<li>Return the table entry for this item and the current capacity</li>
</ol>
</div>
</div>

<div id="outline-container-org269333b" class="outline-4">
<h4 id="org269333b">A Reconstructor</h4>
<div class="outline-text-4" id="text-org269333b">
<p>
The main algorithm builds a memo-table and returns the value of the optimal solution but doesn't tell you which  items are actually taken. For that we'll need a separate function. The pseudocode assumes that the weights (\(w_i\)) and values (\(v_i\)) are global variables.
</p>

<pre id="reconstruction-algorithm" style="display:hidden;">
\begin{algorithm}
\caption{Knapsack Inventory Reconstructor}
\begin{algorithmic}
\INPUT $A$: The table created to solve the knapsack problem
\INPUT $c$: the knapsack's capacity.
\OUTPUT An optimal knapsack solution
\PROCEDURE{KnapsackReconstruction}{$A, C$}

\STATE \( S \gets \emptyset \)
\STATE \(c \gets C \)
\FOR {\(i = n \ldots 1\)}
    \IF {\(w_i \leq c\) and \(A[i - 1][c - w_i] + v_i \geq A[i - 1][c]\)}
        \STATE \(S \gets S \cup \{i\}\)
        \STATE \(c \gets c - w_i\)
    \ENDIF
\ENDFOR
\RETURN \(S\)
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>
</div>
</div>
</div>


<div id="outline-container-orgc7ee35b" class="outline-3">
<h3 id="orgc7ee35b">Memory-Function Knapsack</h3>
<div class="outline-text-3" id="text-orgc7ee35b">
<p>
The counts and such are cluttering up the function so I'm going to make this class-based.
</p>

<div class="highlight"><pre><span></span><span class="nd">@define</span>
<span class="k">class</span> <span class="nc">Memorizer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Dynamic Programming solution to the knapsack problem</span>

<span class="sd">    Args:</span>
<span class="sd">     capacity: total capacity (by weight) of knapsack</span>
<span class="sd">     values: values for items to put in knapsack</span>
<span class="sd">     weights: weights for items to put in knapsack</span>
<span class="sd">    """</span>
    <span class="n">capacity</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">values</span><span class="p">:</span> <span class="nb">list</span>
    <span class="n">weights</span><span class="p">:</span> <span class="nb">list</span>
    <span class="n">_items</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_table</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">count</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">_value</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_inventory</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">	</span><span class="sd">"""The number of items available for the knapsack</span>

<span class="sd">	Raises:</span>
<span class="sd">	 AssertionError: the number of values and weights don't match</span>

<span class="sd">	Returns:</span>
<span class="sd">	 number of items</span>
<span class="sd">	"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
	    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_items</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">	</span><span class="sd">"""The total value of the optimal knapsack"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">,</span>
					  <span class="bp">self</span><span class="o">.</span><span class="n">capacity</span><span class="p">)</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">	</span><span class="sd">"""The memo table</span>

<span class="sd">	Returns:</span>
<span class="sd">	items + 1 x capacity + 1 list of lists: 0's in 0 column/row, -1 elsewhere</span>
<span class="sd">	"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
	    <span class="n">first_row</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">capacity</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
	    <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">capacity</span>
	    <span class="n">table</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[:]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)]</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_table</span> <span class="o">=</span> <span class="p">[</span><span class="n">first_row</span><span class="p">]</span> <span class="o">+</span> <span class="n">table</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span>

    <span class="k">def</span> <span class="nf">find_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">capacity</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">	</span><span class="sd">"""Find the best total value for the knapsack</span>

<span class="sd">	Args:</span>
<span class="sd">	 item: the number of the item to use (0...item)</span>
<span class="sd">	 capacity: maximum weight allowed</span>

<span class="sd">	Returns:</span>
<span class="sd">	 best-value</span>
<span class="sd">	"""</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="c1"># the table is padded </span>
	<span class="c1"># so we need to adjust the item index for weights, values</span>
	<span class="n">this_item</span> <span class="o">=</span> <span class="n">item</span> <span class="o">-</span> <span class="mi">1</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">capacity</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
	    <span class="n">previous_item</span> <span class="o">=</span> <span class="n">item</span> <span class="o">-</span> <span class="mi">1</span>
	    <span class="n">previous_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_value</span><span class="p">(</span><span class="n">previous_item</span><span class="p">,</span> <span class="n">capacity</span><span class="p">)</span>

	    <span class="k">if</span> <span class="n">capacity</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">this_item</span><span class="p">]:</span>
		<span class="n">value</span> <span class="o">=</span> <span class="n">previous_value</span>
	    <span class="k">else</span><span class="p">:</span>
		<span class="n">value</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">previous_value</span><span class="p">,</span>
			    <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">this_item</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_value</span><span class="p">(</span>
				<span class="n">previous_item</span><span class="p">,</span>
				<span class="n">capacity</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">this_item</span><span class="p">]))</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">capacity</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">capacity</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">inventory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">	</span><span class="sd">"""Reconstructs the optimal knapsack load using the table</span>

<span class="sd">	Returns:</span>
<span class="sd">	 inventory of items in the optimal knapsack</span>
<span class="sd">	"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inventory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
	    <span class="c1"># make sure that the problem has already been solved</span>
	    <span class="bp">self</span><span class="p">()</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_inventory</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span>
	    <span class="n">remaining_capacity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capacity</span>

	    <span class="k">for</span> <span class="n">table_item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
		<span class="c1"># table_item is padded by one</span>
		<span class="n">this_item</span> <span class="o">=</span> <span class="n">previous_table_item</span> <span class="o">=</span> <span class="n">table_item</span> <span class="o">-</span> <span class="mi">1</span>

		<span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">this_item</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">remaining_capacity</span> <span class="ow">and</span>
		    <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">previous_table_item</span><span class="p">][</span>
			<span class="n">remaining_capacity</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">this_item</span><span class="p">]]</span>
		    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">this_item</span><span class="p">]</span>
		    <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">previous_table_item</span><span class="p">][</span><span class="n">remaining_capacity</span><span class="p">]):</span>
		    <span class="bp">self</span><span class="o">.</span><span class="n">_inventory</span><span class="p">[</span><span class="n">this_item</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
		    <span class="n">remaining_capacity</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">this_item</span><span class="p">]</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inventory</span>            

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">	</span><span class="sd">"""Finds the best solution:</span>

<span class="sd">	As a side effect this also sets self.value</span>

<span class="sd">	Returns:</span>
<span class="sd">	 value for optimal knapsack</span>
<span class="sd">	"""</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
</pre></div>
</div>

<div id="outline-container-org1e9c8b9" class="outline-4">
<h4 id="org1e9c8b9">Check the table maker</h4>
<div class="outline-text-4" id="text-org1e9c8b9">
<div class="highlight"><pre><span></span><span class="n">capacity</span><span class="p">,</span> <span class="n">items</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span>
<span class="n">values</span> <span class="o">=</span> <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">items</span>

<span class="n">table</span> <span class="o">=</span> <span class="n">Memorizer</span><span class="p">(</span><span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">table</span>

<span class="c1"># one row per item plus a zero row</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">items</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># columns from 0...capacity</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">capacity</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># first row should be 0's</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

<span class="c1"># first column should be 0's</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

<span class="c1"># everything else should be -1 (items x capacity sub-array)</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">items</span> <span class="o">*</span> <span class="n">capacity</span><span class="p">)))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org9d6d0dc" class="outline-4">
<h4 id="org9d6d0dc">Check the Final Table</h4>
<div class="outline-text-4" id="text-org9d6d0dc">
<div class="highlight"><pre><span></span><span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
<span class="n">capacity</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">memoizer</span> <span class="o">=</span> <span class="n">Memorizer</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">)</span>
<span class="n">memoizer</span><span class="p">()</span>
<span class="n">expect</span><span class="p">(</span><span class="n">memoizer</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">37</span><span class="p">))</span>

<span class="n">expected_table</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
		  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">],</span>
		  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">22</span><span class="p">],</span>
		  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">],</span>
		  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">37</span><span class="p">]]</span>

<span class="k">for</span> <span class="n">row_index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">memoizer</span><span class="o">.</span><span class="n">table</span><span class="p">):</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected_table</span><span class="p">[</span><span class="n">row_index</span><span class="p">]))</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgcbaece4" class="outline-4">
<h4 id="orgcbaece4">Check the Recovered Solution</h4>
<div class="outline-text-4" id="text-orgcbaece4">
<p>
Although knowing what the optimal value is for the knapsack is somewhat informative in that it tells us what we can expect to achieve, it isn't really the solution since we don't know what items actually give us this value, so we're going to need to reconstruct it from the table.
</p>

<div class="highlight"><pre><span></span><span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
<span class="n">capacity</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">solution</span> <span class="o">=</span> <span class="n">Memorizer</span><span class="p">(</span><span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">inventory</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org6de6d84" class="outline-4">
<h4 id="org6de6d84">Check It Against The Examples</h4>
<div class="outline-text-4" id="text-org6de6d84">
<div class="highlight"><pre><span></span><span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">capacity</span> <span class="o">=</span> <span class="mi">6</span>

<span class="n">solution</span> <span class="o">=</span> <span class="n">Memorizer</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Chosen knapsack value </span><span class="si">{</span><span class="n">solution</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Item inventory: </span><span class="si">{</span><span class="n">solution</span><span class="o">.</span><span class="n">inventory</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Call Count: </span><span class="si">{</span><span class="n">solution</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">check_examples</span><span class="p">(</span><span class="n">Memorizer</span><span class="p">)</span>
</pre></div>

<pre class="example">
Chosen knapsack value 8
Item inventory: [0, 1, 0, 1]
Call Count: 17
</pre>


<p>
Our solution is correct, but if you count all the function calls, not just the calls where the solution isn't in the table yet, it takes more calls than our exhaustive function. 
</p>
</div>
</div>
</div>

<div id="outline-container-orgb2f0f9c" class="outline-3">
<h3 id="orgb2f0f9c">Compared to the Exhaustive Search</h3>
<div class="outline-text-3" id="text-orgb2f0f9c">
<div class="highlight"><pre><span></span><span class="n">sizes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">61</span><span class="p">))</span>

<span class="c1"># 0 weights break the Memorizer so make sure everything weighs at least 1</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">)),</span> <span class="n">k</span><span class="o">=</span><span class="n">size</span><span class="p">)</span> <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">sizes</span><span class="p">]</span>
<span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="n">size</span><span class="p">)),</span> <span class="n">k</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
	   <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">sizes</span><span class="p">]</span>
<span class="n">capacities</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span> <span class="k">for</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">weights</span><span class="p">]</span>

<span class="n">capacities_values_weights</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">capacities</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">))</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">exhaustive_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
    <span class="n">delayed</span><span class="p">(</span><span class="n">exhausted</span><span class="p">)(</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">capacity</span><span class="p">,</span><span class="n">values</span><span class="p">,</span><span class="n">weights</span> <span class="ow">in</span> <span class="n">capacities_values_weights</span><span class="p">)</span>
</pre></div>

<pre class="example">
Started: 2022-07-11 02:35:10.337731
Ended: 2022-07-11 02:50:47.862952
Elapsed: 0:15:37.525221
</pre>


<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">memorizer_knapsack</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">):</span>
    <span class="n">memorizer</span> <span class="o">=</span> <span class="n">Memorizer</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
    <span class="n">memorizer</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">memorizer</span>

<span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">memorized_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
    <span class="n">delayed</span><span class="p">(</span><span class="n">memorizer_knapsack</span><span class="p">)(</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">capacity</span><span class="p">,</span><span class="n">values</span><span class="p">,</span><span class="n">weights</span> <span class="ow">in</span> <span class="n">capacities_values_weights</span><span class="p">)</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">output</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">exhaustive_output</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
	<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">memorized_output</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
	<span class="n">capacity</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">capacities_values_weights</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
	<span class="n">b_value</span><span class="p">,</span> <span class="n">b_weight</span> <span class="o">=</span> <span class="n">totals</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">inventory</span><span class="p">,</span>
				   <span class="n">value</span><span class="p">,</span>
				   <span class="n">weight</span><span class="p">)</span>
	<span class="n">m_value</span><span class="p">,</span> <span class="n">m_weight</span> <span class="o">=</span> <span class="n">totals</span><span class="p">(</span><span class="n">memorized_output</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">inventory</span><span class="p">,</span>
				   <span class="n">value</span><span class="p">,</span>
				   <span class="n">weight</span><span class="p">)</span>
	<span class="n">expect</span><span class="p">(</span><span class="n">m_value</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">b_value</span><span class="p">))</span>
	<span class="n">expect</span><span class="p">(</span><span class="n">m_weight</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_below_or_equal</span><span class="p">(</span><span class="n">capacity</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
	<span class="n">c</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">capacities_values_weights</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
	<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Index: </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
	<span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
	<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Brute: </span><span class="si">{</span><span class="n">brute_knapsack</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
	<span class="k">raise</span>
</pre></div>

<pre class="example">
Started: 2022-07-11 05:00:50.158584
Ended: 2022-07-11 05:00:52.849549
Elapsed: 0:00:02.690965
</pre>


<div class="highlight"><pre><span></span><span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"Items"</span><span class="p">:</span> <span class="n">sizes</span><span class="p">,</span>
			  <span class="s2">"Exhaustive"</span><span class="p">:</span> <span class="p">[</span>
			      <span class="n">solution</span><span class="o">.</span><span class="n">count</span>
			      <span class="k">for</span> <span class="n">solution</span> <span class="ow">in</span> <span class="n">exhaustive_output</span><span class="p">],</span>
			  <span class="s2">"Memoized"</span><span class="p">:</span> <span class="p">[</span>
			      <span class="n">solution</span><span class="o">.</span><span class="n">count</span>
			      <span class="k">for</span> <span class="n">solution</span> <span class="ow">in</span> <span class="n">memorized_output</span><span class="p">]})</span>

<span class="n">melted</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Items"</span><span class="p">],</span>
		    <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Exhaustive"</span><span class="p">,</span> <span class="s2">"Memoized"</span><span class="p">],</span>
		    <span class="n">var_name</span><span class="o">=</span><span class="s2">"Algorithm"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Calls"</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Items"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Calls"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Algorithm"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Items"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Calls"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="s2">"Algorithm"</span><span class="p">],</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Exhaustive vs Memoized Knapsack Solution"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"exhaustive-vs-memoized"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="exhaustive-vs-memoized.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>

<p>
The height of those last points squashes the previous points down to make it look like the two algorithms do about the same until you hit 47 items, but if you trim off those end points you'll see that the exhaustive algorithm generally requires much more calls than the memoized version. The points aren't on a smooth line as a function of the number of items because whenever an item won't fit in the remaining capacity of the knapsack we skip the second recursive call.
</p>

<div class="highlight"><pre><span></span><span class="n">UPPER_BOUND</span> <span class="o">=</span> <span class="mi">47</span>
<span class="n">trimmed</span> <span class="o">=</span> <span class="n">melted</span><span class="p">[</span><span class="n">melted</span><span class="o">.</span><span class="n">Items</span> <span class="o">&lt;</span> <span class="n">UPPER_BOUND</span><span class="p">]</span>
<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">trimmed</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Items"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Calls"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Algorithm"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Items"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Calls"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="s2">"Algorithm"</span><span class="p">],</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">"Exhaustive vs Memoized Knapsack Solution (&lt; </span><span class="si">{</span><span class="n">UPPER_BOUND</span><span class="si">}</span><span class="s2">)"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"exhaustive-vs-memoized-trimmed"</span><span class="p">)</span>
</pre></div>


<object type="text/html" data="exhaustive-vs-memoized-trimmed.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>
</div>
</div>
</div>

<div id="outline-container-orgef2acd6" class="outline-2">
<h2 id="orgef2acd6">Dynamic Programming</h2>
<div class="outline-text-2" id="text-orgef2acd6">
<p>
This is taken from <a href="../algorithms-illuminated-part-3/index.html">Algorithms Illuminated Part 3</a>.
</p>
</div>

<div id="outline-container-org2eafc33" class="outline-3">
<h3 id="org2eafc33">Some Pseudocode</h3>
<div class="outline-text-3" id="text-org2eafc33">
<pre id="dynamic-programming-algorithm" style="display:hidden;">
\begin{algorithm}
\caption{Dynamic Programming Knapsack Solver}
\begin{algorithmic}
\INPUT Item Values: \(v_1, v_2, \ldots, v_n\)
\INPUT Item Weights: \(w_1, w_2, \ldots, w_n\)
\INPUT Knapsack Capacity \(C\)
\OUTPUT Subset \(S\) of items with maximum possible sum of values and size at most \(C\)
\PROCEDURE{DynamicKnapsack}{\(v, w, C\)}
\STATE \(A \gets (n + 1) \times (c + 1)\) two dimensional array.
\FOR {\(c \in \{0 \ldots C\}\)}
  \STATE \(A[0][c] \gets 0\)
\ENDFOR

\FOR {\(i \in \{1 \ldots n\}\)}
  \FOR {\(c \in \{0 \ldots C \}\)}
    \IF {\(w_i &gt; C \)}
      \STATE \(A[i][c] \gets A[i - 1][c]\)
    \ELSE
      \STATE \(A[i][c] \gets \)\textsc{Max}(\(A[i - 1][c], A[i - 1][c - w_i] + v_i\))
    \ENDIF
  \ENDFOR
\ENDFOR

\RETURN \(A[n][C]\)
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>

<p>
This looks pretty much like the memoized-recursive version so it shouldn't be too hard to understand.
</p>
</div>
</div>

<div id="outline-container-org5f53537" class="outline-3">
<h3 id="org5f53537">In Python</h3>
<div class="outline-text-3" id="text-org5f53537">
<div class="highlight"><pre><span></span><span class="nd">@define</span>
<span class="k">class</span> <span class="nc">CaptainDynamic</span><span class="p">(</span><span class="n">Memorizer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Dynamic Programming solution to the knapsack problem</span>

<span class="sd">    Args:</span>
<span class="sd">     capacity: total capacity (by weight) of knapsack</span>
<span class="sd">     values: values for items to put in knapsack</span>
<span class="sd">     weights: weights for items to put in knapsack</span>
<span class="sd">    """</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">	</span><span class="sd">"""The total value of the optimal knapsack"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_value</span><span class="p">()</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>

    <span class="k">def</span> <span class="nf">find_value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">	</span><span class="sd">"""Finds the optimal value"""</span>
	<span class="k">for</span> <span class="n">item_row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
	    <span class="n">previous_item</span> <span class="o">=</span> <span class="n">this_item</span> <span class="o">=</span> <span class="n">item_row</span> <span class="o">-</span> <span class="mi">1</span>
	    <span class="k">for</span> <span class="n">capacity</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">capacity</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
		<span class="n">skip_this_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">previous_item</span><span class="p">][</span><span class="n">capacity</span><span class="p">]</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">this_item</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">capacity</span><span class="p">:</span>
		    <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">item_row</span><span class="p">][</span><span class="n">capacity</span><span class="p">]</span> <span class="o">=</span> <span class="n">skip_this_item</span>
		<span class="k">else</span><span class="p">:</span>
		    <span class="n">use_this_item</span> <span class="o">=</span> <span class="p">(</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">previous_item</span><span class="p">][</span>
			    <span class="n">capacity</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">this_item</span><span class="p">]]</span> <span class="o">+</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">this_item</span><span class="p">])</span>

		    <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">item_row</span><span class="p">][</span><span class="n">capacity</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
			<span class="p">(</span><span class="n">skip_this_item</span><span class="p">,</span> <span class="n">use_this_item</span><span class="p">)</span>
		    <span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">capacity</span><span class="p">]</span>
</pre></div>
</div>

<div id="outline-container-org99e857b" class="outline-4">
<h4 id="org99e857b">Check the table maker</h4>
<div class="outline-text-4" id="text-org99e857b">
<div class="highlight"><pre><span></span><span class="n">capacity</span><span class="p">,</span> <span class="n">items</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span>
<span class="n">values</span> <span class="o">=</span> <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">items</span>

<span class="n">table</span> <span class="o">=</span> <span class="n">CaptainDynamic</span><span class="p">(</span><span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">table</span>

<span class="c1"># one row per item plus a zero row</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">items</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># columns from 0...capacity</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">capacity</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># first row should be 0's</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

<span class="c1"># first column should be 0's</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

<span class="c1"># everything else should be -1 (items x capacity sub-array)</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">items</span> <span class="o">*</span> <span class="n">capacity</span><span class="p">)))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org4522fa8" class="outline-4">
<h4 id="org4522fa8">Check the Recovered Solution</h4>
<div class="outline-text-4" id="text-org4522fa8">
<p>
Although knowing what the optimal value is for the knapsack is somewhat informative in that it tells us what we can expect to achieve, it isn't really the solution since we don't know what items actually give us this value, so we're going to need to reconstruct it from the table.
</p>

<div class="highlight"><pre><span></span><span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
<span class="n">capacity</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">solution</span> <span class="o">=</span> <span class="n">CaptainDynamic</span><span class="p">(</span><span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">inventory</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="n">m_solution</span> <span class="o">=</span> <span class="n">Memorizer</span><span class="p">(</span><span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">m_solution</span><span class="o">.</span><span class="n">inventory</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org333d286" class="outline-4">
<h4 id="org333d286">Check It Against The Examples</h4>
<div class="outline-text-4" id="text-org333d286">
<div class="highlight"><pre><span></span><span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">capacity</span> <span class="o">=</span> <span class="mi">6</span>

<span class="n">d_solution</span> <span class="o">=</span> <span class="n">CaptainDynamic</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Captain Dynamic"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Chosen knapsack value </span><span class="si">{</span><span class="n">d_solution</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Item inventory: </span><span class="si">{</span><span class="n">d_solution</span><span class="o">.</span><span class="n">inventory</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Call Count: </span><span class="si">{</span><span class="n">d_solution</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">check_examples</span><span class="p">(</span><span class="n">CaptainDynamic</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Memorizer"</span><span class="p">)</span>
<span class="n">m_solution</span> <span class="o">=</span> <span class="n">Memorizer</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Chosen knapsack value: </span><span class="si">{</span><span class="n">m_solution</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Item inventory: </span><span class="si">{</span><span class="n">m_solution</span><span class="o">.</span><span class="n">inventory</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Call Count: </span><span class="si">{</span><span class="n">m_solution</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">check_examples</span><span class="p">(</span><span class="n">Memorizer</span><span class="p">)</span>
</pre></div>

<pre class="example">
Captain Dynamic
Chosen knapsack value 8
Item inventory: [0, 1, 0, 1]
Call Count: 28

Memorizer
Chosen knapsack value: 8
Item inventory: [0, 1, 0, 1]
Call Count: 17
</pre>


<p>
Our solution is correct, but if you count all the function calls, not just the calls where the solution isn't in the table yet, it takes more calls than our exhaustive function. 
</p>
</div>
</div>
</div>


<div id="outline-container-org94d3175" class="outline-3">
<h3 id="org94d3175">Compared</h3>
<div class="outline-text-3" id="text-org94d3175">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dynamic_knapsack</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">):</span>
    <span class="n">captain</span> <span class="o">=</span> <span class="n">CaptainDynamic</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
    <span class="n">captain</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">captain</span>

<span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">dynamic_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
    <span class="n">delayed</span><span class="p">(</span><span class="n">dynamic_knapsack</span><span class="p">)(</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">capacity</span><span class="p">,</span><span class="n">values</span><span class="p">,</span><span class="n">weights</span> <span class="ow">in</span> <span class="n">capacities_values_weights</span><span class="p">)</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">output</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">exhaustive_output</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
	<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">dynamic_output</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
	<span class="n">capacity</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">capacities_values_weights</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
	<span class="n">b_value</span><span class="p">,</span> <span class="n">b_weight</span> <span class="o">=</span> <span class="n">totals</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">inventory</span><span class="p">,</span>
				   <span class="n">value</span><span class="p">,</span>
				   <span class="n">weight</span><span class="p">)</span>
	<span class="n">m_value</span><span class="p">,</span> <span class="n">m_weight</span> <span class="o">=</span> <span class="n">totals</span><span class="p">(</span><span class="n">dynamic_output</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">inventory</span><span class="p">,</span>
				   <span class="n">value</span><span class="p">,</span>
				   <span class="n">weight</span><span class="p">)</span>
	<span class="n">expect</span><span class="p">(</span><span class="n">m_value</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">b_value</span><span class="p">))</span>
	<span class="n">expect</span><span class="p">(</span><span class="n">m_weight</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_below_or_equal</span><span class="p">(</span><span class="n">capacity</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
	<span class="n">c</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">capacities_values_weights</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
	<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Index: </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
	<span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
	<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Brute: </span><span class="si">{</span><span class="n">brute_knapsack</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
	<span class="k">raise</span>
</pre></div>

<pre class="example">
Started: 2022-07-11 05:08:19.593276
Ended: 2022-07-11 05:08:21.585963
Elapsed: 0:00:01.992687
</pre>


<div class="highlight"><pre><span></span><span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"Items"</span><span class="p">:</span> <span class="n">sizes</span><span class="p">,</span>
			  <span class="s2">"Dynamic"</span><span class="p">:</span> <span class="p">[</span>
			      <span class="n">solution</span><span class="o">.</span><span class="n">count</span>
			      <span class="k">for</span> <span class="n">solution</span> <span class="ow">in</span> <span class="n">dynamic_output</span><span class="p">],</span>
			  <span class="s2">"cN"</span><span class="p">:</span> <span class="p">[</span>
			      <span class="n">solution</span><span class="o">.</span><span class="n">capacity</span> <span class="o">*</span> <span class="n">solution</span><span class="o">.</span><span class="n">items</span>
			      <span class="k">for</span> <span class="n">solution</span> <span class="ow">in</span> <span class="n">dynamic_output</span><span class="p">],</span>
			  <span class="s2">"Memoized"</span><span class="p">:</span> <span class="p">[</span>
			      <span class="n">solution</span><span class="o">.</span><span class="n">count</span>
			      <span class="k">for</span> <span class="n">solution</span> <span class="ow">in</span> <span class="n">memorized_output</span><span class="p">]})</span>

<span class="n">melted</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Items"</span><span class="p">],</span>
		    <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Dynamic"</span><span class="p">,</span> <span class="s2">"Memoized"</span><span class="p">,</span> <span class="s2">"cN"</span><span class="p">],</span>
		    <span class="n">var_name</span><span class="o">=</span><span class="s2">"Algorithm"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Calls"</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Items"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Calls"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Algorithm"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Items"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Calls"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="s2">"Algorithm"</span><span class="p">],</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Dynamic vs Memoized Knapsack Solution"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"dynamic-vs-memoized"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="dynamic-vs-memoized.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>
</div>
</div>
</div>

<div id="outline-container-org96ae0f4" class="outline-2">
<h2 id="org96ae0f4">Sources</h2>
<div class="outline-text-2" id="text-org96ae0f4">
<ul class="org-ul">
<li><a href="../clrs/index.html">Introduction To Algorithms (CLRS)</a></li>
<li><a href="../algorithms-illuminated-part-3/index.html">Algorithms Illuminated - Part III: Greedy Algorithms and Dynamic Programming</a></li>
<li><a href="../itdaa/index.html">Introduction to the Design &amp; Analysis of Algorithms (Levitin)</a></li>
</ul>
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("memory-function-algorithm"));
});
</script><script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("reconstruction-algorithm"));
});
</script><script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("dynamic-programming-algorithm"));
});
</script>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/algorithms/index.html" rel="tag">algorithms</a></li>
            <li><a class="tag p-category" href="../../categories/dynamic-programming/index.html" rel="tag">dynamic programming</a></li>
            <li><a class="tag p-category" href="../../categories/optimization/index.html" rel="tag">optimization</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../latpaps/index.html" rel="prev" title="Learning Algorithms Through Programming and Problem Solving">Previous post</a>
            </li>
            <li class="next">
                <a href="../algorithms-illuminated-part-3/index.html" rel="next" title="Algorithms Illuminated - Part III: Greedy Algorithms and Dynamic Programming">Next post</a>
            </li>
        </ul></nav></aside><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
             MathJax.Hub.Config({
               tex2jax: {
                 inlineMath: [['$','$'], ['\\(','\\)']],
                 displayMath: [['$$','$$'], ['\\[','\\]']],
                 processEscapes: true,
                 processEnvironments: true,
               },
               displayAlign: 'center',
               "HTML-CSS": {
                 styles: {'.MathJax_Display': {"margin": 0}}
               }
             });
            </script><script src="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.js"></script></article><!--End of body content--><footer id="footer">
            Scribbles by <a href="mailto:cloisteredmonkey.jmark@slmail.me">The Cloistered Monkey</a> Â© 2023 - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
<div id="license" xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/">
<span property="dct:title">Ape-Iron</span> is licensed under
<a href="http://creativecommons.org/licenses/by-sa/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY-SA 4.0
<img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"><img src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1"></a> 

            
            
        
    </div>
</footer>
</div>


        <script src="../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</div>
</body>
</html>
