<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Striking out for data." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Bowling For Data (old posts, page 5) | Bowling For Data</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Bowling-For-Data/index-5.html" rel="canonical">
<link href="index-6.html" rel="prev" type="text/html">
<link href="index-4.html" rel="next" type="text/html"><!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
<script crossorigin="anonymous" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],

            displayMath: [['$$','$$'], ['\\[','\\]']],
            processEscapes: true,
            processEnvironments: true,
        }
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/pseudocode@2.4.1/build/pseudocode.min.js"></script>
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="."><span id="blog-title">Bowling For Data</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="pages/">Pages</a></li>
<li class="nav-item"><a class="nav-link" href="archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="rss.xml">RSS feed</a></li>
<li class="nav-item dropdown"><a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Monkey Pages</a>
<div class="dropdown-menu"><a class="dropdown-item" href="https://necromuralist.github.io/">The Cloistered Monkey</a> <a class="dropdown-item" href="https://necromuralist.github.io/Ape-Iron/">Ape Iron</a> <a class="dropdown-item" href="https://necromuralist.github.io/Beach-Pig-Thigh/">Beach-Pig Rump & Thigh</a> <a class="dropdown-item" href="https://necromuralist.github.io/Neurotic-Networking/">Neurotic Networking</a> <a class="dropdown-item" href="https://necromuralist.github.io/Terribilis-Ludum/">Terribilis Ludum</a> <a class="dropdown-item" href="https://necromuralist.github.io/Visions-Voices-Data/">Visions, Voices, Data</a></div>
</li>
</ul>
<!-- DuckDuckGo custom search -->
<form action="https://duckduckgo.com/" class="navbar-form pull-left" id="search" method="get" name="search"><input name="sites" type="hidden" value="https://necromuralist.github.io/Bowling-For-Data/"><input name="k8" type="hidden" value="#444444"><input name="k9" type="hidden" value="#D51920"><input name="kt" type="hidden" value="h"><input class="span2" maxlength="255" name="q" placeholder="Searchâ€¦" style="margin-top: 4px;" type="text"><input style="visibility: hidden;" type="submit" value="DuckDuckGo Search"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<div class="postindex">
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/graphs/index.html">Graphs</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/graphs/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-04-04T18:40:48-07:00" itemprop="datePublished" title="2022-04-04 18:40">2022-04-04 18:40</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/graphs/index.html#org1879ea0">Introduction</a></li>
<li><a href="posts/graphs/index.html#org296fc2e">Imports and Setup</a>
<ul>
<li><a href="posts/graphs/index.html#org76cce70">Imports</a></li>
<li><a href="posts/graphs/index.html#org6954bdc">Constants</a></li>
</ul>
</li>
<li><a href="posts/graphs/index.html#orgf177e5a">A Vertex Implementation</a></li>
<li><a href="posts/graphs/index.html#org3622ec4">A Graph Implementation</a>
<ul>
<li><a href="posts/graphs/index.html#orgc3f993f">Adjacencies</a></li>
<li><a href="posts/graphs/index.html#org7cb44bb">Vertices</a></li>
<li><a href="posts/graphs/index.html#orgf814d2a">Add Item</a></li>
<li><a href="posts/graphs/index.html#org970bf5d">Getitem</a></li>
<li><a href="posts/graphs/index.html#orgeb4acb2">Testing</a></li>
</ul>
</li>
<li><a href="posts/graphs/index.html#org84c10a3">Sources</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org1879ea0">
<h2 id="org1879ea0">Introduction</h2>
<div class="outline-text-2" id="text-org1879ea0">
<p>This is a starter post for an introduction to Graphs.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org296fc2e">
<h2 id="org296fc2e">Imports and Setup</h2>
<div class="outline-text-2" id="text-org296fc2e"></div>
<div class="outline-3" id="outline-container-org76cce70">
<h3 id="org76cce70">Imports</h3>
<div class="outline-text-3" id="text-org76cce70">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">attrs</span> <span class="kn">import</span> <span class="n">define</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org6954bdc">
<h3 id="org6954bdc">Constants</h3>
<div class="outline-text-3" id="text-org6954bdc">
<div class="highlight">
<pre><span></span><span class="k">class</span> <span class="nc">Color</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">WHITE</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">GRAY</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">BLACK</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">INFINITY</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">"inf"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgf177e5a">
<h2 id="orgf177e5a">A Vertex Implementation</h2>
<div class="outline-text-2" id="text-orgf177e5a">
<p>Note to future self: the default setting for <code>attrs.define</code> makes the object to unhashable, to make it hashable by object identity pass in <code>eq=False</code> otherwise trying to add the object to a set will raise an error.</p>
<div class="highlight">
<pre><span></span><span class="nd">@define</span><span class="p">(</span><span class="n">eq</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Vertex</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""A single node in a graph</span>

<span class="sd">    Args:</span>
<span class="sd">     identifier: something to identify the node</span>
<span class="sd">     color: the 'discovery' state of the node</span>
<span class="sd">     distance: The number of edges to the root</span>
<span class="sd">     predecessor: The 'parent' of the node in a tree</span>
<span class="sd">    """</span>
    <span class="n">identifier</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">color</span><span class="p">:</span> <span class="n">Enum</span><span class="o">=</span><span class="n">Color</span><span class="o">.</span><span class="n">WHITE</span>
    <span class="n">distance</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="n">INFINITY</span>
    <span class="n">predecessor</span><span class="p">:</span> <span class="n">Vertex</span><span class="o">=</span><span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="si">}</span><span class="s2">, "</span>
                <span class="sa">f</span><span class="s2">"distance: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="si">}</span><span class="s2">, predecessor: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">predecessor</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org3622ec4">
<h2 id="org3622ec4">A Graph Implementation</h2>
<div class="outline-text-2" id="text-org3622ec4">
<div class="highlight">
<pre><span></span><span class="k">class</span> <span class="nc">Graph</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""A graph implementation</span>

<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vertices</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span>
</pre></div>
</div>
<div class="outline-3" id="outline-container-orgc3f993f">
<h3 id="orgc3f993f">Adjacencies</h3>
<div class="outline-text-3" id="text-orgc3f993f">
<p>The book uses an adjacency linked list, but I'll assume that there will be only one edge between each pair of vertices and use a dictionary with sets of adjacent nodes instead.</p>
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">adjacent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">defaultdict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""The dictionary of adjacent vertices"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span>

<span class="nd">@adjacent</span><span class="o">.</span><span class="n">setter</span>
<span class="k">def</span> <span class="nf">adjacent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_adjacent</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Sets the dictionary of adjacent vertices (converting to default dict)</span>

<span class="sd">    Note:</span>
<span class="sd">     This expects the new_adjacent to be a dict of node: set of nodes</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">new_adjacent</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">defaultdict</span><span class="p">:</span>
        <span class="n">new_new_adjacent</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="n">new_adjacent</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">new_new_adjacent</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes</span>
        <span class="n">new_adjacent</span> <span class="o">=</span> <span class="n">new_new_adjacent</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span> <span class="o">=</span> <span class="n">new_adjacent</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org7cb44bb">
<h3 id="org7cb44bb">Vertices</h3>
<div class="outline-text-3" id="text-org7cb44bb">
<p>The representation we're using is an adjacency list, but sometimes you need to traverse the vertices. So I'm going to make an alias to the adjacency list keys, in the assumption that every node in the graph is a key in the dict. This might not be true in a directed graph, so I'll have to revisit it later.</p>
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">vertices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""The vertices in this graph"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vertices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vertices</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vertices</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgf814d2a">
<h3 id="orgf814d2a">Add Item</h3>
<div class="outline-text-3" id="text-orgf814d2a">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_1</span><span class="p">:</span> <span class="n">Vertex</span><span class="p">,</span> <span class="n">node_2</span><span class="p">:</span> <span class="n">Vertex</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Add edge </span>

<span class="sd">    Warning:</span>
<span class="sd">     This assumes an undirected graph, change it for a directed graph</span>

<span class="sd">    Args:</span>
<span class="sd">     node_1: node on one end of the edge</span>
<span class="sd">     node_2: Node on the other end of the edge</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node_1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node_2</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">adjacent</span><span class="p">[</span><span class="n">node_1</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node_2</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">adjacent</span><span class="p">[</span><span class="n">node_2</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node_1</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org970bf5d">
<h3 id="org970bf5d">Getitem</h3>
<div class="outline-text-3" id="text-org970bf5d">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Get the list from the adjacencies dict</span>

<span class="sd">    Args:</span>
<span class="sd">     key: vertex whose list we want</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjacent</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgeb4acb2">
<h3 id="orgeb4acb2">Testing</h3>
<div class="outline-text-3" id="text-orgeb4acb2">
<div class="highlight">
<pre><span></span><span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">be</span><span class="p">,</span> <span class="n">contain</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>

<span class="c1"># software under test</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.graphs</span> <span class="kn">import</span> <span class="n">graph</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.graphs.graph</span> <span class="kn">import</span> <span class="n">Color</span><span class="p">,</span> <span class="n">Graph</span><span class="p">,</span> <span class="n">Vertex</span>

<span class="n">v</span> <span class="o">=</span> <span class="n">Vertex</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">Color</span><span class="o">.</span><span class="n">WHITE</span><span class="p">))</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
<span class="n">v2</span> <span class="o">=</span> <span class="n">Vertex</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">v3</span> <span class="o">=</span> <span class="n">Vertex</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v3</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">adjacent</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v2</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">adjacent</span><span class="p">[</span><span class="n">v</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain</span><span class="p">(</span><span class="n">v2</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="n">v2</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="n">v3</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="n">v3</span><span class="p">])</span><span class="o">.</span><span class="n">not_to</span><span class="p">(</span><span class="n">contain</span><span class="p">(</span><span class="n">v2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org84c10a3">
<h2 id="org84c10a3">Sources</h2>
<div class="outline-text-2" id="text-org84c10a3">
<ul class="org-ul">
<li><a href="posts/clrs/index.html">Introduction To Algorithms (CLRS)</a></li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/red-black-trees-delete/index.html">Red-Black Trees: Delete</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/red-black-trees-delete/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-03-30T18:14:25-07:00" itemprop="datePublished" title="2022-03-30 18:14">2022-03-30 18:14</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/red-black-trees-delete/index.html#org972284d">The Deleter For the Arborist</a></li>
<li><a href="posts/red-black-trees-delete/index.html#org5b470d6">The Deleter</a>
<ul>
<li><a href="posts/red-black-trees-delete/index.html#orgd6923f5">Extra Imports</a></li>
<li><a href="posts/red-black-trees-delete/index.html#org789b23d">The Class</a></li>
<li><a href="posts/red-black-trees-delete/index.html#orga56d0e9">The Tree Setter</a></li>
<li><a href="posts/red-black-trees-delete/index.html#org376ff94">Forester</a></li>
<li><a href="posts/red-black-trees-delete/index.html#orgf238a0c">Transplant</a></li>
<li><a href="posts/red-black-trees-delete/index.html#org8e934d3">Delete</a></li>
<li><a href="posts/red-black-trees-delete/index.html#org602f110">The Fixup</a></li>
<li><a href="posts/red-black-trees-delete/index.html#org366b331">Fixup One Side</a></li>
</ul>
</li>
<li><a href="posts/red-black-trees-delete/index.html#org6b8abe3">Testing</a>
<ul>
<li><a href="posts/red-black-trees-delete/index.html#orga500824">Transplant</a>
<ul>
<li><a href="posts/red-black-trees-delete/index.html#org4a9c58a">The Node is Root</a></li>
<li><a href="posts/red-black-trees-delete/index.html#org729d1b5">The Original Node Is a Left Child</a></li>
<li><a href="posts/red-black-trees-delete/index.html#orgc6d69ba">The Original Node is a Right Child</a></li>
</ul>
</li>
<li><a href="posts/red-black-trees-delete/index.html#org121a1e7">Delete</a></li>
</ul>
</li>
<li><a href="posts/red-black-trees-delete/index.html#org2cfa7c7">A Build-Up and a Tear Down</a></li>
<li><a href="posts/red-black-trees-delete/index.html#org91a5f57">Sources</a></li>
</ul>
</div>
</div>
<p>This is a post on deletings nodes from a tree. It is part of a series of posts starting with <a href="posts/red-black-trees/index.html">this post</a>.</p>
<div class="outline-2" id="outline-container-org972284d">
<h2 id="org972284d">The Deleter For the Arborist</h2>
<div class="outline-text-2" id="text-org972284d">
<p>This adds a property to the Arborist that builds a Deleter object for it.</p>
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Deleter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""A node deleter"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delete</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delete</span> <span class="o">=</span> <span class="n">Deleter</span><span class="p">(</span><span class="n">tree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delete</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org5b470d6">
<h2 id="org5b470d6">The Deleter</h2>
<div class="outline-text-2" id="text-org5b470d6">
<p>The Deleter deletes nodes from a Tree, maintaining the Red-Black Tree Properties.</p>
</div>
<div class="outline-3" id="outline-container-orgd6923f5">
<h3 id="orgd6923f5">Extra Imports</h3>
<div class="outline-text-3" id="text-orgd6923f5">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">bowling.data_structures.red_black_tree.forester</span> <span class="kn">import</span> <span class="n">Forester</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org789b23d">
<h3 id="org789b23d">The Class</h3>
<div class="outline-text-3" id="text-org789b23d">
<div class="highlight">
<pre><span></span><span class="k">class</span> <span class="nc">Deleter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Deletes nodes</span>

<span class="sd">    Args:</span>
<span class="sd">     tree: the RedBlackTree to update</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">:</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">RedBlackTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="n">tree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_forester</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rotate</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orga56d0e9">
<h3 id="orga56d0e9">The Tree Setter</h3>
<div class="outline-text-3" id="text-orga56d0e9">
<div class="highlight">
<pre><span></span><span class="nd">@tree</span><span class="o">.</span><span class="n">setter</span>
<span class="k">def</span> <span class="nf">tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sapling</span><span class="p">:</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">RedBlackTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""stores the tree, resets other objects that used the prior tree"""</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span> <span class="o">=</span> <span class="n">sapling</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_rotate</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_forester</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org376ff94">
<h3 id="org376ff94">Forester</h3>
<div class="outline-text-3" id="text-org376ff94">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">forester</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Forester</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""A forester to measure the tree"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forester</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_forester</span> <span class="o">=</span> <span class="n">Forester</span><span class="p">(</span><span class="n">tree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forester</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgf238a0c">
<h3 id="orgf238a0c">Transplant</h3>
<div class="outline-text-3" id="text-orgf238a0c">
<pre id="rb-transplant" style="display:hidden;">
\begin{algorithm}
\caption{RBTransplant}
\begin{algorithmic}
\INPUT The Tree, the original node and node to replace it
\PROCEDURE{RBTransplant}{\textit{T}, \textit{u}, \textit{v}}

\IF {\textit{u}.p = \textit{T}.\textsc{NIL}}
    \STATE \textit{T}.root $\gets$ \textit{v}
\ELSEIF {\textit{u} = \textit{u}.p.left}
    \STATE \textit{u}.p.left $\gets$ \textit{v}
\ELSE
  \STATE \textit{u}.p.right $\gets$ \textit{v}
\ENDIF

\STATE \textit{v}.p $\gets$ \textit{u}.p

\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">transplant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unwanted</span><span class="p">:</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span>
               <span class="n">replacement</span><span class="p">:</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Replace one node with another in the tree</span>

<span class="sd">    Gives replacement the parent of replaced, doesn't remove</span>
<span class="sd">    parent from replaced</span>

<span class="sd">    Args:</span>
<span class="sd">     unwanted: node to remove</span>
<span class="sd">     replacement: node to replace replaced</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">unwanted</span><span class="o">.</span><span class="n">is_root</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">replacement</span>
    <span class="k">elif</span> <span class="n">unwanted</span><span class="o">.</span><span class="n">is_left</span><span class="p">:</span>
        <span class="n">unwanted</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">replacement</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">unwanted</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">replacement</span>
    <span class="n">replacement</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">unwanted</span><span class="o">.</span><span class="n">parent</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org8e934d3">
<h3 id="org8e934d3">Delete</h3>
<div class="outline-text-3" id="text-org8e934d3">
<pre id="rb-delete" style="display:hidden;">
\begin{algorithm}
\caption{RBDelete}
\begin{algorithmic}
\INPUT The Tree and the node to remove
\PROCEDURE{RBTransplant}{\textit{T}, \textit{z}}

\STATE \textit{y} $\gets$ \textit{z}
\STATE \textit{y-original-color} $\gets$ \textit{y}.color
\IF {\textit{z}.left = \textit{T}.\textsc{NIL}}
    \STATE \textit{x} $\gets$ \textit{z}.right
    \STATE \textsc{RBTransplant}(\textit{T}, \textit{z}, \textit{z}.right)
\ELSEIF {\textit{z}.right = \textit{T}.\textsc{NIL}}
    \STATE \textit{x} $\gets$ \textit{z}.left
    \STATE \textsc{RBTransplant}(\textit{T}, \textit{z}, \textit{z}.left)

\ELSE
  \STATE \textit{y} $\gets$ \textsc{TreeMinimum}(\textit{z}.right)
  \STATE \textit{y-original-color} $\gets$ \textit{y}.color
  \STATE \textit{x} $\gets$ \textit{y}.right
  \IF {\textit{y}.p = \textit{z}}
    \STATE \textit{x}.p $\gets$ \textit{y}
  \ELSE
    \STATE \textsc{RBTransplant}(\textit{T}, \textit{y}, \textit{y}.right)
    \STATE \textit{y}.right $\gets$ \textit{z}.right
    \STATE \textit{y}.right.p $\gets$ \textit{y}
  \ENDIF
  \STATE \textsc{RBTransplant}(\textit{T}, \textit{z}, \textit{y})
  \STATE \textit{y}.left $\gets$ \textit{z}.left
  \STATE \textit{y}.left.p $\gets$ \textit{y}
  \STATE \textit{y}.color $\gets$ \textit{z}.color
\ENDIF

\IF {\textit{y-original-color} = \textbf{BLACK}}
  \STATE \textsc{RBDeleteFixup}(\textit{T}, \textit{x})
\ENDIF
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unwanted</span><span class="p">:</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Delete a node</span>

<span class="sd">    Args:</span>
<span class="sd">     unwanted: the node to delete</span>
<span class="sd">    """</span>
    <span class="n">needs_fixing</span> <span class="o">=</span> <span class="n">unwanted</span><span class="o">.</span><span class="n">is_black</span>

    <span class="k">if</span> <span class="n">unwanted</span><span class="o">.</span><span class="n">left</span> <span class="ow">is</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">LEAF</span><span class="p">:</span>
        <span class="n">unwanted_child</span> <span class="o">=</span> <span class="n">unwanted</span><span class="o">.</span><span class="n">right</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transplant</span><span class="p">(</span><span class="n">unwanted</span><span class="p">,</span> <span class="n">unwanted_child</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">unwanted</span><span class="o">.</span><span class="n">right</span> <span class="ow">is</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">LEAF</span><span class="p">:</span>
        <span class="n">unwanted_child</span> <span class="o">=</span> <span class="n">unwanted</span><span class="o">.</span><span class="n">left</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transplant</span><span class="p">(</span><span class="n">unwanted</span><span class="p">,</span> <span class="n">unwanted_child</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">adopter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forester</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">unwanted</span><span class="o">.</span><span class="n">right</span><span class="p">)</span>        
        <span class="n">needs_fixing</span> <span class="o">=</span> <span class="n">unwanted</span><span class="o">.</span><span class="n">is_black</span>
        <span class="n">unwanted_child</span> <span class="o">=</span> <span class="n">adopter</span><span class="o">.</span><span class="n">right</span>
        <span class="k">if</span> <span class="n">adopter</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="n">unwanted</span><span class="p">:</span>
            <span class="n">unwanted_child</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">adopter</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transplant</span><span class="p">(</span><span class="n">adopter</span><span class="p">,</span> <span class="n">unwanted_child</span><span class="p">)</span>
            <span class="n">adopter</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">unwanted</span><span class="o">.</span><span class="n">right</span>
            <span class="n">adopter</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">adopter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transplant</span><span class="p">(</span><span class="n">unwanted</span><span class="p">,</span> <span class="n">adopter</span><span class="p">)</span>
        <span class="n">adopter</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">unwanted</span><span class="o">.</span><span class="n">left</span>
        <span class="n">adopter</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">adopter</span>
        <span class="n">adopter</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">unwanted</span><span class="o">.</span><span class="n">color</span>
    <span class="k">if</span> <span class="n">needs_fixing</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixup</span><span class="p">(</span><span class="n">unwanted_child</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org602f110">
<h3 id="org602f110">The Fixup</h3>
<div class="outline-text-3" id="text-org602f110">
<pre id="rb-fixup" style="display:hidden;">
\begin{algorithm}
\caption{RBFixup}
\begin{algorithmic}
\INPUT The Tree and the node to check
\PROCEDURE{RBFixup}{\textit{T}, \textit{x}}
\WHILE {\textit{x} $\neq$ \textit{T}.root and \textit{x} = \textbf{BLACK}}
\IF {\textit{x} = \textit{x}.p.left}
\textit{w} $\gets$ \textit{x}.p.right
\IF  \textit{w}.color = \textbf{RED}
\STATE  \textit{w}.color $\gets$ \textbf{BLACK}
\STATE \textit{x}.p.color $\gets$ \textbf{RED}
\STATE \textsc{LeftRodate}(\textit{T}, \textit{x}.p)
\STATE  \textit{w} $\gets$ \textit{x}.p.right
\ENDIF

\IF { \textit{w}.left.color = \textbf{BLACK} and  \textit{w}.right.color = \textbf{BLACK}}
\STATE  \textit{w}.color $\gets$ \textbf{RED}
\STATE \textit{x} $\gets$ \textit{x}.p
\ELSE
\IF { \textit{w}.color=\textbf{BLACK}}
\STATE \textit{w}.left.color $\gets$ \textbf{BLACK}
\STATE  \textit{w}.color $\gets$ \textbf{RED}
\STATE \textsc{RightRotate}(\textit{T},  \textit{w})
\STATE  \textit{w} $\gets$ \textit{x}.p.right
\ENDIF

\STATE  \textit{w}.color $\gets$ \textit{x}.p.color
\STATE \textit{x}.p.color $\gets$ \textbf{BLACK}
\STATE  \textit{w}.right.color $\gets$ \textbf{BLACK}
\STATE \textsc{LeftRotate}(\textit{T}, \textit{x}.p)
\STATE \textit{x} $\gets$ \textit{T}.root
\ENDIF
\ELSE
    // Same as x is left but with left and right swapped
  \ENDIF
\ENDWHILE
\STATE \textit{x}.color $\gets$ \textbf{BLACK}
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">fixup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">)</span><span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Fixup the tree after a node deletion</span>

<span class="sd">    Args:</span>
<span class="sd">     node: the child of the deleted node</span>
<span class="sd">    """</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">node</span><span class="o">.</span><span class="n">is_root</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">is_black</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixup_one_side</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">is_left</span><span class="p">)</span>        
    <span class="n">node</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org366b331">
<h3 id="org366b331">Fixup One Side</h3>
<div class="outline-text-3" id="text-org366b331">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">fixup_one_side</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span> <span class="n">left</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Does either the case where the node is left or node is right"""</span>
    <span class="n">child</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">right</span> <span class="k">if</span> <span class="n">left</span> <span class="k">else</span> <span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">left</span>
    <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">is_red</span><span class="p">:</span>
        <span class="n">child</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span>
        <span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span>
        <span class="n">rotate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate</span><span class="o">.</span><span class="n">left</span> <span class="k">if</span> <span class="n">left</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate</span><span class="o">.</span><span class="n">right</span>
        <span class="n">rotate</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">child</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">right</span> <span class="k">if</span> <span class="n">left</span> <span class="k">else</span> <span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">left</span>
    <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">is_black</span> <span class="ow">and</span> <span class="n">child</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">is_black</span><span class="p">:</span>
        <span class="n">child</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">parent</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">is_black</span><span class="p">:</span>
            <span class="n">grandchild</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">left</span> <span class="k">if</span> <span class="n">left</span> <span class="k">else</span> <span class="n">child</span><span class="o">.</span><span class="n">right</span>
            <span class="n">grandchild</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span>
            <span class="n">child</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span>
            <span class="n">rotate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate</span><span class="o">.</span><span class="n">right</span> <span class="k">if</span> <span class="n">left</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate</span><span class="o">.</span><span class="n">left</span>
            <span class="n">rotate</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="n">child</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">right</span> <span class="k">if</span> <span class="n">left</span> <span class="k">else</span> <span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">left</span>
        <span class="n">child</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">color</span>
        <span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span>
        <span class="n">grandchild</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">right</span> <span class="k">if</span> <span class="n">left</span> <span class="k">else</span> <span class="n">child</span><span class="o">.</span><span class="n">left</span>
        <span class="n">grandchild</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span>
        <span class="n">rotate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate</span><span class="o">.</span><span class="n">left</span> <span class="k">if</span> <span class="n">left</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate</span><span class="o">.</span><span class="n">right</span>
        <span class="n">rotate</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org6b8abe3">
<h2 id="org6b8abe3">Testing</h2>
<div class="outline-text-2" id="text-org6b8abe3">
<div class="highlight">
<pre><span></span><span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">be</span><span class="p">,</span> <span class="n">be_true</span><span class="p">,</span> <span class="n">expect</span>

<span class="c1"># software under test</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.red_black_tree</span> <span class="kn">import</span> <span class="n">tree</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.red_black_tree.arborist</span> <span class="kn">import</span> <span class="n">Arborist</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.red_black_tree.forester</span> <span class="kn">import</span> <span class="n">Forester</span>
</pre></div>
</div>
<div class="outline-3" id="outline-container-orga500824">
<h3 id="orga500824">Transplant</h3>
<div class="outline-text-3" id="text-orga500824"></div>
<div class="outline-4" id="outline-container-org4a9c58a">
<h4 id="org4a9c58a">The Node is Root</h4>
<div class="outline-text-4" id="text-org4a9c58a">
<div class="highlight">
<pre><span></span><span class="n">original</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">replacement</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
<span class="n">arborist</span> <span class="o">=</span> <span class="n">Arborist</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">RedBlackTree</span><span class="p">(</span><span class="n">original</span><span class="p">))</span>
<span class="n">arborist</span><span class="o">.</span><span class="n">delete</span><span class="o">.</span><span class="n">transplant</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="n">replacement</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">arborist</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">replacement</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">replacement</span><span class="o">.</span><span class="n">is_root</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org729d1b5">
<h4 id="org729d1b5">The Original Node Is a Left Child</h4>
<div class="outline-text-4" id="text-org729d1b5">
<div class="highlight">
<pre><span></span><span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="n">root</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">original</span>
<span class="n">arborist</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
<span class="n">arborist</span><span class="o">.</span><span class="n">delete</span><span class="o">.</span><span class="n">transplant</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="n">replacement</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">left</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">replacement</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">replacement</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">root</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgc6d69ba">
<h4 id="orgc6d69ba">The Original Node is a Right Child</h4>
<div class="outline-text-4" id="text-orgc6d69ba">
<div class="highlight">
<pre><span></span><span class="n">original</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">root</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">original</span>
<span class="n">replacement</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">arborist</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
<span class="n">arborist</span><span class="o">.</span><span class="n">delete</span><span class="o">.</span><span class="n">transplant</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="n">replacement</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">right</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">replacement</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">replacement</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">root</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org121a1e7">
<h3 id="org121a1e7">Delete</h3>
</div>
</div>
<div class="outline-2" id="outline-container-org2cfa7c7">
<h2 id="org2cfa7c7">A Build-Up and a Tear Down</h2>
<div class="outline-text-2" id="text-org2cfa7c7">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="c1"># pypi</span>
<span class="kn">import</span> <span class="nn">networkx</span>

<span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"red-black-trees-delete"</span>
<span class="n">OUTPUT</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">"files/posts/</span><span class="si">{</span><span class="n">SLUG</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">OUTPUT</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
    <span class="n">OUTPUT</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">preorder</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span> <span class="n">adjacencies</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Traverse the nodes and build an adjancency dictionary</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">left</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">key</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">left</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">key</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">right</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">((</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">left</span> <span class="ow">and</span> <span class="n">right</span><span class="p">:</span>
                <span class="n">adjacencies</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">left</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">right</span><span class="p">:</span>
                <span class="n">adjacencies</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">adjacencies</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">right</span><span class="p">,)</span>
        <span class="n">preorder</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">adjacencies</span><span class="p">)</span>
        <span class="n">preorder</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="n">adjacencies</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">plot_graph</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="n">adjacencies</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">preorder</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">adjacencies</span><span class="p">)</span>

    <span class="n">graph</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">(</span><span class="n">adjacencies</span><span class="p">)</span>
    <span class="n">pygraph</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">nx_pydot</span><span class="o">.</span><span class="n">to_pydot</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.png"</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">OUTPUT</span><span class="o">/</span><span class="n">filename</span>
    <span class="n">pygraph</span><span class="o">.</span><span class="n">write_png</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"[[img-url:</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">]]"</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">node</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plot_graph</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">"node_1"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/red-black-trees-delete/node_1.png"></p>
</div>
</div>
<div class="outline-2" id="outline-container-org91a5f57">
<h2 id="org91a5f57">Sources</h2>
<div class="outline-text-2" id="text-org91a5f57">
<p>The Main Source:</p>
<ul class="org-ul">
<li><a href="posts/clrs/index.html">Introduction To Algorithms (CLRS)</a></li>
</ul>
<p>The Clearer RB-Insert-Fixup Pseudocode:</p>
<ul class="org-ul">
<li>Design and Analysis of Algorithms: Red-Black Trees [Internet]. [cited 2022 Mar 23]. Available from: <a href="https://gcallah.github.io/algorithms/RedBlackTrees.html">https://gcallah.github.io/algorithms/RedBlackTrees.html</a></li>
</ul>
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("rb-transplant"));
});
</script>
<script>

window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("rb-delete"));
});
</script>
<script>

window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("rb-fixup"));
});
</script></div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/red-black-trees-querying/index.html">Red-Black Trees: Querying</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/red-black-trees-querying/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-03-25T19:15:35-07:00" itemprop="datePublished" title="2022-03-25 19:15">2022-03-25 19:15</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/red-black-trees-querying/index.html#org02c85f2">The Imports</a></li>
<li><a href="posts/red-black-trees-querying/index.html#org77922e0">The Forester</a></li>
<li><a href="posts/red-black-trees-querying/index.html#org53d1c4a">Search</a>
<ul>
<li><a href="posts/red-black-trees-querying/index.html#org8dfec27">The Implementation</a>
<ul>
<li><a href="posts/red-black-trees-querying/index.html#org9e015e4">Testing</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="posts/red-black-trees-querying/index.html#orga7c60a5">Miminum and Maximum</a>
<ul>
<li><a href="posts/red-black-trees-querying/index.html#org0e20359">Mimimum</a>
<ul>
<li><a href="posts/red-black-trees-querying/index.html#orga823b6e">Testing</a></li>
</ul>
</li>
<li><a href="posts/red-black-trees-querying/index.html#org71e351e">Maximum</a>
<ul>
<li><a href="posts/red-black-trees-querying/index.html#orgea3c7b1">Testing</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="posts/red-black-trees-querying/index.html#orgf18bfe8">Height</a></li>
<li><a href="posts/red-black-trees-querying/index.html#org7d02d4c">Black Height</a>
<ul>
<li><a href="posts/red-black-trees-querying/index.html#org720d82a">Testing</a></li>
</ul>
</li>
<li><a href="posts/red-black-trees-querying/index.html#orgdcf863c">Testing</a></li>
</ul>
</div>
</div>
<p><img alt="nil" src="posts/red-black-trees-querying/forester.png"></p>
<div class="outline-2" id="outline-container-org02c85f2">
<h2 id="org02c85f2">The Imports</h2>
<div class="outline-text-2" id="text-org02c85f2">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">bowling.data_structures.red_black_tree</span> <span class="kn">import</span> <span class="n">tree</span> <span class="k">as</span> <span class="n">rb_tree</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org77922e0">
<h2 id="org77922e0">The Forester</h2>
<div class="outline-text-2" id="text-org77922e0">
<p>This is the class to hold the tree and answer questions about it. Most of the methods (except for the red-black-height) are the same as the Binary Search Tree with the main exception being that we need to use the <code>NIL</code> object instead of <code>None</code>. This means that nothing in the <code>tree</code> module can use the <code>Forester</code> directly or we'll end up with a circular reference.</p>
<div class="highlight">
<pre><span></span><span class="k">class</span> <span class="nc">Forester</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""The forester manages the tree</span>

<span class="sd">    Args:</span>
<span class="sd">     tree: tree to manage</span>
<span class="sd">     enforce_properties: check that the black-heights are the same</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">:</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">RedBlackTree</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">enforce_properties</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="n">tree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enforce_properties</span> <span class="o">=</span> <span class="n">enforce_properties</span>
        <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org53d1c4a">
<h2 id="org53d1c4a">Search</h2>
<div class="outline-text-2" id="text-org53d1c4a">
<p>The first thing we'll look at is searching for a Node in a Binary Search Tree. Because of the way the tree is structured the search looks a lot like a <a href="posts/binary-search/index.html">Binary Search</a> where we start at the root of the tree and then work our way downwards, picking the next child to follow based on whether the key we're searching for is greater than the right child's key or less than the left child's key. If it's equal then we've found the node we want.</p>
</div>
<div class="outline-3" id="outline-container-org8dfec27">
<h3 id="org8dfec27">The Implementation</h3>
<div class="outline-text-3" id="text-org8dfec27">
<p>I'll add the iterative version of the Tree Search as a method for our Query class.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Searches the tree for the node with the matching key</span>

<span class="sd">    Args:</span>
<span class="sd">     key: node's key to search for</span>

<span class="sd">    Returns:</span>
<span class="sd">     the node with the key or None if it isn't in the tree</span>
<span class="sd">    """</span>
    <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span>
    <span class="k">while</span> <span class="n">node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">LEAF</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">!=</span> <span class="n">node</span><span class="o">.</span><span class="n">key</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">&lt;</span> <span class="n">node</span><span class="o">.</span><span class="n">key</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">left</span>
        <span class="k">else</span><span class="p">:</span>
           <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">right</span>
    <span class="k">return</span> <span class="n">node</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-org9e015e4">
<h4 id="org9e015e4">Testing</h4>
<div class="outline-text-4" id="text-org9e015e4">
<div class="highlight">
<pre><span></span><span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">be</span><span class="p">,</span> <span class="n">be_none</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.red_black_tree</span> <span class="kn">import</span> <span class="n">tree</span> <span class="k">as</span> <span class="n">rb_tree</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.red_black_tree.forester</span> <span class="kn">import</span> <span class="n">Forester</span>

<span class="n">root</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">RedBlackTree</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">Forester</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">rb_tree</span><span class="o">.</span><span class="n">NIL</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">root</span><span class="p">))</span>

<span class="n">five</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">root</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">five</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">five</span><span class="p">))</span>

<span class="n">root</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">fifteen</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="mi">15</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">fifteen</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orga7c60a5">
<h2 id="orga7c60a5">Miminum and Maximum</h2>
<div class="outline-text-2" id="text-orga7c60a5"></div>
<div class="outline-3" id="outline-container-org0e20359">
<h3 id="org0e20359">Mimimum</h3>
<div class="outline-text-3" id="text-org0e20359">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Returns the node with the smallest key</span>

<span class="sd">    Args:</span>
<span class="sd">     node: a node to use as the starting root</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span>

    <span class="k">while</span> <span class="n">node</span><span class="o">.</span><span class="n">left</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">LEAF</span><span class="p">:</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">left</span>
    <span class="k">return</span> <span class="n">node</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-orga823b6e">
<h4 id="orga823b6e">Testing</h4>
<div class="outline-text-4" id="text-orga823b6e">
<div class="highlight">
<pre><span></span><span class="n">root</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">RedBlackTree</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">Forester</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="n">root</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">root</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">root</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="n">root</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>
<span class="n">root</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>

<span class="n">root</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">right</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">11</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org71e351e">
<h3 id="org71e351e">Maximum</h3>
<div class="outline-text-3" id="text-org71e351e">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Returns the node with the largest key</span>

<span class="sd">    Args:</span>
<span class="sd">     root: subtree root to start at</span>

<span class="sd">    Returns:</span>
<span class="sd">     node with the largest key in tree/subtree</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">root</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span>
    <span class="k">while</span> <span class="n">root</span><span class="o">.</span><span class="n">right</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">LEAF</span><span class="p">:</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">right</span>
    <span class="k">return</span> <span class="n">root</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-orgea3c7b1">
<h4 id="orgea3c7b1">Testing</h4>
<div class="outline-text-4" id="text-orgea3c7b1">
<div class="highlight">
<pre><span></span><span class="n">root</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">RedBlackTree</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">Forester</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="n">root</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">root</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">root</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">max</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">15</span><span class="p">)))</span>

<span class="n">root</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">max</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">17</span><span class="p">)))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">left</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgf18bfe8">
<h2 id="orgf18bfe8">Height</h2>
<div class="outline-text-2" id="text-orgf18bfe8">
<p>The height of the Binary Search Tree is the number of edges from the root of the tree to the furthest node. The algorithms we're looking at here don't use them but I'm going to use height to look at how the order you insert nodes in the tree affects the height.</p>
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">height</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""The length of the longest path starting at the root</span>

<span class="sd">    Returns:</span>
<span class="sd">     number of edges from root to furthest leaf</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_height</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">tree_height</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""The length of the longest path starting at the node</span>

<span class="sd">    Args:</span>
<span class="sd">     the node to start the measurement from</span>

<span class="sd">    Returns:</span>
<span class="sd">     number of edges from root to furthest leaf</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">LEAF</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_height</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_height</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">tree</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">RedBlackTree</span><span class="p">()</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">Forester</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">tree</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

<span class="n">root</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

<span class="n">root</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

<span class="n">root</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

<span class="n">root</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org7d02d4c">
<h2 id="org7d02d4c">Black Height</h2>
<div class="outline-text-2" id="text-org7d02d4c">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">black_height</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""The number of black nodes below the root</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_black_height</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">find_black_height</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Find the number of black nodes below a node</span>

<span class="sd">    Note:</span>
<span class="sd">     This assumes that the starting node is black. In the cases where it's red</span>
<span class="sd">     it will be one more than the true height</span>

<span class="sd">    Args:</span>
<span class="sd">     node: base node to use</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">LEAF</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="n">add_for_color</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">is_black</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_black_height</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">)</span> <span class="o">+</span> <span class="n">add_for_color</span>
    <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_black_height</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="p">)</span> <span class="o">+</span> <span class="n">add_for_color</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enforce_properties</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">left</span> <span class="o">==</span> <span class="n">right</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"Black Height: Left=</span><span class="si">{</span><span class="n">left</span><span class="si">}</span><span class="s2"> Right=</span><span class="si">{</span><span class="n">right</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">((</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">))</span>
</pre></div>
</div>
<div class="outline-3" id="outline-container-org720d82a">
<h3 id="org720d82a">Testing</h3>
<div class="outline-text-3" id="text-org720d82a">
<div class="highlight">
<pre><span></span><span class="n">tree</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">RedBlackTree</span><span class="p">()</span>
<span class="n">forester</span> <span class="o">=</span> <span class="n">Forester</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>

<span class="n">root</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">rb_tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
<span class="n">tree</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
<span class="n">expect</span><span class="p">(</span><span class="n">forester</span><span class="o">.</span><span class="n">black_height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

<span class="n">root</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">rb_tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">forester</span><span class="o">.</span><span class="n">black_height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

<span class="n">root</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">rb_tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">forester</span><span class="o">.</span><span class="n">black_height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="n">root</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">rb_tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">forester</span><span class="o">.</span><span class="n">black_height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

<span class="n">root</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">rb_tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">forester</span><span class="o">.</span><span class="n">black_height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgdcf863c">
<h2 id="orgdcf863c">Testing</h2>
<div class="outline-text-2" id="text-orgdcf863c">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">bowling.data_structures.red_black_tree.tree</span> <span class="kn">import</span> <span class="n">Node</span><span class="p">,</span> <span class="n">RedBlackTree</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.red_black_tree.arborist</span> <span class="kn">import</span> <span class="n">Arborist</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.red_black_tree.forester</span> <span class="kn">import</span> <span class="n">Forester</span>
</pre></div>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/red-black-properties/index.html">Red-Black Properties</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/red-black-properties/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-03-24T16:35:26-07:00" itemprop="datePublished" title="2022-03-24 16:35">2022-03-24 16:35</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<p>These are the properties that need to be maintained for a Red-Black Tree to work correctly (from <a href="posts/clrs/index.html">CLRS</a>).</p>
<ol class="org-ol">
<li>Every Node is either <b>Red</b> or <b>Black</b>.</li>
<li>The Root is <b>Black</b>.</li>
<li>Every Leaf (Nil) is <b>Black</b>.</li>
<li>If a Node is <b>Red</b> then both of its children are <b>Black</b>.</li>
<li>For each Node, all simple paths from the node to descendant leaves contain the same number of <b>Black</b> Nodes.</li>
</ol>
<p>When the properties are true the height of a tree with <b>n</b> nodes is \(O(\log(n))\).</p>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/red-black-trees-insertion/index.html">Red-Black Trees: Insertion</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/red-black-trees-insertion/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-03-23T16:37:50-07:00" itemprop="datePublished" title="2022-03-23 16:37">2022-03-23 16:37</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/red-black-trees-insertion/index.html#org4957953">Insertion</a></li>
<li><a href="posts/red-black-trees-insertion/index.html#orgf17f0de">The Inserter</a>
<ul>
<li><a href="posts/red-black-trees-insertion/index.html#org0dc3d59">The Tree Properties</a></li>
<li><a href="posts/red-black-trees-insertion/index.html#orgafcc644">The Rotator</a></li>
<li><a href="posts/red-black-trees-insertion/index.html#orgba0028c">Insert</a>
<ul>
<li><a href="posts/red-black-trees-insertion/index.html#orgc1c1490">The Pseudocode</a></li>
<li><a href="posts/red-black-trees-insertion/index.html#orgd28628a">Some Code</a></li>
</ul>
</li>
<li><a href="posts/red-black-trees-insertion/index.html#org587bf1e">Insert Fixup</a>
<ul>
<li><a href="posts/red-black-trees-insertion/index.html#org0150b1a">The Pseudocode</a></li>
<li><a href="posts/red-black-trees-insertion/index.html#org093e6f0">The Implementation</a></li>
<li><a href="posts/red-black-trees-insertion/index.html#orgba63bc7">Some Testing</a></li>
</ul>
</li>
<li><a href="posts/red-black-trees-insertion/index.html#orgbdc4f15">The Call</a></li>
<li><a href="posts/red-black-trees-insertion/index.html#orgc492fc6">All Together Now</a></li>
</ul>
</li>
<li><a href="posts/red-black-trees-insertion/index.html#org8ed7063">The Arborist</a>
<ul>
<li>
<ul>
<li><a href="posts/red-black-trees-insertion/index.html#orgad82f0d">The Inserter Attribute</a></li>
</ul>
</li>
<li><a href="posts/red-black-trees-insertion/index.html#orgb443283">Testing</a></li>
</ul>
</li>
<li><a href="posts/red-black-trees-insertion/index.html#org404f516">Sources</a></li>
</ul>
</div>
</div>
<p>This is a post on inserting nodes into a tree. It is part of a series of posts starting with <a href="posts/red-black-trees/index.html">this post</a>.</p>
<div class="outline-2" id="outline-container-org4957953">
<h2 id="org4957953">Insertion</h2>
<div class="outline-text-2" id="text-org4957953">
<p>Because we need to maintain the <a href="posts/red-black-properties/index.html">Red-Black Properties</a> inserting a node into a Red-Black Tree is similar to inserting a node into a Binary Search Tree, but it involves a second function that restores the Red-Black properties if needed.</p>
</div>
</div>
<div class="outline-2" id="outline-container-orgf17f0de">
<h2 id="orgf17f0de">The Inserter</h2>
<div class="outline-text-2" id="text-orgf17f0de">
<div class="highlight">
<pre><span></span><span class="k">class</span> <span class="nc">Inserter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Insert a node into the tree</span>

<span class="sd">    Args:</span>
<span class="sd">      tree: Red-Black-Tree to insert nodes into</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">:</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">RedBlackTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="n">tree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rotate</span><span class="p">:</span> <span class="n">Rotator</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span>
</pre></div>
</div>
<div class="outline-3" id="outline-container-org0dc3d59">
<h3 id="org0dc3d59">The Tree Properties</h3>
<div class="outline-text-3" id="text-org0dc3d59">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">tree</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">RedBlackTree</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""The tree we're inserting nodes into"""</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nd">@tree</span><span class="o">.</span><span class="n">setter</span>
<span class="k">def</span> <span class="nf">tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sapling</span><span class="p">:</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">RedBlackTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""stores the tree, resets other objects that used the prior tree"""</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span> <span class="o">=</span> <span class="n">sapling</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_rotate</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgafcc644">
<h3 id="orgafcc644">The Rotator</h3>
<div class="outline-text-3" id="text-orgafcc644">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Rotator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""A rotator for inserts"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rotate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rotate</span> <span class="o">=</span> <span class="n">Rotator</span><span class="p">(</span><span class="n">tree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rotate</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgba0028c">
<h3 id="orgba0028c">Insert</h3>
<div class="outline-text-3" id="text-orgba0028c"></div>
<div class="outline-4" id="outline-container-orgc1c1490">
<h4 id="orgc1c1490">The Pseudocode</h4>
<div class="outline-text-4" id="text-orgc1c1490">
<pre id="rb-insert" style="display:hidden;">
\begin{algorithm}
\caption{RBInsert}
\begin{algorithmic}
\INPUT The Tree and the Node to insert
\PROCEDURE{RBInsert}{\textit{T}, \textit{z}}

\STATE \textit{y} $\gets$ \textit{T}.\textsc{NIL}
\STATE \textit{x} $\gets$ \textit{T}.root

\WHILE {\textit{x} $\neq$ \textit{T}.\textsc{NIL}}
  \STATE \textit{y} $\gets$ \textit{x}

  \IF {\textit{z}.key &lt; \textit{x}.key}
    \STATE \textit{x} $\gets$ \textit{x}.left
  \ELSE
    \STATE \textit{x} $\gets$ \textit{x}.right
  \ENDIF
\ENDWHILE

\STATE \textit{z}.parent $\gets$ \textit{y}

\IF {\textit{y} = \textit{T}.\textsc{NIL}}
  \STATE \textit{T}.root $\gets$ \textit{z}
\ELIF {\textit{z}.key &lt; \textit{y}.key}
  \STATE \textit{y}.left $\gets$ \textit{z}
\ELSE
  \STATE \textit{y}.right $\gets$ \textit{z}
\ENDIF

\STATE \textit{z}.left $\gets$ \textit{T}.\textsc{NIL}
\STATE \textit{z}.right $\gets$ \textit{T}.\textsc{NIL}
\STATE \textit{z}.color $\gets$ \textbf{RED}
\STATE \textsc{RBInsertFixup}(\textit{T}, \textit{z})

\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre></div>
</div>
<div class="outline-4" id="outline-container-orgd28628a">
<h4 id="orgd28628a">Some Code</h4>
<div class="outline-text-4" id="text-orgd28628a">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Insert the node into to the tree</span>

<span class="sd">    Args:</span>
<span class="sd">     node: node to insert into the tree</span>
<span class="sd">    """</span>
    <span class="n">hunter</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">ROOT_PARENT</span>
    <span class="n">hound</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span>

    <span class="k">while</span> <span class="n">hound</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">LEAF</span><span class="p">:</span>
        <span class="n">hunter</span> <span class="o">=</span> <span class="n">hound</span>
        <span class="k">if</span> <span class="n">node</span> <span class="o">&gt;</span> <span class="n">hound</span><span class="p">:</span>
            <span class="n">hound</span> <span class="o">=</span> <span class="n">hound</span><span class="o">.</span><span class="n">right</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hound</span> <span class="o">=</span> <span class="n">hound</span><span class="o">.</span><span class="n">left</span>

    <span class="n">node</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">hunter</span>

    <span class="k">if</span> <span class="n">hunter</span> <span class="ow">is</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">ROOT_PARENT</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">node</span>
    <span class="n">node</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">LEAF</span>
    <span class="n">node</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">LEAF</span>
    <span class="n">node</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fixup</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">be</span><span class="p">,</span> <span class="n">be_true</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.red_black_tree</span> <span class="kn">import</span> <span class="n">tree</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.red_black_tree.arborist</span> <span class="kn">import</span> <span class="n">Arborist</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.red_black_tree.forester</span> <span class="kn">import</span> <span class="n">Forester</span>

<span class="n">node</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">node_5</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">node_15</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="n">node</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">node_5</span>
<span class="n">node</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">node_15</span>
<span class="n">rb_tree</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">RedBlackTree</span><span class="p">()</span>
<span class="n">arborist</span> <span class="o">=</span> <span class="n">Arborist</span><span class="p">(</span><span class="n">rb_tree</span><span class="p">)</span>

<span class="c1"># case: Root is NIL and new-node's parent is NIL</span>
<span class="n">arborist</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">NIL</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">rb_tree</span><span class="o">.</span><span class="n">root</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>

<span class="c1"># case: Root isn't NIL</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="n">node</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">rb_tree</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">RedBlackTree</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">)</span>
<span class="n">arborist</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="n">rb_tree</span>
<span class="n">arborist</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">rb_tree</span><span class="o">.</span><span class="n">root</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">root</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">root</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">left</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>

<span class="c1"># root is less than inserted node</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">node</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
<span class="n">rb_tree</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">RedBlackTree</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">)</span>
<span class="n">arborist</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="n">rb_tree</span>
<span class="n">arborist</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">rb_tree</span><span class="o">.</span><span class="n">root</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">root</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">root</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">right</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>

<span class="c1"># in all cases</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">NIL</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">NIL</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">is_red</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org587bf1e">
<h3 id="org587bf1e">Insert Fixup</h3>
<div class="outline-text-3" id="text-org587bf1e"></div>
<div class="outline-4" id="outline-container-org0150b1a">
<h4 id="org0150b1a">The Pseudocode</h4>
<div class="outline-text-4" id="text-org0150b1a">
<p>This is a separate function to restore the red-black properties (if we messed them up with the insert). It's mostly from <a href="posts/clrs/index.html">CLRS</a> but they used some kind of weird formatting that made it hard for me to tell what their first <code>else</code> conditional was supposed to contain so I'm using a slightly clearer version that I found at <a href="https://gcallah.github.io/algorithms/RedBlackTrees.html">https://gcallah.github.io/algorithms/RedBlackTrees.html</a>.</p>
<pre id="rb-insert-fixup" style="display:hidden;">
\begin{algorithm}
\caption{RBInsertFixup}
\begin{algorithmic}
\INPUT The Tree and the Node to insert
\PROCEDURE{RBInsertFixup}{\textit{T}, \textit{z}}

\WHILE {\textit{z.parent.color} = \textbf{RED} }
  \IF {\textit{z}.parent = \textit{z}.parent.parent.left}
    \STATE \textit{y} $\gets$ \textit{z}.parent.parent.right

    \IF {\textit{y}.color = \textbf{RED}}
      \STATE \textit{z}.parent.color $\gets$ \textbf{BLACK}
      \STATE \textit{y}.color $\gets$ \textbf{BLACK}
      \STATE \textit{z} $\gets$ \textit{z}.parent.parent
    \ELSE
      \IF {\textit{z} = \textit{z}.parent.right}
        \STATE \textit{z} $\gets$ \textit{z}.parent
        \STATE \textsc{LeftRotate}(\textit{T}, \textit{z})
      \ENDIF
      \STATE \textit{z}.parent.color $\gets$ \textbf{BLACK}
      \STATE \textit{z}.parent.parent.color $\gets$ \textbf{RED}
      \STATE \textsc{RightRotate}(\textit{T}, \textit{z})
    \ENDIF
    
  \ELSE
    \STATE Same as when the parent is left case but with left/right switched
  \ENDIF
  \STATE \textit{T}.root.color $\gets$ \textbf{BLACK}
\ENDWHILE

\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre></div>
</div>
<div class="outline-4" id="outline-container-org093e6f0">
<h4 id="org093e6f0">The Implementation</h4>
<div class="outline-text-4" id="text-org093e6f0"></div>
<ul class="org-ul">
<li><a id="org302db97"></a>One Side<br>
<div class="outline-text-5" id="text-org302db97">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">fixup_side</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span> <span class="n">uncle</span><span class="p">:</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span>
               <span class="n">swap_and_rotate</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">left</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Fixup either the left or the right sides</span>

<span class="sd">    Args:</span>
<span class="sd">     node: the node that we're fixing</span>
<span class="sd">     uncle: the node's parent's sibling</span>
<span class="sd">     swap_and_rotate: whether we need to do a swap and rotation</span>
<span class="sd">     left: if the node's parent is a left child</span>
<span class="sd">    """</span>
    <span class="n">first_rotate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate</span><span class="o">.</span><span class="n">left</span> <span class="k">if</span> <span class="n">left</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate</span><span class="o">.</span><span class="n">right</span>
    <span class="n">final_rotate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate</span><span class="o">.</span><span class="n">right</span> <span class="k">if</span> <span class="n">left</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate</span><span class="o">.</span><span class="n">left</span>

    <span class="k">if</span> <span class="n">uncle</span><span class="o">.</span><span class="n">is_red</span><span class="p">:</span>
        <span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span>
        <span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span>
        <span class="n">uncle</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">swap_and_rotate</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">parent</span>
            <span class="n">first_rotate</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span>
        <span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span>

        <span class="n">final_rotate</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</li>
<li><a id="org75e0930"></a>Both Sides<br>
<div class="outline-text-5" id="text-org75e0930">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">fixup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Fix-up the red-black properties after an insert</span>

<span class="sd">    Args:</span>
<span class="sd">     node: the node that was just inserted</span>
<span class="sd">    """</span>
    <span class="k">while</span> <span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">is_red</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">is_left</span><span class="p">:</span>
            <span class="n">uncle</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">right</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fixup_side</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">uncle</span><span class="p">,</span>
                            <span class="n">swap_and_rotate</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">is_right</span><span class="p">,</span>
                            <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">uncle</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">left</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fixup_side</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">uncle</span><span class="p">,</span>
                            <span class="n">swap_and_rotate</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">is_left</span><span class="p">,</span>
                            <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span>
    <span class="k">return</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="outline-4" id="outline-container-orgba63bc7">
<h4 id="orgba63bc7">Some Testing</h4>
<div class="outline-text-4" id="text-orgba63bc7">
<div class="highlight">
<pre><span></span><span class="c1"># the parent is black</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>
<span class="n">parent</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
<span class="n">parent</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">root</span>
<span class="n">child</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>
<span class="n">child</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
<span class="n">uncle</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
<span class="n">root</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">uncle</span>
<span class="n">rb_tree</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">RedBlackTree</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">)</span>
<span class="n">arborist</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="n">rb_tree</span>
<span class="n">forester</span> <span class="o">=</span> <span class="n">Forester</span><span class="p">(</span><span class="n">rb_tree</span><span class="p">,</span> <span class="n">enforce_properties</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">arborist</span><span class="o">.</span><span class="n">insert</span><span class="o">.</span><span class="n">fixup</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">uncle</span><span class="o">.</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">forester</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">forester</span><span class="o">.</span><span class="n">black_height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="c1"># the parent is a RED left child and the uncle is red</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
<span class="n">parent</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>
<span class="n">parent</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">root</span>
<span class="n">child</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>
<span class="n">child</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
<span class="n">uncle</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>
<span class="n">root</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">uncle</span>
<span class="n">arborist</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">RedBlackTree</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">)</span>
<span class="n">forester</span> <span class="o">=</span> <span class="n">Forester</span><span class="p">(</span><span class="n">arborist</span><span class="o">.</span><span class="n">tree</span><span class="p">,</span> <span class="n">enforce_properties</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">forester</span><span class="o">.</span><span class="n">black_height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">arborist</span><span class="o">.</span><span class="n">insert</span><span class="o">.</span><span class="n">fixup</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">is_black</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">uncle</span><span class="o">.</span><span class="n">is_black</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">forester</span><span class="o">.</span><span class="n">black_height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

<span class="c1"># the parent is a RED left child, the uncle is black, and the node is the left child</span>
<span class="n">parent</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span>
<span class="n">uncle</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span>
<span class="n">child</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span>
<span class="n">child</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">parent</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">child</span>
<span class="n">node_6</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
<span class="n">parent</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">node_6</span>
<span class="n">node_1</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
<span class="n">child</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">node_1</span>
<span class="n">node_3</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
<span class="n">child</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">node_3</span>

<span class="n">arborist</span><span class="o">.</span><span class="n">insert</span><span class="o">.</span><span class="n">fixup</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">arborist</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">right</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">root</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">left</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">node_1</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">right</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">node_3</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">left</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">node_6</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">right</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">uncle</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">forester</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">forester</span><span class="o">.</span><span class="n">black_height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

<span class="c1"># the parent is a RED left child, the uncle is black, and the node is the right child</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
<span class="n">parent</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>
<span class="n">uncle</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
<span class="n">child</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>
<span class="n">parent</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">root</span>
<span class="n">uncle</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">root</span>

<span class="n">node_4</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
<span class="n">parent</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">node_4</span>
<span class="n">parent</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">child</span>
<span class="n">node_7</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
<span class="n">node_9</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
<span class="n">child</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">node_7</span>
<span class="n">child</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">node_9</span>

<span class="n">arborist</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">RedBlackTree</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="n">forester</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="n">arborist</span><span class="o">.</span><span class="n">tree</span>

<span class="n">arborist</span><span class="o">.</span><span class="n">insert</span><span class="o">.</span><span class="n">fixup</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">child</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">arborist</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">left</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">right</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">root</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">left</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">node_4</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">right</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">node_7</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">left</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">node_9</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">right</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">uncle</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">forester</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">forester</span><span class="o">.</span><span class="n">black_height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-orgbdc4f15">
<h3 id="orgbdc4f15">The Call</h3>
<div class="outline-text-3" id="text-orgbdc4f15">
<p>This is just a thing to make it look more like a function than a class.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Inserts the node into the tree</span>

<span class="sd">    this is an alias for the ``insert`` method</span>

<span class="sd">    Args:</span>
<span class="sd">     node: the node to insert </span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgc492fc6">
<h3 id="orgc492fc6">All Together Now</h3>
<div class="outline-text-3" id="text-orgc492fc6">
<div class="highlight">
<pre><span></span><span class="n">rb_tree</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">RedBlackTree</span><span class="p">()</span>
<span class="n">arborist</span> <span class="o">=</span> <span class="n">Arborist</span><span class="p">(</span><span class="n">rb_tree</span><span class="p">)</span>
<span class="n">forester</span> <span class="o">=</span> <span class="n">Forester</span><span class="p">(</span><span class="n">rb_tree</span><span class="p">)</span>
<span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="n">arborist</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">forester</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">forester</span><span class="o">.</span><span class="n">black_height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

<span class="n">node_5</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">arborist</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">node_5</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">forester</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">forester</span><span class="o">.</span><span class="n">black_height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node_5</span><span class="o">.</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">))</span>

<span class="n">node_11</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
<span class="n">arborist</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">node_11</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">forester</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">forester</span><span class="o">.</span><span class="n">black_height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node_11</span><span class="o">.</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">))</span>

<span class="n">node_6</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="n">arborist</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">node_6</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">forester</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">forester</span><span class="o">.</span><span class="n">black_height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node_11</span><span class="o">.</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node_5</span><span class="o">.</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node_6</span><span class="o">.</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">))</span>

<span class="n">node_3</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">arborist</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">node_3</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node_3</span><span class="o">.</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node_5</span><span class="o">.</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">forester</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">forester</span><span class="o">.</span><span class="n">black_height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

<span class="n">node_1</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">arborist</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">node_1</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">forester</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">forester</span><span class="o">.</span><span class="n">black_height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node_1</span><span class="o">.</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node_1</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node_6</span><span class="o">.</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node_5</span><span class="o">.</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">))</span>

<span class="n">node_4</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">arborist</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">node_4</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">forester</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">forester</span><span class="o">.</span><span class="n">black_height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node_4</span><span class="o">.</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">))</span>

<span class="n">node_0</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">arborist</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">node_0</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">forester</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">forester</span><span class="o">.</span><span class="n">black_height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node_3</span><span class="o">.</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node_1</span><span class="o">.</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node_4</span><span class="o">.</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node_0</span><span class="o">.</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">))</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">inorder</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">tree</span><span class="o">.</span><span class="n">LEAF</span><span class="p">:</span>
        <span class="n">inorder</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">color</span><span class="si">}</span><span class="s2">)"</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">", "</span><span class="p">)</span>
        <span class="n">inorder</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org8ed7063">
<h2 id="org8ed7063">The Arborist</h2>
<div class="outline-text-2" id="text-org8ed7063">
<p>The arborist takes care of trees.</p>
<div class="highlight">
<pre><span></span><span class="c1"># this project</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.red_black_tree</span> <span class="kn">import</span> <span class="n">tree</span> <span class="k">as</span> <span class="n">rb_tree</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.red_black_tree.rotator</span> <span class="kn">import</span> <span class="n">Rotator</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">class</span> <span class="nc">Arborist</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""An arborist to take care of trees</span>

<span class="sd">    Args:</span>
<span class="sd">     tree: tree to take care of</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">:</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">RedBlackTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="n">tree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_insert</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delete</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nd">@tree</span><span class="o">.</span><span class="n">setter</span>
<span class="k">def</span> <span class="nf">tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sapling</span><span class="p">:</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">RedBlackTree</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Sets the tree and wipes out other attributes that use it</span>

<span class="sd">    Args:</span>
<span class="sd">     sapling: new tree</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span> <span class="o">=</span> <span class="n">sapling</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_insert</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_delete</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-orgad82f0d">
<h4 id="orgad82f0d">The Inserter Attribute</h4>
<div class="outline-text-4" id="text-orgad82f0d">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Inserter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Something to insert nodes"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_insert</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_insert</span> <span class="o">=</span> <span class="n">Inserter</span><span class="p">(</span><span class="n">tree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_insert</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgb443283">
<h3 id="orgb443283">Testing</h3>
<div class="outline-text-3" id="text-orgb443283">
<div class="highlight">
<pre><span></span><span class="n">arborist</span> <span class="o">=</span> <span class="n">Arborist</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">RedBlackTree</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org404f516">
<h2 id="org404f516">Sources</h2>
<div class="outline-text-2" id="text-org404f516">
<p>The Main Source:</p>
<ul class="org-ul">
<li><a href="posts/clrs/index.html">Introduction To Algorithms (CLRS)</a></li>
</ul>
<p>The Clearer RB-Insert-Fixup Pseudocode:</p>
<ul class="org-ul">
<li>Design and Analysis of Algorithms: Red-Black Trees [Internet]. [cited 2022 Mar 23]. Available from: <a href="https://gcallah.github.io/algorithms/RedBlackTrees.html">https://gcallah.github.io/algorithms/RedBlackTrees.html</a></li>
</ul>
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("rb-insert"));
});
</script>
<script>

window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("rb-insert-fixup"));
});
</script></div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/red-black-trees-rotation/index.html">Red-Black Trees: Rotation</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/red-black-trees-rotation/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-03-21T15:05:47-07:00" itemprop="datePublished" title="2022-03-21 15:05">2022-03-21 15:05</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/red-black-trees-rotation/index.html#orgd953430">What are Rotations?</a></li>
<li><a href="posts/red-black-trees-rotation/index.html#org3c9c155">Left Rotate</a>
<ul>
<li><a href="posts/red-black-trees-rotation/index.html#orgf0e6848">Pseudocode</a></li>
<li><a href="posts/red-black-trees-rotation/index.html#org8f50c9e">Some Code</a>
<ul>
<li><a href="posts/red-black-trees-rotation/index.html#org9b16b0f">The Imports</a></li>
<li><a href="posts/red-black-trees-rotation/index.html#org30414ef">The Rotator</a></li>
<li><a href="posts/red-black-trees-rotation/index.html#orga19aef0">The Left-Rotate</a></li>
<li><a href="posts/red-black-trees-rotation/index.html#orgda3e5c3">Testing It Out</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="posts/red-black-trees-rotation/index.html#orge461eea">Right Rotate</a>
<ul>
<li><a href="posts/red-black-trees-rotation/index.html#org96a1fa8">Pseudocode</a></li>
<li><a href="posts/red-black-trees-rotation/index.html#org15c8570">Some Code</a>
<ul>
<li><a href="posts/red-black-trees-rotation/index.html#org5ce8b84">The Right-Rotate</a></li>
<li><a href="posts/red-black-trees-rotation/index.html#org01a2221">Testing It Out</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="posts/red-black-trees-rotation/index.html#org323bd84">Sources</a></li>
</ul>
</div>
</div>
<p>This is a post on rotating nodes in a tree. It is a continuation of <a href="posts/red-black-trees/index.html">this post</a>.</p>
<div class="outline-2" id="outline-container-orgd953430">
<h2 id="orgd953430">What are Rotations?</h2>
<div class="outline-text-2" id="text-orgd953430">
<p>In the context of a Red-Black Tree, a Rotation involves swapping the position of two nodes (a parent and one of its children) while maintaining the Binary Search Tree Properties. There are two kinds of rotation:</p>
<ul class="org-ul">
<li><b>Right Rotation</b>: The left child is moved into the position of its parent and the former parent becomes the new parent's right child.</li>
<li><b>Left Rotation</b>: The right child is moved into the position of its parent and the former parent becomes the new parent's left child.</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org3c9c155">
<h2 id="org3c9c155">Left Rotate</h2>
<div class="outline-text-2" id="text-org3c9c155">
<p><a href="posts/clrs/index.html">CLRS</a> gives the Left Rotate function so we'll start with that.</p>
</div>
<div class="outline-3" id="outline-container-orgf0e6848">
<h3 id="orgf0e6848">Pseudocode</h3>
<div class="outline-text-3" id="text-orgf0e6848">
<pre id="left-rotate" style="display:hidden;">
\begin{algorithm}
\caption{LeftRotate}
\begin{algorithmic}
\INPUT The Tree and the parent Node to rotate
\PROCEDURE{LeftRotate}{\textit{T}, \textit{x}}

\STATE \textit{y} $\gets$ \textit{x}.right
\STATE \textit{x}.right $\gets$ \textit{y}.left

\IF {\textit{y}.left $\neq$ \textit{T}.\textsc{NIL}}
  \STATE \textit{y}.left.parent $\gets$ \textit{x}
\ENDIF

\STATE \textit{y}.parent $\gets$ \textit{x}.parent

\IF {\textit{x}.parent = \textit{T}.\textsc{NIL}}
 \STATE \textit{T}.root $\gets$ \textit{y}
\ELIF {\textit{x} = \textit{x}.parent.left}
 \STATE \textit{x}.parent.left $\gets$ \textit{y}
\ELSE
 \STATE \textit{x}.parent.right $\gets$ \textit{y}
\ENDIF

\STATE \textit{y}.left $\gets$ \textit{x}
\STATE \textit{x}.parent $\gets$ \textit{y}
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre></div>
</div>
<div class="outline-3" id="outline-container-org8f50c9e">
<h3 id="org8f50c9e">Some Code</h3>
<div class="outline-text-3" id="text-org8f50c9e">
<div class="highlight">
<pre><span></span><span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">be</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>

<span class="kn">import</span> <span class="nn">networkx</span>

<span class="c1"># this project</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.red_black_tree</span> <span class="kn">import</span> <span class="n">tree</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.red_black_tree.arborist</span> <span class="kn">import</span> <span class="n">Arborist</span><span class="p">,</span> <span class="n">Rotator</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"red-black-trees-rotation"</span>
<span class="n">OUTPUT</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"files/posts/</span><span class="si">{</span><span class="n">SLUG</span><span class="si">}</span><span class="s2">/"</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-org9b16b0f">
<h4 id="org9b16b0f">The Imports</h4>
<div class="outline-text-4" id="text-org9b16b0f">
<div class="highlight">
<pre><span></span><span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">attrs</span> <span class="kn">import</span> <span class="n">define</span>

<span class="c1"># this project</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.red_black_tree</span> <span class="kn">import</span> <span class="n">tree</span> <span class="k">as</span> <span class="n">rb_tree</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org30414ef">
<h4 id="org30414ef">The Rotator</h4>
<div class="outline-text-4" id="text-org30414ef">
<div class="highlight">
<pre><span></span><span class="nd">@define</span>
<span class="k">class</span> <span class="nc">Rotator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""A rotator of nodes and their children</span>

<span class="sd">    Args:</span>
<span class="sd">     tree: the tree that the parent belongs to</span>
<span class="sd">    """</span>
    <span class="n">tree</span><span class="p">:</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">RedBlackTree</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orga19aef0">
<h4 id="orga19aef0">The Left-Rotate</h4>
<div class="outline-text-4" id="text-orga19aef0">
<p>This is more-or-less a straight implementation of the Left-Rotate algorithm given above. The main difference is that our Node object automatically sets the parent for a child when the child is set on the node so you won't see the parent</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">left</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Rotates the node with its right child</span>

<span class="sd">    Args:</span>
<span class="sd">     node: the parent node to rotate</span>
<span class="sd">    """</span>
    <span class="n">new_parent</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">right</span>
    <span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="o">=</span> <span class="n">new_parent</span><span class="o">.</span><span class="n">left</span>

    <span class="n">new_parent</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">parent</span>

    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">is_root</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">new_parent</span>
    <span class="n">new_parent</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">node</span>
    <span class="k">return</span>
</pre></div>
<p><b>Note:</b> Because I defined the <code>Node</code> class so that setting any of the three relation attributes (<code>parent</code>, <code>left</code>, <code>right</code>) updates both sides of the link (e.g. setting <code>left</code> also updates <code>left.parent</code>) we don't need the lines of the algorithm that figure out the other side of a newly established link, so the code is a little shorter than the pseudocode.</p>
</div>
</div>
<div class="outline-4" id="outline-container-orgda3e5c3">
<h4 id="orgda3e5c3">Testing It Out</h4>
<div class="outline-text-4" id="text-orgda3e5c3">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">preorder</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span> <span class="n">adjacencies</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Traverse the nodes and build an adjancency dictionary</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">left</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">key</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">left</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">key</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">right</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">((</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">left</span> <span class="ow">and</span> <span class="n">right</span><span class="p">:</span>
                <span class="n">adjacencies</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">left</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">right</span><span class="p">:</span>
                <span class="n">adjacencies</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">adjacencies</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">right</span><span class="p">,)</span>
        <span class="n">preorder</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">adjacencies</span><span class="p">)</span>
        <span class="n">preorder</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="n">adjacencies</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">build_tree</span><span class="p">(</span><span class="n">root_parent</span><span class="p">:</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Build the test-tree</span>

<span class="sd">    Args:</span>
<span class="sd">     - root_parent: The parent of the root-node</span>

<span class="sd">    Returns:</span>
<span class="sd">     Tree, Nodes dict</span>
<span class="sd">    """</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">nodes</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">root_parent</span><span class="p">)</span>

    <span class="n">root</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="k">if</span> <span class="n">root_parent</span> <span class="ow">is</span> <span class="n">tree</span><span class="o">.</span><span class="n">NIL</span> <span class="k">else</span> <span class="n">root_parent</span>
    <span class="n">test_tree</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">RedBlackTree</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">)</span>

    <span class="n">nodes</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">nodes</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>

    <span class="n">nodes</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">nodes</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>

    <span class="n">nodes</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">nodes</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
    <span class="n">nodes</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
    <span class="n">nodes</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">test_tree</span><span class="p">,</span> <span class="n">nodes</span>
</pre></div>
</div>
<ul class="org-ul">
<li><a id="org52d1d56"></a>Nil Parent<br>
<div class="outline-text-5" id="text-org52d1d56">
<p>Our first case will be when the node to swap with its child is root.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">test_nodes</span><span class="p">(</span><span class="n">arborist</span><span class="p">:</span> <span class="n">Arborist</span><span class="p">,</span> <span class="n">nodes</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="n">root_parent</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">parent</span>

    <span class="n">arborist</span><span class="o">.</span><span class="n">rotate</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">root_parent</span> <span class="ow">is</span> <span class="n">tree</span><span class="o">.</span><span class="n">NIL</span><span class="p">:</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">test_tree</span><span class="o">.</span><span class="n">root</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">test_tree</span><span class="o">.</span><span class="n">root</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">root_parent</span><span class="p">))</span>

    <span class="n">expect</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">root_parent</span><span class="p">))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">left</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">right</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">left</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">right</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">8</span><span class="p">]))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">nodes</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">test_tree</span><span class="p">,</span> <span class="n">nodes</span> <span class="o">=</span> <span class="n">build_tree</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">NIL</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">plot_graph</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="n">adjacencies</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">preorder</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">adjacencies</span><span class="p">)</span>

    <span class="n">graph</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">(</span><span class="n">adjacencies</span><span class="p">)</span>
    <span class="n">pygraph</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">nx_pydot</span><span class="o">.</span><span class="n">to_pydot</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
    <span class="n">pygraph</span><span class="o">.</span><span class="n">write_png</span><span class="p">(</span><span class="n">OUTPUT</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.png"</span><span class="p">)</span>
    <span class="k">return</span>

<span class="n">plot_graph</span><span class="p">(</span><span class="n">test_tree</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">"root_left_rotate"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/red-black-trees-rotation/root_left_rotate.png"></p>
<div class="highlight">
<pre><span></span><span class="n">arborist</span> <span class="o">=</span> <span class="n">Arborist</span><span class="p">(</span><span class="n">test_tree</span><span class="p">)</span>
<span class="n">nodes</span> <span class="o">=</span> <span class="n">test_nodes</span><span class="p">(</span><span class="n">arborist</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">plot_graph</span><span class="p">(</span><span class="n">test_tree</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">"root-left-rotated"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/red-black-trees-rotation/root-left-rotated.png"></p>
</div>
</li>
<li><a id="orgb4e6973"></a>Left Child<br>
<div class="outline-text-5" id="text-orgb4e6973">
<p>This is the case where the parent node being demoted is the left-child of its parent.</p>
<div class="highlight">
<pre><span></span><span class="n">parent</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">test_tree</span><span class="p">,</span> <span class="n">nodes</span> <span class="o">=</span> <span class="n">build_tree</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
<span class="n">plot_graph</span><span class="p">(</span><span class="n">test_tree</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">"root_left_left_rotate"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/red-black-trees-rotation/root_left_left_rotate.png"></p>
<div class="highlight">
<pre><span></span><span class="n">parent</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
<span class="n">nodes</span> <span class="o">=</span> <span class="n">test_nodes</span><span class="p">(</span><span class="n">Arborist</span><span class="p">(</span><span class="n">test_tree</span><span class="p">),</span> <span class="n">nodes</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">left</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
<span class="n">plot_graph</span><span class="p">(</span><span class="n">test_tree</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">"root_left_left_rotated"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/red-black-trees-rotation/root_left_left_rotated.png"></p>
</div>
</li>
<li><a id="org771a127"></a>Right Child<br>
<div class="outline-text-5" id="text-org771a127">
<p>This is the case where the parent node being demoted is the right-child of its parent.</p>
<div class="highlight">
<pre><span></span><span class="n">parent</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">parent</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
<span class="n">test_tree</span><span class="p">,</span> <span class="n">nodes</span> <span class="o">=</span> <span class="n">build_tree</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
<span class="n">plot_graph</span><span class="p">(</span><span class="n">test_tree</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">"root_parent_right_rotate"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/red-black-trees-rotation/root_parent_right_rotate.png"></p>
<div class="highlight">
<pre><span></span><span class="n">nodes</span> <span class="o">=</span> <span class="n">test_nodes</span><span class="p">(</span><span class="n">Arborist</span><span class="p">(</span><span class="n">test_tree</span><span class="p">),</span> <span class="n">nodes</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">right</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
<span class="n">plot_graph</span><span class="p">(</span><span class="n">test_tree</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">"root_parent_right_rotated"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/red-black-trees-rotation/root_parent_right_rotated.png"></p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orge461eea">
<h2 id="orge461eea">Right Rotate</h2>
<div class="outline-text-2" id="text-orge461eea">
<p>This will be the Right-Rotate version. Since we saw with the Left Rotate that the <a href="posts/the-red-black-tree/index.html">Node definition</a> reduces some of the code needed for the rotation I'll leave those lines out of this version</p>
</div>
<div class="outline-3" id="outline-container-org96a1fa8">
<h3 id="org96a1fa8">Pseudocode</h3>
<div class="outline-text-3" id="text-org96a1fa8">
<pre id="right-rotate" style="display:hidden;">
\begin{algorithm}
\caption{RightRotate}
\begin{algorithmic}
\INPUT The Tree and the parent Node to rotate
\PROCEDURE{RightRotate}{\textit{T}, \textit{x}}

\STATE \textit{y} $\gets$ \textit{x}.left
\STATE \textit{x}.left $\gets$ \textit{y}.right

\STATE \textit{y}.parent $\gets$ \textit{x}.parent

\IF {\textit{x}.parent = \textit{T}.\textsc{NIL}}
 \STATE \textit{T}.root $\gets$ \textit{y}
\ENDIF

\STATE \textit{y}.right $\gets$ \textit{x}
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>
<p>This makes it a little clearer, I think. What the algorithm is doing is pretty simple. If <code>x</code> is the parent node to rotate with its right child:</p>
<ol class="org-ol">
<li>Move <code>x</code>'s left grandchild up to be <code>x</code>'s left-child.</li>
<li>Set the parent of the prior <code>x.left</code> to be <code>x</code>'s parent.</li>
<li>If <code>x</code> was root, make <code>y</code> root.</li>
<li>Make <code>x</code> the right child of its prior left-child.</li>
</ol>
</div>
</div>
<div class="outline-3" id="outline-container-org15c8570">
<h3 id="org15c8570">Some Code</h3>
<div class="outline-text-3" id="text-org15c8570"></div>
<div class="outline-4" id="outline-container-org5ce8b84">
<h4 id="org5ce8b84">The Right-Rotate</h4>
<div class="outline-text-4" id="text-org5ce8b84">
<p>This is more-or-less a straight implementation of the Right-Rotate algorithm given above.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">right</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">rb_tree</span><span class="o">.</span><span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Rotates the node with its left child</span>

<span class="sd">    Args:</span>
<span class="sd">     node: the parent node to rotate</span>
<span class="sd">    """</span>
    <span class="n">previous_child</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">left</span>
    <span class="n">node</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">previous_child</span><span class="o">.</span><span class="n">right</span>
    <span class="n">previous_child</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">parent</span>

    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">is_root</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">previous_child</span>
    <span class="n">previous_child</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">node</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org01a2221">
<h4 id="org01a2221">Testing It Out</h4>
<div class="outline-text-4" id="text-org01a2221">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">build_right_rotate_tree</span><span class="p">(</span><span class="n">root_parent</span><span class="p">:</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Build the test-tree</span>

<span class="sd">    Args:</span>
<span class="sd">     - root_parent: The parent of the root-node</span>

<span class="sd">    Returns:</span>
<span class="sd">     Tree, Nodes dict</span>
<span class="sd">    """</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">nodes</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">root_parent</span><span class="p">)</span>

    <span class="n">root</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="k">if</span> <span class="n">root_parent</span> <span class="ow">is</span> <span class="n">tree</span><span class="o">.</span><span class="n">NIL</span> <span class="k">else</span> <span class="n">root_parent</span>
    <span class="n">test_tree</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">RedBlackTree</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">)</span>

    <span class="n">nodes</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">nodes</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">nodes</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    <span class="n">nodes</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>

    <span class="n">nodes</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">nodes</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
    <span class="n">nodes</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">nodes</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">test_tree</span><span class="p">,</span> <span class="n">nodes</span>
</pre></div>
</div>
<ul class="org-ul">
<li><a id="orgdad5e55"></a>Nil Parent<br>
<div class="outline-text-5" id="text-orgdad5e55">
<p>Our first case will be when the node to swap with its child is root.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">test_nodes_right</span><span class="p">(</span><span class="n">arborist</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="n">root_parent</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">parent</span>
    <span class="n">arborist</span><span class="o">.</span><span class="n">rotate</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>

    <span class="c1"># check the new root</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">root_parent</span><span class="p">))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">left</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">right</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>

    <span class="n">expect</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">left</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">right</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">8</span><span class="p">]))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">nodes</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">test_tree</span><span class="p">,</span> <span class="n">nodes</span> <span class="o">=</span> <span class="n">build_right_rotate_tree</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">NIL</span><span class="p">)</span>
<span class="n">plot_graph</span><span class="p">(</span><span class="n">test_tree</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">"root_right_rotate"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/red-black-trees-rotation/root_right_rotate.png"></p>
<div class="highlight">
<pre><span></span><span class="n">nodes</span> <span class="o">=</span> <span class="n">test_nodes_right</span><span class="p">(</span><span class="n">Arborist</span><span class="p">(</span><span class="n">test_tree</span><span class="p">),</span> <span class="n">nodes</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">test_tree</span><span class="o">.</span><span class="n">root</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
<span class="n">plot_graph</span><span class="p">(</span><span class="n">test_tree</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">"root_right_rotated"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/red-black-trees-rotation/root_right_rotated.png"></p>
</div>
</li>
<li><a id="org1caf5f5"></a>Left Child<br>
<div class="outline-text-5" id="text-org1caf5f5">
<p>This is the case where the parent node being demoted is the left-child of its parent.</p>
<div class="highlight">
<pre><span></span><span class="n">parent</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">test_tree</span><span class="p">,</span> <span class="n">nodes</span> <span class="o">=</span> <span class="n">build_right_rotate_tree</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
<span class="n">plot_graph</span><span class="p">(</span><span class="n">test_tree</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">"root_right_left_rotate"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/red-black-trees-rotation/root_right_left_rotate.png"></p>
<div class="highlight">
<pre><span></span><span class="n">parent</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
<span class="n">nodes</span> <span class="o">=</span> <span class="n">test_nodes_right</span><span class="p">(</span><span class="n">Arborist</span><span class="p">(</span><span class="n">test_tree</span><span class="p">),</span> <span class="n">nodes</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">left</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
<span class="n">plot_graph</span><span class="p">(</span><span class="n">test_tree</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">"root-right-left-rotated"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/red-black-trees-rotation/root-right-left-rotated.png"></p>
</div>
</li>
<li><a id="orge64c563"></a>Right Child<br>
<div class="outline-text-5" id="text-orge64c563">
<p>This is the case where the parent node being demoted is the right-child of its parent.</p>
<div class="highlight">
<pre><span></span><span class="n">parent</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">test_tree</span><span class="p">,</span> <span class="n">nodes</span> <span class="o">=</span> <span class="n">build_right_rotate_tree</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
<span class="n">plot_graph</span><span class="p">(</span><span class="n">test_tree</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">"root_right_right_rotate"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/red-black-trees-rotation/root_right_right_rotate.png"></p>
<div class="highlight">
<pre><span></span><span class="n">parent</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
<span class="n">nodes</span> <span class="o">=</span> <span class="n">test_nodes_right</span><span class="p">(</span><span class="n">Arborist</span><span class="p">(</span><span class="n">test_tree</span><span class="p">),</span> <span class="n">nodes</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">right</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
<span class="n">plot_graph</span><span class="p">(</span><span class="n">test_tree</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s2">"root_right_right_rotated"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/red-black-trees-rotation/root_right_right_rotated.png"></p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org323bd84">
<h2 id="org323bd84">Sources</h2>
<div class="outline-text-2" id="text-org323bd84">
<ul class="org-ul">
<li><a href="posts/clrs/index.html">Introduction To Algorithms (CLRS)</a></li>
</ul>
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("left-rotate"));
});
</script>
<script>

window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("right-rotate"));
});
</script></div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/the-red-black-tree/index.html">The Red-Black Tree</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/the-red-black-tree/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-03-19T15:58:42-07:00" itemprop="datePublished" title="2022-03-19 15:58">2022-03-19 15:58</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/the-red-black-tree/index.html#org8265c32">Beginning</a>
<ul>
<li><a href="posts/the-red-black-tree/index.html#org39b2167">Imports</a></li>
<li><a href="posts/the-red-black-tree/index.html#org6f11fbf">Set Up</a></li>
</ul>
</li>
<li><a href="posts/the-red-black-tree/index.html#org0098489">Middle</a>
<ul>
<li><a href="posts/the-red-black-tree/index.html#orgefb9f1f">Imports</a></li>
<li><a href="posts/the-red-black-tree/index.html#org7607003">The Nil Node and Colors</a>
<ul>
<li><a href="posts/the-red-black-tree/index.html#org19fa602">Color</a></li>
<li><a href="posts/the-red-black-tree/index.html#orgfe4f615">The Nil Node</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="posts/the-red-black-tree/index.html#orge32b909">The Node</a>
<ul>
<li><a href="posts/the-red-black-tree/index.html#org869d390">Properties</a>
<ul>
<li><a href="posts/the-red-black-tree/index.html#orgf373989">Parent</a></li>
<li><a href="posts/the-red-black-tree/index.html#org5f4f010">Left</a></li>
<li><a href="posts/the-red-black-tree/index.html#orgc5d3907">Right</a></li>
</ul>
</li>
<li><a href="posts/the-red-black-tree/index.html#org3904e1d">Comparisons</a>
<ul>
<li><a href="posts/the-red-black-tree/index.html#orge1234cb">Equal</a></li>
<li><a href="posts/the-red-black-tree/index.html#orge19955a">Less Than</a></li>
<li><a href="posts/the-red-black-tree/index.html#orgb8b4ef5">Less Than or Equal</a></li>
</ul>
</li>
<li><a href="posts/the-red-black-tree/index.html#org10fa427">State Properties</a>
<ul>
<li><a href="posts/the-red-black-tree/index.html#org00b7cba">Is Left</a></li>
<li><a href="posts/the-red-black-tree/index.html#orge99b30f">Is Right</a></li>
<li><a href="posts/the-red-black-tree/index.html#org8b2f2ad">Is Red</a></li>
<li><a href="posts/the-red-black-tree/index.html#orge8843c5">Is Black</a></li>
<li><a href="posts/the-red-black-tree/index.html#orgcd3e1a8">Is Root</a></li>
</ul>
</li>
<li><a href="posts/the-red-black-tree/index.html#orgf275e9e">Check Nodes</a></li>
<li><a href="posts/the-red-black-tree/index.html#org5fc78c9">String Output</a></li>
<li><a href="posts/the-red-black-tree/index.html#orgeb00712">Testing</a>
<ul>
<li><a href="posts/the-red-black-tree/index.html#org91d6912">Imports</a></li>
<li><a href="posts/the-red-black-tree/index.html#org60ff0cf">One Node</a></li>
<li><a href="posts/the-red-black-tree/index.html#org7b69ba9">Check the Comparisons</a></li>
<li><a href="posts/the-red-black-tree/index.html#orgeb79bdc">Check the Two-Way Updates.</a></li>
<li><a href="posts/the-red-black-tree/index.html#org424d2c4">The Check Node Method</a></li>
<li><a href="posts/the-red-black-tree/index.html#org3ac6db3">Check the Red-Black Properties</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="posts/the-red-black-tree/index.html#orgbe757ef">The Red-Black Tree</a></li>
</ul>
</div>
</div>
<p>This is a post that implements the Node for a Red-Black Tree. It is a continuation of <a href="posts/red-black-trees/index.html">this post</a>.</p>
<div class="outline-2" id="outline-container-org8265c32">
<h2 id="org8265c32">Beginning</h2>
<div class="outline-text-2" id="text-org8265c32">
<p>I'm going to implement a Node and Red-Black Tree so that I can explore it further in other posts.</p>
</div>
<div class="outline-3" id="outline-container-org39b2167">
<h3 id="org39b2167">Imports</h3>
<div class="outline-text-3" id="text-org39b2167">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org6f11fbf">
<h3 id="org6f11fbf">Set Up</h3>
<div class="outline-text-3" id="text-org6f11fbf">
<div class="highlight">
<pre><span></span><span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"the-red-black-tree"</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">"files/posts/"</span><span class="p">)</span><span class="o">/</span><span class="n">SLUG</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">OUTPUT_PATH</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
    <span class="n">OUTPUT_PATH</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org0098489">
<h2 id="org0098489">Middle</h2>
<div class="outline-text-2" id="text-org0098489">
<p>This is the basic structure of our tree.</p>
<p><img alt="nil" src="posts/the-red-black-tree/rb-tree.png"></p>
</div>
<div class="outline-3" id="outline-container-orgefb9f1f">
<h3 id="orgefb9f1f">Imports</h3>
<div class="outline-text-3" id="text-orgefb9f1f">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>

<span class="c1"># this project</span>
<span class="kn">from</span> <span class="nn">bowling.types</span> <span class="kn">import</span> <span class="n">Orderable</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org7607003">
<h3 id="org7607003">The Nil Node and Colors</h3>
<div class="outline-text-3" id="text-org7607003">
<p>I'm going to set up an Enum for the Colors and a Node instance for the NIL object. I originally made the NIL from a namedtuple, but as I've been adding features to the Node class it's become harder to work with.</p>
<p><b>Note:</b> The <a href="https://docs.python.org/3/library/enum.html">python Enum</a> uses object ID as the way to see if two things are equal, not their values. You can get around it, but since both the colors and the Nil are meant only to be used internally by the tree, not by the end user, I'm going to leave it as is. This means that to do things like check the color outside of the <code>tree</code> module that I'm creating, you have to import the module and refer to the Color or NIL using the module (e.g. <code>tree.Color</code>), otherwise you might end up with some funky problems where things that look equal aren't because they are actually different objects.</p>
</div>
<div class="outline-4" id="outline-container-org19fa602">
<h4 id="org19fa602">Color</h4>
<div class="outline-text-4" id="text-org19fa602">
<div class="highlight">
<pre><span></span><span class="k">class</span> <span class="nc">Color</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""red or black"""</span>
    <span class="n">RED</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">BLACK</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">bowling.data_structures.red_black_tree</span> <span class="kn">import</span> <span class="n">tree</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>

<span class="n">red</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span>
<span class="nb">print</span><span class="p">(</span><span class="n">red</span> <span class="ow">is</span> <span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">red</span> <span class="o">==</span> <span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">red</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
<pre class="example">
Color.RED
Color.BLACK
True
True
False
</pre>
<p>Note that last case (<code>print(red==1)</code>). It's <code>False</code> because I'm using an Enum. We could switch it to an <a href="https://docs.python.org/3/library/enum.html#intenum">IntEnum</a> and allow integers but for now I'm sticking to the Enum to see how well it works.</p>
</div>
</div>
<div class="outline-4" id="outline-container-orgfe4f615">
<h4 id="orgfe4f615">The Nil Node</h4>
<div class="outline-text-4" id="text-orgfe4f615">
<p><b>Note:</b> We have a little bit of a chicken or the egg problem here - I want to check for NILs in the Node Class methods which requires me to define it before defining the Node, so even though the NIL is a special case of the Node, we can't actually use the Node class to create it. It just has to be duck typed enough to be used in the methods.</p>
<div class="highlight">
<pre><span></span><span class="n">NIL_KEY</span> <span class="o">=</span> <span class="s2">"NIL"</span>
<span class="n">NIL</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span>
    <span class="s2">"NIL"</span><span class="p">,</span> <span class="s2">"key color parent left right is_red is_black"</span><span class="p">,</span>
    <span class="n">defaults</span><span class="o">=</span><span class="p">[</span><span class="n">NIL_KEY</span><span class="p">,</span> <span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">])()</span>
<span class="n">LEAF</span> <span class="o">=</span> <span class="n">NIL</span>
<span class="n">ROOT_PARENT</span> <span class="o">=</span> <span class="n">NIL</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">NIL</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">NIL</span><span class="o">.</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">))</span>
</pre></div>
<pre class="example">
NIL(key='NIL', color=&lt;Color.BLACK: 2&gt;, parent=None, left=None, right=None, is_red=False, is_black=True)
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orge32b909">
<h2 id="orge32b909">The Node</h2>
<div class="outline-text-2" id="text-orge32b909">
<p>The Node for a red-black tree is the same as the <a href="posts/binary-search-tree-node/index.html">Binary Search Tree Node</a> except that it has the <code>color</code> attribute. But, since I'm doing integrity checks in the object that also means that the checks have to be updated to take into consideration the Red-Black Tree Properties.</p>
<p>As part of the Insert Node method the new node gets set to RED, so I'm not going to require passing the color in.</p>
<div class="highlight">
<pre><span></span><span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""A Node in a Binary Search Tree</span>

<span class="sd">    Args:</span>
<span class="sd">     key: item to compare nodes</span>
<span class="sd">     color: RED or BLACK</span>
<span class="sd">     parent: parent of this node</span>
<span class="sd">     left: left child</span>
<span class="sd">     right: right child</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Orderable</span><span class="p">,</span> <span class="n">color</span><span class="p">:</span> <span class="n">Color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">parent</span><span class="p">:</span> <span class="n">Node</span><span class="o">=</span><span class="n">NIL</span><span class="p">,</span>
                 <span class="n">left</span><span class="p">:</span> <span class="n">Node</span><span class="o">=</span><span class="n">NIL</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="n">Node</span><span class="o">=</span><span class="n">NIL</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_left</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">left</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_right</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">right</span>
        <span class="k">return</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">node</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">))</span>
</pre></div>
</div>
<div class="outline-3" id="outline-container-org869d390">
<h3 id="org869d390">Properties</h3>
<div class="outline-text-3" id="text-org869d390"></div>
<div class="outline-4" id="outline-container-orgf373989">
<h4 id="orgf373989">Parent</h4>
<div class="outline-text-4" id="text-orgf373989">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Node</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""The parent of this node"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">NIL</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span>

<span class="nd">@parent</span><span class="o">.</span><span class="n">setter</span>
<span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Sets the parent and updates the parent</span>

<span class="sd">    Warning:</span>
<span class="sd">     this will clobber the parent's child if there's a node where this should</span>
<span class="sd">    be</span>

<span class="sd">    Args:</span>
<span class="sd">     parent: to add to self</span>

<span class="sd">    Raises:</span>
<span class="sd">     AssertionError if parent and self have same key</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">parent_</span> <span class="ow">is</span> <span class="n">NIL</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">parent_</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">parent_</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Self (</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">) cannot equal parent (</span><span class="si">{</span><span class="n">parent_</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>

    <span class="c1"># since the left and right assignments update the parent</span>
    <span class="c1"># we need a hack to get around the setters or you end up</span>
    <span class="c1"># with an infinite loop - we set left, they set parent, we set left,...</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="o">&lt;</span> <span class="n">parent_</span><span class="p">:</span>
        <span class="n">parent_</span><span class="o">.</span><span class="n">_left</span> <span class="o">=</span> <span class="bp">self</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">parent_</span><span class="o">.</span><span class="n">_right</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">parent_</span>        
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org5f4f010">
<h4 id="org5f4f010">Left</h4>
<div class="outline-text-4" id="text-org5f4f010">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">left</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Node</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""The left child"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_left</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_left</span> <span class="o">=</span> <span class="n">NIL</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_left</span>

<span class="nd">@left</span><span class="o">.</span><span class="n">setter</span>
<span class="k">def</span> <span class="nf">left</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_left</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Sets the left and its parent</span>

<span class="sd">    Raises:</span>
<span class="sd">     AssertionError if left isn't less than self</span>

<span class="sd">    Args:</span>
<span class="sd">     new_left: a node to be the left child or None</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">new_left</span> <span class="ow">is</span> <span class="n">NIL</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_left</span> <span class="o">=</span> <span class="n">new_left</span>
        <span class="k">return</span>

    <span class="k">assert</span> <span class="n">new_left</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"Left (</span><span class="si">{</span><span class="n">new_left</span><span class="si">}</span><span class="s2"> not &lt; self </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">)"</span>
    <span class="n">new_left</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_left</span> <span class="o">=</span> <span class="n">new_left</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgc5d3907">
<h4 id="orgc5d3907">Right</h4>
<div class="outline-text-4" id="text-orgc5d3907">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">right</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Node</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""The right child"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_right</span> <span class="o">=</span> <span class="n">NIL</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_right</span>

<span class="nd">@right</span><span class="o">.</span><span class="n">setter</span>
<span class="k">def</span> <span class="nf">right</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_right</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Sets the right and its parent</span>

<span class="sd">    Raises:</span>
<span class="sd">     AssertionError if right isn't greater than self</span>

<span class="sd">    Args:</span>
<span class="sd">     new_right: a node to be the right child or None</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">new_right</span> <span class="ow">is</span> <span class="n">NIL</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_right</span> <span class="o">=</span> <span class="n">new_right</span>
        <span class="k">return</span>

    <span class="k">assert</span> <span class="n">new_right</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"right (</span><span class="si">{</span><span class="n">new_right</span><span class="si">}</span><span class="s2"> not &gt; self (</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">)"</span>
    <span class="n">new_right</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_right</span> <span class="o">=</span> <span class="n">new_right</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org3904e1d">
<h3 id="org3904e1d">Comparisons</h3>
<div class="outline-text-3" id="text-org3904e1d">
<p>These are convenience methods to make it so that you can compare the node-objects without referring to the key (see the <a href="https://docs.python.org/3/reference/datamodel.html#object.__lt__">python Data Model documentation</a>). In reading the documentation I thought that you had to implement everything, but after implementing <i>less than</i> and <i>less than or equal to</i> the <i>greater than</i> and <i>greater than or equal to</i> comparisons started to work. I guess if you don't implement them they just take the negative of the less than cases.</p>
</div>
<div class="outline-4" id="outline-container-orge1234cb">
<h4 id="orge1234cb">Equal</h4>
<div class="outline-text-4" id="text-orge1234cb">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Check if the other node has an equal key</span>

<span class="sd">    """</span>
    <span class="k">return</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">"key"</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">key</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orge19955a">
<h4 id="orge19955a">Less Than</h4>
<div class="outline-text-4" id="text-orge19955a">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""See if this key is less than the other's</span>

<span class="sd">    Raises:</span>
<span class="sd">     AttributeError: the other thing doesn't have a key</span>

<span class="sd">    Returns:</span>
<span class="sd">     self &lt; other</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">"key"</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"'&lt;' not supported between '</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">' "</span>
                             <span class="sa">f</span><span class="s2">"and '(</span><span class="si">{</span><span class="n">other</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="si">}</span><span class="s2">'"</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">key</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgb8b4ef5">
<h4 id="orgb8b4ef5">Less Than or Equal</h4>
<div class="outline-text-4" id="text-orgb8b4ef5">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""See if this key is less than or equal to other's</span>

<span class="sd">    Raises:</span>
<span class="sd">     AttributeError: other doesn't have key</span>

<span class="sd">    Returns:</span>
<span class="sd">     self &lt;= other</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">"key"</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"'&lt;' not supported between '</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">' "</span>
                        <span class="s2">"and '{type(other)}'"</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">key</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org10fa427">
<h3 id="org10fa427">State Properties</h3>
<div class="outline-text-3" id="text-org10fa427"></div>
<div class="outline-4" id="outline-container-org00b7cba">
<h4 id="org00b7cba">Is Left</h4>
<div class="outline-text-4" id="text-org00b7cba">
<p>Is this a left-child node?</p>
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">is_left</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""True if this node is a left child"""</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">left</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">expect</span><span class="p">,</span> <span class="n">be_true</span>

<span class="n">child</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">parent</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">parent</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">child</span>
<span class="n">expect</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">is_left</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">is_left</span><span class="p">)</span><span class="o">.</span><span class="n">to_not</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orge99b30f">
<h4 id="orge99b30f">Is Right</h4>
<div class="outline-text-4" id="text-orge99b30f">
<p>Is the node a right child?</p>
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">is_right</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""True if this node is a right child"""</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">right</span> <span class="ow">is</span> <span class="bp">self</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">parent</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">child</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="n">parent</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">child</span>

<span class="n">expect</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">is_right</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">is_left</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">is_right</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org8b2f2ad">
<h4 id="org8b2f2ad">Is Red</h4>
<div class="outline-text-4" id="text-org8b2f2ad">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">is_red</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""True if the node is colored red"""</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="ow">is</span> <span class="n">Color</span><span class="o">.</span><span class="n">RED</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">node</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">is_red</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
<span class="n">node</span><span class="o">.</span><span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">is_red</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orge8843c5">
<h4 id="orge8843c5">Is Black</h4>
<div class="outline-text-4" id="text-orge8843c5">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">is_black</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""True if the node is colored black"""</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="ow">is</span> <span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">node</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">is_black</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
<span class="n">node</span><span class="o">.</span><span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">is_black</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgcd3e1a8">
<h4 id="orgcd3e1a8">Is Root</h4>
<div class="outline-text-4" id="text-orgcd3e1a8">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">is_root</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""True if the node is the root"""</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="n">NIL</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">node</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">is_root</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
<span class="n">parent</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
<span class="n">parent</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">node</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">is_root</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">is_root</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-orgf275e9e">
<h3 id="orgf275e9e">Check Nodes</h3>
<div class="outline-text-3" id="text-orgf275e9e">
<p>This is a convenience method to check if a node and its sub-trees maintain the Binary Search Tree Property. It calls the children too so that the whole tree can be checked by calling this on the root. Now that there's checks when the attributes are set this isn't quite as necessary. The only time you might need it is if the attributes are set directly instead of using the setter.</p>
<p><b>Note:</b> Although the <i>Binary Search Tree Property</i> allows duplicate keys, once you start doing things with the tree like inserting and deleting nodes it causes problems. Also, it's not likely that the keys are what you would be most interested in when using a tree, it would be the data associated with the node, so what would it mean to have two different items associated with the same key? There are probably uses for this, but to make it simpler I'm going to treat the keys more like dictionary keys and say that it's a mistake to have duplicates.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">check_state</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Checks that the Binary Search Tree Property holds</span>

<span class="sd">    Raises:</span>
<span class="sd">     AssertionError: Binary Search Tree Property violated or duplicates exist</span>
<span class="sd">    """</span>
    <span class="c1"># red-black property 1: every node is either red or black</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="ow">in</span> <span class="p">(</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">,</span> <span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">),</span> <span class="sa">f</span><span class="s2">"Invalid Color: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="si">}</span><span class="s2">"</span>

    <span class="c1"># red-black property 4: if a node is red, both children are black</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="ow">is</span> <span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">:</span>
        <span class="k">assert</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">color</span> <span class="ow">is</span> <span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">color</span> <span class="ow">is</span> <span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">),</span>\
            <span class="p">(</span><span class="sa">f</span><span class="s2">"Parent: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="si">}</span><span class="s2"> Left: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">color</span><span class="si">}</span><span class="s2"> "</span>
             <span class="sa">f</span><span class="s2">"Right: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">color</span><span class="si">}</span><span class="s2">. "</span>
             <span class="s2">"Both Children of a Red parent must be Black"</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NIL</span><span class="p">:</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"Left: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="si">}</span><span class="s2"> not &lt; Self: </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">check_state</span><span class="p">()</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NIL</span><span class="p">:</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"Right: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="si">}</span><span class="s2"> not &gt; Self: </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">check_state</span><span class="p">()</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org5fc78c9">
<h3 id="org5fc78c9">String Output</h3>
<div class="outline-text-3" id="text-org5fc78c9">
<p>This is to make it a little easier to print.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""The key as a string"""</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgeb00712">
<h3 id="orgeb00712">Testing</h3>
<div class="outline-text-3" id="text-orgeb00712">
<p>I'll have to break this up later.</p>
</div>
<div class="outline-4" id="outline-container-org91d6912">
<h4 id="org91d6912">Imports</h4>
<div class="outline-text-4" id="text-org91d6912">
<div class="highlight">
<pre><span></span><span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">be</span><span class="p">,</span>
    <span class="n">be_above</span><span class="p">,</span>
    <span class="n">be_above_or_equal</span><span class="p">,</span>
    <span class="n">be_below</span><span class="p">,</span>
    <span class="n">be_below_or_equal</span><span class="p">,</span>
    <span class="n">be_none</span><span class="p">,</span>
    <span class="n">equal</span><span class="p">,</span>
    <span class="n">expect</span><span class="p">,</span>
    <span class="n">raise_error</span>
<span class="p">)</span>

<span class="c1"># software under test</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.red_black_tree</span> <span class="kn">import</span> <span class="n">tree</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org60ff0cf">
<h4 id="org60ff0cf">One Node</h4>
<div class="outline-text-4" id="text-org60ff0cf">
<div class="highlight">
<pre><span></span><span class="n">parent</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>
<span class="n">parent</span><span class="o">.</span><span class="n">check_state</span><span class="p">()</span>

<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">left</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">NIL</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">right</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">NIL</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">NIL</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org7b69ba9">
<h4 id="org7b69ba9">Check the Comparisons</h4>
<div class="outline-text-4" id="text-org7b69ba9">
<div class="highlight">
<pre><span></span><span class="n">uncle</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">uncle</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">uncle</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_below</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">uncle</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_below_or_equal</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span>

<span class="n">brother</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">brother</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_above</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">brother</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_above_or_equal</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span>

<span class="c1"># I'm still deciding who's responsible for checking if a node exists</span>
<span class="c1"># for now I'll copy what happens when None is compared to ints</span>
<span class="n">expect</span><span class="p">(</span><span class="n">brother</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">uncle</span><span class="o">.</span><span class="n">parent</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">brother</span> <span class="o">&lt;</span> <span class="n">uncle</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">raise_error</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">brother</span><span class="o">.</span><span class="n">parent</span> <span class="o">&gt;</span> <span class="n">uncle</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">raise_error</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgeb79bdc">
<h4 id="orgeb79bdc">Check the Two-Way Updates.</h4>
<div class="outline-text-4" id="text-orgeb79bdc"></div>
<ul class="org-ul">
<li><a id="orge82ed54"></a>Set the Parent<br>
<div class="outline-text-5" id="text-orge82ed54">
<p>In the constructor.</p>
<div class="highlight">
<pre><span></span><span class="n">parent</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>

<span class="n">left</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">left</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">left</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">left</span><span class="p">))</span>

<span class="n">right</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">right</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">right</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">right</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">bad_parent</span><span class="p">():</span>
    <span class="n">left</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                     <span class="n">parent</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">),</span>
                     <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
    <span class="k">return</span>

<span class="n">expect</span><span class="p">(</span><span class="n">bad_parent</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">raise_error</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">))</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">parent</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
<span class="n">left</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>
<span class="n">left</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>

<span class="n">expect</span><span class="p">(</span><span class="n">left</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">left</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">left</span><span class="p">))</span>

<span class="n">right</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
<span class="n">right</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
<span class="n">expect</span><span class="p">(</span><span class="n">right</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">right</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">right</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">bad_parent</span><span class="p">():</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>
    <span class="n">left</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
    <span class="n">left</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
    <span class="k">return</span>

<span class="n">expect</span><span class="p">(</span><span class="n">bad_parent</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">raise_error</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><a id="org56af91a"></a>Set The Left Child<br>
<div class="outline-text-5" id="text-org56af91a">
<div class="highlight">
<pre><span></span><span class="n">left</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>
<span class="n">parent</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">left</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">left</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">left</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span>

<span class="n">parent</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>
<span class="n">parent</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">left</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">left</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">left</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">left</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><a id="org922b012"></a>Set The Right Child<br>
<div class="outline-text-5" id="text-org922b012">
<div class="highlight">
<pre><span></span><span class="n">right</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>
<span class="n">parent</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">right</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">right</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">right</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span>

<span class="n">parent</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>
<span class="n">parent</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">right</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">right</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">right</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">right</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="outline-4" id="outline-container-org424d2c4">
<h4 id="org424d2c4">The Check Node Method</h4>
<div class="outline-text-4" id="text-org424d2c4">
<div class="highlight">
<pre><span></span><span class="n">uncle</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>
<span class="n">parent</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
<span class="n">parent</span><span class="o">.</span><span class="n">check_state</span><span class="p">()</span>

<span class="c1"># parent is root</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">check_state</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span><span class="p">(</span><span class="n">raise_error</span><span class="p">)</span>

<span class="c1"># parent is right child</span>
<span class="n">parent</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">uncle</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">check_state</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span><span class="p">(</span><span class="n">raise_error</span><span class="p">)</span>

<span class="c1"># parent is left child</span>
<span class="n">parent</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">brother</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">check_state</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span><span class="p">(</span><span class="n">raise_error</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">bad_check</span><span class="p">():</span>
    <span class="n">parent</span><span class="o">.</span><span class="n">check_state</span><span class="p">()</span>
    <span class="k">return</span>

<span class="c1"># left node is greater than the parent</span>
<span class="n">lefty</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bad</span><span class="p">():</span> 
    <span class="n">parent</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">lefty</span>
<span class="n">expect</span><span class="p">(</span><span class="n">bad</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">raise_error</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">))</span>
<span class="n">parent</span><span class="o">.</span><span class="n">_left</span> <span class="o">=</span> <span class="n">lefty</span>
<span class="n">expect</span><span class="p">(</span><span class="n">bad_check</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">raise_error</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">))</span>

<span class="c1"># left node is less than the parent</span>
<span class="n">parent</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">NIL</span>
<span class="n">parent</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">lefty</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">check_state</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span><span class="p">(</span><span class="n">raise_error</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">))</span>

<span class="c1"># right node is less than the parent</span>
<span class="n">righty</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bad</span><span class="p">():</span>
    <span class="n">parent</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">righty</span>
    <span class="k">return</span>
<span class="n">expect</span><span class="p">(</span><span class="n">bad</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">raise_error</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">))</span>
<span class="n">parent</span><span class="o">.</span><span class="n">_right</span> <span class="o">=</span> <span class="n">righty</span>
<span class="n">expect</span><span class="p">(</span><span class="n">bad_check</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">raise_error</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">))</span>

<span class="c1"># right and left are okay</span>
<span class="n">parent</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">righty</span>
<span class="n">parent</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">lefty</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">check_state</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span><span class="p">(</span><span class="n">raise_error</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">parent</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
<span class="n">parent</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>
<span class="c1"># left children of parent's left child have to be less than parent</span>
<span class="k">def</span> <span class="nf">bad</span><span class="p">():</span>
    <span class="n">parent</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">bad</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">raise_error</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">))</span>

<span class="n">parent</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">check_state</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span><span class="p">(</span><span class="n">raise_error</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="c1"># right is greater than parent</span>
<span class="n">lefty</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bad</span><span class="p">():</span>
    <span class="n">lefty</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">bad</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">raise_error</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">))</span>

<span class="c1"># disallow duplicates</span>
<span class="n">parent</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bad</span><span class="p">():</span>
    <span class="n">parent</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">bad</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">raise_error</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">))</span>

<span class="n">parent</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="mi">11</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">check_state</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span><span class="p">(</span><span class="n">raise_error</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">bad</span><span class="p">():</span>
    <span class="n">parent</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">bad</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">raise_error</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">))</span>

<span class="n">parent</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">check_state</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span><span class="p">(</span><span class="n">raise_error</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">key</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org3ac6db3">
<h4 id="org3ac6db3">Check the Red-Black Properties</h4>
<div class="outline-text-4" id="text-org3ac6db3">
<div class="highlight">
<pre><span></span><span class="c1"># colors have to use the Color Enum</span>
<span class="n">node</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">check_state</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">raise_error</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">))</span>

<span class="n">node</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">check_state</span><span class="p">)</span><span class="o">.</span><span class="n">to_not</span><span class="p">(</span><span class="n">raise_error</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">))</span>

<span class="c1"># if a node is red both children must be black</span>
<span class="n">left</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>
<span class="n">right</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
<span class="n">node</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">check_state</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">raise_error</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">))</span>

<span class="n">left</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">check_state</span><span class="p">)</span><span class="o">.</span><span class="n">to_not</span><span class="p">(</span><span class="n">raise_error</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgbe757ef">
<h2 id="orgbe757ef">The Red-Black Tree</h2>
<div class="outline-text-2" id="text-orgbe757ef">
<div class="highlight">
<pre><span></span><span class="k">class</span> <span class="nc">RedBlackTree</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""The Holder of the Red-Black Tree</span>

<span class="sd">    Args:</span>
<span class="sd">     root: the root node of the tree</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">Node</span><span class="o">=</span><span class="n">NIL</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
        <span class="k">return</span>
</pre></div>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/red-black-trees/index.html">Red-Black Trees</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/red-black-trees/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-03-19T14:43:23-07:00" itemprop="datePublished" title="2022-03-19 14:43">2022-03-19 14:43</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div class="outline-2" id="outline-container-orgfef9879">
<h2 id="orgfef9879">What are Red-Black Trees?</h2>
<div class="outline-text-2" id="text-orgfef9879">
<p>A <b>Red-Black Tree</b> is a variation of a <a href="posts/binary-search-trees/index.html">Binary Search Tree</a> that adds an extra attribute to each node - the node's <b>color</b>, which can be either <code>RED</code> or <code>BLACK</code>.</p>
<p><img alt="nil" src="posts/red-black-trees/node.png"></p>
</div>
<div class="outline-3" id="outline-container-org3feafad">
<h3 id="org3feafad">Why Do We Need Red-Black Trees?</h3>
<div class="outline-text-3" id="text-org3feafad">
<p>The basic operations done on a Binary Search Tree (e.g. search, insert, etc.) are \(O(h)\) - they perform based on the height of the tree, so when the tree is balanced they perform optimally, but the height depends on the order that the nodes are inserted (and deleted) so the tree can end up being taller than we want it to be. Red-Black Trees use the colors and the <b>Red-Black Properties</b> to ensure that the tree is more balanced.</p>
</div>
</div>
<div class="outline-3" id="outline-container-orgd47a325">
<h3 id="orgd47a325">What are the <b>Red-Black Properties</b>?</h3>
<div class="outline-text-3" id="text-orgd47a325">
<p>These are the properties that need to be maintained for a Red-Black Tree to work correctly (from <a href="posts/clrs/index.html">CLRS</a>).</p>
<ol class="org-ol">
<li>Every Node is either <b>Red</b> or <b>Black</b>.</li>
<li>The Root is <b>Black</b>.</li>
<li>Every Leaf (Nil) is <b>Black</b>.</li>
<li>If a Node is <b>Red</b> then both of its children are <b>Black</b>.</li>
<li>For each Node, all simple paths from the node to descendant leaves contain the same number of <b>Black</b> Nodes.</li>
</ol>
<p>When the properties are true the height of a tree with <b>n</b> nodes is \(O(\log(n))\).</p>
</div>
</div>
<div class="outline-3" id="outline-container-org6d776e2">
<h3 id="org6d776e2">What's the deal with the Nil Leaves?</h3>
<div class="outline-text-3" id="text-org6d776e2">
<p>CLRS define the leaves of a binary tree as Nil values (not the end nodes with keys like I tend to do) and for Red-Black Trees, unlike Binary Search Trees they use a special Node object that is colored Black and has arbitrary values for the other attributes. To save space the Nil Node is a singleton and besides being used as the leaves it also is the parent of the root.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org0b555c6">
<h3 id="org0b555c6">Anything Else?</h3>
<div class="outline-text-3" id="text-org0b555c6">
<p>One last bit of terminology: the <b>Black-Height</b> of a node is the count of the Black Nodes on a simple path from the node to a leaf, not counting the node itself but counting the leaf. This is basically a name for property five of the Red-Black Properties.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgcaaeb57">
<h2 id="orgcaaeb57">The Posts</h2>
<div class="outline-text-2" id="text-orgcaaeb57">
<ul class="org-ul">
<li><a href="posts/the-red-black-tree/index.html">The Red-Black Tree</a></li>
<li><a href="posts/red-black-trees-insertion/index.html">Red-Black Trees: Insertion</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org1b0c54e">
<h2 id="org1b0c54e">Sources</h2>
<div class="outline-text-2" id="text-org1b0c54e">
<ul class="org-ul">
<li><a href="posts/clrs/index.html">Introduction To Algorithms (CLRS)</a></li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/binary-search-tree-randomized/index.html">Binary Search Tree: Randomized</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/binary-search-tree-randomized/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-03-16T17:59:09-07:00" itemprop="datePublished" title="2022-03-16 17:59">2022-03-16 17:59</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/binary-search-tree-randomized/index.html#org98b752f">Introduction</a>
<ul>
<li><a href="posts/binary-search-tree-randomized/index.html#orgb279b47">Imports and Setup</a></li>
</ul>
</li>
<li><a href="posts/binary-search-tree-randomized/index.html#org293293d">Some Illustrative Cases</a>
<ul>
<li><a href="posts/binary-search-tree-randomized/index.html#org46800e6">Added In Sorted Order</a></li>
<li><a href="posts/binary-search-tree-randomized/index.html#orgafe9f6b">A More Balanced Tree</a></li>
<li><a href="posts/binary-search-tree-randomized/index.html#org740fbee">Something In Between</a></li>
</ul>
</li>
<li><a href="posts/binary-search-tree-randomized/index.html#org65e68fd">An Empirical Check</a>
<ul>
<li><a href="posts/binary-search-tree-randomized/index.html#orga80c5a8">Height vs Nodes</a></li>
<li><a href="posts/binary-search-tree-randomized/index.html#org48ff73a">Node Distribution</a></li>
</ul>
</li>
<li><a href="posts/binary-search-tree-randomized/index.html#org7ecab98">Sources</a></li>
</ul>
</div>
</div>
<p>This is the next post in a series on Binary Search Trees that start with <a href="posts/binary-search-trees/index.html">this post</a>. In this post we'll be looking at tree-heights when you randomize the order that the nodes are inserted into the tree.</p>
<div class="outline-2" id="outline-container-org98b752f">
<h2 id="org98b752f">Introduction</h2>
<div class="outline-text-2" id="text-org98b752f">
<p>We now have a basic Binary Search Tree and some methods to build and query it. I didn't really go over it but if you look at the basic <a href="posts/binary-search-tree-queries/index.html">querying methods</a> (search, min, max, etc.) you can see that they boil down to starting at a node (often the root) and then traversing up or down the levels of the tree until we find what we want or we reach a leaf. This means that at most the number of comparisons you make (everytime you reach a node you compare the node's key to your key to pick a child to follow) will be the height of tree (<b>h</b>).</p>
<p>The height of the tree depends, however, on the order in which you insert and delete the nodes. If you insert them in ascending order, for instance, you end up with all the nodes being right children and a height of <b>n - 1</b> (the number of edges). But, <a href="posts/clrs/index.html">CLRS</a> shows that if you randomize the insertion you will, on average have a height of \(O(\lg(n))\) so I'm going to take an experimental look at that here.</p>
</div>
<div class="outline-3" id="outline-container-orgb279b47">
<h3 id="orgb279b47">Imports and Setup</h3>
<div class="outline-text-3" id="text-orgb279b47">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>

<span class="kn">import</span> <span class="nn">altair</span>
<span class="kn">import</span> <span class="nn">networkx</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># this project</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.binary_search_tree</span> <span class="kn">import</span> <span class="p">(</span><span class="n">Node</span><span class="p">,</span> <span class="n">Query</span><span class="p">,</span> <span class="n">Tree</span><span class="p">)</span>

<span class="c1"># monkey projects</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">Timer</span>
<span class="kn">from</span> <span class="nn">graeae.visualization.altair_helpers</span> <span class="kn">import</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">save_chart</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">TIMER</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
<span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"binary-search-tree-randomized"</span>
<span class="n">GRAPH_OUTPUT</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">"files/posts/</span><span class="si">{</span><span class="n">SLUG</span><span class="si">}</span><span class="s2">/"</span><span class="p">)</span>
<span class="n">ALTAIR_OUTPUT</span> <span class="o">=</span> <span class="n">output_path</span><span class="p">(</span><span class="n">SLUG</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">GRAPH_OUTPUT</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
    <span class="n">GRAPH_OUTPUT</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
<span class="n">save_it</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">save_chart</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">ALTAIR_OUTPUT</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">preorder</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">,</span> <span class="n">adjacencies</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Build the adjancency dictionary</span>

<span class="sd">    Args:</span>
<span class="sd">     node: the next node to add</span>
<span class="sd">     adjacencies: dictionary of key: adjacent node keys</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">left</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">key</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">left</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">key</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">right</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">((</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">left</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">right</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">adjacencies</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">left</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">right</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">adjacencies</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">adjacencies</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">right</span><span class="p">,)</span>
        <span class="n">preorder</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">adjacencies</span><span class="p">)</span>
        <span class="n">preorder</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="n">adjacencies</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org293293d">
<h2 id="org293293d">Some Illustrative Cases</h2>
<div class="outline-text-2" id="text-org293293d"></div>
<div class="outline-3" id="outline-container-org46800e6">
<h3 id="org46800e6">Added In Sorted Order</h3>
<div class="outline-text-3" id="text-org46800e6">
<p>This is our worst-case where the nodes after the root all end up as right-children and the height is <b>n - 1</b>.</p>
<div class="highlight">
<pre><span></span><span class="n">tree</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">()</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">5</span>
<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

<span class="n">adjacencies</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">preorder</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">adjacencies</span><span class="p">)</span>

<span class="n">graph</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">nx_pydot</span><span class="o">.</span><span class="n">to_pydot</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">(</span><span class="n">adjacencies</span><span class="p">))</span>
<span class="n">graph</span><span class="o">.</span><span class="n">write_png</span><span class="p">(</span><span class="n">GRAPH_OUTPUT</span><span class="o">/</span><span class="s2">"first_tree.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/binary-search-tree-randomized/first_tree.png"></p>
<p>If it were in reversed order we'd get a similar graph but the children would all be on the left and in the reverse order, but since graphviz/dot doesn't show left vs right it'd be hard to see what's going on.</p>
</div>
</div>
<div class="outline-3" id="outline-container-orgafe9f6b">
<h3 id="orgafe9f6b">A More Balanced Tree</h3>
<div class="outline-text-3" id="text-orgafe9f6b">
<p>This would be the best case, where the nodes are evenly balanced across the tree. Even though we have more nodes than the prior tree we only have a height of two.</p>
<div class="highlight">
<pre><span></span><span class="n">KEYS</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">80</span><span class="p">]</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="n">KEYS</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">KEYS</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>

<span class="n">adjacencies</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">preorder</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">adjacencies</span><span class="p">)</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">nx_pydot</span><span class="o">.</span><span class="n">to_pydot</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">(</span><span class="n">adjacencies</span><span class="p">))</span>
<span class="n">graph</span><span class="o">.</span><span class="n">write_png</span><span class="p">(</span><span class="n">GRAPH_OUTPUT</span><span class="o">/</span><span class="s2">"second_tree.png"</span><span class="p">)</span>

<span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
<p><img alt="nil" src="posts/binary-search-tree-randomized/second_tree.png"></p>
</div>
</div>
<div class="outline-3" id="outline-container-org740fbee">
<h3 id="org740fbee">Something In Between</h3>
<div class="outline-text-3" id="text-org740fbee">
<p>If we insert the nodes in random order then we would expect to see something better than the worst case but not a perfectly balanced tree either.</p>
<div class="highlight">
<pre><span></span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">KEYS</span><span class="p">)</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="n">KEYS</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">KEYS</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>

<span class="n">adjacencies</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">preorder</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">adjacencies</span><span class="p">)</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">nx_pydot</span><span class="o">.</span><span class="n">to_pydot</span><span class="p">(</span><span class="n">networkx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">(</span><span class="n">adjacencies</span><span class="p">))</span>
<span class="n">graph</span><span class="o">.</span><span class="n">write_png</span><span class="p">(</span><span class="n">GRAPH_OUTPUT</span><span class="o">/</span><span class="s2">"third_tree.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/binary-search-tree-randomized/third_tree.png"></p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org65e68fd">
<h2 id="org65e68fd">An Empirical Check</h2>
<div class="outline-text-2" id="text-org65e68fd"></div>
<div class="outline-3" id="outline-container-orga80c5a8">
<h3 id="orga80c5a8">Height vs Nodes</h3>
<div class="outline-text-3" id="text-orga80c5a8">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">heights</span><span class="p">(</span><span class="n">keys</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Builds the binary tree from the nodes and gets height</span>

<span class="sd">    Args:</span>
<span class="sd">     nodes: list of keys for nodes</span>

<span class="sd">    Returns:</span>
<span class="sd">     (number of nodes, height)</span>
<span class="sd">    """</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">()</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>

    <span class="k">return</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">),</span> <span class="n">query</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">things_to_sort</span> <span class="o">=</span> <span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>
                  <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>

<span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">height_vs_count</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
        <span class="n">delayed</span><span class="p">(</span><span class="n">heights</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span>
    <span class="p">)</span>
</pre></div>
<pre class="example">
Started: 2022-03-17 20:17:02.325084
Ended: 2022-03-17 20:17:30.486929
Elapsed: 0:00:28.161845
</pre>
<div class="highlight">
<pre><span></span><span class="n">NODES</span><span class="p">,</span> <span class="n">HEIGHT</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
<span class="n">unzipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">height_vs_count</span><span class="p">))</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"Nodes"</span><span class="p">:</span> <span class="n">unzipped</span><span class="p">[</span><span class="n">NODES</span><span class="p">],</span>
                          <span class="s2">"Height"</span><span class="p">:</span> <span class="n">unzipped</span><span class="p">[</span><span class="n">HEIGHT</span><span class="p">]})</span>
<span class="n">frame</span><span class="p">[</span><span class="s2">"3Log2"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">frame</span><span class="p">[</span><span class="s2">"Nodes"</span><span class="p">])</span>
<span class="n">points</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Nodes"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Height"</span><span class="p">,</span>
    <span class="n">tooltip</span> <span class="o">=</span> <span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Nodes"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
               <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Height"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">)]</span>
<span class="p">)</span>

<span class="n">line</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">"#feb236"</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Nodes"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"3Log2"</span><span class="p">,</span>
    <span class="n">tooltip</span> <span class="o">=</span> <span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Nodes"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
               <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"3Log2"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">)]</span>
<span class="p">)</span>
<span class="n">chart</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="n">points</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Randomized Binary Search Tree Node Count vs Height"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"nodes-vs-height"</span><span class="p">)</span>
</pre></div>
<object data="posts/binary-search-tree-randomized/nodes-vs-height.html" height="600" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>So it looks like when you insert the nodes randomly you tend to get a tree height that's \(O(\log(n))\).</p>
</div>
</div>
<div class="outline-3" id="outline-container-org48ff73a">
<h3 id="org48ff73a">Node Distribution</h3>
<div class="outline-text-3" id="text-org48ff73a">
<div class="highlight">
<pre><span></span><span class="n">nodes</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">4</span>
<span class="n">urn</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">nodes</span><span class="p">))</span>
<span class="n">samples</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">4</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"log2(</span><span class="si">{</span><span class="n">nodes</span><span class="si">}</span><span class="s2">) = </span><span class="si">{</span><span class="n">numpy</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">things_to_sort</span> <span class="o">=</span> <span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">urn</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">nodes</span><span class="p">)</span> <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples</span><span class="p">))</span>

<span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">height_distribution</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
        <span class="n">delayed</span><span class="p">(</span><span class="n">heights</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span>
    <span class="p">)</span>
</pre></div>
<pre class="example">
log2(10000) = 13.287712379549449
Started: 2022-03-17 21:15:42.270315
Ended: 2022-03-17 21:16:32.620183
Elapsed: 0:00:50.349868
</pre>
<div class="highlight">
<pre><span></span><span class="n">NODES</span><span class="p">,</span> <span class="n">HEIGHT</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
<span class="n">unzipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">height_distribution</span><span class="p">))</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"Nodes"</span><span class="p">:</span> <span class="n">unzipped</span><span class="p">[</span><span class="n">NODES</span><span class="p">],</span>
                          <span class="s2">"Height"</span><span class="p">:</span> <span class="n">unzipped</span><span class="p">[</span><span class="n">HEIGHT</span><span class="p">]})</span>

<span class="n">base</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

<span class="n">histogram</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">"#50586C"</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Height"</span><span class="p">,</span> <span class="nb">bin</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"count()"</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Height"</span><span class="p">))</span>

<span class="n">median</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">mark_rule</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">"#DCE2F0"</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"mean(Height):Q"</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"mean(Height)"</span><span class="p">))</span>

<span class="n">chart</span> <span class="o">=</span> <span class="p">(</span><span class="n">histogram</span> <span class="o">+</span> <span class="n">median</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">"Randomized Binary Search Tree Height Distribution (</span><span class="si">{</span><span class="n">nodes</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> Nodes)"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"height-distribution"</span><span class="p">)</span>
</pre></div>
<object data="posts/binary-search-tree-randomized/height-distribution.html" height="600" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Median: </span><span class="si">{</span><span class="n">frame</span><span class="o">.</span><span class="n">Height</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Min: </span><span class="si">{</span><span class="n">frame</span><span class="o">.</span><span class="n">Height</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Max: </span><span class="si">{</span><span class="n">frame</span><span class="o">.</span><span class="n">Height</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"3 x log2(n): </span><span class="si">{</span><span class="mi">3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">numpy</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">Nodes</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Median: 30.0
Min: 24
Max: 40
3 x log2(n): 39.86
</pre>
<p>So, with our evenly ranged inputs, even though in the worst case we could have ended up with a tree with a height of 10,000, by inserting the nodes in random order it turns out that most of the time it has a height of 30 and in this sample it has a maximum of 40.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org7ecab98">
<h2 id="org7ecab98">Sources</h2>
<div class="outline-text-2" id="text-org7ecab98">
<ul class="org-ul">
<li><a href="posts/clrs/index.html">Introduction To Algorithms (CLRS)</a></li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/binary-search-tree-queries/index.html">Binary Search Tree Queries</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/binary-search-tree-queries/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-03-14T14:47:08-07:00" itemprop="datePublished" title="2022-03-14 14:47">2022-03-14 14:47</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/binary-search-tree-queries/index.html#org2ce26a4">A Query Class</a></li>
<li><a href="posts/binary-search-tree-queries/index.html#org545af41">Search</a>
<ul>
<li><a href="posts/binary-search-tree-queries/index.html#org5565f03">The Algorithm</a></li>
<li><a href="posts/binary-search-tree-queries/index.html#orgd63fead">The Iterative Version</a></li>
<li><a href="posts/binary-search-tree-queries/index.html#org33bb9fc">The Implementation</a>
<ul>
<li><a href="posts/binary-search-tree-queries/index.html#orgbcfa209">Testing</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="posts/binary-search-tree-queries/index.html#orgef10dd2">Miminum and Maximum</a>
<ul>
<li><a href="posts/binary-search-tree-queries/index.html#org7c097f0">Mimimum</a>
<ul>
<li><a href="posts/binary-search-tree-queries/index.html#orga63e637">The Implementation</a></li>
<li><a href="posts/binary-search-tree-queries/index.html#org61e8e99">Testing</a></li>
</ul>
</li>
<li><a href="posts/binary-search-tree-queries/index.html#org4f628c2">Maximum</a>
<ul>
<li><a href="posts/binary-search-tree-queries/index.html#orgce1a508">The Implementation</a></li>
<li><a href="posts/binary-search-tree-queries/index.html#orgb1a2821">Testing</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="posts/binary-search-tree-queries/index.html#org285f811">Tree Successor</a></li>
<li><a href="posts/binary-search-tree-queries/index.html#org609576b">Tree Predecessor</a></li>
<li><a href="posts/binary-search-tree-queries/index.html#orga1e4cfb">Height</a></li>
<li><a href="posts/binary-search-tree-queries/index.html#orgf290856">Sources</a></li>
</ul>
</div>
</div>
<p>This is the next post in a series on Binary Search Trees that start with <a href="posts/binary-search-trees/index.html">this post</a>. In this post we'll look at some basic queries we can make using the tree.</p>
<div class="outline-2" id="outline-container-org2ce26a4">
<h2 id="org2ce26a4">A Query Class</h2>
<div class="outline-text-2" id="text-org2ce26a4">
<p>The textbook(s) treat these as functions, but they seem to suggest to me methods of a class, so I'll make one. The <code>TYPE_CHECKING</code> and <code>annotations</code> imports are to prevent circular imports as noted on <a href="https://adamj.eu/tech/2021/05/13/python-type-hints-how-to-fix-circular-imports/">Adam Johnson's blog</a>.</p>
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span>

<span class="c1"># this project</span>
<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">.node</span> <span class="kn">import</span> <span class="n">Node</span>
    <span class="kn">from</span> <span class="nn">.tree</span> <span class="kn">import</span> <span class="n">Tree</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">class</span> <span class="nc">Query</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Holds a tree and performs queries on it</span>

<span class="sd">    Args:</span>
<span class="sd">     tree: A Binary Search Tree</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">:</span> <span class="n">Tree</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="n">tree</span>
        <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org545af41">
<h2 id="org545af41">Search</h2>
<div class="outline-text-2" id="text-org545af41">
<p>The first thing we'll look at is searching for a Node in a Binary Search Tree. Because of the way the tree is structured the search looks a lot like a <a href="posts/binary-search/index.html">Binary Search</a> where we start at the root of the tree and then work our way downwards, picking the next child to follow based on whether the key we're searching for is greater than the right child's key or less than the left child's key. If it's equal then we've found the node we want.</p>
</div>
<div class="outline-3" id="outline-container-org5565f03">
<h3 id="org5565f03">The Algorithm</h3>
<div class="outline-text-3" id="text-org5565f03">
<pre id="tree-search" style="display:hidden;">
\begin{algorithm}
\caption{TreeSearch}
\begin{algorithmic}
\INPUT The Node to start searching from and the key to search for.
\OUTPUT If a node with the key is in the tree, then it will output the node.
\PROCEDURE{TreeSearch}{x, key}
\IF {\textit{x} = \textsc{NIL} or key = \textit{x}.key}
  \RETURN \textit{x}
\ENDIF

\IF {key &lt; \textit{x}.key}
    \RETURN \textsc{TreeSearch}(\textit{x}.left, key)
\ELSE
    \RETURN \textsc{TreeSearch}(\textit{x}.right, key)
\ENDIF
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre></div>
</div>
<div class="outline-3" id="outline-container-orgd63fead">
<h3 id="orgd63fead">The Iterative Version</h3>
<div class="outline-text-3" id="text-orgd63fead">
<p>The recursive version of <code>TreeSearch</code> is quite nice, but it also translates easily to an iterative version if for some reason performance or size becomes a problem.</p>
<pre id="iterative-tree-search" style="display:hidden;">
\begin{algorithm}
\caption{IterativeTreeSearch}
\begin{algorithmic}
\INPUT The Node to start searching from and the key to search for.
\OUTPUT If a node with the key is in the tree, then it will output the node.
\PROCEDURE{IterativeTreeSearch}{x, key}
\WHILE {\textit{x} $\neq$ \textsc{NIL} and key $\neq$ \textit{x}.key}
  \IF {key &lt; \textit{x}.key}
   \STATE \textit{x} $\gets$ \textit{x}.left
  \ELSE
   \STATE \textit{x} $\gets$ \textit{x}.right
  \ENDIF
\ENDWHILE
\RETURN \textit{x}
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre></div>
</div>
<div class="outline-3" id="outline-container-org33bb9fc">
<h3 id="org33bb9fc">The Implementation</h3>
<div class="outline-text-3" id="text-org33bb9fc">
<p>I'll add the iterative version of the Tree Search as a method for our Query class.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Node</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Searches the tree for the node with the matching key</span>

<span class="sd">    Args:</span>
<span class="sd">     key: node's key to search for</span>

<span class="sd">    Returns:</span>
<span class="sd">     the node with the key or None if it isn't in the tree</span>
<span class="sd">    """</span>
    <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span>
    <span class="k">while</span> <span class="n">node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">!=</span> <span class="n">node</span><span class="o">.</span><span class="n">key</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">&lt;</span> <span class="n">node</span><span class="o">.</span><span class="n">key</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">left</span>
        <span class="k">else</span><span class="p">:</span>
           <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">right</span>
    <span class="k">return</span> <span class="n">node</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-orgbcfa209">
<h4 id="orgbcfa209">Testing</h4>
<div class="outline-text-4" id="text-orgbcfa209">
<div class="highlight">
<pre><span></span><span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">be</span><span class="p">,</span><span class="n">be_none</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.binary_search_tree</span> <span class="kn">import</span> <span class="n">Node</span><span class="p">,</span> <span class="n">Tree</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.binary_search_tree</span> <span class="kn">import</span> <span class="n">Query</span>

<span class="n">root</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_none</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">root</span><span class="p">))</span>

<span class="n">five</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">five</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">five</span><span class="p">))</span>

<span class="n">fifteen</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">fifteen</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="mi">15</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">fifteen</span><span class="p">))</span>
</pre></div>
<p>I'll have to think of something more interesting to show for thisâ€¦</p>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgef10dd2">
<h2 id="orgef10dd2">Miminum and Maximum</h2>
<div class="outline-text-2" id="text-orgef10dd2"></div>
<div class="outline-3" id="outline-container-org7c097f0">
<h3 id="org7c097f0">Mimimum</h3>
<div class="outline-text-3" id="text-org7c097f0">
<pre id="tree-minimum" style="display:hidden;">
\begin{algorithm}
\caption{TreeMinimum}
\begin{algorithmic}
\INPUT The Node to start the search from.
\OUTPUT The Node with the smallest key.
\PROCEDURE{TreeMinimum}{x}
\WHILE {\textit{x}.left $\neq$ \textsc{NIL}}
   \STATE \textit{x} $\gets$ \textit{x}.left
\ENDWHILE
\RETURN \textit{x}
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre></div>
<div class="outline-4" id="outline-container-orga63e637">
<h4 id="orga63e637">The Implementation</h4>
<div class="outline-text-4" id="text-orga63e637">
<p>I originally didn't take the root node as an argument, since I thought the minimum of the tree is always the smallest item. But this method gets used later on in the <code>successor</code> method where we want to find the smallest item in the right-subtree of a particular node, so the outcome won't necessarily be the smallest item in the tree.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Node</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Returns the node with the smallest key</span>

<span class="sd">    Args:</span>
<span class="sd">     node: a node to use as the starting root</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span>

    <span class="k">while</span> <span class="n">node</span><span class="o">.</span><span class="n">left</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">left</span>
    <span class="k">return</span> <span class="n">node</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org61e8e99">
<h4 id="org61e8e99">Testing</h4>
<div class="outline-text-4" id="text-org61e8e99">
<div class="highlight">
<pre><span></span><span class="n">tree</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">15</span><span class="p">))</span>
<span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">17</span><span class="p">))</span>
<span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">11</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>

<span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">right</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">11</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org4f628c2">
<h3 id="org4f628c2">Maximum</h3>
<div class="outline-text-3" id="text-org4f628c2">
<pre id="tree-maximum" style="display:hidden;">
\begin{algorithm}
\caption{TreeMaximum}
\begin{algorithmic}
\INPUT The Node to start the search from.
\OUTPUT The Node with the largest key.
\PROCEDURE{TreeMaximum}{x}
\WHILE {\textit{x}.right $\neq$ \textsc{NIL}}
   \STATE \textit{x} $\gets$ \textit{x}.right
\ENDWHILE
\RETURN \textit{x}
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre></div>
<div class="outline-4" id="outline-container-orgce1a508">
<h4 id="orgce1a508">The Implementation</h4>
<div class="outline-text-4" id="text-orgce1a508">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">Node</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Node</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Returns the node with the largest key</span>

<span class="sd">    Args:</span>
<span class="sd">     root: subtree root to start at</span>

<span class="sd">    Returns:</span>
<span class="sd">     node with the largest key in tree/subtree</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">root</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span>
    <span class="k">while</span> <span class="n">root</span><span class="o">.</span><span class="n">right</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">right</span>
    <span class="k">return</span> <span class="n">root</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgb1a2821">
<h4 id="orgb1a2821">Testing</h4>
<div class="outline-text-4" id="text-orgb1a2821">
<div class="highlight">
<pre><span></span><span class="n">tree</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">15</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">max</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">15</span><span class="p">)))</span>

<span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">17</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">max</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">17</span><span class="p">)))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">left</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org285f811">
<h2 id="org285f811">Tree Successor</h2>
<div class="outline-text-2" id="text-org285f811">
<p>A "Successor" node is the next largest node after a given node. Since all the nodes in a right subtree are greater than the node, it's the smallest node in the right (if it exists). If the right subtree is empty then we traverse up the ancestors of the node until we find the first one that is greater than our node.</p>
<pre id="tree-successor" style="display:hidden;">
\begin{algorithm}
\caption{TreeSuccessor}
\begin{algorithmic}
\INPUT The Node to start the search from.
\OUTPUT The Node with the next largest key.
\PROCEDURE{TreeSuccessor}{x}
\IF {\textit{x}.right $\neq$ \textsc{NIL}}
  \RETURN \textsc{TreeMinimum}(\textit{x}.right)
\ENDIF

\STATE \textit{y} $\gets$ \textit{x}.parent

\WHILE {\textit{y} $\neq$ \textsc{NIL} and \textit{x} = \textit{y}.right}
   \STATE \textit{x} $\gets$ \textit{y}
   \STATE \textit{y} $\gets$ \textit{y}.parent
\ENDWHILE
\RETURN \textit{y}
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">successor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Node</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Returns the next largest node</span>

<span class="sd">    Args:</span>
<span class="sd">     node: the node who's successor to find</span>

<span class="sd">    Returns:</span>
<span class="sd">     successor node to the input node</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">right</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="p">)</span>

    <span class="n">successor</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">parent</span>
    <span class="k">while</span> <span class="n">successor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">node</span> <span class="o">==</span> <span class="n">successor</span><span class="o">.</span><span class="n">right</span><span class="p">:</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">successor</span>
        <span class="n">successor</span> <span class="o">=</span> <span class="n">successor</span><span class="o">.</span><span class="n">parent</span>
    <span class="k">return</span> <span class="n">successor</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">tree</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">15</span><span class="p">))</span>
<span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">17</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">successor</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="mi">15</span><span class="p">)))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">17</span><span class="p">)))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">successor</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">successor</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">successor</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">15</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org609576b">
<h2 id="org609576b">Tree Predecessor</h2>
<div class="outline-text-2" id="text-org609576b">
<p>Similar in concept to a node successor, a node <i>predecessor</i> is the largest node less than the given node.</p>
<pre id="tree-predecessor" style="display:hidden;">
\begin{algorithm}
\caption{TreePredecessor}
\begin{algorithmic}
\INPUT The Node to start the search from.
\OUTPUT The Node with the next smallest key.
\PROCEDURE{TreePredecessor}{x}
\IF {\textit{x}.left $\neq$ \textsc{NIL}}
  \RETURN \textsc{TreeMaximum}(\textit{x}.right)
\ENDIF

\STATE \textit{y} $\gets$ \textit{x}.parent

\WHILE {\textit{y} $\neq$ \textsc{NIL} and \textit{x} = \textit{y}.left}
   \STATE \textit{x} $\gets$ \textit{y}
   \STATE \textit{y} $\gets$ \textit{y}.parent
\ENDWHILE
\RETURN \textit{y}
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">predecessor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Node</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Returns the predecessor node</span>

<span class="sd">    Args:</span>
<span class="sd">     node: the node whose predecessor we want</span>

<span class="sd">    Returns:</span>
<span class="sd">     largest node smaller than given node</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">left</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">)</span>
    <span class="n">predecessor</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">parent</span>
    <span class="k">while</span> <span class="n">predecessor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">node</span> <span class="o">==</span> <span class="n">predecessor</span><span class="o">.</span><span class="n">left</span><span class="p">:</span>
        <span class="n">node</span><span class="p">,</span> <span class="n">predecessor</span> <span class="o">=</span> <span class="n">predecessor</span><span class="p">,</span> <span class="n">predecessor</span><span class="o">.</span><span class="n">parent</span>
    <span class="k">return</span> <span class="n">predecessor</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">tree</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">predecessor</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_none</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">predecessor</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_none</span><span class="p">)</span>
<span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">12</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">predecessor</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="mi">12</span><span class="p">)))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="mi">10</span><span class="p">)))</span>

<span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">predecessor</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="mi">8</span><span class="p">)))</span>
<span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">predecessor</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="mi">8</span><span class="p">)))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-orga1e4cfb">
<h2 id="orga1e4cfb">Height</h2>
<div class="outline-text-2" id="text-orga1e4cfb">
<p>The height of the Binary Search Tree is the number of edges from the root of the tree to the furthest node. The algorithms we're looking at here don't use them but I'm going to use height to look at how the order you insert nodes in the tree affects the height.</p>
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">height</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""The length of the longest path starting at the root</span>

<span class="sd">    Returns:</span>
<span class="sd">     number of edges from root to furthest leaf</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_height</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">tree_height</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Node</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""The length of the longest path starting at the node</span>

<span class="sd">    Args:</span>
<span class="sd">     the node to start the measurement from</span>

<span class="sd">    Returns:</span>
<span class="sd">     number of edges from root to furthest leaf</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_height</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_height</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">tree</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">()</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">12</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>

<span class="n">tree</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">()</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">20</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">tree</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-orgf290856">
<h2 id="orgf290856">Sources</h2>
<div class="outline-text-2" id="text-orgf290856">
<ul class="org-ul">
<li><a href="posts/clrs/index.html">Introduction To Algorithms (CLRS)</a></li>
</ul>
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("tree-search"));
});
</script>
<script>

window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("iterative-tree-search"));
});
</script>
<script>

window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("tree-minimum"));
});
</script>
<script>

window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("tree-maximum"));
});
</script>
<script>

window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("tree-successor"));
});
</script>
<script>

window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("tree-predecessor"));
});
</script></div>
</div>
</div>
</article>
</div>
<ul class="pager postindexpager clearfix">
<li class="previous"><a href="index-6.html" rel="prev">Newer posts</a></li>
<li class="next"><a href="index-4.html" rel="next">Older posts</a></li>
</ul>
<script crossorigin="anonymous" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">

      MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],

            displayMath: [['$$','$$'], ['\\[','\\]']],
            processEscapes: true,
            processEnvironments: true,
        }
    });
</script><!--End of body content-->
<footer id="footer">Scribbles by <a href="mailto:cloisteredmonkey.jmark@slmail.me">The Cloistered Monkey</a> Â© 2024 - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a>
<div id="license" xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/"><span property="dct:title">Ape-Iron</span> is licensed under <a href="http://creativecommons.org/licenses/by-sa/4.0/?ref=chooser-v1" rel="license noopener noreferrer" style="display:inline-block;" target="_blank">CC BY-SA 4.0 <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"><img src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1"></a></div>
</footer>
</div>
<script src="assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script></div>
</body>
</html>
