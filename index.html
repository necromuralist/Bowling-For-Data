<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Striking out for data.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Bowling For Data</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="rss.xml">
<link rel="canonical" href="https://necromuralist.github.io/Bowling-For-Data/">
<link rel="next" href="index-3.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><link rel="prefetch" href="posts/algorithm-problems/" type="text/html">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.css">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-light
bg-light
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href=".">

            <span id="blog-title">Bowling For Data</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="categories/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="rss.xml" class="nav-link">RSS feed</a>

                
            </li>
</ul>
<!-- DuckDuckGo custom search --><form method="get" id="search" action="https://duckduckgo.com/" class="navbar-form pull-left">
 <input type="hidden" name="sites" value="https://necromuralist.github.io/Bowling-For-Data/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="Searchâ€¦" class="span2" style="margin-top: 4px;"><input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
</form>
 <!-- End of custom search -->
 

            <ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/algorithm-problems/" class="u-url">Algorithm Problems</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/algorithm-problems/" rel="bookmark">
            <time class="published dt-published" datetime="2022-03-03T18:33:06-08:00" itemprop="datePublished" title="2022-03-03 18:33">2022-03-03 18:33</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="outline-container-orgf453246" class="outline-2">
<h2 id="orgf453246">By Problem</h2>
<div class="outline-text-2" id="text-orgf453246">
<ul class="org-ul">
<li><a href="posts/the-sorting-problem/">The Sorting Problem</a></li>
<li><a href="posts/the-selection-problem/">The Selection Problem</a></li>
</ul>
</div>
</div>

<div id="outline-container-org32f31ce" class="outline-2">
<h2 id="org32f31ce">By Algorithm Type</h2>
<div class="outline-text-2" id="text-org32f31ce">
<ul class="org-ul">
<li><a href="posts/more-of-the-output/">More of the Output</a></li>
<li><a href="posts/iterative-algorithms/">Iterative Algorithms</a></li>
<li><a href="posts/divide-and-conquer/">Divide and Conquer</a></li>
<li><a href="posts/decrease-and-conquer/">Decrease And Conquer</a></li>
</ul>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/sources/" class="u-url">Sources</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/sources/" rel="bookmark">
            <time class="published dt-published" datetime="2022-03-03T18:29:30-08:00" itemprop="datePublished" title="2022-03-03 18:29">2022-03-03 18:29</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="outline-container-org5a79507" class="outline-2">
<h2 id="org5a79507">Algorithms</h2>
<div class="outline-text-2" id="text-org5a79507">
<ul class="org-ul">
<li><a href="posts/clrs/">Introduction To Algorithms (CLRS)</a></li>
<li><a href="posts/itdaa/">Introduction to the Design &amp; Analysis of Algorithms (Levitin)</a></li>
<li><a href="posts/HTTAA/">How To Think About Algorithms</a></li>
</ul>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/randomized-partition/" class="u-url">Randomized Partition</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/randomized-partition/" rel="bookmark">
            <time class="published dt-published" datetime="2022-02-24T16:37:18-08:00" itemprop="datePublished" title="2022-02-24 16:37">2022-02-24 16:37</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="outline-container-org44392ef" class="outline-2">
<h2 id="org44392ef">Introduction</h2>
<div class="outline-text-2" id="text-org44392ef">
<p>
This is part of a series about the Partition algorithm that starts with <a href="posts/the-partition/">this post</a>.
</p>
</div>

<div id="outline-container-org1e431ae" class="outline-3">
<h3 id="org1e431ae">Imports and Setup</h3>
<div class="outline-text-3" id="text-org1e431ae">
<div class="highlight"><pre><span></span><span class="c1"># python</span>
<span class="c1"># For python 3.9 and newer you want to import </span>
<span class="c1"># the typing classes from collections.abc</span>
<span class="c1"># But Ubuntu 21.10 has pypy 3.7 which needs the version from typing</span>
<span class="c1"># for what we want here</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">MutableSequence</span><span class="p">,</span> <span class="n">TypeVar</span>

<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">be_true</span><span class="p">,</span> <span class="n">contain_exactly</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>

<span class="kn">import</span> <span class="nn">altair</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># software under test</span>
<span class="kn">from</span> <span class="nn">bowling.sort.quick</span> <span class="kn">import</span> <span class="p">(</span><span class="n">clrs_partition</span><span class="p">,</span>
				<span class="n">levitins_partition</span><span class="p">,</span>
				<span class="n">randomized_partition</span><span class="p">)</span>

<span class="c1"># monkey</span>
<span class="kn">from</span> <span class="nn">graeae.visualization.altair_helpers</span> <span class="kn">import</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">save_chart</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"randomized-partition"</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="n">output_path</span><span class="p">(</span><span class="n">SLUG</span><span class="p">)</span>
<span class="n">save_it</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">save_chart</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">)</span>
<span class="n">Orderable</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">"Orderable"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div id="outline-container-org0b38268" class="outline-2">
<h2 id="org0b38268">The Algorithm</h2>
<div class="outline-text-2" id="text-org0b38268">
<p>
The randomized partition just swaps the pivot element for a random element, but since the CLRS version uses the last element as the pivot and the Levitin version uses the first element (and Hoare used the middle) I'm going to pass in the pivot and the function explicitly so I don't have to implement different versions of the randomized partition.
</p>

<p>
For the pseudocode I'll just assume that the partition function is in the global space instead of passing it in.
</p>

<pre id="the-randomized-partition" style="display:hidden;">
\begin{algorithm}
\caption{Randomized Partition}
\begin{algorithmic}
\INPUT An array and left, right, and pivot locations
\OUTPUT The sub-array from left to right is partitioned and the partition location is returned

\PROCEDURE{RandomizedPartition}{A, left, right, pivot}

\STATE i $\gets$ \textsc{Random}(left, right)
\STATE \textsc{Swap}(A[i], A[pivot])
\RETURN \textsc{Partition}(A, left, right)
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>

<p>
The downside to this approach is that to use it you have to remember where the pivot is. Maybe I'll make separate ones for the different algorithms laterâ€¦
</p>
</div>
</div>
<div id="outline-container-org8d57af5" class="outline-2">
<h2 id="org8d57af5">The Implementation</h2>
<div class="outline-text-2" id="text-org8d57af5">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">partition_randomized</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">[</span><span class="n">Orderable</span><span class="p">],</span>
			 <span class="n">left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
			 <span class="n">pivot</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
			 <span class="n">partition</span><span class="p">:</span> <span class="n">Partition</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""Partitions the collection around a random element in the list</span>

<span class="sd">    Args:</span>
<span class="sd">     collection: the list to partition</span>
<span class="sd">     left: index of the first element in the sub-list to partition</span>
<span class="sd">     right: index of the last element in the sub-list to partition</span>
<span class="sd">     pivot: location of the pivot element</span>
<span class="sd">     partition: the partition function to use</span>

<span class="sd">    Returns:</span>
<span class="sd">     the index of the pivot element</span>
<span class="sd">    """</span>
    <span class="n">random_index</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">collection</span><span class="p">[</span><span class="n">pivot</span><span class="p">],</span> <span class="n">collection</span><span class="p">[</span><span class="n">random_index</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="n">random_index</span><span class="p">],</span>
						   <span class="n">collection</span><span class="p">[</span><span class="n">pivot</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">partition</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div id="outline-container-orgd2ed0d7" class="outline-2">
<h2 id="orgd2ed0d7">Some Checks</h2>
<div class="outline-text-2" id="text-orgd2ed0d7">
<div class="highlight"><pre><span></span><span class="n">randomized_clrs</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">randomized_partition</span><span class="p">,</span> <span class="n">pivot</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
			  <span class="n">partition</span><span class="o">=</span><span class="n">clrs_partition</span><span class="p">)</span>
<span class="n">randomized_levitin</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">randomized_partition</span><span class="p">,</span> <span class="n">pivot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
			     <span class="n">partition</span><span class="o">=</span><span class="n">levitins_partition</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_partitioner</span><span class="p">(</span><span class="n">partitioner</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">MutableSequence</span><span class="p">[</span><span class="n">Orderable</span><span class="p">],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">],</span>
		     <span class="n">input_size</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">input_size</span><span class="p">))</span>
    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>

    <span class="n">pivot</span> <span class="o">=</span> <span class="n">partitioner</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">input_size</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">pivot_element</span> <span class="o">=</span> <span class="n">elements</span><span class="p">[</span><span class="n">pivot</span><span class="p">]</span>
    <span class="n">expect</span><span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="n">element</span> <span class="o">&lt;</span> <span class="n">pivot_element</span>
	       <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">[:</span><span class="n">pivot</span><span class="p">]))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="n">element</span> <span class="o">&gt;</span> <span class="n">pivot_element</span>
	       <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">[</span><span class="n">pivot</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">input_size</span><span class="p">))</span>
    <span class="k">return</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">test_partitioner</span><span class="p">(</span><span class="n">randomized_clrs</span><span class="p">)</span>
<span class="n">test_partitioner</span><span class="p">(</span><span class="n">randomized_levitin</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-org9b7b81b" class="outline-2">
<h2 id="org9b7b81b">Sources</h2>
<div class="outline-text-2" id="text-org9b7b81b">
<ul class="org-ul">
<li><a href="posts/clrs/">Introduction To Algorithms (CLRS)</a></li>
</ul>
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("the-randomized-partition"));
});
</script>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/comparing-the-partition-swaps/" class="u-url">Comparing the Partition Swaps</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/comparing-the-partition-swaps/" rel="bookmark">
            <time class="published dt-published" datetime="2022-02-23T21:29:25-08:00" itemprop="datePublished" title="2022-02-23 21:29">2022-02-23 21:29</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="outline-container-org6c78d4b" class="outline-2">
<h2 id="org6c78d4b">Introduction</h2>
<div class="outline-text-2" id="text-org6c78d4b">
<p>
This is part of a series of posts about the Partition algorithm that starts with <a href="posts/the-partition/">this post</a>.
</p>
</div>

<div id="outline-container-orgf6cc201" class="outline-3">
<h3 id="orgf6cc201">Imports and Setup</h3>
<div class="outline-text-3" id="text-orgf6cc201">
<div class="highlight"><pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">MutableSequence</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">be_true</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>

<span class="kn">import</span> <span class="nn">altair</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># monkey</span>
<span class="kn">from</span> <span class="nn">graeae.visualization.altair_helpers</span> <span class="kn">import</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">save_chart</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"comparing-the-partition-swaps"</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="n">output_path</span><span class="p">(</span><span class="n">SLUG</span><span class="p">)</span>
<span class="n">save_it</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">save_chart</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">)</span>

<span class="n">Orderable</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">"Orderable"</span><span class="p">)</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">2022</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-orge823b97" class="outline-2">
<h2 id="orge823b97">Comparing  the Swaps</h2>
<div class="outline-text-2" id="text-orge823b97">
<p>
Both of the versions of partition shown here traverse the collection once, so looking at the number of comparisons doesn't seem so interesting. According to the <a href="https://en.wikipedia.org/wiki/Quicksort">Wikipedia page on Quicksort</a>, the swaps for Hoare's method (which is slightly different from Levitin's) is better for the worst cases, so let's see if this matters for Levitin's and CLRS's swaps.
</p>
</div>

<div id="outline-container-org24e8d8f" class="outline-3">
<h3 id="org24e8d8f">Some Swap Counters</h3>
<div class="outline-text-3" id="text-org24e8d8f">
<p>
Since we're only calling the partitioners once rather than repeatedly using them to partition sub-lists in the collection we can get rid of the <code>left</code> and <code>right</code> arguments to the functions.
</p>
</div>

<div id="outline-container-orgbd79292" class="outline-4">
<h4 id="orgbd79292">A Levitin Swap Counter</h4>
<div class="outline-text-4" id="text-orgbd79292">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">levitin_swaps</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">[</span><span class="n">Orderable</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""Partitions the collection using a variation of Hoare's method</span>

<span class="sd">    Args:</span>
<span class="sd">     collection: the list to partition</span>

<span class="sd">    Returns:</span>
<span class="sd">     count of swaps</span>
<span class="sd">    """</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">pivot_element</span> <span class="o">=</span> <span class="n">collection</span><span class="p">[</span><span class="n">left</span><span class="p">]</span>
    <span class="n">partition_left</span> <span class="o">=</span> <span class="n">left</span>
    <span class="n">partition_right</span> <span class="o">=</span> <span class="n">right</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">stop_right</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">swaps</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
	<span class="k">while</span> <span class="n">partition_left</span> <span class="o">&lt;</span> <span class="n">stop_right</span><span class="p">:</span>
	    <span class="n">partition_left</span> <span class="o">+=</span> <span class="mi">1</span>
	    <span class="k">if</span> <span class="n">collection</span><span class="p">[</span><span class="n">partition_left</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">pivot_element</span><span class="p">:</span>
		<span class="k">break</span>

	<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
	    <span class="n">partition_right</span> <span class="o">-=</span> <span class="mi">1</span>
	    <span class="k">if</span> <span class="n">collection</span><span class="p">[</span><span class="n">partition_right</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">pivot_element</span><span class="p">:</span>
		<span class="k">break</span>

	<span class="k">if</span> <span class="n">partition_left</span> <span class="o">&gt;=</span> <span class="n">partition_right</span><span class="p">:</span>
	    <span class="k">break</span>

	<span class="n">collection</span><span class="p">[</span><span class="n">partition_left</span><span class="p">],</span> <span class="n">collection</span><span class="p">[</span><span class="n">partition_right</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
	    <span class="n">collection</span><span class="p">[</span><span class="n">partition_right</span><span class="p">],</span> <span class="n">collection</span><span class="p">[</span><span class="n">partition_left</span><span class="p">]</span>
	<span class="p">)</span>
	<span class="n">swaps</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># move the pivot element from the far left to its final place</span>
    <span class="n">collection</span><span class="p">[</span><span class="n">left</span><span class="p">],</span> <span class="n">collection</span><span class="p">[</span><span class="n">partition_right</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
	<span class="n">collection</span><span class="p">[</span><span class="n">partition_right</span><span class="p">],</span> <span class="n">collection</span><span class="p">[</span><span class="n">left</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">swaps</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">swaps</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">middle</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">prefix</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">middle</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">middle</span><span class="p">)</span>
<span class="n">suffix</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">middle</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">201</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">middle</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="p">[</span><span class="n">middle</span><span class="p">]</span> <span class="o">+</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">suffix</span>

<span class="n">swaps</span> <span class="o">=</span> <span class="n">levitin_swaps</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="n">item</span> <span class="o">&lt;</span> <span class="n">middle</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">test</span><span class="p">[:</span><span class="n">middle</span><span class="p">]))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="n">item</span> <span class="o">&gt;</span> <span class="n">middle</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">test</span><span class="p">[</span><span class="n">middle</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div id="outline-container-org3913979" class="outline-4">
<h4 id="org3913979">A CLRS Swap Counter</h4>
<div class="outline-text-4" id="text-org3913979">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">clrs_swaps</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">[</span><span class="n">Orderable</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""Partitions the collection around the last element</span>

<span class="sd">    Args:</span>
<span class="sd">     collection: the list to partition</span>

<span class="sd">    Returns:</span>
<span class="sd">     count of swaps</span>
<span class="sd">    """</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">pivot_element</span> <span class="o">=</span> <span class="n">collection</span><span class="p">[</span><span class="n">right</span><span class="p">]</span>
    <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">left</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">swaps</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">upper_bound</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">collection</span><span class="p">[</span><span class="n">upper_bound</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">pivot_element</span><span class="p">:</span>
	    <span class="n">lower_bound</span> <span class="o">+=</span> <span class="mi">1</span>
	    <span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="n">lower_bound</span><span class="p">],</span>
	     <span class="n">collection</span><span class="p">[</span><span class="n">upper_bound</span><span class="p">])</span> <span class="o">=</span> <span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="n">upper_bound</span><span class="p">],</span>
					 <span class="n">collection</span><span class="p">[</span><span class="n">lower_bound</span><span class="p">])</span>
	    <span class="n">swaps</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">pivot</span> <span class="o">=</span> <span class="n">lower_bound</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="n">pivot</span><span class="p">],</span>
     <span class="n">collection</span><span class="p">[</span><span class="n">right</span><span class="p">])</span> <span class="o">=</span> <span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="n">right</span><span class="p">],</span>
			   <span class="n">collection</span><span class="p">[</span><span class="n">pivot</span><span class="p">])</span>
    <span class="n">swaps</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">swaps</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">middle</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">prefix</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">middle</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">middle</span><span class="p">)</span>
<span class="n">suffix</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">middle</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">201</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">middle</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">suffix</span> <span class="o">+</span> <span class="p">[</span><span class="n">middle</span><span class="p">]</span>

<span class="n">swaps</span> <span class="o">=</span> <span class="n">clrs_swaps</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="n">item</span> <span class="o">&lt;</span> <span class="n">middle</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">test</span><span class="p">[:</span><span class="n">middle</span><span class="p">]))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="n">item</span> <span class="o">&gt;</span> <span class="n">middle</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">test</span><span class="p">[</span><span class="n">middle</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div id="outline-container-org2089354" class="outline-3">
<h3 id="org2089354">A Parallelizer Function</h3>
<div class="outline-text-3" id="text-org2089354">
<p>
This is what I'll pass to joblib to run the two swap-counter functions.
</p>

<div class="highlight"><pre><span></span><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">SwapCounts</span><span class="p">:</span>
    <span class="n">size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">swaps</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">def</span> <span class="nf">swap_counter</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">,</span> <span class="n">swap_counter</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SwapCounts</span><span class="p">:</span>
    <span class="sd">"""Runs the swap_counter over the collection of inputs</span>

<span class="sd">    Args:</span>
<span class="sd">     collection: elements to partition</span>

<span class="sd">    Returns:</span>
<span class="sd">     SwapCounts: size, swap-count</span>
<span class="sd">    """</span>
    <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
    <span class="n">swaps</span> <span class="o">=</span> <span class="n">swap_counter</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">SwapCounts</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">swaps</span><span class="o">=</span><span class="n">swaps</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">swap_plots</span><span class="p">(</span><span class="n">first_output</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">SwapCounts</span><span class="p">],</span> <span class="n">second_output</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">SwapCounts</span><span class="p">],</span>
	       <span class="n">first_label</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">second_label</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
	       <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">"""Plot the swap counts</span>

<span class="sd">    Args:</span>
<span class="sd">     first_output, second_output: lists of SwapCounts</span>
<span class="sd">     first_label, second_label: Algorithm labels for the counts</span>
<span class="sd">     title: title for the plot</span>
<span class="sd">     filename: name to save the plot to </span>
<span class="sd">    """</span>
    <span class="n">expect</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">first_output</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">second_output</span><span class="p">)))</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
	<span class="s2">"Input Size"</span><span class="p">:</span> <span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">first_output</span><span class="p">],</span>
	<span class="n">first_label</span><span class="p">:</span> <span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">swaps</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">first_output</span><span class="p">],</span>
	<span class="n">second_label</span><span class="p">:</span> <span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">swaps</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">second_output</span><span class="p">]})</span>

    <span class="n">melted</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="s2">"Input Size"</span><span class="p">,</span>
			<span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="n">first_label</span><span class="p">,</span> <span class="n">second_label</span><span class="p">],</span>
			<span class="n">var_name</span><span class="o">=</span><span class="s2">"Algorithm"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Swaps"</span><span class="p">)</span>

    <span class="n">base</span> <span class="o">=</span> <span class="p">(</span><span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_circle</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
	    <span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Input Size:Q"</span><span class="p">,</span>
			       <span class="n">scale</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span>
				   <span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">melted</span><span class="p">[</span><span class="s2">"Input Size"</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()))),</span>
		    <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Swaps:Q"</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domainMin</span><span class="o">=</span><span class="mi">0</span><span class="p">)),</span>
			       <span class="n">color</span><span class="o">=</span><span class="s2">"Algorithm:N"</span><span class="p">,</span>
		    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Input Size:Q"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
			     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Swaps:Q"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
			     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Algorithm:N"</span><span class="p">)]))</span>

    <span class="n">line</span> <span class="o">=</span> <span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">transform_regression</span><span class="p">(</span><span class="s2">"Input Size"</span><span class="p">,</span> <span class="s2">"Swaps"</span><span class="p">,</span>
				      <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s2">"Algorithm"</span><span class="p">])</span>
	    <span class="o">.</span><span class="n">mark_line</span><span class="p">())</span>
    <span class="n">chart</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="n">base</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
	<span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
	<span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
	<span class="n">height</span><span class="o">=</span><span class="mi">525</span>
    <span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

    <span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">swap_ratio_plots</span><span class="p">(</span><span class="n">first_output</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">SwapCounts</span><span class="p">],</span> <span class="n">second_output</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">SwapCounts</span><span class="p">],</span>
		     <span class="n">first_label</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">second_label</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
		     <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">"""Plot the swap count ratios</span>

<span class="sd">    Args:</span>
<span class="sd">     first_output, second_output: lists of SwapCounts</span>
<span class="sd">     first_label, second_label: Algorithm labels for the counts</span>
<span class="sd">     title: title for the plot</span>
<span class="sd">     filename: name to save the plot to </span>
<span class="sd">    """</span>
    <span class="n">expect</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">first_output</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">second_output</span><span class="p">)))</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
	<span class="s2">"Input Size"</span><span class="p">:</span> <span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">first_output</span><span class="p">],</span>
	<span class="n">first_label</span><span class="p">:</span> <span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">swaps</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">first_output</span><span class="p">],</span>
	<span class="n">second_label</span><span class="p">:</span> <span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">swaps</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">second_output</span><span class="p">]})</span>

    <span class="n">frame</span><span class="p">[</span><span class="s2">"Ratio"</span><span class="p">]</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[</span><span class="n">first_label</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">frame</span><span class="p">[</span><span class="n">second_label</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">base</span> <span class="o">=</span> <span class="p">(</span><span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">frame</span><span class="p">[[</span><span class="s2">"Input Size"</span><span class="p">,</span> <span class="s2">"Ratio"</span><span class="p">]])</span><span class="o">.</span><span class="n">mark_circle</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
	    <span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Input Size:Q"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Ratio:Q"</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domainMin</span><span class="o">=</span><span class="mi">0</span><span class="p">)),</span>
		    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Input Size"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
			     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Ratio"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">",.2f"</span><span class="p">)]))</span>

    <span class="n">line</span> <span class="o">=</span> <span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">transform_regression</span><span class="p">(</span><span class="s2">"Input Size"</span><span class="p">,</span> <span class="s2">"Ratio"</span><span class="p">)</span>
	    <span class="o">.</span><span class="n">mark_line</span><span class="p">())</span>
    <span class="n">chart</span> <span class="o">=</span> <span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
	<span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
	<span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
	<span class="n">height</span><span class="o">=</span><span class="mi">525</span>
    <span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

    <span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">swap_runner</span><span class="p">(</span><span class="n">swapper_one</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">swapper_two</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
		<span class="n">label_one</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">label_two</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
		<span class="n">things_to_partition</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">],</span>
		<span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">plotter</span><span class="p">:</span> <span class="n">Callable</span><span class="o">=</span><span class="n">swap_plots</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">"""Run the partitioners and plot</span>

<span class="sd">    Args:</span>
<span class="sd">     swapper_one, swapper_two: swap-counter functions</span>
<span class="sd">     label_one, label_two: algorithm labels for the plot</span>
<span class="sd">     things_to_partition: collections for the partitioners to partition</span>
<span class="sd">     title, filename: plot strings</span>
<span class="sd">    """</span>
    <span class="n">first_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
    <span class="n">delayed</span><span class="p">(</span><span class="n">swap_counter</span><span class="p">)(</span><span class="n">thing_to_partition</span><span class="p">,</span> <span class="n">swapper_one</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">thing_to_partition</span> <span class="ow">in</span> <span class="n">things_to_partition</span><span class="p">)</span>

    <span class="n">second_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
	<span class="n">delayed</span><span class="p">(</span><span class="n">swap_counter</span><span class="p">)(</span><span class="n">thing_to_partition</span><span class="p">,</span> <span class="n">swapper_two</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">thing_to_partition</span> <span class="ow">in</span> <span class="n">things_to_partition</span><span class="p">)</span>

    <span class="n">plotter</span><span class="p">(</span><span class="n">first_output</span><span class="p">,</span> <span class="n">second_output</span><span class="p">,</span> <span class="n">label_one</span><span class="p">,</span> <span class="n">label_two</span><span class="p">,</span>
	    <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
	    <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>

<div id="outline-container-orge6c1794" class="outline-3">
<h3 id="orge6c1794">Random Inputs</h3>
<div class="outline-text-3" id="text-orge6c1794">
<div class="highlight"><pre><span></span><span class="n">counts</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100011</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">random_things_to_partition</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>
			      <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">]</span>
<span class="n">swap_runner</span><span class="p">(</span><span class="n">levitin_swaps</span><span class="p">,</span> <span class="n">clrs_swaps</span><span class="p">,</span> <span class="s2">"Levitin"</span><span class="p">,</span> <span class="s2">"CLRS"</span><span class="p">,</span> <span class="n">random_things_to_partition</span><span class="p">,</span>
	   <span class="n">title</span><span class="o">=</span><span class="s2">"Levitin vs CLRS Partition Swap Count (Randomized Input)"</span><span class="p">,</span>
	   <span class="n">filename</span><span class="o">=</span><span class="s2">"swaps_random_2"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/comparing-the-partition-swaps/swaps_random_2.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>

<div class="highlight"><pre><span></span><span class="n">swap_runner</span><span class="p">(</span><span class="n">clrs_swaps</span><span class="p">,</span> <span class="n">levitin_swaps</span><span class="p">,</span> <span class="s2">"CLRS"</span><span class="p">,</span> <span class="s2">"Levitin"</span><span class="p">,</span> <span class="n">random_things_to_partition</span><span class="p">,</span>
	    <span class="n">title</span><span class="o">=</span><span class="s2">"CLRS/Levitin Partition Swap Ratio (Randomized Input)"</span><span class="p">,</span>
	    <span class="n">filename</span><span class="o">=</span><span class="s2">"swaps_random_ratio"</span><span class="p">,</span> <span class="n">plotter</span><span class="o">=</span><span class="n">swap_ratio_plots</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/comparing-the-partition-swaps/swaps_random_ratio.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>
</div>
</div>

<div id="outline-container-org58d4eab" class="outline-3">
<h3 id="org58d4eab">Biggest Item Last</h3>
<div class="outline-text-3" id="text-org58d4eab">
<p>
What happens if the input has the biggest item at the end of the list?
</p>

<div class="highlight"><pre><span></span><span class="n">counts</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100011</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">big_ended_things_to_partition</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">count</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">count</span><span class="p">]</span>
				 <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">]</span>

<span class="n">swap_runner</span><span class="p">(</span><span class="n">levitin_swaps</span><span class="p">,</span> <span class="n">clrs_swaps</span><span class="p">,</span> <span class="s2">"Levitin"</span><span class="p">,</span> <span class="s2">"CLRS"</span><span class="p">,</span>
	    <span class="n">big_ended_things_to_partition</span><span class="p">,</span>
	   <span class="n">title</span><span class="o">=</span><span class="s2">"Levitin vs CLRS Partition Swap Count (Biggest Item Last)"</span><span class="p">,</span>
	   <span class="n">filename</span><span class="o">=</span><span class="s2">"swaps_sorted"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/comparing-the-partition-swaps/swaps_sorted.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>
</div>
</div>

<div id="outline-container-orgcbd193f" class="outline-3">
<h3 id="orgcbd193f">Sorted</h3>
<div class="outline-text-3" id="text-orgcbd193f">
<p>
What happens if the input is already sorted?
</p>

<div class="highlight"><pre><span></span><span class="n">counts</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100011</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">sorted_things_to_partition</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">))</span> <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">]</span>

<span class="n">swap_runner</span><span class="p">(</span><span class="n">levitin_swaps</span><span class="p">,</span> <span class="n">clrs_swaps</span><span class="p">,</span> <span class="s2">"Levitin"</span><span class="p">,</span> <span class="s2">"CLRS"</span><span class="p">,</span>
	    <span class="n">sorted_things_to_partition</span><span class="p">,</span>
	    <span class="n">title</span><span class="o">=</span><span class="s2">"Levitin vs CLRS Partition Swap Count (Sorted input)"</span><span class="p">,</span>
	   <span class="n">filename</span><span class="o">=</span><span class="s2">"swaps_already_sorted"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/comparing-the-partition-swaps/swaps_already_sorted.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>
</div>
</div>

<div id="outline-container-orgde702b4" class="outline-3">
<h3 id="orgde702b4">All The Same</h3>
<div class="outline-text-3" id="text-orgde702b4">
<div class="highlight"><pre><span></span><span class="n">counts</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100011</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">same_things_to_partition</span> <span class="o">=</span> <span class="p">[[</span><span class="n">count</span><span class="p">]</span> <span class="o">*</span> <span class="n">count</span> <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">]</span>

<span class="n">swap_runner</span><span class="p">(</span><span class="n">clrs_swaps</span><span class="p">,</span> <span class="n">levitin_swaps</span><span class="p">,</span> <span class="s2">"CLRS"</span><span class="p">,</span> <span class="s2">"Levitin"</span><span class="p">,</span> <span class="n">same_things_to_partition</span><span class="p">,</span>
	   <span class="n">title</span><span class="o">=</span><span class="s2">"Levitin vs CLRS Partition Swap Count (All Same Input)"</span><span class="p">,</span>
	   <span class="n">filename</span><span class="o">=</span><span class="s2">"swaps_all_same"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/comparing-the-partition-swaps/swaps_all_same.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>

<div class="highlight"><pre><span></span><span class="n">swap_runner</span><span class="p">(</span><span class="n">clrs_swaps</span><span class="p">,</span> <span class="n">levitin_swaps</span><span class="p">,</span><span class="s2">"CLRS"</span><span class="p">,</span> <span class="s2">"Levitin"</span><span class="p">,</span> <span class="n">same_things_to_partition</span><span class="p">,</span>
	   <span class="n">title</span><span class="o">=</span><span class="s2">"CLRS/Levitin Partition Swap Ratio (All Same Input)"</span><span class="p">,</span>
	   <span class="n">filename</span><span class="o">=</span><span class="s2">"swaps_all_same_ratio"</span><span class="p">,</span> <span class="n">plotter</span><span class="o">=</span><span class="n">swap_ratio_plots</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/comparing-the-partition-swaps/swaps_all_same_ratio.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>
</div>
</div>
</div>

<div id="outline-container-orgb843d9d" class="outline-2">
<h2 id="orgb843d9d">Randomized Swaps</h2>
<div class="outline-text-2" id="text-orgb843d9d">
</div>
<div id="outline-container-org0f2dbd8" class="outline-3">
<h3 id="org0f2dbd8">A Randomized Swap Counter</h3>
<div class="outline-text-3" id="text-org0f2dbd8">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">randomized_swaps</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">[</span><span class="n">Orderable</span><span class="p">],</span>
		     <span class="n">partition</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">pivot</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""Partitions the collection around the last element</span>

<span class="sd">    Args:</span>
<span class="sd">     collection: the list to partition</span>
<span class="sd">     partition: function to partition the list</span>
<span class="sd">     pivot: index of the element used for the pivot</span>

<span class="sd">    Returns:</span>
<span class="sd">     count of swaps</span>
<span class="sd">    """</span>
    <span class="n">random_index</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">collection</span><span class="p">))</span>
    <span class="n">collection</span><span class="p">[</span><span class="n">pivot</span><span class="p">],</span> <span class="n">collection</span><span class="p">[</span><span class="n">random_index</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="n">random_index</span><span class="p">],</span>
						   <span class="n">collection</span><span class="p">[</span><span class="n">pivot</span><span class="p">])</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">partition</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">randomized_levitin</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">randomized_swaps</span><span class="p">,</span> <span class="n">partition</span><span class="o">=</span><span class="n">levitin_swaps</span><span class="p">,</span> <span class="n">pivot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">randomized_clrs</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">randomized_swaps</span><span class="p">,</span> <span class="n">partition</span><span class="o">=</span><span class="n">clrs_swaps</span><span class="p">,</span> <span class="n">pivot</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div id="outline-container-orgb56a7b0" class="outline-3">
<h3 id="orgb56a7b0">Randomized Levitin Swaps</h3>
<div class="outline-text-3" id="text-orgb56a7b0">
</div>
<div id="outline-container-org400fa40" class="outline-4">
<h4 id="org400fa40">Shuffled Input</h4>
<div class="outline-text-4" id="text-org400fa40">
<div class="highlight"><pre><span></span><span class="n">swap_runner</span><span class="p">(</span><span class="n">levitin_swaps</span><span class="p">,</span> <span class="n">randomized_levitin</span><span class="p">,</span> <span class="s2">"Levitin"</span><span class="p">,</span> <span class="s2">"Randomized Levitin"</span><span class="p">,</span>
	    <span class="n">random_things_to_partition</span><span class="p">,</span>
	   <span class="n">title</span><span class="o">=</span><span class="s2">"Levitin vs Randomized Levitin Partition Swap Count (Randomized Input)"</span><span class="p">,</span>
	   <span class="n">filename</span><span class="o">=</span><span class="s2">"swaps_randomized_random"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/comparing-the-partition-swaps/swaps_randomized_random.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>
</div>
</div>

<div id="outline-container-orgcac08a7" class="outline-4">
<h4 id="orgcac08a7">Smallest Item At the End</h4>
<div class="outline-text-4" id="text-orgcac08a7">
<div class="highlight"><pre><span></span><span class="n">counts</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100011</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">backwards_things_to_partition</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">count</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">count</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
				 <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">]</span>

<span class="n">swap_runner</span><span class="p">(</span><span class="n">levitin_swaps</span><span class="p">,</span> <span class="n">randomized_levitin</span><span class="p">,</span> <span class="s2">"Levitin"</span><span class="p">,</span> <span class="s2">"Randomized Levitin"</span><span class="p">,</span>
	    <span class="n">backwards_things_to_partition</span><span class="p">,</span>
	    <span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="s2">"Levitin vs Randomized Levitin Partition Swap Count (Backwards Input)"</span><span class="p">),</span>
	    <span class="n">filename</span><span class="o">=</span><span class="s2">"swaps_levitin_randomized_sorted_backwards"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/comparing-the-partition-swaps/swaps_levitin_randomized_sorted_backwards.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>
</div>
</div>


<div id="outline-container-org1c2762f" class="outline-4">
<h4 id="org1c2762f">All The Same Input</h4>
<div class="outline-text-4" id="text-org1c2762f">
<p>
Since only difference between the randomized and the non-randomized input is that the pivot was (probably) swapped out, the input will look the same when all the values are the same to start with so I'm not going to re-plot those.
</p>
</div>
</div>
</div>

<div id="outline-container-orga79366a" class="outline-3">
<h3 id="orga79366a">Randomized CLRS Swaps</h3>
<div class="outline-text-3" id="text-orga79366a">
</div>
<div id="outline-container-orgb8018b7" class="outline-4">
<h4 id="orgb8018b7">Shuffled Input</h4>
<div class="outline-text-4" id="text-orgb8018b7">
<div class="highlight"><pre><span></span><span class="n">swap_runner</span><span class="p">(</span><span class="n">clrs_swaps</span><span class="p">,</span> <span class="n">randomized_clrs</span><span class="p">,</span> <span class="s2">"CLRS"</span><span class="p">,</span> <span class="s2">"Randomized CLRS"</span><span class="p">,</span>
	    <span class="n">random_things_to_partition</span><span class="p">,</span>
	   <span class="n">title</span><span class="o">=</span><span class="s2">"CLRS vs Randomized CLRS Partition Swap Count (Randomized Input)"</span><span class="p">,</span>
	   <span class="n">filename</span><span class="o">=</span><span class="s2">"swaps_randomized_clrs_random"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/comparing-the-partition-swaps/swaps_randomized_clrs_random.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>
</div>
</div>

<div id="outline-container-orgb7ffaf6" class="outline-4">
<h4 id="orgb7ffaf6">Biggest Item at the End</h4>
<div class="outline-text-4" id="text-orgb7ffaf6">
<div class="highlight"><pre><span></span><span class="n">swap_runner</span><span class="p">(</span><span class="n">clrs_swaps</span><span class="p">,</span> <span class="n">randomized_clrs</span><span class="p">,</span> <span class="s2">"CLRS"</span><span class="p">,</span> <span class="s2">"Randomized CLRS"</span><span class="p">,</span>
	    <span class="n">big_ended_things_to_partition</span><span class="p">,</span>
	    <span class="n">title</span><span class="o">=</span><span class="s2">"CLRS vs Randomized CLRS Partition Swap Count (Big-Ended Input)"</span><span class="p">,</span>
	    <span class="n">filename</span><span class="o">=</span><span class="s2">"swaps_clrs_randomized_big_ended"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/comparing-the-partition-swaps/swaps_clrs_randomized_big_ended.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>
</div>
</div>

<div id="outline-container-org30b2eb5" class="outline-4">
<h4 id="org30b2eb5">Sorted</h4>
<div class="outline-text-4" id="text-org30b2eb5">
<div class="highlight"><pre><span></span><span class="n">swap_runner</span><span class="p">(</span><span class="n">clrs_swaps</span><span class="p">,</span> <span class="n">randomized_clrs</span><span class="p">,</span> <span class="s2">"CLRS"</span><span class="p">,</span> <span class="s2">"Randomized CLRS"</span><span class="p">,</span>
	    <span class="n">sorted_things_to_partition</span><span class="p">,</span>
	    <span class="n">title</span><span class="o">=</span><span class="s2">"CLRS vs Randomized CLRS Partition Swap Count (Sorted Input)"</span><span class="p">,</span>
	    <span class="n">filename</span><span class="o">=</span><span class="s2">"swaps_clrs_randomized_sorted"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/comparing-the-partition-swaps/swaps_clrs_randomized_sorted.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>
</div>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/clrs-partition/" class="u-url">CLRS Partition</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/clrs-partition/" rel="bookmark">
            <time class="published dt-published" datetime="2022-02-23T19:51:19-08:00" itemprop="datePublished" title="2022-02-23 19:51">2022-02-23 19:51</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="outline-container-orgab24c6c" class="outline-2">
<h2 id="orgab24c6c">Introduction</h2>
<div class="outline-text-2" id="text-orgab24c6c">
<p>
This is part of a series that starts with <a href="posts/the-partition/">this post</a>.
</p>
</div>

<div id="outline-container-org63227ab" class="outline-3">
<h3 id="org63227ab">Imports and Setup</h3>
<div class="outline-text-3" id="text-org63227ab">
<div class="highlight"><pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">MutableSequence</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">be_true</span><span class="p">,</span> <span class="n">contain_exactly</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>

<span class="kn">import</span> <span class="nn">altair</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># software under test</span>
<span class="kn">from</span> <span class="nn">bowling.sort.quick</span> <span class="kn">import</span> <span class="n">clrs_partition</span>

<span class="c1"># monkey</span>
<span class="kn">from</span> <span class="nn">graeae.visualization.altair_helpers</span> <span class="kn">import</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">save_chart</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"clrs-partition"</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="n">output_path</span><span class="p">(</span><span class="n">SLUG</span><span class="p">)</span>
<span class="n">save_it</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">save_chart</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-org405eea4" class="outline-2">
<h2 id="org405eea4">The Algorithm</h2>
<div class="outline-text-2" id="text-org405eea4">
<p>
The CLRS version seems a little clearer to follow although they use the last element as the pivot element instead of the first which threw me off for a bit. It uses a single for loop which moves anything less than the pivot element to the lower partition as it traverses the elements.
</p>

<pre id="the-clrs-partition" style="display:hidden;">
\begin{algorithm}
\caption{Partition (CLRS)}
\begin{algorithmic}
\INPUT An array and left and right locations defining a subarray
\OUTPUT The sub-array from left to right is partitioned and the partition location is returned

\PROCEDURE{Partition}{A, left, right}

\STATE PivotElement $\gets$ A[right]
\STATE LowerBound $\gets$ left - 1

\FOR {UpperBound $\in$ \{left $\ldots$ right - 1\}}
 \IF {A[UpperBound] $\leq$ PivotElement}
   \STATE LowerBound = LowerBound + 1
   \STATE \textsc{Swap}(A[LowerBound], A[UpperBound])
 \ENDIF
\ENDFOR

\STATE pivot $\gets$ LowerBound + 1
\STATE \textsc{Swap}(A[pivot], A[right])
\RETURN pivot
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>

<p>
The <i>LowerBound</i> is the index of the last element less than or equal to the pivot and <i>LowerBound + 1</i> is the first element greater than the pivot. The <i>UpperBound</i> is the index of the last item greater than the pivot.
</p>

<p>
The <i>LowerBound</i> is like a demon that guards the lower partition and the <i>UpperBound</i> is another demon that plows through the array, throwing any elements that belong in the lower partition back to the <i>LowerBound</i> demon who throws the first element in the upper partition back up to the <i>UpperBound</i> and moves up to guard the expanded lower partition.
</p>
</div>
<div id="outline-container-orgaaffc0c" class="outline-3">
<h3 id="orgaaffc0c">A Worked Example</h3>
<div class="outline-text-3" id="text-orgaaffc0c">
<p>
We can take a look at how this works using a table. I'll use <i>LB</i> for the <i>LowerBound</i> index, <i>UB</i> for the <i>UpperBound</i> index, and <i>x</i> for the <i>PivotElement</i> to keep the table from getting too wide (hopefully). The array to partition is <code>[5, 7, 9, 4, 6]</code> with a zero-based index so <i>left</i> = 0, <i>right</i> = 4 and <i>x</i> (the pivot element) is 6.
</p>

<p>
Here are the values for the variables as we step through the for-loop.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-right">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">UB</th>
<th scope="col" class="org-right">A[UB]</th>
<th scope="col" class="org-left">A[UB] \(\leq\) x</th>
<th scope="col" class="org-right">LB</th>
<th scope="col" class="org-left">A</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">5</td>
<td class="org-left">True</td>
<td class="org-right">0</td>
<td class="org-left">5, 7, 9, 4, 6</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">7</td>
<td class="org-left">False</td>
<td class="org-right">0</td>
<td class="org-left">5, 7, 9, 4, 6</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-right">9</td>
<td class="org-left">False</td>
<td class="org-right">0</td>
<td class="org-left">5, 7, 9, 4, 6</td>
</tr>
<tr>
<td class="org-right">3</td>
<td class="org-right">4</td>
<td class="org-left">True</td>
<td class="org-right">1</td>
<td class="org-left">5, 4, 9, 7, 6</td>
</tr>
</tbody>
</table>
<p>
As long and the element in the array we're checking is less than or equal to the Pivot Element we increment the LowerBound along with the Upper Bound since the element belongs in the lower partition. If the Lower and Upper bound indexes are equal, than they agree on where it is so nothing happens when we do the swap (or you could say they swap in place, maybe). But while the element checked is larger than the Pivot Element the Upper Bound Index goes up but the Lower Bound doesn't so when we next hit a case where the element is less than or equal to the Pivot Element, we know it's out of place and needs to be swapped with the element currently just after the lower partition.
</p>

<p>
Once we're out of the loop we then swap out the Pivot Element and the element to the right of the Lower Bound (so the first element of the Upper Bound) and return the location where the Pivot Element ended up.
</p>

<ul class="org-ul">
<li>pivot = 2</li>
<li>A = [5, 4, 6, 7, 9]</li>
</ul>
</div>
</div>

<div id="outline-container-org814caa7" class="outline-3">
<h3 id="org814caa7">An Odd Case</h3>
<div class="outline-text-3" id="text-org814caa7">
<p>
What happens if the last element is the largest element?
</p>

<ul class="org-ul">
<li>A = [9, 6, 25, 4, 100]</li>
<li>x = 100</li>
</ul>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-right">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">UB</th>
<th scope="col" class="org-right">A[UB]</th>
<th scope="col" class="org-left">A[UB] \(\leq\) x</th>
<th scope="col" class="org-right">LB</th>
<th scope="col" class="org-left">A</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">9</td>
<td class="org-left">True</td>
<td class="org-right">0</td>
<td class="org-left">9, 6, 25, 4, 100</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">6</td>
<td class="org-left">True</td>
<td class="org-right">1</td>
<td class="org-left">9, 6, 25, 4, 100</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-right">25</td>
<td class="org-left">True</td>
<td class="org-right">2</td>
<td class="org-left">9, 6, 25, 4, 100</td>
</tr>
<tr>
<td class="org-right">3</td>
<td class="org-right">4</td>
<td class="org-left">True</td>
<td class="org-right">3</td>
<td class="org-left">9, 6, 25, 4, 100</td>
</tr>
</tbody>
</table>
<p>
And in the end we have a pivot of \(LB + 1 = 4\) (the last element) with the lower partition being everything but the last element and no elements in the upper partition. If the array happened to be already sorted than any attempt to partition a sub-array would end up with a similar output with an empty upper partition. This doesn't really matter here, but when we use it in quicksort it will.
</p>

<p>
Since nothing happens when an element being checked is greater than the pivot element, if the pivot element happens to be the smallest item in the array we'd have a similar case with an empty lower partition, the pivot element as the first element, and the rest of the elements in the upper partition, so starting with an array that's in reversed-sorted-order would also always end up with empty partitions no matter how we choose the sub-arrays.
</p>
</div>
</div>
</div>
<div id="outline-container-org782cb14" class="outline-2">
<h2 id="org782cb14">The Implementation</h2>
<div class="outline-text-2" id="text-org782cb14">
<p>
According to wikipedia, the version <a href="posts/clrs/">CLRS</a> uses is a version of the <a href="https://en.wikipedia.org/wiki/Quicksort#Lomuto_partition_scheme">Lomuto Partition Scheme</a>, created by Nico Lomuto.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">partition_clrs</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">,</span> <span class="n">left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""Partitions the collection around the last element</span>

<span class="sd">    Args:</span>
<span class="sd">     collection: the list to partition</span>
<span class="sd">     left: index of the first element in the sub-list to partition</span>
<span class="sd">     right: index of the last element in the sub-list to partition</span>

<span class="sd">    Returns:</span>
<span class="sd">     the index of the pivot element</span>
<span class="sd">    """</span>
    <span class="n">pivot_element</span> <span class="o">=</span> <span class="n">collection</span><span class="p">[</span><span class="n">right</span><span class="p">]</span>
    <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">left</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">upper_bound</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">collection</span><span class="p">[</span><span class="n">upper_bound</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">pivot_element</span><span class="p">:</span>
	    <span class="n">lower_bound</span> <span class="o">+=</span> <span class="mi">1</span>
	    <span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="n">lower_bound</span><span class="p">],</span>
	     <span class="n">collection</span><span class="p">[</span><span class="n">upper_bound</span><span class="p">])</span> <span class="o">=</span> <span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="n">upper_bound</span><span class="p">],</span>
					 <span class="n">collection</span><span class="p">[</span><span class="n">lower_bound</span><span class="p">])</span>
    <span class="n">pivot</span> <span class="o">=</span> <span class="n">lower_bound</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="n">pivot</span><span class="p">],</span>
     <span class="n">collection</span><span class="p">[</span><span class="n">right</span><span class="p">])</span> <span class="o">=</span> <span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="n">right</span><span class="p">],</span>
			   <span class="n">collection</span><span class="p">[</span><span class="n">pivot</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">pivot</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgd083d49" class="outline-2">
<h2 id="orgd083d49">Some Checks</h2>
<div class="outline-text-2" id="text-orgd083d49">
</div>
<div id="outline-container-org64e9df9" class="outline-3">
<h3 id="org64e9df9">The First Example</h3>
<div class="outline-text-3" id="text-org64e9df9">
<p>
This is the worked example I gave.
</p>

<div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
<span class="n">first_expected_pivot</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">pivot</span> <span class="o">=</span> <span class="n">clrs_partition</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">pivot</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">first_expected_pivot</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">test</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>
</pre></div>

<p>
And to make sure the sub-list works (as opposed to using the whole list).
</p>

<div class="highlight"><pre><span></span><span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">999</span><span class="p">,</span> <span class="mi">888</span><span class="p">,</span> <span class="mi">777</span><span class="p">]</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">left</span> <span class="o">+</span> <span class="n">start</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="o">+</span> <span class="n">right</span>

<span class="n">pivot</span> <span class="o">=</span> <span class="n">clrs_partition</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

<span class="c1"># all we did was shift the sub-list to spots to the right</span>
<span class="n">expect</span><span class="p">(</span><span class="n">pivot</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">first_expected_pivot</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span>

<span class="c1"># only the sub-list should be partitioned</span>
<span class="n">expect</span><span class="p">(</span><span class="n">test</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">expected</span> <span class="o">+</span> <span class="n">right</span><span class="p">)))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org63e6674" class="outline-3">
<h3 id="org63e6674">The Pivot Is the Biggest Element</h3>
<div class="outline-text-3" id="text-org63e6674">
<p>
If the last element (the pivot) is the biggest element then partitioning doesn't do anything to the list.
</p>

<div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">pivot</span> <span class="o">=</span> <span class="n">clrs_partition</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="c1"># the pivot should be the last element</span>
<span class="n">expect</span><span class="p">(</span><span class="n">pivot</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>

<span class="c1"># nothing changes in the list</span>
<span class="n">expect</span><span class="p">(</span><span class="n">test</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">start</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div id="outline-container-org7998ca9" class="outline-3">
<h3 id="org7998ca9">Small Inputs</h3>
<div class="outline-text-3" id="text-org7998ca9">
<p>
Make sure it can handle collections of small size.
</p>

<div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">pivot</span> <span class="o">=</span> <span class="n">clrs_partition</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">pivot</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

<span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">pivot</span> <span class="o">=</span> <span class="n">clrs_partition</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">pivot</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org18bce78" class="outline-3">
<h3 id="org18bce78">Big Inputs</h3>
<div class="outline-text-3" id="text-org18bce78">
<p>
This is the same test as given to the Levitin version except we need to move the test-value to the end of the input list.
</p>

<div class="highlight"><pre><span></span><span class="n">prefix</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">middle</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">suffix</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">101</span><span class="p">,</span> <span class="mi">201</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">suffix</span> <span class="o">+</span> <span class="p">[</span><span class="n">middle</span><span class="p">]</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">clrs_partition</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">middle</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="n">output</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">middle</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="n">item</span> <span class="o">&lt;</span> <span class="n">middle</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">test</span><span class="p">[:</span><span class="n">output</span><span class="p">]))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="n">item</span> <span class="o">&gt;</span> <span class="n">middle</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">test</span><span class="p">[</span><span class="n">output</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div id="outline-container-orgd74b441" class="outline-2">
<h2 id="orgd74b441">A CLRS Tracker</h2>
<div class="outline-text-2" id="text-orgd74b441">
<p>
This should be the same function (as <code>clrs_partition</code>) but it collects the locations of the elements within the list as they get swapped around.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">partition_tracker</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">,</span> 
		      <span class="n">left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
    <span class="sd">"""Partitions the collection around the last element</span>

<span class="sd">    Args:</span>
<span class="sd">     collection: the list to partition</span>
<span class="sd">     left: index of the first element in the sub-list to partition</span>
<span class="sd">     right: index of the last element in the sub-list to partition</span>

<span class="sd">    Returns:</span>
<span class="sd">     locations dict, lower_bounds, upper_bounds</span>
<span class="sd">    """</span>
    <span class="n">locations</span> <span class="o">=</span> <span class="p">{</span><span class="n">value</span><span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">collection</span><span class="p">)}</span>

    <span class="n">pivot_element</span> <span class="o">=</span> <span class="n">collection</span><span class="p">[</span><span class="n">right</span><span class="p">]</span>
    <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">left</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="n">lower_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">lower_bound</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">upper_bound</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">collection</span><span class="p">[</span><span class="n">upper_bound</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">pivot_element</span><span class="p">:</span>
	    <span class="n">lower_bound</span> <span class="o">+=</span> <span class="mi">1</span>
	    <span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="n">lower_bound</span><span class="p">],</span>
	     <span class="n">collection</span><span class="p">[</span><span class="n">upper_bound</span><span class="p">])</span> <span class="o">=</span> <span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="n">upper_bound</span><span class="p">],</span>
					 <span class="n">collection</span><span class="p">[</span><span class="n">lower_bound</span><span class="p">])</span>
	<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">collection</span><span class="p">):</span>
	    <span class="n">locations</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
	<span class="n">lower_bounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lower_bound</span><span class="p">)</span>
    <span class="n">pivot</span> <span class="o">=</span> <span class="n">lower_bound</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="n">pivot</span><span class="p">],</span>
     <span class="n">collection</span><span class="p">[</span><span class="n">right</span><span class="p">])</span> <span class="o">=</span> <span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="n">right</span><span class="p">],</span>
			   <span class="n">collection</span><span class="p">[</span><span class="n">pivot</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">collection</span><span class="p">):</span>
	<span class="n">locations</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="n">lower_bounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lower_bound</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">locations</span><span class="p">,</span> <span class="n">lower_bounds</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">partition_track_plotter</span><span class="p">(</span><span class="n">locations</span><span class="p">,</span> <span class="n">lower_bounds</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span>
    <span class="n">re_indexed</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"Step"</span><span class="p">})</span>

    <span class="n">melted</span> <span class="o">=</span> <span class="n">re_indexed</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Step"</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">"Element"</span><span class="p">,</span>
			     <span class="n">value_name</span><span class="o">=</span><span class="s2">"Location"</span><span class="p">)</span>

    <span class="n">lower_frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"Lower Bound"</span><span class="p">:</span> <span class="n">lower_bounds</span><span class="p">})</span>
    <span class="n">re_lowered</span> <span class="o">=</span> <span class="n">lower_frame</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"Step"</span><span class="p">})</span>
    <span class="n">low_melted</span> <span class="o">=</span> <span class="n">re_lowered</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Step"</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">"Element"</span><span class="p">,</span>
				 <span class="n">value_name</span><span class="o">=</span><span class="s2">"Location"</span><span class="p">)</span>


    <span class="n">last_location</span> <span class="o">=</span> <span class="n">melted</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="n">elements</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
	<span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Step:Q"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">tickMinStep</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span>
	<span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Location:Q"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">tickMinStep</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
		   <span class="n">scale</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">last_location</span><span class="p">))),</span>
	<span class="n">color</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">"Element:O"</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
	<span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"Step"</span><span class="p">,</span> <span class="s2">"Element"</span><span class="p">,</span> <span class="s2">"Location"</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="n">lower</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">low_melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
	<span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Step:Q"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">tickMinStep</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span>
	<span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Location:Q"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">tickMinStep</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
		   <span class="n">scale</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">last_location</span><span class="p">))),</span>
	<span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"Step"</span><span class="p">,</span> <span class="s2">"Location"</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="n">chart</span> <span class="o">=</span> <span class="p">(</span><span class="n">elements</span> <span class="o">+</span> <span class="n">lower</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
	<span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
	<span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">520</span>
    <span class="p">)</span>

    <span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
<div id="outline-container-orgb28b539" class="outline-3">
<h3 id="orgb28b539">A Backwards Case</h3>
<div class="outline-text-3" id="text-orgb28b539">
<p>
First, a plot of a list that starts out with all the elements greater than the pivot followed by all the elements less than the pivot.
</p>

<div class="highlight"><pre><span></span><span class="n">middle</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">first_half</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">middle</span><span class="p">))</span>
<span class="n">second_half</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">middle</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">middle</span><span class="p">))</span>

<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">first_half</span><span class="p">)</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">second_half</span>
<span class="p">)</span>
<span class="n">items</span> <span class="o">=</span> <span class="n">second_half</span> <span class="o">+</span> <span class="n">first_half</span> <span class="o">+</span> <span class="p">[</span><span class="n">middle</span><span class="p">]</span>

<span class="n">locations</span><span class="p">,</span> <span class="n">lower_bounds</span> <span class="o">=</span> <span class="n">partition_tracker</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">partition_track_plotter</span><span class="p">(</span><span class="n">locations</span><span class="p">,</span> <span class="n">lower_bounds</span><span class="p">,</span> <span class="s2">"CLRS Worst-Case Swapping"</span><span class="p">,</span> <span class="s2">"clrs-worst-case"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/clrs-partition/clrs-worst-case.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>

<p>
What we have here is that the first half of the steps are going over the items greater than the pivot so we never get past the conditional in the loop, thus nothing gets moved around. Then at the halfway point we start going over all the items bigger than the pivot so every item from that point gets swapped to the lower partition. Then in the final step we're out of the loop and the pivot gets moved to the middle of the partitions.
</p>

<p>
The red-line marks the last item in the lower partition. Even though I randomized the items, since we aren't sorting the values, just moving them backwards and forwards around the partitioning, it doesn't affect what happens.
</p>
</div>
</div>

<div id="outline-container-org9231b89" class="outline-3">
<h3 id="org9231b89">A More Random Case</h3>
<div class="outline-text-3" id="text-org9231b89">
<p>
Let's try something a little more random.
</p>

<div class="highlight"><pre><span></span><span class="n">middle</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">first_half</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">middle</span><span class="p">))</span>
<span class="n">second_half</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">middle</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">middle</span><span class="p">))</span>
<span class="n">items</span> <span class="o">=</span> <span class="n">first_half</span> <span class="o">+</span> <span class="n">second_half</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
<span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">middle</span><span class="p">)</span>

<span class="n">locations</span><span class="p">,</span> <span class="n">lower_bounds</span> <span class="o">=</span> <span class="n">partition_tracker</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">partition_track_plotter</span><span class="p">(</span><span class="n">locations</span><span class="p">,</span> <span class="n">lower_bounds</span><span class="p">,</span>
			<span class="n">title</span><span class="o">=</span><span class="s2">"Randomized Input"</span><span class="p">,</span>
			<span class="n">filename</span><span class="o">=</span><span class="s2">"partitioning-plot"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/clrs-partition/partitioning-plot.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>


<p>
Not a whole lot more interesting, but it shows how it normally works with the function moving things that have a lower value than the pivot element down to where the red line is (indicating the lower partition) whenever it's encountered as the loop is traversed, then at the end the pivot element gets swapped with the element that's just above the red line.
</p>
</div>
</div>
</div>
<div id="outline-container-orgc99edd0" class="outline-2">
<h2 id="orgc99edd0">Sources</h2>
<div class="outline-text-2" id="text-orgc99edd0">
<ul class="org-ul">
<li><a href="posts/clrs/">Introduction To Algorithms (CLRS)</a></li>
<li><a href="https://en.wikipedia.org/wiki/Quicksort">Wikipedia on Quicksort</a></li>
</ul>
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("the-clrs-partition"));
});
</script>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/levitins-partition/" class="u-url">Levitin's Partition</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/levitins-partition/" rel="bookmark">
            <time class="published dt-published" datetime="2022-02-23T17:13:44-08:00" itemprop="datePublished" title="2022-02-23 17:13">2022-02-23 17:13</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li>
<a href="posts/levitins-partition/#org72ff2a5">Introduction</a>
<ul>
<li><a href="posts/levitins-partition/#orga6ecb51">The Algorithm</a></li>
<li>
<a href="posts/levitins-partition/#orge1c5be2">The Implementation</a>
<ul>
<li><a href="posts/levitins-partition/#org91a8542">Imports</a></li>
<li><a href="posts/levitins-partition/#org286b707">Some Checks</a></li>
</ul>
</li>
<li>
<a href="posts/levitins-partition/#org0db842e">A Levitin Tracker</a>
<ul>
<li><a href="posts/levitins-partition/#org64e3b79">A Backwards Case</a></li>
<li><a href="posts/levitins-partition/#org1f5af99">A More Random Case</a></li>
</ul>
</li>
<li><a href="posts/levitins-partition/#org33fbc47">A Sketch Of The Implementation</a></li>
</ul>
</li>
<li><a href="posts/levitins-partition/#org0563ec8">Sources</a></li>
</ul>
</div>
</div>
<div id="outline-container-org72ff2a5" class="outline-2">
<h2 id="org72ff2a5">Introduction</h2>
<div class="outline-text-2" id="text-org72ff2a5">
<p>
This is part of a series that starts with <a href="posts/the-partition/">this post</a>.
</p>
</div>
<div id="outline-container-orga6ecb51" class="outline-3">
<h3 id="orga6ecb51">The Algorithm</h3>
<div class="outline-text-3" id="text-orga6ecb51">
<p>
The Levitin version of the Partition function is a little more complicated than the CLRS version. It uses an outer loop with two inner loops. The outer loop continues until the indices for the partitions cross-over (or meet) and the inner loops move the boundaries until they find a value that needs to be swapped to the other partition (e.g. the loop sweeping upwards finds an element that's greater than or equal to the pivot element and so it needs to be moved to the upper partition). It uses the first element in the array as the value around which to partition the array.
</p>

<pre id="the-levitin-partition" style="display:hidden;">
\begin{algorithm}
\caption{Partition (Levitin)}
\begin{algorithmic}
\INPUT An array and left and right locations defining a subarray
\OUTPUT The sub-array from left to right is partitioned and the partition location is returned

\PROCEDURE{Partition}{A, left, right}

\STATE PivotElement $\gets$ A[left]
\STATE PartitionLeft $\gets$ left
\STATE PartitionRight $\gets$ right + 1
\STATE \\
\REPEAT
  \REPEAT
    \STATE PartitionLeft $\gets$ PartitionLeft + 1
  \UNTIL {A[PartitionLeft] $\geq$ PivotElement}
  \STATE \\
  \REPEAT
    \STATE PartitionRight $\gets$ PartitionRight - 1
  \UNTIL {A[PartitionRight] $\leq$ PivotElement}

  \STATE \\ Swap(A[PartitionLeft], A[PartitionRight])

\UNTIL {PartitionLeft $\geq$ PartitionRight}
\STATE \\ Swap(A[PartitionLeft], A[PartitionRight])
\STATE Swap(A[left], A[PartitionRight])

\RETURN PartitionRight
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>
</div>
</div>

<div id="outline-container-orge1c5be2" class="outline-3">
<h3 id="orge1c5be2">The Implementation</h3>
<div class="outline-text-3" id="text-orge1c5be2">
</div>
<div id="outline-container-org91a8542" class="outline-4">
<h4 id="org91a8542">Imports</h4>
<div class="outline-text-4" id="text-org91a8542">
<div class="highlight"><pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">MutableSequence</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">be_true</span><span class="p">,</span> <span class="n">contain_exactly</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>

<span class="kn">import</span> <span class="nn">altair</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># software under test</span>
<span class="kn">from</span> <span class="nn">bowling.sort.quick</span> <span class="kn">import</span> <span class="n">levitins_partition</span>

<span class="c1"># monkey</span>
<span class="kn">from</span> <span class="nn">graeae.visualization.altair_helpers</span> <span class="kn">import</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">save_chart</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"levitins-partition"</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="n">output_path</span><span class="p">(</span><span class="n">SLUG</span><span class="p">)</span>
<span class="n">save_it</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">save_chart</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">)</span>
</pre></div>

<p>
The version <a href="posts/itdaa/">Levitin</a> uses appears to be closer to the <a href="https://en.wikipedia.org/wiki/Quicksort#Hoare_partition_scheme">version given by Tony Hoare</a>, the creator of Quicksort. A notable difference between Wikipedia's pseudocode for Hoare's version and this version is that Hoare uses the middle element in the sub-array as the pivot while Levitin uses the left-most element as the pivot.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">partition_levitin</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">,</span>
		      <span class="n">left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""Partitions the collection around the first element</span>

<span class="sd">    Args:</span>
<span class="sd">     collection: the list to partition</span>
<span class="sd">     left: index of the first element in the sub-list to partition</span>
<span class="sd">     right: index of the last element in the sub-list to partition</span>

<span class="sd">    Returns:</span>
<span class="sd">     the index of the pivot element</span>
<span class="sd">    """</span>
    <span class="n">pivot_element</span> <span class="o">=</span> <span class="n">collection</span><span class="p">[</span><span class="n">left</span><span class="p">]</span>
    <span class="n">partition_left</span> <span class="o">=</span> <span class="n">left</span>
    <span class="n">partition_right</span> <span class="o">=</span> <span class="n">right</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
	<span class="c1"># if the pivot element is the largest element this loop</span>
	<span class="c1"># will try to go past the end of the list so we need a</span>
	<span class="c1"># check in the loop before we increment the partition_left</span>
	<span class="k">while</span> <span class="n">partition_left</span> <span class="o">&lt;</span> <span class="n">right</span><span class="p">:</span>
	    <span class="n">partition_left</span> <span class="o">+=</span> <span class="mi">1</span>
	    <span class="k">if</span> <span class="n">collection</span><span class="p">[</span><span class="n">partition_left</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">pivot_element</span><span class="p">:</span>
		<span class="k">break</span>

	<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
	    <span class="n">partition_right</span> <span class="o">-=</span> <span class="mi">1</span>
	    <span class="k">if</span> <span class="n">collection</span><span class="p">[</span><span class="n">partition_right</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">pivot_element</span><span class="p">:</span>
		<span class="k">break</span>

	<span class="k">if</span> <span class="n">partition_left</span> <span class="o">&gt;=</span> <span class="n">partition_right</span><span class="p">:</span>
	    <span class="k">break</span>

	<span class="n">collection</span><span class="p">[</span><span class="n">partition_left</span><span class="p">],</span> <span class="n">collection</span><span class="p">[</span><span class="n">partition_right</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
	    <span class="n">collection</span><span class="p">[</span><span class="n">partition_right</span><span class="p">],</span> <span class="n">collection</span><span class="p">[</span><span class="n">partition_left</span><span class="p">]</span>
	<span class="p">)</span>

    <span class="c1"># move the pivot element from the far left to its final place</span>
    <span class="n">collection</span><span class="p">[</span><span class="n">left</span><span class="p">],</span> <span class="n">collection</span><span class="p">[</span><span class="n">partition_right</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
	<span class="n">collection</span><span class="p">[</span><span class="n">partition_right</span><span class="p">],</span> <span class="n">collection</span><span class="p">[</span><span class="n">left</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">partition_right</span>
</pre></div>
</div>
</div>

<div id="outline-container-org286b707" class="outline-4">
<h4 id="org286b707">Some Checks</h4>
<div class="outline-text-4" id="text-org286b707">
<div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">levitins_partition</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">start</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span> <span class="p">,</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">levitins_partition</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">start</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">))</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">levitins_partition</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">start</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">levitins_partition</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">start</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">prefix</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">middle</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">suffix</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">101</span><span class="p">,</span> <span class="mi">201</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="p">[</span><span class="n">middle</span><span class="p">]</span> <span class="o">+</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">suffix</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">levitins_partition</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">middle</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="n">output</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">middle</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="n">item</span> <span class="o">&lt;</span> <span class="n">middle</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">test</span><span class="p">[:</span><span class="n">output</span><span class="p">]))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="n">item</span> <span class="o">&gt;</span> <span class="n">middle</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">test</span><span class="p">[</span><span class="n">output</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-org0db842e" class="outline-3">
<h3 id="org0db842e">A Levitin Tracker</h3>
<div class="outline-text-3" id="text-org0db842e">
<p>
This is the same function (hopefully) as <code>levitins_partition</code> but it collects the position of the elements in the list as things get swapped around so that we can plot it.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">levitin_tracker</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">,</span> 
		    <span class="n">left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
    <span class="sd">"""Partitions the collection around the last element</span>

<span class="sd">    Args:</span>
<span class="sd">     collection: the list to partition</span>
<span class="sd">     left: index of the first element in the sub-list to partition</span>
<span class="sd">     right: index of the last element in the sub-list to partition</span>

<span class="sd">    Returns:</span>
<span class="sd">     locations dict, lower_bounds, upper_bounds</span>
<span class="sd">    """</span>
    <span class="c1"># for the plotting</span>
    <span class="n">locations</span> <span class="o">=</span> <span class="p">{</span><span class="n">value</span><span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">collection</span><span class="p">)}</span>
    <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">right</span>
    <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">left</span>

    <span class="n">lower_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">lower_bound</span><span class="p">]</span>
    <span class="n">upper_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">upper_bound</span><span class="p">]</span>

    <span class="c1"># the algorithm</span>
    <span class="n">pivot_element</span> <span class="o">=</span> <span class="n">collection</span><span class="p">[</span><span class="n">left</span><span class="p">]</span>
    <span class="n">partition_left</span> <span class="o">=</span> <span class="n">left</span>
    <span class="n">partition_right</span> <span class="o">=</span> <span class="n">right</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
	<span class="k">while</span> <span class="n">partition_left</span> <span class="o">&lt;</span> <span class="n">right</span><span class="p">:</span>
	    <span class="n">partition_left</span> <span class="o">+=</span> <span class="mi">1</span>
	    <span class="k">if</span> <span class="n">collection</span><span class="p">[</span><span class="n">partition_left</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">pivot_element</span><span class="p">:</span>
		<span class="k">break</span>

	<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
	    <span class="n">partition_right</span> <span class="o">-=</span> <span class="mi">1</span>
	    <span class="k">if</span> <span class="n">collection</span><span class="p">[</span><span class="n">partition_right</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">pivot_element</span><span class="p">:</span>
		<span class="k">break</span>

	<span class="k">if</span> <span class="n">partition_left</span> <span class="o">&gt;=</span> <span class="n">partition_right</span><span class="p">:</span>
	    <span class="k">break</span>

	<span class="n">collection</span><span class="p">[</span><span class="n">partition_left</span><span class="p">],</span> <span class="n">collection</span><span class="p">[</span><span class="n">partition_right</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
	    <span class="n">collection</span><span class="p">[</span><span class="n">partition_right</span><span class="p">],</span> <span class="n">collection</span><span class="p">[</span><span class="n">partition_left</span><span class="p">]</span>
	<span class="p">)</span>

	<span class="c1"># update the plotting</span>
	<span class="n">upper_bounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">partition_right</span><span class="p">)</span>
	<span class="n">lower_bounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">partition_left</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">collection</span><span class="p">):</span>
	    <span class="n">locations</span><span class="p">[</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

    <span class="n">collection</span><span class="p">[</span><span class="n">left</span><span class="p">],</span> <span class="n">collection</span><span class="p">[</span><span class="n">partition_right</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
	<span class="n">collection</span><span class="p">[</span><span class="n">partition_right</span><span class="p">],</span> <span class="n">collection</span><span class="p">[</span><span class="n">left</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># update the plotting</span>
    <span class="n">upper_bounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">partition_right</span><span class="p">)</span>
    <span class="n">lower_bounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">partition_left</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">collection</span><span class="p">):</span>
	<span class="n">locations</span><span class="p">[</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">locations</span><span class="p">,</span> <span class="n">lower_bounds</span><span class="p">,</span> <span class="n">upper_bounds</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">levitin_track_plotter</span><span class="p">(</span><span class="n">locations</span><span class="p">,</span> <span class="n">lower_bounds</span><span class="p">,</span> <span class="n">upper_bounds</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span>
    <span class="n">re_indexed</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"Step"</span><span class="p">})</span>

    <span class="n">melted</span> <span class="o">=</span> <span class="n">re_indexed</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Step"</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">"Element"</span><span class="p">,</span>
			     <span class="n">value_name</span><span class="o">=</span><span class="s2">"Location"</span><span class="p">)</span>

    <span class="n">lower_frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"Lower Bound"</span><span class="p">:</span> <span class="n">lower_bounds</span><span class="p">})</span>
    <span class="n">re_lowered</span> <span class="o">=</span> <span class="n">lower_frame</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"Step"</span><span class="p">})</span>
    <span class="n">low_melted</span> <span class="o">=</span> <span class="n">re_lowered</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Step"</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">"Element"</span><span class="p">,</span>
				 <span class="n">value_name</span><span class="o">=</span><span class="s2">"Location"</span><span class="p">)</span>

    <span class="n">upper_frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"Lower Bound"</span><span class="p">:</span> <span class="n">upper_bounds</span><span class="p">})</span>
    <span class="n">re_uppered</span> <span class="o">=</span> <span class="n">upper_frame</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"Step"</span><span class="p">})</span>
    <span class="n">up_melted</span> <span class="o">=</span> <span class="n">re_uppered</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Step"</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">"Element"</span><span class="p">,</span>
				<span class="n">value_name</span><span class="o">=</span><span class="s2">"Location"</span><span class="p">)</span>

    <span class="n">last_location</span> <span class="o">=</span> <span class="n">melted</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="n">elements</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
	<span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Step:Q"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">tickMinStep</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span>
	<span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Location:Q"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">tickMinStep</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
		   <span class="n">scale</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">last_location</span><span class="p">))),</span>
	<span class="n">color</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">"Element:O"</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
	<span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"Step"</span><span class="p">,</span> <span class="s2">"Element"</span><span class="p">,</span> <span class="s2">"Location"</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="n">lower</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">low_melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
	<span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Step:Q"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">tickMinStep</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span>
	<span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Location:Q"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">tickMinStep</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
		   <span class="n">scale</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">last_location</span><span class="p">))),</span>
	<span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"Step"</span><span class="p">,</span> <span class="s2">"Location"</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="n">upper</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">up_melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
	<span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Step:Q"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">tickMinStep</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span>
	<span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Location:Q"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">tickMinStep</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
		   <span class="n">scale</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">last_location</span><span class="p">))),</span>
	<span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"Step"</span><span class="p">,</span> <span class="s2">"Location"</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="n">chart</span> <span class="o">=</span> <span class="p">(</span><span class="n">elements</span> <span class="o">+</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">upper</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
	<span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">520</span>
    <span class="p">)</span>

    <span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
<div id="outline-container-org64e3b79" class="outline-4">
<h4 id="org64e3b79">A Backwards Case</h4>
<div class="outline-text-4" id="text-org64e3b79">
<div class="highlight"><pre><span></span><span class="n">middle</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">first_half</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">middle</span><span class="p">))</span>
<span class="n">second_half</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">middle</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">middle</span><span class="p">))</span>

<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">first_half</span><span class="p">)</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">second_half</span><span class="p">)</span>

<span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">middle</span><span class="p">]</span> <span class="o">+</span> <span class="n">second_half</span> <span class="o">+</span> <span class="n">first_half</span>

<span class="n">locations</span><span class="p">,</span> <span class="n">lower_bounds</span><span class="p">,</span> <span class="n">upper_bounds</span> <span class="o">=</span> <span class="n">levitin_tracker</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">levitin_track_plotter</span><span class="p">(</span><span class="n">locations</span><span class="p">,</span> <span class="n">lower_bounds</span><span class="p">,</span> <span class="n">upper_bounds</span><span class="p">,</span>
		      <span class="s2">"Levitin Worst Case Swaps"</span><span class="p">,</span> <span class="s2">"levitin-worst-plot"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/levitins-partition/levitin-worst-plot.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>
</div>
</div>


<div id="outline-container-org1f5af99" class="outline-4">
<h4 id="org1f5af99">A More Random Case</h4>
<div class="outline-text-4" id="text-org1f5af99">
<p>
Let's try something a little more random.
</p>

<div class="highlight"><pre><span></span><span class="n">middle</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">first_half</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">middle</span><span class="p">))</span>
<span class="n">second_half</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">middle</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">middle</span><span class="p">))</span>
<span class="n">items</span> <span class="o">=</span> <span class="n">first_half</span> <span class="o">+</span> <span class="n">second_half</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
<span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">middle</span><span class="p">)</span>

<span class="n">locations</span><span class="p">,</span> <span class="n">lower_bounds</span><span class="p">,</span> <span class="n">upper_bounds</span> <span class="o">=</span> <span class="n">levitin_tracker</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">levitin_track_plotter</span><span class="p">(</span><span class="n">locations</span><span class="p">,</span> <span class="n">lower_bounds</span><span class="p">,</span> <span class="n">upper_bounds</span><span class="p">,</span>
		      <span class="n">title</span><span class="o">=</span><span class="s2">"Randomized Input"</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">"levitin-randomized-input"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/levitins-partition/levitin-randomized-input.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>
</div>
</div>
</div>

<div id="outline-container-org33fbc47" class="outline-3">
<h3 id="org33fbc47">A Sketch Of The Implementation</h3>
<div class="outline-text-3" id="text-org33fbc47">
<p>
<img src="posts/levitins-partition/levitins-partition-cleaned.webp" alt="nil"></p>
</div>
</div>
</div>

<div id="outline-container-org0563ec8" class="outline-2">
<h2 id="org0563ec8">Sources</h2>
<div class="outline-text-2" id="text-org0563ec8">
<ul class="org-ul">
<li><a href="posts/itdaa/">Introduction to the Design &amp; Analysis of Algorithms (Levitin)</a></li>
<li><a href="https://en.wikipedia.org/wiki/Quicksort">Wikipedia on Quicksort</a></li>
</ul>
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("the-levitin-partition"));
});
</script>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/the-partition/" class="u-url">The Road To Partition</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/the-partition/" rel="bookmark">
            <time class="published dt-published" datetime="2022-02-21T17:46:07-08:00" itemprop="datePublished" title="2022-02-21 17:46">2022-02-21 17:46</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="outline-container-orgd52650d" class="outline-2">
<h2 id="orgd52650d">The Beginning</h2>
<div class="outline-text-2" id="text-orgd52650d">
<ul class="org-ul">
<li><a href="posts/levitins-partition/">Levitin's Partition</a></li>
<li><a href="posts/clrs-partition/">CLRS Partition</a></li>
<li><a href="posts/randomized-partition/">Randomized Partition</a></li>
<li><a href="posts/comparing-the-partition-swaps/">Comparing the Partition Swaps</a></li>
</ul>
</div>
</div>
<div id="outline-container-org2a34149" class="outline-2">
<h2 id="org2a34149">Sources</h2>
<div class="outline-text-2" id="text-org2a34149">
<ul class="org-ul">
<li><a href="posts/clrs/">Introduction To Algorithms (CLRS)</a></li>
<li><a href="posts/itdaa/">Introduction to the Design &amp; Analysis of Algorithms (Levitin)</a></li>
<li><a href="https://en.wikipedia.org/wiki/Quicksort">Wikipedia on Quicksort</a></li>
</ul>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/the-selection-problem/" class="u-url">The Selection Problem</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/the-selection-problem/" rel="bookmark">
            <time class="published dt-published" datetime="2022-02-20T12:23:40-08:00" itemprop="datePublished" title="2022-02-20 12:23">2022-02-20 12:23</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/the-selection-problem/#org352c1e8">What is the Selection Problem?</a></li>
<li><a href="posts/the-selection-problem/#org12c78b2">Selection Vs Sorting</a></li>
<li>
<a href="posts/the-selection-problem/#org793ff7f">Familiar Cases</a>
<ul>
<li><a href="posts/the-selection-problem/#org40e191d">Minimum and Maximum</a></li>
<li><a href="posts/the-selection-problem/#orgeb7cf89">The Median</a></li>
</ul>
</li>
<li><a href="posts/the-selection-problem/#org1aea24b">Sources</a></li>
</ul>
</div>
</div>
<div id="outline-container-org352c1e8" class="outline-2">
<h2 id="org352c1e8">What is the Selection Problem?</h2>
<div class="outline-text-2" id="text-org352c1e8">
<p>
The <i>Selection Problem</i> involves finding the <i>kth</i> smallest item in a collection of <i>n</i> items. This item is called an <b><b>Order Statistic</b></b>.
</p>
</div>
</div>
<div id="outline-container-org12c78b2" class="outline-2">
<h2 id="org12c78b2">Selection Vs Sorting</h2>
<div class="outline-text-2" id="text-org12c78b2">
<p>
If the collection is already sorted then you can just pull the order statistic out directly (assuming it's accessible by its index) and if it isn't you could sort it first and then retrieve the order statistic. Since Mergesort and Heapsort have a runtime of \(\Theta(n \log n)\) we know that this would be the runtime using this method, but since we are only choosing one item we don't need to sort the collection, so we can find the item with less computation, and thus selection is its own problem.
</p>
</div>
</div>
<div id="outline-container-org793ff7f" class="outline-2">
<h2 id="org793ff7f">Familiar Cases</h2>
<div class="outline-text-2" id="text-org793ff7f">
<p>
While you might search for any ranked item (the third item, say), there are three special cases that are common enough to have been given names.
</p>

<ul class="org-ul">
<li>the <i>Minimum</i>
</li>
<li>the <i>Maximum</i>
</li>
<li>the <i>Median</i>
</li>
</ul>
</div>

<div id="outline-container-org40e191d" class="outline-3">
<h3 id="org40e191d">Minimum and Maximum</h3>
<div class="outline-text-3" id="text-org40e191d">
<p>
The <i>Minimum</i> and <i>Maximum</i> are probably self-explanatory, but to be complete: the <i>Minimum</i> is the order statistic when \(k = 1\) and the <i>Maximum</i> is the order statistic when \(k=n\). As an example of the <i>Selection Problem</i> requiring fewer comparisons than the <i>Sorting Problem</i> we can look at finding the <i>Minimum</i> by traversing the array.
</p>

<pre id="minimum" style="display:hidden;">
\begin{algorithm}
\caption{Minimum}
\begin{algorithmic}
\INPUT An array of comparable items
\OUTPUT The smallest item
\PROCEDURE{Minimum}{$A$}
  \STATE minimum $\gets$ A[0]
  \FOR{$i \in \{ 1 \ldots A.length - 1\}$}
   \IF {minimum &gt; A[i]}
    \STATE minimum $\gets$ A[i]
   \ENDIF
  \ENDFOR
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>

<p>
Since we're traversing the collection once it will always have a runtime of \(\Theta(n)\). The <i>Maximum</i> can be found the same way but with the greater than sign in the if-statement.
</p>
</div>
</div>
<div id="outline-container-orgeb7cf89" class="outline-3">
<h3 id="orgeb7cf89">The Median</h3>
<div class="outline-text-3" id="text-orgeb7cf89">
<p>
While most people know what the median is (I once worked with an engineer who thought it was the middle item of the unsorted items, not the item whose value was in the middle, so it might not be true that <i>all</i> people know what it is) but since we're talking about Order Statistics and not <i>Statistics</i> like in <a href="https://en.wikipedia.org/wiki/How_to_Lie_with_Statistics">"How to Lie With Statistics"</a> we'll make it a little more confusing by using a similar but not exactly the same definition.
</p>

<p>
\[
k = \left \lceil \frac{n}{2} \right \rceil
\]
</p>

<p>
This definition comes from <a href="posts/itdaa/">Levitin</a>. In his description he defines the median as the value with half the remaining values less than it and half the remaining values above it, which suggests that he's defining the case where there are an odd number of items only.
</p>

<p>
<a href="posts/clrs/">CLRS</a> gives a two-part definition with the odd case:
</p>

<p>
\[
k = \frac{n + 1}{2}
\]
</p>

<p>
and the case where there are an even number of items broken up into two:
</p>

<p>
\[
\textbf{Lower Median} = \left \lfloor \frac{n + 1}{2} \right \rfloor \\
\textbf{Upper Median} = \left \lceil \frac{n + 1}{2} \right \rceil \\
\]
</p>

<p>
With their median being the <b><b>Lower Median</b></b>. Despite the differences if you run through some numbers you can see that they're basically the same (adding 1 and then taking the floor after dividing by 2 is the same as the ceiling of dividing by 2 without adding 1).
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ceiling</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="n">a</span><span class="o">//-</span><span class="n">b</span><span class="p">)</span>

<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"n=</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">: </span><span class="se">\t</span><span class="s2">Levitin: </span><span class="si">{</span><span class="n">ceiling</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="s2">Lower Median: </span><span class="si">{</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>

<pre class="example">
n=1: 	Levitin: 1	Lower Median: 1
n=2: 	Levitin: 1	Lower Median: 1
n=3: 	Levitin: 2	Lower Median: 2
n=4: 	Levitin: 2	Lower Median: 2
n=5: 	Levitin: 3	Lower Median: 3
n=6: 	Levitin: 3	Lower Median: 3
n=7: 	Levitin: 4	Lower Median: 4
n=8: 	Levitin: 4	Lower Median: 4
n=9: 	Levitin: 5	Lower Median: 5
</pre>


<p>
So we've defined the median but actually finding the median is a little more complicated than finding the minimum or maximum so I'll save that for later.
</p>
</div>
</div>
</div>

<div id="outline-container-org1aea24b" class="outline-2">
<h2 id="org1aea24b">Sources</h2>
<div class="outline-text-2" id="text-org1aea24b">
<ul class="org-ul">
<li><a href="posts/itdaa/">Introduction to the Design &amp; Analysis of Algorithms (Levitin)</a></li>
<li><a href="posts/clrs/">Introduction To Algorithms (CLRS)</a></li>
</ul>
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("minimum"));
});
</script>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/max-heap/" class="u-url">Heap!</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/max-heap/" rel="bookmark">
            <time class="published dt-published" datetime="2022-02-08T13:40:58-08:00" itemprop="datePublished" title="2022-02-08 13:40">2022-02-08 13:40</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li>
<a href="posts/max-heap/#orgea0cfae">Beginning</a>
<ul>
<li><a href="posts/max-heap/#orgaf7cf64">What's a Heap?</a></li>
<li>
<a href="posts/max-heap/#org25b538d">Some Functions</a>
<ul>
<li><a href="posts/max-heap/#org66e7e34">Some Requirements</a></li>
<li><a href="posts/max-heap/#org464a939">Heap Properties</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="posts/max-heap/#org6a5c4ac">The Max Heap</a>
<ul>
<li><a href="posts/max-heap/#org13a7845">The Imports</a></li>
<li>
<a href="posts/max-heap/#orgcdc3ae8">The Class</a>
<ul>
<li><a href="posts/max-heap/#org6c42307">Imports</a></li>
<li><a href="posts/max-heap/#org216f8e1">The Definition</a></li>
<li><a href="posts/max-heap/#orgf3d1721">From List</a></li>
<li><a href="posts/max-heap/#org1e80ca7">The Heap Size</a></li>
<li><a href="posts/max-heap/#org98d991c">Length</a></li>
<li><a href="posts/max-heap/#org2f7d5d1">Maximum</a></li>
<li><a href="posts/max-heap/#org90cf79a">Finding the Parent, Left-Child, and Right-Child of a Node</a></li>
<li><a href="posts/max-heap/#org35b2c10">Heapify A Sub Tree</a></li>
<li><a href="posts/max-heap/#org64fc361">The Call</a></li>
<li><a href="posts/max-heap/#org1ebc431">Increase a Key</a></li>
<li><a href="posts/max-heap/#org562523c">Insert a Value</a></li>
<li><a href="posts/max-heap/#orga75825f">Check the Heap Property</a></li>
<li><a href="posts/max-heap/#orgc61a327">Get and Set Item</a></li>
</ul>
</li>
<li><a href="posts/max-heap/#orgc96fbd3">The Tests</a></li>
</ul>
</li>
<li>
<a href="posts/max-heap/#org2c90df9">Heap Sort</a>
<ul>
<li><a href="posts/max-heap/#org1855604">Imports</a></li>
<li><a href="posts/max-heap/#orgbf88f15">The Heap Sort Class</a></li>
<li><a href="posts/max-heap/#org735e382">The Tests</a></li>
</ul>
</li>
<li>
<a href="posts/max-heap/#orgdc8df84">A Priority Queue</a>
<ul>
<li><a href="posts/max-heap/#orga535d4e">The Tests</a></li>
</ul>
</li>
<li><a href="posts/max-heap/#orgc297611">Plotting</a></li>
<li><a href="posts/max-heap/#org531fd44">End</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgea0cfae" class="outline-2">
<h2 id="orgea0cfae">Beginning</h2>
<div class="outline-text-2" id="text-orgea0cfae">
</div>
<div id="outline-container-orgaf7cf64" class="outline-3">
<h3 id="orgaf7cf64">What's a Heap?</h3>
<div class="outline-text-3" id="text-orgaf7cf64">
<p>
This is a post that looks at <a href="https://en.wikipedia.org/wiki/Heap_(data_structure)">Heaps</a>. According to <a href="posts/clrs/">Introduction To Algorithms (CLRS)</a>, a heap is an array that can be thought of as a nearly complete binary tree which satisfies the <b><b>Heap Property</b></b>. There are actually two heap properties, one for a <b><b>Max Heap</b></b> and one for a <b><b>Min Heap</b></b>.
</p>

<ul class="org-ul">
<li>
<b><b>Max-Heap Property</b></b>: \(A[Parent(i)]) \ge A[i]\)</li>
<li>
<b><b>Min-Heap Property</b></b>: \(A[Parent(i)]) \le A[i]\)</li>
</ul>
<p>
Which means that for any node in a MaxHeap, its value is greater than or equal to that of any of its children, and for any node in a MinHeap, the node's value is less than or equal to its children.
</p>

<p>
The heap has (at least) two attributes.
</p>

<ul class="org-ul">
<li>
<i>A.length</i>: the number of elements in the array</li>
<li>
<i>A.heap-size</i>: the number of elements in the heap (not all elements in the array need to be in the heap)</li>
</ul>
<p>
The first element in the heap is the root (for the Max-Heap it is the largest element, for the Min-Heap it is the smallest).
</p>
</div>
</div>

<div id="outline-container-org25b538d" class="outline-3">
<h3 id="org25b538d">Some Functions</h3>
<div class="outline-text-3" id="text-org25b538d">
<p>
For any Node in the Heap located at <i>i</i>:
</p>

<pre id="parent" style="display:hidden;">
\begin{algorithm}
\caption{Parent}
\begin{algorithmic}
\INPUT The index of a Child Node
\OUTPUT The index of the Child's Parent
\PROCEDURE{Parent}{$i$}
 \RETURN {\(\left \lfloor \frac{i}{2} \right \rfloor\)}
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>

<pre id="left" style="display:hidden;">
\begin{algorithm}
\caption{Left}
\begin{algorithmic}
\INPUT The index of a Parent Node
\OUTPUT The index of the Parent's left child node
\PROCEDURE{Left}{$i$}
 \RETURN 2i
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>

<pre id="right" style="display:hidden;">
\begin{algorithm}
\caption{Right}
\begin{algorithmic}
\INPUT The index of a Parent Node
\OUTPUT The index of the Parent's right child node
\PROCEDURE{Right}{$i$}
 \RETURN 2i + 1
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>

<p>
These Functions show the relationship between the location of a node and its children in the array that makes up the heap.
</p>
</div>

<div id="outline-container-org66e7e34" class="outline-4">
<h4 id="org66e7e34">Some Requirements</h4>
<div class="outline-text-4" id="text-org66e7e34">
<p>
There are also two requirements:
</p>

<ul class="org-ul">
<li>
<b><b>Shape Requirement</b></b>: All levels but the last have to be complete (only the rightmost leaves can be incomplete)</li>
<li>
<b><b>Dominance Requirement</b></b>: Every node is greater than or equal to its children (in the Max-Heap, less than or equal for the Min-Heap)</li>
</ul>
<p>
That Dominance Requirement is also covered by the Heap Property.
</p>
</div>
</div>
<div id="outline-container-org464a939" class="outline-4">
<h4 id="org464a939">Heap Properties</h4>
<div class="outline-text-4" id="text-org464a939">
<p>
These are from <a href="posts/itdaa/">Introduction to the Design &amp; Analysis of Algorithms (Levitin)</a>.
</p>

<ol class="org-ol">
<li>There exists exactly one essentially complete binary tree with <i>n</i> nodes. It's a binary tree so its height is \(\lfloor \log_2 n\rfloor\).</li>
<li>The root of a (Max) Heap always has the largest element.</li>
<li>A node of a heap with all its descendants is also a heap.</li>
<li>A heap implemented as an array with the heap's elements stored at \(1 \ldots n\) can be constructed using:
<ul class="org-ul">
<li>the parental node keys will be the first \(\lfloor \frac{n}{2} \rfloor\) elements while the leaf nodes will be in the last \(\lceil \frac{n}{2} \rceil\) positions</li>
<li>The childern of a parent node at position <i>i</i> will be in positions <i>2i</i> and <i>2i + 1</i>.</li>
<li>The parent of a child node at position <i>i</i> will be in position \(\lfloor \frac{i}{2}\rfloor\).</li>
</ul>
</li>
</ol>
<p>
Property four is what was defined in the functions up above. Levitin also gives a slightly different variation on stating the heap property.
</p>

<p>
\[
H[i] \ge \max{H[2i], H[2i + 1]} \textrm{ for } i= 1, \ldots, \lfloor \frac{n}{2} \rfloor.
\]
</p>

<p>
This is sort of an inversion of the Max-Heap Property stated above. While the Max-Heap Property was given as every node is less than or equal to its parent, this says that every parent is greater than or equal to its children.
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org6a5c4ac" class="outline-2">
<h2 id="org6a5c4ac">The Max Heap</h2>
<div class="outline-text-2" id="text-org6a5c4ac">
</div>
<div id="outline-container-org13a7845" class="outline-3">
<h3 id="org13a7845">The Imports</h3>
<div class="outline-text-3" id="text-org13a7845">
<div class="highlight"><pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">MutableSequence</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Generator</span>

<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">contain_exactly</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span><span class="p">,</span> <span class="n">raise_error</span>

<span class="c1"># software under test</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.heap</span> <span class="kn">import</span> <span class="n">MaxHeap</span>

<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">EmbedHoloviews</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"max-heap"</span>
<span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"files/posts/</span><span class="si">{</span><span class="n">SLUG</span><span class="si">}</span><span class="s2">/"</span>
<span class="n">Embed</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">EmbedHoloviews</span><span class="p">,</span> <span class="n">folder_path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div id="outline-container-orgcdc3ae8" class="outline-3">
<h3 id="orgcdc3ae8">The Class</h3>
<div class="outline-text-3" id="text-orgcdc3ae8">
</div>
<div id="outline-container-org6c42307" class="outline-4">
<h4 id="org6c42307">Imports</h4>
<div class="outline-text-4" id="text-org6c42307">
<div class="highlight"><pre><span></span><span class="c1"># pypi</span>
<span class="c1"># https://www.attrs.org/en/stable/index.html</span>
<span class="kn">from</span> <span class="nn">attrs</span> <span class="kn">import</span> <span class="n">define</span>
</pre></div>
</div>
</div>

<div id="outline-container-org216f8e1" class="outline-4">
<h4 id="org216f8e1">The Definition</h4>
<div class="outline-text-4" id="text-org216f8e1">
<p>
Besides declaring the class definition, the MaxHeap will hold some constants to hopefully make the code easier to read.
</p>

<div class="highlight"><pre><span></span><span class="nd">@define</span>
<span class="k">class</span> <span class="nc">MaxHeap</span><span class="p">:</span>
    <span class="sd">"""Build and maintain a max-heap</span>

<span class="sd">    If you pass in the heap as a list pre-pend it with Infinity</span>

<span class="sd">    Otherwise use ~heap = MaxHeap.from_list(elements)~ to build it</span>
<span class="sd">    """</span>
    <span class="n">INFINITY</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">"inf"</span><span class="p">)</span>
    <span class="n">NEGATIVE_INFINITY</span> <span class="o">=</span> <span class="o">-</span><span class="n">INFINITY</span>
    <span class="n">ROOT_NODE</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">heap</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="n">INFINITY</span><span class="p">]</span>
    <span class="n">_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgf3d1721" class="outline-4">
<h4 id="orgf3d1721">From List</h4>
<div class="outline-text-4" id="text-orgf3d1721">
<p>
This is a class method to create the list for the heap. The calculations for the locations in the array of parent and child nodes is easier if we have a 1-based list so I'll pad the list being passed in. Additionally, I'll set the first value to \(\infty\) so that the Heap Property will pass for the root node without needing any special consideration for what its parent is.
</p>

<div class="highlight"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_list</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">heap</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
    <span class="sd">"""Builds a max-heap instance from the starter list</span>

<span class="sd">    Args:</span>
<span class="sd">     heap: list of elements to dump on the heap</span>

<span class="sd">    Returns:</span>
<span class="sd">     MaxHeap instance with the heap list added</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">heap</span> <span class="o">=</span> <span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">]</span> <span class="o">+</span> <span class="n">heap</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-org1e80ca7" class="outline-4">
<h4 id="org1e80ca7">The Heap Size</h4>
<div class="outline-text-4" id="text-org1e80ca7">
<p>
Since we padded the list holding the heap the length of the list will never be the same as the number of nodes in the heap. Additionally we'll sometimes manipulate things so things that were in the heap are later excluded but still in the list so the <code>size</code> property will help us to keep track of how big we think our heap is.
</p>

<div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""The size of the max heap"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span>

<span class="nd">@size</span><span class="o">.</span><span class="n">setter</span>
<span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_size</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""Set the size of the max heap</span>

<span class="sd">    Args:</span>
<span class="sd">     new_size: how much of the list is in the heap</span>

<span class="sd">    Raises:</span>
<span class="sd">     AssertionError if the size is out of bounds for the list</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_size</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="n">new_size</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>

<div id="outline-container-org98d991c" class="outline-4">
<h4 id="org98d991c">Length</h4>
<div class="outline-text-4" id="text-org98d991c">
<p>
This is the length of the array, not necessarily of the heap. This one's a little tricky, since the padding throws it off by one it would seem that it should be lowered by one, but if you use it to figure out the last index that will mess it up a little. Since we already have the size for the number of nodes I'll just pass the length of the list on and see what happens.
</p>

<p>
I was debating whether to use <code>__len__</code> but I decided that this is really an internal measure and <code>size</code> is meant to be the attribute to use. I'm mostly keeping this around so that it matches the CLRS attributes.
</p>

<div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">length</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""The size of the array for the heap</span>

<span class="sd">    Warning:</span>
<span class="sd">     This includes the padding at the beginning of the list</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div id="outline-container-org2f7d5d1" class="outline-4">
<h4 id="org2f7d5d1">Maximum</h4>
<div class="outline-text-4" id="text-org2f7d5d1">
<p>
Since this is a max-heap the largest element is in the root, this just makes getting it more explicit.
</p>

<div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">maximum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""The value in the root node"""</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ROOT_NODE</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div id="outline-container-org90cf79a" class="outline-4">
<h4 id="org90cf79a">Finding the Parent, Left-Child, and Right-Child of a Node</h4>
<div class="outline-text-4" id="text-org90cf79a">
<p>
These are the implementations of the functions at the start of the post.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""Find the parent of a node</span>

<span class="sd">    Args:</span>
<span class="sd">     node: the index of the node to check</span>

<span class="sd">    Returns:</span>
<span class="sd">     the index of the parent of the node</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">node</span><span class="o">//</span><span class="mi">2</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">left_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""Find the left child of a parent</span>

<span class="sd">    Args:</span>
<span class="sd">     parent: the index of the parent node</span>

<span class="sd">    Returns:</span>
<span class="sd">     index of the left child of the parent</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">parent</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">right_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""Find the right child of a parent</span>

<span class="sd">    Args:</span>
<span class="sd">     parent: the index of the parent node</span>

<span class="sd">    Returns:</span>
<span class="sd">     index of the right child of the parent</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">parent</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
</div>

<div id="outline-container-org35b2c10" class="outline-4">
<h4 id="org35b2c10">Heapify A Sub Tree</h4>
<div class="outline-text-4" id="text-org35b2c10">
<p>
CLRS just calls this MaxHeapify. But then the bottoms-up heapification of the tree seemed more like it should be called heapify so I called it <code>heapify_subtree</code> to note that it starts at a specific node which might not be the root.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">heapify_subtree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">"""Heapify the tree rooted at the node</span>

<span class="sd">    Args:</span>
<span class="sd">     node: index of the node to compare to its descendants</span>
<span class="sd">    """</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_child</span><span class="p">(</span><span class="n">node</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_child</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">largest</span> <span class="o">=</span> <span class="n">node</span>

    <span class="k">if</span> <span class="n">left</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">left</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">largest</span><span class="p">]:</span>
	<span class="c1"># the left child was larger than the current parent node</span>
	<span class="n">largest</span> <span class="o">=</span> <span class="n">left</span>

    <span class="k">if</span> <span class="n">right</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">right</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">largest</span><span class="p">]:</span>
	<span class="c1"># the right child is larger than the left and the current parent</span>
	<span class="n">largest</span> <span class="o">=</span> <span class="n">right</span>

    <span class="k">if</span> <span class="n">largest</span> <span class="o">!=</span> <span class="n">node</span><span class="p">:</span>
	<span class="c1"># the current parent is out of place, swap it with the larger child</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">largest</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">largest</span><span class="p">],</span>
					       <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">])</span>

	<span class="c1"># after the swap the item at "largest" is the value from the </span>
	<span class="c1"># "node" we started with so try it again with this new location</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">heapify_subtree</span><span class="p">(</span><span class="n">largest</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div id="outline-container-org64fc361" class="outline-4">
<h4 id="org64fc361">The Call</h4>
<div class="outline-text-4" id="text-org64fc361">
<p>
This makes the MaxHeap callable and heapifies the entire heap using a bottoms-up construction.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Heapifies the heap</span>

<span class="sd">    Raises:</span>
<span class="sd">     AssertionError: something bad happened and the Heap Property failed</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">heapify_subtree</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">check_rep</span><span class="p">()</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div id="outline-container-org1ebc431" class="outline-4">
<h4 id="org1ebc431">Increase a Key</h4>
<div class="outline-text-4" id="text-org1ebc431">
<p>
When we change the value of a node, if the value is higher than the previous value it might be in the wrong place in the heap (e.g. it might be bigger than its parent) so we need to traverse upward, swapping it with parents smaller than it, until we find where it should go. CLRS made it a requirement that the new value is larger than the old one, which makes sense in light of the name <code>IncreaseKey</code>, but it seems to me that you could just call it <code>ChangeKey</code> and use a conditional instead of raise an exception, but I'll stick with the error for now.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">increase_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="sd">"""Increase the node's value</span>

<span class="sd">    Args:</span>
<span class="sd">     node: index of node in heap to change</span>
<span class="sd">     key: new value for the node</span>

<span class="sd">    Raises:</span>
<span class="sd">     AssertionError if new value isn't larger than the previous value</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="n">key</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">],</span> <span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> not greater than previous value </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="o">.</span><span class="n">node</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">node</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROOT_NODE</span> <span class="ow">and</span>
	   <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="n">node</span><span class="p">)]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">]):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="n">node</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="n">node</span><span class="p">)],</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">])</span>
	<span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div id="outline-container-org562523c" class="outline-4">
<h4 id="org562523c">Insert a Value</h4>
<div class="outline-text-4" id="text-org562523c">
<p>
CLRS describes <code>insert</code> and <code>increase_key</code> as part of updating a priority queue, but Levitin's description of <code>top-down heap construction</code> seems to use them as an alternative way to create the heap. He describes this method of construction (top-down) as starting with an empty heap and repeatedly inserting elements from the original array until you have a heap.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="sd">"""Insert the key into the heap</span>

<span class="sd">    Args:</span>
<span class="sd">     key: orderable item to insert into the heap</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NEGATIVE_INFINITY</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">increase_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>

<div id="outline-container-orga75825f" class="outline-4">
<h4 id="orga75825f">Check the Heap Property</h4>
<div class="outline-text-4" id="text-orga75825f">
<p>
This checks that the Heap Property holds for all the nodes.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_rep</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">"""Checks the heap property</span>

<span class="sd">    Raises:</span>
<span class="sd">     AssertionError: the heap property has been violated</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
	<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="n">node</span><span class="p">)]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">],</span> <span class="p">(</span>
	    <span class="sa">f</span><span class="s2">"Parent node </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="n">node</span><span class="p">)]</span><span class="si">}</span><span class="s2"> "</span>
	    <span class="sa">f</span><span class="s2">"not &gt;= </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div id="outline-container-orgc61a327" class="outline-4">
<h4 id="orgc61a327">Get and Set Item</h4>
<div class="outline-text-4" id="text-orgc61a327">
<p>
I threw these in because I kept forgetting that the heap is an attribute of the MaxHeap, but it's only for convenience.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">"""Gets an item from the heap</span>

<span class="sd">    Args: </span>
<span class="sd">     node: index of the heap to get the value</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>

<span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">"""Sets the value at the node in the heap</span>

<span class="sd">    Args:</span>
<span class="sd">     node: index of the heap to set the value</span>
<span class="sd">     value: what to set the location in the heap to</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
</div>
<div id="outline-container-orgc96fbd3" class="outline-3">
<h3 id="orgc96fbd3">The Tests</h3>
<div class="outline-text-3" id="text-orgc96fbd3">
<div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">max_heap</span> <span class="o">=</span> <span class="n">MaxHeap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">heap</span><span class="o">=</span><span class="n">start</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">max_heap</span><span class="o">.</span><span class="n">heap</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">([</span><span class="n">max_heap</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">]</span> <span class="o">+</span> <span class="n">start</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">max_heap</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">max_heap</span><span class="o">.</span><span class="n">length</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">max_heap</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">max_heap</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">max_heap</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">max_heap</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">max_heap</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">failure</span><span class="p">():</span> <span class="n">max_heap</span><span class="o">.</span><span class="n">check_rep</span><span class="p">()</span>

<span class="n">expect</span><span class="p">(</span><span class="n">failure</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">raise_error</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">max_heap</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">heap</span> <span class="o">=</span> <span class="n">MaxHeap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span>

<span class="n">heap</span><span class="o">.</span><span class="n">heapify_subtree</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">14</span><span class="p">))</span>

<span class="n">heap</span><span class="o">.</span><span class="n">heapify_subtree</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">14</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">]</span>
<span class="n">heap</span> <span class="o">=</span> <span class="n">MaxHeap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
<span class="n">heap</span><span class="p">()</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">40</span><span class="p">))</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span>
<span class="n">heap</span> <span class="o">=</span> <span class="n">MaxHeap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

<span class="n">heap</span><span class="p">()</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div id="outline-container-org2c90df9" class="outline-2">
<h2 id="org2c90df9">Heap Sort</h2>
<div class="outline-text-2" id="text-org2c90df9">
<div class="highlight"><pre><span></span><span class="o">&lt;&lt;</span><span class="n">heapsort</span><span class="o">-</span><span class="n">imports</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">heap</span><span class="o">-</span><span class="n">sort</span><span class="o">&gt;&gt;</span>
</pre></div>
</div>

<div id="outline-container-org1855604" class="outline-3">
<h3 id="org1855604">Imports</h3>
<div class="outline-text-3" id="text-org1855604">
<div class="highlight"><pre><span></span><span class="c1"># pypi</span>
<span class="c1"># https://www.attrs.org/en/stable/index.html</span>
<span class="kn">from</span> <span class="nn">attrs</span> <span class="kn">import</span> <span class="n">define</span>

<span class="c1"># this project</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.heap</span> <span class="kn">import</span> <span class="n">MaxHeap</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgbf88f15" class="outline-3">
<h3 id="orgbf88f15">The Heap Sort Class</h3>
<div class="outline-text-3" id="text-orgbf88f15">
<p>
The HeapSort uses the fact that a Max Heap always has the largest element at the root and repeatedly puts the root at the end of the list then shrinks the heap so it doesn't include the value that was moved over.
</p>

<div class="highlight"><pre><span></span><span class="nd">@define</span>
<span class="k">class</span> <span class="nc">HeapSort</span><span class="p">:</span>
    <span class="sd">"""Sort using a heap</span>

<span class="sd">    Args:</span>
<span class="sd">     items: collection of items for the sort</span>
<span class="sd">    """</span>
    <span class="n">items</span><span class="p">:</span> <span class="nb">list</span>
    <span class="n">_heap</span><span class="p">:</span> <span class="n">MaxHeap</span><span class="o">=</span><span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">heap</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MaxHeap</span><span class="p">:</span>
	<span class="sd">"""The heap of items"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_heap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_heap</span> <span class="o">=</span> <span class="n">MaxHeap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_heap</span><span class="p">()</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_heap</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">without_root</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
	<span class="sd">"""The items without the root """</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="o">.</span><span class="n">ROOT_NODE</span><span class="p">:]</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""sorts the items"""</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">()</span>
	<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="o">.</span><span class="n">ROOT_NODE</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">],</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="o">.</span><span class="n">size</span> <span class="o">-=</span> <span class="mi">1</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">()</span>
	<span class="k">return</span>
</pre></div>
</div>
</div>

<div id="outline-container-org735e382" class="outline-3">
<h3 id="org735e382">The Tests</h3>
<div class="outline-text-3" id="text-org735e382">
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bowling.sort.heap</span> <span class="kn">import</span> <span class="n">HeapSort</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">items</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
<span class="n">sorter</span> <span class="o">=</span> <span class="n">HeapSort</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>

<span class="n">sorter</span><span class="p">()</span>

<span class="n">items</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="n">expect</span><span class="p">(</span><span class="n">sorter</span><span class="o">.</span><span class="n">without_root</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">items</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div id="outline-container-orgdc8df84" class="outline-2">
<h2 id="orgdc8df84">A Priority Queue</h2>
<div class="outline-text-2" id="text-orgdc8df84">
<p>
Although some books mention that MinHeaps are used for priority queues, CLRS shows a MaxHeap version. This involves adding a couple of methods to the MaxHeap so there's no special class.
</p>
</div>

<div id="outline-container-orga535d4e" class="outline-3">
<h3 id="orga535d4e">The Tests</h3>
<div class="outline-text-3" id="text-orga535d4e">
<div class="highlight"><pre><span></span><span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">heap</span> <span class="o">=</span> <span class="n">MaxHeap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
<span class="n">heap</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">failure</span><span class="p">():</span> <span class="n">heap</span><span class="o">.</span><span class="n">increase_key</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">failure</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">raise_error</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">))</span>

<span class="n">heap</span><span class="o">.</span><span class="n">increase_key</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>

<span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span>
<span class="n">heap</span> <span class="o">=</span> <span class="n">MaxHeap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
<span class="n">heap</span><span class="p">()</span>
<span class="n">heap</span><span class="o">.</span><span class="n">increase_key</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="p">[</span><span class="n">heap</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="mi">1</span><span class="p">)])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">15</span><span class="p">))</span>

<span class="n">heap</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div id="outline-container-orgc297611" class="outline-2">
<h2 id="orgc297611">Plotting</h2>
<div class="outline-text-2" id="text-orgc297611">
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">networkx</span> <span class="kn">import</span> <span class="n">Graph</span>
<span class="kn">import</span> <span class="nn">holoviews</span>

<span class="n">graph</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">heap</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">heap</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">heap</span><span class="o">.</span><span class="n">length</span><span class="p">:</span>
	<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">],</span> <span class="n">heap</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">heap</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="n">node</span><span class="p">)])</span>
    <span class="k">if</span> <span class="n">heap</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">heap</span><span class="o">.</span><span class="n">length</span><span class="p">:</span>
	<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">],</span> <span class="n">heap</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">heap</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">node</span><span class="p">)])</span>
<span class="n">positions</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">drawing</span><span class="o">.</span><span class="n">nx_pydot</span><span class="o">.</span><span class="n">graphviz_layout</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">prog</span><span class="o">=</span><span class="s2">"dot"</span><span class="p">)</span>

<span class="n">plot</span> <span class="o">=</span> <span class="n">holoviews</span><span class="o">.</span><span class="n">Graph</span><span class="o">.</span><span class="n">from_networkx</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">positions</span><span class="p">)</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"heap-plot"</span><span class="p">)()</span>
</pre></div>

<object type="text/html" data="posts/max-heap/heap-plot.html" style="width:100%" height="800">
  <p>Figure Missing</p>
</object>
</div>
</div>

<div id="outline-container-org531fd44" class="outline-2">
<h2 id="org531fd44">End</h2>
<div class="outline-text-2" id="text-org531fd44">
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("parent"));
});
</script><script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("left"));
});
</script><script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("right"));
});
</script>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/quicksort/" class="u-url">Quicksort</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/quicksort/" rel="bookmark">
            <time class="published dt-published" datetime="2022-02-02T16:26:27-08:00" itemprop="datePublished" title="2022-02-02 16:26">2022-02-02 16:26</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/quicksort/#org570410e">The Algorithm</a></li>
<li>
<a href="posts/quicksort/#orgfdbf544">Implementing It</a>
<ul>
<li>
<ul>
<li><a href="posts/quicksort/#org6b855d1">Some Imports</a></li>
</ul>
</li>
<li><a href="posts/quicksort/#orgb5b826b">Some Setup</a></li>
<li><a href="posts/quicksort/#orge466843">The Partition</a></li>
<li>
<a href="posts/quicksort/#org6c9f3b3">Some Checks</a>
<ul>
<li><a href="posts/quicksort/#org5110bc3">The First Example</a></li>
<li><a href="posts/quicksort/#org20a1ac1">The Pivot Is the Biggest Element</a></li>
</ul>
</li>
<li>
<a href="posts/quicksort/#orgde082c6">The QuickSort</a>
<ul>
<li><a href="posts/quicksort/#orgc94fe2f">Check It Out</a></li>
</ul>
</li>
<li>
<a href="posts/quicksort/#org6911f73">Plotting The Quicksort Runtimes</a>
<ul>
<li><a href="posts/quicksort/#orgde6097c">With Random Input</a></li>
<li><a href="posts/quicksort/#org6ee8b93">Worst-Case Input</a></li>
</ul>
</li>
<li><a href="posts/quicksort/#orgd27592f">Looking At the Sort In Progress</a></li>
</ul>
</li>
<li><a href="posts/quicksort/#org652b565">End</a></li>
</ul>
</div>
</div>
<div id="outline-container-org570410e" class="outline-2">
<h2 id="org570410e">The Algorithm</h2>
<div class="outline-text-2" id="text-org570410e">
<p>
I covered the <code>Partition</code> function in <a href="posts/the-partition/">The Road To Partition</a> and now I'll use it to implement a quicksort. This is the <a href="posts/clrs/">CLRS</a> version.
</p>

<pre id="the-quicksort" style="display:hidden;">
\begin{algorithm}
\caption{QuickSort}
\begin{algorithmic}
\INPUT An array and left and right locations defining a subarray
\OUTPUT The subarray is sorted

\PROCEDURE{QuickSort}{A, left, right}

\IF {left &lt; right} 

\STATE pivot $\gets$ \textsc{Partition}(A, left, right)
\STATE \textsc{QuickSort}(A, left, pivot - 1)
\STATE \textsc{QuickSort}(A, pivot + 1, right)

\ENDIF
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>
</div>
</div>
<div id="outline-container-orgfdbf544" class="outline-2">
<h2 id="orgfdbf544">Implementing It</h2>
<div class="outline-text-2" id="text-orgfdbf544">
</div>
<div id="outline-container-org6b855d1" class="outline-4">
<h4 id="org6b855d1">Some Imports</h4>
<div class="outline-text-4" id="text-org6b855d1">
<div class="highlight"><pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">MutableSequence</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">log2</span>

<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">contain_exactly</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>

<span class="kn">import</span> <span class="nn">altair</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># this project</span>
<span class="kn">from</span> <span class="nn">bowling.sort.insertion</span> <span class="kn">import</span> <span class="n">insertion_sort</span>
<span class="kn">from</span> <span class="nn">bowling.sort.merge</span> <span class="kn">import</span> <span class="n">mergesort</span>

<span class="c1"># other monkey stuff</span>
<span class="kn">from</span> <span class="nn">graeae.visualization.altair_helpers</span> <span class="kn">import</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">save_chart</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">Timer</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgb5b826b" class="outline-3">
<h3 id="orgb5b826b">Some Setup</h3>
<div class="outline-text-3" id="text-orgb5b826b">
<div class="highlight"><pre><span></span><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">PartitionOutput</span><span class="p">:</span>
    <span class="sd">"""Keeps the output for the partition funcion"""</span>
    <span class="n">pivot</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">count</span><span class="p">:</span> <span class="nb">int</span>

<span class="n">TIMER</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>

<span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"quicksort"</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="n">output_path</span><span class="p">(</span><span class="n">SLUG</span><span class="p">)</span>
<span class="n">save_it</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">save_chart</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div id="outline-container-orge466843" class="outline-3">
<h3 id="orge466843">The Partition</h3>
<div class="outline-text-3" id="text-orge466843">
<p>
Even though I implemented it in that other post I didn't make it so it returns counts so we can estimate the runtime so I'll do that here.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">partition</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">,</span>
	      <span class="n">left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PartitionOutput</span><span class="p">:</span>
    <span class="sd">"""Partitions the collection around the last element</span>

<span class="sd">    Args:</span>
<span class="sd">     collection: the list to partition</span>
<span class="sd">     left: index of the first element in the sub-list to partition</span>
<span class="sd">     right: index of the last element in the sub-list to partition</span>

<span class="sd">    Returns:</span>
<span class="sd">     PartitionOutput(pivot, count)</span>
<span class="sd">    """</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">pivot_element</span> <span class="o">=</span> <span class="n">collection</span><span class="p">[</span><span class="n">right</span><span class="p">]</span>
    <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">left</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">upper_bound</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
	<span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="k">if</span> <span class="n">collection</span><span class="p">[</span><span class="n">upper_bound</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">pivot_element</span><span class="p">:</span>
	    <span class="n">lower_bound</span> <span class="o">+=</span> <span class="mi">1</span>
	    <span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="n">lower_bound</span><span class="p">],</span>
	     <span class="n">collection</span><span class="p">[</span><span class="n">upper_bound</span><span class="p">])</span> <span class="o">=</span> <span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="n">upper_bound</span><span class="p">],</span>
					 <span class="n">collection</span><span class="p">[</span><span class="n">lower_bound</span><span class="p">])</span>
    <span class="n">pivot</span> <span class="o">=</span> <span class="n">lower_bound</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="n">pivot</span><span class="p">],</span>
     <span class="n">collection</span><span class="p">[</span><span class="n">right</span><span class="p">])</span> <span class="o">=</span> <span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="n">right</span><span class="p">],</span>
			   <span class="n">collection</span><span class="p">[</span><span class="n">pivot</span><span class="p">])</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">PartitionOutput</span><span class="p">(</span><span class="n">pivot</span><span class="o">=</span><span class="n">pivot</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-org6c9f3b3" class="outline-3">
<h3 id="org6c9f3b3">Some Checks</h3>
<div class="outline-text-3" id="text-org6c9f3b3">
</div>
<div id="outline-container-org5110bc3" class="outline-4">
<h4 id="org5110bc3">The First Example</h4>
<div class="outline-text-4" id="text-org5110bc3">
<div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
<span class="n">first_expected_pivot</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">partition</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">pivot</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">first_expected_pivot</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">test</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)))</span>
</pre></div>

<p>
And to make sure the sub-list works.
</p>

<div class="highlight"><pre><span></span><span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">999</span><span class="p">,</span> <span class="mi">888</span><span class="p">,</span> <span class="mi">777</span><span class="p">]</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">left</span> <span class="o">+</span> <span class="n">start</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="o">+</span> <span class="n">right</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">partition</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

<span class="c1"># all we did was shift the sub-list to spots to the right</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">pivot</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">first_expected_pivot</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span>

<span class="c1"># only the sub-list should be partitioned</span>
<span class="n">expect</span><span class="p">(</span><span class="n">test</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">expected</span> <span class="o">+</span> <span class="n">right</span><span class="p">)))</span>

<span class="c1"># the count should match our sub-array</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">start</span><span class="p">)))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org20a1ac1" class="outline-4">
<h4 id="org20a1ac1">The Pivot Is the Biggest Element</h4>
<div class="outline-text-4" id="text-org20a1ac1">
<div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">partition</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="c1"># the pivot should be the last element</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">pivot</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>

<span class="c1"># nothing changes in the list</span>
<span class="n">expect</span><span class="p">(</span><span class="n">test</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">start</span><span class="p">))</span>

<span class="c1"># once again, count should match the size of the input</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div id="outline-container-orgde082c6" class="outline-3">
<h3 id="orgde082c6">The QuickSort</h3>
<div class="outline-text-3" id="text-orgde082c6">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">quicksort</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">,</span> <span class="n">left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""Recursive quicksort</span>

<span class="sd">    Args:</span>
<span class="sd">     collection: list to sort</span>
<span class="sd">     left: index of start of sub-list in collection to sort</span>
<span class="sd">     right: index of end of sub-list in collection to sort</span>

<span class="sd">    Returns:</span>
<span class="sd">     count of comparisons</span>
<span class="sd">    """</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">left</span> <span class="o">&lt;</span> <span class="n">right</span><span class="p">:</span>
	<span class="n">output</span> <span class="o">=</span> <span class="n">partition</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>

	<span class="n">count</span> <span class="o">+=</span> <span class="n">output</span><span class="o">.</span><span class="n">count</span>
	<span class="n">count</span> <span class="o">+=</span> <span class="n">quicksort</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">pivot</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
	<span class="n">count</span> <span class="o">+=</span> <span class="n">quicksort</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">pivot</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">count</span>
</pre></div>
</div>
<div id="outline-container-orgc94fe2f" class="outline-4">
<h4 id="orgc94fe2f">Check It Out</h4>
<div class="outline-text-4" id="text-orgc94fe2f">
<div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">items</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
<span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>

<span class="n">count</span> <span class="o">=</span> <span class="n">quicksort</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"count: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Theoretical Average: </span><span class="si">{</span><span class="n">length</span> <span class="o">*</span> <span class="n">log2</span><span class="p">(</span><span class="n">length</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Theoretical Worst: </span><span class="si">{</span><span class="n">length</span><span class="o">**</span><span class="mi">2</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">items</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">start</span><span class="p">))</span>
</pre></div>

<pre class="example">
count: 37
Theoretical Average: 33.22
Theoretical Worst: 100
</pre>
</div>
</div>
</div>

<div id="outline-container-org6911f73" class="outline-3">
<h3 id="org6911f73">Plotting The Quicksort Runtimes</h3>
<div class="outline-text-3" id="text-org6911f73">
<div class="highlight"><pre><span></span><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">QuicksortOutput</span><span class="p">:</span>
    <span class="sd">"""Holds the output of the quicksort counts"""</span>
    <span class="n">comparisons</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">size</span><span class="p">:</span> <span class="nb">int</span>


<span class="k">def</span> <span class="nf">quicksorter</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuicksortOutput</span><span class="p">:</span>
    <span class="sd">"""runs the quicksort and outputs count and size of collection</span>

<span class="sd">    Args:</span>
<span class="sd">     collection: thing to sort</span>

<span class="sd">    Returns:</span>
<span class="sd">     QuicksortOutput(count, size)</span>
<span class="sd">    """</span>
    <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">quicksort</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">QuicksortOutput</span><span class="p">(</span><span class="n">comparisons</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
</pre></div>
</div>
<div id="outline-container-orgde6097c" class="outline-4">
<h4 id="orgde6097c">With Random Input</h4>
<div class="outline-text-4" id="text-orgde6097c">
<div class="highlight"><pre><span></span><span class="n">things_to_sort</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">))</span> <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">things</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">:</span>
    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">things</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">quick_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
    <span class="n">delayed</span><span class="p">(</span><span class="n">quicksorter</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">)</span>
</pre></div>

<pre class="example">
Started: 2022-02-05 00:57:12.120397
Ended: 2022-02-05 00:57:14.397235
Elapsed: 0:00:02.276838
</pre>


<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">merge_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
    <span class="n">delayed</span><span class="p">(</span><span class="n">mergesort</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">)</span>
</pre></div>

<pre class="example">
Started: 2022-02-05 00:58:40.087042
Ended: 2022-02-05 00:58:42.326204
Elapsed: 0:00:02.239162
</pre>


<p>
<b><b>Note to future self:</b></b> Pypy is much faster with the python inputs and much slower with numpy inputs.
</p>

<div class="highlight"><pre><span></span><span class="n">counts</span> <span class="o">=</span> <span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">comparisons</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">quick_output</span><span class="p">]</span>
<span class="n">sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">quick_output</span><span class="p">]</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"Size"</span><span class="p">:</span> <span class="n">sizes</span><span class="p">,</span> <span class="s2">"QuickSort"</span><span class="p">:</span> <span class="n">counts</span><span class="p">})</span>
<span class="n">frame</span><span class="p">[</span><span class="s2">"Merge Sort"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">output</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">merge_output</span><span class="p">]</span>

<span class="n">melted</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Size"</span><span class="p">],</span>
		    <span class="n">var_name</span><span class="o">=</span><span class="s2">"Sort Algorithm"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Size"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Sort Algorithm"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Size"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Comparisons"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="s2">"Sort Algorithm"</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"QuickSort vs Merge Sort"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"quicksort-runtime"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/quicksort/quicksort-runtime.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>

<p>
I originally had Insertion Sort in the plot too, but it does so poorly that it just squashes both the Merge Sort and Quick Sort runtimes to a flat line. This is kind of an interesting plot. Quick Sort does much, much better than Insertion Sort, but it still doesn't quite keep up with Merge Sort. The trade-off being that Quick Sort does its sorting in place while Merge Sort creates all these temporary copies. 
</p>
</div>
</div>

<div id="outline-container-org6ee8b93" class="outline-4">
<h4 id="org6ee8b93">Worst-Case Input</h4>
<div class="outline-text-4" id="text-org6ee8b93">
<p>
Remember that case in the <a href="posts/the-partition/">the partition</a> post where the last item (the pivot) was the largest item, and how it resulted in nothing being moved around? What if no matter what sub-array you picked, the last item was always the largest? In other words, what if it's already sorted?
</p>

<p>
For one thing with really big inputs the interpreter throws an error because you've made too many recursive calls, so that tells you that something bad is happening.
</p>

<div class="highlight"><pre><span></span><span class="n">things_to_sort</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">))</span> <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="mi">100</span><span class="p">)]</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">quick_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
    <span class="n">delayed</span><span class="p">(</span><span class="n">quicksorter</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">)</span>
</pre></div>

<pre class="example">
Started: 2022-02-05 01:06:19.614254
Ended: 2022-02-05 01:06:20.159874
Elapsed: 0:00:00.545620
</pre>


<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">merge_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
    <span class="n">delayed</span><span class="p">(</span><span class="n">mergesort</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">)</span>
</pre></div>

<pre class="example">
Started: 2022-02-05 01:06:23.592928
Ended: 2022-02-05 01:06:23.661150
Elapsed: 0:00:00.068222
</pre>


<p>
<b><b>Note to future self:</b></b> Pypy is much faster with the python inputs and much slower with numpy inputs.
</p>

<div class="highlight"><pre><span></span><span class="n">counts</span> <span class="o">=</span> <span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">comparisons</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">quick_output</span><span class="p">]</span>
<span class="n">sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">quick_output</span><span class="p">]</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"Size"</span><span class="p">:</span> <span class="n">sizes</span><span class="p">,</span> <span class="s2">"QuickSort"</span><span class="p">:</span> <span class="n">counts</span><span class="p">})</span>
<span class="n">frame</span><span class="p">[</span><span class="s2">"Merge Sort"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">output</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">merge_output</span><span class="p">]</span>

<span class="n">melted</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Size"</span><span class="p">],</span>
		    <span class="n">var_name</span><span class="o">=</span><span class="s2">"Sort Algorithm"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Size"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Sort Algorithm"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Size"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Comparisons"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="s2">"Sort Algorithm"</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"QuickSort vs Merge Sort (Worst-Case)"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"quicksort-runtime-worst"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/quicksort/quicksort-runtime-worst.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>
</div>
</div>
</div>
<div id="outline-container-orgd27592f" class="outline-3">
<h3 id="orgd27592f">Looking At the Sort In Progress</h3>
<div class="outline-text-3" id="text-orgd27592f">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">quicksort_tracer</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">,</span>
		     <span class="n">left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">tracer</span><span class="p">:</span> <span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""Recursive quicksort</span>

<span class="sd">    Args:</span>
<span class="sd">     collection: list to sort</span>
<span class="sd">     left: index of start of sub-list in collection to sort</span>
<span class="sd">     right: index of end of sub-list in collection to sort</span>
<span class="sd">     tracer: dict of element: list of locations</span>

<span class="sd">    Returns:</span>
<span class="sd">     tracer dict</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">tracer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
	<span class="n">tracer</span> <span class="o">=</span> <span class="p">{</span><span class="n">element</span><span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">collection</span><span class="p">)}</span>

    <span class="k">if</span> <span class="n">left</span> <span class="o">&lt;</span> <span class="n">right</span><span class="p">:</span>
	<span class="n">output</span> <span class="o">=</span> <span class="n">partition</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>

	<span class="n">quicksort_tracer</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">pivot</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tracer</span><span class="p">)</span>
	<span class="n">quicksort_tracer</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">pivot</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">tracer</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">collection</span><span class="p">):</span>
	    <span class="n">tracer</span><span class="p">[</span><span class="n">element</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tracer</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">size</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">start</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">inputs</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

<span class="n">tracer</span> <span class="o">=</span> <span class="n">quicksort_tracer</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tracer</span><span class="p">)</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"Quicksort Call"</span><span class="p">})</span>
<span class="n">melted</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Quicksort Call"</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">"Element"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Location"</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Quicksort Call"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Location"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Element"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"Quicksort Call"</span><span class="p">,</span> <span class="s2">"Location"</span><span class="p">,</span> <span class="s2">"Element"</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Quicksort Trace (Reversed Input)"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"quicksort-trace-backwards"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/quicksort/quicksort-trace-backwards.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>

<div class="highlight"><pre><span></span><span class="n">size</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">start</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

<span class="n">tracer</span> <span class="o">=</span> <span class="n">quicksort_tracer</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tracer</span><span class="p">)</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"Quicksort Call"</span><span class="p">})</span>
<span class="n">melted</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Quicksort Call"</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">"Element"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Location"</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Quicksort Call"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Location"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Element"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"Quicksort Call"</span><span class="p">,</span> <span class="s2">"Location"</span><span class="p">,</span> <span class="s2">"Element"</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Quicksort Trace (Shuffled Input)"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"quicksort-trace-shuffled"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/quicksort/quicksort-trace-shuffled.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>
</div>
</div>
</div>


<div id="outline-container-org652b565" class="outline-2">
<h2 id="org652b565">End</h2>
<div class="outline-text-2" id="text-org652b565">
<ul class="org-ul">
<li><a href="posts/clrs/">Introduction To Algorithms (CLRS)</a></li>
<li><a href="posts/itdaa/">Introduction to the Design &amp; Analysis of Algorithms (Levitin)</a></li>
</ul>
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("the-quicksort"));
});
</script>
</div>
</div>
    </div>
    </article>
</div>

        <ul class="pager postindexpager clearfix">
<li class="next"><a href="index-3.html" rel="next">Older posts</a></li>
        </ul>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
             MathJax.Hub.Config({
               tex2jax: {
                 inlineMath: [['$','$'], ['\\(','\\)']],
                 displayMath: [['$$','$$'], ['\\[','\\]']],
                 processEscapes: true,
                 processEnvironments: true,
               },
               displayAlign: 'center',
               "HTML-CSS": {
                 styles: {'.MathJax_Display': {"margin": 0}}
               }
             });
            </script><script src="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.js"></script><!--End of body content--><footer id="footer"><a href="mailto:cloisteredmonkey.jmark@slmail.me">The Cloistered Monkey</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
 <img alt="Creative Commons License BY-NC-SA" style="border-width:0; margin-bottom:12px;" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"></a>
            
            
        </footer>
</div>
</div>


        <script src="assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
