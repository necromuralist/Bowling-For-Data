<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Striking out for data." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Bowling For Data</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Bowling-For-Data/index.html" rel="canonical">
<link href="index-7.html" rel="next" type="text/html"><!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
<link href="posts/testing-the-altair-shortcode/index.html" rel="prefetch" type="text/html">
<script crossorigin="anonymous" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],

            displayMath: [['$$','$$'], ['\\[','\\]']],
            processEscapes: true,
            processEnvironments: true,
        }
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/pseudocode@2.4.1/build/pseudocode.min.js"></script>
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="."><span id="blog-title">Bowling For Data</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="pages/">Pages</a></li>
<li class="nav-item"><a class="nav-link" href="archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="rss.xml">RSS feed</a></li>
<li class="nav-item dropdown"><a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Monkey Pages</a>
<div class="dropdown-menu"><a class="dropdown-item" href="https://necromuralist.github.io/">The Cloistered Monkey</a> <a class="dropdown-item" href="https://necromuralist.github.io/Ape-Iron/">Ape Iron</a> <a class="dropdown-item" href="https://necromuralist.github.io/Beach-Pig-Thigh/">Beach-Pig Rump & Thigh</a> <a class="dropdown-item" href="https://necromuralist.github.io/Neurotic-Networking/">Neurotic Networking</a> <a class="dropdown-item" href="https://necromuralist.github.io/Terribilis-Ludum/">Terribilis Ludum</a> <a class="dropdown-item" href="https://necromuralist.github.io/Visions-Voices-Data/">Visions, Voices, Data</a></div>
</li>
</ul>
<!-- DuckDuckGo custom search -->
<form action="https://duckduckgo.com/" class="navbar-form pull-left" id="search" method="get" name="search"><input name="sites" type="hidden" value="https://necromuralist.github.io/Bowling-For-Data/"><input name="k8" type="hidden" value="#444444"><input name="k9" type="hidden" value="#D51920"><input name="kt" type="hidden" value="h"><input class="span2" maxlength="255" name="q" placeholder="Searchâ€¦" style="margin-top: 4px;" type="text"><input style="visibility: hidden;" type="submit" value="DuckDuckGo Search"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<div class="postindex">
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/testing-the-altair-shortcode/index.html">Testing the Altair Shortcode</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/testing-the-altair-shortcode/index.html" rel="bookmark"><time class="published dt-published" datetime="2024-03-15T20:25:34-07:00" itemprop="datePublished" title="2024-03-15 20:25">2024-03-15 20:25</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/testing-the-altair-shortcode/index.html#orgf7d9a54">Introduction</a></li>
<li><a href="posts/testing-the-altair-shortcode/index.html#org41ac705">Setup</a>
<ul>
<li><a href="posts/testing-the-altair-shortcode/index.html#orge614ece">Imports</a></li>
<li><a href="posts/testing-the-altair-shortcode/index.html#orgc56c4e0">The Output Path</a></li>
</ul>
</li>
<li><a href="posts/testing-the-altair-shortcode/index.html#org0bff84a">The Data</a></li>
<li><a href="posts/testing-the-altair-shortcode/index.html#orgb7eed76">Counting the Years</a>
<ul>
<li><a href="posts/testing-the-altair-shortcode/index.html#orge6dbf36">A Table To Show the Counts</a></li>
<li><a href="posts/testing-the-altair-shortcode/index.html#org77e4b27">Now the Bar-Chart</a></li>
</ul>
</li>
<li><a href="posts/testing-the-altair-shortcode/index.html#org9a99521">And a Line Plot</a></li>
<li><a href="posts/testing-the-altair-shortcode/index.html#org84ac4bc">The End</a></li>
<li><a href="posts/testing-the-altair-shortcode/index.html#org99211c6">Links</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgf7d9a54">
<h2 id="orgf7d9a54">Introduction</h2>
<div class="outline-text-2" id="text-orgf7d9a54">
<p>The way I've been using <a href="https://altair-viz.github.io/index.html">altair</a> is by saving the charts as HTML documents and then embedding them into the posts as pages within the page. This works, so I don't know if this is a good idea or not, but I'm going to try embedding them as HTML elements only, the way I do with p5.js. This is a check to make sure I've got the parts working so nikola will compile everything the way I'm expecting it to.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org41ac705">
<h2 id="org41ac705">Setup</h2>
<div class="outline-text-2" id="text-org41ac705"></div>
<div class="outline-3" id="outline-container-orge614ece">
<h3 id="orge614ece">Imports</h3>
<div class="outline-text-3" id="text-orge614ece">
<p>These initial imports are for the plotting and not really what this post is testing.</p>
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="kn">import</span> <span class="nn">altair</span>
<span class="kn">import</span> <span class="nn">pandas</span>
</pre></div>
<p>Next is the function I'm testing - a new function I created in <code>graeae</code>, called <code>save_vega_embed</code>. Which maybe isn't the best name but it shouldn't clash with my other functions, hopefully. Its purpose is to create the JavaScript function that Altair's <code>Chart.save</code> was creating for me in the earlier posts and then save it where nikola can find it.</p>
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">graeae.visualization.altair_helpers</span> <span class="kn">import</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">save_vega_embed</span>
</pre></div>
<div class="notecard" id="org30affd2">
<p><b>Note to self:</b> Since I usually run the code to create the plot on a different machine from the one where the nikola code is being run to create this site, the <code>graeae</code> function has to be installed on the remote machine where the plots are created.</p>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-orgc56c4e0">
<h3 id="orgc56c4e0">The Output Path</h3>
<div class="outline-text-3" id="text-orgc56c4e0">
<p>The <code>output_path</code> function takes the slug and checks if there's a folder matching it in the <code>files/posts</code> folder and creates it if it doesn't exist. Its output is a Path to that folder which we can use to tell the code where to save files for the chart.</p>
<div class="highlight">
<pre><span></span><span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"testing-the-altair-shortcode"</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="n">output_path</span><span class="p">(</span><span class="n">SLUG</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org0bff84a">
<h2 id="org0bff84a">The Data</h2>
<div class="outline-text-2" id="text-org0bff84a">
<p>To have something to plot I'll use the United Nation's World Happiness data, which I downloaded (as excel spreadsheets) and converted to a CSV.</p>
<div class="highlight">
<pre><span></span><span class="n">load_dotenv</span><span class="p">(</span><span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">table_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"WORLD_HAPPINESS_TABLE"</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">table_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>

<span class="n">table</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">table_path</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
<pre class="example">
(2199, 11)
</pre>
<p>This is overkill, but I had the idea to do this while in the middle of another post that uses this dataset so it was convenient to cut-and-paste the block here.</p>
</div>
</div>
<div class="outline-2" id="outline-container-orgb7eed76">
<h2 id="orgb7eed76">Counting the Years</h2>
<div class="outline-text-2" id="text-orgb7eed76">
<p>The test-plot will be a bar-graph showing the number of entries (countries) for each year in the dataset. The data uses "year" as the name of the column with the years so I'll make a little name holder and then create a data-frame with the counts.</p>
<div class="highlight">
<pre><span></span><span class="k">class</span> <span class="nc">Column</span><span class="p">:</span>
    <span class="n">year</span> <span class="o">=</span> <span class="s2">"year"</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">year_counts</span> <span class="o">=</span> <span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
               <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
               <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">Column</span><span class="o">.</span><span class="n">year</span><span class="p">))</span>
</pre></div>
<p>The <code>value_counts</code> output has the years as the index of the Series so I'm calling <code>reset_index</code> to move it into a column, giving us a two-column data-frame (with "year" and "counts" as columns).</p>
</div>
<div class="outline-3" id="outline-container-orge6dbf36">
<h3 id="orge6dbf36">A Table To Show the Counts</h3>
<div class="outline-text-3" id="text-orge6dbf36">
<p>This is to show the values that we're going to plot.</p>
<div class="highlight">
<pre><span></span><span class="n">table_counts</span> <span class="o">=</span> <span class="n">year_counts</span><span class="o">.</span><span class="n">T</span>

<span class="n">table_counts</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">table_counts</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">table_counts</span> <span class="o">=</span> <span class="n">table_counts</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">table_counts</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">table_counts</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">&nbsp;</th>
<th class="org-right" scope="col">2005</th>
<th class="org-right" scope="col">2006</th>
<th class="org-right" scope="col">2007</th>
<th class="org-right" scope="col">2008</th>
<th class="org-right" scope="col">2009</th>
<th class="org-right" scope="col">2010</th>
<th class="org-right" scope="col">2011</th>
<th class="org-right" scope="col">2012</th>
<th class="org-right" scope="col">2013</th>
<th class="org-right" scope="col">2014</th>
<th class="org-right" scope="col">2015</th>
<th class="org-right" scope="col">2016</th>
<th class="org-right" scope="col">2017</th>
<th class="org-right" scope="col">2018</th>
<th class="org-right" scope="col">2019</th>
<th class="org-right" scope="col">2020</th>
<th class="org-right" scope="col">2021</th>
<th class="org-right" scope="col">2022</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">count</td>
<td class="org-right">27</td>
<td class="org-right">89</td>
<td class="org-right">102</td>
<td class="org-right">110</td>
<td class="org-right">114</td>
<td class="org-right">124</td>
<td class="org-right">146</td>
<td class="org-right">141</td>
<td class="org-right">136</td>
<td class="org-right">144</td>
<td class="org-right">142</td>
<td class="org-right">141</td>
<td class="org-right">147</td>
<td class="org-right">141</td>
<td class="org-right">143</td>
<td class="org-right">116</td>
<td class="org-right">122</td>
<td class="org-right">114</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-3" id="outline-container-org77e4b27">
<h3 id="org77e4b27">Now the Bar-Chart</h3>
<div class="outline-text-3" id="text-org77e4b27">
<p>So, here's what we're testing.</p>
<p>First, we need an identifier for the HTML <code>div</code> tag so that we can tell Vega where to stick the chart.</p>
<div class="highlight">
<pre><span></span><span class="n">DIV_ID</span> <span class="o">=</span> <span class="s2">"value-counts-0d454587"</span>
</pre></div>
<p>Now we'll create the altair Chart.</p>
<div class="highlight">
<pre><span></span><span class="n">value_counts_chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">year_counts</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"</span><span class="si">{}</span><span class="s2">:N"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Column</span><span class="o">.</span><span class="n">year</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"count"</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span>
</pre></div>
<p>Now to save it. Previously I was using Altair's <code>save</code> method to save it as an HTML document and embedding the entire document within the post using an <code>&lt;object&gt;</code> tag, which seems to work kind of like a frame. I think. Anyway, this version saves the chart as a JavaScript function instead (using the name we pass in for the file-name) which then gets called by <a href="https://github.com/vega/vega-embed">vega-embed</a> to create the chart. The <code>graeae.visualization.altair_helpers.save_vega_embed</code> function is extracting the JSON schema from the chart (using Altair's <code>Chart.to_json()</code>) and adding it to a JavaScript function that I copied from the file created by Altair's <code>Chart.save</code>. The output of the <code>graeae</code> function is the shortcode to tell nikola to embed the chart here.</p>
<div class="notecard" id="org2231a24">
<p><b>Note:</b> I haven't figured out how to get <code>jupyter-emacs</code> to dump python output without formatting it as a <code>#+RESULTS</code> block so it will need a little clean up after the function is called. If not, the shortcode will work, but it will also create an empty box underneath it.</p>
</div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">save_vega_embed</span><span class="p">(</span><span class="n">chart</span><span class="o">=</span><span class="n">value_counts_chart</span><span class="p">,</span>
                      <span class="n">name</span><span class="o">=</span><span class="s2">"value-counts-bar-chart"</span><span class="p">,</span>
                      <span class="n">div_id</span><span class="o">=</span><span class="n">DIV_ID</span><span class="p">,</span>
                      <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">))</span>
</pre></div>
<p></p>
<div class="altair-vega" id="value-counts-0d454587"></div>
<script src="posts/testing-the-altair-shortcode/value-counts-bar-chart.js"></script></div>
</div>
</div>
<div class="outline-2" id="outline-container-org9a99521">
<h2 id="org9a99521">And a Line Plot</h2>
<div class="outline-text-2" id="text-org9a99521">
<p>I'm going to re-plot the data as a line chart to make sure there's nothing I created that causes them to mess each other up.</p>
<div class="highlight">
<pre><span></span><span class="n">line_chart</span> <span class="o">=</span> <span class="n">value_counts_chart</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">save_vega_embed</span><span class="p">(</span><span class="n">line_chart</span><span class="p">,</span>
                      <span class="n">name</span><span class="o">=</span><span class="s2">"value-counts-line-chart"</span><span class="p">,</span>
                      <span class="n">div_id</span><span class="o">=</span><span class="s2">"line-chart-0d454587"</span><span class="p">,</span>
                      <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">))</span>
</pre></div>
<p></p>
<div class="altair-vega" id="line-chart-0d454587"></div>
<script src="posts/testing-the-altair-shortcode/value-counts-line-chart.js"></script>
<div class="notecard" id="org1b0367b">
<p><b>Note:</b> The <code>altairdiv</code> shortcode sets the HTML class for the chart's div to "altair-vega" in case it needs styling later.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org84ac4bc">
<h2 id="org84ac4bc">The End</h2>
<div class="outline-text-2" id="text-org84ac4bc">
<p>Well, that seems to work. I was originally going to throw this away once things seemed to be all right, but I'll keep it as a future reference in case I forget how to use this stuff later.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org99211c6">
<h2 id="org99211c6">Links</h2>
<div class="outline-text-2" id="text-org99211c6">
<ul class="org-ul">
<li>Saving Altair Charts â€” Vega-Altair 5.2.0 documentation [Internet]. [cited 2024 Mar 16]. Available from: <a href="https://altair-viz.github.io/user_guide/saving_charts.html">https://altair-viz.github.io/user_guide/saving_charts.html</a></li>
<li>vega/vega-embed [Internet]. Vega; 2024 [cited 2024 Mar 16]. Available from: <a href="https://github.com/vega/vega-embed">https://github.com/vega/vega-embed</a></li>
<li>World Happiness Report [Internet]. 2023 [cited 2023 Dec 11]. Available from: <a href="https://worldhappiness.report/">https://worldhappiness.report/</a></li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/introduction-to-altair-countries-per-year/index.html">Introduction To Altair: Countries Per Year</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/introduction-to-altair-countries-per-year/index.html" rel="bookmark"><time class="published dt-published" datetime="2024-03-06T16:57:41-08:00" itemprop="datePublished" title="2024-03-06 16:57">2024-03-06 16:57</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/introduction-to-altair-countries-per-year/index.html#orge5cf3cf">Setup</a>
<ul>
<li><a href="posts/introduction-to-altair-countries-per-year/index.html#orgace8832">Imports</a></li>
<li><a href="posts/introduction-to-altair-countries-per-year/index.html#org6701f53">Some Setting Up</a></li>
</ul>
</li>
<li><a href="posts/introduction-to-altair-countries-per-year/index.html#org4b6e0ba">The Data</a>
<ul>
<li><a href="posts/introduction-to-altair-countries-per-year/index.html#orgef1c1f0">The Data Columns</a></li>
</ul>
</li>
<li><a href="posts/introduction-to-altair-countries-per-year/index.html#org315a1cd">Counting the Years</a>
<ul>
<li><a href="posts/introduction-to-altair-countries-per-year/index.html#orgf238ffe">Using Pandas' <code>value_counts</code> Method</a></li>
<li><a href="posts/introduction-to-altair-countries-per-year/index.html#org9d20b74">Using Altair's "count"</a></li>
<li><a href="posts/introduction-to-altair-countries-per-year/index.html#org75d21f1">Comparing the File Sizes</a>
<ul>
<li><a href="posts/introduction-to-altair-countries-per-year/index.html#orgc65bcc2">The Files In Bytes</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="posts/introduction-to-altair-countries-per-year/index.html#org536c940">A Chart, Part By Part</a>
<ul>
<li><a href="posts/introduction-to-altair-countries-per-year/index.html#org7e74596">Altair's Chart</a></li>
<li><a href="posts/introduction-to-altair-countries-per-year/index.html#org8b0cc60">A Bar Chart</a></li>
<li><a href="posts/introduction-to-altair-countries-per-year/index.html#orge1b2303">SchemaBase</a>
<ul>
<li><a href="posts/introduction-to-altair-countries-per-year/index.html#orgc65ce1e">TopLevelUnitSpec</a></li>
</ul>
</li>
<li><a href="posts/introduction-to-altair-countries-per-year/index.html#org1599340">Encoded</a>
<ul>
<li><a href="posts/introduction-to-altair-countries-per-year/index.html#org9fccd14">_EncodingMixin</a></li>
</ul>
</li>
<li><a href="posts/introduction-to-altair-countries-per-year/index.html#orgaec6ecb">Properties</a></li>
</ul>
</li>
<li><a href="posts/introduction-to-altair-countries-per-year/index.html#orgb58ef49">HVPlot</a></li>
<li><a href="posts/introduction-to-altair-countries-per-year/index.html#org2c598f4">Links</a>
<ul>
<li><a href="posts/introduction-to-altair-countries-per-year/index.html#org61fdbb5">The Posts In This Series</a></li>
<li><a href="posts/introduction-to-altair-countries-per-year/index.html#org0476e77">Tutorial Sources</a></li>
<li><a href="posts/introduction-to-altair-countries-per-year/index.html#org519e30c">The Data</a></li>
<li><a href="posts/introduction-to-altair-countries-per-year/index.html#orgc4233da">Altair</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orge5cf3cf">
<h2 id="orge5cf3cf">Setup</h2>
<div class="outline-text-2" id="text-orge5cf3cf"></div>
<div class="outline-3" id="outline-container-orgace8832">
<h3 id="orgace8832">Imports</h3>
<div class="outline-text-3" id="text-orgace8832">
<p>These initial imports are supports to make creating this post easier and aren't necessarily needed for the altair plots.</p>
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">be</span><span class="p">,</span> <span class="n">be_true</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="c1"># monkey</span>
<span class="kn">from</span> <span class="nn">graeae.visualization.altair_helpers</span> <span class="kn">import</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">save_chart</span>
</pre></div>
<p>These are the ones that are really needed for the plotting. I installed both of them through pypi.</p>
<div class="highlight">
<pre><span></span><span class="kn">import</span> <span class="nn">altair</span>
<span class="kn">import</span> <span class="nn">pandas</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org6701f53">
<h3 id="org6701f53">Some Setting Up</h3>
<div class="outline-text-3" id="text-org6701f53">
<p>These are some convenience objects to save a little bit of coding when saving the chart.</p>
<div class="highlight">
<pre><span></span><span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"introduction-to-altair-countries-per-year"</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="n">output_path</span><span class="p">(</span><span class="n">SLUG</span><span class="p">)</span>

<span class="n">HEIGHT</span><span class="p">,</span> <span class="n">WIDTH</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">800</span>
<span class="n">SAVE_IT</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">save_chart</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">HEIGHT</span> <span class="o">+</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">SOUPER</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">BeautifulSoup</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="s2">"lxml"</span><span class="p">)</span>
</pre></div>
<p>This is to make printing out a pandas dataframe as a table a little nicer.</p>
<div class="highlight">
<pre><span></span><span class="n">TABLE</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">tabulate</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">,</span>
                <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">,</span>
                <span class="n">showindex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org4b6e0ba">
<h2 id="org4b6e0ba">The Data</h2>
<div class="outline-text-2" id="text-org4b6e0ba">
<div class="highlight">
<pre><span></span><span class="n">load_dotenv</span><span class="p">(</span><span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">table_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"WORLD_HAPPINESS_TABLE"</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">table_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>

<span class="n">table</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">table_path</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
<pre class="example">
(2199, 11)
</pre></div>
<div class="outline-3" id="outline-container-orgef1c1f0">
<h3 id="orgef1c1f0">The Data Columns</h3>
<div class="outline-text-3" id="text-orgef1c1f0">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">column_printer</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">(</span><span class="s2">"Column"</span><span class="p">,</span> <span class="s2">"Type"</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span>
        <span class="p">((</span><span class="n">column</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
         <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span>
        <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">))</span>
    <span class="k">return</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">column_printer</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Column</th>
<th class="org-left" scope="col">Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Country name</td>
<td class="org-left">object</td>
</tr>
<tr>
<td class="org-left">year</td>
<td class="org-left">int64</td>
</tr>
<tr>
<td class="org-left">Life Ladder</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Log GDP per capita</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Social support</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Healthy life expectancy at birth</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Freedom to make life choices</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Generosity</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Perceptions of corruption</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Positive affect</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Negative affect</td>
<td class="org-left">float64</td>
</tr>
</tbody>
</table>
<p>For this initial post I'll only use the year, but</p>
<div class="highlight">
<pre><span></span><span class="k">class</span> <span class="nc">Column</span><span class="p">:</span>
    <span class="n">year</span> <span class="o">=</span> <span class="s2">"year"</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org315a1cd">
<h2 id="org315a1cd">Counting the Years</h2>
<div class="outline-text-2" id="text-org315a1cd"></div>
<div class="outline-3" id="outline-container-orgf238ffe">
<h3 id="orgf238ffe">Using Pandas' <code>value_counts</code> Method</h3>
<div class="outline-text-3" id="text-orgf238ffe">
<div class="highlight">
<pre><span></span><span class="n">year_counts</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">"year"</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">table_counts</span> <span class="o">=</span> <span class="n">year_counts</span><span class="o">.</span><span class="n">T</span>
<span class="n">table_counts</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">table_counts</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">table_counts</span> <span class="o">=</span> <span class="n">table_counts</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">table_counts</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">table_counts</span><span class="p">,</span> <span class="n">showindex</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">&nbsp;</th>
<th class="org-right" scope="col">2005</th>
<th class="org-right" scope="col">2006</th>
<th class="org-right" scope="col">2007</th>
<th class="org-right" scope="col">2008</th>
<th class="org-right" scope="col">2009</th>
<th class="org-right" scope="col">2010</th>
<th class="org-right" scope="col">2011</th>
<th class="org-right" scope="col">2012</th>
<th class="org-right" scope="col">2013</th>
<th class="org-right" scope="col">2014</th>
<th class="org-right" scope="col">2015</th>
<th class="org-right" scope="col">2016</th>
<th class="org-right" scope="col">2017</th>
<th class="org-right" scope="col">2018</th>
<th class="org-right" scope="col">2019</th>
<th class="org-right" scope="col">2020</th>
<th class="org-right" scope="col">2021</th>
<th class="org-right" scope="col">2022</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">count</td>
<td class="org-right">27</td>
<td class="org-right">89</td>
<td class="org-right">102</td>
<td class="org-right">110</td>
<td class="org-right">114</td>
<td class="org-right">124</td>
<td class="org-right">146</td>
<td class="org-right">141</td>
<td class="org-right">136</td>
<td class="org-right">144</td>
<td class="org-right">142</td>
<td class="org-right">141</td>
<td class="org-right">147</td>
<td class="org-right">141</td>
<td class="org-right">143</td>
<td class="org-right">116</td>
<td class="org-right">122</td>
<td class="org-right">114</td>
</tr>
</tbody>
</table>
<p>Now as a bar-chart.</p>
<div class="highlight">
<pre><span></span><span class="n">value_counts_chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">year_counts</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"</span><span class="si">{}</span><span class="s2">:N"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Column</span><span class="o">.</span><span class="n">year</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"count"</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="n">HEIGHT</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">WIDTH</span><span class="p">)</span>

<span class="n">VALUE_COUNTS_NAME</span> <span class="o">=</span> <span class="s2">"value-counts-bar-chart"</span>
<span class="n">VALUE_COUNTS_HTML</span> <span class="o">=</span> <span class="n">VALUE_COUNTS_NAME</span> <span class="o">+</span> <span class="s2">".html"</span>
<span class="n">SAVE_IT</span><span class="p">(</span><span class="n">value_counts_chart</span><span class="p">,</span> <span class="n">VALUE_COUNTS_NAME</span><span class="p">)</span>
</pre></div>
<object data="posts/introduction-to-altair-countries-per-year/value-counts-bar-chart.html" height="700" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
<div class="outline-3" id="outline-container-org9d20b74">
<h3 id="org9d20b74">Using Altair's "count"</h3>
<div class="outline-text-3" id="text-org9d20b74">
<div class="highlight">
<pre><span></span><span class="n">altair_counts_chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">table</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"</span><span class="si">{}</span><span class="s2">:N"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Column</span><span class="o">.</span><span class="n">year</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"count()"</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="n">HEIGHT</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">WIDTH</span><span class="p">)</span>

<span class="n">ALTAIR_COUNTS_NAME</span> <span class="o">=</span> <span class="s2">"altair-counts-bar-chart"</span>
<span class="n">ALTAIR_COUNTS_HTML</span> <span class="o">=</span> <span class="n">ALTAIR_COUNTS_NAME</span> <span class="o">+</span> <span class="s2">".html"</span>
<span class="n">SAVE_IT</span><span class="p">(</span><span class="n">altair_counts_chart</span><span class="p">,</span> <span class="n">ALTAIR_COUNTS_NAME</span><span class="p">)</span>
</pre></div>
<object data="posts/introduction-to-altair-countries-per-year/altair-counts-bar-chart.html" height="700" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
<div class="outline-3" id="outline-container-org75d21f1">
<h3 id="org75d21f1">Comparing the File Sizes</h3>
<div class="outline-text-3" id="text-org75d21f1"></div>
<div class="outline-4" id="outline-container-orgc65bcc2">
<h4 id="orgc65bcc2">The Files In Bytes</h4>
<div class="outline-text-4" id="text-orgc65bcc2">
<div class="highlight">
<pre><span></span><span class="n">altair_counts_html</span> <span class="o">=</span> <span class="n">OUTPUT_PATH</span><span class="o">/</span><span class="p">(</span><span class="n">ALTAIR_COUNTS_HTML</span><span class="p">)</span>
<span class="n">pandas_counts_html</span> <span class="o">=</span> <span class="n">OUTPUT_PATH</span><span class="o">/</span><span class="p">(</span><span class="n">VALUE_COUNTS_HTML</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Altair counts(): </span><span class="si">{:,}</span><span class="s2"> bytes"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">altair_counts_html</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Pandas value_counts: </span><span class="si">{:,}</span><span class="s2"> bytes"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pandas_counts_html</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span><span class="p">))</span>
</pre></div>
<pre class="example">
Altair counts(): 685,111 bytes
Pandas value_counts: 2,067 bytes
</pre>
<p>Here's one of the problems with <code>altair</code> - it passes along the entire dataset and then tells <code>vega</code> to work with it in the browser. So, in this case it's passing all our happiness data, even though the chart doesn't use any of the columns.</p>
<div class="highlight">
<pre><span></span><span class="k">with</span> <span class="n">altair_counts_html</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
    <span class="n">altair_soup</span> <span class="o">=</span> <span class="n">SOUPER</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>

<span class="k">with</span> <span class="n">pandas_counts_html</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">reader</span><span class="p">:</span>
    <span class="n">pandas_soup</span> <span class="o">=</span> <span class="n">SOUPER</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">data_printer</span><span class="p">(</span><span class="n">soup</span><span class="p">:</span> <span class="n">BeautifulSoup</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Gets the data from the soup and prints the entry</span>

<span class="sd">    Params:</span>

<span class="sd">     - soup: BeautifulSoup with the HTML for the chart</span>
<span class="sd">     - index: which data row to show</span>
<span class="sd">    """</span>
    <span class="n">EVERYTHING</span> <span class="o">=</span> <span class="s2">".*"</span>
    <span class="n">EXTRA_BRACE</span> <span class="o">=</span> <span class="s2">"(?=})"</span>

    <span class="n">DATASETS_EXPRESSION</span> <span class="o">=</span> <span class="s2">"datasets"</span> <span class="o">+</span> <span class="n">EVERYTHING</span> <span class="o">+</span> <span class="s2">"}}"</span>
    <span class="n">DATASET_EXPRESSION</span> <span class="o">=</span> <span class="s2">"{"</span> <span class="o">+</span> <span class="n">EVERYTHING</span> <span class="o">+</span> <span class="s2">"}"</span> <span class="o">+</span> <span class="n">EXTRA_BRACE</span>

    <span class="n">script</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">"script"</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">string</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">DATASETS_EXPRESSION</span><span class="p">,</span> <span class="n">script</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">DATASET_EXPRESSION</span><span class="p">,</span> <span class="n">dataset</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
    <span class="n">json_dataset</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
    <span class="n">data_key</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">json_dataset</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json_dataset</span><span class="p">[</span><span class="n">data_key</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"'dataset' has </span><span class="si">{:,}</span><span class="s2"> data entries</span><span class="se">\n</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Entry </span><span class="si">{}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
    <span class="k">return</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">data_printer</span><span class="p">(</span><span class="n">pandas_soup</span><span class="p">)</span>
</pre></div>
<pre class="example">
'dataset' has 18 data entries

Entry 0:

{'count': 27, 'year': 2005}
</pre>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">frame_print</span><span class="p">(</span><span class="n">frame</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""print length and one row of frame</span>

<span class="sd">    Params:</span>

<span class="sd">     - frame: data-frame to query</span>
<span class="sd">     - index: index of row to print</span>
<span class="sd">    """</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Frame has </span><span class="si">{:,}</span><span class="s2"> rows."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frame</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Row </span><span class="si">{}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">frame_print</span><span class="p">(</span><span class="n">year_counts</span><span class="p">)</span>
</pre></div>
<pre class="example">
Frame has 18 rows.

Row 0:

year     2005
count      27
Name: 17, dtype: int64
</pre>
<div class="highlight">
<pre><span></span><span class="n">data_printer</span><span class="p">(</span><span class="n">altair_soup</span><span class="p">)</span>
</pre></div>
<pre class="example" id="orgc0d404e">
'dataset' has 2,199 data entries

Entry 0:

{'Country name': 'Afghanistan',
 'Freedom to make life choices': 0.718,
 'Generosity': 0.168,
 'Healthy life expectancy at birth': 50.5,
 'Life Ladder': 3.724,
 'Log GDP per capita': 7.35,
 'Negative affect': 0.258,
 'Perceptions of corruption': 0.882,
 'Positive affect': 0.414,
 'Social support': 0.451,
 'year': 2008}
</pre>
<div class="highlight">
<pre><span></span><span class="n">frame_print</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</pre></div>
<pre class="example" id="orge11c4b6">
Frame has 2,199 rows.

Row 0:

Country name                        Afghanistan
year                                       2008
Life Ladder                               3.724
Log GDP per capita                         7.35
Social support                            0.451
Healthy life expectancy at birth           50.5
Freedom to make life choices              0.718
Generosity                                0.168
Perceptions of corruption                 0.882
Positive affect                           0.414
Negative affect                           0.258
Name: 0, dtype: object
</pre>
<p>There's a project called <a href="https://vegafusion.io/">vegafusion</a> that is supposed to help with reducing the size but it requires that you use a jupyter notebook for interactivity (it uses python to make a jupyter widget or some such) so it won't work for a static site like this one. So when using altair we have to think about what we're doing if the size of the files is going to be a problem. In most cases it probably makes sense to do the transformations in pandas first and then only pass the data to plot to altair.</p>
<p>See the <a href="https://altair-viz.github.io/user_guide/large_datasets.html">altair documentation on Large Datasets</a> for more information.</p>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org536c940">
<h2 id="org536c940">A Chart, Part By Part</h2>
<div class="outline-text-2" id="text-org536c940"></div>
<div class="outline-3" id="outline-container-org7e74596">
<h3 id="org7e74596">Altair's Chart</h3>
<div class="outline-text-3" id="text-org7e74596">
<div class="highlight">
<pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">year_counts</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">chart</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">year_counts</span><span class="p">))</span>
</pre></div>
<pre class="example">
&lt;class 'altair.vegalite.v5.api.Chart'&gt;
</pre>
<p>The <code>Chart</code> class is defined in <code>altair.vegalite.v5.api</code>. This is its docstring description:</p>
<blockquote>
<p>Create a basic Altair/Vega-Lite chart.</p>
<p>Although it is possible to set all Chart properties as constructor attributes, it is more idiomatic to use methods such as <code>mark_point()</code>, <code>encode()</code>, <code>transform_filter()</code>, <code>properties()</code>, etc. See Altair's documentation for details and examples: <a href="http://altair-viz.github.io/">http://altair-viz.github.io/</a>.</p>
</blockquote>
<p>The attributes set by the <code>Chart</code> class' constructor (it also accepets other keyword parameters that are passed to its parent classes) are:</p>
<ul class="org-ul">
<li>data</li>
<li>encoding</li>
<li>mark</li>
<li>width</li>
<li>height</li>
</ul>
<p>By default they're set to <code>Undefined</code> which is an altair-defined object (see <code>altair.utils.schemapi</code>), and as noted, you don't normally set the attributes using the constructor (other than <code>data</code> which isn't mentioned in the docstring but appears to be passed to the <code>Chart</code> constructor by convention).</p>
<p>Here's a diagram of the <code>Chart</code> (defined in <code>altair.vegalite.v5.api</code>).</p>
<p><img alt="nil" src="posts/introduction-to-altair-countries-per-year/chart.png"></p>
</div>
</div>
<div class="outline-3" id="outline-container-org8b0cc60">
<h3 id="org8b0cc60">A Bar Chart</h3>
<div class="outline-text-3" id="text-org8b0cc60">
<p>Once we have a chart object we tell altair that we want it to be a bar chart using the <code>mark_bar</code> method.</p>
<div class="highlight">
<pre><span></span><span class="n">bar_chart</span> <span class="o">=</span> <span class="n">chart</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">bar_chart</span><span class="p">))</span>
</pre></div>
<pre class="example">
&lt;class 'altair.vegalite.v5.api.Chart'&gt;
</pre>
<p>The <code>mark_</code> methods are defined in the <code>MarkMethodMixin</code> class (a parent of <code>Chart</code>) which is defined in <code>altair.vegalite.v5.schema.mixins</code> module.</p>
<p><img alt="MarkMixin Class" src="posts/introduction-to-altair-countries-per-year/mark-mixin.png"></p>
<p>Looking in the <code>mark_bar</code> method, there's a lot of arguments you could pass to it, but fundamentally all it's really doing is making a copy of itself, setting the <code>mark</code> attribute to <code>bar</code> and then retu+rning the copy.</p>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"Original Chart mark: '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">mark</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Bar Chart mark: '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bar_chart</span><span class="o">.</span><span class="n">mark</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">bar_chart</span><span class="p">)</span><span class="o">.</span><span class="n">to_not</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">chart</span><span class="p">))</span>
</pre></div>
<pre class="example">
Original Chart mark: 'Undefined'
Bar Chart mark: 'bar'
</pre></div>
</div>
<div class="outline-3" id="outline-container-orge1b2303">
<h3 id="orge1b2303">SchemaBase</h3>
<div class="outline-text-3" id="text-orge1b2303">
<p><code>altair.utils.schemapi</code>.</p>
<p><img alt="nil" src="posts/introduction-to-altair-countries-per-year/schema-base.png"></p>
<p>There are many more methods in <code>altair.utils.schemapi.SchemaBase</code> but I'm highlighting <code>copy</code> here because it gets used quite a bit by the other classes but is defined in this somewhat obscure place. The behavior is what you'd expect so I don't see a need to go over it, but it's one of those mystery methods that just pops up when you use deep inheritance like this that makes you wonder what's going on so I'll document it here, for now.</p>
</div>
<div class="outline-4" id="outline-container-orgc65ce1e">
<h4 id="orgc65ce1e">TopLevelUnitSpec</h4>
<div class="outline-text-4" id="text-orgc65ce1e">
<p>If you look at the parents of the <code>Chart</code> you might notice that it doesn't have the <code>SchemaBase</code> as one of its parents. So how does it end up with the <code>copy</code> method? Well, it does have the <code>core.TopLevelUnitSpec</code> as one of its parents and that in turn (eventually) inherits from the <code>SchemaBase</code>.</p>
<p><img alt="nil" src="posts/introduction-to-altair-countries-per-year/top-level-unit-spec.png"></p>
<p>I didn't put in the modules for the <code>core</code> classes since they are fairly deep.</p>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org1599340">
<h3 id="org1599340">Encoded</h3>
<div class="outline-text-3" id="text-org1599340">
<p>The <code>encode</code> method is where we tell <code>altair</code> which columns match which parts of the chart. In this case we're only setting the <i>x</i> and <i>y</i> axes.</p>
<div class="highlight">
<pre><span></span><span class="n">encoded</span> <span class="o">=</span> <span class="n">bar_chart</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"</span><span class="si">{}</span><span class="s2">:N"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Column</span><span class="o">.</span><span class="n">year</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"count"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">encoded</span><span class="p">))</span>
</pre></div>
<pre class="example">
&lt;class 'altair.vegalite.v5.api.Chart'&gt;
</pre></div>
<div class="outline-4" id="outline-container-org9fccd14">
<h4 id="org9fccd14">_EncodingMixin</h4>
<div class="outline-text-4" id="text-org9fccd14">
<p>The <code>encode</code> method is defined in the <code>_EncodingMixin</code> class, one of the <code>Chart</code>'s parents.</p>
<p><img alt="nil" src="posts/introduction-to-altair-countries-per-year/encoding-mixin.png"></p>
<p>The <code>encoding</code> method takes in whatever combination of positional and keyword arguments you pass into it and then:</p>
<ul class="org-ul">
<li>copies the Chart</li>
<li>updates the chart's <code>encoding</code> attribute</li>
<li>sets the copy's <code>encoding</code> attribute to an instance of the <code>altair.vegalite.v5.schema.FacetedEncoding</code> class.</li>
<li>returns the copy</li>
</ul>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">encoded</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
</pre></div>
<pre class="example">
FacetedEncoding({
  x: X({
    shorthand: 'year:N'
  }),
  y: Y({
    shorthand: 'count'
  })
})
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgaec6ecb">
<h3 id="orgaec6ecb">Properties</h3>
<div class="outline-text-3" id="text-orgaec6ecb">
<div class="highlight">
<pre><span></span><span class="n">propertied</span> <span class="o">=</span> <span class="n">encoded</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="n">HEIGHT</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">WIDTH</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">propertied</span><span class="p">))</span>
</pre></div>
<pre class="example">
&lt;class 'altair.vegalite.v5.api.Chart'&gt;
</pre>
<p><img alt="nil" src="posts/introduction-to-altair-countries-per-year/top-level-mixin.png"></p>
<blockquote>
<p><b>Note:</b> This is a huge class with more methods than I'm showing here. The only ones we've encountered so far are <code>to_dict</code>, <code>save</code> and <code>properties</code>. I used <code>to_dict</code> to show that the chart has all the data from the pandas DataFrame and <code>save</code> is buried in the code that saves the chart to display it in this post - <code>properties</code> is the only one we're really interested in here.</p>
</blockquote>
<p>The first thing to note about the <code>properties</code> method is that it doesn't define any arguments, it takes in any keyword arguments (and only keyword arguments, no positional arguments) and values for the arguments. Then:</p>
<ul class="org-ul">
<li>it makes a copy of the chart</li>
<li>validates the arguments (unless the argument is the <code>data</code>)</li>
<li>sets the arguments as attributes of the copy.</li>
<li>returns the copy</li>
</ul>
<p>Since we passed in <code>height</code> and <code>width</code> to the <code>properties</code> method, we get back a copy of our bar chart with the <code>height</code> and <code>width</code> set on the copy (as well as the "mark" which we set earlier with <code>mark_bar</code>).</p>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">propertied</span><span class="o">.</span><span class="n">mark</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">propertied</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">propertied</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">propertied</span><span class="o">.</span><span class="n">mark</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="s2">"bar"</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">propertied</span><span class="o">.</span><span class="n">width</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">WIDTH</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">propertied</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">HEIGHT</span><span class="p">))</span>
</pre></div>
<pre class="example">
bar
800
600
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-orgb58ef49">
<h2 id="orgb58ef49">HVPlot</h2>
</div>
<div class="outline-2" id="outline-container-org2c598f4">
<h2 id="org2c598f4">Links</h2>
<div class="outline-text-2" id="text-org2c598f4"></div>
<div class="outline-3" id="outline-container-org61fdbb5">
<h3 id="org61fdbb5">The Posts In This Series</h3>
<div class="outline-text-3" id="text-org61fdbb5">
<ul class="org-ul">
<li><a href="posts/introduction-to-altair/index.html">Starting Post</a></li>
</ul>
</div>
</div>
<div class="outline-3" id="outline-container-org0476e77">
<h3 id="org0476e77">Tutorial Sources</h3>
<div class="outline-text-3" id="text-org0476e77">
<ul class="org-ul">
<li><a href="https://www.coursera.org/learn/fundamentals-of-data-visualization/home/week/1"><i>Fundamentals of Visualization with Dr. Danielle Albers Szafir</i></a>: Coursera course where the original tutorial came from.</li>
<li><a href="https://infovis.fh-potsdam.de/tutorials/">InfoVis Course from Marian Dork</a>: Iniversity of Applied Sciences Potsdam that the Coursera course cites as the source for their tutorial.</li>
</ul>
</div>
</div>
<div class="outline-3" id="outline-container-org519e30c">
<h3 id="org519e30c">The Data</h3>
<div class="outline-text-3" id="text-org519e30c">
<ul class="org-ul">
<li>World Happiness Report Dataset [Internet]. [cited 2023 Dec 11]. Available from: <a href="https://www.kaggle.com/datasets/unsdsn/world-happiness">https://www.kaggle.com/datasets/unsdsn/world-happiness</a></li>
<li>Inc G. Gallup.com. 2009 [cited 2023 Dec 11]. Understanding How Gallup Uses the Cantril Scale. Available from: <a href="https://news.gallup.com/poll/122453/Understanding-Gallup-Uses-Cantril-Scale.aspx">https://news.gallup.com/poll/122453/Understanding-Gallup-Uses-Cantril-Scale.aspx</a></li>
<li>World Happiness Report [Internet]. 2023 [cited 2023 Dec 11]. Available from: <a href="https://worldhappiness.report/">https://worldhappiness.report/</a></li>
</ul>
</div>
</div>
<div class="outline-3" id="outline-container-orgc4233da">
<h3 id="orgc4233da">Altair</h3>
<div class="outline-text-3" id="text-orgc4233da">
<ul class="org-ul">
<li>Layered and Multi-View Charts â€” Vega-Altair 5.2.0 documentation [Internet]. [cited 2023 Dec 12]. Available from: <a href="https://altair-viz.github.io/user_guide/compound_charts.html">https://altair-viz.github.io/user_guide/compound_charts.html</a></li>
<li>Large Datasets â€” Vega-Altair 5.2.0 documentation [Internet]. [cited 2024 Mar 8]. Available from: <a href="https://altair-viz.github.io/user_guide/large_datasets.html">https://altair-viz.github.io/user_guide/large_datasets.html</a></li>
</ul>
</div>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/introduction-to-altair/index.html">Introduction To Altair</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/introduction-to-altair/index.html" rel="bookmark"><time class="published dt-published" datetime="2024-01-29T19:52:49-08:00" itemprop="datePublished" title="2024-01-29 19:52">2024-01-29 19:52</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/introduction-to-altair/index.html#orga5f1238">Posts</a></li>
<li><a href="posts/introduction-to-altair/index.html#orgd3ca120">Setup</a></li>
<li><a href="posts/introduction-to-altair/index.html#org375ca3b">The Data</a>
<ul>
<li><a href="posts/introduction-to-altair/index.html#orgf65cda5">Creating a Chart</a>
<ul>
<li><a href="posts/introduction-to-altair/index.html#orgeadfeac">TopLevelUnitSpec</a></li>
<li><a href="posts/introduction-to-altair/index.html#org094d23b">SchemaBase</a></li>
<li><a href="posts/introduction-to-altair/index.html#orgd252d48">_EncodingMixin</a></li>
</ul>
</li>
<li><a href="posts/introduction-to-altair/index.html#org9523f3e">Making It a Bar Chart</a></li>
<li><a href="posts/introduction-to-altair/index.html#org03939ca">Year</a></li>
<li><a href="posts/introduction-to-altair/index.html#org4ec804a">Life Ladder</a>
<ul>
<li><a href="posts/introduction-to-altair/index.html#orgd80cca0">By Year</a></li>
<li><a href="posts/introduction-to-altair/index.html#org3d6161a">The Most Recent Year (2022)</a></li>
</ul>
</li>
<li><a href="posts/introduction-to-altair/index.html#org19df080">GDP</a></li>
<li><a href="posts/introduction-to-altair/index.html#org7123d88">With Generosity</a></li>
</ul>
</li>
<li><a href="posts/introduction-to-altair/index.html#org457b02b">Links</a>
<ul>
<li><a href="posts/introduction-to-altair/index.html#org4700c4e">Tutorial Sources</a></li>
<li><a href="posts/introduction-to-altair/index.html#org8bf0722">The Data</a></li>
<li><a href="posts/introduction-to-altair/index.html#org9608b67">Altair</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orga5f1238">
<h2 id="orga5f1238">Posts</h2>
<div class="outline-text-2" id="text-orga5f1238">
<ul class="org-ul">
<li><a href="posts/introduction-to-altair-countries-per-year/index.html">Countries Per Year</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgd3ca120">
<h2 id="orgd3ca120">Setup</h2>
<div class="outline-text-2" id="text-orgd3ca120">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">be_true</span><span class="p">,</span> <span class="n">expect</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="kn">import</span> <span class="nn">altair</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># monkey</span>
<span class="kn">from</span> <span class="nn">graeae.visualization.altair_helpers</span> <span class="kn">import</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">save_chart</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"introduction-to-altair"</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="n">output_path</span><span class="p">(</span><span class="n">SLUG</span><span class="p">)</span>

<span class="n">HEIGHT</span><span class="p">,</span> <span class="n">WIDTH</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">800</span>
<span class="n">SAVE_IT</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">save_chart</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">HEIGHT</span> <span class="o">+</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">TABLE</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">tabulate</span><span class="p">,</span>
                        <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">,</span>
                        <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">,</span>
                        <span class="n">showindex</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org375ca3b">
<h2 id="org375ca3b">The Data</h2>
<div class="outline-text-2" id="text-org375ca3b">
<div class="highlight">
<pre><span></span><span class="n">load_dotenv</span><span class="p">(</span><span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">table_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"WORLD_HAPPINESS_TABLE"</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">table_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>

<span class="n">table</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">table_path</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
<pre class="example">
(2199, 11)
</pre>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">column_printer</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">(</span><span class="s2">"Column"</span><span class="p">,</span> <span class="s2">"Type"</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span>
        <span class="p">((</span><span class="n">column</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
         <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span>
        <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">))</span>
    <span class="k">return</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">column_printer</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Column</th>
<th class="org-left" scope="col">Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Country name</td>
<td class="org-left">object</td>
</tr>
<tr>
<td class="org-left">year</td>
<td class="org-left">int64</td>
</tr>
<tr>
<td class="org-left">Life Ladder</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Log GDP per capita</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Social support</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Healthy life expectancy at birth</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Freedom to make life choices</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Generosity</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Perceptions of corruption</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Positive affect</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Negative affect</td>
<td class="org-left">float64</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="k">class</span> <span class="nc">Column</span><span class="p">:</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">country</span> <span class="o">=</span> <span class="s2">"Country name"</span>
    <span class="n">year</span> <span class="o">=</span> <span class="s2">"year"</span>
    <span class="n">happiness</span> <span class="o">=</span> <span class="s2">"Life Ladder"</span>
    <span class="n">gdp</span> <span class="o">=</span> <span class="s2">"Log GDP per capita"</span>
    <span class="n">generosity</span> <span class="o">=</span> <span class="s2">"Generosity"</span>
</pre></div>
</div>
<div class="outline-3" id="outline-container-orgf65cda5">
<h3 id="orgf65cda5">Creating a Chart</h3>
<div class="outline-text-3" id="text-orgf65cda5">
<div class="highlight">
<pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">chart</span><span class="p">))</span>
</pre></div>
<pre class="example">
&lt;class 'altair.vegalite.v5.api.Chart'&gt;
</pre>
<p>The <code>Chart</code> class is defined in <code>altair.vegalite.v5.api</code>. This is its docstring description:</p>
<blockquote>
<p>Create a basic Altair/Vega-Lite chart.</p>
<p>Although it is possible to set all Chart properties as constructor attributes, it is more idiomatic to use methods such as <code>mark_point()</code>, <code>encode()</code>, <code>transform_filter()</code>, <code>properties()</code>, etc. See Altair's documentation for details and examples: <a href="http://altair-viz.github.io/">http://altair-viz.github.io/</a>.</p>
</blockquote>
<p>The attributes set by the <code>Chart</code> class' constructor (as opposed to being passed to its parent classes) are:</p>
<ul class="org-ul">
<li>data</li>
<li>encoding</li>
<li>mark</li>
<li>width</li>
<li>height</li>
</ul>
<p>By default they're set to <code>Undefined</code> which is an altair-defined object (see <code>altair.utils.schemapi</code>), and as noted, you don't normally set the attributes using the constructor (other than <code>data</code> which isn't mentioned in the docstring but appears to be passed to the <code>Chart</code> constructor by convention).</p>
<p><img alt="Chart Class" src="posts/introduction-to-altair/chart.png"></p>
<p>The methods take arguments, but I believe <code>interactive</code> (which I haven't seen called with arguments) is the only method that I'll be using - all the other methods you use belong to parent classes.</p>
</div>
<div class="outline-4" id="outline-container-orgeadfeac">
<h4 id="orgeadfeac">TopLevelUnitSpec</h4>
<div class="outline-text-4" id="text-orgeadfeac">
<p><img alt="nil" src="posts/introduction-to-altair/top-level-unit-spec.png"></p>
<p>Only the top-most parent (<code>SchemaBase</code>) has a method of interest here.</p>
</div>
</div>
<div class="outline-4" id="outline-container-org094d23b">
<h4 id="org094d23b">SchemaBase</h4>
<div class="outline-text-4" id="text-org094d23b">
<p><img alt="nil" src="posts/introduction-to-altair/schema-base.png"></p>
<p>There are many more methods in <code>altair.utils.schemapi.SchemaBase</code> but I'm highlighting <code>copy</code> here because it gets used quite a bit by the other classes but is defined in this somewhat obscure place. The behavior is what you'd expect so I don't see a need to go over it, but it's one of those mystery methods that just pops up when you use deep inheritance like this that makes you wonder what's going on so I'll document it here, for now.</p>
<p><b>note:</b> The details of the code probably shouldn't go into the introduction-introduction. Maybe put this stuff further down or in another post.</p>
</div>
</div>
<div class="outline-4" id="outline-container-orgd252d48">
<h4 id="orgd252d48">_EncodingMixin</h4>
<div class="outline-text-4" id="text-orgd252d48">
<p><img alt="nil" src="posts/introduction-to-altair/encoding-mixin.png"></p>
<p>The <code>encoding</code> method takes in whatever combination of positional and keyword arguments you pass into it and uses them along with the values that are already set in the Chart's <code>encoding</code> attribute to update the <code>encoding</code> before returning the chart (a copy so the original chart isn't changed).</p>
<p>The <code>encoding</code> attribute is an instance of the <code>altair.vegalite.v5.schema.FacetedEncoding</code> class.</p>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org9523f3e">
<h3 id="org9523f3e">Making It a Bar Chart</h3>
<div class="outline-text-3" id="text-org9523f3e">
<div class="highlight">
<pre><span></span><span class="n">bar_chart</span> <span class="o">=</span> <span class="n">chart</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">bar_chart</span><span class="p">))</span>
</pre></div>
<pre class="example">
&lt;class 'altair.vegalite.v5.api.Chart'&gt;
</pre>
<p><img alt="MarkMixin Class" src="posts/introduction-to-altair/mark-mixin.png"></p>
<p>Looking in the <code>mark_bar</code> method, there's a lot of arguments you could pass to it, but fundamentally all it's really doing is setting the <code>mark</code> attribute to <code>bar</code>.</p>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"Chart Mark: '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">mark</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Bar Chart Mark: '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bar_chart</span><span class="o">.</span><span class="n">mark</span><span class="p">))</span>
</pre></div>
<pre class="example">
Chart Mark: 'Undefined'
Bart Chart Mark: 'bar'
</pre></div>
</div>
<div class="outline-3" id="outline-container-org03939ca">
<h3 id="org03939ca">Year</h3>
<div class="outline-text-3" id="text-org03939ca">
<div class="highlight">
<pre><span></span><span class="n">year_counts</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">"year"</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">year_counts</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">year_counts</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">year_counts</span> <span class="o">=</span> <span class="n">year_counts</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">year_counts</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">year_counts</span><span class="p">,</span> <span class="n">showindex</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">&nbsp;</th>
<th class="org-right" scope="col">2005</th>
<th class="org-right" scope="col">2006</th>
<th class="org-right" scope="col">2007</th>
<th class="org-right" scope="col">2008</th>
<th class="org-right" scope="col">2009</th>
<th class="org-right" scope="col">2010</th>
<th class="org-right" scope="col">2011</th>
<th class="org-right" scope="col">2012</th>
<th class="org-right" scope="col">2013</th>
<th class="org-right" scope="col">2014</th>
<th class="org-right" scope="col">2015</th>
<th class="org-right" scope="col">2016</th>
<th class="org-right" scope="col">2017</th>
<th class="org-right" scope="col">2018</th>
<th class="org-right" scope="col">2019</th>
<th class="org-right" scope="col">2020</th>
<th class="org-right" scope="col">2021</th>
<th class="org-right" scope="col">2022</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">count</td>
<td class="org-right">27</td>
<td class="org-right">89</td>
<td class="org-right">102</td>
<td class="org-right">110</td>
<td class="org-right">114</td>
<td class="org-right">124</td>
<td class="org-right">146</td>
<td class="org-right">141</td>
<td class="org-right">136</td>
<td class="org-right">144</td>
<td class="org-right">142</td>
<td class="org-right">141</td>
<td class="org-right">147</td>
<td class="org-right">141</td>
<td class="org-right">143</td>
<td class="org-right">116</td>
<td class="org-right">122</td>
<td class="org-right">114</td>
</tr>
</tbody>
</table>
<p>Now as a bar-chart.</p>
<div class="highlight">
<pre><span></span><span class="n">year_chart</span> <span class="o">=</span> <span class="n">bar_chart</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"year:N"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"count()"</span><span class="p">)</span>

<span class="n">year_chart</span> <span class="o">=</span> <span class="n">year_chart</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="n">HEIGHT</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">WIDTH</span><span class="p">)</span>

<span class="n">SAVE_IT</span><span class="p">(</span><span class="n">year_chart</span><span class="p">,</span> <span class="s2">"year-counts-bar-chart"</span><span class="p">)</span>
</pre></div>
<object data="posts/introduction-to-altair/year-counts-bar-chart.html" height="700" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p><img alt="nil" src="posts/introduction-to-altair/top-level-mixin.png"></p>
<p>This method makes a copy of the class, validates the arguments and then sets the properties on itself. The arguments are based on the JSON Schema passed to vega-lite.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org4ec804a">
<h3 id="org4ec804a">Life Ladder</h3>
<div class="outline-text-3" id="text-org4ec804a"></div>
<div class="outline-4" id="outline-container-orgd80cca0">
<h4 id="orgd80cca0">By Year</h4>
<div class="outline-text-4" id="text-orgd80cca0">
<div class="highlight">
<pre><span></span><span class="n">boxplot</span> <span class="o">=</span> <span class="n">chart</span><span class="o">.</span><span class="n">mark_boxplot</span><span class="p">(</span><span class="n">extent</span><span class="o">=</span><span class="s2">"min-max"</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"</span><span class="si">{}</span><span class="s2">:O"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Column</span><span class="o">.</span><span class="n">year</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">Column</span><span class="o">.</span><span class="n">happiness</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="n">HEIGHT</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">WIDTH</span><span class="p">)</span>

<span class="n">SAVE_IT</span><span class="p">(</span><span class="n">boxplot</span><span class="p">,</span> <span class="s2">"happiness-year-boxplots"</span><span class="p">)</span>
</pre></div>
<object data="posts/introduction-to-altair/happiness-year-boxplots.html" height="700" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
<div class="outline-4" id="outline-container-org3d6161a">
<h4 id="org3d6161a">The Most Recent Year (2022)</h4>
<div class="outline-text-4" id="text-org3d6161a">
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</pre></div>
<pre class="example">
int64
</pre>
<div class="highlight">
<pre><span></span><span class="n">data_2022</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">table</span><span class="o">.</span><span class="n">year</span><span class="o">==</span><span class="mi">2022</span><span class="p">]</span>
<span class="n">chart_2022</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data_2022</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">height</span><span class="o">=</span><span class="n">HEIGHT</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">WIDTH</span><span class="p">)</span>

<span class="n">bar_chart_2022</span> <span class="o">=</span> <span class="n">chart_2022</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span>

<span class="n">ladder_chart</span> <span class="o">=</span> <span class="n">bar_chart_2022</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="n">Column</span><span class="o">.</span><span class="n">happiness</span><span class="p">,</span> <span class="nb">bin</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"count()"</span>
<span class="p">)</span>

<span class="n">SAVE_IT</span><span class="p">(</span><span class="n">ladder_chart</span><span class="p">,</span> <span class="s2">"ladder-histogram"</span><span class="p">)</span>
</pre></div>
<object data="posts/introduction-to-altair/ladder-histogram.html" height="700" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
</div>
<div class="outline-3" id="outline-container-org19df080">
<h3 id="org19df080">GDP</h3>
<div class="outline-text-3" id="text-org19df080">
<div class="highlight">
<pre><span></span><span class="n">scatter</span> <span class="o">=</span> <span class="n">chart_2022</span><span class="o">.</span><span class="n">mark_circle</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">scatter</span><span class="o">.</span><span class="n">mark</span><span class="p">)</span>
</pre></div>
<pre class="example">
circle
</pre>
<div class="highlight">
<pre><span></span><span class="n">gdp_scatter</span> <span class="o">=</span> <span class="n">scatter</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">Column</span><span class="o">.</span><span class="n">gdp</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">Column</span><span class="o">.</span><span class="n">happiness</span>
<span class="p">)</span>

<span class="n">SAVE_IT</span><span class="p">(</span><span class="n">gdp_scatter</span><span class="p">,</span> <span class="s2">"gdp-vs-happiness"</span><span class="p">)</span>
</pre></div>
<object data="posts/introduction-to-altair/gdp-vs-happiness.html" height="700" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
<div class="outline-3" id="outline-container-org7123d88">
<h3 id="org7123d88">With Generosity</h3>
<div class="outline-text-3" id="text-org7123d88">
<div class="highlight">
<pre><span></span><span class="n">gdp_generosity</span> <span class="o">=</span> <span class="n">scatter</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">Column</span><span class="o">.</span><span class="n">happiness</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">Column</span><span class="o">.</span><span class="n">generosity</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">Column</span><span class="o">.</span><span class="n">gdp</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">Column</span><span class="o">.</span><span class="n">country</span><span class="p">,</span> <span class="n">Column</span><span class="o">.</span><span class="n">happiness</span><span class="p">,</span> <span class="n">Column</span><span class="o">.</span><span class="n">gdp</span><span class="p">,</span>
             <span class="n">Column</span><span class="o">.</span><span class="n">generosity</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">SAVE_IT</span><span class="p">(</span><span class="n">gdp_generosity</span><span class="p">,</span> <span class="s2">"gdp-and-generosity"</span><span class="p">)</span>
</pre></div>
<object data="posts/introduction-to-altair/gdp-and-generosity.html" height="700" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
</div>
<div class="outline-2" id="outline-container-org457b02b">
<h2 id="org457b02b">Links</h2>
<div class="outline-text-2" id="text-org457b02b"></div>
<div class="outline-3" id="outline-container-org4700c4e">
<h3 id="org4700c4e">Tutorial Sources</h3>
<div class="outline-text-3" id="text-org4700c4e">
<ul class="org-ul">
<li><a href="https://www.coursera.org/learn/fundamentals-of-data-visualization/home/week/1"><i>Fundamentals of Visualization with Dr. Danielle Albers Szafir</i></a>: Coursera course where the original tutorial came from.</li>
<li><a href="https://infovis.fh-potsdam.de/tutorials/">InfoVis Course from Marian Dork</a>: Iniversity of Applied Sciences Potsdam that the Coursera course cites as the source for their tutorial.</li>
</ul>
</div>
</div>
<div class="outline-3" id="outline-container-org8bf0722">
<h3 id="org8bf0722">The Data</h3>
<div class="outline-text-3" id="text-org8bf0722">
<ul class="org-ul">
<li>World Happiness Report Dataset [Internet]. [cited 2023 Dec 11]. Available from: <a href="https://www.kaggle.com/datasets/unsdsn/world-happiness">https://www.kaggle.com/datasets/unsdsn/world-happiness</a></li>
<li>Inc G. Gallup.com. 2009 [cited 2023 Dec 11]. Understanding How Gallup Uses the Cantril Scale. Available from: <a href="https://news.gallup.com/poll/122453/Understanding-Gallup-Uses-Cantril-Scale.aspx">https://news.gallup.com/poll/122453/Understanding-Gallup-Uses-Cantril-Scale.aspx</a></li>
<li>World Happiness Report [Internet]. 2023 [cited 2023 Dec 11]. Available from: <a href="https://worldhappiness.report/">https://worldhappiness.report/</a></li>
</ul>
</div>
</div>
<div class="outline-3" id="outline-container-org9608b67">
<h3 id="org9608b67">Altair</h3>
<div class="outline-text-3" id="text-org9608b67">
<ul class="org-ul">
<li>Layered and Multi-View Charts â€” Vega-Altair 5.2.0 documentation [Internet]. [cited 2023 Dec 12]. Available from: <a href="https://altair-viz.github.io/user_guide/compound_charts.html">https://altair-viz.github.io/user_guide/compound_charts.html</a></li>
</ul>
</div>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/world-happiness-data/index.html">World Happiness Data</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/world-happiness-data/index.html" rel="bookmark"><time class="published dt-published" datetime="2023-12-14T14:58:39-08:00" itemprop="datePublished" title="2023-12-14 14:58">2023-12-14 14:58</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/world-happiness-data/index.html#orgf3c1eb2">Imports</a></li>
<li><a href="posts/world-happiness-data/index.html#orgdb55277">Country</a>
<ul>
<li><a href="posts/world-happiness-data/index.html#orgfe4bf63">The Table vs Kaggle</a></li>
<li><a href="posts/world-happiness-data/index.html#orgfbb045a">Figure Data</a></li>
<li><a href="posts/world-happiness-data/index.html#orgde0544e">The Figure Countries</a></li>
</ul>
</li>
<li><a href="posts/world-happiness-data/index.html#org968dcf0">Links</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgf3c1eb2">
<h2 id="orgf3c1eb2">Imports</h2>
<div class="outline-text-2" id="text-orgf3c1eb2">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">be_true</span><span class="p">,</span> <span class="n">expect</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="kn">import</span> <span class="nn">pandas</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">TABLE</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">tabulate</span><span class="p">,</span>
                        <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">,</span>
                        <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">,</span>
                        <span class="n">showindex</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">load_dotenv</span><span class="p">(</span><span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">kaggle_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"KAGGLE_WORLD_HAPPINESS"</span><span class="p">))</span>
<span class="n">figure_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"WORLD_HAPPINESS_FIGURE"</span><span class="p">))</span>
<span class="n">table_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"WORLD_HAPPINESS_TABLE"</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">kaggle_path</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">figure_path</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">table_path</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">kaggle_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">table_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">figure_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
</pre></div>
<pre class="example">
/home/bravo/data/datasets/kaggle/world-happiness-report/WHR_2016.csv
/home/bravo/data/datasets/world-happiness-data/world-happiness-report-2023-data-for-figure-2.1.csv
/home/bravo/data/datasets/world-happiness-data/world-happiness-report-2023-data-for-table-2.1.csv
</pre>
<div class="highlight">
<pre><span></span><span class="n">kaggle</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">kaggle_path</span><span class="p">)</span>
<span class="n">figure</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">figure_path</span><span class="p">)</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">table_path</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">kaggle</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">figure</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
<pre class="example">
(157, 13)
(137, 19)
(2199, 11)
</pre>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">column_printer</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">(</span><span class="s2">"Column"</span><span class="p">,</span> <span class="s2">"Type"</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span>
        <span class="p">((</span><span class="n">column</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
         <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span>
        <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">))</span>
    <span class="k">return</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">column_printer</span><span class="p">(</span><span class="n">kaggle</span><span class="p">)</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Column</th>
<th class="org-left" scope="col">Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Country</td>
<td class="org-left">object</td>
</tr>
<tr>
<td class="org-left">Region</td>
<td class="org-left">object</td>
</tr>
<tr>
<td class="org-left">Happiness Rank</td>
<td class="org-left">int64</td>
</tr>
<tr>
<td class="org-left">Happiness Score</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Lower Confidence Interval</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Upper Confidence Interval</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Economy (GDP per Capita)</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Family</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Health (Life Expectancy)</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Freedom</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Trust (Government Corruption)</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Generosity</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Dystopia Residual</td>
<td class="org-left">float64</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="n">column_printer</span><span class="p">(</span><span class="n">figure</span><span class="p">)</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Column</th>
<th class="org-left" scope="col">Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Country name</td>
<td class="org-left">object</td>
</tr>
<tr>
<td class="org-left">Ladder score</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Standard error of ladder score</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">upperwhisker</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">lowerwhisker</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Logged GDP per capita</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Social support</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Healthy life expectancy</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Freedom to make life choices</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Generosity</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Perceptions of corruption</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Ladder score in Dystopia</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Explained by: Log GDP per capita</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Explained by: Social support</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Explained by: Healthy life expectancy</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Explained by: Freedom to make life choices</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Explained by: Generosity</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Explained by: Perceptions of corruption</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Dystopia + residual</td>
<td class="org-left">float64</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="n">column_printer</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Column</th>
<th class="org-left" scope="col">Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Country name</td>
<td class="org-left">object</td>
</tr>
<tr>
<td class="org-left">year</td>
<td class="org-left">int64</td>
</tr>
<tr>
<td class="org-left">Life Ladder</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Log GDP per capita</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Social support</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Healthy life expectancy at birth</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Freedom to make life choices</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Generosity</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Perceptions of corruption</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Positive affect</td>
<td class="org-left">float64</td>
</tr>
<tr>
<td class="org-left">Negative affect</td>
<td class="org-left">float64</td>
</tr>
</tbody>
</table>
<p>It's hard to say exactly but it looks like <i>Region</i> and <i>Happiness Rank</i> were added by whoever created the <code>kaggle</code> dataset and it isn't clear what the <i>Family</i> column ties into. The only column in the UN data not matched is <i>Social Support</i> but that doesn't seem to have the right value range:</p>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">kaggle</span><span class="o">.</span><span class="n">Family</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">figure</span><span class="p">[</span><span class="s2">"Social support"</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</pre></div>
<pre class="example">
1.18326
0.983
</pre>
<p>We're not going to use <i>Family</i> anyway, so I'll just ignore it.</p>
</div>
</div>
<div class="outline-2" id="outline-container-orgdb55277">
<h2 id="orgdb55277">Country</h2>
<div class="outline-text-2" id="text-orgdb55277">
<div class="highlight">
<pre><span></span><span class="n">COUNTRY</span> <span class="o">=</span> <span class="s2">"Country name"</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">kaggle</span><span class="o">.</span><span class="n">Country</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">COUNTRY</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">figure</span><span class="p">[</span><span class="n">COUNTRY</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</pre></div>
<pre class="example">
Afghanistan
Afghanistan
Afghanistan
</pre>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kaggle</span><span class="o">.</span><span class="n">Country</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">COUNTRY</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">figure</span><span class="p">[</span><span class="n">COUNTRY</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
</pre></div>
<pre class="example">
157
165
137
</pre>
<p>The figure data has quite a bit fewer entries than the table data. I'll have to look into that as I was planning to merge them, but I'll have to figure out why those twenty-eight countries are missing.</p>
</div>
<div class="outline-3" id="outline-container-orgfe4bf63">
<h3 id="orgfe4bf63">The Table vs Kaggle</h3>
<div class="outline-text-3" id="text-orgfe4bf63">
<div class="highlight">
<pre><span></span><span class="n">k_countries</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">kaggle</span><span class="o">.</span><span class="n">Country</span><span class="p">)</span>
<span class="n">t_countries</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">COUNTRY</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">t_countries</span> <span class="o">-</span> <span class="n">k_countries</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">k_countries</span> <span class="o">-</span> <span class="n">t_countries</span><span class="p">))</span>
</pre></div>
<pre class="example">
['Central African Republic', 'Cuba', 'Czechia', 'Djibouti', 'Eswatini', 'Gambia', 'Guyana', 'Hong Kong S.A.R. of China', 'Lesotho', 'Maldives', 'Mozambique', 'North Macedonia', 'Oman', 'Somaliland region', 'State of Palestine', 'Taiwan Province of China', 'Turkiye']

['Czech Republic', 'Hong Kong', 'Macedonia', 'North Cyprus', 'Palestinian Territories', 'Puerto Rico', 'Somaliland Region', 'Taiwan', 'Turkey']
</pre>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Kaggle</th>
<th class="org-left" scope="col">World Happiness Report</th>
<th class="org-left" scope="col">Wikipedia</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">- Missing -</td>
<td class="org-left">Central African Republic</td>
<td class="org-left"><a href="https://en.wikipedia.org/wiki/Central_African_Republic?useskin=vector">Central African Republic</a></td>
</tr>
<tr>
<td class="org-left">- Missing -</td>
<td class="org-left">Cuba</td>
<td class="org-left"><a href="https://en.wikipedia.org/wiki/Cuba?useskin=vector">Cuba</a></td>
</tr>
<tr>
<td class="org-left">Czech Republic</td>
<td class="org-left">Czechia</td>
<td class="org-left"><a href="https://en.wikipedia.org/wiki/Czech_Republic?useskin=vector">Czech Republic</a></td>
</tr>
<tr>
<td class="org-left">- Missing -</td>
<td class="org-left">Djibouti</td>
<td class="org-left"><a href="https://en.wikipedia.org/wiki/Djibouti?useskin=vector">Djibouti</a></td>
</tr>
<tr>
<td class="org-left">- Missing -</td>
<td class="org-left">Eswatini</td>
<td class="org-left"><a href="https://en.wikipedia.org/wiki/Eswatini?useskin=vector">Eswatini</a></td>
</tr>
<tr>
<td class="org-left">- Missing -</td>
<td class="org-left">Gambia</td>
<td class="org-left"><a href="https://en.wikipedia.org/wiki/The_Gambia?useskin=vector">The Gambia</a></td>
</tr>
<tr>
<td class="org-left">- Missing -</td>
<td class="org-left">Guyana</td>
<td class="org-left"><a href="https://en.wikipedia.org/wiki/Guyana?useskin=vector">Guyana</a></td>
</tr>
<tr>
<td class="org-left">Hong Kong</td>
<td class="org-left">Hong Kong S.A.R. of China</td>
<td class="org-left"><a href="https://en.wikipedia.org/wiki/Hong_Kong?useskin=vector">Hong Kong</a></td>
</tr>
<tr>
<td class="org-left">- Missing -</td>
<td class="org-left">Lesotho</td>
<td class="org-left"><a href="https://en.wikipedia.org/wiki/Lesotho?useskin=vector">Lesotho</a></td>
</tr>
<tr>
<td class="org-left">Macedonia</td>
<td class="org-left">North Macedonia</td>
<td class="org-left"><a href="https://en.wikipedia.org/wiki/North_Macedonia?useskin=vector">North Macedonia</a></td>
</tr>
<tr>
<td class="org-left">- Missing -</td>
<td class="org-left">Maldives</td>
<td class="org-left"><a href="https://en.wikipedia.org/wiki/Maldives?useskin=vector">Maldives</a></td>
</tr>
<tr>
<td class="org-left">- Missing -</td>
<td class="org-left">Mozambique</td>
<td class="org-left"><a href="https://en.wikipedia.org/wiki/Mozambique?useskin=vector">Mozambique</a></td>
</tr>
<tr>
<td class="org-left">North Cyprus</td>
<td class="org-left">- Only recognized by Turkey -</td>
<td class="org-left"><a href="https://en.wikipedia.org/wiki/Northern_Cyprus?useskin=vector">Northern Cyprus</a></td>
</tr>
<tr>
<td class="org-left">- Missing -</td>
<td class="org-left">Oman</td>
<td class="org-left"><a href="https://en.wikipedia.org/wiki/Oman?useskin=vector">Oman</a></td>
</tr>
<tr>
<td class="org-left">Palestinian Territories</td>
<td class="org-left">State of Palestine</td>
<td class="org-left"><a href="https://en.wikipedia.org/wiki/State_of_Palestine?useskin=vector">State of Palestine</a>, <a href="https://en.wikipedia.org/wiki/Palestinian_territories?useskin=vector">Palestinian Territories</a></td>
</tr>
<tr>
<td class="org-left">Puerto Rico</td>
<td class="org-left">- Territory of U.S. -</td>
<td class="org-left"><a href="https://en.wikipedia.org/wiki/Puerto_Rico?useskin=vector">Puerto Rico</a></td>
</tr>
<tr>
<td class="org-left">Somaliland Region</td>
<td class="org-left">Somaliland region</td>
<td class="org-left">&nbsp;</td>
</tr>
<tr>
<td class="org-left">Taiwan</td>
<td class="org-left">Taiwan Province of China</td>
<td class="org-left"><a href="https://en.wikipedia.org/wiki/Taiwan?useskin=vector">Taiwan</a></td>
</tr>
<tr>
<td class="org-left">Turkey</td>
<td class="org-left">Turkiye</td>
<td class="org-left"><a href="https://en.wikipedia.org/wiki/Turkey?useskin=vector">Turkey</a></td>
</tr>
</tbody>
</table>
<p>I'm more interested in the World Happiness Report so I'll conform Kaggle's country names to match that and ignore the countries that it's missing.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">rename_country</span><span class="p">(</span><span class="n">names</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                   <span class="n">country_column</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="n">COUNTRY</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Rename the countries in the kaggle data</span>

<span class="sd">    Args:</span>

<span class="sd">     - names: dict mapping kaggle names to names you want</span>
<span class="sd">     - kaggle_data: the kaggle happiness data to rename countries</span>
<span class="sd">     - country_column: name to use for the country column</span>

<span class="sd">    Returns:</span>
<span class="sd">     kaggle_data with countries renamed</span>
<span class="sd">    """</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">kaggle_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">Country</span><span class="o">=</span><span class="n">country_column</span><span class="p">))</span>
    <span class="n">data</span><span class="p">[</span><span class="n">country_column</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">country_column</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">kaggle_to_world</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"Czech Republic"</span><span class="p">:</span> <span class="s2">"Czechia"</span><span class="p">,</span>
    <span class="s2">"Macedonia"</span><span class="p">:</span> <span class="s2">"North Macedonia"</span><span class="p">,</span>
    <span class="s2">"Palestinian Territories"</span><span class="p">:</span> <span class="s2">"State of Palestine"</span><span class="p">,</span>
    <span class="s2">"Turkey"</span><span class="p">:</span> <span class="s2">"Turkiye"</span>
<span class="p">}</span>

<span class="n">kaggled</span> <span class="o">=</span> <span class="n">kaggle</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">kaggled</span><span class="p">[</span><span class="s2">"Country"</span><span class="p">]</span> <span class="o">=</span> <span class="n">kaggled</span><span class="o">.</span><span class="n">Country</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">kaggle_to_world</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">kaggled</span><span class="o">.</span><span class="n">Country</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">COUNTRY</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="n">COUNTRY</span><span class="p">])</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">kaggled</span><span class="o">.</span><span class="n">Country</span><span class="p">))</span>
</pre></div>
<pre class="example">
{'Somaliland Region', 'North Cyprus', 'Taiwan', 'Hong Kong', 'Puerto Rico'}
{'Hong Kong S.A.R. of China', 'Central African Republic', 'Djibouti', 'Oman', 'Lesotho', 'Mozambique', 'Somaliland region', 'Gambia', 'Taiwan Province of China', 'Eswatini', 'Guyana', 'Cuba', 'Maldives'}
</pre>
<div class="highlight">
<pre><span></span><span class="n">world_to_kaggle</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"Hong Kong S.A.R. of China"</span><span class="p">:</span> <span class="s2">"Hong Kong"</span><span class="p">,</span>
                   <span class="s2">"Somaliland region"</span><span class="p">:</span> <span class="s2">"Somaliland Region"</span><span class="p">,</span>
                   <span class="s2">"Taiwan Province of China"</span><span class="p">:</span> <span class="s2">"Taiwan"</span><span class="p">}</span>

<span class="n">tabled</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">COUNTRY</span><span class="p">:</span> <span class="s2">"Country"</span><span class="p">})</span>
<span class="n">tabled</span><span class="p">[</span><span class="s2">"Country"</span><span class="p">]</span> <span class="o">=</span> <span class="n">tabled</span><span class="o">.</span><span class="n">Country</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">world_to_kaggle</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">kaggled</span><span class="o">.</span><span class="n">Country</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">tabled</span><span class="o">.</span><span class="n">Country</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">tabled</span><span class="o">.</span><span class="n">Country</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">kaggled</span><span class="o">.</span><span class="n">Country</span><span class="p">))</span>
</pre></div>
<pre class="example">
{'North Cyprus', 'Puerto Rico'}
{'Central African Republic', 'Djibouti', 'Oman', 'Lesotho', 'Mozambique', 'Gambia', 'Eswatini', 'Guyana', 'Cuba', 'Maldives'}
</pre></div>
</div>
<div class="outline-3" id="outline-container-orgfbb045a">
<h3 id="orgfbb045a">Figure Data</h3>
<div class="outline-text-3" id="text-orgfbb045a">
<div class="highlight">
<pre><span></span><span class="n">figured</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">COUNTRY</span><span class="p">:</span> <span class="s2">"Country"</span><span class="p">})</span>
<span class="n">figured</span><span class="p">[</span><span class="s2">"Country"</span><span class="p">]</span> <span class="o">=</span> <span class="n">figured</span><span class="o">.</span><span class="n">Country</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">world_to_kaggle</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">figured</span><span class="o">.</span><span class="n">Country</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">kaggled</span><span class="o">.</span><span class="n">Country</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">figured</span><span class="o">.</span><span class="n">Country</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">tabled</span><span class="o">.</span><span class="n">Country</span><span class="p">))</span>
</pre></div>
<pre class="example">
{'Mozambique', 'Gambia'}

set()
</pre></div>
</div>
<div class="outline-3" id="outline-container-orgde0544e">
<h3 id="orgde0544e">The Figure Countries</h3>
<div class="outline-text-3" id="text-orgde0544e">
<div class="highlight">
<pre><span></span><span class="n">f_countries</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">figure</span><span class="p">[</span><span class="n">COUNTRY</span><span class="p">])</span>
<span class="n">f_only</span> <span class="o">=</span> <span class="n">f_countries</span> <span class="o">-</span> <span class="n">t_countries</span>
<span class="n">kd_countries</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">kaggled</span><span class="p">[</span><span class="n">COUNTRY</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">f_only</span> <span class="o">-</span> <span class="n">kd_countries</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">kd_countries</span> <span class="o">-</span> <span class="n">f_countries</span><span class="p">))</span>
</pre></div>
<pre class="example">
[]

['Angola', 'Azerbaijan', 'Belarus', 'Belize', 'Bhutan', 'Burundi', 'Haiti', 'Kuwait', 'Libya', 'North Cyprus', 'Puerto Rico', 'Qatar', 'Rwanda', 'Somalia', 'Somaliland region', 'South Sudan', 'Sudan', 'Suriname', 'Syria', 'Trinidad and Tobago', 'Turkmenistan', 'Yemen']
</pre>
<p>The figure data has twenty fewer countries than the Kaggle data so it's not surprising that there's a lot left over. It doesn't look like there's any in the figure data that Kaggle doesn't have, though, which is good.</p>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">t_countries</span> <span class="o">-</span> <span class="n">f_countries</span><span class="p">))</span>
</pre></div>
<pre class="example">
['Angola', 'Azerbaijan', 'Belarus', 'Belize', 'Bhutan', 'Burundi', 'Central African Republic', 'Cuba', 'Djibouti', 'Eswatini', 'Guyana', 'Haiti', 'Kuwait', 'Lesotho', 'Libya', 'Maldives', 'Oman', 'Qatar', 'Rwanda', 'Somalia', 'Somaliland region', 'South Sudan', 'Sudan', 'Suriname', 'Syria', 'Trinidad and Tobago', 'Turkmenistan', 'Yemen']
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org968dcf0">
<h2 id="org968dcf0">Links</h2>
<div class="outline-text-2" id="text-org968dcf0">
<ul class="org-ul">
<li><a href="https://www.kaggle.com/datasets/unsdsn/world-happiness">Kaggle World Happiness Data</a>: The World Happiness Data. There are four separate CSV files available for 2015 through 2019.</li>
<li><a href="https://worldhappiness.report/">World Happiness Report</a>: The website for the World Happiness Report.</li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/bubba-sort-page-2/index.html">A Ray</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/bubba-sort-page-2/index.html" rel="bookmark"><time class="published dt-published" datetime="2023-03-24T16:57:36-07:00" itemprop="datePublished" title="2023-03-24 16:57">2023-03-24 16:57</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<p><img alt="Panel 4" src="posts/bubba-sort-page-2/bubba-004-1250.png"></p>
<p><img alt="Panel 5" src="posts/bubba-sort-page-2/bubba-005-1250px.png"></p>
<p><img alt="Panel 6" src="posts/bubba-sort-page-2/bubba-006.webp"></p>
<p><a href="posts/bubba-sort-page-1/index.html">Previous Bubba</a></p>
<p><a href="pages/bubba-sort/bubba-sort-pages/index.html">Table of Contents</a></p>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/nyc-shootings-python-version/index.html">NYC Shootings (Python Version)</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/nyc-shootings-python-version/index.html" rel="bookmark"><time class="published dt-published" datetime="2023-03-22T13:18:14-07:00" itemprop="datePublished" title="2023-03-22 13:18">2023-03-22 13:18</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/nyc-shootings-python-version/index.html#org7267513">NYPD Shooting Incident Data Version 2 (with python)</a>
<ul>
<li><a href="posts/nyc-shootings-python-version/index.html#orgefa6b81">Imports and Setup</a></li>
</ul>
</li>
<li><a href="posts/nyc-shootings-python-version/index.html#orgd2dcc95">The Data</a>
<ul>
<li><a href="posts/nyc-shootings-python-version/index.html#org6a28736">Loading It</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#org7c2205e">The Columns</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#org064f054">Missing Data</a></li>
</ul>
</li>
<li><a href="posts/nyc-shootings-python-version/index.html#org688b65e">Incident Key</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#org33d354c">OCCUR_DATE and OCCUR_TIME</a>
<ul>
<li><a href="posts/nyc-shootings-python-version/index.html#orgf662312">Shootings By Month</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#org50ab462">90 Day Rolling Window</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#orgade0966">By Year</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#orgc8945cc">Monthly By Year</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#org6256d42">Median By Month</a></li>
</ul>
</li>
<li><a href="posts/nyc-shootings-python-version/index.html#org292a2f5">Location</a>
<ul>
<li><a href="posts/nyc-shootings-python-version/index.html#org534d99c">Descriptions</a>
<ul>
<li><a href="posts/nyc-shootings-python-version/index.html#orga16714f">BORO</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#orgc9e41d3">PRECINCT & JURISDICTION_CODE</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#orgb17834b">LOCATION_DESC</a></li>
</ul>
</li>
<li><a href="posts/nyc-shootings-python-version/index.html#org411e0c0">Coordinates</a>
<ul>
<li><a href="posts/nyc-shootings-python-version/index.html#org715ed00">X_COORD_CD & Y_COORD_CD</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#org25e7b20">Latitude & Longitude</a></li>
</ul>
</li>
<li><a href="posts/nyc-shootings-python-version/index.html#org959241b">With GeoPandas</a></li>
</ul>
</li>
<li><a href="posts/nyc-shootings-python-version/index.html#org1052eae">Murder or Not</a>
<ul>
<li><a href="posts/nyc-shootings-python-version/index.html#orgc7766a5">By Year</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#orgcebc390">By Month</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#orge8d9276">By Coordinate</a></li>
</ul>
</li>
<li><a href="posts/nyc-shootings-python-version/index.html#org923478a">Victims and Perpetrators</a>
<ul>
<li><a href="posts/nyc-shootings-python-version/index.html#org4fdbf35">Perpetrators</a>
<ul>
<li><a href="posts/nyc-shootings-python-version/index.html#org35ed0f5">PERP_AGE_GROUP</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#org161378c">PEPR_SEX</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#org8c7669f">PERP_RACE</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#org6e11a1e">Handling the Unknowns</a></li>
</ul>
</li>
<li><a href="posts/nyc-shootings-python-version/index.html#org2c74e99">Victims</a>
<ul>
<li><a href="posts/nyc-shootings-python-version/index.html#org4d6e561">VIC_AGE_GROUP</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#orgaffb1be">VIC_SEX</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#org7e13425">VIC_RACE</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="posts/nyc-shootings-python-version/index.html#orgb7deeb6">Sources</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org7267513">
<h2 id="org7267513">NYPD Shooting Incident Data Version 2 (with python)</h2>
<div class="outline-text-2" id="text-org7267513">
<p>This is a replication (more or less) of the <a href="posts/nypd-shooting-incident-data/index.html">NYPD Shooting Incident Data</a> post which we did using R but this time we'll use python and pandas instead. Once again we'll be looking at the <a href="https://catalog.data.gov/dataset/nypd-shooting-incident-data-historic">NYPD Shooting Incident Data (Historic)</a> from the <a href="https://catalog.data.gov/dataset">DATA.gov</a> catalog of datasets, which lists every shooting from 2006 through the last updated incident (as of March 22, 2023 it shows that it was last updated June 9, 2022 but we'll have to look at it to see what the date of the last incident was).</p>
</div>
<div class="outline-3" id="outline-container-orgefa6b81">
<h3 id="orgefa6b81">Imports and Setup</h3>
<div class="outline-text-3" id="text-orgefa6b81">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="kn">import</span> <span class="nn">altair</span>
<span class="kn">import</span> <span class="nn">geopandas</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="kn">from</span> <span class="nn">graeae.visualization.altair_helpers</span> <span class="kn">import</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">save_chart</span>
</pre></div>
<p>First, let's double-check which version of python we're using.</p>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
</pre></div>
<pre class="example">
3.9.9 (main, Dec  3 2021, 01:15:49) 
[GCC 10.2.1 20210110]
</pre>
<p>We're running python 3.9.9. I was running it in pypy but for some reason the pandas' <code>groupby</code> method would hang so this is done in cPython.</p>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">altair</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
</pre></div>
<pre class="example">
5.0.0rc1
</pre>
<p>I found out after I'd been struggling with altair for a little while that they're about to make a major release that breaks some of the ways you use it (in the prior versions). Since it's been a while since I've used altair I decided to go with the newer, upcoming version rather than re-learn the current one and then learn the new version of altair once it's released.</p>
<p>This next bit is a little setup to make nicer tables.</p>
<div class="highlight">
<pre><span></span><span class="n">TABLE</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">tabulate</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">,</span> <span class="n">showindex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">)</span>
</pre></div>
<p>This is to help with the plotting.</p>
<div class="highlight">
<pre><span></span><span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"nyc-shootings-python-version"</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="n">output_path</span><span class="p">(</span><span class="n">SLUG</span><span class="p">)</span>
<span class="n">save_it</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">save_chart</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">650</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgd2dcc95">
<h2 id="orgd2dcc95">The Data</h2>
<div class="outline-text-2" id="text-orgd2dcc95"></div>
<div class="outline-3" id="outline-container-org6a28736">
<h3 id="org6a28736">Loading It</h3>
<div class="outline-text-3" id="text-org6a28736">
<p>The data is available to download as a CSV so we'll pass the URL for the CSV to pandas and make a dataframe.</p>
<div class="highlight">
<pre><span></span><span class="n">URL</span> <span class="o">=</span> <span class="s2">"https://data.cityofnewyork.us/api/views/833y-fsy8/rows.csv?accessType=DOWNLOAD"</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Rows: </span><span class="si">{</span><span class="n">rows</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="se">\t</span><span class="s2">Columns: </span><span class="si">{</span><span class="n">columns</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Rows: 25,596    Columns: 19
</pre></div>
</div>
<div class="outline-3" id="outline-container-org7c2205e">
<h3 id="org7c2205e">The Columns</h3>
<div class="outline-text-3" id="text-org7c2205e">
<p>We'll start looking at the data by examining what's in the columns. We saw from the data frame's shape that we have 19 columns, how many of them does pandas think are numeric?</p>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">(),</span> <span class="n">showindex</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">&nbsp;</th>
<th class="org-right" scope="col">INCIDENT_KEY</th>
<th class="org-right" scope="col">PRECINCT</th>
<th class="org-right" scope="col">JURISDICTION_CODE</th>
<th class="org-right" scope="col">X_COORD_CD</th>
<th class="org-right" scope="col">Y_COORD_CD</th>
<th class="org-right" scope="col">Latitude</th>
<th class="org-right" scope="col">Longitude</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">count</td>
<td class="org-right">25596</td>
<td class="org-right">25596</td>
<td class="org-right">25594</td>
<td class="org-right">25596</td>
<td class="org-right">25596</td>
<td class="org-right">25596</td>
<td class="org-right">25596</td>
</tr>
<tr>
<td class="org-left">mean</td>
<td class="org-right">1.12383e+08</td>
<td class="org-right">65.8694</td>
<td class="org-right">0.331601</td>
<td class="org-right">1.00945e+06</td>
<td class="org-right">207894</td>
<td class="org-right">40.7372</td>
<td class="org-right">-73.909</td>
</tr>
<tr>
<td class="org-left">std</td>
<td class="org-right">6.78612e+07</td>
<td class="org-right">27.2019</td>
<td class="org-right">0.742266</td>
<td class="org-right">18421.4</td>
<td class="org-right">31857.4</td>
<td class="org-right">0.087447</td>
<td class="org-right">0.0664265</td>
</tr>
<tr>
<td class="org-left">min</td>
<td class="org-right">9.95324e+06</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">914928</td>
<td class="org-right">125757</td>
<td class="org-right">40.5116</td>
<td class="org-right">-74.2493</td>
</tr>
<tr>
<td class="org-left">25%</td>
<td class="org-right">6.15936e+07</td>
<td class="org-right">44</td>
<td class="org-right">0</td>
<td class="org-right">1.00001e+06</td>
<td class="org-right">182782</td>
<td class="org-right">40.6683</td>
<td class="org-right">-73.9431</td>
</tr>
<tr>
<td class="org-left">50%</td>
<td class="org-right">8.64373e+07</td>
<td class="org-right">69</td>
<td class="org-right">0</td>
<td class="org-right">1.00772e+06</td>
<td class="org-right">194038</td>
<td class="org-right">40.6991</td>
<td class="org-right">-73.9153</td>
</tr>
<tr>
<td class="org-left">75%</td>
<td class="org-right">1.66661e+08</td>
<td class="org-right">81</td>
<td class="org-right">0</td>
<td class="org-right">1.01684e+06</td>
<td class="org-right">239429</td>
<td class="org-right">40.8238</td>
<td class="org-right">-73.8824</td>
</tr>
<tr>
<td class="org-left">max</td>
<td class="org-right">2.3849e+08</td>
<td class="org-right">123</td>
<td class="org-right">2</td>
<td class="org-right">1.06682e+06</td>
<td class="org-right">271128</td>
<td class="org-right">40.9108</td>
<td class="org-right">-73.702</td>
</tr>
</tbody>
</table>
<p>Just seven of them, and four are coordinates and the other three are categorical. This isn't really surprising, since the data isn't measuring anything but is rather a listing of shooting incidents reported (each row represents a single incident).</p>
<p>There's a table on the <a href="https://data.cityofnewyork.us/Public-Safety/NYPD-Shooting-Incident-Data-Historic-/833y-fsy8">NYPD-Shooting-Incident-Data</a> page that describes the columns.</p>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Column Name</th>
<th class="org-left" scope="col">Description</th>
<th class="org-left" scope="col">Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">INCIDENT_KEY</td>
<td class="org-left">Randomly generated persistent ID for each arrest</td>
<td class="org-left">Plain Text</td>
</tr>
<tr>
<td class="org-left">OCCUR_DATE</td>
<td class="org-left">Exact date of the shooting incident</td>
<td class="org-left">Date & Time</td>
</tr>
<tr>
<td class="org-left">OCCUR_TIME</td>
<td class="org-left">Exact time of the shooting incident</td>
<td class="org-left">Plain Text</td>
</tr>
<tr>
<td class="org-left">BORO</td>
<td class="org-left">Borough where the shooting incident occurred</td>
<td class="org-left">Plain Text</td>
</tr>
<tr>
<td class="org-left">PRECINCT</td>
<td class="org-left">Precinct where the shooting incident occurred</td>
<td class="org-left">Plain Text</td>
</tr>
<tr>
<td class="org-left">JURISDICTIONAL_CODE</td>
<td class="org-left">Jurisdiction where it occurred</td>
<td class="org-left">Number</td>
</tr>
<tr>
<td class="org-left">LOCATION_DESC</td>
<td class="org-left">Location of the incident</td>
<td class="org-left">Plain Text</td>
</tr>
<tr>
<td class="org-left">STATISTICAL_MURDER_FLAG</td>
<td class="org-left">Victim died</td>
<td class="org-left">Checkbox</td>
</tr>
<tr>
<td class="org-left">PERP_AGE_GROUP</td>
<td class="org-left">Perpetrator's age within a category</td>
<td class="org-left">Plain Text</td>
</tr>
<tr>
<td class="org-left">PERP_SEX</td>
<td class="org-left">Pepetrator's sex.</td>
<td class="org-left">Plain Text</td>
</tr>
<tr>
<td class="org-left">PERP_RACE</td>
<td class="org-left">Perpetrator's race.</td>
<td class="org-left">Plain Text</td>
</tr>
<tr>
<td class="org-left">VIC_AGE_GROUP</td>
<td class="org-left">Victim's age with a category.</td>
<td class="org-left">Plain Text</td>
</tr>
<tr>
<td class="org-left">VIC_SEX</td>
<td class="org-left">Victim's sex.</td>
<td class="org-left">Plain Text</td>
</tr>
<tr>
<td class="org-left">VIC_RACE</td>
<td class="org-left">Victim's Race</td>
<td class="org-left">Plain Text</td>
</tr>
<tr>
<td class="org-left">X_COORD_CD</td>
<td class="org-left">Midblock X-coordinate for New York State Plane Coordinate System</td>
<td class="org-left">Plain Text</td>
</tr>
<tr>
<td class="org-left">Y_COORD_CD</td>
<td class="org-left">Midblock Y-coordinate</td>
<td class="org-left">Plain Text</td>
</tr>
<tr>
<td class="org-left">Latitude</td>
<td class="org-left">Latitude coordinate</td>
<td class="org-left">Number</td>
</tr>
<tr>
<td class="org-left">Longitude</td>
<td class="org-left">Longitude</td>
<td class="org-left">Number</td>
</tr>
<tr>
<td class="org-left">Lon_Lat</td>
<td class="org-left">Longitude and Latitude Coordinate for mapping</td>
<td class="org-left">Point</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-3" id="outline-container-org064f054">
<h3 id="org064f054">Missing Data</h3>
<div class="outline-text-3" id="text-org064f054">
<div class="highlight">
<pre><span></span><span class="n">missing</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">data</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">missing</span> <span class="o">=</span> <span class="n">missing</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"Column"</span><span class="p">,</span>
             <span class="mi">0</span><span class="p">:</span> <span class="s2">"Missing"</span><span class="p">})</span>

<span class="n">some_missing</span> <span class="o">=</span> <span class="n">missing</span><span class="p">[</span><span class="n">missing</span><span class="o">.</span><span class="n">Missing</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">some_missing</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">"Fraction"</span><span class="p">]</span> <span class="o">=</span> <span class="n">some_missing</span><span class="o">.</span><span class="n">Missing</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">some_missing</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Column</th>
<th class="org-right" scope="col">Missing</th>
<th class="org-right" scope="col">Fraction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">JURISDICTION_CODE</td>
<td class="org-right">2</td>
<td class="org-right">7.81372e-05</td>
</tr>
<tr>
<td class="org-left">LOCATION_DESC</td>
<td class="org-right">14977</td>
<td class="org-right">0.58513</td>
</tr>
<tr>
<td class="org-left">PERP_AGE_GROUP</td>
<td class="org-right">9344</td>
<td class="org-right">0.365057</td>
</tr>
<tr>
<td class="org-left">PERP_SEX</td>
<td class="org-right">9310</td>
<td class="org-right">0.363729</td>
</tr>
<tr>
<td class="org-left">PERP_RACE</td>
<td class="org-right">9310</td>
<td class="org-right">0.363729</td>
</tr>
</tbody>
</table>
<p>Most entries are missing location descriptions for some reason, and quite a lot of perpertator data is missing, possibly because they didn't catch whoever did the shooting in those cases.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org688b65e">
<h2 id="org688b65e">Incident Key</h2>
<div class="outline-text-2" id="text-org688b65e">
<p>The incident key is an identifier for a specific incident so it's only really useful if you need to look up or refer to one or more of them, but we'll be looking at things in aggregate making them less useful for us, except maybe for looking at anomalies. Let's just make sure that the identifiers are unique as I'm asserting that they are.</p>
<div class="highlight">
<pre><span></span><span class="n">id_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">INCIDENT_KEY</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
<span class="n">incidents</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Identifiers: </span><span class="si">{</span><span class="n">id_count</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="se">\t</span><span class="s2">Incidents: </span><span class="si">{</span><span class="n">incidents</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"There are </span><span class="si">{</span><span class="n">incidents</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">id_count</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> more rows than incident IDs."</span><span class="p">)</span>
</pre></div>
<pre class="example">
Identifiers: 20,126     Incidents: 25,596
There are 5,470 more rows than incident IDs.
</pre>
<p>It appears that I wasn't correct in my assumptionâ€¦ let's take a look at one of the incidents.</p>
<div class="highlight">
<pre><span></span><span class="n">counts</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">INCIDENT_KEY</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">up_counts</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">top</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">top_id</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Incident: </span><span class="si">{</span><span class="n">top_id</span><span class="si">}</span><span class="se">\t</span><span class="s2">Count: </span><span class="si">{</span><span class="n">top</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
Incident: 173354054     Count: 18
</pre>
<p>Inspecting the dataframe it looks like in some cases more than one person was shot per incident, so there's multiple rows (one per person shot) for a single incident. Kind of scary that eighteen people got shot at one incident, if my interpretation is correct, but that's life in the big city, I guess. Reading the <a href="https://data.cityofnewyork.us/api/views/833y-fsy8/files/e4e3d86c-348f-4a16-a17f-19480c089429?download=true&amp;filename=NYPD_Shootings_Incident_Level_Data_Footnotes.pdf">Footnotes</a> (link is to a PDF) it says:</p>
<blockquote>
<p>A shooting incident can have multiple victims involved and as a result duplicate INCIDENT_KEYs are produced.</p>
</blockquote>
<p>So it appears each row represents the victim of a shooting and each <code>INCIDENT_KEY</code> represents a shooting where one or more person was shot. The footnotes also note that only incidents where a victim was shot are included. If someone fired a gun but didn't hit anyone then it isn't represented in the data set.</p>
<p><b>Note:</b> There's actually a slight discrepancy between the descriptions of the <code>INCIDENT_KEY</code> between the web-page and the PDF footnotes. According to the Web-Page the ID is for each arrest while the footnotes make it sound like they represent cases where there was at least one victim, whether or not someone was arrested. For our purposes this won't matter, since we're only using the data as a source for data visualization, but if one were really trying to understand what was happening in NYC knowing exactly what the data represents might be important (assuming not all cases with a shooting victim leads to an arrest).</p>
<div class="highlight">
<pre><span></span><span class="n">use_counts</span> <span class="o">=</span> <span class="n">up_counts</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">use_counts</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"INCIDENT_KEY"</span><span class="p">,</span>
                 <span class="nb">type</span><span class="o">=</span><span class="s2">"nominal"</span><span class="p">,</span>
                 <span class="n">sort</span><span class="o">=</span><span class="s2">"-y"</span><span class="p">,</span>
                 <span class="n">axis</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="kc">False</span><span class="p">)),</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"count"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"INCIDENT_KEY"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"nominal"</span><span class="p">),</span>
             <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"count"</span><span class="p">)]</span>
<span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
   <span class="n">title</span><span class="o">=</span><span class="s2">"Incidents with Multiple Shots"</span><span class="p">,</span>
   <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
   <span class="n">height</span><span class="o">=</span><span class="mi">525</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"multiple_shot_incidents"</span><span class="p">)</span>
</pre></div>
<object data="posts/nyc-shootings-python-version/multiple_shot_incidents.html" height="650" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>It looks like a lot of entries have more than one row. Does this mean many incidents have more than one victim? More than one shooter?</p>
<div class="highlight">
<pre><span></span><span class="n">fractions</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">counts</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">fractions</span> <span class="o">=</span> <span class="n">fractions</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Percent of Rows"</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">"count"</span><span class="p">:</span> <span class="s2">"Rows"</span><span class="p">})</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">fractions</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Rows"</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="n">fractions</span><span class="p">[</span><span class="s2">"Percent of Rows"</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Percent of Rows"</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">70</span><span class="p">))),</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Rows"</span><span class="p">),</span>
             <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Percent of Rows"</span><span class="p">)])</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
                 <span class="n">title</span><span class="o">=</span><span class="s2">"Percent Of Incidents with Multiple Rows"</span><span class="p">,</span>
                 <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
                 <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"fraction_row_incidents"</span><span class="p">)</span>
</pre></div>
<object data="posts/nyc-shootings-python-version/fraction_row_incidents.html" height="650" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>The majority of the incidents do have only one row in the dataset. Perhaps it's not as unusual as I think it is to have multiple people involved in a shooting.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org33d354c">
<h2 id="org33d354c">OCCUR_DATE and OCCUR_TIME</h2>
<div class="outline-text-2" id="text-org33d354c">
<p>There are two columns that tell us when the shooting is supposed to have happened.</p>
<div class="highlight">
<pre><span></span><span class="n">example</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">INCIDENT_KEY</span><span class="o">==</span><span class="n">top_id</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"OCCUR_DATE: </span><span class="si">{</span><span class="n">example</span><span class="o">.</span><span class="n">OCCUR_DATE</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">OCCUR_DATE</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"OCCUR_TIME: </span><span class="si">{</span><span class="n">example</span><span class="o">.</span><span class="n">OCCUR_TIME</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">OCCUR_TIME</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>
</pre></div>
<pre class="example">
OCCUR_DATE: 01/06/2018 (object)
OCCUR_TIME: 21:05:00 (object)
</pre>
<p>Pandas interpreted both of these as strings, but it'd probably be more useful for us if they were datetime objects.</p>
<div class="highlight">
<pre><span></span><span class="n">MONTH</span><span class="p">,</span> <span class="n">DAY</span><span class="p">,</span> <span class="n">YEAR</span> <span class="o">=</span> <span class="s2">"%m"</span><span class="p">,</span> <span class="s2">"</span><span class="si">%d</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"%Y"</span>
<span class="n">HOUR</span><span class="p">,</span> <span class="n">MINUTE</span><span class="p">,</span> <span class="n">SECOND</span> <span class="o">=</span> <span class="s2">"%H"</span><span class="p">,</span> <span class="s2">"%M"</span><span class="p">,</span> <span class="s2">"%S"</span>
<span class="n">DATE_FORMAT</span> <span class="o">=</span> <span class="s2">"/"</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">MONTH</span><span class="p">,</span> <span class="n">DAY</span><span class="p">,</span> <span class="n">YEAR</span><span class="p">))</span>
<span class="n">TIME_FORMAT</span> <span class="o">=</span> <span class="s2">":"</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">HOUR</span><span class="p">,</span> <span class="n">MINUTE</span><span class="p">,</span> <span class="n">SECOND</span><span class="p">))</span>
<span class="n">FORMAT</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">DATE_FORMAT</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">TIME_FORMAT</span><span class="si">}</span><span class="s2">"</span>
<span class="n">DATE_COLUMN</span> <span class="o">=</span> <span class="s2">"date_time"</span>
<span class="n">data</span><span class="p">[</span><span class="n">DATE_COLUMN</span><span class="p">]</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">OCCUR_DATE</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">OCCUR_TIME</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">FORMAT</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">check_date</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">INCIDENT_KEY</span><span class="o">==</span><span class="n">top_id</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"OCCUR_DATE: </span><span class="si">{</span><span class="n">check_date</span><span class="o">.</span><span class="n">OCCUR_DATE</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"New Date: </span><span class="si">{</span><span class="n">check_date</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"OCCUR_TIME: </span><span class="si">{</span><span class="n">check_date</span><span class="o">.</span><span class="n">OCCUR_TIME</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"New Time: </span><span class="si">{</span><span class="n">check_date</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
OCCUR_DATE: 01/06/2018
New Date: 2018-01-06
OCCUR_TIME: 21:05:00
New Time: 21:05:00
</pre>
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">OCCUR_DATE</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">OCCUR_DATE</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</pre></div>
<pre class="example">
01/01/2006
12/31/2021
</pre>
<p>Our dataset covers the years from 2006 throught 20021. Let's see how many there are from month to month.</p>
</div>
<div class="outline-3" id="outline-container-orgf662312">
<h3 id="orgf662312">Shootings By Month</h3>
<div class="outline-text-3" id="text-orgf662312">
<div class="highlight">
<pre><span></span><span class="n">indexed</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">DATE_COLUMN</span><span class="p">)</span>
<span class="n">monthly</span> <span class="o">=</span> <span class="n">indexed</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">pandas</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="s2">"M"</span><span class="p">))</span>
<span class="n">monthly_counts</span> <span class="o">=</span> <span class="n">monthly</span><span class="o">.</span><span class="n">count</span><span class="p">()[</span><span class="s2">"INCIDENT_KEY"</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"INCIDENT_KEY"</span><span class="p">:</span> <span class="s2">"Shootings"</span><span class="p">,</span>
             <span class="s2">"date_time"</span><span class="p">:</span> <span class="s2">"Month"</span><span class="p">}</span>
<span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">monthly_counts</span><span class="p">[</span><span class="s2">"Shootings"</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">MONTH_YEAR</span> <span class="o">=</span> <span class="s2">"%B %Y"</span>
<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">monthly_counts</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span>
    <span class="n">point</span><span class="o">=</span><span class="p">{</span><span class="s2">"filled"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
           <span class="s2">"fill"</span><span class="p">:</span> <span class="s2">"white"</span><span class="p">})</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Month"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"temporal"</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Shootings"</span><span class="p">),</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Month"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">MONTH_YEAR</span><span class="p">),</span>
             <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Shootings"</span><span class="p">)]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"NYC Shootings By Month"</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"monthly_incidents"</span><span class="p">)</span>
</pre></div>
<object data="posts/nyc-shootings-python-version/monthly_incidents.html" height="650" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>It looks like shootings went down in 2013 then shot back up again in the Summer of 2020.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org50ab462">
<h3 id="org50ab462">90 Day Rolling Window</h3>
<div class="outline-text-3" id="text-org50ab462">
<div class="highlight">
<pre><span></span><span class="n">monthly_counts</span><span class="p">[</span><span class="s2">"Rolling Mean"</span><span class="p">]</span> <span class="o">=</span> <span class="n">monthly_counts</span><span class="p">[</span><span class="s2">"Shootings"</span><span class="p">]</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span>
    <span class="n">halflife</span><span class="o">=</span><span class="s2">"90 days"</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="n">monthly_counts</span><span class="o">.</span><span class="n">Month</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">pre_melt</span> <span class="o">=</span> <span class="n">monthly_counts</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"Shootings"</span><span class="p">:</span> <span class="s2">"Sum"</span><span class="p">})</span>
<span class="n">melted</span> <span class="o">=</span> <span class="n">pre_melt</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="s2">"Month"</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">"Aggregation"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Aggregated Value"</span><span class="p">)</span>
<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span>
    <span class="n">point</span><span class="o">=</span><span class="p">{</span><span class="s2">"filled"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
           <span class="s2">"fill"</span><span class="p">:</span> <span class="s2">"white"</span><span class="p">})</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
               <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Month"</span><span class="p">),</span>
               <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Aggregated Value"</span><span class="p">),</span>
               <span class="n">color</span><span class="o">=</span><span class="s2">"Aggregation"</span><span class="p">,</span>
               <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Month"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">MONTH_YEAR</span><span class="p">),</span>
                        <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Aggregated Value"</span><span class="p">)]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"NYC Shootings By 90 Day Exponential Weighted Mean"</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"monthly_rolling_incidents"</span><span class="p">)</span>
</pre></div>
<object data="posts/nyc-shootings-python-version/monthly_rolling_incidents.html" height="650" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>Using a ninety-day window gives a little better sense of the overall trend downwards until 2020 reversed it.</p>
</div>
</div>
<div class="outline-3" id="outline-container-orgade0966">
<h3 id="orgade0966">By Year</h3>
<div class="outline-text-3" id="text-orgade0966">
<div class="highlight">
<pre><span></span><span class="n">yearly</span> <span class="o">=</span> <span class="n">indexed</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">pandas</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="s2">"Y"</span><span class="p">))</span>
<span class="n">yearly_counts</span> <span class="o">=</span> <span class="n">yearly</span><span class="o">.</span><span class="n">count</span><span class="p">()[</span><span class="s2">"INCIDENT_KEY"</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"INCIDENT_KEY"</span><span class="p">:</span> <span class="s2">"Shootings"</span><span class="p">}</span>
<span class="p">)</span>

<span class="n">yearly_counts</span><span class="p">[</span><span class="s2">"Year"</span><span class="p">]</span> <span class="o">=</span> <span class="n">yearly_counts</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
<span class="n">expect</span><span class="p">(</span><span class="n">yearly_counts</span><span class="p">[</span><span class="s2">"Shootings"</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">yearly_counts</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span>
    <span class="n">point</span><span class="o">=</span><span class="p">{</span><span class="s2">"filled"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
           <span class="s2">"fill"</span><span class="p">:</span> <span class="s2">"white"</span><span class="p">})</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Year"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"ordinal"</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Shootings"</span><span class="p">),</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Year"</span><span class="p">),</span>
             <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Shootings"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">)]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"NYC Shootings By year"</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"yearly_incidents"</span><span class="p">)</span>
</pre></div>
<object data="posts/nyc-shootings-python-version/yearly_incidents.html" height="650" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>Although 2020 had that crazy summer, 2021 still exceeded it overall.</p>
</div>
</div>
<div class="outline-3" id="outline-container-orgc8945cc">
<h3 id="orgc8945cc">Monthly By Year</h3>
<div class="outline-text-3" id="text-orgc8945cc">
<div class="highlight">
<pre><span></span><span class="n">monthly_counts</span> <span class="o">=</span> <span class="n">monthly</span><span class="o">.</span><span class="n">count</span><span class="p">()[</span><span class="s2">"INCIDENT_KEY"</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"INCIDENT_KEY"</span><span class="p">:</span> <span class="s2">"Shootings"</span><span class="p">}</span>
<span class="p">)</span>
<span class="c1"># monthly_counts = monthly_counts.rename(columns={"Month": "date-time"})</span>

<span class="n">month_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span> <span class="s2">"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec"</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span>
<span class="n">monthly_counts</span><span class="p">[</span><span class="s2">"Year"</span><span class="p">]</span> <span class="o">=</span> <span class="n">monthly_counts</span><span class="p">[</span><span class="s2">"date_time"</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
<span class="n">monthly_counts</span><span class="p">[</span><span class="s2">"Month"</span><span class="p">]</span> <span class="o">=</span> <span class="n">monthly_counts</span><span class="p">[</span><span class="s2">"date_time"</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">month</span><span class="p">:</span> <span class="n">month_map</span><span class="p">[</span><span class="n">month</span><span class="p">])</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">selection</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">selection_point</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">"Year"</span><span class="p">],</span>
                                   <span class="n">bind</span><span class="o">=</span><span class="s2">"legend"</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">monthly_counts</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span>
    <span class="n">point</span><span class="o">=</span><span class="p">{</span><span class="s2">"filled"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
           <span class="s2">"fill"</span><span class="p">:</span> <span class="s2">"white"</span><span class="p">})</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Month"</span><span class="p">,</span>
               <span class="n">sort</span><span class="o">=</span><span class="n">monthly_counts</span><span class="p">[</span><span class="s2">"date_time"</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Shootings"</span><span class="p">),</span>
    <span class="n">color</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">"Year"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"nominal"</span><span class="p">),</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"date_time"</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">"Month"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">MONTH_YEAR</span><span class="p">),</span>
             <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Shootings"</span><span class="p">)],</span>
    <span class="n">opacity</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">selection</span><span class="p">,</span>
                             <span class="n">altair</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mf">0.8</span><span class="p">),</span>
                             <span class="n">altair</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"NYC Monthly Shootings By year"</span>
<span class="p">)</span><span class="o">.</span><span class="n">add_params</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"month_year_shootings"</span><span class="p">)</span>
</pre></div>
<object data="posts/nyc-shootings-python-version/month_year_shootings.html" height="650" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>Click on a year in the legend to isolate it from the other lines in the plot and on a space somewhere on the legend to highlight all the years again.</p>
<p>It looks like there was an unusually large surge in the Summer of 2020 after years of declining shootings, but regardless of the year there's at least a slight increase in shootings during the Summer months.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org6256d42">
<h3 id="org6256d42">Median By Month</h3>
<div class="outline-text-3" id="text-org6256d42">
<div class="highlight">
<pre><span></span><span class="n">by_month_median</span> <span class="o">=</span> <span class="n">monthly_counts</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">"Month"</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">by_month_median</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Month"</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">month_map</span><span class="o">.</span><span class="n">values</span><span class="p">())),</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Shootings"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Month"</span><span class="p">),</span>
             <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Shootings"</span><span class="p">),]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"NYC Median Shootings By Month (2006 through 2012)"</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"monthly_shootings"</span><span class="p">)</span>
</pre></div>
<object data="posts/nyc-shootings-python-version/monthly_shootings.html" height="650" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>It looks like there's a definite seasonal effect on shootings. Must be all those farmer's kids off from school to work the fields and shoot each other.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org292a2f5">
<h2 id="org292a2f5">Location</h2>
<div class="outline-text-2" id="text-org292a2f5"></div>
<div class="outline-3" id="outline-container-org534d99c">
<h3 id="org534d99c">Descriptions</h3>
<div class="outline-text-3" id="text-org534d99c"></div>
<div class="outline-4" id="outline-container-orga16714f">
<h4 id="orga16714f">BORO</h4>
<div class="outline-text-4" id="text-orga16714f">
<p>The <code>BORO</code> column identifies which of the <a href="https://en.wikipedia.org/wiki/Boroughs_of_New_York_City?useskin=vector">five boroughs of New York City</a> the victim was shot in.</p>
<p><img alt="Five Boroughs" src="https://upload.wikimedia.org/wikipedia/commons/3/34/5_Boroughs_Labels_New_York_City_Map.svg"></p>
<ol class="org-ol">
<li>Manhattan</li>
<li>Brooklyn</li>
<li>Queens</li>
<li>Bronx</li>
<li>Staten Island</li>
</ol>
<div class="highlight">
<pre><span></span><span class="n">boroughs</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">BORO</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">BORO</span><span class="o">=</span><span class="s2">"Borough"</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="s2">"Shootings"</span><span class="p">))</span>


<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">boroughs</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Borough"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Shootings"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Borough"</span><span class="p">),</span>
             <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Shootings"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">)]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">520</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Shootings by Borough"</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"shootings-by-borough"</span><span class="p">)</span>
</pre></div>
<object data="posts/nyc-shootings-python-version/shootings-by-borough.html" height="650" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<div class="highlight">
<pre><span></span><span class="n">borough_monthly</span> <span class="o">=</span> <span class="n">monthly</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">"BORO"</span><span class="p">:</span> <span class="s2">"first"</span><span class="p">,</span>
                               <span class="s2">"INCIDENT_KEY"</span><span class="p">:</span> <span class="s2">"count"</span><span class="p">})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
                                   <span class="n">columns</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">BORO</span><span class="o">=</span><span class="s2">"Borough"</span><span class="p">,</span> <span class="n">INCIDENT_KEY</span><span class="o">=</span><span class="s2">"Shootings"</span><span class="p">,</span> <span class="n">date_time</span><span class="o">=</span><span class="s2">"Month"</span><span class="p">))</span>

<span class="n">selection</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">selection_point</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">"Borough"</span><span class="p">],</span> <span class="n">bind</span><span class="o">=</span><span class="s2">"legend"</span><span class="p">)</span>
<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">borough_monthly</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span>
    <span class="n">point</span><span class="o">=</span><span class="p">{</span><span class="s2">"filled"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
           <span class="s2">"fill"</span><span class="p">:</span> <span class="s2">"white"</span><span class="p">})</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
               <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Month"</span><span class="p">),</span>
               <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Shootings"</span><span class="p">),</span>
               <span class="n">color</span><span class="o">=</span><span class="s2">"Borough"</span><span class="p">,</span>
               <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span>
                   <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Borough"</span><span class="p">),</span>
                   <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Month"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">MONTH_YEAR</span><span class="p">),</span>
                   <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Shootings"</span><span class="p">)</span>
               <span class="p">],</span>
               <span class="n">opacity</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">selection</span><span class="p">,</span>
                                        <span class="n">altair</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mf">0.8</span><span class="p">),</span>
                                        <span class="n">altair</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Monthly Borough Shootings"</span>
<span class="p">)</span><span class="o">.</span><span class="n">add_params</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"borough-monthly-shootings"</span><span class="p">)</span>
</pre></div>
<object data="posts/nyc-shootings-python-version/borough-monthly-shootings.html" height="650" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>The Bronx and Brooklyn look like they have the most shootings, although I didn't weight it by population so I don't know how they compare as a fraction of the population.</p>
<div class="highlight">
<pre><span></span><span class="n">borough_bar</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s2">"BORO"</span><span class="p">,</span> <span class="s2">"date_time"</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">BORO</span><span class="o">=</span><span class="s2">"Borough"</span><span class="p">))</span>
<span class="n">borough_bar</span><span class="p">[</span><span class="s2">"Month"</span><span class="p">]</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">({</span>
    <span class="s2">"year"</span><span class="p">:</span> <span class="n">borough_bar</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
    <span class="s2">"month"</span><span class="p">:</span> <span class="n">borough_bar</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
    <span class="s2">"day"</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">})</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">borough_bar</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Month"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"count()"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Borough"</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">"Monthly Shootings With Borough Breakdowns"</span><span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"borough-monthly-bar-chart"</span><span class="p">)</span>
</pre></div>
<object data="posts/nyc-shootings-python-version/borough-monthly-bar-chart.html" height="650" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>By clicking on the legend you can isolate plot-lines by borough and it makes it clearer that the surge in 2020 happened primarily in the Bronx and Manhattan, although the plot is a little deceptive since Manhattan had some months where there were no shootings, but I didn't infill them with zeros so it doesn't show those months dropping back down.</p>
</div>
</div>
<div class="outline-4" id="outline-container-orgc9e41d3">
<h4 id="orgc9e41d3">PRECINCT & JURISDICTION_CODE</h4>
<div class="outline-text-4" id="text-orgc9e41d3">
<p>There are seventy-seven police precincts in New York City, subdividing the boroughs. This might be useful for isolating where the shootings are occuring even further, but I'll skip it. Same with the JURISDICTION_CODE.</p>
</div>
</div>
<div class="outline-4" id="outline-container-orgb17834b">
<h4 id="orgb17834b">LOCATION_DESC</h4>
<div class="outline-text-4" id="text-orgb17834b">
<div class="highlight">
<pre><span></span><span class="n">missing_locations</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">LOCATION_DESC</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">LOCATION_DESC</span><span class="o">=</span><span class="s2">"Location Description"</span><span class="p">))</span>
<span class="n">missing_locations</span> <span class="o">=</span> <span class="n">missing_locations</span><span class="p">[[</span><span class="s2">"Location Description"</span><span class="p">,</span> <span class="s2">"date_time"</span><span class="p">,</span> <span class="s2">"BORO"</span><span class="p">]]</span>
<span class="n">missing_locations</span><span class="p">[</span><span class="s2">"Year"</span><span class="p">]</span> <span class="o">=</span> <span class="n">missing_locations</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">missing_locations</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Year"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"ordinal"</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"count()"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"count()"</span><span class="p">),</span> <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"BORO"</span><span class="p">),</span> <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Year"</span><span class="p">)],</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"BORO"</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Missing Location Descriptions by Year"</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"missing-locations-descriptions"</span><span class="p">)</span>
</pre></div>
<object data="posts/nyc-shootings-python-version/missing-locations-descriptions.html" height="650" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>I was hoping the missing locations might be because they only started recording it after some point, but it looks like it's an ongoing problem not local to any one borough, so the location descriptions are interesting, but the number of missing entries makes it hard to say that they're meaningful.</p>
<div class="highlight">
<pre><span></span><span class="n">locations</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">LOCATION_DESC</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="s2">"Count"</span><span class="p">,</span> <span class="n">LOCATION_DESC</span><span class="o">=</span><span class="s2">"Location"</span><span class="p">))</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Location"</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="n">locations</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
               <span class="n">axis</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">labelAngle</span><span class="o">=</span><span class="mi">30</span><span class="p">)),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Count"</span><span class="p">),</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Location"</span><span class="p">),</span> <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Count"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">)]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Shooting Location Counts"</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"shooting-locations-count"</span><span class="p">)</span>
</pre></div>
<object data="posts/nyc-shootings-python-version/shooting-locations-count.html" height="650" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>It looks like most shootings happened at homes, and to avoid being shot you should move to a storage facility.</p>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org411e0c0">
<h3 id="org411e0c0">Coordinates</h3>
<div class="outline-text-3" id="text-org411e0c0"></div>
<div class="outline-4" id="outline-container-org715ed00">
<h4 id="org715ed00">X_COORD_CD & Y_COORD_CD</h4>
<div class="outline-text-4" id="text-org715ed00">
<p>These coordinates use the State Plane Coordinate System (see <a href="https://www.usgs.gov/faqs/what-state-plane-coordinate-system-can-gps-provide-coordinates-these-values">What is the State Plane Coordinate System?</a>) Long Island Zone. The coordinates are mid-block locations with the units in feet.</p>
<div class="highlight">
<pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span>
    <span class="n">data</span><span class="p">[[</span><span class="s2">"X_COORD_CD"</span><span class="p">,</span> <span class="s2">"Y_COORD_CD"</span><span class="p">,</span> <span class="s2">"BORO"</span><span class="p">]])</span><span class="o">.</span><span class="n">mark_point</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"X_COORD_CD"</span><span class="p">)</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">X_COORD_CD</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">data</span><span class="o">.</span><span class="n">X_COORD_CD</span><span class="o">.</span><span class="n">max</span><span class="p">())),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Y_COORD_CD"</span><span class="p">)</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Y_COORD_CD</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">data</span><span class="o">.</span><span class="n">Y_COORD_CD</span><span class="o">.</span><span class="n">max</span><span class="p">())),</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">"BORO"</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Shootings By Coordinates"</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"shootings-by-coordinates"</span><span class="p">)</span>
</pre></div>
<object data="posts/nyc-shootings-python-version/shootings-by-coordinates.html" height="650" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<div class="highlight">
<pre><span></span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s2">"X_COORD_CD"</span><span class="p">,</span> <span class="s2">"Y_COORD_CD"</span><span class="p">,</span>
                    <span class="s2">"BORO"</span><span class="p">,</span> <span class="s2">"date_time"</span><span class="p">,</span>
                    <span class="s2">"Longitude"</span><span class="p">,</span> <span class="s2">"Latitude"</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">BORO</span><span class="o">=</span><span class="s2">"Borough"</span><span class="p">,</span>
    <span class="n">X_COORD_CD</span><span class="o">=</span><span class="s2">"X-Coordinate"</span><span class="p">,</span>
    <span class="n">Y_COORD_CD</span><span class="o">=</span><span class="s2">"Y-Coordinate"</span>
<span class="p">))</span>

<span class="n">coordinates</span><span class="p">[</span><span class="s2">"Year"</span><span class="p">]</span> <span class="o">=</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>

<span class="n">select_year</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">selection_point</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">"Year"</span><span class="p">,</span>
    <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">"Year"</span><span class="p">],</span>
    <span class="n">bind</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">binding_range</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">2006</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">2021</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"Year"</span><span class="p">),</span>
    <span class="n">value</span><span class="o">=</span><span class="p">[{</span><span class="s2">"Year"</span><span class="p">:</span> <span class="mi">2006</span><span class="p">}],</span>
<span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"X-Coordinate"</span><span class="p">)</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span>
        <span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="n">coordinates</span><span class="p">[</span><span class="s2">"X-Coordinate"</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                <span class="n">coordinates</span><span class="p">[</span><span class="s2">"X-Coordinate"</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Y-Coordinate"</span><span class="p">)</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span>
        <span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="n">coordinates</span><span class="p">[</span><span class="s2">"Y-Coordinate"</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                <span class="n">coordinates</span><span class="p">[</span><span class="s2">"Y-Coordinate"</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())),</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Borough"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Borough"</span><span class="p">),</span>
             <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"date_time"</span><span class="p">)],</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Shootings By Coordinates and Year"</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">add_params</span><span class="p">(</span><span class="n">select_year</span><span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span><span class="n">select_year</span><span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"shootings-by-coordinates-and-year"</span><span class="p">)</span>
</pre></div>
<object data="posts/nyc-shootings-python-version/shootings-by-coordinates-and-year.html" height="650" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
<div class="outline-4" id="outline-container-org25e7b20">
<h4 id="org25e7b20">Latitude & Longitude</h4>
</div>
</div>
<div class="outline-3" id="outline-container-org959241b">
<h3 id="org959241b">With GeoPandas</h3>
<div class="outline-text-3" id="text-org959241b">
<p>It turns out than the boroughs of New York City are one of the three datasets that come with GeoPandas so we can bring it in to make a map.</p>
<div class="highlight">
<pre><span></span><span class="n">path_to_data</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="s2">"nybb"</span><span class="p">)</span>
<span class="n">nyc_geopandas</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">path_to_data</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">nyc_geopandas</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
<pre class="example">
   BoroCode       BoroName     Shape_Leng    Shape_Area   
0         5  Staten Island  330470.010332  1.623820e+09  \

                                            geometry  
0  MULTIPOLYGON (((970217.022 145643.332, 970227....  
</pre>
<p>Let's look at a map colored with the 2021 shooting counts.</p>
<div class="highlight">
<pre><span></span><span class="n">BOROUGH_COLUMN</span> <span class="o">=</span> <span class="s2">"BoroName"</span>
<span class="n">SHOOTINGS_COLUMN</span> <span class="o">=</span> <span class="s2">"Shootings"</span>
<span class="n">latest</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="o">==</span><span class="mi">2021</span><span class="p">]</span>
<span class="n">latest_count</span> <span class="o">=</span> <span class="n">latest</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">"BORO"</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">expect</span><span class="p">(</span><span class="n">latest_count</span><span class="o">.</span><span class="n">INCIDENT_KEY</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">latest</span><span class="p">)))</span>
<span class="n">latest_count</span> <span class="o">=</span> <span class="n">latest_count</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">BORO</span><span class="o">=</span><span class="n">BOROUGH_COLUMN</span><span class="p">))</span>
<span class="n">latest_count</span><span class="p">[</span><span class="n">BOROUGH_COLUMN</span><span class="p">]</span> <span class="o">=</span> <span class="n">latest_count</span><span class="p">[</span><span class="n">BOROUGH_COLUMN</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
<span class="n">latest_count</span><span class="p">[</span><span class="n">SHOOTINGS_COLUMN</span><span class="p">]</span> <span class="o">=</span> <span class="n">latest_count</span><span class="p">[</span><span class="s2">"INCIDENT_KEY"</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">latest_count</span> <span class="o">=</span> <span class="n">latest_count</span><span class="p">[[</span><span class="n">BOROUGH_COLUMN</span><span class="p">,</span> <span class="n">SHOOTINGS_COLUMN</span><span class="p">]]</span>
<span class="n">merged</span> <span class="o">=</span> <span class="n">nyc_geopandas</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">latest_count</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">BOROUGH_COLUMN</span><span class="p">)</span>

<span class="n">merged</span> <span class="o">=</span> <span class="n">merged</span><span class="p">[[</span><span class="n">BOROUGH_COLUMN</span><span class="p">,</span> <span class="n">SHOOTINGS_COLUMN</span><span class="p">,</span> <span class="s2">"geometry"</span><span class="p">]]</span>
<span class="n">explorer</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="n">SHOOTINGS_COLUMN</span><span class="p">,</span>
                          <span class="n">tooltip</span><span class="o">=</span><span class="n">BOROUGH_COLUMN</span><span class="p">,</span>
                          <span class="n">popup</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">explorer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">OUTPUT_PATH</span><span class="si">}</span><span class="s2">/nyc-shootings-explore.html"</span><span class="p">)</span>
</pre></div>
<object data="posts/nyc-shootings-python-version/nyc-shootings-explore.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>This is probably most interesting to someone like me who doesn't know much about New York City. I wonder why Queens has so much fewer shootings than Brooklyn or the Bronx when it sits between them? Demographics?</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org1052eae">
<h2 id="org1052eae">Murder or Not</h2>
<div class="outline-text-2" id="text-org1052eae"></div>
<div class="outline-3" id="outline-container-orgc7766a5">
<h3 id="orgc7766a5">By Year</h3>
<div class="outline-text-3" id="text-orgc7766a5">
<div class="highlight">
<pre><span></span><span class="n">MURDER_FLAG</span> <span class="o">=</span> <span class="s2">"STATISTICAL_MURDER_FLAG"</span>
<span class="n">MURDERED</span> <span class="o">=</span> <span class="s2">"Murdered"</span>
<span class="n">BOROUGH</span> <span class="o">=</span> <span class="s2">"Borough"</span>
<span class="n">YEAR</span> <span class="o">=</span> <span class="s2">"Year"</span>
<span class="n">data</span><span class="p">[</span><span class="n">YEAR</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s2">"Y"</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">()</span>
<span class="n">yearly_murders</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">YEAR</span><span class="p">,</span> <span class="s2">"BORO"</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
    <span class="n">MURDER_FLAG</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">"BORO"</span><span class="p">:</span> <span class="n">BOROUGH</span><span class="p">,</span>
            <span class="n">MURDER_FLAG</span><span class="p">:</span> <span class="n">MURDERED</span><span class="p">})</span>
<span class="n">yearly_murders</span> <span class="o">=</span> <span class="n">yearly_murders</span><span class="p">[[</span><span class="n">YEAR</span><span class="p">,</span> <span class="n">BOROUGH</span><span class="p">,</span> <span class="n">MURDERED</span><span class="p">]]</span>

<span class="n">SELECTION</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">selection_point</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="n">BOROUGH</span><span class="p">],</span> <span class="n">bind</span><span class="o">=</span><span class="s2">"legend"</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">yearly_murders</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span>
    <span class="n">point</span><span class="o">=</span><span class="p">{</span><span class="s2">"filled"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
           <span class="s2">"fill"</span><span class="p">:</span> <span class="s2">"white"</span><span class="p">})</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
               <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="n">YEAR</span><span class="p">),</span>
               <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="n">MURDERED</span><span class="p">),</span>
               <span class="n">color</span><span class="o">=</span><span class="n">BOROUGH</span><span class="p">,</span>
               <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="n">YEAR</span><span class="p">),</span>
                        <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="n">MURDERED</span><span class="p">),</span>
                        <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="n">BOROUGH</span><span class="p">)],</span>
               <span class="n">opacity</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">SELECTION</span><span class="p">,</span>
                                        <span class="n">altair</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mf">0.8</span><span class="p">),</span>
                                        <span class="n">altair</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
           <span class="p">)</span><span class="o">.</span><span class="n">add_params</span><span class="p">(</span><span class="n">SELECTION</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
               <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
               <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
               <span class="n">title</span><span class="o">=</span><span class="s2">"NYC Murders By Year"</span>
           <span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"yearly_borough_murders"</span><span class="p">)</span>
<span class="c1">#+end_src</span>
</pre></div>
<object data="posts/nyc-shootings-python-version/yearly_borough_murders.html" height="650" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
<div class="outline-3" id="outline-container-orgcebc390">
<h3 id="orgcebc390">By Month</h3>
<div class="outline-text-3" id="text-orgcebc390">
<div class="highlight">
<pre><span></span><span class="n">MONTH</span> <span class="o">=</span> <span class="s2">"Month"</span>
<span class="n">data</span><span class="p">[</span><span class="n">MONTH</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s2">"M"</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">()</span>
<span class="n">murdered</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">MONTH</span><span class="p">,</span> <span class="s2">"BORO"</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">MURDER_FLAG</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">murdered</span> <span class="o">=</span> <span class="n">murdered</span><span class="p">[[</span><span class="n">MONTH</span><span class="p">,</span> <span class="s2">"BORO"</span><span class="p">,</span> <span class="n">MURDER_FLAG</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">"BORO"</span><span class="p">:</span> <span class="n">BOROUGH</span><span class="p">,</span>
    <span class="n">MURDER_FLAG</span><span class="p">:</span> <span class="n">MURDERED</span><span class="p">,</span>    
<span class="p">})</span>

<span class="n">SELECTION</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">selection_point</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="n">BOROUGH</span><span class="p">],</span> <span class="n">bind</span><span class="o">=</span><span class="s2">"legend"</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">murdered</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span>
    <span class="n">point</span><span class="o">=</span><span class="p">{</span><span class="s2">"filled"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
           <span class="s2">"fill"</span><span class="p">:</span> <span class="s2">"white"</span><span class="p">})</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
               <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="n">MONTH</span><span class="p">),</span>
               <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="n">MURDERED</span><span class="p">),</span>
               <span class="n">color</span><span class="o">=</span><span class="n">BOROUGH</span><span class="p">,</span>
               <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="n">MONTH</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">MONTH_YEAR</span><span class="p">),</span>
                        <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="n">MURDERED</span><span class="p">),</span>
                        <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="n">BOROUGH</span><span class="p">)],</span>
               <span class="n">opacity</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">SELECTION</span><span class="p">,</span>
                                        <span class="n">altair</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mf">0.8</span><span class="p">),</span>
                                        <span class="n">altair</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
           <span class="p">)</span><span class="o">.</span><span class="n">add_params</span><span class="p">(</span><span class="n">SELECTION</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
               <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
               <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
               <span class="n">title</span><span class="o">=</span><span class="s2">"NYC Murders By Month"</span>
           <span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"monthly_borough_murders"</span><span class="p">)</span>
</pre></div>
<object data="posts/nyc-shootings-python-version/monthly_borough_murders.html" height="650" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>It looks like Brooklyn lead in murders in the Summer of 2020,</p>
</div>
</div>
<div class="outline-3" id="outline-container-orge8d9276">
<h3 id="orge8d9276">By Coordinate</h3>
<div class="outline-text-3" id="text-orge8d9276">
<div class="highlight">
<pre><span></span><span class="n">murdered</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">MURDER_FLAG</span><span class="p">]]</span>

<span class="n">murder_coordinates</span> <span class="o">=</span> <span class="n">murdered</span><span class="p">[[</span><span class="s2">"BORO"</span><span class="p">,</span> <span class="s2">"date_time"</span><span class="p">,</span>
                               <span class="s2">"Longitude"</span><span class="p">,</span> <span class="s2">"Latitude"</span>
                               <span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                                   <span class="n">BORO</span><span class="o">=</span><span class="s2">"Borough"</span><span class="p">,</span>
                               <span class="p">))</span>
<span class="n">murder_coordinates</span><span class="p">[</span><span class="s2">"Year"</span><span class="p">]</span> <span class="o">=</span> <span class="n">murder_coordinates</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>

<span class="n">chart</span> <span class="o">=</span> <span class="p">(</span><span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">murder_coordinates</span><span class="p">)</span>
         <span class="o">.</span><span class="n">mark_point</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
         <span class="o">.</span><span class="n">encode</span><span class="p">(</span>
             <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Longitude"</span><span class="p">)</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span>
                 <span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="n">murder_coordinates</span><span class="p">[</span><span class="s2">"Longitude"</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                         <span class="n">murder_coordinates</span><span class="p">[</span><span class="s2">"Longitude"</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())),</span>
             <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Latitude"</span><span class="p">)</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span>
                 <span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="n">murder_coordinates</span><span class="p">[</span><span class="s2">"Latitude"</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                         <span class="n">murder_coordinates</span><span class="p">[</span><span class="s2">"Latitude"</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())),</span>
             <span class="n">color</span><span class="o">=</span><span class="s2">"Borough"</span><span class="p">,</span>
             <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Borough"</span><span class="p">),</span>
                      <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"date_time"</span><span class="p">)],</span>
         <span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
             <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
             <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
             <span class="n">title</span><span class="o">=</span><span class="s2">"Murders By Longitude, Latitude and Year"</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">add_params</span><span class="p">(</span><span class="n">select_year</span><span class="p">)</span>
         <span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span><span class="n">select_year</span><span class="p">))</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"murders-by-coordinates-and-year"</span><span class="p">)</span>
</pre></div>
<object data="posts/nyc-shootings-python-version/murders-by-coordinates-and-year.html" height="650" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
</div>
<div class="outline-2" id="outline-container-org923478a">
<h2 id="org923478a">Victims and Perpetrators</h2>
<div class="outline-text-2" id="text-org923478a"></div>
<div class="outline-3" id="outline-container-org4fdbf35">
<h3 id="org4fdbf35">Perpetrators</h3>
<div class="outline-text-3" id="text-org4fdbf35"></div>
<div class="outline-4" id="outline-container-org35ed0f5">
<h4 id="org35ed0f5">PERP_AGE_GROUP</h4>
<div class="outline-text-4" id="text-org35ed0f5">
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">PERP_AGE_GROUP</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">PERP_AGE_GROUP</th>
<th class="org-right" scope="col">count</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">nan</td>
<td class="org-right">9344</td>
</tr>
<tr>
<td class="org-right">18-24</td>
<td class="org-right">5844</td>
</tr>
<tr>
<td class="org-right">25-44</td>
<td class="org-right">5202</td>
</tr>
<tr>
<td class="org-right">UNKNOWN</td>
<td class="org-right">3148</td>
</tr>
<tr>
<td class="org-right">&lt;18</td>
<td class="org-right">1463</td>
</tr>
<tr>
<td class="org-right">45-64</td>
<td class="org-right">535</td>
</tr>
<tr>
<td class="org-right">65+</td>
<td class="org-right">57</td>
</tr>
<tr>
<td class="org-right">1020</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">940</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">224</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-4" id="outline-container-org161378c">
<h4 id="org161378c">PEPR_SEX</h4>
<div class="outline-text-4" id="text-org161378c">
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">PERP_SEX</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">PERP_SEX</th>
<th class="org-right" scope="col">count</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">M</td>
<td class="org-right">14416</td>
</tr>
<tr>
<td class="org-left">nan</td>
<td class="org-right">9310</td>
</tr>
<tr>
<td class="org-left">U</td>
<td class="org-right">1499</td>
</tr>
<tr>
<td class="org-left">F</td>
<td class="org-right">371</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-4" id="outline-container-org8c7669f">
<h4 id="org8c7669f">PERP_RACE</h4>
<div class="outline-text-4" id="text-org8c7669f">
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">PERP_RACE</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">PERP_RACE</th>
<th class="org-right" scope="col">count</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">BLACK</td>
<td class="org-right">10668</td>
</tr>
<tr>
<td class="org-left">nan</td>
<td class="org-right">9310</td>
</tr>
<tr>
<td class="org-left">WHITE HISPANIC</td>
<td class="org-right">2164</td>
</tr>
<tr>
<td class="org-left">UNKNOWN</td>
<td class="org-right">1836</td>
</tr>
<tr>
<td class="org-left">BLACK HISPANIC</td>
<td class="org-right">1203</td>
</tr>
<tr>
<td class="org-left">WHITE</td>
<td class="org-right">272</td>
</tr>
<tr>
<td class="org-left">ASIAN / PACIFIC ISLANDER</td>
<td class="org-right">141</td>
</tr>
<tr>
<td class="org-left">AMERICAN INDIAN/ALASKAN NATIVE</td>
<td class="org-right">2</td>
</tr>
</tbody>
</table>
<p>It looks like besides the <code>NaN</code> values, missing data is also classified as <code>U</code> or <code>UNKNOWN</code>.</p>
</div>
</div>
<div class="outline-4" id="outline-container-org6e11a1e">
<h4 id="org6e11a1e">Handling the Unknowns</h4>
<div class="outline-text-4" id="text-org6e11a1e">
<p>Let's try and unify the missing values.</p>
<div class="highlight">
<pre><span></span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">PERP_AGE_GROUP</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span> <span class="o">=</span> <span class="s2">"UNKNOWN"</span>
<span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">PERP_AGE_GROUP</span> <span class="o">==</span> <span class="s2">"U"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"UNKNOWN"</span>

<span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">PERP_AGE_GROUP</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">PERP_AGE_GROUP</th>
<th class="org-right" scope="col">count</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">UNKNOWN</td>
<td class="org-right">12492</td>
</tr>
<tr>
<td class="org-right">18-24</td>
<td class="org-right">5844</td>
</tr>
<tr>
<td class="org-right">25-44</td>
<td class="org-right">5202</td>
</tr>
<tr>
<td class="org-right">&lt;18</td>
<td class="org-right">1463</td>
</tr>
<tr>
<td class="org-right">45-64</td>
<td class="org-right">535</td>
</tr>
<tr>
<td class="org-right">65+</td>
<td class="org-right">57</td>
</tr>
<tr>
<td class="org-right">1020</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">940</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">224</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">PERP_SEX</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span> <span class="o">=</span> <span class="s2">"UNKNOWN"</span>
<span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">PERP_SEX</span> <span class="o">==</span> <span class="s2">"U"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"UNKNOWN"</span>

<span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">PERP_SEX</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">PERP_SEX</th>
<th class="org-right" scope="col">count</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">M</td>
<td class="org-right">14416</td>
</tr>
<tr>
<td class="org-left">UNKNOWN</td>
<td class="org-right">10809</td>
</tr>
<tr>
<td class="org-left">F</td>
<td class="org-right">371</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">PERP_RACE</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span> <span class="o">=</span> <span class="s2">"UNKNOWN"</span>
<span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">PERP_RACE</span> <span class="o">==</span> <span class="s2">"U"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"UNKNOWN"</span>

<span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">PERP_RACE</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">PERP_RACE</th>
<th class="org-right" scope="col">count</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">UNKNOWN</td>
<td class="org-right">11166</td>
</tr>
<tr>
<td class="org-left">BLACK</td>
<td class="org-right">10650</td>
</tr>
<tr>
<td class="org-left">WHITE HISPANIC</td>
<td class="org-right">2164</td>
</tr>
<tr>
<td class="org-left">BLACK HISPANIC</td>
<td class="org-right">1201</td>
</tr>
<tr>
<td class="org-left">WHITE</td>
<td class="org-right">272</td>
</tr>
<tr>
<td class="org-left">ASIAN / PACIFIC ISLANDER</td>
<td class="org-right">141</td>
</tr>
<tr>
<td class="org-left">AMERICAN INDIAN/ALASKAN NATIVE</td>
<td class="org-right">2</td>
</tr>
</tbody>
</table>
<p>So, the first thing we can notice is that the <code>UNKNOWN</code> counts don't match so sometims some attributes were known but not others, so they don't just represent cases where the perpetrator wasn't caught like I thought it might be. The second thing is that for age and race the unknowns have the highest counts. For all three categories the numbers of unknowns are so high that it's hard to say how they might affect the cases where the values are known.</p>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org2c74e99">
<h3 id="org2c74e99">Victims</h3>
<div class="outline-text-3" id="text-org2c74e99"></div>
<div class="outline-4" id="outline-container-org4d6e561">
<h4 id="org4d6e561">VIC_AGE_GROUP</h4>
<div class="outline-text-4" id="text-org4d6e561">
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">VIC_AGE_GROUP</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">VIC_AGE_GROUP</th>
<th class="org-right" scope="col">count</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">UNKNOWN</td>
<td class="org-right">10863</td>
</tr>
<tr>
<td class="org-right">25-44</td>
<td class="org-right">6500</td>
</tr>
<tr>
<td class="org-right">18-24</td>
<td class="org-right">5389</td>
</tr>
<tr>
<td class="org-right">&lt;18</td>
<td class="org-right">1657</td>
</tr>
<tr>
<td class="org-right">45-64</td>
<td class="org-right">1070</td>
</tr>
<tr>
<td class="org-right">65+</td>
<td class="org-right">117</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-4" id="outline-container-orgaffb1be">
<h4 id="orgaffb1be">VIC_SEX</h4>
<div class="outline-text-4" id="text-orgaffb1be">
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">VIC_SEX</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">VIC_SEX</th>
<th class="org-right" scope="col">count</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">M</td>
<td class="org-right">13182</td>
</tr>
<tr>
<td class="org-left">UNKNOWN</td>
<td class="org-right">10809</td>
</tr>
<tr>
<td class="org-left">F</td>
<td class="org-right">1598</td>
</tr>
<tr>
<td class="org-left">U</td>
<td class="org-right">7</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-4" id="outline-container-org7e13425">
<h4 id="org7e13425">VIC_RACE</h4>
<div class="outline-text-4" id="text-org7e13425">
<div class="highlight">
<pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">VIC_RACE</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">VIC_RACE</th>
<th class="org-right" scope="col">count</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">UNKNOWN</td>
<td class="org-right">10851</td>
</tr>
<tr>
<td class="org-left">BLACK</td>
<td class="org-right">9962</td>
</tr>
<tr>
<td class="org-left">WHITE HISPANIC</td>
<td class="org-right">2515</td>
</tr>
<tr>
<td class="org-left">BLACK HISPANIC</td>
<td class="org-right">1528</td>
</tr>
<tr>
<td class="org-left">WHITE</td>
<td class="org-right">485</td>
</tr>
<tr>
<td class="org-left">ASIAN / PACIFIC ISLANDER</td>
<td class="org-right">249</td>
</tr>
<tr>
<td class="org-left">AMERICAN INDIAN/ALASKAN NATIVE</td>
<td class="org-right">6</td>
</tr>
</tbody>
</table>
<p>Somewhat unexpectedly, the unknowns are also alarmingly high for the victims, suggesting that they represent poor case records and perhaps the demographic information isn't reliable enough to be useful.</p>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgb7deeb6">
<h2 id="orgb7deeb6">Sources</h2>
<div class="outline-text-2" id="text-orgb7deeb6">
<ul class="org-ul">
<li><a href="https://commons.wikimedia.org/wiki/File:5_Boroughs_Labels_New_York_City_Map.svg">New York City Map</a> via WikiMedia Commons</li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/bubba-sort-page-1/index.html">I, Bubba</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/bubba-sort-page-1/index.html" rel="bookmark"><time class="published dt-published" datetime="2023-03-16T19:54:06-07:00" itemprop="datePublished" title="2023-03-16 19:54">2023-03-16 19:54</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<p><img alt="Bubba Panel One" src="posts/bubba-sort-page-1/bubba_001_small.webp"></p>
<p><img alt="Bubba Panel Two" src="posts/bubba-sort-page-1/bubba_002_1.webp"></p>
<p><img alt="Panel Three" src="posts/bubba-sort-page-1/bubba_003.webp"></p>
<p><a href="posts/bubba-sort-page-2/index.html">Next Bubba</a></p>
<p><a href="pages/bubba-sort/bubba-sort-pages/index.html">Table of Contents</a></p>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/activity-selector-implementation/index.html">Activity Selector Implementations</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/activity-selector-implementation/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-09-12T16:11:44-07:00" itemprop="datePublished" title="2022-09-12 16:11">2022-09-12 16:11</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/activity-selector-implementation/index.html#org2d3927d">Example Data</a></li>
<li><a href="posts/activity-selector-implementation/index.html#org64fdf16">A Recursive Selector</a></li>
<li><a href="posts/activity-selector-implementation/index.html#orgcfdc6ad">An Iterative Selector</a></li>
</ul>
</div>
</div>
<div class="highlight">
<pre><span></span><span class="c1"># from pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">contain_exactly</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
</pre></div>
<div class="outline-2" id="outline-container-org2d3927d">
<h2 id="org2d3927d">Example Data</h2>
<div class="outline-text-2" id="text-org2d3927d">
<div class="highlight">
<pre><span></span><span class="n">PADDING</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="n">PADDING</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span>
<span class="n">finish</span> <span class="o">=</span> <span class="p">[</span><span class="n">PADDING</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span>
<span class="n">expected_activities</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">start</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">finish</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org64fdf16">
<h2 id="org64fdf16">A Recursive Selector</h2>
<div class="outline-text-2" id="text-org64fdf16">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">recursive_activity_selector</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Selects the optimal activities</span>

<span class="sd">    Note:</span>
<span class="sd">     This assumes that the start and finish lists are pre-padded with </span>
<span class="sd">    zeros (1 each).</span>


<span class="sd">    Args:</span>
<span class="sd">     start: list of start times for each activity</span>
<span class="sd">     finish: list of end times for each activity</span>
<span class="sd">     k: the current activity (index)</span>

<span class="sd">    Returns:</span>
<span class="sd">     optimal list of activities</span>
<span class="sd">    """</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">m</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="ow">and</span> <span class="n">start</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">finish</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
        <span class="n">m</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">m</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">+</span> <span class="n">recursive_activity_selector</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[]</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">activities</span> <span class="o">=</span> <span class="n">recursive_activity_selector</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">activities</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected_activities</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">activities</span><span class="p">)</span>
</pre></div>
<pre class="example">
[1, 4, 8, 11]
</pre></div>
</div>
<div class="outline-2" id="outline-container-orgcfdc6ad">
<h2 id="orgcfdc6ad">An Iterative Selector</h2>
<div class="outline-text-2" id="text-orgcfdc6ad">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">iterative_activity_selector</span><span class="p">(</span><span class="n">start</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">finish</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""An iterative activity selector</span>

<span class="sd">    Note:</span>
<span class="sd">     This assumes that the start and finish lists are pre-padded with </span>
<span class="sd">    dummy values.</span>

<span class="sd">    Args:</span>
<span class="sd">     start: list of starting times</span>
<span class="sd">     finish: list of end times</span>
<span class="sd">    """</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
    <span class="n">activities</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">start</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">finish</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
            <span class="n">activities</span> <span class="o">+=</span> <span class="p">[</span><span class="n">m</span><span class="p">]</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">m</span>
    <span class="k">return</span> <span class="n">activities</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">activities</span> <span class="o">=</span> <span class="n">iterative_activity_selector</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">activities</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected_activities</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">activities</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/the-activity-selection-problem/index.html">The Activity Selection Problem</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/the-activity-selection-problem/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-08-04T17:25:35-07:00" itemprop="datePublished" title="2022-08-04 17:25">2022-08-04 17:25</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/the-activity-selection-problem/index.html#org603e2f0">What is the Activity Selection Problem?</a></li>
<li><a href="posts/the-activity-selection-problem/index.html#org48ca1ad">The Greedy Choice</a></li>
<li><a href="posts/the-activity-selection-problem/index.html#org003509c">The Recursive Activity Selector</a>
<ul>
<li><a href="posts/the-activity-selection-problem/index.html#org8bcb546">Padding The Start</a></li>
</ul>
</li>
<li><a href="posts/the-activity-selection-problem/index.html#org8771e27">The Iterative Activity Selector</a></li>
<li><a href="posts/the-activity-selection-problem/index.html#org0d76ae0">Sources</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org603e2f0">
<h2 id="org603e2f0">What is the Activity Selection Problem?</h2>
<div class="outline-text-2" id="text-org603e2f0">
<ul class="org-ul">
<li>In this problem we have a set of <i>n</i> activities \(S = \{a_1, a_2, \ldots, a_n\}\).</li>
<li>Assume the activities are sorted by increasing finish time</li>
<li>Each activity has a start time \(s_i\) and a finish time \(f_i\)</li>
<li>Only one activity can happen at a time.</li>
<li>Two activities are <i>compatible</i> if the earlier event finishes before the start time of the other event.</li>
</ul>
<p>The problem we want to solve is finding the most compatible activities we can from our set of activities. This differs from a more common scheduling problem in that the times are fixed - we can't re-arrange activities to make them fit so they either can happen or they can't.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org48ca1ad">
<h2 id="org48ca1ad">The Greedy Choice</h2>
<div class="outline-text-2" id="text-org48ca1ad">
<p><a href="posts/clrs/index.html">CLRS</a> goes into the more formal aspects of finding the optimal substructure and proving that a greedy strategy works, but in this case the reasoning is fairly intuitive (and I didn't find the proof so easy to follow) so I'll skip the formal stuff. The thing to recognize is just that the sooner the first activity you schedule finishes the more time there is for other activities. So if after each activity you pick you the next pick you make is the remaining activity that doesn't collide with the current pick and finishes first you will be maximizing the number of activities that you can schedule.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org003509c">
<h2 id="org003509c">The Recursive Activity Selector</h2>
<div class="outline-text-2" id="text-org003509c">
<pre id="recursive-activity-selector" style="display:hidden;">
\begin{algorithm}
\caption{Recursive Activity Selector}
\begin{algorithmic}
\REQUIRE The activities are sorted in non-decreasing order of finish time
\INPUT $s$: The array of start times for the activities.
\INPUT $f$: The array of finish times for the activities.
\INPUT $k$: The last activity selected so far.
\INPUT $n$: The number of activities.
\OUTPUT The activities that maximize the number of compatible activities.
\PROCEDURE{RecursiveActivitySelector}{$s, f, k, n$}

\STATE \(m \gets k + 1\)

\WHILE {\(m \le n\) and \(s[m] &lt; f[k]\)}
  \STATE \(m \gets m + 1\)
\ENDWHILE

\IF {\(m \le n\)}
  \RETURN \(\{a_m\} \cup \) \textsc{RecursiveActivitySelector}(\(s, f, m, n\))
\ELSE
  \RETURN \{\}
\ENDIF

\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>
<p><b>Note:</b> The activity set (\(\{a_1, a_2, \ldots, a_n\}\)) is treated as a global collection so it is used in the function but not passed in as an argument.</p>
</div>
<div class="outline-3" id="outline-container-org8bcb546">
<h3 id="org8bcb546">Padding The Start</h3>
<div class="outline-text-3" id="text-org8bcb546">
<p>Because the recursive algorithm is looking for the next earliest finish time after the first event we need to pad the activities with a dummy activity that has a finish time of 0 (\(f_0 = 0\)) and then when the function is first called the <i>k</i> value is set to 0:</p>
<p>\[ RecursiveActivitySelector(s, f, 0, n) \]</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org8771e27">
<h2 id="org8771e27">The Iterative Activity Selector</h2>
<div class="outline-text-2" id="text-org8771e27">
<pre id="greedy-activity-selector" style="display:hidden;">
\begin{algorithm}
\caption{Greedy Activity Selector}
\begin{algorithmic}
\REQUIRE The activities are sorted in non-decreasing order of finish time
\INPUT $s$: The array of start times for the activities.
\INPUT $f$: The array of finish times for the activities.
\OUTPUT The activities that maximize the number of compatible activities.
\PROCEDURE{GreedyActivitySelector}{\(s, f\)}

\STATE \(n \gets s.length \)
\STATE \(A \gets \{a_1\} \)
\STATE \(k \gets 1 \)

\FOR {\(m  \in \{2, \ldots, n \}\)}
  \IF {\( s[m] \ge f[k] \)}
    \STATE \(A \gets A \cup \{a_m\}\)
    \STATE \(k \gets m \)
  \ENDIF
\ENDFOR

\RETURN \(A\)
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre></div>
</div>
<div class="outline-2" id="outline-container-org0d76ae0">
<h2 id="org0d76ae0">Sources</h2>
<div class="outline-text-2" id="text-org0d76ae0">
<ul class="org-ul">
<li><a href="posts/clrs/index.html">Introduction To Algorithms (CLRS)</a></li>
</ul>
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("recursive-activity-selector"));
});
</script>
<script>

window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("greedy-activity-selector"));
});
</script></div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/weighted-completion-times/index.html">Weighted Completion Times</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/weighted-completion-times/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-07-20T16:33:47-07:00" itemprop="datePublished" title="2022-07-20 16:33">2022-07-20 16:33</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/weighted-completion-times/index.html#org2b1813f">The Weighted Scheduling Problem</a>
<ul>
<li><a href="posts/weighted-completion-times/index.html#org30853c5">Completion Time</a></li>
</ul>
</li>
<li><a href="posts/weighted-completion-times/index.html#org7306671">Greedy Metrics</a></li>
<li><a href="posts/weighted-completion-times/index.html#org2e7ab7b">Source</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org2b1813f">
<h2 id="org2b1813f">The Weighted Scheduling Problem</h2>
<div class="outline-text-2" id="text-org2b1813f">
<p>This is a look at the problem of arranging a schedule of jobs so that their completion times are lowest, while accounting for different priorities for each job.</p>
<p><b>Input:</b> \(n\) jobs with positive lengths \(l_1, l_2, \ldots, l_n\) and positive weights \(w_1, w_2,\ldots,w_n\). The larger the weight, the higher the priority.</p>
<p><b>Output:</b> A job sequence (the schedule) that minimizes the sum of the weight completion times \(w_1l_1 + w_2 l_2 + \cdots + w_n l_n\).</p>
</div>
<div class="outline-3" id="outline-container-org30853c5">
<h3 id="org30853c5">Completion Time</h3>
<div class="outline-text-3" id="text-org30853c5">
<p>The output above is a little confusing (I'll have to re-write that later). What we're minimizing is the sum of <i>completion times</i>. A job's completion time is the total of all the times for the jobs that precede it as well as the time to finish the job. This means the completion time for the first job is the time to run that job, the completion time for the second job is the time for the first job plus the time for the second job, and so on.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org7306671">
<h2 id="org7306671">Greedy Metrics</h2>
<div class="outline-text-2" id="text-org7306671">
<p>The greedy method for this problem involves finding a metric such that when the jobs are sorted by the metric they form the optimal schedule. One possible metric is the <i>Greedy Difference</i> which is the weight for a job minus the time the job takes (\(w_i - l_i\)).</p>
<p>Another possible metric is the <i>Greedy Ratio</i> which is the ratio of job-weight to job-length (\(\frac{w_i}{l_i}\)).</p>
</div>
</div>
<div class="outline-2" id="outline-container-org2e7ab7b">
<h2 id="org2e7ab7b">Source</h2>
<div class="outline-text-2" id="text-org2e7ab7b">
<ul class="org-ul">
<li><a href="posts/algorithms-illuminated-part-3/index.html">Algorithms Illuminated - Part III: Greedy Algorithms and Dynamic Programming</a></li>
</ul>
</div>
</div>
</div>
</article>
</div>
<ul class="pager postindexpager clearfix">
<li class="next"><a href="index-7.html" rel="next">Older posts</a></li>
</ul>
<link href="https://cdn.jsdelivr.net/npm/pseudocode@2.4.1/build/pseudocode.min.css" rel="stylesheet"><!--End of body content-->
<footer id="footer">Scribbles by <a href="mailto:cloisteredmonkey.jmark@slmail.me">The Cloistered Monkey</a> Â© 2024 - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a>
<div id="license" xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/"><span property="dct:title">Ape-Iron</span> is licensed under <a href="http://creativecommons.org/licenses/by-sa/4.0/?ref=chooser-v1" rel="license noopener noreferrer" style="display:inline-block;" target="_blank">CC BY-SA 4.0 <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"><img src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1"></a></div>
</footer>
</div>
<script src="assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script></div>
</body>
</html>
