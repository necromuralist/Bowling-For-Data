<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Striking out for data.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Bowling For Data</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="rss.xml">
<link rel="canonical" href="https://necromuralist.github.io/Bowling-For-Data/index.html">
<link rel="next" href="index-7.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><link rel="prefetch" href="posts/bubba-sort-page-2/index.html" type="text/html">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.css">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-light
bg-light
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href=".">

            <span id="blog-title">Bowling For Data</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="pages/" class="nav-link">Pages</a>
                </li>
<li class="nav-item">
<a href="archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="categories/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="rss.xml" class="nav-link">RSS feed</a>
            </li>
<li class="nav-item dropdown">
<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Monkey Pages</a>
            <div class="dropdown-menu">
                    <a href="https://necromuralist.github.io/" class="dropdown-item">The Cloistered Monkey</a>
                    <a href="https://necromuralist.github.io/Ape-Iron/" class="dropdown-item">Ape Iron</a>
                    <a href="https://necromuralist.github.io/Beach-Pig-Thigh/" class="dropdown-item">Beach-Pig Rump &amp; Thigh</a>
                    <a href="https://necromuralist.github.io/Neurotic-Networking/" class="dropdown-item">Neurotic Networking</a>
                    <a href="https://necromuralist.github.io/Visions-Voices-Data/" class="dropdown-item">Visions, Voices, Data</a>
            </div>

                
            </li>
</ul>
<!-- DuckDuckGo custom search --><form method="get" id="search" action="https://duckduckgo.com/" class="navbar-form pull-left">
 <input type="hidden" name="sites" value="https://necromuralist.github.io/Bowling-For-Data/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="Searchâ€¦" class="span2" style="margin-top: 4px;"><input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
</form>
 <!-- End of custom search -->
 

            <ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/bubba-sort-page-2/index.html" class="u-url">A Ray</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/bubba-sort-page-2/index.html" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-24T16:57:36-07:00" itemprop="datePublished" title="2023-03-24 16:57">2023-03-24 16:57</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>
<img src="posts/bubba-sort-page-2/bubba-004-1250.png" alt="Panel 4"></p>

<p>
<img src="posts/bubba-sort-page-2/bubba-005-1250px.png" alt="Panel 5"></p>

<p>
<img src="posts/bubba-sort-page-2/bubba-006.webp" alt="Panel 6"></p>

<p>
<a href="posts/bubba-sort-page-1/">Previous Bubba</a>
</p>

<p>
<a href="pages/bubba-sort/bubba-sort-pages/">Table of Contents</a>
</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/nyc-shootings-python-version/index.html" class="u-url">NYC Shootings (Python Version)</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/nyc-shootings-python-version/index.html" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-22T13:18:14-07:00" itemprop="datePublished" title="2023-03-22 13:18">2023-03-22 13:18</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li>
<a href="posts/nyc-shootings-python-version/index.html#org64b4ed3">NYPD Shooting Incident Data Version 2 (with python)</a>
<ul>
<li><a href="posts/nyc-shootings-python-version/index.html#org728dfee">Imports and Setup</a></li>
</ul>
</li>
<li>
<a href="posts/nyc-shootings-python-version/index.html#orgd8e8a83">The Data</a>
<ul>
<li><a href="posts/nyc-shootings-python-version/index.html#org8f426c3">Loading It</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#orgf539cbf">The Columns</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#orgce6f148">Missing Data</a></li>
</ul>
</li>
<li><a href="posts/nyc-shootings-python-version/index.html#org72407fc">Incident Key</a></li>
<li>
<a href="posts/nyc-shootings-python-version/index.html#org3157945">OCCUR_DATE and OCCUR_TIME</a>
<ul>
<li><a href="posts/nyc-shootings-python-version/index.html#org4497f90">Shootings By Month</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#org9ab793a">90 Day Rolling Window</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#orgb7f75f1">By Year</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#org5b51f8f">Monthly By Year</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#orgd4e184e">Medain By Month</a></li>
</ul>
</li>
<li>
<a href="posts/nyc-shootings-python-version/index.html#orgec616b1">Location</a>
<ul>
<li>
<a href="posts/nyc-shootings-python-version/index.html#orge08e565">Descriptions</a>
<ul>
<li><a href="posts/nyc-shootings-python-version/index.html#orga4dc220">BORO</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#orgf1a2579">PRECINCT &amp; JURISDICTION_CODE</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#org1ec5757">LOCATION_DESC</a></li>
</ul>
</li>
<li>
<a href="posts/nyc-shootings-python-version/index.html#orgd7b6677">Coordinates</a>
<ul>
<li><a href="posts/nyc-shootings-python-version/index.html#org424e5d3">X_COORD_CD &amp; Y_COORD_CD</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#org98096f1">Latitude &amp; Longitude</a></li>
</ul>
</li>
<li><a href="posts/nyc-shootings-python-version/index.html#org0377c8b">With GeoPandas</a></li>
</ul>
</li>
<li>
<a href="posts/nyc-shootings-python-version/index.html#org942e262">Murder or Not</a>
<ul>
<li><a href="posts/nyc-shootings-python-version/index.html#org62c52a3">By Year</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#org9a5fbfc">By Month</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#orgab955bf">By Coordinate</a></li>
</ul>
</li>
<li>
<a href="posts/nyc-shootings-python-version/index.html#orgdcaac13">Victims and Perpetrators</a>
<ul>
<li>
<a href="posts/nyc-shootings-python-version/index.html#orgf0dd83c">Perpetrators</a>
<ul>
<li><a href="posts/nyc-shootings-python-version/index.html#org3335cad">PERP_AGE_GROUP</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#orgaa382e6">PEPR_SEX</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#org489fecc">PERP_RACE</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#org9c9c574">Handling the Unknowns</a></li>
</ul>
</li>
<li>
<a href="posts/nyc-shootings-python-version/index.html#orgd13c407">Victims</a>
<ul>
<li><a href="posts/nyc-shootings-python-version/index.html#org5387ebd">VIC_AGE_GROUP</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#orge9d1cfb">VIC_SEX</a></li>
<li><a href="posts/nyc-shootings-python-version/index.html#org1f69448">VIC_RACE</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="posts/nyc-shootings-python-version/index.html#orgfc57088">Sources</a></li>
</ul>
</div>
</div>
<div id="outline-container-org64b4ed3" class="outline-2">
<h2 id="org64b4ed3">NYPD Shooting Incident Data Version 2 (with python)</h2>
<div class="outline-text-2" id="text-org64b4ed3">
<p>
This is a replication (more or less) of the <a href="posts/nypd-shooting-incident-data/">NYPD Shooting Incident Data</a> post which we did using R but this time we'll use python and pandas instead. Once again we'll be looking at the <a href="https://catalog.data.gov/dataset/nypd-shooting-incident-data-historic">NYPD Shooting Incident Data (Historic)</a> from the <a href="https://catalog.data.gov/dataset">DATA.gov</a> catalog of datasets, which lists every shooting from 2006 through the last updated incident (as of March 22, 2023 it shows that it was last updated June 9, 2022 but we'll have to look at it to see what the date of the last incident was).
</p>
</div>

<div id="outline-container-org728dfee" class="outline-3">
<h3 id="org728dfee">Imports and Setup</h3>
<div class="outline-text-3" id="text-org728dfee">
<div class="highlight"><pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="kn">import</span> <span class="nn">altair</span>
<span class="kn">import</span> <span class="nn">geopandas</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="kn">from</span> <span class="nn">graeae.visualization.altair_helpers</span> <span class="kn">import</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">save_chart</span>
</pre></div>

<p>
First, let's double-check which version of python we're using.
</p>

<div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
</pre></div>

<pre class="example">
3.9.9 (main, Dec  3 2021, 01:15:49) 
[GCC 10.2.1 20210110]
</pre>


<p>
We're running python 3.9.9. I was running it in pypy but for some reason the pandas' <code>groupby</code> method would hang so this is done in cPython.
</p>

<div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">altair</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
</pre></div>

<pre class="example">
5.0.0rc1
</pre>


<p>
I found out after I'd been struggling with altair for a little while that they're about to make a major release that breaks some of the ways you use it (in the prior versions). Since it's been a while since I've used altair I decided to go with the newer, upcoming version rather than re-learn the current one and then learn the new version of altair once it's released.
</p>

<p>
This next bit is a little setup to make nicer tables.
</p>

<div class="highlight"><pre><span></span><span class="n">TABLE</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">tabulate</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">"keys"</span><span class="p">,</span> <span class="n">showindex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">"orgtbl"</span><span class="p">)</span>
</pre></div>

<p>
This is to help with the plotting.
</p>

<div class="highlight"><pre><span></span><span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"nyc-shootings-python-version"</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="n">output_path</span><span class="p">(</span><span class="n">SLUG</span><span class="p">)</span>
<span class="n">save_it</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">save_chart</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">650</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-orgd8e8a83" class="outline-2">
<h2 id="orgd8e8a83">The Data</h2>
<div class="outline-text-2" id="text-orgd8e8a83">
</div>
<div id="outline-container-org8f426c3" class="outline-3">
<h3 id="org8f426c3">Loading It</h3>
<div class="outline-text-3" id="text-org8f426c3">
<p>
The data is available to download as a CSV so we'll pass the URL for the CSV to pandas and make a dataframe.
</p>

<div class="highlight"><pre><span></span><span class="n">URL</span> <span class="o">=</span> <span class="s2">"https://data.cityofnewyork.us/api/views/833y-fsy8/rows.csv?accessType=DOWNLOAD"</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Rows: </span><span class="si">{</span><span class="n">rows</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="se">\t</span><span class="s2">Columns: </span><span class="si">{</span><span class="n">columns</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>

<pre class="example">
Rows: 25,596	Columns: 19
</pre>
</div>
</div>

<div id="outline-container-orgf539cbf" class="outline-3">
<h3 id="orgf539cbf">The Columns</h3>
<div class="outline-text-3" id="text-orgf539cbf">
<p>
We'll start looking at the data by examining what's in the columns. We saw from the data frame's shape that we have 19 columns, how many of them does pandas think are numeric?
</p>

<div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">(),</span> <span class="n">showindex</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Â </th>
<th scope="col" class="org-right">INCIDENT_KEY</th>
<th scope="col" class="org-right">PRECINCT</th>
<th scope="col" class="org-right">JURISDICTION_CODE</th>
<th scope="col" class="org-right">X_COORD_CD</th>
<th scope="col" class="org-right">Y_COORD_CD</th>
<th scope="col" class="org-right">Latitude</th>
<th scope="col" class="org-right">Longitude</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">count</td>
<td class="org-right">25596</td>
<td class="org-right">25596</td>
<td class="org-right">25594</td>
<td class="org-right">25596</td>
<td class="org-right">25596</td>
<td class="org-right">25596</td>
<td class="org-right">25596</td>
</tr>
<tr>
<td class="org-left">mean</td>
<td class="org-right">1.12383e+08</td>
<td class="org-right">65.8694</td>
<td class="org-right">0.331601</td>
<td class="org-right">1.00945e+06</td>
<td class="org-right">207894</td>
<td class="org-right">40.7372</td>
<td class="org-right">-73.909</td>
</tr>
<tr>
<td class="org-left">std</td>
<td class="org-right">6.78612e+07</td>
<td class="org-right">27.2019</td>
<td class="org-right">0.742266</td>
<td class="org-right">18421.4</td>
<td class="org-right">31857.4</td>
<td class="org-right">0.087447</td>
<td class="org-right">0.0664265</td>
</tr>
<tr>
<td class="org-left">min</td>
<td class="org-right">9.95324e+06</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">914928</td>
<td class="org-right">125757</td>
<td class="org-right">40.5116</td>
<td class="org-right">-74.2493</td>
</tr>
<tr>
<td class="org-left">25%</td>
<td class="org-right">6.15936e+07</td>
<td class="org-right">44</td>
<td class="org-right">0</td>
<td class="org-right">1.00001e+06</td>
<td class="org-right">182782</td>
<td class="org-right">40.6683</td>
<td class="org-right">-73.9431</td>
</tr>
<tr>
<td class="org-left">50%</td>
<td class="org-right">8.64373e+07</td>
<td class="org-right">69</td>
<td class="org-right">0</td>
<td class="org-right">1.00772e+06</td>
<td class="org-right">194038</td>
<td class="org-right">40.6991</td>
<td class="org-right">-73.9153</td>
</tr>
<tr>
<td class="org-left">75%</td>
<td class="org-right">1.66661e+08</td>
<td class="org-right">81</td>
<td class="org-right">0</td>
<td class="org-right">1.01684e+06</td>
<td class="org-right">239429</td>
<td class="org-right">40.8238</td>
<td class="org-right">-73.8824</td>
</tr>
<tr>
<td class="org-left">max</td>
<td class="org-right">2.3849e+08</td>
<td class="org-right">123</td>
<td class="org-right">2</td>
<td class="org-right">1.06682e+06</td>
<td class="org-right">271128</td>
<td class="org-right">40.9108</td>
<td class="org-right">-73.702</td>
</tr>
</tbody>
</table>
<p>
Just seven of them, and four are coordinates and the other three are categorical. This isn't really surprising, since the data isn't measuring anything but is rather a listing of shooting incidents reported (each row represents a single incident).
</p>

<p>
There's a table on the <a href="https://data.cityofnewyork.us/Public-Safety/NYPD-Shooting-Incident-Data-Historic-/833y-fsy8">NYPD-Shooting-Incident-Data</a> page that describes the columns.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Column Name</th>
<th scope="col" class="org-left">Description</th>
<th scope="col" class="org-left">Type</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">INCIDENT_KEY</td>
<td class="org-left">Randomly generated persistent ID for each arrest</td>
<td class="org-left">Plain Text</td>
</tr>
<tr>
<td class="org-left">OCCUR_DATE</td>
<td class="org-left">Exact date of the shooting incident</td>
<td class="org-left">Date &amp; Time</td>
</tr>
<tr>
<td class="org-left">OCCUR_TIME</td>
<td class="org-left">Exact time of the shooting incident</td>
<td class="org-left">Plain Text</td>
</tr>
<tr>
<td class="org-left">BORO</td>
<td class="org-left">Borough where the shooting incident occurred</td>
<td class="org-left">Plain Text</td>
</tr>
<tr>
<td class="org-left">PRECINCT</td>
<td class="org-left">Precinct where the shooting incident occurred</td>
<td class="org-left">Plain Text</td>
</tr>
<tr>
<td class="org-left">JURISDICTIONAL_CODE</td>
<td class="org-left">Jurisdiction where it occurred</td>
<td class="org-left">Number</td>
</tr>
<tr>
<td class="org-left">LOCATION_DESC</td>
<td class="org-left">Location of the incident</td>
<td class="org-left">Plain Text</td>
</tr>
<tr>
<td class="org-left">STATISTICAL_MURDER_FLAG</td>
<td class="org-left">Victim died</td>
<td class="org-left">Checkbox</td>
</tr>
<tr>
<td class="org-left">PERP_AGE_GROUP</td>
<td class="org-left">Perpetrator's age within a category</td>
<td class="org-left">Plain Text</td>
</tr>
<tr>
<td class="org-left">PERP_SEX</td>
<td class="org-left">Pepetrator's sex.</td>
<td class="org-left">Plain Text</td>
</tr>
<tr>
<td class="org-left">PERP_RACE</td>
<td class="org-left">Perpetrator's race.</td>
<td class="org-left">Plain Text</td>
</tr>
<tr>
<td class="org-left">VIC_AGE_GROUP</td>
<td class="org-left">Victim's age with a category.</td>
<td class="org-left">Plain Text</td>
</tr>
<tr>
<td class="org-left">VIC_SEX</td>
<td class="org-left">Victim's sex.</td>
<td class="org-left">Plain Text</td>
</tr>
<tr>
<td class="org-left">VIC_RACE</td>
<td class="org-left">Victim's Race</td>
<td class="org-left">Plain Text</td>
</tr>
<tr>
<td class="org-left">X_COORD_CD</td>
<td class="org-left">Midblock X-coordinate for New York State Plane Coordinate System</td>
<td class="org-left">Plain Text</td>
</tr>
<tr>
<td class="org-left">Y_COORD_CD</td>
<td class="org-left">Midblock Y-coordinate</td>
<td class="org-left">Plain Text</td>
</tr>
<tr>
<td class="org-left">Latitude</td>
<td class="org-left">Latitude coordinate</td>
<td class="org-left">Number</td>
</tr>
<tr>
<td class="org-left">Longitude</td>
<td class="org-left">Longitude</td>
<td class="org-left">Number</td>
</tr>
<tr>
<td class="org-left">Lon_Lat</td>
<td class="org-left">Longitude and Latitude Coordinate for mapping</td>
<td class="org-left">Point</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgce6f148" class="outline-3">
<h3 id="orgce6f148">Missing Data</h3>
<div class="outline-text-3" id="text-orgce6f148">
<div class="highlight"><pre><span></span><span class="n">missing</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">data</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">missing</span> <span class="o">=</span> <span class="n">missing</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"Column"</span><span class="p">,</span>
	     <span class="mi">0</span><span class="p">:</span> <span class="s2">"Missing"</span><span class="p">})</span>

<span class="n">some_missing</span> <span class="o">=</span> <span class="n">missing</span><span class="p">[</span><span class="n">missing</span><span class="o">.</span><span class="n">Missing</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">some_missing</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">"Fraction"</span><span class="p">]</span> <span class="o">=</span> <span class="n">some_missing</span><span class="o">.</span><span class="n">Missing</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">some_missing</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Column</th>
<th scope="col" class="org-right">Missing</th>
<th scope="col" class="org-right">Fraction</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">JURISDICTION_CODE</td>
<td class="org-right">2</td>
<td class="org-right">7.81372e-05</td>
</tr>
<tr>
<td class="org-left">LOCATION_DESC</td>
<td class="org-right">14977</td>
<td class="org-right">0.58513</td>
</tr>
<tr>
<td class="org-left">PERP_AGE_GROUP</td>
<td class="org-right">9344</td>
<td class="org-right">0.365057</td>
</tr>
<tr>
<td class="org-left">PERP_SEX</td>
<td class="org-right">9310</td>
<td class="org-right">0.363729</td>
</tr>
<tr>
<td class="org-left">PERP_RACE</td>
<td class="org-right">9310</td>
<td class="org-right">0.363729</td>
</tr>
</tbody>
</table>
<p>
Most entries are missing location descriptions for some reason, and quite a lot of perpertator data is missing, possibly because they didn't catch whoever did the shooting in those cases.
</p>
</div>
</div>
</div>
<div id="outline-container-org72407fc" class="outline-2">
<h2 id="org72407fc">Incident Key</h2>
<div class="outline-text-2" id="text-org72407fc">
<p>
The incident key is an identifier for a specific incident so it's only really useful if you need to look up or refer to one or more of them, but we'll be looking at things in aggregate making them less useful for us, except maybe for looking at anomalies. Let's just make sure that the identifiers are unique as I'm asserting that they are.
</p>

<div class="highlight"><pre><span></span><span class="n">id_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">INCIDENT_KEY</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
<span class="n">incidents</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Identifiers: </span><span class="si">{</span><span class="n">id_count</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="se">\t</span><span class="s2">Incidents: </span><span class="si">{</span><span class="n">incidents</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"There are </span><span class="si">{</span><span class="n">incidents</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">id_count</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> more rows than incident IDs."</span><span class="p">)</span>
</pre></div>

<pre class="example">
Identifiers: 20,126	Incidents: 25,596
There are 5,470 more rows than incident IDs.
</pre>


<p>
It appears that I wasn't correct in my assumptionâ€¦ let's take a look at one of the incidents.
</p>

<div class="highlight"><pre><span></span><span class="n">counts</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">INCIDENT_KEY</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">up_counts</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">top</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">top_id</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Incident: </span><span class="si">{</span><span class="n">top_id</span><span class="si">}</span><span class="se">\t</span><span class="s2">Count: </span><span class="si">{</span><span class="n">top</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>

<pre class="example">
Incident: 173354054	Count: 18
</pre>


<p>
Inspecting the dataframe it looks like in some cases more than one person was shot per incident, so there's multiple rows (one per person shot) for a single incident. Kind of scary that eighteen people got shot at one incident, if my interpretation is correct, but that's life in the big city, I guess. Reading the <a href="https://data.cityofnewyork.us/api/views/833y-fsy8/files/e4e3d86c-348f-4a16-a17f-19480c089429?download=true&amp;filename=NYPD_Shootings_Incident_Level_Data_Footnotes.pdf">Footnotes</a> (link is to a PDF) it says:
</p>

<blockquote>
<p>
A shooting incident can have multiple victims involved and as a result duplicate INCIDENT_KEYs are produced.
</p>
</blockquote>

<p>
So it appears each row represents the victim of a shooting and each <code>INCIDENT_KEY</code> represents a shooting where one or more person was shot. The footnotes also note that only incidents where a victim was shot are included. If someone fired a gun but didn't hit anyone then it isn't represented in the data set.
</p>

<p>
<b><b>Note:</b></b> There's actually a slight discrepancy between the descriptions of the <code>INCIDENT_KEY</code> between the web-page and the PDF footnotes. According to the Web-Page the ID is for each arrest while the footnotes make it sound like they represent cases where there was at least one victim, whether or not someone was arrested. For our purposes this won't matter, since we're only using the data as a source for data visualization, but if one were really trying to understand what was happening in NYC knowing exactly what the data represents might be important (assuming not all cases with a shooting victim leads to an arrest).
</p>

<div class="highlight"><pre><span></span><span class="n">use_counts</span> <span class="o">=</span> <span class="n">up_counts</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">use_counts</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"INCIDENT_KEY"</span><span class="p">,</span>
		 <span class="nb">type</span><span class="o">=</span><span class="s2">"nominal"</span><span class="p">,</span>
		 <span class="n">sort</span><span class="o">=</span><span class="s2">"-y"</span><span class="p">,</span>
		 <span class="n">axis</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="kc">False</span><span class="p">)),</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"count"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"INCIDENT_KEY"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"nominal"</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"count"</span><span class="p">)]</span>
<span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
   <span class="n">title</span><span class="o">=</span><span class="s2">"Incidents with Multiple Shots"</span><span class="p">,</span>
   <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
   <span class="n">height</span><span class="o">=</span><span class="mi">525</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"multiple_shot_incidents"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/nyc-shootings-python-version/multiple_shot_incidents.html" style="width:100%" height="650">
  <p>Figure Missing</p>
</object>

<p>
It looks like a lot of entries have more than one row. Does this mean many incidents have more than one victim? More than one shooter?
</p>

<div class="highlight"><pre><span></span><span class="n">fractions</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">counts</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">fractions</span> <span class="o">=</span> <span class="n">fractions</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Percent of Rows"</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">"count"</span><span class="p">:</span> <span class="s2">"Rows"</span><span class="p">})</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">fractions</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Rows"</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="n">fractions</span><span class="p">[</span><span class="s2">"Percent of Rows"</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Percent of Rows"</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">70</span><span class="p">))),</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Rows"</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Percent of Rows"</span><span class="p">)])</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
		 <span class="n">title</span><span class="o">=</span><span class="s2">"Percent Of Incidents with Multiple Rows"</span><span class="p">,</span>
		 <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
		 <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"fraction_row_incidents"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/nyc-shootings-python-version/fraction_row_incidents.html" style="width:100%" height="650">
  <p>Figure Missing</p>
</object>

<p>
The majority of the incidents do have only one row in the dataset. Perhaps it's not as unusual as I think it is to have multiple people involved in a shooting.
</p>
</div>
</div>

<div id="outline-container-org3157945" class="outline-2">
<h2 id="org3157945">OCCUR_DATE and OCCUR_TIME</h2>
<div class="outline-text-2" id="text-org3157945">
<p>
There are two columns that tell us when the shooting is supposed to have happened.
</p>

<div class="highlight"><pre><span></span><span class="n">example</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">INCIDENT_KEY</span><span class="o">==</span><span class="n">top_id</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"OCCUR_DATE: </span><span class="si">{</span><span class="n">example</span><span class="o">.</span><span class="n">OCCUR_DATE</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">OCCUR_DATE</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"OCCUR_TIME: </span><span class="si">{</span><span class="n">example</span><span class="o">.</span><span class="n">OCCUR_TIME</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">OCCUR_TIME</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>
</pre></div>

<pre class="example">
OCCUR_DATE: 01/06/2018 (object)
OCCUR_TIME: 21:05:00 (object)
</pre>


<p>
Pandas interpreted both of these as strings, but it'd probably be more useful for us if they were datetime objects.
</p>

<div class="highlight"><pre><span></span><span class="n">MONTH</span><span class="p">,</span> <span class="n">DAY</span><span class="p">,</span> <span class="n">YEAR</span> <span class="o">=</span> <span class="s2">"%m"</span><span class="p">,</span> <span class="s2">"</span><span class="si">%d</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"%Y"</span>
<span class="n">HOUR</span><span class="p">,</span> <span class="n">MINUTE</span><span class="p">,</span> <span class="n">SECOND</span> <span class="o">=</span> <span class="s2">"%H"</span><span class="p">,</span> <span class="s2">"%M"</span><span class="p">,</span> <span class="s2">"%S"</span>
<span class="n">DATE_FORMAT</span> <span class="o">=</span> <span class="s2">"/"</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">MONTH</span><span class="p">,</span> <span class="n">DAY</span><span class="p">,</span> <span class="n">YEAR</span><span class="p">))</span>
<span class="n">TIME_FORMAT</span> <span class="o">=</span> <span class="s2">":"</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">HOUR</span><span class="p">,</span> <span class="n">MINUTE</span><span class="p">,</span> <span class="n">SECOND</span><span class="p">))</span>
<span class="n">FORMAT</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">DATE_FORMAT</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">TIME_FORMAT</span><span class="si">}</span><span class="s2">"</span>
<span class="n">DATE_COLUMN</span> <span class="o">=</span> <span class="s2">"date_time"</span>
<span class="n">data</span><span class="p">[</span><span class="n">DATE_COLUMN</span><span class="p">]</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">OCCUR_DATE</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">OCCUR_TIME</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">FORMAT</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">check_date</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">INCIDENT_KEY</span><span class="o">==</span><span class="n">top_id</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"OCCUR_DATE: </span><span class="si">{</span><span class="n">check_date</span><span class="o">.</span><span class="n">OCCUR_DATE</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"New Date: </span><span class="si">{</span><span class="n">check_date</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"OCCUR_TIME: </span><span class="si">{</span><span class="n">check_date</span><span class="o">.</span><span class="n">OCCUR_TIME</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"New Time: </span><span class="si">{</span><span class="n">check_date</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>

<pre class="example">
OCCUR_DATE: 01/06/2018
New Date: 2018-01-06
OCCUR_TIME: 21:05:00
New Time: 21:05:00
</pre>


<div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">OCCUR_DATE</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">OCCUR_DATE</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</pre></div>

<pre class="example">
01/01/2006
12/31/2021
</pre>


<p>
Our dataset covers the years from 2006 throught 20021. Let's see how many there are from month to month.
</p>
</div>

<div id="outline-container-org4497f90" class="outline-3">
<h3 id="org4497f90">Shootings By Month</h3>
<div class="outline-text-3" id="text-org4497f90">
<div class="highlight"><pre><span></span><span class="n">indexed</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">DATE_COLUMN</span><span class="p">)</span>
<span class="n">monthly</span> <span class="o">=</span> <span class="n">indexed</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">pandas</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="s2">"M"</span><span class="p">))</span>
<span class="n">monthly_counts</span> <span class="o">=</span> <span class="n">monthly</span><span class="o">.</span><span class="n">count</span><span class="p">()[</span><span class="s2">"INCIDENT_KEY"</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"INCIDENT_KEY"</span><span class="p">:</span> <span class="s2">"Shootings"</span><span class="p">,</span>
	     <span class="s2">"date_time"</span><span class="p">:</span> <span class="s2">"Month"</span><span class="p">}</span>
<span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">monthly_counts</span><span class="p">[</span><span class="s2">"Shootings"</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">MONTH_YEAR</span> <span class="o">=</span> <span class="s2">"%B %Y"</span>
<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">monthly_counts</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span>
    <span class="n">point</span><span class="o">=</span><span class="p">{</span><span class="s2">"filled"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
	   <span class="s2">"fill"</span><span class="p">:</span> <span class="s2">"white"</span><span class="p">})</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Month"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"temporal"</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Shootings"</span><span class="p">),</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Month"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">MONTH_YEAR</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Shootings"</span><span class="p">)]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"NYC Shootings By Month"</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"monthly_incidents"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/nyc-shootings-python-version/monthly_incidents.html" style="width:100%" height="650">
  <p>Figure Missing</p>
</object>

<p>
It looks like shootings went down in 2013 then shot back up again in the Summer of 2020.
</p>
</div>
</div>

<div id="outline-container-org9ab793a" class="outline-3">
<h3 id="org9ab793a">90 Day Rolling Window</h3>
<div class="outline-text-3" id="text-org9ab793a">
<div class="highlight"><pre><span></span><span class="n">monthly_counts</span><span class="p">[</span><span class="s2">"Rolling Mean"</span><span class="p">]</span> <span class="o">=</span> <span class="n">monthly_counts</span><span class="p">[</span><span class="s2">"Shootings"</span><span class="p">]</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span>
    <span class="n">halflife</span><span class="o">=</span><span class="s2">"90 days"</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="n">monthly_counts</span><span class="o">.</span><span class="n">Month</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">pre_melt</span> <span class="o">=</span> <span class="n">monthly_counts</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"Shootings"</span><span class="p">:</span> <span class="s2">"Sum"</span><span class="p">})</span>
<span class="n">melted</span> <span class="o">=</span> <span class="n">pre_melt</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="s2">"Month"</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">"Aggregation"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Aggregated Value"</span><span class="p">)</span>
<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span>
    <span class="n">point</span><span class="o">=</span><span class="p">{</span><span class="s2">"filled"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
	   <span class="s2">"fill"</span><span class="p">:</span> <span class="s2">"white"</span><span class="p">})</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
	       <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Month"</span><span class="p">),</span>
	       <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Aggregated Value"</span><span class="p">),</span>
	       <span class="n">color</span><span class="o">=</span><span class="s2">"Aggregation"</span><span class="p">,</span>
	       <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Month"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">MONTH_YEAR</span><span class="p">),</span>
			<span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Aggregated Value"</span><span class="p">)]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"NYC Shootings By 90 Day Exponential Weighted Mean"</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"monthly_rolling_incidents"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/nyc-shootings-python-version/monthly_rolling_incidents.html" style="width:100%" height="650">
  <p>Figure Missing</p>
</object>

<p>
Using a ninety-day window gives a little better sense of the overall trend downwards until 2020 reversed it.
</p>
</div>
</div>

<div id="outline-container-orgb7f75f1" class="outline-3">
<h3 id="orgb7f75f1">By Year</h3>
<div class="outline-text-3" id="text-orgb7f75f1">
<div class="highlight"><pre><span></span><span class="n">yearly</span> <span class="o">=</span> <span class="n">indexed</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">pandas</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="s2">"Y"</span><span class="p">))</span>
<span class="n">yearly_counts</span> <span class="o">=</span> <span class="n">yearly</span><span class="o">.</span><span class="n">count</span><span class="p">()[</span><span class="s2">"INCIDENT_KEY"</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"INCIDENT_KEY"</span><span class="p">:</span> <span class="s2">"Shootings"</span><span class="p">}</span>
<span class="p">)</span>

<span class="n">yearly_counts</span><span class="p">[</span><span class="s2">"Year"</span><span class="p">]</span> <span class="o">=</span> <span class="n">yearly_counts</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
<span class="n">expect</span><span class="p">(</span><span class="n">yearly_counts</span><span class="p">[</span><span class="s2">"Shootings"</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">yearly_counts</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span>
    <span class="n">point</span><span class="o">=</span><span class="p">{</span><span class="s2">"filled"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
	   <span class="s2">"fill"</span><span class="p">:</span> <span class="s2">"white"</span><span class="p">})</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Year"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"ordinal"</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Shootings"</span><span class="p">),</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Year"</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Shootings"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">)]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"NYC Shootings By year"</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"yearly_incidents"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/nyc-shootings-python-version/yearly_incidents.html" style="width:100%" height="650">
  <p>Figure Missing</p>
</object>

<p>
Although 2020 had that crazy summer, 2021 still exceeded it overall.
</p>
</div>
</div>

<div id="outline-container-org5b51f8f" class="outline-3">
<h3 id="org5b51f8f">Monthly By Year</h3>
<div class="outline-text-3" id="text-org5b51f8f">
<div class="highlight"><pre><span></span><span class="n">monthly_counts</span> <span class="o">=</span> <span class="n">monthly</span><span class="o">.</span><span class="n">count</span><span class="p">()[</span><span class="s2">"INCIDENT_KEY"</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"INCIDENT_KEY"</span><span class="p">:</span> <span class="s2">"Shootings"</span><span class="p">}</span>
<span class="p">)</span>
<span class="c1"># monthly_counts = monthly_counts.rename(columns={"Month": "date-time"})</span>

<span class="n">month_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span> <span class="s2">"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec"</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span>
<span class="n">monthly_counts</span><span class="p">[</span><span class="s2">"Year"</span><span class="p">]</span> <span class="o">=</span> <span class="n">monthly_counts</span><span class="p">[</span><span class="s2">"date_time"</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
<span class="n">monthly_counts</span><span class="p">[</span><span class="s2">"Month"</span><span class="p">]</span> <span class="o">=</span> <span class="n">monthly_counts</span><span class="p">[</span><span class="s2">"date_time"</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">month</span><span class="p">:</span> <span class="n">month_map</span><span class="p">[</span><span class="n">month</span><span class="p">])</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">selection</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">selection_point</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">"Year"</span><span class="p">],</span>
				   <span class="n">bind</span><span class="o">=</span><span class="s2">"legend"</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">monthly_counts</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span>
    <span class="n">point</span><span class="o">=</span><span class="p">{</span><span class="s2">"filled"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
	   <span class="s2">"fill"</span><span class="p">:</span> <span class="s2">"white"</span><span class="p">})</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Month"</span><span class="p">,</span>
	       <span class="n">sort</span><span class="o">=</span><span class="n">monthly_counts</span><span class="p">[</span><span class="s2">"date_time"</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Shootings"</span><span class="p">),</span>
    <span class="n">color</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">"Year"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"nominal"</span><span class="p">),</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"date_time"</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">"Month"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">MONTH_YEAR</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Shootings"</span><span class="p">)],</span>
    <span class="n">opacity</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">selection</span><span class="p">,</span>
			     <span class="n">altair</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mf">0.8</span><span class="p">),</span>
			     <span class="n">altair</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"NYC Monthly Shootings By year"</span>
<span class="p">)</span><span class="o">.</span><span class="n">add_params</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"month_year_shootings"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/nyc-shootings-python-version/month_year_shootings.html" style="width:100%" height="650">
  <p>Figure Missing</p>
</object>

<p>
Click on a year in the legend to isolate it from the other lines in the plot and on a space somewhere on the legend to highlight all the years again.
</p>

<p>
It looks like there was an unusually large surge in the Summer of 2020 after years of declining shootings, but regardless of the year there's at least a slight increase in shootings during the Summer months.
</p>
</div>
</div>

<div id="outline-container-orgd4e184e" class="outline-3">
<h3 id="orgd4e184e">Medain By Month</h3>
<div class="outline-text-3" id="text-orgd4e184e">
<div class="highlight"><pre><span></span><span class="n">by_month_median</span> <span class="o">=</span> <span class="n">monthly_counts</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">"Month"</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">by_month_median</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Month"</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">month_map</span><span class="o">.</span><span class="n">values</span><span class="p">())),</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Shootings"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Month"</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Shootings"</span><span class="p">),]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"NYC Median Shootings By Month (2006 through 2012)"</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"monthly_shootings"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/nyc-shootings-python-version/monthly_shootings.html" style="width:100%" height="650">
  <p>Figure Missing</p>
</object>

<p>
It looks like there's a definite seasonal effect on shootings. Must be all those farmer's kids off from school to work the fields and shoot each other.
</p>
</div>
</div>
</div>

<div id="outline-container-orgec616b1" class="outline-2">
<h2 id="orgec616b1">Location</h2>
<div class="outline-text-2" id="text-orgec616b1">
</div>
<div id="outline-container-orge08e565" class="outline-3">
<h3 id="orge08e565">Descriptions</h3>
<div class="outline-text-3" id="text-orge08e565">
</div>
<div id="outline-container-orga4dc220" class="outline-4">
<h4 id="orga4dc220">BORO</h4>
<div class="outline-text-4" id="text-orga4dc220">
<p>
The <code>BORO</code> column identifies which of the <a href="https://en.wikipedia.org/wiki/Boroughs_of_New_York_City?useskin=vector">five boroughs of New York City</a> the victim was shot in.
</p>

<p>
<img src="https://upload.wikimedia.org/wikipedia/commons/3/34/5_Boroughs_Labels_New_York_City_Map.svg" alt="Five Boroughs"></p>


<ol class="org-ol">
<li>Manhattan</li>
<li>Brooklyn</li>
<li>Queens</li>
<li>Bronx</li>
<li>Staten Island</li>
</ol>
<div class="highlight"><pre><span></span><span class="n">boroughs</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">BORO</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">BORO</span><span class="o">=</span><span class="s2">"Borough"</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="s2">"Shootings"</span><span class="p">))</span>


<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">boroughs</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Borough"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Shootings"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Borough"</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Shootings"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">)]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">520</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Shootings by Borough"</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"shootings-by-borough"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/nyc-shootings-python-version/shootings-by-borough.html" style="width:100%" height="650">
  <p>Figure Missing</p>
</object>

<div class="highlight"><pre><span></span><span class="n">borough_monthly</span> <span class="o">=</span> <span class="n">monthly</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">"BORO"</span><span class="p">:</span> <span class="s2">"first"</span><span class="p">,</span>
			       <span class="s2">"INCIDENT_KEY"</span><span class="p">:</span> <span class="s2">"count"</span><span class="p">})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
				   <span class="n">columns</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">BORO</span><span class="o">=</span><span class="s2">"Borough"</span><span class="p">,</span> <span class="n">INCIDENT_KEY</span><span class="o">=</span><span class="s2">"Shootings"</span><span class="p">,</span> <span class="n">date_time</span><span class="o">=</span><span class="s2">"Month"</span><span class="p">))</span>

<span class="n">selection</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">selection_point</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">"Borough"</span><span class="p">],</span> <span class="n">bind</span><span class="o">=</span><span class="s2">"legend"</span><span class="p">)</span>
<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">borough_monthly</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span>
    <span class="n">point</span><span class="o">=</span><span class="p">{</span><span class="s2">"filled"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
	   <span class="s2">"fill"</span><span class="p">:</span> <span class="s2">"white"</span><span class="p">})</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
	       <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Month"</span><span class="p">),</span>
	       <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Shootings"</span><span class="p">),</span>
	       <span class="n">color</span><span class="o">=</span><span class="s2">"Borough"</span><span class="p">,</span>
	       <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span>
		   <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Borough"</span><span class="p">),</span>
		   <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Month"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">MONTH_YEAR</span><span class="p">),</span>
		   <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Shootings"</span><span class="p">)</span>
	       <span class="p">],</span>
	       <span class="n">opacity</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">selection</span><span class="p">,</span>
					<span class="n">altair</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mf">0.8</span><span class="p">),</span>
					<span class="n">altair</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Monthly Borough Shootings"</span>
<span class="p">)</span><span class="o">.</span><span class="n">add_params</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"borough-monthly-shootings"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/nyc-shootings-python-version/borough-monthly-shootings.html" style="width:100%" height="650">
  <p>Figure Missing</p>
</object>

<p>
The Bronx and Brooklyn look like they have the most shootings, although I didn't weight it by population so I don't know how they compare as a fraction of the population.
</p>

<div class="highlight"><pre><span></span><span class="n">borough_bar</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s2">"BORO"</span><span class="p">,</span> <span class="s2">"date_time"</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">BORO</span><span class="o">=</span><span class="s2">"Borough"</span><span class="p">))</span>
<span class="n">borough_bar</span><span class="p">[</span><span class="s2">"Month"</span><span class="p">]</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">({</span>
    <span class="s2">"year"</span><span class="p">:</span> <span class="n">borough_bar</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
    <span class="s2">"month"</span><span class="p">:</span> <span class="n">borough_bar</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
    <span class="s2">"day"</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">})</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">borough_bar</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Month"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"count()"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Borough"</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
	<span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
	<span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
	<span class="n">title</span><span class="o">=</span><span class="s2">"Monthly Shootings With Borough Breakdowns"</span><span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"borough-monthly-bar-chart"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/nyc-shootings-python-version/borough-monthly-bar-chart.html" style="width:100%" height="650">
  <p>Figure Missing</p>
</object>

<p>
By clicking on the legend you can isolate plot-lines by borough and it makes it clearer that the surge in 2020 happened primarily in the Bronx and Manhattan, although the plot is a little deceptive since Manhattan had some months where there were no shootings, but I didn't infill them with zeros so it doesn't show those months dropping back down.
</p>
</div>
</div>


<div id="outline-container-orgf1a2579" class="outline-4">
<h4 id="orgf1a2579">PRECINCT &amp; JURISDICTION_CODE</h4>
<div class="outline-text-4" id="text-orgf1a2579">
<p>
There are seventy-seven police precincts in New York City, subdividing the boroughs. This might be useful for isolating where the shootings are occuring even further, but I'll skip it. Same with the JURISDICTION_CODE.
</p>
</div>
</div>
<div id="outline-container-org1ec5757" class="outline-4">
<h4 id="org1ec5757">LOCATION_DESC</h4>
<div class="outline-text-4" id="text-org1ec5757">
<div class="highlight"><pre><span></span><span class="n">missing_locations</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">LOCATION_DESC</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">LOCATION_DESC</span><span class="o">=</span><span class="s2">"Location Description"</span><span class="p">))</span>
<span class="n">missing_locations</span> <span class="o">=</span> <span class="n">missing_locations</span><span class="p">[[</span><span class="s2">"Location Description"</span><span class="p">,</span> <span class="s2">"date_time"</span><span class="p">,</span> <span class="s2">"BORO"</span><span class="p">]]</span>
<span class="n">missing_locations</span><span class="p">[</span><span class="s2">"Year"</span><span class="p">]</span> <span class="o">=</span> <span class="n">missing_locations</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">missing_locations</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Year"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"ordinal"</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"count()"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"count()"</span><span class="p">),</span> <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"BORO"</span><span class="p">),</span> <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Year"</span><span class="p">)],</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"BORO"</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Missing Location Descriptions by Year"</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"missing-locations-descriptions"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/nyc-shootings-python-version/missing-locations-descriptions.html" style="width:100%" height="650">
  <p>Figure Missing</p>
</object>

<p>
I was hoping the missing locations might be because they only started recording it after some point, but it looks like it's an ongoing problem not local to any one borough, so the location descriptions are interesting, but the number of missing entries makes it hard to say that they're meaningful.
</p>

<div class="highlight"><pre><span></span><span class="n">locations</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">LOCATION_DESC</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="s2">"Count"</span><span class="p">,</span> <span class="n">LOCATION_DESC</span><span class="o">=</span><span class="s2">"Location"</span><span class="p">))</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Location"</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="n">locations</span><span class="o">.</span><span class="n">Location</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
	       <span class="n">axis</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">labelAngle</span><span class="o">=</span><span class="mi">30</span><span class="p">)),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Count"</span><span class="p">),</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Location"</span><span class="p">),</span> <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Count"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">)]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Shooting Location Counts"</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"shooting-locations-count"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/nyc-shootings-python-version/shooting-locations-count.html" style="width:100%" height="650">
  <p>Figure Missing</p>
</object>

<p>
It looks like most shootings happened at homes, and to avoid being shot you should move to a storage facility.
</p>
</div>
</div>
</div>

<div id="outline-container-orgd7b6677" class="outline-3">
<h3 id="orgd7b6677">Coordinates</h3>
<div class="outline-text-3" id="text-orgd7b6677">
</div>
<div id="outline-container-org424e5d3" class="outline-4">
<h4 id="org424e5d3">X_COORD_CD &amp; Y_COORD_CD</h4>
<div class="outline-text-4" id="text-org424e5d3">
<p>
These coordinates use the State Plane Coordinate System (see <a href="https://www.usgs.gov/faqs/what-state-plane-coordinate-system-can-gps-provide-coordinates-these-values">What is the State Plane Coordinate System?</a>) Long Island Zone. The coordinates are mid-block locations with the units in feet.
</p>

<div class="highlight"><pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span>
    <span class="n">data</span><span class="p">[[</span><span class="s2">"X_COORD_CD"</span><span class="p">,</span> <span class="s2">"Y_COORD_CD"</span><span class="p">,</span> <span class="s2">"BORO"</span><span class="p">]])</span><span class="o">.</span><span class="n">mark_point</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
	<span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"X_COORD_CD"</span><span class="p">)</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">X_COORD_CD</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">data</span><span class="o">.</span><span class="n">X_COORD_CD</span><span class="o">.</span><span class="n">max</span><span class="p">())),</span>
	<span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Y_COORD_CD"</span><span class="p">)</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Y_COORD_CD</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">data</span><span class="o">.</span><span class="n">Y_COORD_CD</span><span class="o">.</span><span class="n">max</span><span class="p">())),</span>
	<span class="n">color</span><span class="o">=</span><span class="s2">"BORO"</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Shootings By Coordinates"</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"shootings-by-coordinates"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/nyc-shootings-python-version/shootings-by-coordinates.html" style="width:100%" height="650">
  <p>Figure Missing</p>
</object>

<div class="highlight"><pre><span></span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s2">"X_COORD_CD"</span><span class="p">,</span> <span class="s2">"Y_COORD_CD"</span><span class="p">,</span>
		    <span class="s2">"BORO"</span><span class="p">,</span> <span class="s2">"date_time"</span><span class="p">,</span>
		    <span class="s2">"Longitude"</span><span class="p">,</span> <span class="s2">"Latitude"</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">BORO</span><span class="o">=</span><span class="s2">"Borough"</span><span class="p">,</span>
    <span class="n">X_COORD_CD</span><span class="o">=</span><span class="s2">"X-Coordinate"</span><span class="p">,</span>
    <span class="n">Y_COORD_CD</span><span class="o">=</span><span class="s2">"Y-Coordinate"</span>
<span class="p">))</span>

<span class="n">coordinates</span><span class="p">[</span><span class="s2">"Year"</span><span class="p">]</span> <span class="o">=</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>

<span class="n">select_year</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">selection_point</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">"Year"</span><span class="p">,</span>
    <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">"Year"</span><span class="p">],</span>
    <span class="n">bind</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">binding_range</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">2006</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">2021</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"Year"</span><span class="p">),</span>
    <span class="n">value</span><span class="o">=</span><span class="p">[{</span><span class="s2">"Year"</span><span class="p">:</span> <span class="mi">2006</span><span class="p">}],</span>
<span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"X-Coordinate"</span><span class="p">)</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span>
	<span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="n">coordinates</span><span class="p">[</span><span class="s2">"X-Coordinate"</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
		<span class="n">coordinates</span><span class="p">[</span><span class="s2">"X-Coordinate"</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Y-Coordinate"</span><span class="p">)</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span>
	<span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="n">coordinates</span><span class="p">[</span><span class="s2">"Y-Coordinate"</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
		<span class="n">coordinates</span><span class="p">[</span><span class="s2">"Y-Coordinate"</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())),</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Borough"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Borough"</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"date_time"</span><span class="p">)],</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Shootings By Coordinates and Year"</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">add_params</span><span class="p">(</span><span class="n">select_year</span><span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span><span class="n">select_year</span><span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"shootings-by-coordinates-and-year"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/nyc-shootings-python-version/shootings-by-coordinates-and-year.html" style="width:100%" height="650">
  <p>Figure Missing</p>
</object>
</div>
</div>

<div id="outline-container-org98096f1" class="outline-4">
<h4 id="org98096f1">Latitude &amp; Longitude</h4>
</div>
</div>

<div id="outline-container-org0377c8b" class="outline-3">
<h3 id="org0377c8b">With GeoPandas</h3>
<div class="outline-text-3" id="text-org0377c8b">
<p>
It turns out than the boroughs of New York City are one of the three datasets that come with GeoPandas so we can bring it in to make a map.
</p>

<div class="highlight"><pre><span></span><span class="n">path_to_data</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="s2">"nybb"</span><span class="p">)</span>
<span class="n">nyc_geopandas</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">path_to_data</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">nyc_geopandas</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</pre></div>

<pre class="example">
   BoroCode       BoroName     Shape_Leng    Shape_Area   
0         5  Staten Island  330470.010332  1.623820e+09  \

                                            geometry  
0  MULTIPOLYGON (((970217.022 145643.332, 970227....  
</pre>


<p>
Let's look at a map colored with the 2021 shooting counts.
</p>

<div class="highlight"><pre><span></span><span class="n">BOROUGH_COLUMN</span> <span class="o">=</span> <span class="s2">"BoroName"</span>
<span class="n">SHOOTINGS_COLUMN</span> <span class="o">=</span> <span class="s2">"Shootings"</span>
<span class="n">latest</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="o">==</span><span class="mi">2021</span><span class="p">]</span>
<span class="n">latest_count</span> <span class="o">=</span> <span class="n">latest</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">"BORO"</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">expect</span><span class="p">(</span><span class="n">latest_count</span><span class="o">.</span><span class="n">INCIDENT_KEY</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">latest</span><span class="p">)))</span>
<span class="n">latest_count</span> <span class="o">=</span> <span class="n">latest_count</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">BORO</span><span class="o">=</span><span class="n">BOROUGH_COLUMN</span><span class="p">))</span>
<span class="n">latest_count</span><span class="p">[</span><span class="n">BOROUGH_COLUMN</span><span class="p">]</span> <span class="o">=</span> <span class="n">latest_count</span><span class="p">[</span><span class="n">BOROUGH_COLUMN</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
<span class="n">latest_count</span><span class="p">[</span><span class="n">SHOOTINGS_COLUMN</span><span class="p">]</span> <span class="o">=</span> <span class="n">latest_count</span><span class="p">[</span><span class="s2">"INCIDENT_KEY"</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">latest_count</span> <span class="o">=</span> <span class="n">latest_count</span><span class="p">[[</span><span class="n">BOROUGH_COLUMN</span><span class="p">,</span> <span class="n">SHOOTINGS_COLUMN</span><span class="p">]]</span>
<span class="n">merged</span> <span class="o">=</span> <span class="n">nyc_geopandas</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">latest_count</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">BOROUGH_COLUMN</span><span class="p">)</span>

<span class="n">merged</span> <span class="o">=</span> <span class="n">merged</span><span class="p">[[</span><span class="n">BOROUGH_COLUMN</span><span class="p">,</span> <span class="n">SHOOTINGS_COLUMN</span><span class="p">,</span> <span class="s2">"geometry"</span><span class="p">]]</span>
<span class="n">explorer</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="n">SHOOTINGS_COLUMN</span><span class="p">,</span>
			  <span class="n">tooltip</span><span class="o">=</span><span class="n">BOROUGH_COLUMN</span><span class="p">,</span>
			  <span class="n">popup</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">explorer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">OUTPUT_PATH</span><span class="si">}</span><span class="s2">/nyc-shootings-explore.html"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/nyc-shootings-python-version/nyc-shootings-explore.html" style="width:100%" height="800">
  <p>Figure Missing</p>
</object>

<p>
This is probably most interesting to someone like me who doesn't know much about New York City. I wonder why Queens has so much fewer shootings than Brooklyn or the Bronx when it sits between them? Demographics?
</p>
</div>
</div>
</div>

<div id="outline-container-org942e262" class="outline-2">
<h2 id="org942e262">Murder or Not</h2>
<div class="outline-text-2" id="text-org942e262">
</div>
<div id="outline-container-org62c52a3" class="outline-3">
<h3 id="org62c52a3">By Year</h3>
<div class="outline-text-3" id="text-org62c52a3">
<div class="highlight"><pre><span></span><span class="n">MURDER_FLAG</span> <span class="o">=</span> <span class="s2">"STATISTICAL_MURDER_FLAG"</span>
<span class="n">MURDERED</span> <span class="o">=</span> <span class="s2">"Murdered"</span>
<span class="n">BOROUGH</span> <span class="o">=</span> <span class="s2">"Borough"</span>
<span class="n">YEAR</span> <span class="o">=</span> <span class="s2">"Year"</span>
<span class="n">data</span><span class="p">[</span><span class="n">YEAR</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s2">"Y"</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">()</span>
<span class="n">yearly_murders</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">YEAR</span><span class="p">,</span> <span class="s2">"BORO"</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
    <span class="n">MURDER_FLAG</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
	<span class="n">columns</span><span class="o">=</span><span class="p">{</span>
	    <span class="s2">"BORO"</span><span class="p">:</span> <span class="n">BOROUGH</span><span class="p">,</span>
	    <span class="n">MURDER_FLAG</span><span class="p">:</span> <span class="n">MURDERED</span><span class="p">})</span>
<span class="n">yearly_murders</span> <span class="o">=</span> <span class="n">yearly_murders</span><span class="p">[[</span><span class="n">YEAR</span><span class="p">,</span> <span class="n">BOROUGH</span><span class="p">,</span> <span class="n">MURDERED</span><span class="p">]]</span>

<span class="n">SELECTION</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">selection_point</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="n">BOROUGH</span><span class="p">],</span> <span class="n">bind</span><span class="o">=</span><span class="s2">"legend"</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">yearly_murders</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span>
    <span class="n">point</span><span class="o">=</span><span class="p">{</span><span class="s2">"filled"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
	   <span class="s2">"fill"</span><span class="p">:</span> <span class="s2">"white"</span><span class="p">})</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
	       <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="n">YEAR</span><span class="p">),</span>
	       <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="n">MURDERED</span><span class="p">),</span>
	       <span class="n">color</span><span class="o">=</span><span class="n">BOROUGH</span><span class="p">,</span>
	       <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="n">YEAR</span><span class="p">),</span>
			<span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="n">MURDERED</span><span class="p">),</span>
			<span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="n">BOROUGH</span><span class="p">)],</span>
	       <span class="n">opacity</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">SELECTION</span><span class="p">,</span>
					<span class="n">altair</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mf">0.8</span><span class="p">),</span>
					<span class="n">altair</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
	   <span class="p">)</span><span class="o">.</span><span class="n">add_params</span><span class="p">(</span><span class="n">SELECTION</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
	       <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
	       <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
	       <span class="n">title</span><span class="o">=</span><span class="s2">"NYC Murders By Year"</span>
	   <span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"yearly_borough_murders"</span><span class="p">)</span>
<span class="c1">#+end_src</span>
</pre></div>

<object type="text/html" data="posts/nyc-shootings-python-version/yearly_borough_murders.html" style="width:100%" height="650">
  <p>Figure Missing</p>
</object>
</div>
</div>

<div id="outline-container-org9a5fbfc" class="outline-3">
<h3 id="org9a5fbfc">By Month</h3>
<div class="outline-text-3" id="text-org9a5fbfc">
<div class="highlight"><pre><span></span><span class="n">MONTH</span> <span class="o">=</span> <span class="s2">"Month"</span>
<span class="n">data</span><span class="p">[</span><span class="n">MONTH</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s2">"M"</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">()</span>
<span class="n">murdered</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">MONTH</span><span class="p">,</span> <span class="s2">"BORO"</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">MURDER_FLAG</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">murdered</span> <span class="o">=</span> <span class="n">murdered</span><span class="p">[[</span><span class="n">MONTH</span><span class="p">,</span> <span class="s2">"BORO"</span><span class="p">,</span> <span class="n">MURDER_FLAG</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>
    <span class="s2">"BORO"</span><span class="p">:</span> <span class="n">BOROUGH</span><span class="p">,</span>
    <span class="n">MURDER_FLAG</span><span class="p">:</span> <span class="n">MURDERED</span><span class="p">,</span>    
<span class="p">})</span>

<span class="n">SELECTION</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">selection_point</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="n">BOROUGH</span><span class="p">],</span> <span class="n">bind</span><span class="o">=</span><span class="s2">"legend"</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">murdered</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span>
    <span class="n">point</span><span class="o">=</span><span class="p">{</span><span class="s2">"filled"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
	   <span class="s2">"fill"</span><span class="p">:</span> <span class="s2">"white"</span><span class="p">})</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
	       <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="n">MONTH</span><span class="p">),</span>
	       <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="n">MURDERED</span><span class="p">),</span>
	       <span class="n">color</span><span class="o">=</span><span class="n">BOROUGH</span><span class="p">,</span>
	       <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="n">MONTH</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">MONTH_YEAR</span><span class="p">),</span>
			<span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="n">MURDERED</span><span class="p">),</span>
			<span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="n">BOROUGH</span><span class="p">)],</span>
	       <span class="n">opacity</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">SELECTION</span><span class="p">,</span>
					<span class="n">altair</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mf">0.8</span><span class="p">),</span>
					<span class="n">altair</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
	   <span class="p">)</span><span class="o">.</span><span class="n">add_params</span><span class="p">(</span><span class="n">SELECTION</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
	       <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
	       <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
	       <span class="n">title</span><span class="o">=</span><span class="s2">"NYC Murders By Month"</span>
	   <span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"monthly_borough_murders"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/nyc-shootings-python-version/monthly_borough_murders.html" style="width:100%" height="650">
  <p>Figure Missing</p>
</object>

<p>
It looks like Brooklyn lead in murders in the Summer of 2020, 
</p>
</div>
</div>

<div id="outline-container-orgab955bf" class="outline-3">
<h3 id="orgab955bf">By Coordinate</h3>
<div class="outline-text-3" id="text-orgab955bf">
<div class="highlight"><pre><span></span><span class="n">murdered</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">MURDER_FLAG</span><span class="p">]]</span>

<span class="n">murder_coordinates</span> <span class="o">=</span> <span class="n">murdered</span><span class="p">[[</span><span class="s2">"BORO"</span><span class="p">,</span> <span class="s2">"date_time"</span><span class="p">,</span>
			       <span class="s2">"Longitude"</span><span class="p">,</span> <span class="s2">"Latitude"</span>
			       <span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
				   <span class="n">BORO</span><span class="o">=</span><span class="s2">"Borough"</span><span class="p">,</span>
			       <span class="p">))</span>
<span class="n">murder_coordinates</span><span class="p">[</span><span class="s2">"Year"</span><span class="p">]</span> <span class="o">=</span> <span class="n">murder_coordinates</span><span class="o">.</span><span class="n">date_time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>

<span class="n">chart</span> <span class="o">=</span> <span class="p">(</span><span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">murder_coordinates</span><span class="p">)</span>
	 <span class="o">.</span><span class="n">mark_point</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
	 <span class="o">.</span><span class="n">encode</span><span class="p">(</span>
	     <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Longitude"</span><span class="p">)</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span>
		 <span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="n">murder_coordinates</span><span class="p">[</span><span class="s2">"Longitude"</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
			 <span class="n">murder_coordinates</span><span class="p">[</span><span class="s2">"Longitude"</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())),</span>
	     <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Latitude"</span><span class="p">)</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span>
		 <span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="n">murder_coordinates</span><span class="p">[</span><span class="s2">"Latitude"</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
			 <span class="n">murder_coordinates</span><span class="p">[</span><span class="s2">"Latitude"</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())),</span>
	     <span class="n">color</span><span class="o">=</span><span class="s2">"Borough"</span><span class="p">,</span>
	     <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Borough"</span><span class="p">),</span>
		      <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"date_time"</span><span class="p">)],</span>
	 <span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
	     <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
	     <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
	     <span class="n">title</span><span class="o">=</span><span class="s2">"Murders By Longitude, Latitude and Year"</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">add_params</span><span class="p">(</span><span class="n">select_year</span><span class="p">)</span>
	 <span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span><span class="n">select_year</span><span class="p">))</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"murders-by-coordinates-and-year"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/nyc-shootings-python-version/murders-by-coordinates-and-year.html" style="width:100%" height="650">
  <p>Figure Missing</p>
</object>
</div>
</div>
</div>

<div id="outline-container-orgdcaac13" class="outline-2">
<h2 id="orgdcaac13">Victims and Perpetrators</h2>
<div class="outline-text-2" id="text-orgdcaac13">
</div>
<div id="outline-container-orgf0dd83c" class="outline-3">
<h3 id="orgf0dd83c">Perpetrators</h3>
<div class="outline-text-3" id="text-orgf0dd83c">
</div>
<div id="outline-container-org3335cad" class="outline-4">
<h4 id="org3335cad">PERP_AGE_GROUP</h4>
<div class="outline-text-4" id="text-org3335cad">
<div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">PERP_AGE_GROUP</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">PERP_AGE_GROUP</th>
<th scope="col" class="org-right">count</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">nan</td>
<td class="org-right">9344</td>
</tr>
<tr>
<td class="org-right">18-24</td>
<td class="org-right">5844</td>
</tr>
<tr>
<td class="org-right">25-44</td>
<td class="org-right">5202</td>
</tr>
<tr>
<td class="org-right">UNKNOWN</td>
<td class="org-right">3148</td>
</tr>
<tr>
<td class="org-right">&lt;18</td>
<td class="org-right">1463</td>
</tr>
<tr>
<td class="org-right">45-64</td>
<td class="org-right">535</td>
</tr>
<tr>
<td class="org-right">65+</td>
<td class="org-right">57</td>
</tr>
<tr>
<td class="org-right">1020</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">940</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">224</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgaa382e6" class="outline-4">
<h4 id="orgaa382e6">PEPR_SEX</h4>
<div class="outline-text-4" id="text-orgaa382e6">
<div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">PERP_SEX</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">PERP_SEX</th>
<th scope="col" class="org-right">count</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">M</td>
<td class="org-right">14416</td>
</tr>
<tr>
<td class="org-left">nan</td>
<td class="org-right">9310</td>
</tr>
<tr>
<td class="org-left">U</td>
<td class="org-right">1499</td>
</tr>
<tr>
<td class="org-left">F</td>
<td class="org-right">371</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org489fecc" class="outline-4">
<h4 id="org489fecc">PERP_RACE</h4>
<div class="outline-text-4" id="text-org489fecc">
<div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">PERP_RACE</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">PERP_RACE</th>
<th scope="col" class="org-right">count</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">BLACK</td>
<td class="org-right">10668</td>
</tr>
<tr>
<td class="org-left">nan</td>
<td class="org-right">9310</td>
</tr>
<tr>
<td class="org-left">WHITE HISPANIC</td>
<td class="org-right">2164</td>
</tr>
<tr>
<td class="org-left">UNKNOWN</td>
<td class="org-right">1836</td>
</tr>
<tr>
<td class="org-left">BLACK HISPANIC</td>
<td class="org-right">1203</td>
</tr>
<tr>
<td class="org-left">WHITE</td>
<td class="org-right">272</td>
</tr>
<tr>
<td class="org-left">ASIAN / PACIFIC ISLANDER</td>
<td class="org-right">141</td>
</tr>
<tr>
<td class="org-left">AMERICAN INDIAN/ALASKAN NATIVE</td>
<td class="org-right">2</td>
</tr>
</tbody>
</table>
<p>
It looks like besides the <code>NaN</code> values, missing data is also classified as <code>U</code> or <code>UNKNOWN</code>. 
</p>
</div>
</div>
<div id="outline-container-org9c9c574" class="outline-4">
<h4 id="org9c9c574">Handling the Unknowns</h4>
<div class="outline-text-4" id="text-org9c9c574">
<p>
Let's try and unify the missing values.
</p>

<div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">PERP_AGE_GROUP</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span> <span class="o">=</span> <span class="s2">"UNKNOWN"</span>
<span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">PERP_AGE_GROUP</span> <span class="o">==</span> <span class="s2">"U"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"UNKNOWN"</span>

<span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">PERP_AGE_GROUP</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">PERP_AGE_GROUP</th>
<th scope="col" class="org-right">count</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">UNKNOWN</td>
<td class="org-right">12492</td>
</tr>
<tr>
<td class="org-right">18-24</td>
<td class="org-right">5844</td>
</tr>
<tr>
<td class="org-right">25-44</td>
<td class="org-right">5202</td>
</tr>
<tr>
<td class="org-right">&lt;18</td>
<td class="org-right">1463</td>
</tr>
<tr>
<td class="org-right">45-64</td>
<td class="org-right">535</td>
</tr>
<tr>
<td class="org-right">65+</td>
<td class="org-right">57</td>
</tr>
<tr>
<td class="org-right">1020</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">940</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">224</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">PERP_SEX</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span> <span class="o">=</span> <span class="s2">"UNKNOWN"</span>
<span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">PERP_SEX</span> <span class="o">==</span> <span class="s2">"U"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"UNKNOWN"</span>

<span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">PERP_SEX</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">PERP_SEX</th>
<th scope="col" class="org-right">count</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">M</td>
<td class="org-right">14416</td>
</tr>
<tr>
<td class="org-left">UNKNOWN</td>
<td class="org-right">10809</td>
</tr>
<tr>
<td class="org-left">F</td>
<td class="org-right">371</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">PERP_RACE</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span> <span class="o">=</span> <span class="s2">"UNKNOWN"</span>
<span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">PERP_RACE</span> <span class="o">==</span> <span class="s2">"U"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"UNKNOWN"</span>

<span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">PERP_RACE</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">PERP_RACE</th>
<th scope="col" class="org-right">count</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">UNKNOWN</td>
<td class="org-right">11166</td>
</tr>
<tr>
<td class="org-left">BLACK</td>
<td class="org-right">10650</td>
</tr>
<tr>
<td class="org-left">WHITE HISPANIC</td>
<td class="org-right">2164</td>
</tr>
<tr>
<td class="org-left">BLACK HISPANIC</td>
<td class="org-right">1201</td>
</tr>
<tr>
<td class="org-left">WHITE</td>
<td class="org-right">272</td>
</tr>
<tr>
<td class="org-left">ASIAN / PACIFIC ISLANDER</td>
<td class="org-right">141</td>
</tr>
<tr>
<td class="org-left">AMERICAN INDIAN/ALASKAN NATIVE</td>
<td class="org-right">2</td>
</tr>
</tbody>
</table>
<p>
So, the first thing we can notice is that the <code>UNKNOWN</code> counts don't match so sometims some attributes were known but not others, so they don't just represent cases where the perpetrator wasn't caught like I thought it might be. The second thing is that for age and race the unknowns have the highest counts. For all three categories the numbers of unknowns are so high that it's hard to say how they might affect the cases where the values are known.
</p>
</div>
</div>
</div>

<div id="outline-container-orgd13c407" class="outline-3">
<h3 id="orgd13c407">Victims</h3>
<div class="outline-text-3" id="text-orgd13c407">
</div>
<div id="outline-container-org5387ebd" class="outline-4">
<h4 id="org5387ebd">VIC_AGE_GROUP</h4>
<div class="outline-text-4" id="text-org5387ebd">
<div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">VIC_AGE_GROUP</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">VIC_AGE_GROUP</th>
<th scope="col" class="org-right">count</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">UNKNOWN</td>
<td class="org-right">10863</td>
</tr>
<tr>
<td class="org-right">25-44</td>
<td class="org-right">6500</td>
</tr>
<tr>
<td class="org-right">18-24</td>
<td class="org-right">5389</td>
</tr>
<tr>
<td class="org-right">&lt;18</td>
<td class="org-right">1657</td>
</tr>
<tr>
<td class="org-right">45-64</td>
<td class="org-right">1070</td>
</tr>
<tr>
<td class="org-right">65+</td>
<td class="org-right">117</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orge9d1cfb" class="outline-4">
<h4 id="orge9d1cfb">VIC_SEX</h4>
<div class="outline-text-4" id="text-orge9d1cfb">
<div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">VIC_SEX</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">VIC_SEX</th>
<th scope="col" class="org-right">count</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">M</td>
<td class="org-right">13182</td>
</tr>
<tr>
<td class="org-left">UNKNOWN</td>
<td class="org-right">10809</td>
</tr>
<tr>
<td class="org-left">F</td>
<td class="org-right">1598</td>
</tr>
<tr>
<td class="org-left">U</td>
<td class="org-right">7</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org1f69448" class="outline-4">
<h4 id="org1f69448">VIC_RACE</h4>
<div class="outline-text-4" id="text-org1f69448">
<div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">TABLE</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">VIC_RACE</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">VIC_RACE</th>
<th scope="col" class="org-right">count</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">UNKNOWN</td>
<td class="org-right">10851</td>
</tr>
<tr>
<td class="org-left">BLACK</td>
<td class="org-right">9962</td>
</tr>
<tr>
<td class="org-left">WHITE HISPANIC</td>
<td class="org-right">2515</td>
</tr>
<tr>
<td class="org-left">BLACK HISPANIC</td>
<td class="org-right">1528</td>
</tr>
<tr>
<td class="org-left">WHITE</td>
<td class="org-right">485</td>
</tr>
<tr>
<td class="org-left">ASIAN / PACIFIC ISLANDER</td>
<td class="org-right">249</td>
</tr>
<tr>
<td class="org-left">AMERICAN INDIAN/ALASKAN NATIVE</td>
<td class="org-right">6</td>
</tr>
</tbody>
</table>
<p>
Somewhat unexpectedly, the unknowns are also alarmingly high for the victims, suggesting that they represent poor case records and perhaps the demographic information isn't reliable enough to be useful.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfc57088" class="outline-2">
<h2 id="orgfc57088">Sources</h2>
<div class="outline-text-2" id="text-orgfc57088">
<ul class="org-ul">
<li>
<a href="https://commons.wikimedia.org/wiki/File:5_Boroughs_Labels_New_York_City_Map.svg">New York City Map</a> via WikiMedia Commons</li>
</ul>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/bubba-sort-page-1/index.html" class="u-url">I, Bubba</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/bubba-sort-page-1/index.html" rel="bookmark">
            <time class="published dt-published" datetime="2023-03-16T19:54:06-07:00" itemprop="datePublished" title="2023-03-16 19:54">2023-03-16 19:54</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>
<img src="posts/bubba-sort-page-1/bubba_001_small.webp" alt="Bubba Panel One"></p>

<p>
<img src="posts/bubba-sort-page-1/bubba_002_1.webp" alt="Bubba Panel Two"></p>

<p>
<img src="posts/bubba-sort-page-1/bubba_003.webp" alt="Panel Three"></p>

<p>
<a href="posts/bubba-sort-page-2/">Next Bubba</a>
</p>

<p>
<a href="pages/bubba-sort/bubba-sort-pages/">Table of Contents</a>
</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/activity-selector-implementation/index.html" class="u-url">Activity Selector Implementations</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/activity-selector-implementation/index.html" rel="bookmark">
            <time class="published dt-published" datetime="2022-09-12T16:11:44-07:00" itemprop="datePublished" title="2022-09-12 16:11">2022-09-12 16:11</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/activity-selector-implementation/index.html#org58a56f3">Example Data</a></li>
<li><a href="posts/activity-selector-implementation/index.html#org1622e06">A Recursive Selector</a></li>
<li><a href="posts/activity-selector-implementation/index.html#org1078381">An Iterative Selector</a></li>
</ul>
</div>
</div>
<div class="highlight"><pre><span></span><span class="c1"># from pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">contain_exactly</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
</pre></div>

<div id="outline-container-org58a56f3" class="outline-2">
<h2 id="org58a56f3">Example Data</h2>
<div class="outline-text-2" id="text-org58a56f3">
<div class="highlight"><pre><span></span><span class="n">PADDING</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="n">PADDING</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span>
<span class="n">finish</span> <span class="o">=</span> <span class="p">[</span><span class="n">PADDING</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span>
<span class="n">expected_activities</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">start</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">finish</span><span class="p">)))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org1622e06" class="outline-2">
<h2 id="org1622e06">A Recursive Selector</h2>
<div class="outline-text-2" id="text-org1622e06">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">recursive_activity_selector</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Selects the optimal activities</span>

<span class="sd">    Note:</span>
<span class="sd">     This assumes that the start and finish lists are pre-padded with </span>
<span class="sd">    zeros (1 each).</span>


<span class="sd">    Args:</span>
<span class="sd">     start: list of start times for each activity</span>
<span class="sd">     finish: list of end times for each activity</span>
<span class="sd">     k: the current activity (index)</span>

<span class="sd">    Returns:</span>
<span class="sd">     optimal list of activities</span>
<span class="sd">    """</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">m</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="ow">and</span> <span class="n">start</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">finish</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
	<span class="n">m</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">m</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
	<span class="k">return</span> <span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">+</span> <span class="n">recursive_activity_selector</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[]</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">activities</span> <span class="o">=</span> <span class="n">recursive_activity_selector</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">activities</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected_activities</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">activities</span><span class="p">)</span>
</pre></div>

<pre class="example">
[1, 4, 8, 11]
</pre>
</div>
</div>

<div id="outline-container-org1078381" class="outline-2">
<h2 id="org1078381">An Iterative Selector</h2>
<div class="outline-text-2" id="text-org1078381">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">iterative_activity_selector</span><span class="p">(</span><span class="n">start</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">finish</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""An iterative activity selector</span>

<span class="sd">    Note:</span>
<span class="sd">     This assumes that the start and finish lists are pre-padded with </span>
<span class="sd">    dummy values.</span>

<span class="sd">    Args:</span>
<span class="sd">     start: list of starting times</span>
<span class="sd">     finish: list of end times</span>
<span class="sd">    """</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
    <span class="n">activities</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">start</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">finish</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
	    <span class="n">activities</span> <span class="o">+=</span> <span class="p">[</span><span class="n">m</span><span class="p">]</span>
	    <span class="n">k</span> <span class="o">=</span> <span class="n">m</span>
    <span class="k">return</span> <span class="n">activities</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">activities</span> <span class="o">=</span> <span class="n">iterative_activity_selector</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">activities</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected_activities</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">activities</span><span class="p">)</span>
</pre></div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/the-activity-selection-problem/index.html" class="u-url">The Activity Selection Problem</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/the-activity-selection-problem/index.html" rel="bookmark">
            <time class="published dt-published" datetime="2022-08-04T17:25:35-07:00" itemprop="datePublished" title="2022-08-04 17:25">2022-08-04 17:25</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/the-activity-selection-problem/index.html#org00f0a88">What is the Activity Selection Problem?</a></li>
<li><a href="posts/the-activity-selection-problem/index.html#org08fc928">The Greedy Choice</a></li>
<li>
<a href="posts/the-activity-selection-problem/index.html#orgdb6b3e9">The Recursive Activity Selector</a>
<ul>
<li><a href="posts/the-activity-selection-problem/index.html#orgb92d888">Padding The Start</a></li>
</ul>
</li>
<li><a href="posts/the-activity-selection-problem/index.html#org215fa34">The Iterative Activity Selector</a></li>
<li><a href="posts/the-activity-selection-problem/index.html#org282bc5a">Sources</a></li>
</ul>
</div>
</div>
<div id="outline-container-org00f0a88" class="outline-2">
<h2 id="org00f0a88">What is the Activity Selection Problem?</h2>
<div class="outline-text-2" id="text-org00f0a88">
<ul class="org-ul">
<li>In this problem we have a set of <i>n</i> activities \(S = \{a_1, a_2, \ldots, a_n\}\).</li>
<li>Assume the activities are sorted by increasing finish time</li>
<li>Each activity has a start time \(s_i\) and a finish time \(f_i\)</li>
<li>Only one activity can happen at a time.</li>
<li>Two activities are <i>compatible</i> if the earlier event finishes before the start time of the other event.</li>
</ul>
<p>
The problem we want to solve is finding the most compatible activities we can from our set of activities. This differs from a more common scheduling problem in that the times are fixed - we can't re-arrange activities to make them fit so they either can happen or they can't.
</p>
</div>
</div>

<div id="outline-container-org08fc928" class="outline-2">
<h2 id="org08fc928">The Greedy Choice</h2>
<div class="outline-text-2" id="text-org08fc928">
<p>
<a href="posts/clrs/">CLRS</a> goes into the more formal aspects of finding the optimal substructure and proving that a greedy strategy works, but in this case the reasoning is fairly intuitive (and I didn't find the proof so easy to follow) so I'll skip the formal stuff. The thing to recognize is just that the sooner the first activity you schedule finishes the more time there is for other activities. So if after each activity you pick you the next pick you make is the remaining  activity that doesn't collide with the current pick and finishes first you will be maximizing the number of activities that you can schedule.
</p>
</div>
</div>

<div id="outline-container-orgdb6b3e9" class="outline-2">
<h2 id="orgdb6b3e9">The Recursive Activity Selector</h2>
<div class="outline-text-2" id="text-orgdb6b3e9">
<pre id="recursive-activity-selector" style="display:hidden;">
\begin{algorithm}
\caption{Recursive Activity Selector}
\begin{algorithmic}
\REQUIRE The activities are sorted in non-decreasing order of finish time
\INPUT $s$: The array of start times for the activities.
\INPUT $f$: The array of finish times for the activities.
\INPUT $k$: The last activity selected so far.
\INPUT $n$: The number of activities.
\OUTPUT The activities that maximize the number of compatible activities.
\PROCEDURE{RecursiveActivitySelector}{$s, f, k, n$}

\STATE \(m \gets k + 1\)

\WHILE {\(m \le n\) and \(s[m] &lt; f[k]\)}
  \STATE \(m \gets m + 1\)
\ENDWHILE

\IF {\(m \le n\)}
  \RETURN \(\{a_m\} \cup \) \textsc{RecursiveActivitySelector}(\(s, f, m, n\))
\ELSE
  \RETURN \{\}
\ENDIF

\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>

<p>
<b><b>Note:</b></b> The activity set (\(\{a_1, a_2, \ldots, a_n\}\)) is treated as a global collection so it is used in the function but not passed in as an argument.
</p>
</div>

<div id="outline-container-orgb92d888" class="outline-3">
<h3 id="orgb92d888">Padding The Start</h3>
<div class="outline-text-3" id="text-orgb92d888">
<p>
Because the recursive algorithm is looking for the next earliest finish time after the first event we need to pad the activities with a dummy activity that has a finish time of 0 (\(f_0 = 0\)) and then when the function is first called the <i>k</i> value is set to 0:
</p>

<p>
\[
RecursiveActivitySelector(s, f, 0, n)
\]
</p>
</div>
</div>
</div>

<div id="outline-container-org215fa34" class="outline-2">
<h2 id="org215fa34">The Iterative Activity Selector</h2>
<div class="outline-text-2" id="text-org215fa34">
<pre id="greedy-activity-selector" style="display:hidden;">
\begin{algorithm}
\caption{Greedy Activity Selector}
\begin{algorithmic}
\REQUIRE The activities are sorted in non-decreasing order of finish time
\INPUT $s$: The array of start times for the activities.
\INPUT $f$: The array of finish times for the activities.
\OUTPUT The activities that maximize the number of compatible activities.
\PROCEDURE{GreedyActivitySelector}{\(s, f\)}

\STATE \(n \gets s.length \)
\STATE \(A \gets \{a_1\} \)
\STATE \(k \gets 1 \)

\FOR {\(m  \in \{2, \ldots, n \}\)}
  \IF {\( s[m] \ge f[k] \)}
    \STATE \(A \gets A \cup \{a_m\}\)
    \STATE \(k \gets m \)
  \ENDIF
\ENDFOR

\RETURN \(A\)
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>
</div>
</div>

<div id="outline-container-org282bc5a" class="outline-2">
<h2 id="org282bc5a">Sources</h2>
<div class="outline-text-2" id="text-org282bc5a">
<ul class="org-ul">
<li><a href="posts/clrs/">Introduction To Algorithms (CLRS)</a></li>
</ul>
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("recursive-activity-selector"));
});
</script><script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("greedy-activity-selector"));
});
</script>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/weighted-completion-times/index.html" class="u-url">Weighted Completion Times</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/weighted-completion-times/index.html" rel="bookmark">
            <time class="published dt-published" datetime="2022-07-20T16:33:47-07:00" itemprop="datePublished" title="2022-07-20 16:33">2022-07-20 16:33</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li>
<a href="posts/weighted-completion-times/index.html#org58a8ea8">The Weighted Scheduling Problem</a>
<ul>
<li><a href="posts/weighted-completion-times/index.html#org3c864b4">Completion Time</a></li>
</ul>
</li>
<li><a href="posts/weighted-completion-times/index.html#org6f45b85">Greedy Metrics</a></li>
<li><a href="posts/weighted-completion-times/index.html#orgba58152">Source</a></li>
</ul>
</div>
</div>
<div id="outline-container-org58a8ea8" class="outline-2">
<h2 id="org58a8ea8">The Weighted Scheduling Problem</h2>
<div class="outline-text-2" id="text-org58a8ea8">
<p>
This is a look at the problem of arranging a schedule of jobs so that their completion times are lowest, while accounting for different priorities for each job.
</p>

<p>
<b><b>Input:</b></b> \(n\) jobs with positive lengths \(l_1, l_2, \ldots, l_n\) and positive weights \(w_1, w_2,\ldots,w_n\). The larger the weight, the higher the priority.
</p>

<p>
<b><b>Output:</b></b> A job sequence (the schedule) that minimizes the sum of the weight completion times \(w_1l_1 + w_2 l_2 + \cdots + w_n l_n\).
</p>
</div>

<div id="outline-container-org3c864b4" class="outline-3">
<h3 id="org3c864b4">Completion Time</h3>
<div class="outline-text-3" id="text-org3c864b4">
<p>
The output above is a little confusing (I'll have to re-write that later). What we're minimizing is the sum of <i>completion times</i>. A job's completion time is the total of all the times for the jobs that precede it as well as the time to finish the job. This means the completion time for the first job is the time to run that job, the completion time for the second job is the time for the first job plus the time for the second job, and so on.
</p>
</div>
</div>
</div>
<div id="outline-container-org6f45b85" class="outline-2">
<h2 id="org6f45b85">Greedy Metrics</h2>
<div class="outline-text-2" id="text-org6f45b85">
<p>
The greedy method for this problem involves finding a metric such that when the jobs are sorted by the metric they form the optimal schedule. One possible metric is the <i>Greedy Difference</i> which is the weight for a job minus the time the job takes (\(w_i - l_i\)).
</p>

<p>
Another possible metric is the <i>Greedy Ratio</i> which is the ratio of job-weight to job-length (\(\frac{w_i}{l_i}\)).
</p>
</div>
</div>
<div id="outline-container-orgba58152" class="outline-2">
<h2 id="orgba58152">Source</h2>
<div class="outline-text-2" id="text-orgba58152">
<ul class="org-ul">
<li><a href="posts/algorithms-illuminated-part-3/">Algorithms Illuminated - Part III: Greedy Algorithms and Dynamic Programming</a></li>
</ul>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/comparing-energy-prices/index.html" class="u-url">Comparing Energy Prices</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/comparing-energy-prices/index.html" rel="bookmark">
            <time class="published dt-published" datetime="2022-07-12T13:13:00-07:00" itemprop="datePublished" title="2022-07-12 13:13">2022-07-12 13:13</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li>
<a href="posts/comparing-energy-prices/index.html#org64d75c4">How Many Megajoules For a Dollar of Gas?</a>
<ul>
<li><a href="posts/comparing-energy-prices/index.html#orgcb800fc">Chain-Link Conversion</a></li>
<li><a href="posts/comparing-energy-prices/index.html#orgf2d3def">In Python</a></li>
</ul>
</li>
<li>
<a href="posts/comparing-energy-prices/index.html#orgcc24775">How Many MegaJoules For a Dollar of Electricity?</a>
<ul>
<li><a href="posts/comparing-energy-prices/index.html#org42729eb">Kilowatt-Hour To Joules</a></li>
<li><a href="posts/comparing-energy-prices/index.html#org1444a80">A Dollar's Worth Of Megajoules</a></li>
<li><a href="posts/comparing-energy-prices/index.html#org8815b2c">Check The Math</a></li>
</ul>
</li>
<li>
<a href="posts/comparing-energy-prices/index.html#org97943a3">How Many Megajoules For a Dollar Of Natural Gas?</a>
<ul>
<li><a href="posts/comparing-energy-prices/index.html#orgb5b6897">Check The Math</a></li>
</ul>
</li>
<li>
<a href="posts/comparing-energy-prices/index.html#orgc3c008a">How Many Megajoules For a Dollar of Coal?</a>
<ul>
<li><a href="posts/comparing-energy-prices/index.html#orgfe5e6b2">Checking the Math</a></li>
</ul>
</li>
<li>
<a href="posts/comparing-energy-prices/index.html#orgbeb7510">How Many Megajoules Per Dollar In Corn (Biodiesel)?</a>
<ul>
<li><a href="posts/comparing-energy-prices/index.html#org7064d50">Checking the Math</a></li>
</ul>
</li>
<li><a href="posts/comparing-energy-prices/index.html#org8f186f5">What Is the Ratio of the Cost of the Most Expensive to the Cheapest?</a></li>
<li><a href="posts/comparing-energy-prices/index.html#org3e95e01">Source</a></li>
</ul>
</div>
</div>
<div class="highlight"><pre><span></span><span class="c1"># from python</span>
<span class="kn">from</span> <span class="nn">fractions</span> <span class="kn">import</span> <span class="n">Fraction</span>

<span class="k">def</span> <span class="nf">print_energy</span><span class="p">(</span><span class="n">megajoules_per_dollar</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Print the energy provided by the source.</span>

<span class="sd">    Args:</span>
<span class="sd">     megajoules_per_dollar: how many megajoules provided by the source for each dollar</span>
<span class="sd">     source: where the energy is coming from</span>
<span class="sd">    """</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2"> provides </span><span class="si">{</span><span class="n">megajoules_per_dollar</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2"> megajoules per dollar."</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2"> costs $</span><span class="si">{</span><span class="mi">1</span><span class="o">/</span><span class="n">megajoules_per_dollar</span><span class="si">:</span><span class="s2">0.4f</span><span class="si">}</span><span class="s2"> per megajoule."</span><span class="p">)</span>
    <span class="k">return</span>

<span class="n">COSTS</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>

<div id="outline-container-org64d75c4" class="outline-2">
<h2 id="org64d75c4">How Many Megajoules For a Dollar of Gas?</h2>
<div class="outline-text-2" id="text-org64d75c4">
<ul class="org-ul">
<li>A gallon of gasoline carries with it \(\approx 1.3E8\) joules of energy.</li>
<li>You pay \(5 \frac{\text{dollars}}{\text{gallon}}\).</li>
<li>How many megajoules (\(10^6\) joules) can you get for a dollar?</li>
</ul>
</div>

<div id="outline-container-orgcb800fc" class="outline-3">
<h3 id="orgcb800fc">Chain-Link Conversion</h3>
<div class="outline-text-3" id="text-orgcb800fc">
\begin{align}
\require{cancel}
\left(\frac{1 \cancel{gallon}}{5\textit{ dollars}}\right)\left(\frac{1.3 \times 10^8\textit{ joules}}{1 \cancel{gallon}}\right) &amp;= \left(\frac{1.3 \times 10^8 \cancel{joules}}{5\textit{ dollars}}\right)\left(\frac{1 megajoule}{10^6 \cancel{joule}}\right) \\
&amp;=\frac{1.3\times 10^8 megajoules}{(5 \textit{ dollars})\left(10^6\right)}\\
&amp;= 26 \frac{megajoules}{dollar}
\end{align}
</div>
</div>

<div id="outline-container-orgf2d3def" class="outline-3">
<h3 id="orgf2d3def">In Python</h3>
<div class="outline-text-3" id="text-orgf2d3def">
<div class="highlight"><pre><span></span><span class="n">gallons_per_dollar</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">joules_per_gallon</span> <span class="o">=</span> <span class="mi">13</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="mi">7</span>
<span class="n">joules_per_dollar</span> <span class="o">=</span> <span class="n">joules_per_gallon</span> <span class="o">*</span> <span class="n">gallons_per_dollar</span>
<span class="n">MEGAJOULES_PER_JOULE</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span>
<span class="n">gas_megajoules_per_dollar</span> <span class="o">=</span> <span class="n">joules_per_dollar</span> <span class="o">*</span> <span class="n">megajoules_per_joule</span>
<span class="n">gasoline</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">gas_megajoules_per_dollar</span>

<span class="n">print_energy</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">gas_megajoules_per_dollar</span><span class="p">),</span> <span class="s2">"Gasoline"</span><span class="p">)</span>
<span class="n">COSTS</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">gasoline</span><span class="p">,</span> <span class="s2">"Gasoline"</span><span class="p">))</span>
</pre></div>

<pre class="example">
Gasoline provides 26.00 megajoules per dollar.
Gasoline costs $0.0385 per megajoule.
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcc24775" class="outline-2">
<h2 id="orgcc24775">How Many MegaJoules For a Dollar of Electricity?</h2>
<div class="outline-text-2" id="text-orgcc24775">
<ul class="org-ul">
<li>Electricity is $0.05 per kilowatt-hour.</li>
<li>\(1\text{ watt} = 1 \frac{joule}{second}\)</li>
<li>\(1\text{ kilowatt-hour} = 1,000\text{ watts} \times 3,600\text{ seconds}\)</li>
</ul>
</div>

<div id="outline-container-org42729eb" class="outline-3">
<h3 id="org42729eb">Kilowatt-Hour To Joules</h3>
<div class="outline-text-3" id="text-org42729eb">
\begin{align}
1 kilowatt-hour &amp;= (1,000\text{ watts})(3,600\text{ seconds})\\
  &amp;= \left(\frac{1,000\text{ joules}}{\cancel{second}}\right)\left(3,600 \cancel{seconds}\right)\\
  &amp;= 36 \times 10^5 \text{ joules}
\end{align}
</div>
</div>
<div id="outline-container-org1444a80" class="outline-3">
<h3 id="org1444a80">A Dollar's Worth Of Megajoules</h3>
<div class="outline-text-3" id="text-org1444a80">
\begin{align}
\frac{1 \text{ kilowatt-hour}}{0.05\text{ dollars}} &amp;= \left(\frac{3.6 \times \cancel{10^6 joules}}{0.05\text{ dollars}}\right)\left(\frac{1 \text{ megajoule}}{\cancel{10^6 joules}}\right)\\

&amp;= \left(\frac{3.6\ megajoules}{0.05\text{ dollars}}\right)\left(\frac{20}{20}\right) \\
&amp;= 72 \ \frac{megajoules}{dollar}

\end{align}
</div>
</div>
<div id="outline-container-org8815b2c" class="outline-3">
<h3 id="org8815b2c">Check The Math</h3>
<div class="outline-text-3" id="text-org8815b2c">
<div class="highlight"><pre><span></span><span class="n">kilowatt_hours_per_dollar</span> <span class="o">=</span> <span class="mi">20</span> <span class="c1"># 1/0.05 = 20</span>
<span class="n">megajoules</span> <span class="o">=</span> <span class="mf">3.6</span>
<span class="n">electricity_megajoules_per_dollar</span> <span class="o">=</span> <span class="n">kilowatt_hours_per_dollar</span> <span class="o">*</span> <span class="n">megajoules</span>
<span class="n">electricity</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">electricity_megajoules_per_dollar</span>

<span class="n">print_energy</span><span class="p">(</span><span class="n">electricity_megajoules_per_dollar</span><span class="p">,</span> <span class="s2">"Electricity"</span><span class="p">)</span>
<span class="n">COSTS</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">electricity</span><span class="p">,</span> <span class="s2">"Electricity"</span><span class="p">))</span>
</pre></div>

<pre class="example">
Electricity provides 72.00 megajoules per dollar.
Electricity costs $0.0139 per megajoule.
</pre>
</div>
</div>
</div>

<div id="outline-container-org97943a3" class="outline-2">
<h2 id="org97943a3">How Many Megajoules For a Dollar Of Natural Gas?</h2>
<div class="outline-text-2" id="text-org97943a3">
<ul class="org-ul">
<li>A standard cubic foot of natural gas has about \(1.1 \times 10^6\) joules of energy.</li>
<li>You can get about \(5\times 10^5\) BTUs of gas for a dollar.</li>
<li>There are about 1,030 BTUs in a cubic foot.</li>
</ul>

\begin{align}
\left(1.1 \times 10^6 \frac{joules}{\cancel{cubic foot}}\right)\left(\frac{1\ \cancel{cubic foot}}{1.03 \times 10^3\ BTU}\right) &amp;= \left(\frac{1.1 \times 10^3\ joules}{1.03\ \cancel{BTU}}\right)\left(\frac{5 \times 10^5\ \cancel{BTU}}{dollar}\right)\\
&amp;= \left(\frac{5.5 \times 10^8\ \cancel{joules}}{1.03\ dollars}\right)\left(\frac{1\ Megajoule}{10^6 \cancel{joules}}\right)\\
&amp;= \left(\frac{5.5 \times 10^2\ Megajoules}{1.03 dollars}\right)\\
&amp;\approx 533.98\ \frac{Megajoules}{dollar}\\
\end{align}
</div>

<div id="outline-container-orgb5b6897" class="outline-3">
<h3 id="orgb5b6897">Check The Math</h3>
<div class="outline-text-3" id="text-orgb5b6897">
<div class="highlight"><pre><span></span><span class="n">joules_per_cubic_foot</span> <span class="o">=</span> <span class="mf">1.1E6</span>
<span class="n">cubic_feet_per_btu</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">1030</span>
<span class="n">btus_per_dollar</span> <span class="o">=</span> <span class="mf">5e5</span>

<span class="n">joules_per_btu</span> <span class="o">=</span> <span class="n">joules_per_cubic_foot</span> <span class="o">*</span> <span class="n">cubic_feet_per_btu</span>

<span class="n">joules_per_dollar</span> <span class="o">=</span> <span class="n">joules_per_btu</span> <span class="o">*</span> <span class="n">btus_per_dollar</span>
<span class="n">natural_gas_megajoules_per_dollar</span> <span class="o">=</span> <span class="n">joules_per_dollar</span> <span class="o">*</span> <span class="n">MEGAJOULES_PER_JOULE</span>
<span class="n">natural_gas</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">natural_gas_megajoules_per_dollar</span>
<span class="n">print_energy</span><span class="p">(</span><span class="n">natural_gas_megajoules_per_dollar</span><span class="p">,</span> <span class="s2">"Natural Gas"</span><span class="p">)</span>
<span class="n">COSTS</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">natural_gas</span><span class="p">,</span> <span class="s2">"Natural Gas"</span><span class="p">))</span>
</pre></div>

<pre class="example">
Natural Gas provides 533.98 megajoules per dollar.
Natural Gas costs $0.0019 per megajoule.
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc3c008a" class="outline-2">
<h2 id="orgc3c008a">How Many Megajoules For a Dollar of Coal?</h2>
<div class="outline-text-2" id="text-orgc3c008a">
<ul class="org-ul">
<li>A Ton of coal holds about \(3.2 Ã— 10^{10}\) joules of energy.</li>
<li>A Ton of coal costs $40.</li>
</ul>
<p>
How many Megajoules of energy in the form of coal can you get for a dollar?
</p>

\begin{align}
\left(\frac{3.2 \times 10^{10}\ joules}{40\ dollars}\right) &amp;= \left(\frac{8 \times 10^{8} joules}{dollar}\right)\\
&amp;= \left(\frac{8 \times 10^{8}\ \cancel{joules}}{dollar}\right)\left(\frac{1\ Megajoule}{1 \times 10^6\ \cancel{joules}}\right)\\
&amp;=8 \times 10^2 \frac{Megajoules}{dollar}
\end{align}
</div>

<div id="outline-container-orgfe5e6b2" class="outline-3">
<h3 id="orgfe5e6b2">Checking the Math</h3>
<div class="outline-text-3" id="text-orgfe5e6b2">
<div class="highlight"><pre><span></span><span class="n">coal_megajoules_per_dollar</span> <span class="o">=</span> <span class="n">MEGAJOULES_PER_JOULE</span> <span class="o">*</span> <span class="mf">3.2e10</span><span class="o">/</span><span class="mi">40</span>
<span class="n">coal</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">coal_megajoules_per_dollar</span>
<span class="n">print_energy</span><span class="p">(</span><span class="n">coal_megajoules_per_dollar</span><span class="p">,</span> <span class="s2">"Coal"</span><span class="p">)</span>
<span class="n">COSTS</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">coal</span><span class="p">,</span> <span class="s2">"Coal"</span><span class="p">))</span>
</pre></div>

<pre class="example">
Coal provides 800.00 megajoules per dollar.
Coal costs $0.0013 per megajoule.
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbeb7510" class="outline-2">
<h2 id="orgbeb7510">How Many Megajoules Per Dollar In Corn (Biodiesel)?</h2>
<div class="outline-text-2" id="text-orgbeb7510">
<ul class="org-ul">
<li>Corn oil costs about $0.10 per fluid ounce (wholesale).</li>
<li>A fluid ounce carries about 240 dietary calories (kilo-calories).</li>
<li>A calorie is about 4.2 joules.</li>
</ul>
<p>
How many Megajoules of energy in the form of corn oil can you get for a dollar?
</p>

\begin{align}
\left(\frac{1\cancel{fluid-ounce}}{0.10\ dollar}\right)\left(\frac{240\ kilocalories}{\cancel{fluid- ounce}}\right) &amp;= \left(\frac{240\ \cancel{kilocalories}}{0.10\ dollar}\right)\left(\frac{10^3\ calories}{1\ \cancel{kilocalorie}}\right)\\
&amp;=\left(\frac{24\times 10^4\ \cancel{calories}}{0.10\ dollar}\right)\left(\frac{4.2\ joules}{1 \cancel{calorie}}\right)\\
&amp;=\left(\frac{100.8\times 10^4\ joules}{1 \times 10^{-1} dollar}\right)\\
&amp;=\left(\frac{1.008 \times 10^7 joules}{dollar}\right)\left(\frac{1\ megajoule}{10^6\ joules}\right)\\
&amp;= 1.008 \times 10^{1}\ \frac{megajoules}{dollar}\\
&amp;= 10.008
\end{align}
</div>

<div id="outline-container-org7064d50" class="outline-3">
<h3 id="org7064d50">Checking the Math</h3>
<div class="outline-text-3" id="text-org7064d50">
<div class="highlight"><pre><span></span><span class="n">ounces_per_dollar</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mf">0.10</span>
<span class="n">kilocalories_per_ounce</span> <span class="o">=</span> <span class="mi">240</span>
<span class="n">joules_per_calorie</span> <span class="o">=</span> <span class="mf">4.2</span>
<span class="n">calories_per_kilocalorie</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">3</span>

<span class="n">corn_megajoules_per_dollar</span> <span class="o">=</span> <span class="p">(</span><span class="n">ounces_per_dollar</span>
			      <span class="o">*</span> <span class="n">kilocalories_per_ounce</span>
			      <span class="o">*</span> <span class="n">calories_per_kilocalorie</span>
			      <span class="o">*</span> <span class="n">joules_per_calorie</span>
			      <span class="o">*</span> <span class="n">MEGAJOULES_PER_JOULE</span><span class="p">)</span>
<span class="n">corn</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">corn_megajoules_per_dollar</span>
<span class="n">print_energy</span><span class="p">(</span><span class="n">corn_megajoules_per_dollar</span><span class="p">,</span> <span class="s2">"Corn"</span><span class="p">)</span>
<span class="n">COSTS</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">corn</span><span class="p">,</span> <span class="s2">"Corn"</span><span class="p">))</span>
</pre></div>

<pre class="example">
Corn provides 10.08 megajoules per dollar.
Corn costs $0.0992 per megajoule.
</pre>
</div>
</div>
</div>

<div id="outline-container-org8f186f5" class="outline-2">
<h2 id="org8f186f5">What Is the Ratio of the Cost of the Most Expensive to the Cheapest?</h2>
<div class="outline-text-2" id="text-org8f186f5">
<div class="highlight"><pre><span></span><span class="n">most_expensive</span><span class="p">,</span> <span class="n">cheapest</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">COSTS</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">COSTS</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The most expensive form of energy is </span><span class="si">{</span><span class="n">most_expensive</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="si">}</span><span class="s2"> "</span>
      <span class="sa">f</span><span class="s2">"at $</span><span class="si">{</span><span class="n">most_expensive</span><span class="p">[</span><span class="n">cost</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2"> per megajoule."</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The cheapest form of energy is </span><span class="si">{</span><span class="n">cheapest</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="si">}</span><span class="s2"> at "</span>
      <span class="sa">f</span><span class="s2">"$</span><span class="si">{</span><span class="n">cheapest</span><span class="p">[</span><span class="n">cost</span><span class="p">]</span><span class="si">:</span><span class="s2">0.4f</span><span class="si">}</span><span class="s2"> per megajoule."</span><span class="p">)</span>
</pre></div>

<pre class="example">
The most expensive form of energy is Corn at $0.10 per megajoule.
The cheapest form of energy is Coal at $0.0013 per megajoule.
</pre>


<div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">most_expensive</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="n">most_expensive</span><span class="p">[</span><span class="n">cost</span><span class="p">]</span><span class="o">/</span><span class="n">cheapest</span><span class="p">[</span><span class="n">cost</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2"> "</span>
      <span class="sa">f</span><span class="s2">"times more expensive than </span><span class="si">{</span><span class="n">cheapest</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="si">}</span><span class="s2">."</span><span class="p">)</span>
</pre></div>

<pre class="example">
Corn is 79.37 times more expensive than Coal.
</pre>
</div>
</div>

<div id="outline-container-org3e95e01" class="outline-2">
<h2 id="org3e95e01">Source</h2>
<div class="outline-text-2" id="text-org3e95e01">
<ul class="org-ul">
<li><a href="posts/course-global-warming/">Global Warming I: The Science and Modeling of Climate Change</a></li>
</ul>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/number-of-subsets-in-a-set/index.html" class="u-url">Number of Subsets In a Set</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/number-of-subsets-in-a-set/index.html" rel="bookmark">
            <time class="published dt-published" datetime="2022-06-27T13:09:06-07:00" itemprop="datePublished" title="2022-06-27 13:09">2022-06-27 13:09</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="outline-container-org2f96396" class="outline-2">
<h2 id="org2f96396">Short Answer</h2>
<div class="outline-text-2" id="text-org2f96396">
<p>
The number of subsets for a set of <i>n</i> elements is \(2^n\).
</p>
</div>
</div>

<div id="outline-container-org70c0331" class="outline-2">
<h2 id="org70c0331">One Way To Remember It</h2>
<div class="outline-text-2" id="text-org70c0331">
<p>
Let's say we have a set of <i>n</i> things and we want to know how many different ways we can pick subsets of those things (including all of them or none of them). If we have three things, for instance, we might pick only the first item, or the first and the last item, or only the second item, etc.
</p>

<p>
We can represent the items as boxes in a row and if an item is in the subset we put a one in its box and if it isn't then we put a zero there. So for the three item example we can represent the subset that has the first and third item as <i>101</i> (the boxes are invisible and elastic). Writing it this way we can think of each element of the set as a binary digit and the number of subsets you can create is the same as the number of binary numbers with the same number of digits as the elements in our set.
</p>

<p>
To see all the possible subsets you can write out the binary numbers. For the case of three elements we represent them as three digits so finding the subsets will be the equivalent of counting from 0 to 7 in binary.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="org-right"></colgroup>
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">Â </th>
<th scope="col" class="org-right">Item 1</th>
<th scope="col" class="org-right">Item 2</th>
<th scope="col" class="org-right">Item 3</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">3</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">5</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">6</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">7</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>
<p>
In this case we get 8 possibilities. More generally, for <i>n</i> digits we can count from \(0\) to \(2^n - 1\) for a total of \(2^n\) numbers so the total number of subsets of a set with <i>n</i> elements is \(2^n\).
</p>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/algorithms-illuminated-part-3/index.html" class="u-url">Algorithms Illuminated - Part III: Greedy Algorithms and Dynamic Programming</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/algorithms-illuminated-part-3/index.html" rel="bookmark">
            <time class="published dt-published" datetime="2022-06-27T13:03:04-07:00" itemprop="datePublished" title="2022-06-27 13:03">2022-06-27 13:03</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="outline-container-org163d3e6" class="outline-2">
<h2 id="org163d3e6">Citation</h2>
<div class="outline-text-2" id="text-org163d3e6">
<ul class="org-ul">
<li>[AI3] Roughgarden T. Algorithms illuminated. Part 3: Greedy algorithms and dynamic programming. First edition. San Francisco, CA: Soundlikeyourself Publishing, LLC; 2019. 217 p.</li>
</ul>
</div>
</div>
<div id="outline-container-orgc2adaf3" class="outline-2">
<h2 id="orgc2adaf3">On The Web</h2>
<div class="outline-text-2" id="text-orgc2adaf3">
<ul class="org-ul">
<li>
<a href="https://algorithmsilluminated.org/">Algorithms Illuminated website</a>: Has links to all four books, videos, test cases, etc.</li>
<li><a href="https://timroughgarden.org/">Tim Roughgarden's (the author) Website</a></li>
</ul>
</div>
</div>
<div id="outline-container-org3de2dc3" class="outline-2">
<h2 id="org3de2dc3">Other Books in the Series</h2>
<div class="outline-text-2" id="text-org3de2dc3">
<ul class="org-ul">
<li><a href="posts/algorithms-illuminated-part-1/">Algorithms Illuminated - Part 1: The Basics</a></li>
</ul>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/the-knapsack-problem/index.html" class="u-url">The Knapsack Problem</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/the-knapsack-problem/index.html" rel="bookmark">
            <time class="published dt-published" datetime="2022-06-27T12:42:46-07:00" itemprop="datePublished" title="2022-06-27 12:42">2022-06-27 12:42</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li>
<a href="posts/the-knapsack-problem/index.html#org39a9792">The Knapsack Problem(s)</a>
<ul>
<li><a href="posts/the-knapsack-problem/index.html#orgf108d15">Imports</a></li>
<li><a href="posts/the-knapsack-problem/index.html#orge652da3">Setup</a></li>
</ul>
</li>
<li>
<a href="posts/the-knapsack-problem/index.html#org2f7ddef">The Brute Force Solution</a>
<ul>
<li><a href="posts/the-knapsack-problem/index.html#orgadc875a">An Iterative Brute-Force Version</a></li>
<li><a href="posts/the-knapsack-problem/index.html#orgbeee9de">Checking the Brute</a></li>
<li><a href="posts/the-knapsack-problem/index.html#org3fd5288">A Recursive Exhaustive Search</a></li>
<li><a href="posts/the-knapsack-problem/index.html#org69d78b2">Checking The Exhaustive</a></li>
</ul>
</li>
<li>
<a href="posts/the-knapsack-problem/index.html#org70a0825">Levitin's Memory Function</a>
<ul>
<li>
<a href="posts/the-knapsack-problem/index.html#orgadf35dc">Some Pseudocode</a>
<ul>
<li><a href="posts/the-knapsack-problem/index.html#org30f8e1d">The Memoizer</a></li>
<li><a href="posts/the-knapsack-problem/index.html#orgdabc983">A Reconstructor</a></li>
</ul>
</li>
<li>
<a href="posts/the-knapsack-problem/index.html#org73538cc">Memory-Function Knapsack</a>
<ul>
<li><a href="posts/the-knapsack-problem/index.html#org2fe204b">Check the table maker</a></li>
<li><a href="posts/the-knapsack-problem/index.html#org3a6beb8">Check the Final Table</a></li>
<li><a href="posts/the-knapsack-problem/index.html#org3f107d4">Check the Recovered Solution</a></li>
<li><a href="posts/the-knapsack-problem/index.html#org9c50f9f">Check It Against The Examples</a></li>
</ul>
</li>
<li><a href="posts/the-knapsack-problem/index.html#org02ba7d5">Compared to the Exhaustive Search</a></li>
</ul>
</li>
<li>
<a href="posts/the-knapsack-problem/index.html#org949163f">Dynamic Programming</a>
<ul>
<li><a href="posts/the-knapsack-problem/index.html#org3a6bd84">Some Pseudocode</a></li>
<li>
<a href="posts/the-knapsack-problem/index.html#org70a593d">In Python</a>
<ul>
<li><a href="posts/the-knapsack-problem/index.html#org0d279f3">Check the table maker</a></li>
<li><a href="posts/the-knapsack-problem/index.html#org4a879f1">Check the Recovered Solution</a></li>
<li><a href="posts/the-knapsack-problem/index.html#org1fbb594">Check It Against The Examples</a></li>
</ul>
</li>
<li><a href="posts/the-knapsack-problem/index.html#org995a313">Compared</a></li>
</ul>
</li>
<li><a href="posts/the-knapsack-problem/index.html#orgffe7426">Sources</a></li>
</ul>
</div>
</div>
<div id="outline-container-org39a9792" class="outline-2">
<h2 id="org39a9792">The Knapsack Problem(s)</h2>
<div class="outline-text-2" id="text-org39a9792">
<p>
The basic premise of the <i>Knapsack Problem</i> is that we have a knapsack with a maximum capacity (<i>C</i>) and a selection of <i>n</i> items, each item having a weight (\(w_i\)) and a value (\(v_i\)), and we want to pick the items that give us the most total value without exceeding the capacity of our knapsack.
</p>

<p>
There are two forms of the problem. The first form is what <a href="posts/clrs/">CLRS</a> 
calls the \(\textit{0-1 Knapsack Problem}\) because we can either take the item (\(1\)) or not take the item (\(0\)) as opposed to the \(\textit{Fractional Knapsack Problem}\) where the "items" are things that we can take fractional portions of (if we're loading up on spices the \(\textit{0-1}\) problem might be pre-packaged spices while the \(\textit{fractional}\) problem involves scooping spices out of the bulk bins).
</p>

<p>
Although the problems look more or less the same, the fractional problem is one that can be solved using a greedy algorithm while the 0-1 problem can fail if you use a greedy approach so the all-or-nothing version is the more interesting case and the one we'll look at here.
</p>
</div>

<div id="outline-container-orgf108d15" class="outline-3">
<h3 id="orgf108d15">Imports</h3>
<div class="outline-text-3" id="text-orgf108d15">
<div class="highlight"><pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">attrs</span> <span class="kn">import</span> <span class="n">define</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="p">(</span><span class="n">be_below_or_equal</span><span class="p">,</span> <span class="n">contain_exactly</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span><span class="p">,</span>
		     <span class="n">raise_error</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>

<span class="kn">import</span> <span class="nn">altair</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># other monkey stuff</span>
<span class="kn">from</span> <span class="nn">graeae.visualization.altair_helpers</span> <span class="kn">import</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">save_chart</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">Timer</span>
</pre></div>
</div>
</div>

<div id="outline-container-orge652da3" class="outline-3">
<h3 id="orge652da3">Setup</h3>
<div class="outline-text-3" id="text-orge652da3">
<div class="highlight"><pre><span></span><span class="n">Solution</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">"Solution"</span><span class="p">,</span> <span class="s2">"value inventory count"</span><span class="p">)</span>
<span class="n">TableSolution</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">"TableSolution"</span><span class="p">,</span> <span class="s2">"value inventory count table"</span><span class="p">)</span>
<span class="n">NEGATIVE_INFINITY</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">"-inf"</span><span class="p">)</span>
<span class="n">TIMER</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>

<span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"the-knapsack-problem"</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="n">output_path</span><span class="p">(</span><span class="n">SLUG</span><span class="p">)</span>
<span class="n">save_it</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">save_chart</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div id="outline-container-org2f7ddef" class="outline-2">
<h2 id="org2f7ddef">The Brute Force Solution</h2>
<div class="outline-text-2" id="text-org2f7ddef">
<p>
One way to find the optimal load for our knapsack is to find all the possible loads and taking the best load from those that will fit in the knapsack. This requires us to calculate the values for <a href="posts/number-of-subsets-in-a-set/">every subset</a> of items which means we'll have to do \(2^n\) calculations.
</p>
</div>

<div id="outline-container-orgadc875a" class="outline-3">
<h3 id="orgadc875a">An Iterative Brute-Force Version</h3>
<div class="outline-text-3" id="text-orgadc875a">
<p>
To have a reference solution I'll make a brute-force iterative version of the knapsack solver. This will have a greater runtime (\(n 2^n\)) but sometimes starting with something easy is useful, even if it's not the solution we ultimately want.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">brute_knapsack</span><span class="p">(</span><span class="n">capacity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">weights</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Solution</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Finds the best selection of items to maximize value</span>

<span class="sd">    Args:</span>
<span class="sd">     capacity: maximum weight allowed</span>
<span class="sd">     values: value for each item available</span>
<span class="sd">     weights: how much each item weighs</span>

<span class="sd">    Returns:</span>
<span class="sd">     best-value, count of each item, count of loops</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>

    <span class="n">number_of_items</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">number_of_items</span>
    <span class="n">best_value</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">combination</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">number_of_items</span><span class="p">)):</span>
	<span class="n">value</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">carry</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
	<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_items</span><span class="p">):</span>
	    <span class="n">increment</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">+</span> <span class="n">carry</span>
	    <span class="n">keep</span> <span class="o">=</span> <span class="n">increment</span> <span class="o">%</span> <span class="mi">2</span>
	    <span class="n">carry</span> <span class="o">=</span> <span class="n">increment</span><span class="o">//</span><span class="mi">2</span>
	    <span class="k">if</span> <span class="n">keep</span><span class="p">:</span>
		<span class="n">value</span> <span class="o">+=</span> <span class="n">values</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
		<span class="n">weight</span> <span class="o">+=</span> <span class="n">weights</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
	    <span class="n">items</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">keep</span>
	    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="k">if</span> <span class="n">weight</span> <span class="o">&lt;=</span> <span class="n">capacity</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="n">best_value</span><span class="p">:</span>
	    <span class="n">best_value</span> <span class="o">=</span> <span class="n">value</span>
	    <span class="n">solution</span> <span class="o">=</span> <span class="n">items</span><span class="p">[:]</span>

    <span class="k">return</span> <span class="n">Solution</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">best_value</span><span class="p">,</span> <span class="n">inventory</span><span class="o">=</span><span class="n">solution</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgbeee9de" class="outline-3">
<h3 id="orgbeee9de">Checking the Brute</h3>
<div class="outline-text-3" id="text-orgbeee9de">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">totals</span><span class="p">(</span><span class="n">inventory</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">weights</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Reduce the inventory values and weights to a total value and a total weight</span>

<span class="sd">    Args:</span>
<span class="sd">     inventory: list of item counts</span>
<span class="sd">     values: list of values for the items</span>
<span class="sd">     list of weights for the items</span>

<span class="sd">    Returns:</span>
<span class="sd">     value, weight for the inventory</span>
<span class="sd">    """</span>
    <span class="n">value</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">value</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="k">if</span> <span class="n">inventory</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">weight</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="k">if</span> <span class="n">inventory</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">value</span><span class="p">,</span> <span class="n">weight</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_solution</span><span class="p">(</span><span class="n">solution</span><span class="p">:</span> <span class="n">Solution</span><span class="p">,</span>
		   <span class="n">expected_inventory</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
		   <span class="n">values</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">weights</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">capacity</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Check that the solution matches the expected</span>

<span class="sd">    Args:</span>
<span class="sd">     solution: namedtuple with the knapsack solution</span>
<span class="sd">     expected_inventory: list of 0's and 1's representing which items to keep</span>
<span class="sd">     expected_value: total value expected for the solution</span>
<span class="sd">     values: values for the items</span>
<span class="sd">     weights: weights for the items</span>
<span class="sd">     capacity: maximum weight for the knapsack</span>

<span class="sd">    Raises:</span>
<span class="sd">     AssertionError if something isn't the expected</span>
<span class="sd">    """</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">inventory</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected_inventory</span><span class="p">))</span>
    <span class="n">value</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">totals</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">inventory</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
    <span class="n">expected_value</span><span class="p">,</span> <span class="n">expected_weight</span> <span class="o">=</span> <span class="n">totals</span><span class="p">(</span><span class="n">expected_inventory</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_below_or_equal</span><span class="p">(</span><span class="n">capacity</span><span class="p">))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">expected_weight</span><span class="p">))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">expected_value</span><span class="p">))</span>
    <span class="k">return</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_examples</span><span class="p">(</span><span class="n">solver</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Check the toy examples</span>

<span class="sd">    Args:</span>
<span class="sd">     solver: function to find the optimal knapsack load</span>
<span class="sd">    """</span>
    <span class="c1"># values and weights don't match</span>
    <span class="c1"># broken = lambda : solver(5, [0, 1], [2, 1, 3])</span>
    <span class="c1"># expect(broken).to(raise_error(AssertionError))</span>

    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">42</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">25</span><span class="p">]</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">solution</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
    <span class="n">check_solution</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">capacity</span><span class="p">)</span>

    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

    <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">solution</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
    <span class="n">check_solution</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">capacity</span><span class="p">)</span>

    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">18</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">solution</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
    <span class="n">check_solution</span><span class="p">(</span><span class="n">solution</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">capacity</span><span class="p">)</span>

    <span class="c1"># this won't work for greedy algorithms</span>
    <span class="n">capacity</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">42</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span>

<span class="n">check_examples</span><span class="p">(</span><span class="n">brute_knapsack</span><span class="p">)</span>
</pre></div>

<p>
Let's look at a particular solution.
</p>

<div class="highlight"><pre><span></span><span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">capacity</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">solution</span> <span class="o">=</span> <span class="n">brute_knapsack</span><span class="p">(</span><span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Call Count: </span><span class="si">{</span><span class="n">solution</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Chosen knapsack value </span><span class="si">{</span><span class="n">solution</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Item inventory: </span><span class="si">{</span><span class="n">solution</span><span class="o">.</span><span class="n">inventory</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">inventory</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>

<pre class="example">
Call Count: 64
Chosen knapsack value 8
Item inventory: [0, 1, 0, 1]
</pre>


<p>
We have a solution that works, but the runtime is \(n2^n\) so let's make a version that does a little better.
</p>
</div>
</div>

<div id="outline-container-org3fd5288" class="outline-3">
<h3 id="org3fd5288">A Recursive Exhaustive Search</h3>
<div class="outline-text-3" id="text-org3fd5288">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">exhausted</span><span class="p">(</span><span class="n">capacity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">weights</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">this_item</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Solution</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Find the optimal knapsack using an exhaustive search</span>

<span class="sd">    Args:</span>
<span class="sd">     capacity: how much weight the knapsack can hold</span>
<span class="sd">     values: how much the items are worth</span>
<span class="sd">     weights: hom much the items weigh</span>
<span class="sd">     this_item: index of the current item in the values and weights</span>
<span class="sd">     count: number of times this function is called</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>

    <span class="n">next_item</span> <span class="o">=</span> <span class="n">this_item</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="c1"># quit this branch if the knapsack is already out of space</span>
    <span class="k">if</span> <span class="n">capacity</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
	 <span class="k">return</span> <span class="n">Solution</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="o">-</span> <span class="n">this_item</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># to save on an extra base-case call handle the last item separately here</span>
    <span class="k">if</span> <span class="n">next_item</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">):</span>
	<span class="n">skip_this_item</span> <span class="o">=</span> <span class="n">Solution</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">weights</span><span class="p">[</span><span class="n">this_item</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">capacity</span><span class="p">:</span>
	    <span class="k">return</span> <span class="n">skip_this_item</span>

	<span class="n">use_this_item</span> <span class="o">=</span> <span class="n">Solution</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="n">this_item</span><span class="p">],</span>
				 <span class="n">inventory</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
	<span class="k">return</span> <span class="nb">max</span><span class="p">((</span><span class="n">skip_this_item</span><span class="p">,</span> <span class="n">use_this_item</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="c1"># now on to the recursive cases</span>
    <span class="n">descendant_solution</span> <span class="o">=</span> <span class="n">exhausted</span><span class="p">(</span><span class="n">this_item</span><span class="o">=</span><span class="n">next_item</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span>
				    <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>

    <span class="n">skip_count</span> <span class="o">=</span> <span class="n">descendant_solution</span><span class="o">.</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">skip_this_item</span> <span class="o">=</span> <span class="n">Solution</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">descendant_solution</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
			      <span class="n">inventory</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">descendant_solution</span><span class="o">.</span><span class="n">inventory</span><span class="p">,</span>
			      <span class="n">count</span><span class="o">=</span><span class="n">skip_count</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">capacity</span> <span class="o">&lt;</span> <span class="n">weights</span><span class="p">[</span><span class="n">this_item</span><span class="p">]:</span>
	<span class="n">solution</span> <span class="o">=</span> <span class="n">skip_this_item</span>
	<span class="n">count</span> <span class="o">=</span> <span class="n">skip_count</span>
    <span class="k">else</span><span class="p">:</span>
	<span class="n">capacity_after_this_item_is_added</span> <span class="o">=</span> <span class="n">capacity</span> <span class="o">-</span> <span class="n">weights</span><span class="p">[</span><span class="n">this_item</span><span class="p">]</span>
	<span class="n">descendant_solution</span> <span class="o">=</span> <span class="n">exhausted</span><span class="p">(</span>
	    <span class="n">this_item</span><span class="o">=</span><span class="n">next_item</span><span class="p">,</span>
	    <span class="n">capacity</span><span class="o">=</span><span class="n">capacity_after_this_item_is_added</span><span class="p">,</span>
	    <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span>
	    <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>

	<span class="n">check_count</span> <span class="o">=</span> <span class="n">skip_count</span> <span class="o">+</span> <span class="n">descendant_solution</span><span class="o">.</span><span class="n">count</span>

	<span class="n">include_this_item</span> <span class="o">=</span> <span class="n">Solution</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="n">this_item</span><span class="p">]</span> <span class="o">+</span> <span class="n">descendant_solution</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
				     <span class="n">inventory</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">descendant_solution</span><span class="o">.</span><span class="n">inventory</span><span class="p">,</span>
				     <span class="n">count</span><span class="o">=</span><span class="n">check_count</span><span class="p">)</span>

	<span class="n">skip_this_item</span> <span class="o">=</span> <span class="n">Solution</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">skip_this_item</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
				  <span class="n">inventory</span><span class="o">=</span><span class="n">skip_this_item</span><span class="o">.</span><span class="n">inventory</span><span class="p">,</span>
				  <span class="n">count</span><span class="o">=</span><span class="n">check_count</span><span class="p">)</span>
	<span class="n">solution</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="n">skip_this_item</span><span class="p">,</span> <span class="n">include_this_item</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
	<span class="n">count</span> <span class="o">=</span> <span class="n">check_count</span>
    <span class="k">return</span> <span class="n">solution</span>

<span class="n">check_examples</span><span class="p">(</span><span class="n">exhausted</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-org69d78b2" class="outline-3">
<h3 id="org69d78b2">Checking The Exhaustive</h3>
<div class="outline-text-3" id="text-org69d78b2">
<p>
Let's look at that example that we looked at for the iterative brute-force version.
</p>

<div class="highlight"><pre><span></span><span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">capacity</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">solution</span> <span class="o">=</span> <span class="n">exhausted</span><span class="p">(</span><span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>
<span class="n">brute_solution</span> <span class="o">=</span> <span class="n">brute_knapsack</span><span class="p">(</span><span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Call Count: </span><span class="si">{</span><span class="n">solution</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Chosen knapsack value </span><span class="si">{</span><span class="n">solution</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Item inventory: </span><span class="si">{</span><span class="n">solution</span><span class="o">.</span><span class="n">inventory</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">brute_solution</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">inventory</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">brute_solution</span><span class="o">.</span><span class="n">inventory</span><span class="p">))</span>
</pre></div>

<pre class="example">
Call Count: 12
Chosen knapsack value 8
Item inventory: [0, 1, 0, 1]
</pre>


<p>
So now the number calls has gone down to \(\approx 2^n\), which is better, but not what we want just yet.
</p>
</div>
</div>
</div>
<div id="outline-container-org70a0825" class="outline-2">
<h2 id="org70a0825">Levitin's Memory Function</h2>
<div class="outline-text-2" id="text-org70a0825">
<p>
This is a memoized function that is in <a href="posts/itdaa/">Levitin's book</a>. It looks slightly different from the other memoized functions in the other books (but they all look slightly different from each other anyway) but it's only cosmetic. I've been creating the final solution list of items to use in the functions themselves but I'm going to try doing it the way the books do and separate out the solution using a re-creation function afterwards.
</p>
</div>

<div id="outline-container-orgadf35dc" class="outline-3">
<h3 id="orgadf35dc">Some Pseudocode</h3>
<div class="outline-text-3" id="text-orgadf35dc">
</div>
<div id="outline-container-org30f8e1d" class="outline-4">
<h4 id="org30f8e1d">The Memoizer</h4>
<div class="outline-text-4" id="text-org30f8e1d">
<p>
<b><b>Note:</b></b> Levitin keeps the weights, values, and solution table in the global space so it doesn't appear in the pseudocode. I'm going to copy that here but change it when I get to implementing it.
I'm also going to change the variables a little to get them a little closer to the names I use. I'll call the eternal collections \(\textit{Table, Weights}\), and \(\textit{Values}\).
</p>

<p>
The \(Table\) is an \(items \times capacity\) table, with from 0 to number of items rows and 0 to the capacity columns. The 0 row and 0 column get initialized with 0 and the other cells with -1. If we have 4 items and a knapsack capacity of 5 we'd have an initial table like this.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="org-right"></colgroup>
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">Â </th>
<th scope="col" class="org-right">0</th>
<th scope="col" class="org-right">1</th>
<th scope="col" class="org-right">2</th>
<th scope="col" class="org-right">3</th>
<th scope="col" class="org-right">4</th>
<th scope="col" class="org-right">5</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">0</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-right">0</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
</tr>
<tr>
<td class="org-right">3</td>
<td class="org-right">0</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-right">0</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
<td class="org-right">-1</td>
</tr>
</tbody>
</table>
<p>
Where the rows are the items and the columns are the used-capacities for the knapsack.
</p>

<pre id="memory-function-algorithm" style="display:hidden;">
\begin{algorithm}
\caption{Memory Function Knapsack Solver}
\begin{algorithmic}
\INPUT $i$: the number of the first items to consider.
\INPUT $c$: the knapsack's capacity.
\OUTPUT Value of the optimal subset of the first $i$ items that fit in the knapsack.
\PROCEDURE{MFKnapsack}{$i, c$}
\IF {\textit{Table}$[i, c] &lt; 0$}
 \IF {$c &lt; \textit{Weights}[i]$}
  \STATE $v \gets $ \textsc{MFKnapsack}($i - 1, c$)
 \ELSE
  \STATE $v \gets $ \textsc{Max}(\textsc{MFKnapsack}($i - 1, c$), $\textit{Values}[i] + $ \textsc{MFKnapsack}($i - 1, c - \textit{Weights}[i]$))
 \ENDIF
 \STATE $\textit{Table}[i, c] \gets v$
\ENDIF
\RETURN $\textit{Table}[i, c]$
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>

<p>
To start the function you would pass in the total number of items as the argument for \(i\). Since we initialized the cells (other than the zero row and column) with -1 the initial <i>if</i> is a check to see if the item and capacity passed to the function is already in the table and if it isn't we run the body but if it is we can just return the value from the table.
</p>

<p>
In the body if the weight of the current item is beyond the remaining capacity of the knapsack we pick the value for the previous item using the current capacity. If the current item will fit in the knapsack then we pick the larger of the previous item's entry with the current capacity and the value of the current item plus the previous item's entry for the current capacity minus the weight of the current item - meaning we pick the bigger of the values we get if we skip this item or keep it.
</p>

<ol class="org-ol">
<li>If the item and capacity aren't in the table:
<ul class="org-ul">
<li>If the item's weight is greater than the remaining capacity use the previous item's value for the current capacity.</li>
<li>Otherwise use the greater of the previous item's value and this item's value plus the previous item's value for the current capacity minus the current item's weight (the capacity if you use the current item)</li>
<li>Whichever value you use, set it to the table's entry for this item and the current capacity</li>
</ul>
</li>
<li>Return the table entry for this item and the current capacity</li>
</ol>
</div>
</div>

<div id="outline-container-orgdabc983" class="outline-4">
<h4 id="orgdabc983">A Reconstructor</h4>
<div class="outline-text-4" id="text-orgdabc983">
<p>
The main algorithm builds a memo-table and returns the value of the optimal solution but doesn't tell you which  items are actually taken. For that we'll need a separate function. The pseudocode assumes that the weights (\(w_i\)) and values (\(v_i\)) are global variables.
</p>

<pre id="reconstruction-algorithm" style="display:hidden;">
\begin{algorithm}
\caption{Knapsack Inventory Reconstructor}
\begin{algorithmic}
\INPUT $A$: The table created to solve the knapsack problem
\INPUT $c$: the knapsack's capacity.
\OUTPUT An optimal knapsack solution
\PROCEDURE{KnapsackReconstruction}{$A, C$}

\STATE \( S \gets \emptyset \)
\STATE \(c \gets C \)
\FOR {\(i = n \ldots 1\)}
    \IF {\(w_i \leq c\) and \(A[i - 1][c - w_i] + v_i \geq A[i - 1][c]\)}
        \STATE \(S \gets S \cup \{i\}\)
        \STATE \(c \gets c - w_i\)
    \ENDIF
\ENDFOR
\RETURN \(S\)
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>
</div>
</div>
</div>


<div id="outline-container-org73538cc" class="outline-3">
<h3 id="org73538cc">Memory-Function Knapsack</h3>
<div class="outline-text-3" id="text-org73538cc">
<p>
The counts and such are cluttering up the function so I'm going to make this class-based.
</p>

<div class="highlight"><pre><span></span><span class="nd">@define</span>
<span class="k">class</span> <span class="nc">Memorizer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Dynamic Programming solution to the knapsack problem</span>

<span class="sd">    Args:</span>
<span class="sd">     capacity: total capacity (by weight) of knapsack</span>
<span class="sd">     values: values for items to put in knapsack</span>
<span class="sd">     weights: weights for items to put in knapsack</span>
<span class="sd">    """</span>
    <span class="n">capacity</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">values</span><span class="p">:</span> <span class="nb">list</span>
    <span class="n">weights</span><span class="p">:</span> <span class="nb">list</span>
    <span class="n">_items</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_table</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">count</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">_value</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_inventory</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">	</span><span class="sd">"""The number of items available for the knapsack</span>

<span class="sd">	Raises:</span>
<span class="sd">	 AssertionError: the number of values and weights don't match</span>

<span class="sd">	Returns:</span>
<span class="sd">	 number of items</span>
<span class="sd">	"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
	    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_items</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">	</span><span class="sd">"""The total value of the optimal knapsack"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">,</span>
					  <span class="bp">self</span><span class="o">.</span><span class="n">capacity</span><span class="p">)</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">	</span><span class="sd">"""The memo table</span>

<span class="sd">	Returns:</span>
<span class="sd">	items + 1 x capacity + 1 list of lists: 0's in 0 column/row, -1 elsewhere</span>
<span class="sd">	"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
	    <span class="n">first_row</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">capacity</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
	    <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">capacity</span>
	    <span class="n">table</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[:]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)]</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_table</span> <span class="o">=</span> <span class="p">[</span><span class="n">first_row</span><span class="p">]</span> <span class="o">+</span> <span class="n">table</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table</span>

    <span class="k">def</span> <span class="nf">find_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">capacity</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">	</span><span class="sd">"""Find the best total value for the knapsack</span>

<span class="sd">	Args:</span>
<span class="sd">	 item: the number of the item to use (0...item)</span>
<span class="sd">	 capacity: maximum weight allowed</span>

<span class="sd">	Returns:</span>
<span class="sd">	 best-value</span>
<span class="sd">	"""</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="c1"># the table is padded </span>
	<span class="c1"># so we need to adjust the item index for weights, values</span>
	<span class="n">this_item</span> <span class="o">=</span> <span class="n">item</span> <span class="o">-</span> <span class="mi">1</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">capacity</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
	    <span class="n">previous_item</span> <span class="o">=</span> <span class="n">item</span> <span class="o">-</span> <span class="mi">1</span>
	    <span class="n">previous_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_value</span><span class="p">(</span><span class="n">previous_item</span><span class="p">,</span> <span class="n">capacity</span><span class="p">)</span>

	    <span class="k">if</span> <span class="n">capacity</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">this_item</span><span class="p">]:</span>
		<span class="n">value</span> <span class="o">=</span> <span class="n">previous_value</span>
	    <span class="k">else</span><span class="p">:</span>
		<span class="n">value</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">previous_value</span><span class="p">,</span>
			    <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">this_item</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_value</span><span class="p">(</span>
				<span class="n">previous_item</span><span class="p">,</span>
				<span class="n">capacity</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">this_item</span><span class="p">]))</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">capacity</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">capacity</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">inventory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">	</span><span class="sd">"""Reconstructs the optimal knapsack load using the table</span>

<span class="sd">	Returns:</span>
<span class="sd">	 inventory of items in the optimal knapsack</span>
<span class="sd">	"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inventory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
	    <span class="c1"># make sure that the problem has already been solved</span>
	    <span class="bp">self</span><span class="p">()</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_inventory</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span>
	    <span class="n">remaining_capacity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capacity</span>

	    <span class="k">for</span> <span class="n">table_item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
		<span class="c1"># table_item is padded by one</span>
		<span class="n">this_item</span> <span class="o">=</span> <span class="n">previous_table_item</span> <span class="o">=</span> <span class="n">table_item</span> <span class="o">-</span> <span class="mi">1</span>

		<span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">this_item</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">remaining_capacity</span> <span class="ow">and</span>
		    <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">previous_table_item</span><span class="p">][</span>
			<span class="n">remaining_capacity</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">this_item</span><span class="p">]]</span>
		    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">this_item</span><span class="p">]</span>
		    <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">previous_table_item</span><span class="p">][</span><span class="n">remaining_capacity</span><span class="p">]):</span>
		    <span class="bp">self</span><span class="o">.</span><span class="n">_inventory</span><span class="p">[</span><span class="n">this_item</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
		    <span class="n">remaining_capacity</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">this_item</span><span class="p">]</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inventory</span>            

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">	</span><span class="sd">"""Finds the best solution:</span>

<span class="sd">	As a side effect this also sets self.value</span>

<span class="sd">	Returns:</span>
<span class="sd">	 value for optimal knapsack</span>
<span class="sd">	"""</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
</pre></div>
</div>

<div id="outline-container-org2fe204b" class="outline-4">
<h4 id="org2fe204b">Check the table maker</h4>
<div class="outline-text-4" id="text-org2fe204b">
<div class="highlight"><pre><span></span><span class="n">capacity</span><span class="p">,</span> <span class="n">items</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span>
<span class="n">values</span> <span class="o">=</span> <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">items</span>

<span class="n">table</span> <span class="o">=</span> <span class="n">Memorizer</span><span class="p">(</span><span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">table</span>

<span class="c1"># one row per item plus a zero row</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">items</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># columns from 0...capacity</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">capacity</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># first row should be 0's</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

<span class="c1"># first column should be 0's</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

<span class="c1"># everything else should be -1 (items x capacity sub-array)</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">items</span> <span class="o">*</span> <span class="n">capacity</span><span class="p">)))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org3a6beb8" class="outline-4">
<h4 id="org3a6beb8">Check the Final Table</h4>
<div class="outline-text-4" id="text-org3a6beb8">
<div class="highlight"><pre><span></span><span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
<span class="n">capacity</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">memoizer</span> <span class="o">=</span> <span class="n">Memorizer</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">)</span>
<span class="n">memoizer</span><span class="p">()</span>
<span class="n">expect</span><span class="p">(</span><span class="n">memoizer</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">37</span><span class="p">))</span>

<span class="n">expected_table</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
		  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">],</span>
		  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">22</span><span class="p">],</span>
		  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">],</span>
		  <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">37</span><span class="p">]]</span>

<span class="k">for</span> <span class="n">row_index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">memoizer</span><span class="o">.</span><span class="n">table</span><span class="p">):</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected_table</span><span class="p">[</span><span class="n">row_index</span><span class="p">]))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org3f107d4" class="outline-4">
<h4 id="org3f107d4">Check the Recovered Solution</h4>
<div class="outline-text-4" id="text-org3f107d4">
<p>
Although knowing what the optimal value is for the knapsack is somewhat informative in that it tells us what we can expect to achieve, it isn't really the solution since we don't know what items actually give us this value, so we're going to need to reconstruct it from the table.
</p>

<div class="highlight"><pre><span></span><span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
<span class="n">capacity</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">solution</span> <span class="o">=</span> <span class="n">Memorizer</span><span class="p">(</span><span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">inventory</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org9c50f9f" class="outline-4">
<h4 id="org9c50f9f">Check It Against The Examples</h4>
<div class="outline-text-4" id="text-org9c50f9f">
<div class="highlight"><pre><span></span><span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">capacity</span> <span class="o">=</span> <span class="mi">6</span>

<span class="n">solution</span> <span class="o">=</span> <span class="n">Memorizer</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Chosen knapsack value </span><span class="si">{</span><span class="n">solution</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Item inventory: </span><span class="si">{</span><span class="n">solution</span><span class="o">.</span><span class="n">inventory</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Call Count: </span><span class="si">{</span><span class="n">solution</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">check_examples</span><span class="p">(</span><span class="n">Memorizer</span><span class="p">)</span>
</pre></div>

<pre class="example">
Chosen knapsack value 8
Item inventory: [0, 1, 0, 1]
Call Count: 17
</pre>


<p>
Our solution is correct, but if you count all the function calls, not just the calls where the solution isn't in the table yet, it takes more calls than our exhaustive function. 
</p>
</div>
</div>
</div>

<div id="outline-container-org02ba7d5" class="outline-3">
<h3 id="org02ba7d5">Compared to the Exhaustive Search</h3>
<div class="outline-text-3" id="text-org02ba7d5">
<div class="highlight"><pre><span></span><span class="n">sizes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">61</span><span class="p">))</span>

<span class="c1"># 0 weights break the Memorizer so make sure everything weighs at least 1</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">)),</span> <span class="n">k</span><span class="o">=</span><span class="n">size</span><span class="p">)</span> <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">sizes</span><span class="p">]</span>
<span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="n">size</span><span class="p">)),</span> <span class="n">k</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
	   <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">sizes</span><span class="p">]</span>
<span class="n">capacities</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span> <span class="k">for</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">weights</span><span class="p">]</span>

<span class="n">capacities_values_weights</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">capacities</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">))</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">exhaustive_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
    <span class="n">delayed</span><span class="p">(</span><span class="n">exhausted</span><span class="p">)(</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">capacity</span><span class="p">,</span><span class="n">values</span><span class="p">,</span><span class="n">weights</span> <span class="ow">in</span> <span class="n">capacities_values_weights</span><span class="p">)</span>
</pre></div>

<pre class="example">
Started: 2022-07-11 02:35:10.337731
Ended: 2022-07-11 02:50:47.862952
Elapsed: 0:15:37.525221
</pre>


<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">memorizer_knapsack</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">):</span>
    <span class="n">memorizer</span> <span class="o">=</span> <span class="n">Memorizer</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
    <span class="n">memorizer</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">memorizer</span>

<span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">memorized_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
    <span class="n">delayed</span><span class="p">(</span><span class="n">memorizer_knapsack</span><span class="p">)(</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">capacity</span><span class="p">,</span><span class="n">values</span><span class="p">,</span><span class="n">weights</span> <span class="ow">in</span> <span class="n">capacities_values_weights</span><span class="p">)</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">output</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">exhaustive_output</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
	<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">memorized_output</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
	<span class="n">capacity</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">capacities_values_weights</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
	<span class="n">b_value</span><span class="p">,</span> <span class="n">b_weight</span> <span class="o">=</span> <span class="n">totals</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">inventory</span><span class="p">,</span>
				   <span class="n">value</span><span class="p">,</span>
				   <span class="n">weight</span><span class="p">)</span>
	<span class="n">m_value</span><span class="p">,</span> <span class="n">m_weight</span> <span class="o">=</span> <span class="n">totals</span><span class="p">(</span><span class="n">memorized_output</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">inventory</span><span class="p">,</span>
				   <span class="n">value</span><span class="p">,</span>
				   <span class="n">weight</span><span class="p">)</span>
	<span class="n">expect</span><span class="p">(</span><span class="n">m_value</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">b_value</span><span class="p">))</span>
	<span class="n">expect</span><span class="p">(</span><span class="n">m_weight</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_below_or_equal</span><span class="p">(</span><span class="n">capacity</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
	<span class="n">c</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">capacities_values_weights</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
	<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Index: </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
	<span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
	<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Brute: </span><span class="si">{</span><span class="n">brute_knapsack</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
	<span class="k">raise</span>
</pre></div>

<pre class="example">
Started: 2022-07-11 05:00:50.158584
Ended: 2022-07-11 05:00:52.849549
Elapsed: 0:00:02.690965
</pre>


<div class="highlight"><pre><span></span><span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"Items"</span><span class="p">:</span> <span class="n">sizes</span><span class="p">,</span>
			  <span class="s2">"Exhaustive"</span><span class="p">:</span> <span class="p">[</span>
			      <span class="n">solution</span><span class="o">.</span><span class="n">count</span>
			      <span class="k">for</span> <span class="n">solution</span> <span class="ow">in</span> <span class="n">exhaustive_output</span><span class="p">],</span>
			  <span class="s2">"Memoized"</span><span class="p">:</span> <span class="p">[</span>
			      <span class="n">solution</span><span class="o">.</span><span class="n">count</span>
			      <span class="k">for</span> <span class="n">solution</span> <span class="ow">in</span> <span class="n">memorized_output</span><span class="p">]})</span>

<span class="n">melted</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Items"</span><span class="p">],</span>
		    <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Exhaustive"</span><span class="p">,</span> <span class="s2">"Memoized"</span><span class="p">],</span>
		    <span class="n">var_name</span><span class="o">=</span><span class="s2">"Algorithm"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Calls"</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Items"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Calls"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Algorithm"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Items"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Calls"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="s2">"Algorithm"</span><span class="p">],</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Exhaustive vs Memoized Knapsack Solution"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"exhaustive-vs-memoized"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/the-knapsack-problem/exhaustive-vs-memoized.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>

<p>
The height of those last points squashes the previous points down to make it look like the two algorithms do about the same until you hit 47 items, but if you trim off those end points you'll see that the exhaustive algorithm generally requires much more calls than the memoized version. The points aren't on a smooth line as a function of the number of items because whenever an item won't fit in the remaining capacity of the knapsack we skip the second recursive call.
</p>

<div class="highlight"><pre><span></span><span class="n">UPPER_BOUND</span> <span class="o">=</span> <span class="mi">47</span>
<span class="n">trimmed</span> <span class="o">=</span> <span class="n">melted</span><span class="p">[</span><span class="n">melted</span><span class="o">.</span><span class="n">Items</span> <span class="o">&lt;</span> <span class="n">UPPER_BOUND</span><span class="p">]</span>
<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">trimmed</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Items"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Calls"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Algorithm"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Items"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Calls"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="s2">"Algorithm"</span><span class="p">],</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">"Exhaustive vs Memoized Knapsack Solution (&lt; </span><span class="si">{</span><span class="n">UPPER_BOUND</span><span class="si">}</span><span class="s2">)"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"exhaustive-vs-memoized-trimmed"</span><span class="p">)</span>
</pre></div>


<object type="text/html" data="posts/the-knapsack-problem/exhaustive-vs-memoized-trimmed.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>
</div>
</div>
</div>

<div id="outline-container-org949163f" class="outline-2">
<h2 id="org949163f">Dynamic Programming</h2>
<div class="outline-text-2" id="text-org949163f">
<p>
This is taken from <a href="posts/algorithms-illuminated-part-3/">Algorithms Illuminated Part 3</a>.
</p>
</div>

<div id="outline-container-org3a6bd84" class="outline-3">
<h3 id="org3a6bd84">Some Pseudocode</h3>
<div class="outline-text-3" id="text-org3a6bd84">
<pre id="dynamic-programming-algorithm" style="display:hidden;">
\begin{algorithm}
\caption{Dynamic Programming Knapsack Solver}
\begin{algorithmic}
\INPUT Item Values: \(v_1, v_2, \ldots, v_n\)
\INPUT Item Weights: \(w_1, w_2, \ldots, w_n\)
\INPUT Knapsack Capacity \(C\)
\OUTPUT Subset \(S\) of items with maximum possible sum of values and size at most \(C\)
\PROCEDURE{DynamicKnapsack}{\(v, w, C\)}
\STATE \(A \gets (n + 1) \times (c + 1)\) two dimensional array.
\FOR {\(c \in \{0 \ldots C\}\)}
  \STATE \(A[0][c] \gets 0\)
\ENDFOR

\FOR {\(i \in \{1 \ldots n\}\)}
  \FOR {\(c \in \{0 \ldots C \}\)}
    \IF {\(w_i &gt; C \)}
      \STATE \(A[i][c] \gets A[i - 1][c]\)
    \ELSE
      \STATE \(A[i][c] \gets \)\textsc{Max}(\(A[i - 1][c], A[i - 1][c - w_i] + v_i\))
    \ENDIF
  \ENDFOR
\ENDFOR

\RETURN \(A[n][C]\)
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>

<p>
This looks pretty much like the memoized-recursive version so it shouldn't be too hard to understand.
</p>
</div>
</div>

<div id="outline-container-org70a593d" class="outline-3">
<h3 id="org70a593d">In Python</h3>
<div class="outline-text-3" id="text-org70a593d">
<div class="highlight"><pre><span></span><span class="nd">@define</span>
<span class="k">class</span> <span class="nc">CaptainDynamic</span><span class="p">(</span><span class="n">Memorizer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Dynamic Programming solution to the knapsack problem</span>

<span class="sd">    Args:</span>
<span class="sd">     capacity: total capacity (by weight) of knapsack</span>
<span class="sd">     values: values for items to put in knapsack</span>
<span class="sd">     weights: weights for items to put in knapsack</span>
<span class="sd">    """</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">	</span><span class="sd">"""The total value of the optimal knapsack"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_value</span><span class="p">()</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>

    <span class="k">def</span> <span class="nf">find_value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">	</span><span class="sd">"""Finds the optimal value"""</span>
	<span class="k">for</span> <span class="n">item_row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
	    <span class="n">previous_item</span> <span class="o">=</span> <span class="n">this_item</span> <span class="o">=</span> <span class="n">item_row</span> <span class="o">-</span> <span class="mi">1</span>
	    <span class="k">for</span> <span class="n">capacity</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">capacity</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
		<span class="n">skip_this_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">previous_item</span><span class="p">][</span><span class="n">capacity</span><span class="p">]</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">this_item</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">capacity</span><span class="p">:</span>
		    <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">item_row</span><span class="p">][</span><span class="n">capacity</span><span class="p">]</span> <span class="o">=</span> <span class="n">skip_this_item</span>
		<span class="k">else</span><span class="p">:</span>
		    <span class="n">use_this_item</span> <span class="o">=</span> <span class="p">(</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">previous_item</span><span class="p">][</span>
			    <span class="n">capacity</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">this_item</span><span class="p">]]</span> <span class="o">+</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">this_item</span><span class="p">])</span>

		    <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="n">item_row</span><span class="p">][</span><span class="n">capacity</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
			<span class="p">(</span><span class="n">skip_this_item</span><span class="p">,</span> <span class="n">use_this_item</span><span class="p">)</span>
		    <span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">capacity</span><span class="p">]</span>
</pre></div>
</div>

<div id="outline-container-org0d279f3" class="outline-4">
<h4 id="org0d279f3">Check the table maker</h4>
<div class="outline-text-4" id="text-org0d279f3">
<div class="highlight"><pre><span></span><span class="n">capacity</span><span class="p">,</span> <span class="n">items</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span>
<span class="n">values</span> <span class="o">=</span> <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">items</span>

<span class="n">table</span> <span class="o">=</span> <span class="n">CaptainDynamic</span><span class="p">(</span><span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">table</span>

<span class="c1"># one row per item plus a zero row</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">items</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># columns from 0...capacity</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">capacity</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># first row should be 0's</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

<span class="c1"># first column should be 0's</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

<span class="c1"># everything else should be -1 (items x capacity sub-array)</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">items</span> <span class="o">*</span> <span class="n">capacity</span><span class="p">)))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org4a879f1" class="outline-4">
<h4 id="org4a879f1">Check the Recovered Solution</h4>
<div class="outline-text-4" id="text-org4a879f1">
<p>
Although knowing what the optimal value is for the knapsack is somewhat informative in that it tells us what we can expect to achieve, it isn't really the solution since we don't know what items actually give us this value, so we're going to need to reconstruct it from the table.
</p>

<div class="highlight"><pre><span></span><span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
<span class="n">capacity</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">solution</span> <span class="o">=</span> <span class="n">CaptainDynamic</span><span class="p">(</span><span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">inventory</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="n">m_solution</span> <span class="o">=</span> <span class="n">Memorizer</span><span class="p">(</span><span class="n">capacity</span><span class="o">=</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">m_solution</span><span class="o">.</span><span class="n">inventory</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org1fbb594" class="outline-4">
<h4 id="org1fbb594">Check It Against The Examples</h4>
<div class="outline-text-4" id="text-org1fbb594">
<div class="highlight"><pre><span></span><span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">capacity</span> <span class="o">=</span> <span class="mi">6</span>

<span class="n">d_solution</span> <span class="o">=</span> <span class="n">CaptainDynamic</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Captain Dynamic"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Chosen knapsack value </span><span class="si">{</span><span class="n">d_solution</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Item inventory: </span><span class="si">{</span><span class="n">d_solution</span><span class="o">.</span><span class="n">inventory</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Call Count: </span><span class="si">{</span><span class="n">d_solution</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">check_examples</span><span class="p">(</span><span class="n">CaptainDynamic</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Memorizer"</span><span class="p">)</span>
<span class="n">m_solution</span> <span class="o">=</span> <span class="n">Memorizer</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Chosen knapsack value: </span><span class="si">{</span><span class="n">m_solution</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Item inventory: </span><span class="si">{</span><span class="n">m_solution</span><span class="o">.</span><span class="n">inventory</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Call Count: </span><span class="si">{</span><span class="n">m_solution</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">check_examples</span><span class="p">(</span><span class="n">Memorizer</span><span class="p">)</span>
</pre></div>

<pre class="example">
Captain Dynamic
Chosen knapsack value 8
Item inventory: [0, 1, 0, 1]
Call Count: 28

Memorizer
Chosen knapsack value: 8
Item inventory: [0, 1, 0, 1]
Call Count: 17
</pre>


<p>
Our solution is correct, but if you count all the function calls, not just the calls where the solution isn't in the table yet, it takes more calls than our exhaustive function. 
</p>
</div>
</div>
</div>


<div id="outline-container-org995a313" class="outline-3">
<h3 id="org995a313">Compared</h3>
<div class="outline-text-3" id="text-org995a313">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dynamic_knapsack</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">):</span>
    <span class="n">captain</span> <span class="o">=</span> <span class="n">CaptainDynamic</span><span class="p">(</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
    <span class="n">captain</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">captain</span>

<span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">dynamic_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
    <span class="n">delayed</span><span class="p">(</span><span class="n">dynamic_knapsack</span><span class="p">)(</span><span class="n">capacity</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">capacity</span><span class="p">,</span><span class="n">values</span><span class="p">,</span><span class="n">weights</span> <span class="ow">in</span> <span class="n">capacities_values_weights</span><span class="p">)</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">output</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">exhaustive_output</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
	<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">dynamic_output</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
	<span class="n">capacity</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">capacities_values_weights</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
	<span class="n">b_value</span><span class="p">,</span> <span class="n">b_weight</span> <span class="o">=</span> <span class="n">totals</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">inventory</span><span class="p">,</span>
				   <span class="n">value</span><span class="p">,</span>
				   <span class="n">weight</span><span class="p">)</span>
	<span class="n">m_value</span><span class="p">,</span> <span class="n">m_weight</span> <span class="o">=</span> <span class="n">totals</span><span class="p">(</span><span class="n">dynamic_output</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">inventory</span><span class="p">,</span>
				   <span class="n">value</span><span class="p">,</span>
				   <span class="n">weight</span><span class="p">)</span>
	<span class="n">expect</span><span class="p">(</span><span class="n">m_value</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">b_value</span><span class="p">))</span>
	<span class="n">expect</span><span class="p">(</span><span class="n">m_weight</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_below_or_equal</span><span class="p">(</span><span class="n">capacity</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
	<span class="n">c</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">capacities_values_weights</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
	<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Index: </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
	<span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
	<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Brute: </span><span class="si">{</span><span class="n">brute_knapsack</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
	<span class="k">raise</span>
</pre></div>

<pre class="example">
Started: 2022-07-11 05:08:19.593276
Ended: 2022-07-11 05:08:21.585963
Elapsed: 0:00:01.992687
</pre>


<div class="highlight"><pre><span></span><span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"Items"</span><span class="p">:</span> <span class="n">sizes</span><span class="p">,</span>
			  <span class="s2">"Dynamic"</span><span class="p">:</span> <span class="p">[</span>
			      <span class="n">solution</span><span class="o">.</span><span class="n">count</span>
			      <span class="k">for</span> <span class="n">solution</span> <span class="ow">in</span> <span class="n">dynamic_output</span><span class="p">],</span>
			  <span class="s2">"cN"</span><span class="p">:</span> <span class="p">[</span>
			      <span class="n">solution</span><span class="o">.</span><span class="n">capacity</span> <span class="o">*</span> <span class="n">solution</span><span class="o">.</span><span class="n">items</span>
			      <span class="k">for</span> <span class="n">solution</span> <span class="ow">in</span> <span class="n">dynamic_output</span><span class="p">],</span>
			  <span class="s2">"Memoized"</span><span class="p">:</span> <span class="p">[</span>
			      <span class="n">solution</span><span class="o">.</span><span class="n">count</span>
			      <span class="k">for</span> <span class="n">solution</span> <span class="ow">in</span> <span class="n">memorized_output</span><span class="p">]})</span>

<span class="n">melted</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Items"</span><span class="p">],</span>
		    <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Dynamic"</span><span class="p">,</span> <span class="s2">"Memoized"</span><span class="p">,</span> <span class="s2">"cN"</span><span class="p">],</span>
		    <span class="n">var_name</span><span class="o">=</span><span class="s2">"Algorithm"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Calls"</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Items"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Calls"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Algorithm"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Items"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Calls"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="s2">"Algorithm"</span><span class="p">],</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Dynamic vs Memoized Knapsack Solution"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"dynamic-vs-memoized"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/the-knapsack-problem/dynamic-vs-memoized.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>
</div>
</div>
</div>

<div id="outline-container-orgffe7426" class="outline-2">
<h2 id="orgffe7426">Sources</h2>
<div class="outline-text-2" id="text-orgffe7426">
<ul class="org-ul">
<li><a href="posts/clrs/">Introduction To Algorithms (CLRS)</a></li>
<li><a href="posts/algorithms-illuminated-part-3/">Algorithms Illuminated - Part III: Greedy Algorithms and Dynamic Programming</a></li>
<li><a href="posts/itdaa/">Introduction to the Design &amp; Analysis of Algorithms (Levitin)</a></li>
</ul>
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("memory-function-algorithm"));
});
</script><script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("reconstruction-algorithm"));
});
</script><script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("dynamic-programming-algorithm"));
});
</script>
</div>
</div>
    </div>
    </article>
</div>

        <ul class="pager postindexpager clearfix">
<li class="next"><a href="index-7.html" rel="next">Older posts</a></li>
        </ul>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
             MathJax.Hub.Config({
               tex2jax: {
                 inlineMath: [['$','$'], ['\\(','\\)']],
                 displayMath: [['$$','$$'], ['\\[','\\]']],
                 processEscapes: true,
                 processEnvironments: true,
               },
               displayAlign: 'center',
               "HTML-CSS": {
                 styles: {'.MathJax_Display': {"margin": 0}}
               }
             });
            </script><script src="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.js"></script><!--End of body content--><footer id="footer">
            Scribbles by <a href="mailto:cloisteredmonkey.jmark@slmail.me">The Cloistered Monkey</a> Â© 2023 - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
<div id="license" xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/">
<span property="dct:title">Ape-Iron</span> is licensed under
<a href="http://creativecommons.org/licenses/by-sa/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY-SA 4.0
<img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"><img src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1"></a> 

            
            
        
    </div>
</footer>
</div>


        <script src="assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</div>
</body>
</html>
