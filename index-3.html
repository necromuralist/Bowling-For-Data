<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Striking out for data.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Bowling For Data (old posts, page 3) | Bowling For Data</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="rss.xml">
<link rel="canonical" href="https://necromuralist.github.io/Bowling-For-Data/index-3.html">
<link rel="prev" href="index-4.html" type="text/html">
<link rel="next" href="index-2.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.css">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-light
bg-light
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href=".">

            <span id="blog-title">Bowling For Data</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="categories/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="rss.xml" class="nav-link">RSS feed</a>

                
            </li>
</ul>
<!-- DuckDuckGo custom search --><form method="get" id="search" action="https://duckduckgo.com/" class="navbar-form pull-left">
 <input type="hidden" name="sites" value="https://necromuralist.github.io/Bowling-For-Data/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="Searchâ€¦" class="span2" style="margin-top: 4px;"><input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
</form>
 <!-- End of custom search -->
 

            <ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/the-selection-problem/" class="u-url">The Selection Problem</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/the-selection-problem/" rel="bookmark">
            <time class="published dt-published" datetime="2022-02-20T12:23:40-08:00" itemprop="datePublished" title="2022-02-20 12:23">2022-02-20 12:23</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/the-selection-problem/#orge2a6523">What is the Selection Problem?</a></li>
<li><a href="posts/the-selection-problem/#org93a8570">Selection Vs Sorting</a></li>
<li>
<a href="posts/the-selection-problem/#org4d95430">Familiar Cases</a>
<ul>
<li><a href="posts/the-selection-problem/#org90bf103">Minimum and Maximum</a></li>
<li><a href="posts/the-selection-problem/#org63d1a7f">The Median</a></li>
</ul>
</li>
<li><a href="posts/the-selection-problem/#org81e2160">Sources</a></li>
</ul>
</div>
</div>
<div id="outline-container-orge2a6523" class="outline-2">
<h2 id="orge2a6523">What is the Selection Problem?</h2>
<div class="outline-text-2" id="text-orge2a6523">
<p>
The <i>Selection Problem</i> involves finding the <i>kth</i> smallest item in a collection of <i>n</i> items. This item is called an <b><b>Order Statistic</b></b>.
</p>
</div>
</div>
<div id="outline-container-org93a8570" class="outline-2">
<h2 id="org93a8570">Selection Vs Sorting</h2>
<div class="outline-text-2" id="text-org93a8570">
<p>
If the collection is already sorted then you can just pull the order statistic out directly (assuming it's accessible by its index) and if it isn't you could sort it first and then retrieve the order statistic. Since Mergesort and Heapsort have a runtime of \(\Theta(n \log n)\) we know that this would be the runtime using this method, but since we are only choosing one item we don't need to sort the collection, so we can find the item with less computation, and thus selection is its own problem.
</p>
</div>
</div>
<div id="outline-container-org4d95430" class="outline-2">
<h2 id="org4d95430">Familiar Cases</h2>
<div class="outline-text-2" id="text-org4d95430">
<p>
While you might search for any ranked item (the third item, say), there are three special cases that are common enough to have been given names.
</p>

<ul class="org-ul">
<li>the <i>Minimum</i>
</li>
<li>the <i>Maximum</i>
</li>
<li>the <i>Median</i>
</li>
</ul>
</div>

<div id="outline-container-org90bf103" class="outline-3">
<h3 id="org90bf103">Minimum and Maximum</h3>
<div class="outline-text-3" id="text-org90bf103">
<p>
The <i>Minimum</i> and <i>Maximum</i> are probably self-explanatory, but to be complete: the <i>Minimum</i> is the order statistic when \(k = 1\) and the <i>Maximum</i> is the order statistic when \(k=n\). As an example of the <i>Selection Problem</i> requiring fewer comparisons than the <i>Sorting Problem</i> we can look at finding the <i>Minimum</i> by traversing the array.
</p>

<pre id="minimum" style="display:hidden;">
\begin{algorithm}
\caption{Minimum}
\begin{algorithmic}
\INPUT An array of comparable items
\OUTPUT The smallest item
\PROCEDURE{Minimum}{$A$}
  \STATE minimum $\gets$ A[0]
  \FOR{$i \in \{ 1 \ldots A.length - 1\}$}
   \IF {minimum &gt; A[i]}
    \STATE minimum $\gets$ A[i]
   \ENDIF
  \ENDFOR
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>

<p>
Since we're traversing the collection once it will always have a runtime of \(\Theta(n)\). The <i>Maximum</i> can be found the same way but with the greater than sign in the if-statement.
</p>
</div>
</div>
<div id="outline-container-org63d1a7f" class="outline-3">
<h3 id="org63d1a7f">The Median</h3>
<div class="outline-text-3" id="text-org63d1a7f">
<p>
While most people know what the median is (I once worked with an engineer who thought it was the middle item of the unsorted items, not the item whose value was in the middle, so it might not be true that <i>all</i> people know what it is) but since we're talking about Order Statistics and not <i>Statistics</i> like in <a href="https://en.wikipedia.org/wiki/How_to_Lie_with_Statistics">"How to Lie With Statistics"</a> we'll make it a little more confusing by using a similar but not exactly the same definition.
</p>

<p>
\[
k = \left \lceil \frac{n}{2} \right \rceil
\]
</p>

<p>
This definition comes from <a href="posts/itdaa/">Levitin</a>. In his description he defines the median as the value with half the remaining values less than it and half the remaining values above it, which suggests that he's defining the case where there are an odd number of items only.
</p>

<p>
<a href="posts/clrs/">CLRS</a> gives a two-part definition with the odd case:
</p>

<p>
\[
k = \frac{n + 1}{2}
\]
</p>

<p>
and the case where there are an even number of items broken up into two:
</p>

<p>
\[
\textbf{Lower Median} = \left \lfloor \frac{n + 1}{2} \right \rfloor \\
\textbf{Upper Median} = \left \lceil \frac{n + 1}{2} \right \rceil \\
\]
</p>

<p>
With their median being the <b><b>Lower Median</b></b>. Despite the differences if you run through some numbers you can see that they're basically the same (adding 1 and then taking the floor after dividing by 2 is the same as the ceiling of dividing by 2 without adding 1).
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ceiling</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="n">a</span><span class="o">//-</span><span class="n">b</span><span class="p">)</span>

<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"n=</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">: </span><span class="se">\t</span><span class="s2">Levitin: </span><span class="si">{</span><span class="n">ceiling</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="s2">Lower Median: </span><span class="si">{</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>

<pre class="example">
n=1: 	Levitin: 1	Lower Median: 1
n=2: 	Levitin: 1	Lower Median: 1
n=3: 	Levitin: 2	Lower Median: 2
n=4: 	Levitin: 2	Lower Median: 2
n=5: 	Levitin: 3	Lower Median: 3
n=6: 	Levitin: 3	Lower Median: 3
n=7: 	Levitin: 4	Lower Median: 4
n=8: 	Levitin: 4	Lower Median: 4
n=9: 	Levitin: 5	Lower Median: 5
</pre>


<p>
So we've defined the median but actually finding the median is a little more complicated than finding the minimum or maximum so I'll save that for later.
</p>
</div>
</div>
</div>

<div id="outline-container-org81e2160" class="outline-2">
<h2 id="org81e2160">Sources</h2>
<div class="outline-text-2" id="text-org81e2160">
<ul class="org-ul">
<li><a href="posts/itdaa/">Introduction to the Design &amp; Analysis of Algorithms (Levitin)</a></li>
<li><a href="posts/clrs/">Introduction To Algorithms (CLRS)</a></li>
</ul>
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("minimum"));
});
</script>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/max-heap/" class="u-url">Heap!</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/max-heap/" rel="bookmark">
            <time class="published dt-published" datetime="2022-02-08T13:40:58-08:00" itemprop="datePublished" title="2022-02-08 13:40">2022-02-08 13:40</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li>
<a href="posts/max-heap/#orgce22794">Beginning</a>
<ul>
<li><a href="posts/max-heap/#org95f067b">What's a Heap?</a></li>
<li>
<a href="posts/max-heap/#org824d4a3">Some Functions</a>
<ul>
<li><a href="posts/max-heap/#orga5c5707">Some Requirements</a></li>
<li><a href="posts/max-heap/#orgd8bd5a3">Heap Properties</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="posts/max-heap/#orgc8f37a4">The Max Heap</a>
<ul>
<li><a href="posts/max-heap/#org8fd1250">The Imports</a></li>
<li>
<a href="posts/max-heap/#orge9175f0">The Class</a>
<ul>
<li><a href="posts/max-heap/#org982fe0b">Imports</a></li>
<li><a href="posts/max-heap/#orga651b0b">The Definition</a></li>
<li><a href="posts/max-heap/#org12afd44">From List</a></li>
<li><a href="posts/max-heap/#orgc6bc605">The Heap Size</a></li>
<li><a href="posts/max-heap/#orge5366b4">Length</a></li>
<li><a href="posts/max-heap/#org89202c8">Maximum</a></li>
<li><a href="posts/max-heap/#orgd4e2159">Finding the Parent, Left-Child, and Right-Child of a Node</a></li>
<li><a href="posts/max-heap/#org9303ebe">Heapify A Sub Tree</a></li>
<li><a href="posts/max-heap/#org6112f2f">The Call</a></li>
<li><a href="posts/max-heap/#orgdcbc3e5">Increase a Key</a></li>
<li><a href="posts/max-heap/#orga3e9d87">Insert a Value</a></li>
<li><a href="posts/max-heap/#org2b94b32">Check the Heap Property</a></li>
<li><a href="posts/max-heap/#org0ffd24f">Get and Set Item</a></li>
</ul>
</li>
<li><a href="posts/max-heap/#orge7679da">The Tests</a></li>
</ul>
</li>
<li>
<a href="posts/max-heap/#org41a2cc1">Heap Sort</a>
<ul>
<li><a href="posts/max-heap/#org9d92c6b">Imports</a></li>
<li><a href="posts/max-heap/#org0d76126">The Heap Sort Class</a></li>
<li><a href="posts/max-heap/#org1a9cab4">The Tests</a></li>
</ul>
</li>
<li>
<a href="posts/max-heap/#org0d7a6cc">A Priority Queue</a>
<ul>
<li><a href="posts/max-heap/#org0f0d1fc">The Tests</a></li>
</ul>
</li>
<li><a href="posts/max-heap/#org3927668">Plotting</a></li>
<li><a href="posts/max-heap/#org9250161">End</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgce22794" class="outline-2">
<h2 id="orgce22794">Beginning</h2>
<div class="outline-text-2" id="text-orgce22794">
</div>
<div id="outline-container-org95f067b" class="outline-3">
<h3 id="org95f067b">What's a Heap?</h3>
<div class="outline-text-3" id="text-org95f067b">
<p>
This is a post that looks at <a href="https://en.wikipedia.org/wiki/Heap_(data_structure)">Heaps</a>. According to <a href="posts/clrs/">Introduction To Algorithms (CLRS)</a>, a heap is an array that can be thought of as a nearly complete binary tree which satisfies the <b><b>Heap Property</b></b>. There are actually two heap properties, one for a <b><b>Max Heap</b></b> and one for a <b><b>Min Heap</b></b>.
</p>

<ul class="org-ul">
<li>
<b><b>Max-Heap Property</b></b>: \(A[Parent(i)]) \ge A[i]\)</li>
<li>
<b><b>Min-Heap Property</b></b>: \(A[Parent(i)]) \le A[i]\)</li>
</ul>
<p>
Which means that for any node in a MaxHeap, its value is greater than or equal to that of any of its children, and for any node in a MinHeap, the node's value is less than or equal to its children.
</p>

<p>
The heap has (at least) two attributes.
</p>

<ul class="org-ul">
<li>
<i>A.length</i>: the number of elements in the array</li>
<li>
<i>A.heap-size</i>: the number of elements in the heap (not all elements in the array need to be in the heap)</li>
</ul>
<p>
The first element in the heap is the root (for the Max-Heap it is the largest element, for the Min-Heap it is the smallest).
</p>
</div>
</div>

<div id="outline-container-org824d4a3" class="outline-3">
<h3 id="org824d4a3">Some Functions</h3>
<div class="outline-text-3" id="text-org824d4a3">
<p>
For any Node in the Heap located at <i>i</i>:
</p>

<pre id="parent" style="display:hidden;">
\begin{algorithm}
\caption{Parent}
\begin{algorithmic}
\INPUT The index of a Child Node
\OUTPUT The index of the Child's Parent
\PROCEDURE{Parent}{$i$}
 \RETURN {\(\left \lfloor \frac{i}{2} \right \rfloor\)}
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>

<pre id="left" style="display:hidden;">
\begin{algorithm}
\caption{Left}
\begin{algorithmic}
\INPUT The index of a Parent Node
\OUTPUT The index of the Parent's left child node
\PROCEDURE{Left}{$i$}
 \RETURN 2i
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>

<pre id="right" style="display:hidden;">
\begin{algorithm}
\caption{Right}
\begin{algorithmic}
\INPUT The index of a Parent Node
\OUTPUT The index of the Parent's right child node
\PROCEDURE{Right}{$i$}
 \RETURN 2i + 1
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>

<p>
These Functions show the relationship between the location of a node and its children in the array that makes up the heap.
</p>
</div>

<div id="outline-container-orga5c5707" class="outline-4">
<h4 id="orga5c5707">Some Requirements</h4>
<div class="outline-text-4" id="text-orga5c5707">
<p>
There are also two requirements:
</p>

<ul class="org-ul">
<li>
<b><b>Shape Requirement</b></b>: All levels but the last have to be complete (only the rightmost leaves can be incomplete)</li>
<li>
<b><b>Dominance Requirement</b></b>: Every node is greater than or equal to its children (in the Max-Heap, less than or equal for the Min-Heap)</li>
</ul>
<p>
That Dominance Requirement is also covered by the Heap Property.
</p>
</div>
</div>
<div id="outline-container-orgd8bd5a3" class="outline-4">
<h4 id="orgd8bd5a3">Heap Properties</h4>
<div class="outline-text-4" id="text-orgd8bd5a3">
<p>
These are from <a href="posts/itdaa/">Introduction to the Design &amp; Analysis of Algorithms (Levitin)</a>.
</p>

<ol class="org-ol">
<li>There exists exactly one essentially complete binary tree with <i>n</i> nodes. It's a binary tree so its height is \(\lfloor \log_2 n\rfloor\).</li>
<li>The root of a (Max) Heap always has the largest element.</li>
<li>A node of a heap with all its descendants is also a heap.</li>
<li>A heap implemented as an array with the heap's elements stored at \(1 \ldots n\) can be constructed using:
<ul class="org-ul">
<li>the parental node keys will be the first \(\lfloor \frac{n}{2} \rfloor\) elements while the leaf nodes will be in the last \(\lceil \frac{n}{2} \rceil\) positions</li>
<li>The childern of a parent node at position <i>i</i> will be in positions <i>2i</i> and <i>2i + 1</i>.</li>
<li>The parent of a child node at position <i>i</i> will be in position \(\lfloor \frac{i}{2}\rfloor\).</li>
</ul>
</li>
</ol>
<p>
Property four is what was defined in the functions up above. Levitin also gives a slightly different variation on stating the heap property.
</p>

<p>
\[
H[i] \ge \max{H[2i], H[2i + 1]} \textrm{ for } i= 1, \ldots, \lfloor \frac{n}{2} \rfloor.
\]
</p>

<p>
This is sort of an inversion of the Max-Heap Property stated above. While the Max-Heap Property was given as every node is less than or equal to its parent, this says that every parent is greater than or equal to its children.
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orgc8f37a4" class="outline-2">
<h2 id="orgc8f37a4">The Max Heap</h2>
<div class="outline-text-2" id="text-orgc8f37a4">
</div>
<div id="outline-container-org8fd1250" class="outline-3">
<h3 id="org8fd1250">The Imports</h3>
<div class="outline-text-3" id="text-org8fd1250">
<div class="highlight"><pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">MutableSequence</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Generator</span>

<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">contain_exactly</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span><span class="p">,</span> <span class="n">raise_error</span>

<span class="c1"># software under test</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.heap</span> <span class="kn">import</span> <span class="n">MaxHeap</span>

<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">EmbedHoloviews</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"max-heap"</span>
<span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"files/posts/</span><span class="si">{</span><span class="n">SLUG</span><span class="si">}</span><span class="s2">/"</span>
<span class="n">Embed</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">EmbedHoloviews</span><span class="p">,</span> <span class="n">folder_path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div id="outline-container-orge9175f0" class="outline-3">
<h3 id="orge9175f0">The Class</h3>
<div class="outline-text-3" id="text-orge9175f0">
</div>
<div id="outline-container-org982fe0b" class="outline-4">
<h4 id="org982fe0b">Imports</h4>
<div class="outline-text-4" id="text-org982fe0b">
<div class="highlight"><pre><span></span><span class="c1"># pypi</span>
<span class="c1"># https://www.attrs.org/en/stable/index.html</span>
<span class="kn">from</span> <span class="nn">attrs</span> <span class="kn">import</span> <span class="n">define</span>
</pre></div>
</div>
</div>

<div id="outline-container-orga651b0b" class="outline-4">
<h4 id="orga651b0b">The Definition</h4>
<div class="outline-text-4" id="text-orga651b0b">
<p>
Besides declaring the class definition, the MaxHeap will hold some constants to hopefully make the code easier to read.
</p>

<div class="highlight"><pre><span></span><span class="nd">@define</span>
<span class="k">class</span> <span class="nc">MaxHeap</span><span class="p">:</span>
    <span class="sd">"""Build and maintain a max-heap</span>

<span class="sd">    If you pass in the heap as a list pre-pend it with Infinity</span>

<span class="sd">    Otherwise use ~heap = MaxHeap.from_list(elements)~ to build it</span>
<span class="sd">    """</span>
    <span class="n">INFINITY</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">"inf"</span><span class="p">)</span>
    <span class="n">NEGATIVE_INFINITY</span> <span class="o">=</span> <span class="o">-</span><span class="n">INFINITY</span>
    <span class="n">ROOT_NODE</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">heap</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="n">INFINITY</span><span class="p">]</span>
    <span class="n">_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>

<div id="outline-container-org12afd44" class="outline-4">
<h4 id="org12afd44">From List</h4>
<div class="outline-text-4" id="text-org12afd44">
<p>
This is a class method to create the list for the heap. The calculations for the locations in the array of parent and child nodes is easier if we have a 1-based list so I'll pad the list being passed in. Additionally, I'll set the first value to \(\infty\) so that the Heap Property will pass for the root node without needing any special consideration for what its parent is.
</p>

<div class="highlight"><pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_list</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">heap</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
    <span class="sd">"""Builds a max-heap instance from the starter list</span>

<span class="sd">    Args:</span>
<span class="sd">     heap: list of elements to dump on the heap</span>

<span class="sd">    Returns:</span>
<span class="sd">     MaxHeap instance with the heap list added</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">heap</span> <span class="o">=</span> <span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">]</span> <span class="o">+</span> <span class="n">heap</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgc6bc605" class="outline-4">
<h4 id="orgc6bc605">The Heap Size</h4>
<div class="outline-text-4" id="text-orgc6bc605">
<p>
Since we padded the list holding the heap the length of the list will never be the same as the number of nodes in the heap. Additionally we'll sometimes manipulate things so things that were in the heap are later excluded but still in the list so the <code>size</code> property will help us to keep track of how big we think our heap is.
</p>

<div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""The size of the max heap"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span>

<span class="nd">@size</span><span class="o">.</span><span class="n">setter</span>
<span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_size</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""Set the size of the max heap</span>

<span class="sd">    Args:</span>
<span class="sd">     new_size: how much of the list is in the heap</span>

<span class="sd">    Raises:</span>
<span class="sd">     AssertionError if the size is out of bounds for the list</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_size</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="n">new_size</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>

<div id="outline-container-orge5366b4" class="outline-4">
<h4 id="orge5366b4">Length</h4>
<div class="outline-text-4" id="text-orge5366b4">
<p>
This is the length of the array, not necessarily of the heap. This one's a little tricky, since the padding throws it off by one it would seem that it should be lowered by one, but if you use it to figure out the last index that will mess it up a little. Since we already have the size for the number of nodes I'll just pass the length of the list on and see what happens.
</p>

<p>
I was debating whether to use <code>__len__</code> but I decided that this is really an internal measure and <code>size</code> is meant to be the attribute to use. I'm mostly keeping this around so that it matches the CLRS attributes.
</p>

<div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">length</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""The size of the array for the heap</span>

<span class="sd">    Warning:</span>
<span class="sd">     This includes the padding at the beginning of the list</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div id="outline-container-org89202c8" class="outline-4">
<h4 id="org89202c8">Maximum</h4>
<div class="outline-text-4" id="text-org89202c8">
<p>
Since this is a max-heap the largest element is in the root, this just makes getting it more explicit.
</p>

<div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">maximum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""The value in the root node"""</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ROOT_NODE</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div id="outline-container-orgd4e2159" class="outline-4">
<h4 id="orgd4e2159">Finding the Parent, Left-Child, and Right-Child of a Node</h4>
<div class="outline-text-4" id="text-orgd4e2159">
<p>
These are the implementations of the functions at the start of the post.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""Find the parent of a node</span>

<span class="sd">    Args:</span>
<span class="sd">     node: the index of the node to check</span>

<span class="sd">    Returns:</span>
<span class="sd">     the index of the parent of the node</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">node</span><span class="o">//</span><span class="mi">2</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">left_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""Find the left child of a parent</span>

<span class="sd">    Args:</span>
<span class="sd">     parent: the index of the parent node</span>

<span class="sd">    Returns:</span>
<span class="sd">     index of the left child of the parent</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">parent</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">right_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""Find the right child of a parent</span>

<span class="sd">    Args:</span>
<span class="sd">     parent: the index of the parent node</span>

<span class="sd">    Returns:</span>
<span class="sd">     index of the right child of the parent</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">parent</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
</div>

<div id="outline-container-org9303ebe" class="outline-4">
<h4 id="org9303ebe">Heapify A Sub Tree</h4>
<div class="outline-text-4" id="text-org9303ebe">
<p>
CLRS just calls this MaxHeapify. But then the bottoms-up heapification of the tree seemed more like it should be called heapify so I called it <code>heapify_subtree</code> to note that it starts at a specific node which might not be the root.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">heapify_subtree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">"""Heapify the tree rooted at the node</span>

<span class="sd">    Args:</span>
<span class="sd">     node: index of the node to compare to its descendants</span>
<span class="sd">    """</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_child</span><span class="p">(</span><span class="n">node</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_child</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">largest</span> <span class="o">=</span> <span class="n">node</span>

    <span class="k">if</span> <span class="n">left</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">left</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">largest</span><span class="p">]:</span>
	<span class="c1"># the left child was larger than the current parent node</span>
	<span class="n">largest</span> <span class="o">=</span> <span class="n">left</span>

    <span class="k">if</span> <span class="n">right</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">right</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">largest</span><span class="p">]:</span>
	<span class="c1"># the right child is larger than the left and the current parent</span>
	<span class="n">largest</span> <span class="o">=</span> <span class="n">right</span>

    <span class="k">if</span> <span class="n">largest</span> <span class="o">!=</span> <span class="n">node</span><span class="p">:</span>
	<span class="c1"># the current parent is out of place, swap it with the larger child</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">largest</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">largest</span><span class="p">],</span>
					       <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">])</span>

	<span class="c1"># after the swap the item at "largest" is the value from the </span>
	<span class="c1"># "node" we started with so try it again with this new location</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">heapify_subtree</span><span class="p">(</span><span class="n">largest</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div id="outline-container-org6112f2f" class="outline-4">
<h4 id="org6112f2f">The Call</h4>
<div class="outline-text-4" id="text-org6112f2f">
<p>
This makes the MaxHeap callable and heapifies the entire heap using a bottoms-up construction.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">"""Heapifies the heap</span>

<span class="sd">    Raises:</span>
<span class="sd">     AssertionError: something bad happened and the Heap Property failed</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">heapify_subtree</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">check_rep</span><span class="p">()</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div id="outline-container-orgdcbc3e5" class="outline-4">
<h4 id="orgdcbc3e5">Increase a Key</h4>
<div class="outline-text-4" id="text-orgdcbc3e5">
<p>
When we change the value of a node, if the value is higher than the previous value it might be in the wrong place in the heap (e.g. it might be bigger than its parent) so we need to traverse upward, swapping it with parents smaller than it, until we find where it should go. CLRS made it a requirement that the new value is larger than the old one, which makes sense in light of the name <code>IncreaseKey</code>, but it seems to me that you could just call it <code>ChangeKey</code> and use a conditional instead of raise an exception, but I'll stick with the error for now.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">increase_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="sd">"""Increase the node's value</span>

<span class="sd">    Args:</span>
<span class="sd">     node: index of node in heap to change</span>
<span class="sd">     key: new value for the node</span>

<span class="sd">    Raises:</span>
<span class="sd">     AssertionError if new value isn't larger than the previous value</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="n">key</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">],</span> <span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> not greater than previous value </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="o">.</span><span class="n">node</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">node</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROOT_NODE</span> <span class="ow">and</span>
	   <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="n">node</span><span class="p">)]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">]):</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="n">node</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="n">node</span><span class="p">)],</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">])</span>
	<span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div id="outline-container-orga3e9d87" class="outline-4">
<h4 id="orga3e9d87">Insert a Value</h4>
<div class="outline-text-4" id="text-orga3e9d87">
<p>
CLRS describes <code>insert</code> and <code>increase_key</code> as part of updating a priority queue, but Levitin's description of <code>top-down heap construction</code> seems to use them as an alternative way to create the heap. He describes this method of construction (top-down) as starting with an empty heap and repeatedly inserting elements from the original array until you have a heap.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="sd">"""Insert the key into the heap</span>

<span class="sd">    Args:</span>
<span class="sd">     key: orderable item to insert into the heap</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NEGATIVE_INFINITY</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">increase_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>

<div id="outline-container-org2b94b32" class="outline-4">
<h4 id="org2b94b32">Check the Heap Property</h4>
<div class="outline-text-4" id="text-org2b94b32">
<p>
This checks that the Heap Property holds for all the nodes.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_rep</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">"""Checks the heap property</span>

<span class="sd">    Raises:</span>
<span class="sd">     AssertionError: the heap property has been violated</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
	<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="n">node</span><span class="p">)]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">],</span> <span class="p">(</span>
	    <span class="sa">f</span><span class="s2">"Parent node </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="n">node</span><span class="p">)]</span><span class="si">}</span><span class="s2"> "</span>
	    <span class="sa">f</span><span class="s2">"not &gt;= </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div id="outline-container-org0ffd24f" class="outline-4">
<h4 id="org0ffd24f">Get and Set Item</h4>
<div class="outline-text-4" id="text-org0ffd24f">
<p>
I threw these in because I kept forgetting that the heap is an attribute of the MaxHeap, but it's only for convenience.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">"""Gets an item from the heap</span>

<span class="sd">    Args: </span>
<span class="sd">     node: index of the heap to get the value</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>

<span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">"""Sets the value at the node in the heap</span>

<span class="sd">    Args:</span>
<span class="sd">     node: index of the heap to set the value</span>
<span class="sd">     value: what to set the location in the heap to</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
</div>
<div id="outline-container-orge7679da" class="outline-3">
<h3 id="orge7679da">The Tests</h3>
<div class="outline-text-3" id="text-orge7679da">
<div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">max_heap</span> <span class="o">=</span> <span class="n">MaxHeap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">heap</span><span class="o">=</span><span class="n">start</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">max_heap</span><span class="o">.</span><span class="n">heap</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">([</span><span class="n">max_heap</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">]</span> <span class="o">+</span> <span class="n">start</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">max_heap</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">max_heap</span><span class="o">.</span><span class="n">length</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">max_heap</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">max_heap</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">max_heap</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">max_heap</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">max_heap</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">failure</span><span class="p">():</span> <span class="n">max_heap</span><span class="o">.</span><span class="n">check_rep</span><span class="p">()</span>

<span class="n">expect</span><span class="p">(</span><span class="n">failure</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">raise_error</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">max_heap</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">heap</span> <span class="o">=</span> <span class="n">MaxHeap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span>

<span class="n">heap</span><span class="o">.</span><span class="n">heapify_subtree</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">14</span><span class="p">))</span>

<span class="n">heap</span><span class="o">.</span><span class="n">heapify_subtree</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">14</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">]</span>
<span class="n">heap</span> <span class="o">=</span> <span class="n">MaxHeap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
<span class="n">heap</span><span class="p">()</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">40</span><span class="p">))</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span>
<span class="n">heap</span> <span class="o">=</span> <span class="n">MaxHeap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

<span class="n">heap</span><span class="p">()</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div id="outline-container-org41a2cc1" class="outline-2">
<h2 id="org41a2cc1">Heap Sort</h2>
<div class="outline-text-2" id="text-org41a2cc1">
<div class="highlight"><pre><span></span><span class="o">&lt;&lt;</span><span class="n">heapsort</span><span class="o">-</span><span class="n">imports</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">heap</span><span class="o">-</span><span class="n">sort</span><span class="o">&gt;&gt;</span>
</pre></div>
</div>

<div id="outline-container-org9d92c6b" class="outline-3">
<h3 id="org9d92c6b">Imports</h3>
<div class="outline-text-3" id="text-org9d92c6b">
<div class="highlight"><pre><span></span><span class="c1"># pypi</span>
<span class="c1"># https://www.attrs.org/en/stable/index.html</span>
<span class="kn">from</span> <span class="nn">attrs</span> <span class="kn">import</span> <span class="n">define</span>

<span class="c1"># this project</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.heap</span> <span class="kn">import</span> <span class="n">MaxHeap</span>
</pre></div>
</div>
</div>

<div id="outline-container-org0d76126" class="outline-3">
<h3 id="org0d76126">The Heap Sort Class</h3>
<div class="outline-text-3" id="text-org0d76126">
<p>
The HeapSort uses the fact that a Max Heap always has the largest element at the root and repeatedly puts the root at the end of the list then shrinks the heap so it doesn't include the value that was moved over.
</p>

<div class="highlight"><pre><span></span><span class="nd">@define</span>
<span class="k">class</span> <span class="nc">HeapSort</span><span class="p">:</span>
    <span class="sd">"""Sort using a heap</span>

<span class="sd">    Args:</span>
<span class="sd">     items: collection of items for the sort</span>
<span class="sd">    """</span>
    <span class="n">items</span><span class="p">:</span> <span class="nb">list</span>
    <span class="n">_heap</span><span class="p">:</span> <span class="n">MaxHeap</span><span class="o">=</span><span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">heap</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MaxHeap</span><span class="p">:</span>
	<span class="sd">"""The heap of items"""</span>
	<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_heap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_heap</span> <span class="o">=</span> <span class="n">MaxHeap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">_heap</span><span class="p">()</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_heap</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">without_root</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
	<span class="sd">"""The items without the root """</span>
	<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="o">.</span><span class="n">ROOT_NODE</span><span class="p">:]</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="sd">"""sorts the items"""</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">()</span>
	<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="o">.</span><span class="n">ROOT_NODE</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">],</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="o">.</span><span class="n">size</span> <span class="o">-=</span> <span class="mi">1</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">()</span>
	<span class="k">return</span>
</pre></div>
</div>
</div>

<div id="outline-container-org1a9cab4" class="outline-3">
<h3 id="org1a9cab4">The Tests</h3>
<div class="outline-text-3" id="text-org1a9cab4">
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bowling.sort.heap</span> <span class="kn">import</span> <span class="n">HeapSort</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">items</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
<span class="n">sorter</span> <span class="o">=</span> <span class="n">HeapSort</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>

<span class="n">sorter</span><span class="p">()</span>

<span class="n">items</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="n">expect</span><span class="p">(</span><span class="n">sorter</span><span class="o">.</span><span class="n">without_root</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">items</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div id="outline-container-org0d7a6cc" class="outline-2">
<h2 id="org0d7a6cc">A Priority Queue</h2>
<div class="outline-text-2" id="text-org0d7a6cc">
<p>
Although some books mention that MinHeaps are used for priority queues, CLRS shows a MaxHeap version. This involves adding a couple of methods to the MaxHeap so there's no special class.
</p>
</div>

<div id="outline-container-org0f0d1fc" class="outline-3">
<h3 id="org0f0d1fc">The Tests</h3>
<div class="outline-text-3" id="text-org0f0d1fc">
<div class="highlight"><pre><span></span><span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">heap</span> <span class="o">=</span> <span class="n">MaxHeap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
<span class="n">heap</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">failure</span><span class="p">():</span> <span class="n">heap</span><span class="o">.</span><span class="n">increase_key</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">failure</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">raise_error</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">))</span>

<span class="n">heap</span><span class="o">.</span><span class="n">increase_key</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>

<span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span>
<span class="n">heap</span> <span class="o">=</span> <span class="n">MaxHeap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
<span class="n">heap</span><span class="p">()</span>
<span class="n">heap</span><span class="o">.</span><span class="n">increase_key</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="p">[</span><span class="n">heap</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="mi">1</span><span class="p">)])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">15</span><span class="p">))</span>

<span class="n">heap</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div id="outline-container-org3927668" class="outline-2">
<h2 id="org3927668">Plotting</h2>
<div class="outline-text-2" id="text-org3927668">
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">networkx</span> <span class="kn">import</span> <span class="n">Graph</span>
<span class="kn">import</span> <span class="nn">holoviews</span>

<span class="n">graph</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">heap</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">heap</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">heap</span><span class="o">.</span><span class="n">length</span><span class="p">:</span>
	<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">],</span> <span class="n">heap</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">heap</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="n">node</span><span class="p">)])</span>
    <span class="k">if</span> <span class="n">heap</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">heap</span><span class="o">.</span><span class="n">length</span><span class="p">:</span>
	<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">],</span> <span class="n">heap</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">heap</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">node</span><span class="p">)])</span>
<span class="n">positions</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">drawing</span><span class="o">.</span><span class="n">nx_pydot</span><span class="o">.</span><span class="n">graphviz_layout</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">prog</span><span class="o">=</span><span class="s2">"dot"</span><span class="p">)</span>

<span class="n">plot</span> <span class="o">=</span> <span class="n">holoviews</span><span class="o">.</span><span class="n">Graph</span><span class="o">.</span><span class="n">from_networkx</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">positions</span><span class="p">)</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"heap-plot"</span><span class="p">)()</span>
</pre></div>

<object type="text/html" data="posts/max-heap/heap-plot.html" style="width:100%" height="800">
  <p>Figure Missing</p>
</object>
</div>
</div>

<div id="outline-container-org9250161" class="outline-2">
<h2 id="org9250161">End</h2>
<div class="outline-text-2" id="text-org9250161">
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("parent"));
});
</script><script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("left"));
});
</script><script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("right"));
});
</script>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/quicksort/" class="u-url">Quicksort</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/quicksort/" rel="bookmark">
            <time class="published dt-published" datetime="2022-02-02T16:26:27-08:00" itemprop="datePublished" title="2022-02-02 16:26">2022-02-02 16:26</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/quicksort/#orge76f803">The Algorithm</a></li>
<li>
<a href="posts/quicksort/#org20dad50">Implementing It</a>
<ul>
<li>
<ul>
<li><a href="posts/quicksort/#orge01e137">Some Imports</a></li>
</ul>
</li>
<li><a href="posts/quicksort/#org8d07ec9">Some Setup</a></li>
<li><a href="posts/quicksort/#org9f216c2">The Partition</a></li>
<li>
<a href="posts/quicksort/#org08a29ab">Some Checks</a>
<ul>
<li><a href="posts/quicksort/#org9c65404">The First Example</a></li>
<li><a href="posts/quicksort/#org89bb840">The Pivot Is the Biggest Element</a></li>
</ul>
</li>
<li>
<a href="posts/quicksort/#org4341613">The QuickSort</a>
<ul>
<li><a href="posts/quicksort/#orgd0cd944">Check It Out</a></li>
</ul>
</li>
<li>
<a href="posts/quicksort/#orgdb7b593">Plotting The Quicksort Runtimes</a>
<ul>
<li><a href="posts/quicksort/#org1a8594f">With Random Input</a></li>
<li><a href="posts/quicksort/#org888082a">Worst-Case Input</a></li>
</ul>
</li>
<li><a href="posts/quicksort/#org4e95681">Looking At the Sort In Progress</a></li>
</ul>
</li>
<li><a href="posts/quicksort/#org77fc766">End</a></li>
</ul>
</div>
</div>
<div id="outline-container-orge76f803" class="outline-2">
<h2 id="orge76f803">The Algorithm</h2>
<div class="outline-text-2" id="text-orge76f803">
<p>
I covered the <code>Partition</code> function in <a href="posts/the-partition/">The Road To Partition</a> and now I'll use it to implement a quicksort. This is the <a href="posts/clrs/">CLRS</a> version.
</p>

<pre id="the-quicksort" style="display:hidden;">
\begin{algorithm}
\caption{QuickSort}
\begin{algorithmic}
\INPUT An array and left and right locations defining a subarray
\OUTPUT The subarray is sorted

\PROCEDURE{QuickSort}{A, left, right}

\IF {left &lt; right} 

\STATE pivot $\gets$ \textsc{Partition}(A, left, right)
\STATE \textsc{QuickSort}(A, left, pivot - 1)
\STATE \textsc{QuickSort}(A, pivot + 1, right)

\ENDIF
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>
</div>
</div>
<div id="outline-container-org20dad50" class="outline-2">
<h2 id="org20dad50">Implementing It</h2>
<div class="outline-text-2" id="text-org20dad50">
</div>
<div id="outline-container-orge01e137" class="outline-4">
<h4 id="orge01e137">Some Imports</h4>
<div class="outline-text-4" id="text-orge01e137">
<div class="highlight"><pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">MutableSequence</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">log2</span>

<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">contain_exactly</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>

<span class="kn">import</span> <span class="nn">altair</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># this project</span>
<span class="kn">from</span> <span class="nn">bowling.sort.insertion</span> <span class="kn">import</span> <span class="n">insertion_sort</span>
<span class="kn">from</span> <span class="nn">bowling.sort.merge</span> <span class="kn">import</span> <span class="n">mergesort</span>

<span class="c1"># other monkey stuff</span>
<span class="kn">from</span> <span class="nn">graeae.visualization.altair_helpers</span> <span class="kn">import</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">save_chart</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">Timer</span>
</pre></div>
</div>
</div>

<div id="outline-container-org8d07ec9" class="outline-3">
<h3 id="org8d07ec9">Some Setup</h3>
<div class="outline-text-3" id="text-org8d07ec9">
<div class="highlight"><pre><span></span><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">PartitionOutput</span><span class="p">:</span>
    <span class="sd">"""Keeps the output for the partition funcion"""</span>
    <span class="n">pivot</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">count</span><span class="p">:</span> <span class="nb">int</span>

<span class="n">TIMER</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>

<span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"quicksort"</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="n">output_path</span><span class="p">(</span><span class="n">SLUG</span><span class="p">)</span>
<span class="n">save_it</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">save_chart</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div id="outline-container-org9f216c2" class="outline-3">
<h3 id="org9f216c2">The Partition</h3>
<div class="outline-text-3" id="text-org9f216c2">
<p>
Even though I implemented it in that other post I didn't make it so it returns counts so we can estimate the runtime so I'll do that here.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">partition</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">,</span>
	      <span class="n">left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PartitionOutput</span><span class="p">:</span>
    <span class="sd">"""Partitions the collection around the last element</span>

<span class="sd">    Args:</span>
<span class="sd">     collection: the list to partition</span>
<span class="sd">     left: index of the first element in the sub-list to partition</span>
<span class="sd">     right: index of the last element in the sub-list to partition</span>

<span class="sd">    Returns:</span>
<span class="sd">     PartitionOutput(pivot, count)</span>
<span class="sd">    """</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">pivot_element</span> <span class="o">=</span> <span class="n">collection</span><span class="p">[</span><span class="n">right</span><span class="p">]</span>
    <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">left</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">upper_bound</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
	<span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="k">if</span> <span class="n">collection</span><span class="p">[</span><span class="n">upper_bound</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">pivot_element</span><span class="p">:</span>
	    <span class="n">lower_bound</span> <span class="o">+=</span> <span class="mi">1</span>
	    <span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="n">lower_bound</span><span class="p">],</span>
	     <span class="n">collection</span><span class="p">[</span><span class="n">upper_bound</span><span class="p">])</span> <span class="o">=</span> <span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="n">upper_bound</span><span class="p">],</span>
					 <span class="n">collection</span><span class="p">[</span><span class="n">lower_bound</span><span class="p">])</span>
    <span class="n">pivot</span> <span class="o">=</span> <span class="n">lower_bound</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="n">pivot</span><span class="p">],</span>
     <span class="n">collection</span><span class="p">[</span><span class="n">right</span><span class="p">])</span> <span class="o">=</span> <span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="n">right</span><span class="p">],</span>
			   <span class="n">collection</span><span class="p">[</span><span class="n">pivot</span><span class="p">])</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">PartitionOutput</span><span class="p">(</span><span class="n">pivot</span><span class="o">=</span><span class="n">pivot</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-org08a29ab" class="outline-3">
<h3 id="org08a29ab">Some Checks</h3>
<div class="outline-text-3" id="text-org08a29ab">
</div>
<div id="outline-container-org9c65404" class="outline-4">
<h4 id="org9c65404">The First Example</h4>
<div class="outline-text-4" id="text-org9c65404">
<div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
<span class="n">first_expected_pivot</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">partition</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">pivot</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">first_expected_pivot</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">test</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)))</span>
</pre></div>

<p>
And to make sure the sub-list works.
</p>

<div class="highlight"><pre><span></span><span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">999</span><span class="p">,</span> <span class="mi">888</span><span class="p">,</span> <span class="mi">777</span><span class="p">]</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">left</span> <span class="o">+</span> <span class="n">start</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="o">+</span> <span class="n">right</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">partition</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

<span class="c1"># all we did was shift the sub-list to spots to the right</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">pivot</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">first_expected_pivot</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span>

<span class="c1"># only the sub-list should be partitioned</span>
<span class="n">expect</span><span class="p">(</span><span class="n">test</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">expected</span> <span class="o">+</span> <span class="n">right</span><span class="p">)))</span>

<span class="c1"># the count should match our sub-array</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">start</span><span class="p">)))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org89bb840" class="outline-4">
<h4 id="org89bb840">The Pivot Is the Biggest Element</h4>
<div class="outline-text-4" id="text-org89bb840">
<div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">partition</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="c1"># the pivot should be the last element</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">pivot</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>

<span class="c1"># nothing changes in the list</span>
<span class="n">expect</span><span class="p">(</span><span class="n">test</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">start</span><span class="p">))</span>

<span class="c1"># once again, count should match the size of the input</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div id="outline-container-org4341613" class="outline-3">
<h3 id="org4341613">The QuickSort</h3>
<div class="outline-text-3" id="text-org4341613">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">quicksort</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">,</span> <span class="n">left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""Recursive quicksort</span>

<span class="sd">    Args:</span>
<span class="sd">     collection: list to sort</span>
<span class="sd">     left: index of start of sub-list in collection to sort</span>
<span class="sd">     right: index of end of sub-list in collection to sort</span>

<span class="sd">    Returns:</span>
<span class="sd">     count of comparisons</span>
<span class="sd">    """</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">left</span> <span class="o">&lt;</span> <span class="n">right</span><span class="p">:</span>
	<span class="n">output</span> <span class="o">=</span> <span class="n">partition</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>

	<span class="n">count</span> <span class="o">+=</span> <span class="n">output</span><span class="o">.</span><span class="n">count</span>
	<span class="n">count</span> <span class="o">+=</span> <span class="n">quicksort</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">pivot</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
	<span class="n">count</span> <span class="o">+=</span> <span class="n">quicksort</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">pivot</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">count</span>
</pre></div>
</div>
<div id="outline-container-orgd0cd944" class="outline-4">
<h4 id="orgd0cd944">Check It Out</h4>
<div class="outline-text-4" id="text-orgd0cd944">
<div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">items</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
<span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>

<span class="n">count</span> <span class="o">=</span> <span class="n">quicksort</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"count: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Theoretical Average: </span><span class="si">{</span><span class="n">length</span> <span class="o">*</span> <span class="n">log2</span><span class="p">(</span><span class="n">length</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Theoretical Worst: </span><span class="si">{</span><span class="n">length</span><span class="o">**</span><span class="mi">2</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">items</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">start</span><span class="p">))</span>
</pre></div>

<pre class="example">
count: 37
Theoretical Average: 33.22
Theoretical Worst: 100
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdb7b593" class="outline-3">
<h3 id="orgdb7b593">Plotting The Quicksort Runtimes</h3>
<div class="outline-text-3" id="text-orgdb7b593">
<div class="highlight"><pre><span></span><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">QuicksortOutput</span><span class="p">:</span>
    <span class="sd">"""Holds the output of the quicksort counts"""</span>
    <span class="n">comparisons</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">size</span><span class="p">:</span> <span class="nb">int</span>


<span class="k">def</span> <span class="nf">quicksorter</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuicksortOutput</span><span class="p">:</span>
    <span class="sd">"""runs the quicksort and outputs count and size of collection</span>

<span class="sd">    Args:</span>
<span class="sd">     collection: thing to sort</span>

<span class="sd">    Returns:</span>
<span class="sd">     QuicksortOutput(count, size)</span>
<span class="sd">    """</span>
    <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">quicksort</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">QuicksortOutput</span><span class="p">(</span><span class="n">comparisons</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
</pre></div>
</div>
<div id="outline-container-org1a8594f" class="outline-4">
<h4 id="org1a8594f">With Random Input</h4>
<div class="outline-text-4" id="text-org1a8594f">
<div class="highlight"><pre><span></span><span class="n">things_to_sort</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">))</span> <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">things</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">:</span>
    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">things</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">quick_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
    <span class="n">delayed</span><span class="p">(</span><span class="n">quicksorter</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">)</span>
</pre></div>

<pre class="example">
Started: 2022-02-05 00:57:12.120397
Ended: 2022-02-05 00:57:14.397235
Elapsed: 0:00:02.276838
</pre>


<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">merge_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
    <span class="n">delayed</span><span class="p">(</span><span class="n">mergesort</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">)</span>
</pre></div>

<pre class="example">
Started: 2022-02-05 00:58:40.087042
Ended: 2022-02-05 00:58:42.326204
Elapsed: 0:00:02.239162
</pre>


<p>
<b><b>Note to future self:</b></b> Pypy is much faster with the python inputs and much slower with numpy inputs.
</p>

<div class="highlight"><pre><span></span><span class="n">counts</span> <span class="o">=</span> <span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">comparisons</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">quick_output</span><span class="p">]</span>
<span class="n">sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">quick_output</span><span class="p">]</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"Size"</span><span class="p">:</span> <span class="n">sizes</span><span class="p">,</span> <span class="s2">"QuickSort"</span><span class="p">:</span> <span class="n">counts</span><span class="p">})</span>
<span class="n">frame</span><span class="p">[</span><span class="s2">"Merge Sort"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">output</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">merge_output</span><span class="p">]</span>

<span class="n">melted</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Size"</span><span class="p">],</span>
		    <span class="n">var_name</span><span class="o">=</span><span class="s2">"Sort Algorithm"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Size"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Sort Algorithm"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Size"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Comparisons"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="s2">"Sort Algorithm"</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"QuickSort vs Merge Sort"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"quicksort-runtime"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/quicksort/quicksort-runtime.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>

<p>
I originally had Insertion Sort in the plot too, but it does so poorly that it just squashes both the Merge Sort and Quick Sort runtimes to a flat line. This is kind of an interesting plot. Quick Sort does much, much better than Insertion Sort, but it still doesn't quite keep up with Merge Sort. The trade-off being that Quick Sort does its sorting in place while Merge Sort creates all these temporary copies. 
</p>
</div>
</div>

<div id="outline-container-org888082a" class="outline-4">
<h4 id="org888082a">Worst-Case Input</h4>
<div class="outline-text-4" id="text-org888082a">
<p>
Remember that case in the <a href="posts/the-partition/">the partition</a> post where the last item (the pivot) was the largest item, and how it resulted in nothing being moved around? What if no matter what sub-array you picked, the last item was always the largest? In other words, what if it's already sorted?
</p>

<p>
For one thing with really big inputs the interpreter throws an error because you've made too many recursive calls, so that tells you that something bad is happening.
</p>

<div class="highlight"><pre><span></span><span class="n">things_to_sort</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">))</span> <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="mi">100</span><span class="p">)]</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">quick_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
    <span class="n">delayed</span><span class="p">(</span><span class="n">quicksorter</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">)</span>
</pre></div>

<pre class="example">
Started: 2022-02-05 01:06:19.614254
Ended: 2022-02-05 01:06:20.159874
Elapsed: 0:00:00.545620
</pre>


<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">merge_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
    <span class="n">delayed</span><span class="p">(</span><span class="n">mergesort</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">)</span>
</pre></div>

<pre class="example">
Started: 2022-02-05 01:06:23.592928
Ended: 2022-02-05 01:06:23.661150
Elapsed: 0:00:00.068222
</pre>


<p>
<b><b>Note to future self:</b></b> Pypy is much faster with the python inputs and much slower with numpy inputs.
</p>

<div class="highlight"><pre><span></span><span class="n">counts</span> <span class="o">=</span> <span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">comparisons</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">quick_output</span><span class="p">]</span>
<span class="n">sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">quick_output</span><span class="p">]</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"Size"</span><span class="p">:</span> <span class="n">sizes</span><span class="p">,</span> <span class="s2">"QuickSort"</span><span class="p">:</span> <span class="n">counts</span><span class="p">})</span>
<span class="n">frame</span><span class="p">[</span><span class="s2">"Merge Sort"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">output</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">merge_output</span><span class="p">]</span>

<span class="n">melted</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Size"</span><span class="p">],</span>
		    <span class="n">var_name</span><span class="o">=</span><span class="s2">"Sort Algorithm"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Size"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Sort Algorithm"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Size"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Comparisons"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="s2">"Sort Algorithm"</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"QuickSort vs Merge Sort (Worst-Case)"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"quicksort-runtime-worst"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/quicksort/quicksort-runtime-worst.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>
</div>
</div>
</div>
<div id="outline-container-org4e95681" class="outline-3">
<h3 id="org4e95681">Looking At the Sort In Progress</h3>
<div class="outline-text-3" id="text-org4e95681">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">quicksort_tracer</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">,</span>
		     <span class="n">left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">tracer</span><span class="p">:</span> <span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""Recursive quicksort</span>

<span class="sd">    Args:</span>
<span class="sd">     collection: list to sort</span>
<span class="sd">     left: index of start of sub-list in collection to sort</span>
<span class="sd">     right: index of end of sub-list in collection to sort</span>
<span class="sd">     tracer: dict of element: list of locations</span>

<span class="sd">    Returns:</span>
<span class="sd">     tracer dict</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">tracer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
	<span class="n">tracer</span> <span class="o">=</span> <span class="p">{</span><span class="n">element</span><span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">collection</span><span class="p">)}</span>

    <span class="k">if</span> <span class="n">left</span> <span class="o">&lt;</span> <span class="n">right</span><span class="p">:</span>
	<span class="n">output</span> <span class="o">=</span> <span class="n">partition</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>

	<span class="n">quicksort_tracer</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">pivot</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tracer</span><span class="p">)</span>
	<span class="n">quicksort_tracer</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">pivot</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">tracer</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">collection</span><span class="p">):</span>
	    <span class="n">tracer</span><span class="p">[</span><span class="n">element</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tracer</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">size</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">start</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">inputs</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

<span class="n">tracer</span> <span class="o">=</span> <span class="n">quicksort_tracer</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tracer</span><span class="p">)</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"Quicksort Call"</span><span class="p">})</span>
<span class="n">melted</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Quicksort Call"</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">"Element"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Location"</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Quicksort Call"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Location"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Element"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"Quicksort Call"</span><span class="p">,</span> <span class="s2">"Location"</span><span class="p">,</span> <span class="s2">"Element"</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Quicksort Trace (Reversed Input)"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"quicksort-trace-backwards"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/quicksort/quicksort-trace-backwards.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>

<div class="highlight"><pre><span></span><span class="n">size</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">start</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

<span class="n">tracer</span> <span class="o">=</span> <span class="n">quicksort_tracer</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tracer</span><span class="p">)</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"Quicksort Call"</span><span class="p">})</span>
<span class="n">melted</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Quicksort Call"</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">"Element"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Location"</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Quicksort Call"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Location"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Element"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"Quicksort Call"</span><span class="p">,</span> <span class="s2">"Location"</span><span class="p">,</span> <span class="s2">"Element"</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Quicksort Trace (Shuffled Input)"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"quicksort-trace-shuffled"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/quicksort/quicksort-trace-shuffled.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>
</div>
</div>
</div>


<div id="outline-container-org77fc766" class="outline-2">
<h2 id="org77fc766">End</h2>
<div class="outline-text-2" id="text-org77fc766">
<ul class="org-ul">
<li><a href="posts/clrs/">Introduction To Algorithms (CLRS)</a></li>
<li><a href="posts/itdaa/">Introduction to the Design &amp; Analysis of Algorithms (Levitin)</a></li>
</ul>
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("the-quicksort"));
});
</script>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/the-master-theorem/" class="u-url">The Master Theorem</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/the-master-theorem/" rel="bookmark">
            <time class="published dt-published" datetime="2022-01-26T14:12:02-08:00" itemprop="datePublished" title="2022-01-26 14:12">2022-01-26 14:12</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="outline-container-org72a3b19" class="outline-2">
<h2 id="org72a3b19">The General Divide and Conquer Recurrence</h2>
<div class="outline-text-2" id="text-org72a3b19">
<p>
When we have a <a href="posts/divide-and-conquer/">Divide and Conquer</a> algorithm that we solve via recursion we can estimate the running time using the <b>General Divide and Conquer Recurrence</b>.
</p>

<ul class="org-ul">
<li>\(T(n)\) is the total runtime.</li>
<li>\(n\) is the size of the problem (the number of instances in the input).</li>
<li>\(a\) is the number of the sub-problems that we create that need to be solved.</li>
<li>\(b\) is the number of sub-problems we create (we'll mostly see cases where \(a=b=2\)).</li>
<li>\(f(n)\) is the time spent dividing the problem and later recombining the sub-problems.</li>
</ul>
<p>
Which we combine into this equation.
</p>

<p>
\[
T(n) = aT \left(\frac{n}{b} \right) + f(n)
\]
</p>
</div>
</div>

<div id="outline-container-org60c5393" class="outline-2">
<h2 id="org60c5393">The Master Theorem</h2>
<div class="outline-text-2" id="text-org60c5393">
<p>
In the case where \(f(n) \in \Theta \left (n^d \right)\) and \(d â‰¥ 0\) (so it's either 1 or a power of n), we can use the following conditional cases to estimate the runtime.
</p>

<p>
\[
T(n) \in \begin{cases}
\Theta\left (n^d \right ) &amp; \textrm{if }a &lt; b^d \\
\Theta\left (n^d \log n \right ) &amp; \textrm{if }a = b^d \\
\Theta\left (n^{\log_b a} \right) &amp; \textrm{if }a &gt; b^d
\end{cases}
\]
</p>
</div>
</div>

<div id="outline-container-orga59f6a4" class="outline-2">
<h2 id="orga59f6a4">Source</h2>
<div class="outline-text-2" id="text-orga59f6a4">
<ul class="org-ul">
<li><a href="posts/itdaa/">Introduction to the Design &amp; Analysis of Algorithms (Levitin)</a></li>
</ul>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/the-mergesort/" class="u-url">The Mergesort</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/the-mergesort/" rel="bookmark">
            <time class="published dt-published" datetime="2022-01-25T17:49:38-08:00" itemprop="datePublished" title="2022-01-25 17:49">2022-01-25 17:49</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/the-mergesort/#orgabd71ff">Beginning</a></li>
<li>
<a href="posts/the-mergesort/#org2499926">Middle</a>
<ul>
<li><a href="posts/the-mergesort/#org3143641">The CLRS Algorithm</a></li>
<li><a href="posts/the-mergesort/#org7ebe65b">Runtime</a></li>
<li>
<a href="posts/the-mergesort/#org5cbbdb8">The Levitin</a>
<ul>
<li><a href="posts/the-mergesort/#orgcc02b41">Implement It</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="posts/the-mergesort/#org35648f6">Comparing Sorts</a></li>
<li>
<a href="posts/the-mergesort/#orgccac11f">Looking at the Mergesort</a>
<ul>
<li><a href="posts/the-mergesort/#org6bf7254">A Shuffle Input</a></li>
<li><a href="posts/the-mergesort/#org59562d0">A Reversed Input</a></li>
</ul>
</li>
<li><a href="posts/the-mergesort/#org27dd9ad">End</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgabd71ff" class="outline-2">
<h2 id="orgabd71ff">Beginning</h2>
<div class="outline-text-2" id="text-orgabd71ff">
<p>
This is a look at the <a href="https://en.wikipedia.org/wiki/Merge_sort"><i>Mergesort</i></a>, an example of the <a href="posts/divide-and-conquer/">Divide and Conquer</a> strategy for sorting collections.
</p>
</div>
</div>
<div id="outline-container-org2499926" class="outline-2">
<h2 id="org2499926">Middle</h2>
<div class="outline-text-2" id="text-org2499926">
</div>
<div id="outline-container-org3143641" class="outline-3">
<h3 id="org3143641">The CLRS Algorithm</h3>
<div class="outline-text-3" id="text-org3143641">
<p>
Our <i>Mergesort</i> repeatedly divides the given list into two parts and then recursively calls itself with the sub-problems and then takes advantage of our previously defined <a href="posts/the-merge/">Merge</a> function to combine the solutions together once we are down to one item to sort (\(p = r\)).
</p>

<pre id="the-mergesort" style="display:hidden;">
\begin{algorithm}
\caption{Mergesort}
\begin{algorithmic}
\INPUT An array and left and right locations of the subarray in the array
\OUTPUT The array in sorted order

\PROCEDURE{Mergesort}{$A, p, r$}
\IF {p &lt; r}
         \STATE \textbf{Divide}
         \STATE $q \gets \left \lfloor \frac{p + r}{2} \right \rfloor$
         
         \STATE \\ \textbf{Conquer}
         \STATE \textsc{MergeSort}(A, p, q)
         \STATE \textsc{MergeSort}(A, q + 1, r)

         \STATE \\ \textbf{Combine}
         \STATE \textsc{Merge}(A, p, q, r)
\ENDIF
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>
</div>
</div>

<div id="outline-container-org7ebe65b" class="outline-3">
<h3 id="org7ebe65b">Runtime</h3>
<div class="outline-text-3" id="text-org7ebe65b">
<ul class="org-ul">
<li>
<b><b>Divide:</b></b> \(D(n) = \Theta(1)\)</li>
<li>
<b><b>Conquer:</b></b> \(2T\left (\frac{n}{2}\right)\)</li>
<li>
<b><b>Combine:</b></b> \(C(n) = \Theta(n)\)</li>
</ul>

\begin{align}
T(n) &amp;= 2T \left( \frac{n}{2} \right) + \Theta(1) + \Theta(n) \\
&amp;= 2T \left( \frac{n}{2} \right) + \Theta(n) \\
&amp;= \Theta(n \log_2 n)
\end{align}
</div>
</div>
<div id="outline-container-org5cbbdb8" class="outline-3">
<h3 id="org5cbbdb8">The Levitin</h3>
<div class="outline-text-3" id="text-org5cbbdb8">
<pre id="the-mergesort-levitin" style="display:hidden;">
\begin{algorithm}
\caption{Levitin's Mergesort}
\begin{algorithmic}
\INPUT Array $A[0 \ldots n - 1]$ of orderable elements.
\OUTPUT Array $A[0 \ldots n - 1]$ sorted in non-decreasing order.

\PROCEDURE{MergeSort}{A}
\IF {n &gt; 1}
         \STATE \textbf{Divide}
         \STATE Copy $A\left[0 \ldots \left\lfloor \frac{n}{2} \right\rfloor - 1 \right]$ to $B \left[0 \ldots \left\lfloor \frac{n}{2} \right\rfloor - 1 \right]$
         \STATE Copy $A \left[\left\lfloor \frac{n}{2}\right\rfloor \ldots n - 1 \right]$ to $C \left[0 \ldots \left\lfloor \frac{n}{2} \right\rfloor - 1 \right]$
         
         \STATE \\ \textbf{Conquer}
         \STATE \textsc{MergeSort}(B)
         \STATE \textsc{MergeSort}(C)

         \STATE \\ \textbf{Combine}
         \STATE \textsc{Merge}(B, C, A)
\ENDIF
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>
</div>

<div id="outline-container-orgcc02b41" class="outline-4">
<h4 id="orgcc02b41">Implement It</h4>
<div class="outline-text-4" id="text-orgcc02b41">
<div class="highlight"><pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">MutableSequence</span><span class="p">,</span> <span class="n">Sequence</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">log2</span>

<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">contain_exactly</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">left_stack</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">,</span>
	  <span class="n">right_stack</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">,</span>
	  <span class="n">target</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""Merges values from left and right stacks into target collection</span>

<span class="sd">    Args:</span>
<span class="sd">     left_stack: sorted collection of items to merge</span>
<span class="sd">     right_stack: sorted collection of items to merge</span>
<span class="sd">     target: collection into which to merge the items</span>

<span class="sd">    Returns:</span>
<span class="sd">     count of basic operations</span>
<span class="sd">    """</span>
    <span class="n">left_size</span><span class="p">,</span> <span class="n">right_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">left_stack</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">right_stack</span><span class="p">)</span>
    <span class="n">next_left</span> <span class="o">=</span> <span class="n">next_right</span> <span class="o">=</span> <span class="n">put_item_here</span> <span class="o">=</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="n">next_left</span> <span class="o">&lt;</span> <span class="n">left_size</span> <span class="ow">and</span> <span class="n">next_right</span> <span class="o">&lt;</span> <span class="n">right_size</span><span class="p">:</span>
	<span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="k">if</span> <span class="n">left_stack</span><span class="p">[</span><span class="n">next_left</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">right_stack</span><span class="p">[</span><span class="n">next_right</span><span class="p">]:</span>
	    <span class="n">target</span><span class="p">[</span><span class="n">put_item_here</span><span class="p">]</span> <span class="o">=</span> <span class="n">left_stack</span><span class="p">[</span><span class="n">next_left</span><span class="p">]</span>
	    <span class="n">next_left</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="k">else</span><span class="p">:</span>
	    <span class="n">target</span><span class="p">[</span><span class="n">put_item_here</span><span class="p">]</span> <span class="o">=</span> <span class="n">right_stack</span><span class="p">[</span><span class="n">next_right</span><span class="p">]</span>
	    <span class="n">next_right</span> <span class="o">+=</span> <span class="mi">1</span>

	<span class="n">put_item_here</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">next_left</span> <span class="o">==</span> <span class="n">left_size</span> <span class="ow">and</span> <span class="n">next_right</span> <span class="o">&lt;</span> <span class="n">right_size</span><span class="p">:</span>
	<span class="k">for</span> <span class="n">stack_offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">left_size</span> <span class="o">+</span> <span class="n">right_size</span> <span class="o">-</span> <span class="n">put_item_here</span><span class="p">):</span>
	    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
	    <span class="n">target</span><span class="p">[</span><span class="n">put_item_here</span> <span class="o">+</span> <span class="n">stack_offset</span><span class="p">]</span> <span class="o">=</span> <span class="n">right_stack</span><span class="p">[</span><span class="n">next_right</span> <span class="o">+</span> <span class="n">stack_offset</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">next_left</span> <span class="o">&lt;</span> <span class="n">left_size</span><span class="p">:</span>
	<span class="k">for</span> <span class="n">stack_offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">left_size</span> <span class="o">+</span> <span class="n">right_size</span> <span class="o">-</span> <span class="n">put_item_here</span><span class="p">):</span>
	    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
	    <span class="n">target</span><span class="p">[</span><span class="n">put_item_here</span> <span class="o">+</span> <span class="n">stack_offset</span><span class="p">]</span> <span class="o">=</span> <span class="n">left_stack</span><span class="p">[</span><span class="n">next_left</span> <span class="o">+</span> <span class="n">stack_offset</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">count</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mergesort</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""Sorts the collection using a recursive mergesort</span>

<span class="sd">    Args:</span>
<span class="sd">     collection: a mutable sequence</span>

<span class="sd">    Returns:</span>
<span class="sd">     runtime count</span>
<span class="sd">    """</span>
    <span class="n">items</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">items</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
	<span class="n">middle</span> <span class="o">=</span> <span class="n">items</span><span class="o">//</span><span class="mi">2</span>
	<span class="n">left_stack</span> <span class="o">=</span> <span class="n">collection</span><span class="p">[:</span><span class="n">middle</span><span class="p">]</span>
	<span class="n">right_stack</span> <span class="o">=</span> <span class="n">collection</span><span class="p">[</span><span class="n">middle</span><span class="p">:]</span>
	<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">left_stack</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">right_stack</span><span class="p">)</span> <span class="o">==</span> <span class="n">items</span>
	<span class="n">count</span> <span class="o">+=</span> <span class="n">mergesort</span><span class="p">(</span><span class="n">left_stack</span><span class="p">)</span>
	<span class="n">count</span> <span class="o">+=</span> <span class="n">mergesort</span><span class="p">(</span><span class="n">right_stack</span><span class="p">)</span>
	<span class="n">count</span> <span class="o">+=</span> <span class="n">merge</span><span class="p">(</span><span class="n">left_stack</span><span class="p">,</span> <span class="n">right_stack</span><span class="p">,</span> <span class="n">collection</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">count</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">size</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">10</span>
<span class="n">items</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)),</span> <span class="n">k</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
<span class="n">starting</span> <span class="o">=</span> <span class="n">items</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">runtime</span> <span class="o">=</span> <span class="n">mergesort</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">runtime</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">size</span> <span class="o">*</span> <span class="n">log2</span><span class="p">(</span><span class="n">size</span><span class="p">)))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">items</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">starting</span><span class="p">))))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">size</span> <span class="o">*</span> <span class="n">log2</span><span class="p">(</span><span class="n">size</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">runtime</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>

<pre class="example">
10,240.0
10,240
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org35648f6" class="outline-2">
<h2 id="org35648f6">Comparing Sorts</h2>
<div class="outline-text-2" id="text-org35648f6">
<div class="highlight"><pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">njit</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>

<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">default_rng</span>

<span class="kn">import</span> <span class="nn">altair</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># this project</span>
<span class="kn">from</span> <span class="nn">bowling.sort.insertion</span> <span class="kn">import</span> <span class="n">insertion_sort</span>

<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">Timer</span>
<span class="kn">from</span> <span class="nn">graeae.visualization.altair_helpers</span> <span class="kn">import</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">save_chart</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">numba_random</span> <span class="o">=</span> <span class="n">default_rng</span><span class="p">(</span><span class="mi">2022</span><span class="p">)</span>
<span class="n">TIMER</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>

<span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"the-mergesort"</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="n">output_path</span><span class="p">(</span><span class="n">SLUG</span><span class="p">)</span>
<span class="n">save_it</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">save_chart</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">merger</span><span class="p">(</span><span class="n">thing_to_sort</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
    <span class="sd">"""A thing to add the size of the input to the output</span>

<span class="sd">    Args:</span>
<span class="sd">     thing_to_sort: collection of items to sort</span>

<span class="sd">    Returns:</span>
<span class="sd">     number of things to sort, count of merges</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">thing_to_sort</span><span class="p">),</span> <span class="n">mergesort</span><span class="p">(</span><span class="n">thing_to_sort</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">ninsertion</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="n">insertion_sort</span><span class="p">)</span>

<span class="n">things_to_sort</span> <span class="o">=</span> <span class="p">[</span><span class="n">numba_random</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>
		  <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)]</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">insertion_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
	<span class="n">delayed</span><span class="p">(</span><span class="n">ninsertion</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">)</span>
</pre></div>

<pre class="example">
Started: 2022-01-28 01:12:10.628102
Ended: 2022-01-28 01:12:22.681161
Elapsed: 0:00:12.053059
</pre>


<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">merge_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
	<span class="n">delayed</span><span class="p">(</span><span class="n">merger</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">)</span>
</pre></div>

<pre class="example">
Started: 2022-01-28 01:12:33.278574
Ended: 2022-01-28 01:12:38.850064
Elapsed: 0:00:05.571490
</pre>


<div class="highlight"><pre><span></span><span class="n">SIZE</span><span class="p">,</span> <span class="n">COMPARISONS</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
<span class="n">unzipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">merge_output</span><span class="p">))</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"Size"</span><span class="p">:</span> <span class="n">unzipped</span><span class="p">[</span><span class="n">SIZE</span><span class="p">],</span>
<span class="s2">"Mergesort"</span><span class="p">:</span> <span class="n">unzipped</span><span class="p">[</span><span class="n">COMPARISONS</span><span class="p">]})</span>

<span class="n">unzipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">insertion_output</span><span class="p">))</span>
<span class="n">frame</span><span class="p">[</span><span class="s2">"Insertion Sort"</span><span class="p">]</span> <span class="o">=</span> <span class="n">unzipped</span><span class="p">[</span><span class="n">COMPARISONS</span><span class="p">]</span>

<span class="n">melted</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Size"</span><span class="p">],</span>
		    <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Mergesort"</span><span class="p">,</span> <span class="s2">"Insertion Sort"</span><span class="p">],</span>
		    <span class="n">var_name</span><span class="o">=</span><span class="s2">"Sort Algorithm"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Size"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Sort Algorithm"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Size"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Comparisons"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="s2">"Sort Algorithm"</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Insertion vs Merge Sort"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"insertion-vs-merge"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/the-mergesort/insertion-vs-merge.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>

<div class="highlight"><pre><span></span><span class="n">frame</span><span class="p">[</span><span class="s2">"nlog2(n)"</span><span class="p">]</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[</span><span class="s2">"Size"</span><span class="p">]</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">frame</span><span class="p">[</span><span class="s2">"Size"</span><span class="p">])</span>
<span class="k">del</span><span class="p">(</span><span class="n">frame</span><span class="p">[</span><span class="s2">"Insertion Sort"</span><span class="p">])</span>
<span class="n">melted</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Size"</span><span class="p">],</span>
		    <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Mergesort"</span><span class="p">,</span> <span class="s2">"nlog2(n)"</span><span class="p">],</span>
		    <span class="n">var_name</span><span class="o">=</span><span class="s2">"Source"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Size"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Source"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Size"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Comparisons"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="s2">"Source"</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Merge Sort vs Theoretical"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"merge-by-logn"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/the-mergesort/merge-by-logn.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>
</div>
</div>


<div id="outline-container-orgccac11f" class="outline-2">
<h2 id="orgccac11f">Looking at the Mergesort</h2>
<div class="outline-text-2" id="text-orgccac11f">
<p>
The version of mergesort I implemented above is based on Levitin's algorithm, which I thought was clearer, since the copying was happening outside of the merge. This makes it harder to plot the progress of the sort, though, so I'm going to use the CLRS algorithm here to get some kind of visualization (hopefully).
</p>

<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bowling.sort.merge</span> <span class="kn">import</span> <span class="n">merge_clrs</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mergesort_tracer</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">,</span> <span class="n">left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
		     <span class="n">tracer</span><span class="p">:</span> <span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">"""Sorts the collection using a recursive mergesort</span>

<span class="sd">    This uses the CLRS merge-sort to build dict of the locations of the</span>
<span class="sd">    elements as the merging is done</span>

<span class="sd">    Args:</span>
<span class="sd">     collection: a mutable sequence</span>
<span class="sd">     left: the index of the beginning element of the sub-array</span>
<span class="sd">     right: the index of the ending element of the sub-array</span>
<span class="sd">     tracer: the dictionary to track the indices of the items</span>

<span class="sd">    Returns:</span>
<span class="sd">     tracer updated with post-merge locations of the items in tracer</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">tracer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
	<span class="n">tracer</span> <span class="o">=</span> <span class="p">{</span><span class="n">element</span><span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">collection</span><span class="p">)}</span>

    <span class="k">if</span> <span class="n">left</span> <span class="o">&lt;</span> <span class="n">right</span><span class="p">:</span>
	<span class="n">middle</span> <span class="o">=</span> <span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
	<span class="n">mergesort_tracer</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">middle</span><span class="p">,</span> <span class="n">tracer</span><span class="p">)</span>
	<span class="n">mergesort_tracer</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">middle</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">tracer</span><span class="p">)</span>
	<span class="n">merge_clrs</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">middle</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">collection</span><span class="p">):</span>
	    <span class="n">tracer</span><span class="p">[</span><span class="n">element</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tracer</span>
</pre></div>
</div>

<div id="outline-container-org6bf7254" class="outline-3">
<h3 id="org6bf7254">A Shuffle Input</h3>
<div class="outline-text-3" id="text-org6bf7254">
<div class="highlight"><pre><span></span><span class="n">elements</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">start</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">elements</span><span class="p">))</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">tracer</span> <span class="o">=</span> <span class="n">mergesort_tracer</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">start</span><span class="p">))</span>

<span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tracer</span><span class="p">)</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"Merge"</span><span class="p">})</span>
<span class="n">melted</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Merge"</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">"Element"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Location"</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Merge"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">tickMinStep</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Location"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">tickMinStep</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span>
    <span class="n">color</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">"Element"</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"Merge"</span><span class="p">,</span> <span class="s2">"Location"</span><span class="p">,</span> <span class="s2">"Element"</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Mergesort Tracing"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"mergesort-trace"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/the-mergesort/mergesort-trace.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>

<p>
You can kind of see what's going on, every time you see a bunch of crossed lines it's because the merge moved items aroundâ€¦ but maybe an artificial case will be clearer.
</p>
</div>
</div>

<div id="outline-container-org59562d0" class="outline-3">
<h3 id="org59562d0">A Reversed Input</h3>
<div class="outline-text-3" id="text-org59562d0">
<p>
Let's use an input that's sorted but backwards to see the swaps more clearly.
</p>

<div class="highlight"><pre><span></span><span class="n">elements</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">start</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">elements</span><span class="p">))</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">inputs</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
<span class="n">tracer</span> <span class="o">=</span> <span class="n">mergesort_tracer</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">start</span><span class="p">))</span>

<span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tracer</span><span class="p">)</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"Merge"</span><span class="p">})</span>
<span class="n">melted</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Merge"</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">"Element"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Location"</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Merge"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">tickMinStep</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Location"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">tickMinStep</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span>
    <span class="n">color</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">"Element"</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"Merge"</span><span class="p">,</span> <span class="s2">"Location"</span><span class="p">,</span> <span class="s2">"Element"</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Mergesort Tracing (From Backwards Source)"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"mergesort-trace-backwards"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/the-mergesort/mergesort-trace-backwards.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>
</div>
</div>
</div>



<div id="outline-container-org27dd9ad" class="outline-2">
<h2 id="org27dd9ad">End</h2>
<div class="outline-text-2" id="text-org27dd9ad">
<ul class="org-ul">
<li><a href="posts/clrs/">Introduction To Algorithms (CLRS)</a></li>
<li><a href="posts/itdaa/">Introduction to the Design &amp; Analysis of Algorithms (Levitin)</a></li>
</ul>
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("the-mergesort"));
});
</script><script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("the-mergesort-levitin"));
});
</script>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/divide-and-conquer/" class="u-url">Divide and Conquer</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/divide-and-conquer/" rel="bookmark">
            <time class="published dt-published" datetime="2022-01-25T17:12:58-08:00" itemprop="datePublished" title="2022-01-25 17:12">2022-01-25 17:12</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="outline-container-orga33ce0f" class="outline-2">
<h2 id="orga33ce0f">Description</h2>
<div class="outline-text-2" id="text-orga33ce0f">
<p>
The Divide-and-Conquer approach involves three parts.
</p>

<ul class="org-ul">
<li>
<b><b>Divide:</b></b> Break the problem up into sub-problems that are smaller instances of the same problem.</li>
<li>
<b><b>Conquer:</b></b> If the problem is small enough solve it, otherwise recursively solve the sub-problem.</li>
<li>
<b><b>Combine:</b></b> Combine the solutions to the sub-problems into a solution for the original problem.</li>
</ul>
</div>
</div>
<div id="outline-container-org3185d71" class="outline-2">
<h2 id="org3185d71">See</h2>
<div class="outline-text-2" id="text-org3185d71">
<ul class="org-ul">
<li><a href="posts/clrs/">Introduction To Algorithms (CLRS)</a></li>
</ul>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/the-merge/" class="u-url">The Merge</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/the-merge/" rel="bookmark">
            <time class="published dt-published" datetime="2022-01-23T17:32:22-08:00" itemprop="datePublished" title="2022-01-23 17:32">2022-01-23 17:32</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li>
<a href="posts/the-merge/#org0600793">The Merge</a>
<ul>
<li>
<a href="posts/the-merge/#org419453d">CLRS</a>
<ul>
<li><a href="posts/the-merge/#orgcd6e603">Implement It</a></li>
<li><a href="posts/the-merge/#orgdffd001">Runtime</a></li>
</ul>
</li>
<li>
<a href="posts/the-merge/#org8b98c20">Levitin</a>
<ul>
<li><a href="posts/the-merge/#orgf6e5d42">Implement It</a></li>
<li><a href="posts/the-merge/#org5602c26">Runtime</a></li>
</ul>
</li>
<li><a href="posts/the-merge/#orge0d0d71">A Hybrid</a></li>
</ul>
</li>
<li><a href="posts/the-merge/#org43db885">End</a></li>
</ul>
</div>
</div>
<div id="outline-container-org0600793" class="outline-2">
<h2 id="org0600793">The Merge</h2>
<div class="outline-text-2" id="text-org0600793">
<p>
This is an implementation of the merge portion of the merge-sort. It takes two sorted sections of a collection and merges them together in place.
</p>
</div>

<div id="outline-container-org419453d" class="outline-3">
<h3 id="org419453d">CLRS</h3>
<div class="outline-text-3" id="text-org419453d">
<p>
The precondition for this to work is that there are two sections within the array passed in to the algorithm that are already sorted and that they are located by the three index-values given to the algorithm. The first sorted section starts at <code>p</code> and ends at <code>q</code> in the array and the second sorted section starts at <code>q + 1</code> and ends at <code>r</code> within the array.
</p>

<p>
This is the CLRS version with the indexing changed to start at 0.
</p>

<pre id="the-merge" style="display:hidden;">
\begin{algorithm}
\caption{Merge}
\begin{algorithmic}
\INPUT An array and left, middle, and right locations in the array
\REQUIRE Sub-arrays from $p$ to $q$ and from $q + 1$ to $r$ are sorted
\OUTPUT The array with the two sections collated in order

\PROCEDURE{Merge}{$A, p, q, r$}

\STATE \textbf{The sizes of the sub-sections}
\STATE $n_1 \gets q - p + 1$
\STATE $n_2 \gets r - q$

\STATE \\ \textbf{Copy the subsections to new arrays.}
\STATE \textit{New arrays have one extra cell to hold a sentinel.}
\STATE $L \gets Array[0\ldots n_1]$
\STATE $R \gets Array[0 \ldots n_2]$

\FOR {$i \in {0 \ldots n_1 - 1}$}
  \STATE $L[i] \gets A[p + i - 1]$
\ENDFOR

\FOR{$j \in {0 \ldots n_2 - 1}$}
  \STATE $R[j] \gets A[q + j]$
\ENDFOR

\STATE \\ \textbf{Add sentinel to indicate end}
\STATE $L[n_1] \gets \infty $
\STATE $R[n_2] \gets \infty $

\STATE \\ \textbf{Collate}
\STATE $i \gets 0$
\STATE $j \gets 0$

\FOR {$k \in {p \ldots r}$}
 \IF {$L[i] \leq R[j]$}
   \STATE $A[k] \gets L[i]$
   \STATE $i' \gets i + 1$
 \ELSE
  \STATE $A[k] \gets R[j]$
  \STATE $j' \gets j + 1$
\ENDIF
\ENDFOR
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>

<p>
One way to think about how the algorithm is like you have two stacks of cards, each of which is sorted and you want to merge them together in sorted order. Since they are already sorted, you only have to compare the top cards on the two stacks to each other, chose the lower card and put it in your output stack, and keep repeating this until you've moved all the cards from the two stacks to the output. If one stack runs out of cards you just move the other remaining cards onto the output stack.
</p>

<p>
Our algorithm starts by copying out the values from the source array into two new arrays to create our stacks. We append an \(\infty\) onto the end of each to simulate the emptying of the stack. Then we keep looking at the top item in each stack and copying the smaller item back into the original array. Because of the copying we are going over the input twice, but that is a relatively small (linear) increase.
</p>
</div>

<div id="outline-container-orgcd6e603" class="outline-4">
<h4 id="orgcd6e603">Implement It</h4>
<div class="outline-text-4" id="text-orgcd6e603">
<div class="highlight"><pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">MutableSequence</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">contain_exactly</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">INFINITY</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">"inf"</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">merge_clrs</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">,</span>
	  <span class="n">left_start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
	  <span class="n">left_end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
	  <span class="n">right_end</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""Merge the sub-sections from the collection</span>

<span class="sd">    Args:</span>
<span class="sd">     collection: list or array with sorted sub-sections</span>
<span class="sd">     left_start: index of start of first sub-section</span>
<span class="sd">     left_end: index of last item of first sub-section</span>
<span class="sd">     right_end: index of the last item of second sub-section</span>
<span class="sd">    """</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">left_size</span> <span class="o">=</span> <span class="n">left_end</span> <span class="o">-</span> <span class="n">left_start</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">right_size</span> <span class="o">=</span> <span class="n">right_end</span> <span class="o">-</span> <span class="n">left_end</span>
    <span class="n">right_start</span> <span class="o">=</span> <span class="n">left_end</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">left_stack</span> <span class="o">=</span> <span class="p">([</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">left_size</span><span class="p">)</span>
    <span class="n">right_stack</span> <span class="o">=</span> <span class="p">([</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">right_size</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">stack_location</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">left_size</span><span class="p">):</span>
	<span class="n">left_stack</span><span class="p">[</span><span class="n">stack_location</span><span class="p">]</span> <span class="o">=</span> <span class="n">collection</span><span class="p">[</span><span class="n">left_start</span> <span class="o">+</span> <span class="n">stack_location</span><span class="p">]</span>
	<span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">stack_location</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">right_size</span><span class="p">):</span>
	<span class="n">right_stack</span><span class="p">[</span><span class="n">stack_location</span><span class="p">]</span> <span class="o">=</span> <span class="n">collection</span><span class="p">[</span><span class="n">right_start</span> <span class="o">+</span> <span class="n">stack_location</span><span class="p">]</span>
	<span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">left_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">INFINITY</span><span class="p">)</span>
    <span class="n">right_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">INFINITY</span><span class="p">)</span>

    <span class="n">next_left</span> <span class="o">=</span> <span class="n">next_right</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">put_next_item_here</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">left_start</span><span class="p">,</span> <span class="n">right_end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
	<span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="k">if</span> <span class="n">left_stack</span><span class="p">[</span><span class="n">next_left</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">right_stack</span><span class="p">[</span><span class="n">next_right</span><span class="p">]:</span>
	    <span class="n">collection</span><span class="p">[</span><span class="n">put_next_item_here</span><span class="p">]</span> <span class="o">=</span> <span class="n">left_stack</span><span class="p">[</span><span class="n">next_left</span><span class="p">]</span>
	    <span class="n">next_left</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="k">else</span><span class="p">:</span>
	    <span class="n">collection</span><span class="p">[</span><span class="n">put_next_item_here</span><span class="p">]</span> <span class="o">=</span> <span class="n">right_stack</span><span class="p">[</span><span class="n">next_right</span><span class="p">]</span>
	    <span class="n">next_right</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">count</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">merge_check</span><span class="p">(</span><span class="n">merger</span><span class="p">):</span>
    <span class="n">first</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">second</span> <span class="o">=</span> <span class="n">first</span><span class="p">[:]</span>
    <span class="n">collection</span> <span class="o">=</span> <span class="n">first</span> <span class="o">+</span> <span class="n">second</span>

    <span class="n">count</span> <span class="o">=</span> <span class="n">merger</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

    <span class="n">expect</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

    <span class="n">collection</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">+</span> <span class="n">first</span> <span class="o">+</span> <span class="n">second</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">merger</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">11</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

    <span class="n">collection</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">+</span> <span class="n">first</span> <span class="o">+</span> <span class="n">second</span> <span class="o">+</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">merger</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="n">expect</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">11</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="k">return</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">merge_check</span><span class="p">(</span><span class="n">merge_clrs</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgdffd001" class="outline-4">
<h4 id="orgdffd001">Runtime</h4>
<div class="outline-text-4" id="text-orgdffd001">
<p>
Without doing anything fancy we can see that there's three for loops, the first two cover copying over all the sub-list items from the original list to the new lists, so together they execute once for every item (<i>n</i> times). And the loop that does the actual merge also runs once for each item so it also runs <i>n</i> times so altogether it has a run time of <i>2n</i> which we'll say is \(\Theta(n)\). This is actually going to be part of the merge-sort but I thought I'd put that in here since the post is separate.
</p>
</div>
</div>
</div>

<div id="outline-container-org8b98c20" class="outline-3">
<h3 id="org8b98c20">Levitin</h3>
<div class="outline-text-3" id="text-org8b98c20">
<p>
This is the version given in <a href="posts/itdaa/">Introduction to the Design &amp; Analysis of Algorithms (Levitin)</a> which I find a little clearer than the CLRS version. I generally prefer Levitin's versions, but, you know, CLRS is the one you <b>have to</b> have, so it's there too.
</p>

<pre id="the-merge-levitin" style="display:hidden;">
\begin{algorithm}
\caption{Merge}
\begin{algorithmic}
\INPUT $B[0 \ldots p-1]$, $C[0 \ldots q - 1]$, $A[0 \ldots p + q - 1]$
\REQUIRE Sub-arrays $B$ and $C$ are sorted
\OUTPUT Sorted array $A$ with the elements of $B$ and $C$.

\PROCEDURE{Merge}{$B, C, A$}

\STATE $i \gets 0$
\STATE $j \gets 0$
\STATE $k \gets 0$

\WHILE {$i &lt; p$ and $j &lt; q$}
 \IF {$B[i] \le C[j]$}
  \STATE $A[k] \gets B[i]$
  \STATE $i \gets i + 1$
 \ELSE
  \STATE $A[k] \gets C[j]$
  \STATE $j \gets j + 1$
 \ENDIF
 \STATE $k \gets k + 1$
\ENDWHILE

\IF {$i=p$}
 \STATE Copy $C[j \ldots q-1]$ to $A[k \ldots p + q - 1]$
\ELSE
 \STATE Copy $B[i \ldots p - 1]$ to $A[k \ldots p + q - 1]$
\ENDIF
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>

<p>
There are a couple of noticeable differences between Levitin's version and the CLRS version. The first is that the lists to merge are passed into the function rather than being separated inside the function, which makes the "Divide" step separate from the "Combine" step. Additionally, instead of adding a sentinel to the end of the stacks the conditional checks to see if one of them is empty and copies over the stack that isn't empty outside of the merge-loop. This adds an additional conditional check to the main loop but then takes away the conditional check when copying over the leftovers. I might give the CLRS version a point for being more concise in handling the leftovers for the case where left and right are different sizes.
</p>
</div>
<div id="outline-container-orgf6e5d42" class="outline-4">
<h4 id="orgf6e5d42">Implement It</h4>
<div class="outline-text-4" id="text-orgf6e5d42">
<div class="highlight"><pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Sequence</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">merge_levitin</span><span class="p">(</span><span class="n">left_stack</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">right_stack</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">,</span>
		  <span class="n">target</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""Merges values from left and right stacks into target collection</span>

<span class="sd">    Args:</span>
<span class="sd">     left_stack: sorted collection of items to merge</span>
<span class="sd">     right_stack: sorted collection of items to merge</span>
<span class="sd">     target: collection into which to merge the items</span>

<span class="sd">    Returns:</span>
<span class="sd">     count of basic operations</span>
<span class="sd">    """</span>
    <span class="n">left_size</span><span class="p">,</span> <span class="n">right_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">left_stack</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">right_stack</span><span class="p">)</span>
    <span class="n">next_left</span> <span class="o">=</span> <span class="n">next_right</span> <span class="o">=</span> <span class="n">put_item_here</span> <span class="o">=</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="n">next_left</span> <span class="o">&lt;</span> <span class="n">left_size</span> <span class="ow">and</span> <span class="n">next_right</span> <span class="o">&lt;</span> <span class="n">right_size</span><span class="p">:</span>
	<span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="k">if</span> <span class="n">left_stack</span><span class="p">[</span><span class="n">next_left</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">right_stack</span><span class="p">[</span><span class="n">next_right</span><span class="p">]:</span>
	    <span class="n">target</span><span class="p">[</span><span class="n">put_item_here</span><span class="p">]</span> <span class="o">=</span> <span class="n">left_stack</span><span class="p">[</span><span class="n">next_left</span><span class="p">]</span>
	    <span class="n">next_left</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="k">else</span><span class="p">:</span>
	    <span class="n">target</span><span class="p">[</span><span class="n">put_item_here</span><span class="p">]</span> <span class="o">=</span> <span class="n">right_stack</span><span class="p">[</span><span class="n">next_right</span><span class="p">]</span>
	    <span class="n">next_right</span> <span class="o">+=</span> <span class="mi">1</span>

	<span class="n">put_item_here</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">next_left</span> <span class="o">==</span> <span class="n">left_size</span> <span class="ow">and</span> <span class="n">next_right</span> <span class="o">&lt;</span> <span class="n">right_size</span><span class="p">:</span>
	<span class="k">for</span> <span class="n">stack_offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">left_size</span> <span class="o">+</span> <span class="n">right_size</span> <span class="o">-</span> <span class="n">put_item_here</span><span class="p">):</span>
	    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
	    <span class="n">target</span><span class="p">[</span><span class="n">put_item_here</span> <span class="o">+</span> <span class="n">stack_offset</span><span class="p">]</span> <span class="o">=</span> <span class="n">right_stack</span><span class="p">[</span><span class="n">next_right</span> <span class="o">+</span> <span class="n">stack_offset</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">next_left</span> <span class="o">&lt;</span> <span class="n">left_size</span><span class="p">:</span>
	<span class="k">for</span> <span class="n">stack_offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">left_size</span> <span class="o">+</span> <span class="n">right_size</span> <span class="o">-</span> <span class="n">put_item_here</span><span class="p">):</span>
	    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
	    <span class="n">target</span><span class="p">[</span><span class="n">put_item_here</span> <span class="o">+</span> <span class="n">stack_offset</span><span class="p">]</span> <span class="o">=</span> <span class="n">left_stack</span><span class="p">[</span><span class="n">next_left</span> <span class="o">+</span> <span class="n">stack_offset</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">count</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">first</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">second</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="o">+</span> <span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">first</span><span class="p">)]</span>
<span class="n">collection</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">first</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">second</span><span class="p">))</span>

<span class="n">count</span> <span class="o">=</span> <span class="n">merge_levitin</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">collection</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="n">second</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">first</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="o">+</span> <span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">second</span><span class="p">)]</span>
<span class="n">collection</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">first</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">second</span><span class="p">))</span>

<span class="n">count</span> <span class="o">=</span> <span class="n">merge_levitin</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">collection</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org5602c26" class="outline-4">
<h4 id="org5602c26">Runtime</h4>
<div class="outline-text-4" id="text-org5602c26">
<p>
Since the dividing of the array is moved out of the merge the runtime for the merge is \(n\) so it's also \(\Theta(n)\).
</p>
</div>
</div>
</div>
<div id="outline-container-orge0d0d71" class="outline-3">
<h3 id="orge0d0d71">A Hybrid</h3>
<div class="outline-text-3" id="text-orge0d0d71">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">left_stack</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">right_stack</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">,</span>
	  <span class="n">target</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">"""Merges values from left and right stacks into target collection</span>

<span class="sd">    Args:</span>
<span class="sd">     left_stack: sorted collection of items to merge</span>
<span class="sd">     right_stack: sorted collection of items to merge</span>
<span class="sd">     target: collection into which to merge the items</span>

<span class="sd">    Returns:</span>
<span class="sd">     count of basic operations</span>
<span class="sd">    """</span>
    <span class="n">target_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">left_stack</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">right_stack</span><span class="p">)</span>

    <span class="c1"># since we aren't copying the lists this can be kind of dangerous</span>
    <span class="c1"># passing in the same list more than once will append INFINITY each time</span>
    <span class="n">left_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">INFINITY</span><span class="p">)</span>
    <span class="n">right_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">INFINITY</span><span class="p">)</span>
    <span class="n">next_left</span> <span class="o">=</span> <span class="n">next_right</span> <span class="o">=</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">put_item_here</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">target_size</span><span class="p">):</span>
	<span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="k">if</span> <span class="n">left_stack</span><span class="p">[</span><span class="n">next_left</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">right_stack</span><span class="p">[</span><span class="n">next_right</span><span class="p">]:</span>
	    <span class="n">target</span><span class="p">[</span><span class="n">put_item_here</span><span class="p">]</span> <span class="o">=</span> <span class="n">left_stack</span><span class="p">[</span><span class="n">next_left</span><span class="p">]</span>
	    <span class="n">next_left</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="k">else</span><span class="p">:</span>
	    <span class="n">target</span><span class="p">[</span><span class="n">put_item_here</span><span class="p">]</span> <span class="o">=</span> <span class="n">right_stack</span><span class="p">[</span><span class="n">next_right</span><span class="p">]</span>
	    <span class="n">next_right</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">count</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">first</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">second</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="o">+</span> <span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">first</span><span class="p">)]</span>
<span class="n">collection</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">first</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">second</span><span class="p">))</span>

<span class="n">count</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">collection</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="n">second</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">first</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="o">+</span> <span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">second</span><span class="p">)]</span>
<span class="n">collection</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">first</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">second</span><span class="p">))</span>

<span class="n">count</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">collection</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div id="outline-container-org43db885" class="outline-2">
<h2 id="org43db885">End</h2>
<div class="outline-text-2" id="text-org43db885">
<ul class="org-ul">
<li><a href="posts/clrs/">Introduction To Algorithms (CLRS)</a></li>
<li><a href="posts/itdaa/">Introduction to the Design &amp; Analysis of Algorithms (Levitin)</a></li>
</ul>
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("the-merge"));
});
</script><script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("the-merge-levitin"));
});
</script>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/binary-search/" class="u-url">Binary Search</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/binary-search/" rel="bookmark">
            <time class="published dt-published" datetime="2022-01-14T16:22:42-08:00" itemprop="datePublished" title="2022-01-14 16:22">2022-01-14 16:22</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li>
<a href="posts/binary-search/#org60d14f8">Beginning</a>
<ul>
<li><a href="posts/binary-search/#orge3abfa9">The Algorithm Parts</a></li>
</ul>
</li>
<li>
<a href="posts/binary-search/#org152e2f3">Implementation</a>
<ul>
<li><a href="posts/binary-search/#org43ee610">Imports</a></li>
<li><a href="posts/binary-search/#org6c18513">Set Up</a></li>
<li>
<a href="posts/binary-search/#org0c920eb">Binary Search One</a>
<ul>
<li><a href="posts/binary-search/#org6e62ff0">The Pseudocode</a></li>
<li><a href="posts/binary-search/#org7c8b89d">The Function</a></li>
</ul>
</li>
<li>
<a href="posts/binary-search/#orgdd267fd">Levitin's Version</a>
<ul>
<li><a href="posts/binary-search/#orgbd5cae2">The Pseudocode</a></li>
<li><a href="posts/binary-search/#orgc3bed1b">The Function</a></li>
</ul>
</li>
<li>
<a href="posts/binary-search/#org87589cd">Recursive Version</a>
<ul>
<li><a href="posts/binary-search/#orgc27dced">The Pseudocode</a></li>
<li><a href="posts/binary-search/#orgb3ab1ac">The Implementation</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="posts/binary-search/#orgc2f7cac">Some Plotting</a>
<ul>
<li><a href="posts/binary-search/#orgf283598">Left and Right</a></li>
<li><a href="posts/binary-search/#org9081191">Runtime</a></li>
</ul>
</li>
<li><a href="posts/binary-search/#orgf63d190">See Also</a></li>
</ul>
</div>
</div>
<div id="outline-container-org60d14f8" class="outline-2">
<h2 id="org60d14f8">Beginning</h2>
<div class="outline-text-2" id="text-org60d14f8">
</div>
<div id="outline-container-orge3abfa9" class="outline-3">
<h3 id="orge3abfa9">The Algorithm Parts</h3>
<div class="outline-text-3" id="text-orge3abfa9">
<ul class="org-ul">
<li>
<b><b>Precondition:</b></b> The input array (A) is sorted in non-decreasing order and the key \(k\) is in \(A\).</li>
<li>
<b><b>Postcondition:</b></b> The index of the matching element is output</li>
<li>
<b><b>Loop Invariant:</b></b> The key is in our current sublist: \(k \in A[left \ldots right]\).</li>
<li>
<b><b>Basic Step:</b></b> Find the midpoint of the sub-array, adjust the sub-array to use the midpoint such that the key is in the new sub-array.</li>
<li>
<b><b>Exit Condition:</b></b> \(left \le right\).</li>
<li>
<b><b>Make Progress:</b></b> After each loop the sublist is half the size of the previous sublist.</li>
<li>
<b><b>Maintain the Loop Invariant:</b></b> Pick the half of the sublist whose boundary value would allow the key.</li>
<li>
<b><b>Establish the Loop Invariant:</b></b> The initial sublist is the original list (\(left = 0, right=A.length -1\)).</li>
<li>
<b><b>Worst Case Runtime:</b></b> Since the input is repeatedly halved, the worst-case is \(\Theta(\log_{2} n)\).</li>
</ul>
<p>
Rather than saying "if k is in A" over and over, the search precondition requires that \(k\) is in \(A\) and if it isn't it's considered a failed search - which doesn't mean the algorithm is incorrect, just that the pre-condition wasn't met. We have to handle the other case, but for the purpose of defining the algorithm we'll set a stricter pre-condition.
</p>
</div>
</div>
</div>

<div id="outline-container-org152e2f3" class="outline-2">
<h2 id="org152e2f3">Implementation</h2>
<div class="outline-text-2" id="text-org152e2f3">
</div>
<div id="outline-container-org43ee610" class="outline-3">
<h3 id="org43ee610">Imports</h3>
<div class="outline-text-3" id="text-org43ee610">
<div class="highlight"><pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Sequence</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">be_false</span><span class="p">,</span> <span class="n">be_none</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span><span class="p">,</span> <span class="n">raise_error</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>

<span class="kn">import</span> <span class="nn">altair</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">Timer</span>
<span class="kn">from</span> <span class="nn">graeae.visualization.altair_helpers</span> <span class="kn">import</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">save_chart</span>
</pre></div>
</div>
</div>
<div id="outline-container-org6c18513" class="outline-3">
<h3 id="org6c18513">Set Up</h3>
<div class="outline-text-3" id="text-org6c18513">
<div class="highlight"><pre><span></span><span class="n">TIMER</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="n">output_path</span><span class="p">(</span><span class="s2">"binary-search"</span><span class="p">)</span>
<span class="n">save_it</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">save_chart</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">)</span>

<span class="n">SearchOutput</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">"SearchOutput"</span><span class="p">,</span> <span class="p">[</span><span class="s2">"index"</span><span class="p">,</span> <span class="s2">"count"</span><span class="p">])</span>
</pre></div>
</div>
</div>

<div id="outline-container-org0c920eb" class="outline-3">
<h3 id="org0c920eb">Binary Search One</h3>
<div class="outline-text-3" id="text-org0c920eb">
</div>
<div id="outline-container-org6e62ff0" class="outline-4">
<h4 id="org6e62ff0">The Pseudocode</h4>
<div class="outline-text-4" id="text-org6e62ff0">
<pre id="binarysearch" style="display:hidden;">
\begin{algorithm}
\caption{BinarySearch}
\begin{algorithmic}
\INPUT Array A of items in non-decreasing order, search key
\OUTPUT If key is in array, the index of the item that matches
\PROCEDURE{BinarySearch}{A, key}
\STATE left $\gets$ 0
\STATE right $\gets$ A.length - 1

\WHILE {right &gt; left}
\STATE middle $\gets \left \lfloor \frac{\textrm{left} + \textrm{right}}{2} \right \rfloor$

\IF {key $\le$ A[middle]}
\STATE right $\gets$ middle
\ELSE
\STATE left $\gets$ middle + 1
\ENDIF
\ENDWHILE

\IF {key = A[left]}
\RETURN left
\ELSE
\RETURN NotFound
\ENDIF
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>
</div>
</div>

<div id="outline-container-org7c8b89d" class="outline-4">
<h4 id="org7c8b89d">The Function</h4>
<div class="outline-text-4" id="text-org7c8b89d">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">binary_search</span><span class="p">(</span><span class="n">element</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">elements</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SearchOutput</span><span class="p">:</span>
    <span class="sd">"""Does an iterative binary search for the key</span>

<span class="sd">    Args:</span>
<span class="sd">     element: item in the source to search for</span>
<span class="sd">     elements: sorted (non-decreasing) collection with the key</span>

<span class="sd">    Returns:</span>
<span class="sd">     SearchOutput(index of the key in the source or None if not found, count of comparisons)</span>
<span class="sd">    """</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span><span class="n">elements</span><span class="p">[</span><span class="n">left</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">element</span> <span class="o">&lt;=</span> <span class="n">elements</span><span class="p">[</span><span class="n">right</span><span class="p">]):</span>
	<span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">while</span> <span class="n">right</span> <span class="o">&gt;</span> <span class="n">left</span><span class="p">:</span>
	<span class="k">assert</span> <span class="n">elements</span><span class="p">[</span><span class="n">left</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">element</span> <span class="o">&lt;=</span> <span class="n">elements</span><span class="p">[</span><span class="n">right</span><span class="p">]</span>
	<span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="n">middle</span> <span class="o">=</span> <span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>

	<span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="p">((</span><span class="n">left</span><span class="p">,</span> <span class="n">middle</span><span class="p">)</span> <span class="k">if</span> <span class="n">element</span> <span class="o">&lt;=</span> <span class="n">elements</span><span class="p">[</span><span class="n">middle</span><span class="p">]</span>
		       <span class="k">else</span> <span class="p">(</span><span class="n">middle</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">right</span><span class="p">))</span>

    <span class="n">location</span> <span class="o">=</span> <span class="n">left</span> <span class="k">if</span> <span class="p">(</span><span class="n">elements</span><span class="p">[</span><span class="n">left</span><span class="p">]</span> <span class="o">==</span> <span class="n">element</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_it</span><span class="p">(</span><span class="n">searcher</span><span class="p">):</span>
    <span class="n">test_case</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">11</span><span class="p">))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">searcher</span><span class="p">(</span><span class="n">element</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">elements</span><span class="o">=</span><span class="n">test_case</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>

    <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="mi">50</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">expected</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
	<span class="n">expect</span><span class="p">(</span><span class="n">searcher</span><span class="p">(</span><span class="n">element</span><span class="o">=</span><span class="n">item</span><span class="p">,</span> <span class="n">elements</span><span class="o">=</span><span class="n">items</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">expected</span><span class="p">))</span>

    <span class="n">expect</span><span class="p">(</span><span class="n">searcher</span><span class="p">(</span><span class="n">element</span><span class="o">=-</span><span class="mi">5</span><span class="p">,</span> <span class="n">elements</span><span class="o">=</span><span class="n">items</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_none</span><span class="p">)</span>

    <span class="n">last</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">items</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">last</span> <span class="o">+</span> <span class="mi">100</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">searcher</span><span class="p">(</span><span class="mi">101</span><span class="p">,</span> <span class="n">items</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_none</span><span class="p">)</span>

    <span class="n">expect</span><span class="p">(</span><span class="n">searcher</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="p">[])[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_none</span><span class="p">)</span>

    <span class="n">expect</span><span class="p">(</span><span class="n">searcher</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="k">return</span>

<span class="n">test_it</span><span class="p">(</span><span class="n">binary_search</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


<div id="outline-container-orgdd267fd" class="outline-3">
<h3 id="orgdd267fd">Levitin's Version</h3>
<div class="outline-text-3" id="text-orgdd267fd">
<p>
The version I entered above is one that I found on the web (<a href="https://www.eecs.yorku.ca/course_archive/2013-14/W/2011/lectures/09%20Loop%20Invariants%20and%20Binary%20Search.pdf">PDF Lecture Notes</a>), and is roughly what CLRS has. The one in <a href="posts/itdaa/">Levitin's Book</a> is clearer to me but has one more comparison.
</p>
</div>
<div id="outline-container-orgbd5cae2" class="outline-4">
<h4 id="orgbd5cae2">The Pseudocode</h4>
<div class="outline-text-4" id="text-orgbd5cae2">
<pre id="binarysearch2" style="display:hidden;">
\begin{algorithm}
\caption{BinarySearchTwo}
\begin{algorithmic}
\INPUT Array A of items in non-decreasing order, search key in A
\OUTPUT The index of the item that matches key
\PROCEDURE{BinarySearchTwo}{A, key}
\STATE left $\gets$ 0
\STATE right $\gets$ A.length - 1

\WHILE {left $\le$ right}
\STATE middle $\gets \left \lfloor \frac{\textrm{left} + \textrm{right}}{2} \right \rfloor$

\IF {key = A[middle]}
  \RETURN middle
\ELIF {key &lt; A[middle]}
\STATE right $\gets$ middle - 1
\ELSE
\STATE left $\gets$ middle + 1
\ENDIF
\ENDWHILE

\IF {key = A[left]}
\RETURN left
\ELSE
\RETURN NotFound
\ENDIF
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>
</div>
</div>

<div id="outline-container-orgc3bed1b" class="outline-4">
<h4 id="orgc3bed1b">The Function</h4>
<div class="outline-text-4" id="text-orgc3bed1b">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">binary_search_two</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SearchOutput</span><span class="p">:</span>
    <span class="sd">"""Iterative Binary Search</span>

<span class="sd">    Args:</span>
<span class="sd">     element: item in the source</span>
<span class="sd">     elements: sorted collection to search</span>

<span class="sd">    Returns:</span>
<span class="sd">     index where key is found in the source or False if not found</span>

<span class="sd">    Raises:</span>
<span class="sd">     AssertionError: key is out of bounds for the source</span>
<span class="sd">    """</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">location</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">while</span> <span class="n">left</span> <span class="o">&lt;=</span> <span class="n">right</span> <span class="ow">and</span> <span class="n">location</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
	<span class="n">middle</span> <span class="o">=</span> <span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>

	<span class="k">if</span> <span class="n">element</span> <span class="o">==</span> <span class="n">elements</span><span class="p">[</span><span class="n">middle</span><span class="p">]:</span>
	    <span class="n">location</span> <span class="o">=</span> <span class="n">middle</span>

	<span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="p">((</span><span class="n">left</span><span class="p">,</span> <span class="n">middle</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">element</span> <span class="o">&lt;=</span> <span class="n">elements</span><span class="p">[</span><span class="n">middle</span><span class="p">]</span> <span class="k">else</span>
		       <span class="p">(</span><span class="n">middle</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">right</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">test_it</span><span class="p">(</span><span class="n">binary_search_two</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-org87589cd" class="outline-3">
<h3 id="org87589cd">Recursive Version</h3>
<div class="outline-text-3" id="text-org87589cd">
<p>
Although it is pretty straightforward as an iterative function, divide and conquer lends itself to recursion so, just for completeness, here's a recursive version of the binary search.
</p>
</div>

<div id="outline-container-orgc27dced" class="outline-4">
<h4 id="orgc27dced">The Pseudocode</h4>
<div class="outline-text-4" id="text-orgc27dced">
<pre id="binarysearch3" style="display:hidden;">
\begin{algorithm}
\caption{Recursive Binary Search}
\begin{algorithmic}
\REQUIRE Input Array is in non-decreasing order
\INPUT Array A , search key, left and right indices to limit the search
\OUTPUT The index of the item that matches the key
\PROCEDURE{BinarySearchRecursive}{A, key, left, right}

\IF {left &gt; right}
  \RETURN NotFound
\ENDIF

\STATE middle $\gets \left \lfloor \frac{\textrm{left} + \textrm{right}}{2} \right \rfloor$

\IF {key = A[middle]}
 \RETURN middle
\ELIF {key &lt; A[middle]}
 \STATE right $\gets$ middle - 1
\ELSE
 \STATE left $\gets$ middle + 1
\ENDIF

\RETURN \textsc{BinarySearchRecursive}(elements, key, left, right)

\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>
</div>
</div>

<div id="outline-container-orgb3ab1ac" class="outline-4">
<h4 id="orgb3ab1ac">The Implementation</h4>
<div class="outline-text-4" id="text-orgb3ab1ac">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">recursive_binary_search</span><span class="p">(</span><span class="n">elements</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
			    <span class="n">left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
			    <span class="n">count</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">"""Recursive binary search</span>

<span class="sd">    Args:</span>
<span class="sd">     elements: sorted sequence with element in it</span>
<span class="sd">     key: item in elements to search for</span>
<span class="sd">     left: left index of the current sub-list to search</span>
<span class="sd">     right: right index of the current sub-list to search</span>
<span class="sd">     count: number of times we run the comparison (for plotting)</span>

<span class="sd">    Returns:</span>
<span class="sd">     (index, count) - index of the element in the elements and the comparison count</span>
<span class="sd">    """</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">left</span> <span class="o">&gt;</span> <span class="n">right</span><span class="p">:</span>
	<span class="c1"># we missed it, the element isn't in the elements</span>
	<span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">count</span>

    <span class="n">middle</span> <span class="o">=</span> <span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>

    <span class="k">if</span> <span class="n">elements</span><span class="p">[</span><span class="n">middle</span><span class="p">]</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
	<span class="c1"># we found it</span>
	<span class="k">return</span> <span class="n">middle</span><span class="p">,</span> <span class="n">count</span>

    <span class="c1"># move one of the boundaries to the middle</span>
    <span class="k">if</span> <span class="n">key</span> <span class="o">&lt;</span> <span class="n">elements</span><span class="p">[</span><span class="n">middle</span><span class="p">]:</span>
	<span class="n">right</span> <span class="o">=</span> <span class="n">middle</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
	<span class="n">left</span> <span class="o">=</span> <span class="n">middle</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">recursive_binary_search</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</pre></div>

<p>
This is a helper to get the recursive call started and to handle empty lists or search terms that are outside of the range of the list.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="n">element</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">elements</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
    <span class="sd">"""calls the recursive binary search</span>

<span class="sd">    Args:</span>
<span class="sd">     element: an element in source to search for</span>
<span class="sd">     elements: sorted sequence of items     </span>
<span class="sd">    """</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="ow">or</span>  <span class="ow">not</span> <span class="n">elements</span><span class="p">[</span><span class="n">left</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">element</span> <span class="o">&lt;=</span> <span class="n">elements</span><span class="p">[</span><span class="n">right</span><span class="p">]:</span>
	<span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">recursive_binary_search</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">test_it</span><span class="p">(</span><span class="n">search</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc2f7cac" class="outline-2">
<h2 id="orgc2f7cac">Some Plotting</h2>
<div class="outline-text-2" id="text-orgc2f7cac">
</div>
<div id="outline-container-orgf283598" class="outline-3">
<h3 id="orgf283598">Left and Right</h3>
<div class="outline-text-3" id="text-orgf283598">
<p>
Let's look at how the search updates the left and right boundaries. First we'll need a function that records the locations.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">binary_search_points</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
    <span class="sd">"""Iterative Binary Search</span>

<span class="sd">    Args:</span>
<span class="sd">     key: item in the source</span>
<span class="sd">     source: sorted collection to search</span>

<span class="sd">    Returns:</span>
<span class="sd">     tuple of left-right locations</span>

<span class="sd">    Raises:</span>
<span class="sd">     AssertionError: key is out of bounds for the source</span>
<span class="sd">    """</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">lefts</span> <span class="o">=</span> <span class="p">[</span><span class="n">left</span><span class="p">]</span>
    <span class="n">rights</span> <span class="o">=</span> <span class="p">[</span><span class="n">right</span><span class="p">]</span>

    <span class="k">while</span> <span class="n">right</span> <span class="o">&gt;</span> <span class="n">left</span><span class="p">:</span>
	<span class="k">assert</span> <span class="n">source</span><span class="p">[</span><span class="n">left</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">key</span> <span class="o">&lt;=</span> <span class="n">source</span><span class="p">[</span><span class="n">right</span><span class="p">]</span>
	<span class="n">middle</span> <span class="o">=</span> <span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>

	<span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span> <span class="o">=</span> <span class="p">((</span><span class="n">left</span><span class="p">,</span> <span class="n">middle</span><span class="p">)</span> <span class="k">if</span> <span class="n">key</span> <span class="o">&lt;=</span> <span class="n">source</span><span class="p">[</span><span class="n">middle</span><span class="p">]</span>
			 <span class="k">else</span> <span class="p">(</span><span class="n">middle</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">right</span><span class="p">))</span>
	<span class="n">lefts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">left</span><span class="p">)</span>
	<span class="n">rights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lefts</span><span class="p">,</span> <span class="n">rights</span>
</pre></div>

<p>
Now we'll plot it.
</p>

<div class="highlight"><pre><span></span><span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">101</span><span class="p">))</span>
<span class="n">key</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="mi">24</span><span class="p">]</span>
<span class="n">lefts</span><span class="p">,</span> <span class="n">rights</span> <span class="o">=</span> <span class="n">binary_search_points</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">items</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">Left</span><span class="o">=</span><span class="n">lefts</span><span class="p">,</span> <span class="n">Right</span><span class="o">=</span><span class="n">rights</span><span class="p">,</span> <span class="n">Split</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lefts</span><span class="p">)))))</span>

<span class="n">melted</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Split"</span><span class="p">],</span> <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Left"</span><span class="p">,</span> <span class="s2">"Right"</span><span class="p">],</span>
		   <span class="n">var_name</span><span class="o">=</span><span class="s2">"left_or_right"</span><span class="p">,</span>
		   <span class="n">value_name</span><span class="o">=</span><span class="s2">"Index"</span><span class="p">)</span>
<span class="n">base</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span>

<span class="n">lines</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Split:O"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Index"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"left_or_right"</span>
<span class="p">)</span>

<span class="n">points</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Split:O"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Index"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"left_or_right"</span>
<span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="p">(</span><span class="n">lines</span> <span class="o">+</span> <span class="n">points</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Binary Search Left-Right Boundaries"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">550</span>
<span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="o">=</span><span class="n">chart</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"binary-search"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/binary-search/binary-search.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>

<p>
So, it isn't really so pretty as with the sorting plots. As the plot confirms, the left and right slowly narrow to find the item in the list.
</p>
</div>
</div>

<div id="outline-container-org9081191" class="outline-3">
<h3 id="org9081191">Runtime</h3>
<div class="outline-text-3" id="text-org9081191">
<p>
Let's see how the number of loops goes up with the size of the search space.
</p>

<div class="highlight"><pre><span></span><span class="n">EXPONENT</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">numba_search</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="n">binary_search</span><span class="p">)</span>

<span class="n">sizes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="n">EXPONENT</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
<span class="n">random_source</span> <span class="o">=</span> <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">count</span><span class="p">))</span>
		    <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">sizes</span><span class="p">]</span>
<span class="n">random_things</span> <span class="o">=</span> <span class="p">[(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">elements</span><span class="p">),</span> <span class="n">elements</span><span class="p">)</span>
		    <span class="k">for</span> <span class="n">elements</span> <span class="ow">in</span> <span class="n">random_source</span><span class="p">]</span>

<span class="n">worst_things</span> <span class="o">=</span> <span class="p">[(</span><span class="n">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">elements</span><span class="p">)</span> <span class="k">for</span> <span class="n">elements</span> <span class="ow">in</span> <span class="n">random_source</span><span class="p">]</span>

<span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">random_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
	<span class="n">delayed</span><span class="p">(</span><span class="n">numba_search</span><span class="p">)(</span><span class="n">element</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span> <span class="ow">in</span> <span class="n">random_things</span><span class="p">)</span>

    <span class="n">worst_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
	<span class="n">delayed</span><span class="p">(</span><span class="n">numba_search</span><span class="p">)(</span><span class="n">element</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span> <span class="ow">in</span> <span class="n">worst_things</span><span class="p">)</span>
</pre></div>

<pre class="example">
Started: 2022-01-16 21:33:07.668315
Ended: 2022-01-16 21:33:08.905390
Elapsed: 0:00:01.237075
</pre>


<div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">Count</span><span class="o">=</span><span class="n">sizes</span><span class="p">,</span>
    <span class="n">Random</span><span class="o">=</span><span class="p">[</span><span class="n">output</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">random_output</span><span class="p">],</span>
    <span class="n">First</span><span class="o">=</span><span class="p">[</span><span class="n">output</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">worst_output</span><span class="p">]</span>
<span class="p">))</span>

<span class="n">melted</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Count"</span><span class="p">],</span> <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Random"</span><span class="p">,</span> <span class="s2">"First"</span><span class="p">],</span>
		   <span class="n">var_name</span><span class="o">=</span><span class="s2">"Location"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Bisections"</span><span class="p">)</span>

<span class="n">theoretical</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">Count</span><span class="o">=</span><span class="n">sizes</span><span class="p">,</span> <span class="n">Theoretical</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">sizes</span><span class="p">)))</span>
</pre></div>

<p>
Now, to plot.
</p>

<div class="highlight"><pre><span></span><span class="n">points</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Count"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Bisections"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Location"</span><span class="p">)</span>

<span class="n">line</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">theoretical</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Count"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Theoretical"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Count"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Theoretical"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">".2f"</span><span class="p">)],</span>
<span class="p">)</span>
<span class="n">chart</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="n">points</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Binary Search Bisections"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">save_chart</span><span class="p">(</span><span class="n">chart</span><span class="o">=</span><span class="n">chart</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"binary-search-comparisons"</span><span class="p">,</span>
	   <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/binary-search/binary-search-comparisons.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>
</div>
</div>
</div>

<div id="outline-container-orgf63d190" class="outline-2">
<h2 id="orgf63d190">See Also</h2>
<div class="outline-text-2" id="text-orgf63d190">
<ul class="org-ul">
<li>Loop Invariants [Internet]. [cited 2022 Jan 15]. Available from: <a href="https://www.cs.cornell.edu/courses/cs2112/2018fa/lectures/lec_loopinv/">https://www.cs.cornell.edu/courses/cs2112/2018fa/lectures/lec_loopinv/</a>
</li>
<li><a href="posts/itdaa/">Introduction to the Design &amp; Analysis of Algorithms (Levitin)</a></li>
</ul>
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("binarysearch"));
});
</script><script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("binarysearch2"));
});
</script><script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("binarysearch3"));
});
</script>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/decrease-and-conquer/" class="u-url">Decrease And Conquer</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/decrease-and-conquer/" rel="bookmark">
            <time class="published dt-published" datetime="2022-01-11T11:51:54-08:00" itemprop="datePublished" title="2022-01-11 11:51">2022-01-11 11:51</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>
With <i>Decrease-and-Conquer</i> algorithms you exploit the relationship between the solution to a problem and the solution to a sub-problem. There are three types of Decrease-and-Conquer algorithms:
</p>

<ul class="org-ul">
<li>Decrease by a constant (typically one)</li>
<li>Decrease by a constant factor (typically two)</li>
<li>Decrease by a variable amount</li>
</ul>
<div id="outline-container-org714bf48" class="outline-2">
<h2 id="org714bf48">See Also</h2>
<div class="outline-text-2" id="text-org714bf48">
<ul class="org-ul">
<li><a href="posts/itdaa/">Introduction to the Design &amp; Analysis of Algorithms (Levitin)</a></li>
</ul>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/a-first-look-at-dplyr/" class="u-url">A First Look at dplyr</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/a-first-look-at-dplyr/" rel="bookmark">
            <time class="published dt-published" datetime="2021-12-16T16:59:04-08:00" itemprop="datePublished" title="2021-12-16 16:59">2021-12-16 16:59</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li>
<a href="posts/a-first-look-at-dplyr/#org1412e88">In the Beginning</a>
<ul>
<li><a href="posts/a-first-look-at-dplyr/#org32af5ae">Imports</a></li>
</ul>
</li>
<li><a href="posts/a-first-look-at-dplyr/#org5e02650">The Data</a></li>
<li>
<a href="posts/a-first-look-at-dplyr/#org94b55ed">Filter</a>
<ul>
<li><a href="posts/a-first-look-at-dplyr/#org0f58585">The Basic Filter</a></li>
<li><a href="posts/a-first-look-at-dplyr/#orgcbeea69">Or, Not And</a></li>
<li><a href="posts/a-first-look-at-dplyr/#org61ba9d0">And and Or</a></li>
</ul>
</li>
<li>
<a href="posts/a-first-look-at-dplyr/#orgcb686c1">Arrange</a>
<ul>
<li><a href="posts/a-first-look-at-dplyr/#org78b4c4c">Ascending Order</a></li>
<li><a href="posts/a-first-look-at-dplyr/#org3b66f2f">Descending Order</a></li>
</ul>
</li>
<li>
<a href="posts/a-first-look-at-dplyr/#orgdd33126">Select</a>
<ul>
<li><a href="posts/a-first-look-at-dplyr/#org607a997">Grab Some Columns</a></li>
<li><a href="posts/a-first-look-at-dplyr/#org0998a54">A Range of Columns</a></li>
<li><a href="posts/a-first-look-at-dplyr/#org6d43ff8">Helper Functions</a></li>
</ul>
</li>
<li>
<a href="posts/a-first-look-at-dplyr/#org92c215d">Renaming</a>
<ul>
<li>
<ul>
<li><a href="posts/a-first-look-at-dplyr/#org6fbf8eb">Some More Useful Renaming</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="posts/a-first-look-at-dplyr/#org1010fdf">Mutate</a>
<ul>
<li><a href="posts/a-first-look-at-dplyr/#orga4c0d02">Transmute</a></li>
</ul>
</li>
<li>
<a href="posts/a-first-look-at-dplyr/#orgbcb60f8">Summarize</a>
<ul>
<li><a href="posts/a-first-look-at-dplyr/#org5e38b4c">Grouping</a></li>
<li><a href="posts/a-first-look-at-dplyr/#orgbf97e0d">Hitting the Pipe</a></li>
</ul>
</li>
<li><a href="posts/a-first-look-at-dplyr/#org132ca5f">Link Collection</a></li>
</ul>
</div>
</div>
<div id="outline-container-org1412e88" class="outline-2">
<h2 id="org1412e88">In the Beginning</h2>
<div class="outline-text-2" id="text-org1412e88">
<p>
This is a look at <a href="https://dplyr.tidyverse.org/">dplyr</a> based on Chapter Three of <a href="posts/r-for-data-science/">R For Data Science</a>. It focuses on what the book identifies as the six key <code>dplyr</code> functions.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Function</th>
<th scope="col" class="org-left">What It Does</th>
<th scope="col" class="org-left">By Another Name</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left"><code>filter</code></td>
<td class="org-left">Pick out rows based on their values.</td>
<td class="org-left">Boolean Slice</td>
</tr>
<tr>
<td class="org-left"><code>arrange</code></td>
<td class="org-left">Re-order the rows.</td>
<td class="org-left">Sort</td>
</tr>
<tr>
<td class="org-left"><code>select</code></td>
<td class="org-left">Pick out variables by their names.</td>
<td class="org-left">Column subset</td>
</tr>
<tr>
<td class="org-left"><code>mutate</code></td>
<td class="org-left">Create new variables using existing ones.</td>
<td class="org-left">Feature Engineering</td>
</tr>
<tr>
<td class="org-left"><code>summarize</code></td>
<td class="org-left">Summarize many values as a single value.</td>
<td class="org-left">Statistic</td>
</tr>
<tr>
<td class="org-left"><code>group_by</code></td>
<td class="org-left">Changes scope of other functions to operate on group.</td>
<td class="org-left">Â </td>
</tr>
</tbody>
</table>
</div>

<div id="outline-container-org32af5ae" class="outline-3">
<h3 id="org32af5ae">Imports</h3>
<div class="outline-text-3" id="text-org32af5ae">
<div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">ascii</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">assertthat</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">knitr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">nycflights13</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
</pre></div>

<p>
<b><b>Note:</b></b> The stuff in the tidyverse tends to clobber built-in functions, which can make it hard to understand sometimes when things go wrong. If you forget to load <code>dplyer</code>, for instance, there's already a <code>filter</code> function, but it doesn't do the same thing as the one you load with <code>dplyr</code> so you'll get weird error messages if you try to use it. Notably I was getting this message:
</p>

<div class="highlight"><pre><span></span><span class="n">Error</span> <span class="n">in</span> <span class="nf">filter</span><span class="p">(</span><span class="n">airlines</span><span class="p">,</span> <span class="n">carrier</span> <span class="o">==</span> <span class="s">"US"</span><span class="p">)</span> <span class="o">:</span> <span class="n">object</span> <span class="s">'carrier'</span> <span class="n">not</span> <span class="n">found</span>
</pre></div>

<p>
Anyway, now some options for the packages.
</p>

<div class="highlight"><pre><span></span><span class="nf">options</span><span class="p">(</span><span class="n">asciiType</span><span class="o">=</span><span class="s">"org"</span><span class="p">)</span>
<span class="nf">theme_set</span><span class="p">(</span><span class="nf">theme_minimal</span><span class="p">(</span><span class="n">base_family</span><span class="o">=</span><span class="s">"Palatino"</span><span class="p">))</span>
</pre></div>

<p>
And a couple of helpers to print (the <code>tibble</code> objects dump weird characters into the org-mode output).
</p>

<div class="highlight"><pre><span></span><span class="n">khead</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">#' Prints a table of the first lines of the dataframe</span>
  <span class="c1">#'</span>
  <span class="c1">#' @param data The data to print</span>
  <span class="n">table</span> <span class="o">&lt;-</span> <span class="nf">kable</span><span class="p">(</span><span class="nf">head</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
  <span class="n">table</span><span class="p">[</span><span class="m">2</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="nf">gsub</span><span class="p">(</span><span class="s">":"</span><span class="p">,</span> <span class="s">"-"</span><span class="p">,</span> <span class="n">table</span><span class="p">[</span><span class="m">2</span><span class="p">])</span>
  <span class="n">table</span>
<span class="p">}</span>

<span class="n">okable</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">#' Prints data as an org-mode table</span>
  <span class="c1">#'</span>
  <span class="c1">#' @param data The data to print</span>
  <span class="n">table</span> <span class="o">&lt;-</span> <span class="nf">kable</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
  <span class="n">table</span><span class="p">[</span><span class="m">2</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="nf">gsub</span><span class="p">(</span><span class="s">":"</span><span class="p">,</span> <span class="s">"-"</span><span class="p">,</span> <span class="n">table</span><span class="p">[</span><span class="m">2</span><span class="p">])</span>
  <span class="n">table</span>
<span class="p">}</span>

<span class="n">got_all_your_data</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">#' Checks if there's any missing values</span>
  <span class="c1">#'</span>
  <span class="c1">#' @param data The vector of data to check</span>
  <span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-org5e02650" class="outline-2">
<h2 id="org5e02650">The Data</h2>
<div class="outline-text-2" id="text-org5e02650">
<p>
We're going to look at the <code>flights</code> dataframe loaded by the <a href="https://www.rdocumentation.org/packages/nycflights13/versions/1.0.1"><code>nycflights13</code></a> package (which, curiously, R loads using the <code>library</code> function).
</p>

<div class="highlight"><pre><span></span><span class="nf">str</span><span class="p">(</span><span class="n">flights</span><span class="p">)</span>
</pre></div>

<pre class="example">
tibble [336,776 Ã— 19] (S3: tbl_df/tbl/data.frame)
 $ year          : int [1:336776] 2013 2013 2013 2013 2013 2013 2013 2013 2013 2013 ...
 $ month         : int [1:336776] 1 1 1 1 1 1 1 1 1 1 ...
 $ day           : int [1:336776] 1 1 1 1 1 1 1 1 1 1 ...
 $ dep_time      : int [1:336776] 517 533 542 544 554 554 555 557 557 558 ...
 $ sched_dep_time: int [1:336776] 515 529 540 545 600 558 600 600 600 600 ...
 $ dep_delay     : num [1:336776] 2 4 2 -1 -6 -4 -5 -3 -3 -2 ...
 $ arr_time      : int [1:336776] 830 850 923 1004 812 740 913 709 838 753 ...
 $ sched_arr_time: int [1:336776] 819 830 850 1022 837 728 854 723 846 745 ...
 $ arr_delay     : num [1:336776] 11 20 33 -18 -25 12 19 -14 -8 8 ...
 $ carrier       : chr [1:336776] "UA" "UA" "AA" "B6" ...
 $ flight        : int [1:336776] 1545 1714 1141 725 461 1696 507 5708 79 301 ...
 $ tailnum       : chr [1:336776] "N14228" "N24211" "N619AA" "N804JB" ...
 $ origin        : chr [1:336776] "EWR" "LGA" "JFK" "JFK" ...
 $ dest          : chr [1:336776] "IAH" "IAH" "MIA" "BQN" ...
 $ air_time      : num [1:336776] 227 227 160 183 116 150 158 53 140 138 ...
 $ distance      : num [1:336776] 1400 1416 1089 1576 762 ...
 $ hour          : num [1:336776] 5 5 5 5 6 5 6 6 6 6 ...
 $ minute        : num [1:336776] 15 29 40 45 0 58 0 0 0 0 ...
 $ time_hour     : POSIXct[1:336776], format: "2013-01-01 05:00:00" "2013-01-01 05:00:00" ...
</pre>

<p>
The dataset lists all the flights that left New York City airports in 2013 heading to destinations in the United States, Puerto Rico, and the American Virgin Islands.
</p>
</div>
</div>

<div id="outline-container-org94b55ed" class="outline-2">
<h2 id="org94b55ed">Filter</h2>
<div class="outline-text-2" id="text-org94b55ed">
</div>
<div id="outline-container-org0f58585" class="outline-3">
<h3 id="org0f58585">The Basic Filter</h3>
<div class="outline-text-3" id="text-org0f58585">
<p>
<code>filter</code> takes the dataframe as the first argument and every argument after that has to be a boolean expression based on the dataframe. If you pass in more than one condition <code>dplyr</code> will and them. Let's see the flights on Christmas.
</p>

<div class="highlight"><pre><span></span><span class="n">christmas</span> <span class="o">&lt;-</span> <span class="nf">filter</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span> <span class="n">month</span><span class="o">==</span><span class="m">12</span><span class="p">,</span> <span class="n">day</span><span class="o">==</span><span class="m">25</span><span class="p">)</span>
<span class="n">plot</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">christmas</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_bar</span><span class="p">(</span>
    <span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">carrier</span><span class="p">)</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Christmas Flights"</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s">"Origin"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">"Count"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"christmas_flights_counts.png"</span><span class="p">)</span>
</pre></div>

<p>
<img src="posts/a-first-look-at-dplyr/christmas_flights_counts.png" alt="nil"></p>
</div>
</div>

<div id="outline-container-orgcbeea69" class="outline-3">
<h3 id="orgcbeea69">Or, Not And</h3>
<div class="outline-text-3" id="text-orgcbeea69">
<p>
   Since the default is for the <code>filter</code> to and everything together, if you want to use something else (like <code>OR</code>) you need to create a single argument built with the OR operator (<code>|</code>). If you're using a single column for the OR, there's actually a (possibly) easier way that works like python's <code>in</code> where you check if the value is in a collection. Let's see the flights on Christmas and on Christmas Eve
.
</p>

<div class="highlight"><pre><span></span><span class="n">both_days</span> <span class="o">&lt;-</span> <span class="nf">filter</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span> <span class="n">month</span><span class="o">==</span><span class="m">12</span><span class="p">,</span> <span class="n">day</span> <span class="o">%in%</span> <span class="nf">c</span><span class="p">(</span><span class="m">24</span><span class="p">,</span> <span class="m">25</span><span class="p">))</span>

<span class="n">plot</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">both_days</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_bar</span><span class="p">(</span>
    <span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">day</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">origin</span><span class="p">)</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Christmas Eve and Day Flights"</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s">"Day"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">"Count"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"christmas_day_and_eve.png"</span><span class="p">)</span>
</pre></div>

<p>
<img src="posts/a-first-look-at-dplyr/christmas_day_and_eve.png" alt="nil"></p>
</div>
</div>

<div id="outline-container-org61ba9d0" class="outline-3">
<h3 id="org61ba9d0">And and Or</h3>
<div class="outline-text-3" id="text-org61ba9d0">
<p>
What if we want New-Years Day and Christmas? In this case we need to keep the month with the day so we can't just use the <code>in</code> operator, but we can use the AND and OR operators to make it work.
</p>

<div class="highlight"><pre><span></span><span class="n">and_new_years</span> <span class="o">=</span> <span class="nf">filter</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span> <span class="p">(</span><span class="n">month</span><span class="o">==</span><span class="m">12</span> <span class="o">&amp;</span> <span class="n">day</span><span class="o">==</span><span class="m">25</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">month</span><span class="o">==</span><span class="m">1</span> <span class="o">&amp;</span> <span class="n">day</span><span class="o">==</span><span class="m">1</span><span class="p">))</span>

<span class="n">plot</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">and_new_years</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_bar</span><span class="p">(</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">day</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">origin</span><span class="p">)</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Christmas and New Years Day"</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s">"Date"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">"Count"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"christmas_new_years.png"</span><span class="p">)</span>
</pre></div>

<p>
<img src="posts/a-first-look-at-dplyr/christmas_new_years.png" alt="nil"></p>

<div class="highlight"><pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">and_new_years</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_boxplot</span><span class="p">(</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">dep_delay</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">origin</span><span class="p">)</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Christmas and New Years Day Delays"</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s">"Departure Airport"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">"Delay (Minutes)"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"christmas_new_years_delay.png"</span><span class="p">)</span>
</pre></div>

<p>
<img src="posts/a-first-look-at-dplyr/christmas_new_years_delay.png" alt="nil"></p>
</div>
</div>
</div>

<div id="outline-container-orgcb686c1" class="outline-2">
<h2 id="orgcb686c1">Arrange</h2>
<div class="outline-text-2" id="text-orgcb686c1">
<p>
<code>arrange</code> is a function to sort the rows. By default it sorts then in non-decreasing (ascending) order using a column you give it. You can givie it multiple columns in which case whenever there's a tie it will look in the next column you gave it to see if it can break it (the tie, I mean).
</p>
</div>

<div id="outline-container-org78b4c4c" class="outline-3">
<h3 id="org78b4c4c">Ascending Order</h3>
<div class="outline-text-3" id="text-org78b4c4c">
<p>
What are the shortest flights?
</p>

<div class="highlight"><pre><span></span><span class="nf">khead</span><span class="p">(</span><span class="nf">arrange</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span> <span class="n">distance</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-right">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">year</th>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">day</th>
<th scope="col" class="org-right">dep_time</th>
<th scope="col" class="org-right">sched_dep_time</th>
<th scope="col" class="org-right">dep_delay</th>
<th scope="col" class="org-right">arr_time</th>
<th scope="col" class="org-right">sched_arr_time</th>
<th scope="col" class="org-right">arr_delay</th>
<th scope="col" class="org-left">carrier</th>
<th scope="col" class="org-right">flight</th>
<th scope="col" class="org-left">tailnum</th>
<th scope="col" class="org-left">origin</th>
<th scope="col" class="org-left">destination</th>
<th scope="col" class="org-right">air_time</th>
<th scope="col" class="org-right">distance</th>
<th scope="col" class="org-right">hour</th>
<th scope="col" class="org-right">minute</th>
<th scope="col" class="org-left">time_hour</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">2013</td>
<td class="org-right">7</td>
<td class="org-right">27</td>
<td class="org-right">NA</td>
<td class="org-right">106</td>
<td class="org-right">NA</td>
<td class="org-right">NA</td>
<td class="org-right">245</td>
<td class="org-right">NA</td>
<td class="org-left">US</td>
<td class="org-right">1632</td>
<td class="org-left">NA</td>
<td class="org-left">EWR</td>
<td class="org-left">LGA</td>
<td class="org-right">NA</td>
<td class="org-right">17</td>
<td class="org-right">1</td>
<td class="org-right">6</td>
<td class="org-left">2013-07-27 01:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">3</td>
<td class="org-right">2127</td>
<td class="org-right">2129</td>
<td class="org-right">-2</td>
<td class="org-right">2222</td>
<td class="org-right">2224</td>
<td class="org-right">-2</td>
<td class="org-left">EV</td>
<td class="org-right">3833</td>
<td class="org-left">N13989</td>
<td class="org-left">EWR</td>
<td class="org-left">PHL</td>
<td class="org-right">30</td>
<td class="org-right">80</td>
<td class="org-right">21</td>
<td class="org-right">29</td>
<td class="org-left">2013-01-03 21:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">4</td>
<td class="org-right">1240</td>
<td class="org-right">1200</td>
<td class="org-right">40</td>
<td class="org-right">1333</td>
<td class="org-right">1306</td>
<td class="org-right">27</td>
<td class="org-left">EV</td>
<td class="org-right">4193</td>
<td class="org-left">N14972</td>
<td class="org-left">EWR</td>
<td class="org-left">PHL</td>
<td class="org-right">30</td>
<td class="org-right">80</td>
<td class="org-right">12</td>
<td class="org-right">0</td>
<td class="org-left">2013-01-04 12:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">4</td>
<td class="org-right">1829</td>
<td class="org-right">1615</td>
<td class="org-right">134</td>
<td class="org-right">1937</td>
<td class="org-right">1721</td>
<td class="org-right">136</td>
<td class="org-left">EV</td>
<td class="org-right">4502</td>
<td class="org-left">N15983</td>
<td class="org-left">EWR</td>
<td class="org-left">PHL</td>
<td class="org-right">28</td>
<td class="org-right">80</td>
<td class="org-right">16</td>
<td class="org-right">15</td>
<td class="org-left">2013-01-04 16:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">4</td>
<td class="org-right">2128</td>
<td class="org-right">2129</td>
<td class="org-right">-1</td>
<td class="org-right">2218</td>
<td class="org-right">2224</td>
<td class="org-right">-6</td>
<td class="org-left">EV</td>
<td class="org-right">4645</td>
<td class="org-left">N27962</td>
<td class="org-left">EWR</td>
<td class="org-left">PHL</td>
<td class="org-right">32</td>
<td class="org-right">80</td>
<td class="org-right">21</td>
<td class="org-right">29</td>
<td class="org-left">2013-01-04 21:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">5</td>
<td class="org-right">1155</td>
<td class="org-right">1200</td>
<td class="org-right">-5</td>
<td class="org-right">1241</td>
<td class="org-right">1306</td>
<td class="org-right">-25</td>
<td class="org-left">EV</td>
<td class="org-right">4193</td>
<td class="org-left">N14902</td>
<td class="org-left">EWR</td>
<td class="org-left">PHL</td>
<td class="org-right">29</td>
<td class="org-right">80</td>
<td class="org-right">12</td>
<td class="org-right">0</td>
<td class="org-left">2013-01-05 12:00:00</td>
</tr>
</tbody>
</table>
<p>
The data uses the three-letter airport codes, but there's another dataframe loaded with <code>ggplot2</code> named <code>airports</code> that we can use to translate them to airport names.
</p>

<div class="highlight"><pre><span></span><span class="nf">okable</span><span class="p">(</span><span class="nf">filter</span><span class="p">(</span><span class="n">airports</span><span class="p">,</span> <span class="n">faa</span> <span class="o">%in%</span> <span class="nf">c</span><span class="p">(</span><span class="s">"PHL"</span><span class="p">,</span> <span class="s">"LGA"</span><span class="p">,</span> <span class="s">"EWR"</span><span class="p">)))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">faa</th>
<th scope="col" class="org-left">name</th>
<th scope="col" class="org-right">lat</th>
<th scope="col" class="org-right">lon</th>
<th scope="col" class="org-right">alt</th>
<th scope="col" class="org-right">tz</th>
<th scope="col" class="org-left">dst</th>
<th scope="col" class="org-left">tzone</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">EWR</td>
<td class="org-left">Newark Liberty Intl</td>
<td class="org-right">40.69250</td>
<td class="org-right">-74.16867</td>
<td class="org-right">18</td>
<td class="org-right">-5</td>
<td class="org-left">A</td>
<td class="org-left">America/New_York</td>
</tr>
<tr>
<td class="org-left">LGA</td>
<td class="org-left">La Guardia</td>
<td class="org-right">40.77725</td>
<td class="org-right">-73.87261</td>
<td class="org-right">22</td>
<td class="org-right">-5</td>
<td class="org-left">A</td>
<td class="org-left">America/New_York</td>
</tr>
<tr>
<td class="org-left">PHL</td>
<td class="org-left">Philadelphia Intl</td>
<td class="org-right">39.87194</td>
<td class="org-right">-75.24114</td>
<td class="org-right">36</td>
<td class="org-right">-5</td>
<td class="org-left">A</td>
<td class="org-left">America/New_York</td>
</tr>
</tbody>
</table>
<p>
So the shortest flights are from Newark Liberty International to La Guardia airport and the Philadelphia International Airport. I wonder why someone would take a plane to go 17 miles? I guess the traffic must be really bad, or some people just have money (and jet fuel) to burn.
</p>
</div>
</div>

<div id="outline-container-org3b66f2f" class="outline-3">
<h3 id="org3b66f2f">Descending Order</h3>
<div class="outline-text-3" id="text-org3b66f2f">
<p>
To get the data to sort in descending order you have to pass in another function call (<code>desc</code>). Weird.
</p>

<p>
What are the longest flights?
</p>

<div class="highlight"><pre><span></span><span class="nf">khead</span><span class="p">(</span><span class="nf">arrange</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span> <span class="nf">desc</span><span class="p">(</span><span class="n">distance</span><span class="p">)))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-right">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">year</th>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">day</th>
<th scope="col" class="org-right">dep_time</th>
<th scope="col" class="org-right">sched_dep_time</th>
<th scope="col" class="org-right">dep_delay</th>
<th scope="col" class="org-right">arr_time</th>
<th scope="col" class="org-right">sched_arr_time</th>
<th scope="col" class="org-right">arr_delay</th>
<th scope="col" class="org-left">carrier</th>
<th scope="col" class="org-right">flight</th>
<th scope="col" class="org-left">tailnum</th>
<th scope="col" class="org-left">origin</th>
<th scope="col" class="org-left">destination</th>
<th scope="col" class="org-right">air_time</th>
<th scope="col" class="org-right">distance</th>
<th scope="col" class="org-right">hour</th>
<th scope="col" class="org-right">minute</th>
<th scope="col" class="org-left">time_hour</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">857</td>
<td class="org-right">900</td>
<td class="org-right">-3</td>
<td class="org-right">1516</td>
<td class="org-right">1530</td>
<td class="org-right">-14</td>
<td class="org-left">HA</td>
<td class="org-right">51</td>
<td class="org-left">N380HA</td>
<td class="org-left">JFK</td>
<td class="org-left">HNL</td>
<td class="org-right">659</td>
<td class="org-right">4983</td>
<td class="org-right">9</td>
<td class="org-right">0</td>
<td class="org-left">2013-01-01 09:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">2</td>
<td class="org-right">909</td>
<td class="org-right">900</td>
<td class="org-right">9</td>
<td class="org-right">1525</td>
<td class="org-right">1530</td>
<td class="org-right">-5</td>
<td class="org-left">HA</td>
<td class="org-right">51</td>
<td class="org-left">N380HA</td>
<td class="org-left">JFK</td>
<td class="org-left">HNL</td>
<td class="org-right">638</td>
<td class="org-right">4983</td>
<td class="org-right">9</td>
<td class="org-right">0</td>
<td class="org-left">2013-01-02 09:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">3</td>
<td class="org-right">914</td>
<td class="org-right">900</td>
<td class="org-right">14</td>
<td class="org-right">1504</td>
<td class="org-right">1530</td>
<td class="org-right">-26</td>
<td class="org-left">HA</td>
<td class="org-right">51</td>
<td class="org-left">N380HA</td>
<td class="org-left">JFK</td>
<td class="org-left">HNL</td>
<td class="org-right">616</td>
<td class="org-right">4983</td>
<td class="org-right">9</td>
<td class="org-right">0</td>
<td class="org-left">2013-01-03 09:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">4</td>
<td class="org-right">900</td>
<td class="org-right">900</td>
<td class="org-right">0</td>
<td class="org-right">1516</td>
<td class="org-right">1530</td>
<td class="org-right">-14</td>
<td class="org-left">HA</td>
<td class="org-right">51</td>
<td class="org-left">N384HA</td>
<td class="org-left">JFK</td>
<td class="org-left">HNL</td>
<td class="org-right">639</td>
<td class="org-right">4983</td>
<td class="org-right">9</td>
<td class="org-right">0</td>
<td class="org-left">2013-01-04 09:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">5</td>
<td class="org-right">858</td>
<td class="org-right">900</td>
<td class="org-right">-2</td>
<td class="org-right">1519</td>
<td class="org-right">1530</td>
<td class="org-right">-11</td>
<td class="org-left">HA</td>
<td class="org-right">51</td>
<td class="org-left">N381HA</td>
<td class="org-left">JFK</td>
<td class="org-left">HNL</td>
<td class="org-right">635</td>
<td class="org-right">4983</td>
<td class="org-right">9</td>
<td class="org-right">0</td>
<td class="org-left">2013-01-05 09:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">6</td>
<td class="org-right">1019</td>
<td class="org-right">900</td>
<td class="org-right">79</td>
<td class="org-right">1558</td>
<td class="org-right">1530</td>
<td class="org-right">28</td>
<td class="org-left">HA</td>
<td class="org-right">51</td>
<td class="org-left">N385HA</td>
<td class="org-left">JFK</td>
<td class="org-left">HNL</td>
<td class="org-right">611</td>
<td class="org-right">4983</td>
<td class="org-right">9</td>
<td class="org-right">0</td>
<td class="org-left">2013-01-06 09:00:00</td>
</tr>
</tbody>
</table>
<p>
You can probably guess the airports from the codes, but we'll look them up anyway.
</p>

<div class="highlight"><pre><span></span><span class="nf">okable</span><span class="p">(</span><span class="nf">filter</span><span class="p">(</span><span class="n">airports</span><span class="p">,</span> <span class="n">faa</span> <span class="o">%in%</span> <span class="nf">c</span><span class="p">(</span><span class="s">"JFK"</span><span class="p">,</span> <span class="s">"HNL"</span><span class="p">)))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">faa</th>
<th scope="col" class="org-left">name</th>
<th scope="col" class="org-right">lat</th>
<th scope="col" class="org-right">lon</th>
<th scope="col" class="org-right">alt</th>
<th scope="col" class="org-right">tz</th>
<th scope="col" class="org-left">dst</th>
<th scope="col" class="org-left">tzone</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">HNL</td>
<td class="org-left">Honolulu Intl</td>
<td class="org-right">21.31868</td>
<td class="org-right">-157.92243</td>
<td class="org-right">13</td>
<td class="org-right">-10</td>
<td class="org-left">N</td>
<td class="org-left">Pacific/Honolulu</td>
</tr>
<tr>
<td class="org-left">JFK</td>
<td class="org-left">John F Kennedy Intl</td>
<td class="org-right">40.63975</td>
<td class="org-right">-73.77893</td>
<td class="org-right">13</td>
<td class="org-right">-5</td>
<td class="org-left">A</td>
<td class="org-left">America/New_York</td>
</tr>
</tbody>
</table>
<p>
And the longest flights are from John F. Kennedy International airport to Honolulu International airport.
</p>
</div>
</div>
</div>

<div id="outline-container-orgdd33126" class="outline-2">
<h2 id="orgdd33126">Select</h2>
<div class="outline-text-2" id="text-orgdd33126">
<p>
<code>select</code> helps with getting subsets of columns. At first glance this seems like something that should be easy to do without needing a separate function, but it adds more ways to grab the columns than just passing in the names.
</p>
</div>

<div id="outline-container-org607a997" class="outline-3">
<h3 id="org607a997">Grab Some Columns</h3>
<div class="outline-text-3" id="text-org607a997">
<p>
The basic way to get a subset of columns is to pass them in as arguments.
</p>

<div class="highlight"><pre><span></span><span class="nf">khead</span><span class="p">(</span><span class="nf">select</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">flight</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">flight</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">1545</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">1714</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">1141</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">725</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">461</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">1696</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org0998a54" class="outline-3">
<h3 id="org0998a54">A Range of Columns</h3>
<div class="outline-text-3" id="text-org0998a54">
<p>
If you want to grab a section of contiguous columns you can pass in the first and last ones separated by a colon (the `:` character, not the vital organ).
</p>

<div class="highlight"><pre><span></span><span class="nf">khead</span><span class="p">(</span><span class="nf">select</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span> <span class="n">dep_time</span><span class="o">:</span><span class="n">arr_time</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">dep_time</th>
<th scope="col" class="org-right">sched_dep_time</th>
<th scope="col" class="org-right">dep_delay</th>
<th scope="col" class="org-right">arr_time</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">517</td>
<td class="org-right">515</td>
<td class="org-right">2</td>
<td class="org-right">830</td>
</tr>
<tr>
<td class="org-right">533</td>
<td class="org-right">529</td>
<td class="org-right">4</td>
<td class="org-right">850</td>
</tr>
<tr>
<td class="org-right">542</td>
<td class="org-right">540</td>
<td class="org-right">2</td>
<td class="org-right">923</td>
</tr>
<tr>
<td class="org-right">544</td>
<td class="org-right">545</td>
<td class="org-right">-1</td>
<td class="org-right">1004</td>
</tr>
<tr>
<td class="org-right">554</td>
<td class="org-right">600</td>
<td class="org-right">-6</td>
<td class="org-right">812</td>
</tr>
<tr>
<td class="org-right">554</td>
<td class="org-right">558</td>
<td class="org-right">-4</td>
<td class="org-right">740</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org6d43ff8" class="outline-3">
<h3 id="org6d43ff8">Helper Functions</h3>
<div class="outline-text-3" id="text-org6d43ff8">
<p>
Like <code>arrange</code> <code>select</code> uses functions passed in to alter the behavior. Most of them are string-methods-ish.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Function</th>
<th scope="col" class="org-left">What it does</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left"><code>starts_with("&lt;prefix&gt;")</code></td>
<td class="org-left">Pick columns by a prefix.</td>
</tr>
<tr>
<td class="org-left"><code>ends_with("&lt;suffix&gt;")</code></td>
<td class="org-left">Pick columns with a suffix.</td>
</tr>
<tr>
<td class="org-left"><code>contains("&lt;sub-string&gt;")</code></td>
<td class="org-left">Pick columns with a sub-string of the name.</td>
</tr>
<tr>
<td class="org-left"><code>matches("&lt;regular-expression&gt;")</code></td>
<td class="org-left">Pick out stuff using a regular expression.</td>
</tr>
<tr>
<td class="org-left"><code>num_range("&lt;prefix&gt;", &lt;number range&gt;)</code></td>
<td class="org-left">Grab columns with the prefix followed by each of the numbers</td>
</tr>
<tr>
<td class="org-left"><code>last_col()</code></td>
<td class="org-left">Get the last column (negative index).</td>
</tr>
<tr>
<td class="org-left"><code>all_of(&lt;vector&gt;)</code></td>
<td class="org-left">Grab the columns in the vector.</td>
</tr>
<tr>
<td class="org-left"><code>any_of(&lt;vector&gt;)</code></td>
<td class="org-left">Same as <code>all_of</code> but ignores non-existent columns in the vector</td>
</tr>
<tr>
<td class="org-left"><code>where(&lt;function&gt;)</code></td>
<td class="org-left">Applies the function to the columns and picks the ones that return true</td>
</tr>
</tbody>
</table>
<p>
You can also use logical AND and OR operators or a vector to combine the selections, but we'll just do a basic one-function call. Let's grab all the columns with an underscore in their name.
</p>

<div class="highlight"><pre><span></span><span class="nf">khead</span><span class="p">(</span><span class="nf">select</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span> <span class="nf">contains</span><span class="p">(</span><span class="s">"_"</span><span class="p">)))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">dep_time</th>
<th scope="col" class="org-right">sched_dep_time</th>
<th scope="col" class="org-right">dep_delay</th>
<th scope="col" class="org-right">arr_time</th>
<th scope="col" class="org-right">sched_arr_time</th>
<th scope="col" class="org-right">arr_delay</th>
<th scope="col" class="org-right">air_time</th>
<th scope="col" class="org-left">time_hour</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">517</td>
<td class="org-right">515</td>
<td class="org-right">2</td>
<td class="org-right">830</td>
<td class="org-right">819</td>
<td class="org-right">11</td>
<td class="org-right">227</td>
<td class="org-left">2013-01-01 05:00:00</td>
</tr>
<tr>
<td class="org-right">533</td>
<td class="org-right">529</td>
<td class="org-right">4</td>
<td class="org-right">850</td>
<td class="org-right">830</td>
<td class="org-right">20</td>
<td class="org-right">227</td>
<td class="org-left">2013-01-01 05:00:00</td>
</tr>
<tr>
<td class="org-right">542</td>
<td class="org-right">540</td>
<td class="org-right">2</td>
<td class="org-right">923</td>
<td class="org-right">850</td>
<td class="org-right">33</td>
<td class="org-right">160</td>
<td class="org-left">2013-01-01 05:00:00</td>
</tr>
<tr>
<td class="org-right">544</td>
<td class="org-right">545</td>
<td class="org-right">-1</td>
<td class="org-right">1004</td>
<td class="org-right">1022</td>
<td class="org-right">-18</td>
<td class="org-right">183</td>
<td class="org-left">2013-01-01 05:00:00</td>
</tr>
<tr>
<td class="org-right">554</td>
<td class="org-right">600</td>
<td class="org-right">-6</td>
<td class="org-right">812</td>
<td class="org-right">837</td>
<td class="org-right">-25</td>
<td class="org-right">116</td>
<td class="org-left">2013-01-01 06:00:00</td>
</tr>
<tr>
<td class="org-right">554</td>
<td class="org-right">558</td>
<td class="org-right">-4</td>
<td class="org-right">740</td>
<td class="org-right">728</td>
<td class="org-right">12</td>
<td class="org-right">150</td>
<td class="org-left">2013-01-01 05:00:00</td>
</tr>
</tbody>
</table>
<p>
You can also negate the selections using an exclamation point (<code>!</code>), so we can grab all the columns that don't have an underscore in their name like this.
</p>

<div class="highlight"><pre><span></span><span class="nf">khead</span><span class="p">(</span><span class="nf">select</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span> <span class="o">!</span><span class="nf">contains</span><span class="p">(</span><span class="s">"_"</span><span class="p">)))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-right">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">year</th>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">day</th>
<th scope="col" class="org-left">carrier</th>
<th scope="col" class="org-right">flight</th>
<th scope="col" class="org-left">tailnum</th>
<th scope="col" class="org-left">origin</th>
<th scope="col" class="org-left">dest</th>
<th scope="col" class="org-right">distance</th>
<th scope="col" class="org-right">hour</th>
<th scope="col" class="org-right">minute</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-left">UA</td>
<td class="org-right">1545</td>
<td class="org-left">N14228</td>
<td class="org-left">EWR</td>
<td class="org-left">IAH</td>
<td class="org-right">1400</td>
<td class="org-right">5</td>
<td class="org-right">15</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-left">UA</td>
<td class="org-right">1714</td>
<td class="org-left">N24211</td>
<td class="org-left">LGA</td>
<td class="org-left">IAH</td>
<td class="org-right">1416</td>
<td class="org-right">5</td>
<td class="org-right">29</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-left">AA</td>
<td class="org-right">1141</td>
<td class="org-left">N619AA</td>
<td class="org-left">JFK</td>
<td class="org-left">MIA</td>
<td class="org-right">1089</td>
<td class="org-right">5</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-left">B6</td>
<td class="org-right">725</td>
<td class="org-left">N804JB</td>
<td class="org-left">JFK</td>
<td class="org-left">BQN</td>
<td class="org-right">1576</td>
<td class="org-right">5</td>
<td class="org-right">45</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-left">DL</td>
<td class="org-right">461</td>
<td class="org-left">N668DN</td>
<td class="org-left">LGA</td>
<td class="org-left">ATL</td>
<td class="org-right">762</td>
<td class="org-right">6</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-left">UA</td>
<td class="org-right">1696</td>
<td class="org-left">N39463</td>
<td class="org-left">EWR</td>
<td class="org-left">ORD</td>
<td class="org-right">719</td>
<td class="org-right">5</td>
<td class="org-right">58</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org92c215d" class="outline-2">
<h2 id="org92c215d">Renaming</h2>
<div class="outline-text-2" id="text-org92c215d">
<p>
The book mentions renaming under the <code>select</code> section because it says that it is a special case of selection, but it has a dedicated function to do that named <code>rename</code> that you should use instead. Let's rename the first column (<code>year</code>).
</p>

<div class="highlight"><pre><span></span><span class="nf">khead</span><span class="p">(</span><span class="nf">rename</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span> <span class="n">Jahr</span><span class="o">=</span><span class="n">year</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-right">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">Jahr</th>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">day</th>
<th scope="col" class="org-right">dep_time</th>
<th scope="col" class="org-right">sched_dep_time</th>
<th scope="col" class="org-right">dep_delay</th>
<th scope="col" class="org-right">arr_time</th>
<th scope="col" class="org-right">sched_arr_time</th>
<th scope="col" class="org-right">arr_delay</th>
<th scope="col" class="org-left">carrier</th>
<th scope="col" class="org-right">flight</th>
<th scope="col" class="org-left">tailnum</th>
<th scope="col" class="org-left">origin</th>
<th scope="col" class="org-left">dest</th>
<th scope="col" class="org-right">air_time</th>
<th scope="col" class="org-right">distance</th>
<th scope="col" class="org-right">hour</th>
<th scope="col" class="org-right">minute</th>
<th scope="col" class="org-left">time_hour</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">517</td>
<td class="org-right">515</td>
<td class="org-right">2</td>
<td class="org-right">830</td>
<td class="org-right">819</td>
<td class="org-right">11</td>
<td class="org-left">UA</td>
<td class="org-right">1545</td>
<td class="org-left">N14228</td>
<td class="org-left">EWR</td>
<td class="org-left">IAH</td>
<td class="org-right">227</td>
<td class="org-right">1400</td>
<td class="org-right">5</td>
<td class="org-right">15</td>
<td class="org-left">2013-01-01 05:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">533</td>
<td class="org-right">529</td>
<td class="org-right">4</td>
<td class="org-right">850</td>
<td class="org-right">830</td>
<td class="org-right">20</td>
<td class="org-left">UA</td>
<td class="org-right">1714</td>
<td class="org-left">N24211</td>
<td class="org-left">LGA</td>
<td class="org-left">IAH</td>
<td class="org-right">227</td>
<td class="org-right">1416</td>
<td class="org-right">5</td>
<td class="org-right">29</td>
<td class="org-left">2013-01-01 05:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">542</td>
<td class="org-right">540</td>
<td class="org-right">2</td>
<td class="org-right">923</td>
<td class="org-right">850</td>
<td class="org-right">33</td>
<td class="org-left">AA</td>
<td class="org-right">1141</td>
<td class="org-left">N619AA</td>
<td class="org-left">JFK</td>
<td class="org-left">MIA</td>
<td class="org-right">160</td>
<td class="org-right">1089</td>
<td class="org-right">5</td>
<td class="org-right">40</td>
<td class="org-left">2013-01-01 05:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">544</td>
<td class="org-right">545</td>
<td class="org-right">-1</td>
<td class="org-right">1004</td>
<td class="org-right">1022</td>
<td class="org-right">-18</td>
<td class="org-left">B6</td>
<td class="org-right">725</td>
<td class="org-left">N804JB</td>
<td class="org-left">JFK</td>
<td class="org-left">BQN</td>
<td class="org-right">183</td>
<td class="org-right">1576</td>
<td class="org-right">5</td>
<td class="org-right">45</td>
<td class="org-left">2013-01-01 05:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">554</td>
<td class="org-right">600</td>
<td class="org-right">-6</td>
<td class="org-right">812</td>
<td class="org-right">837</td>
<td class="org-right">-25</td>
<td class="org-left">DL</td>
<td class="org-right">461</td>
<td class="org-left">N668DN</td>
<td class="org-left">LGA</td>
<td class="org-left">ATL</td>
<td class="org-right">116</td>
<td class="org-right">762</td>
<td class="org-right">6</td>
<td class="org-right">0</td>
<td class="org-left">2013-01-01 06:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">554</td>
<td class="org-right">558</td>
<td class="org-right">-4</td>
<td class="org-right">740</td>
<td class="org-right">728</td>
<td class="org-right">12</td>
<td class="org-left">UA</td>
<td class="org-right">1696</td>
<td class="org-left">N39463</td>
<td class="org-left">EWR</td>
<td class="org-left">ORD</td>
<td class="org-right">150</td>
<td class="org-right">719</td>
<td class="org-right">5</td>
<td class="org-right">58</td>
<td class="org-left">2013-01-01 05:00:00</td>
</tr>
</tbody>
</table>
<p>
<b><b>Note:</b></b> Pay attention to the funky syntax - the new name comes first and the original name comes after the equal sign.
</p>
</div>

<div id="outline-container-org6fbf8eb" class="outline-4">
<h4 id="org6fbf8eb">Some More Useful Renaming</h4>
<div class="outline-text-4" id="text-org6fbf8eb">
<p>
That wasn't really helpful, so how about we rename some other columns?
</p>

<div class="highlight"><pre><span></span><span class="n">flights</span> <span class="o">&lt;-</span> <span class="nf">rename</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="n">dest</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div id="outline-container-org1010fdf" class="outline-2">
<h2 id="org1010fdf">Mutate</h2>
<div class="outline-text-2" id="text-org1010fdf">
<p>
The <code>mutate</code> function adds a column (or columns) to the end of the dataframe based on things you tell it to do to one or more other columns. 
</p>

<p>
First, we'll grabs a subset of columns to make this easier to see.
</p>

<div class="highlight"><pre><span></span><span class="n">subset</span> <span class="o">=</span> <span class="nf">select</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span> <span class="nf">ends_with</span><span class="p">(</span><span class="s">"delay"</span><span class="p">),</span> <span class="n">air_time</span><span class="p">,</span> <span class="n">distance</span><span class="p">)</span>
<span class="nf">khead</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">dep_delay</th>
<th scope="col" class="org-right">arr_delay</th>
<th scope="col" class="org-right">air_time</th>
<th scope="col" class="org-right">distance</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">2</td>
<td class="org-right">11</td>
<td class="org-right">227</td>
<td class="org-right">1400</td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-right">20</td>
<td class="org-right">227</td>
<td class="org-right">1416</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-right">33</td>
<td class="org-right">160</td>
<td class="org-right">1089</td>
</tr>
<tr>
<td class="org-right">-1</td>
<td class="org-right">-18</td>
<td class="org-right">183</td>
<td class="org-right">1576</td>
</tr>
<tr>
<td class="org-right">-6</td>
<td class="org-right">-25</td>
<td class="org-right">116</td>
<td class="org-right">762</td>
</tr>
<tr>
<td class="org-right">-4</td>
<td class="org-right">12</td>
<td class="org-right">150</td>
<td class="org-right">719</td>
</tr>
</tbody>
</table>
<p>
Now to add a couple of columns giving the difference between how late they arrived and how late they left and the average speed.
</p>

<div class="highlight"><pre><span></span><span class="nf">khead</span><span class="p">(</span><span class="nf">mutate</span><span class="p">(</span><span class="n">subset</span><span class="p">,</span>
	     <span class="n">Time_Made_Up</span><span class="o">=</span><span class="n">dep_delay</span> <span class="o">-</span> <span class="n">arr_delay</span><span class="p">,</span>
	     <span class="n">Miles_Per_Minute</span> <span class="o">=</span> <span class="n">distance</span><span class="o">/</span><span class="n">air_time</span>
	     <span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">dep_delay</th>
<th scope="col" class="org-right">arr_delay</th>
<th scope="col" class="org-right">air_time</th>
<th scope="col" class="org-right">distance</th>
<th scope="col" class="org-right">Time_Made_Up</th>
<th scope="col" class="org-right">Miles_Per_Minute</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">2</td>
<td class="org-right">11</td>
<td class="org-right">227</td>
<td class="org-right">1400</td>
<td class="org-right">-9</td>
<td class="org-right">6.167401</td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-right">20</td>
<td class="org-right">227</td>
<td class="org-right">1416</td>
<td class="org-right">-16</td>
<td class="org-right">6.237885</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-right">33</td>
<td class="org-right">160</td>
<td class="org-right">1089</td>
<td class="org-right">-31</td>
<td class="org-right">6.806250</td>
</tr>
<tr>
<td class="org-right">-1</td>
<td class="org-right">-18</td>
<td class="org-right">183</td>
<td class="org-right">1576</td>
<td class="org-right">17</td>
<td class="org-right">8.612022</td>
</tr>
<tr>
<td class="org-right">-6</td>
<td class="org-right">-25</td>
<td class="org-right">116</td>
<td class="org-right">762</td>
<td class="org-right">19</td>
<td class="org-right">6.568966</td>
</tr>
<tr>
<td class="org-right">-4</td>
<td class="org-right">12</td>
<td class="org-right">150</td>
<td class="org-right">719</td>
<td class="org-right">-16</td>
<td class="org-right">4.793333</td>
</tr>
</tbody>
</table>
</div>

<div id="outline-container-orga4c0d02" class="outline-3">
<h3 id="orga4c0d02">Transmute</h3>
<div class="outline-text-3" id="text-orga4c0d02">
<p>
This is like the <code>mutate</code> function but it only keeps the new columns you created, not the original columns.
</p>

<div class="highlight"><pre><span></span><span class="nf">khead</span><span class="p">(</span><span class="nf">transmute</span><span class="p">(</span><span class="n">subset</span><span class="p">,</span>
       <span class="n">Time_Made_Up</span><span class="o">=</span><span class="n">dep_delay</span> <span class="o">-</span> <span class="n">arr_delay</span><span class="p">,</span>
       <span class="n">Miles_Per_Hour</span> <span class="o">=</span> <span class="n">distance</span><span class="o">/</span><span class="p">(</span><span class="n">air_time</span><span class="o">/</span><span class="m">60</span><span class="p">)</span>
       <span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">Time_Made_Up</th>
<th scope="col" class="org-right">Miles_Per_Hour</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">-9</td>
<td class="org-right">370.0441</td>
</tr>
<tr>
<td class="org-right">-16</td>
<td class="org-right">374.2731</td>
</tr>
<tr>
<td class="org-right">-31</td>
<td class="org-right">408.3750</td>
</tr>
<tr>
<td class="org-right">17</td>
<td class="org-right">516.7213</td>
</tr>
<tr>
<td class="org-right">19</td>
<td class="org-right">394.1379</td>
</tr>
<tr>
<td class="org-right">-16</td>
<td class="org-right">287.6000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-orgbcb60f8" class="outline-2">
<h2 id="orgbcb60f8">Summarize</h2>
<div class="outline-text-2" id="text-orgbcb60f8">
<p>
<code>summarize</code> reduces a collection of numbers to a single summary statistic. As an example we can look at the median departure delay. First, let's check if it has any missing values.
</p>

<div class="highlight"><pre><span></span><span class="nf">got_all_your_data</span><span class="p">(</span><span class="n">flights</span><span class="o">$</span><span class="n">dep_delay</span><span class="p">)</span>
</pre></div>

<pre class="example">
[1] FALSE
attr(,"msg")
[1] "data contains 8255 missing values"
</pre>


<p>
Okay, so we'll just tell <code>median</code> to ignore it.
</p>

<div class="highlight"><pre><span></span><span class="nf">okable</span><span class="p">(</span><span class="nf">summarize</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span> <span class="n">median_departure_delay</span><span class="o">=</span><span class="nf">median</span><span class="p">(</span><span class="n">dep_delay</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="org-right"></colgroup>
<thead><tr>
<th scope="col" class="org-right">median_departure_delay</th>
</tr></thead>
<tbody><tr>
<td class="org-right">-2</td>
</tr></tbody>
</table>
<p>
What if we hadn't ignored the missing?
</p>

<div class="highlight"><pre><span></span><span class="nf">okable</span><span class="p">(</span><span class="nf">summarize</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span> <span class="n">median_departure_delay</span><span class="o">=</span><span class="nf">median</span><span class="p">(</span><span class="n">dep_delay</span><span class="p">)))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="org-left"></colgroup>
<thead><tr>
<th scope="col" class="org-left">median_departure_delay</th>
</tr></thead>
<tbody><tr>
<td class="org-left">NA</td>
</tr></tbody>
</table>
<p>
The R summary functions like <code>median</code> and <code>mean</code> consider any missing data invalid unless you tell it to ignore the missing. How is this use of <code>summarize</code> different from just calling <code>median</code>?
</p>

<div class="highlight"><pre><span></span><span class="nf">median</span><span class="p">(</span><span class="n">flights</span><span class="o">$</span><span class="n">dep_delay</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
</pre></div>

<pre class="example">
[1] -2
</pre>


<p>
Well, it doesn't look quite as nice. So, you might think, well, all we did was add a columns name, was that useful?
</p>
</div>

<div id="outline-container-org5e38b4c" class="outline-3">
<h3 id="org5e38b4c">Grouping</h3>
<div class="outline-text-3" id="text-org5e38b4c">
<p>
The reason for <code>summarize</code> is that it works in tandem with groups. Instead of finding the median for the whole column, we can find the median by group.
</p>

<div class="highlight"><pre><span></span><span class="n">by_month</span> <span class="o">=</span> <span class="nf">group_by</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span> <span class="n">month</span><span class="p">)</span>

<span class="nf">okable</span><span class="p">(</span><span class="nf">summarize</span><span class="p">(</span><span class="n">by_month</span><span class="p">,</span> <span class="n">median_monthly_delay</span><span class="o">=</span><span class="nf">median</span><span class="p">(</span><span class="n">dep_delay</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">month</th>
<th scope="col" class="org-right">median_monthly_delay</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">-2</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-right">-2</td>
</tr>
<tr>
<td class="org-right">3</td>
<td class="org-right">-1</td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-right">-2</td>
</tr>
<tr>
<td class="org-right">5</td>
<td class="org-right">-1</td>
</tr>
<tr>
<td class="org-right">6</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">7</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">8</td>
<td class="org-right">-1</td>
</tr>
<tr>
<td class="org-right">9</td>
<td class="org-right">-3</td>
</tr>
<tr>
<td class="org-right">10</td>
<td class="org-right">-3</td>
</tr>
<tr>
<td class="org-right">11</td>
<td class="org-right">-3</td>
</tr>
<tr>
<td class="org-right">12</td>
<td class="org-right">0</td>
</tr>
</tbody>
</table>
<p>
Is that right? Let's look at a boxplot of the dataset and check.
</p>

<div class="highlight"><pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">by_month</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_boxplot</span><span class="p">(</span>
    <span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">month</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">dep_delay</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="nf">factor</span><span class="p">(</span><span class="n">month</span><span class="p">)),</span> 
    <span class="n">outlier.shape</span><span class="o">=</span><span class="kc">NA</span><span class="p">,</span>
    <span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">limits</span> <span class="o">=</span> <span class="nf">quantile</span><span class="p">(</span><span class="n">by_month</span><span class="o">$</span><span class="n">dep_delay</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span> <span class="m">0.9</span><span class="p">),</span>
				       <span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Monthly Delays"</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s">"Month"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">"Delay (Minutes)"</span><span class="p">)</span>


<span class="nf">ggsave</span><span class="p">(</span><span class="s">"monthly_delay_boxplot.png"</span><span class="p">)</span>
</pre></div>

<p>
<img src="posts/a-first-look-at-dplyr/monthly_delay_boxplot.png" alt="nil"></p>

<p>
So, that isn't so exciting, but it does show that the median values tend to be negative (meaning they left early) like our summary said.
</p>
</div>
</div>

<div id="outline-container-orgbf97e0d" class="outline-3">
<h3 id="orgbf97e0d">Hitting the Pipe</h3>
<div class="outline-text-3" id="text-orgbf97e0d">
<p>
<code>dplyr</code> adds an operator called the "pipe" (<code>%&gt;%</code>) that works like a unix pipe does, sending the output of one function to another, allowing you to save some keystrokes adding temporary variables or nesting function calls.
</p>

<p>
So, here's what we're going to do. 
</p>

<ul class="org-ul">
<li>We're going to pass the <code>flights</code> dataset to the <code>group_by</code> function and group the data by destination</li>
<li>Then we're going to pass that output to the <code>summarize</code> function and summarize by:
<ul class="org-ul">
<li>the counts</li>
<li>mean distance of the flight</li>
<li>and the mean arrival delay of each group</li>
</ul>
</li>
<li>Then we're going to pass the summarized data to <code>filter</code> to get the top 20 that didn't go to Honolulu.</li>
</ul>
<p>
First let's do a check for missing values.
</p>

<div class="highlight"><pre><span></span><span class="nf">got_all_your_data</span><span class="p">(</span><span class="n">flights</span><span class="o">$</span><span class="n">arr_delay</span><span class="p">)</span>
<span class="nf">got_all_your_data</span><span class="p">(</span><span class="n">flights</span><span class="o">$</span><span class="n">distance</span><span class="p">)</span>
</pre></div>

<pre class="example">
[1] FALSE
attr(,"msg")
[1] "data contains 9430 missing values"
[1] TRUE
</pre>


<p>
There's no missing distances but there are missing arrival delays.
</p>

<div class="highlight"><pre><span></span><span class="n">delays_vs_distance</span> <span class="o">&lt;-</span> <span class="n">flights</span> <span class="o">%&gt;%</span>
  <span class="nf">group_by</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">summarize</span><span class="p">(</span>
    <span class="n">count</span> <span class="o">=</span> <span class="nf">n</span><span class="p">(),</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="nf">mean</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="n">na.rm</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">),</span>
    <span class="n">delay</span> <span class="o">=</span> <span class="nf">mean</span><span class="p">(</span><span class="n">arr_delay</span><span class="p">,</span> <span class="n">na.rm</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
  <span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">filter</span><span class="p">(</span><span class="n">count</span> <span class="o">&gt;</span> <span class="m">20</span><span class="p">,</span> <span class="n">destination</span> <span class="o">!=</span> <span class="s">"HNL"</span><span class="p">)</span>

<span class="nf">khead</span><span class="p">(</span><span class="n">delays_vs_distance</span><span class="p">)</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">destination</th>
<th scope="col" class="org-right">count</th>
<th scope="col" class="org-right">distance</th>
<th scope="col" class="org-right">delay</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">ABQ</td>
<td class="org-right">254</td>
<td class="org-right">1826.0000</td>
<td class="org-right">4.381890</td>
</tr>
<tr>
<td class="org-left">ACK</td>
<td class="org-right">265</td>
<td class="org-right">199.0000</td>
<td class="org-right">4.852273</td>
</tr>
<tr>
<td class="org-left">ALB</td>
<td class="org-right">439</td>
<td class="org-right">143.0000</td>
<td class="org-right">14.397129</td>
</tr>
<tr>
<td class="org-left">ATL</td>
<td class="org-right">17215</td>
<td class="org-right">757.1082</td>
<td class="org-right">11.300113</td>
</tr>
<tr>
<td class="org-left">AUS</td>
<td class="org-right">2439</td>
<td class="org-right">1514.2530</td>
<td class="org-right">6.019909</td>
</tr>
<tr>
<td class="org-left">AVL</td>
<td class="org-right">275</td>
<td class="org-right">583.5818</td>
<td class="org-right">8.003831</td>
</tr>
</tbody>
</table>
<p>
Note that we're using the mean here, not the median, so there's going to be more variation because of all the outliers. Also, because there are some missing values we had to tell the <code>mean</code> function to ignore them - otherwise the default is to return <code>NA</code> if any values are missing. There weren't any missing <code>distance</code> rows, but passing that argument in doesn't do any harm, I don't think. Now let's plot it.
</p>

<div class="highlight"><pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">delays_vs_distance</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">distance</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">delay</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">count</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="m">0.4</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_smooth</span><span class="p">(</span><span class="n">se</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Distance Traveled vs Arrival Delay"</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s">"Distance (Miles)"</span><span class="p">,</span>
       <span class="n">y</span><span class="o">=</span><span class="s">"Delay (Minutes)"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"distance_vs_delay.png"</span><span class="p">)</span>
</pre></div>

<p>
<img src="posts/a-first-look-at-dplyr/distance_vs_delay.png" alt="nil"></p>

<p>
It looks like up to a point the further you travel the worse the delay, and then it starts going in the opposite direction, with longer flights having shorter delays in their arrival times.
</p>
</div>
</div>
</div>
<div id="outline-container-org132ca5f" class="outline-2">
<h2 id="org132ca5f">Link Collection</h2>
<div class="outline-text-2" id="text-org132ca5f">
<ul class="org-ul">
<li>
<a href="https://cran.r-project.org/web/packages/ascii/index.html">ascii</a>: The R package to help change R-output to work better with org-mode.</li>
<li>
<a href="https://github.com/hadley/assertthat">assertthat</a>: R assertions.</li>
<li>
<a href="https://www.bts.gov/">Bureau of Transportation Statistics</a>: This is where the <code>flights</code> dataset originally comes from.</li>
<li>
<a href="https://dplyr.tidyverse.org/">dplyr</a>: the tidyverse page for this package</li>
<li>
<a href="https://bookdown.org/yihui/rmarkdown-cookbook/kable.html">rmarkdown-cookbook</a>: This page is about <code>knitr's</code> <code>kable</code> command.</li>
<li>
<a href="https://www.rdocumentation.org/packages/nycflights13/versions/1.0.1"><code>nycflights13</code></a>: A description of the datasets in this package.</li>
</ul>
</div>
</div>
    </div>
    </article>
</div>

        <ul class="pager postindexpager clearfix">
<li class="previous"><a href="index-4.html" rel="prev">Newer posts</a></li>
            <li class="next"><a href="index-2.html" rel="next">Older posts</a></li>
        </ul>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
             MathJax.Hub.Config({
               tex2jax: {
                 inlineMath: [['$','$'], ['\\(','\\)']],
                 displayMath: [['$$','$$'], ['\\[','\\]']],
                 processEscapes: true,
                 processEnvironments: true,
               },
               displayAlign: 'center',
               "HTML-CSS": {
                 styles: {'.MathJax_Display': {"margin": 0}}
               }
             });
            </script><script src="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.js"></script><!--End of body content--><footer id="footer"><a href="mailto:cloisteredmonkey.jmark@slmail.me">The Cloistered Monkey</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
 <img alt="Creative Commons License BY-NC-SA" style="border-width:0; margin-bottom:12px;" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"></a>
            
            
        </footer>
</div>
</div>


        <script src="assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
