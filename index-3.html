<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Striking out for data." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Bowling For Data (old posts, page 3) | Bowling For Data</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Bowling-For-Data/index-3.html" rel="canonical">
<link href="index-4.html" rel="prev" type="text/html">
<link href="index-2.html" rel="next" type="text/html"><!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
<script crossorigin="anonymous" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],

            displayMath: [['$$','$$'], ['\\[','\\]']],
            processEscapes: true,
            processEnvironments: true,
        }
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/pseudocode@2.4.1/build/pseudocode.min.js"></script>
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="."><span id="blog-title">Bowling For Data</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="pages/">Pages</a></li>
<li class="nav-item"><a class="nav-link" href="archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="rss.xml">RSS feed</a></li>
<li class="nav-item dropdown"><a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Monkey Pages</a>
<div class="dropdown-menu"><a class="dropdown-item" href="https://necromuralist.github.io/">The Cloistered Monkey</a> <a class="dropdown-item" href="https://necromuralist.github.io/Ape-Iron/">Ape Iron</a> <a class="dropdown-item" href="https://necromuralist.github.io/Beach-Pig-Thigh/">Beach-Pig Rump & Thigh</a> <a class="dropdown-item" href="https://necromuralist.github.io/Neurotic-Networking/">Neurotic Networking</a> <a class="dropdown-item" href="https://necromuralist.github.io/Terribilis-Ludum/">Terribilis Ludum</a> <a class="dropdown-item" href="https://necromuralist.github.io/Visions-Voices-Data/">Visions, Voices, Data</a></div>
</li>
</ul>
<!-- DuckDuckGo custom search -->
<form action="https://duckduckgo.com/" class="navbar-form pull-left" id="search" method="get" name="search"><input name="sites" type="hidden" value="https://necromuralist.github.io/Bowling-For-Data/"><input name="k8" type="hidden" value="#444444"><input name="k9" type="hidden" value="#D51920"><input name="kt" type="hidden" value="h"><input class="span2" maxlength="255" name="q" placeholder="Searchâ€¦" style="margin-top: 4px;" type="text"><input style="visibility: hidden;" type="submit" value="DuckDuckGo Search"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<div class="postindex">
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/the-partition/index.html">The Road To Partition</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/the-partition/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-02-21T17:46:07-08:00" itemprop="datePublished" title="2022-02-21 17:46">2022-02-21 17:46</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div class="outline-2" id="outline-container-org99de651">
<h2 id="org99de651">The Beginning</h2>
<div class="outline-text-2" id="text-org99de651">
<ul class="org-ul">
<li><a href="posts/levitins-partition/index.html">Levitin's Partition</a></li>
<li><a href="posts/clrs-partition/index.html">CLRS Partition</a></li>
<li><a href="posts/randomized-partition/index.html">Randomized Partition</a></li>
<li><a href="posts/comparing-the-partition-swaps/index.html">Comparing the Partition Swaps</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org5fd1dc3">
<h2 id="org5fd1dc3">Sources</h2>
<div class="outline-text-2" id="text-org5fd1dc3">
<ul class="org-ul">
<li><a href="posts/clrs/index.html">Introduction To Algorithms (CLRS)</a></li>
<li><a href="posts/itdaa/index.html">Introduction to the Design & Analysis of Algorithms (Levitin)</a></li>
<li><a href="https://en.wikipedia.org/wiki/Quicksort">Wikipedia on Quicksort</a></li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/the-selection-problem/index.html">The Selection Problem</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/the-selection-problem/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-02-20T12:23:40-08:00" itemprop="datePublished" title="2022-02-20 12:23">2022-02-20 12:23</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/the-selection-problem/index.html#org40ed4a0">What is the Selection Problem?</a></li>
<li><a href="posts/the-selection-problem/index.html#org987d012">Selection Vs Sorting</a></li>
<li><a href="posts/the-selection-problem/index.html#orgf930f31">Familiar Cases</a>
<ul>
<li><a href="posts/the-selection-problem/index.html#orgb7226eb">Minimum and Maximum</a></li>
<li><a href="posts/the-selection-problem/index.html#org087f5c2">The Median</a></li>
</ul>
</li>
<li><a href="posts/the-selection-problem/index.html#org22b2515">Sources</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org40ed4a0">
<h2 id="org40ed4a0">What is the Selection Problem?</h2>
<div class="outline-text-2" id="text-org40ed4a0">
<p>The <i>Selection Problem</i> involves finding the <i>kth</i> smallest item in a collection of <i>n</i> items. This item is called an <b>Order Statistic</b>.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org987d012">
<h2 id="org987d012">Selection Vs Sorting</h2>
<div class="outline-text-2" id="text-org987d012">
<p>If the collection is already sorted then you can just pull the order statistic out directly (assuming it's accessible by its index) and if it isn't you could sort it first and then retrieve the order statistic. Since Mergesort and Heapsort have a runtime of \(\Theta(n \log n)\) we know that this would be the runtime using this method, but since we are only choosing one item we don't need to sort the collection, so we can find the item with less computation, and thus selection is its own problem.</p>
</div>
</div>
<div class="outline-2" id="outline-container-orgf930f31">
<h2 id="orgf930f31">Familiar Cases</h2>
<div class="outline-text-2" id="text-orgf930f31">
<p>While you might search for any ranked item (the third item, say), there are three special cases that are common enough to have been given names.</p>
<ul class="org-ul">
<li>the <i>Minimum</i></li>
<li>the <i>Maximum</i></li>
<li>the <i>Median</i></li>
</ul>
</div>
<div class="outline-3" id="outline-container-orgb7226eb">
<h3 id="orgb7226eb">Minimum and Maximum</h3>
<div class="outline-text-3" id="text-orgb7226eb">
<p>The <i>Minimum</i> and <i>Maximum</i> are probably self-explanatory, but to be complete: the <i>Minimum</i> is the order statistic when \(k = 1\) and the <i>Maximum</i> is the order statistic when \(k=n\). As an example of the <i>Selection Problem</i> requiring fewer comparisons than the <i>Sorting Problem</i> we can look at finding the <i>Minimum</i> by traversing the array.</p>
<pre id="minimum" style="display:hidden;">
\begin{algorithm}
\caption{Minimum}
\begin{algorithmic}
\INPUT An array of comparable items
\OUTPUT The smallest item
\PROCEDURE{Minimum}{$A$}
  \STATE minimum $\gets$ A[0]
  \FOR{$i \in \{ 1 \ldots A.length - 1\}$}
   \IF {minimum &gt; A[i]}
    \STATE minimum $\gets$ A[i]
   \ENDIF
  \ENDFOR
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>
<p>Since we're traversing the collection once it will always have a runtime of \(\Theta(n)\). The <i>Maximum</i> can be found the same way but with the greater than sign in the if-statement.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org087f5c2">
<h3 id="org087f5c2">The Median</h3>
<div class="outline-text-3" id="text-org087f5c2">
<p>While most people know what the median is (I once worked with an engineer who thought it was the middle item of the unsorted items, not the item whose value was in the middle, so it might not be true that <i>all</i> people know what it is) but since we're talking about Order Statistics and not <i>Statistics</i> like in <a href="https://en.wikipedia.org/wiki/How_to_Lie_with_Statistics">"How to Lie With Statistics"</a> we'll make it a little more confusing by using a similar but not exactly the same definition.</p>
<p>\[ k = \left \lceil \frac{n}{2} \right \rceil \]</p>
<p>This definition comes from <a href="posts/itdaa/index.html">Levitin</a>. In his description he defines the median as the value with half the remaining values less than it and half the remaining values above it, which suggests that he's defining the case where there are an odd number of items only.</p>
<p><a href="posts/clrs/index.html">CLRS</a> gives a two-part definition with the odd case:</p>
<p>\[ k = \frac{n + 1}{2} \]</p>
<p>and the case where there are an even number of items broken up into two:</p>
<p>\[ \textbf{Lower Median} = \left \lfloor \frac{n + 1}{2} \right \rfloor \\ \textbf{Upper Median} = \left \lceil \frac{n + 1}{2} \right \rceil \\ \]</p>
<p>With their median being the <b>Lower Median</b>. Despite the differences if you run through some numbers you can see that they're basically the same (adding 1 and then taking the floor after dividing by 2 is the same as the ceiling of dividing by 2 without adding 1).</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">ceiling</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="n">a</span><span class="o">//-</span><span class="n">b</span><span class="p">)</span>

<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"n=</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">: </span><span class="se">\t</span><span class="s2">Levitin: </span><span class="si">{</span><span class="n">ceiling</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="se">\t</span><span class="s2">Lower Median: </span><span class="si">{</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
n=1:    Levitin: 1      Lower Median: 1
n=2:    Levitin: 1      Lower Median: 1
n=3:    Levitin: 2      Lower Median: 2
n=4:    Levitin: 2      Lower Median: 2
n=5:    Levitin: 3      Lower Median: 3
n=6:    Levitin: 3      Lower Median: 3
n=7:    Levitin: 4      Lower Median: 4
n=8:    Levitin: 4      Lower Median: 4
n=9:    Levitin: 5      Lower Median: 5
</pre>
<p>So we've defined the median but actually finding the median is a little more complicated than finding the minimum or maximum so I'll save that for later.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org22b2515">
<h2 id="org22b2515">Sources</h2>
<div class="outline-text-2" id="text-org22b2515">
<ul class="org-ul">
<li><a href="posts/itdaa/index.html">Introduction to the Design & Analysis of Algorithms (Levitin)</a></li>
<li><a href="posts/clrs/index.html">Introduction To Algorithms (CLRS)</a></li>
</ul>
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("minimum"));
});
</script></div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/max-heap/index.html">Heap!</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/max-heap/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-02-08T13:40:58-08:00" itemprop="datePublished" title="2022-02-08 13:40">2022-02-08 13:40</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/max-heap/index.html#orgfc176b7">Beginning</a>
<ul>
<li><a href="posts/max-heap/index.html#orgab9fc42">What's a Heap?</a></li>
<li><a href="posts/max-heap/index.html#org4fe497c">Some Functions</a>
<ul>
<li><a href="posts/max-heap/index.html#org4dfba6c">Some Requirements</a></li>
<li><a href="posts/max-heap/index.html#org9440e63">Heap Properties</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="posts/max-heap/index.html#org58c6f42">The Max Heap</a>
<ul>
<li><a href="posts/max-heap/index.html#orgbf60578">The Imports</a></li>
<li><a href="posts/max-heap/index.html#orge34d1a1">The Class</a>
<ul>
<li><a href="posts/max-heap/index.html#orgde1117d">Imports</a></li>
<li><a href="posts/max-heap/index.html#orgf38e1fb">The Definition</a></li>
<li><a href="posts/max-heap/index.html#org433877d">From List</a></li>
<li><a href="posts/max-heap/index.html#org9e674a3">The Heap Size</a></li>
<li><a href="posts/max-heap/index.html#org4a83d3b">Length</a></li>
<li><a href="posts/max-heap/index.html#org612e0da">Maximum</a></li>
<li><a href="posts/max-heap/index.html#org1268cea">Finding the Parent, Left-Child, and Right-Child of a Node</a></li>
<li><a href="posts/max-heap/index.html#org3742565">Heapify A Sub Tree</a></li>
<li><a href="posts/max-heap/index.html#orgdc42242">The Call</a></li>
<li><a href="posts/max-heap/index.html#org768065f">Increase a Key</a></li>
<li><a href="posts/max-heap/index.html#orgeccb8cc">Insert a Value</a></li>
<li><a href="posts/max-heap/index.html#org53d9d07">Check the Heap Property</a></li>
<li><a href="posts/max-heap/index.html#org2b66a44">Get and Set Item</a></li>
</ul>
</li>
<li><a href="posts/max-heap/index.html#org38fffe8">The Tests</a></li>
</ul>
</li>
<li><a href="posts/max-heap/index.html#org1e99c6c">Heap Sort</a>
<ul>
<li><a href="posts/max-heap/index.html#orgdcf94b0">Imports</a></li>
<li><a href="posts/max-heap/index.html#org6032aca">The Heap Sort Class</a></li>
<li><a href="posts/max-heap/index.html#orgb01712f">The Tests</a></li>
</ul>
</li>
<li><a href="posts/max-heap/index.html#org9794151">A Priority Queue</a>
<ul>
<li><a href="posts/max-heap/index.html#org61e8578">The Tests</a></li>
</ul>
</li>
<li><a href="posts/max-heap/index.html#org5ffdff7">Plotting</a></li>
<li><a href="posts/max-heap/index.html#orgb451d50">End</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgfc176b7">
<h2 id="orgfc176b7">Beginning</h2>
<div class="outline-text-2" id="text-orgfc176b7"></div>
<div class="outline-3" id="outline-container-orgab9fc42">
<h3 id="orgab9fc42">What's a Heap?</h3>
<div class="outline-text-3" id="text-orgab9fc42">
<p>This is a post that looks at <a href="https://en.wikipedia.org/wiki/Heap_(data_structure)">Heaps</a>. According to <a href="posts/clrs/index.html">Introduction To Algorithms (CLRS)</a>, a heap is an array that can be thought of as a nearly complete binary tree which satisfies the <b>Heap Property</b>. There are actually two heap properties, one for a <b>Max Heap</b> and one for a <b>Min Heap</b>.</p>
<ul class="org-ul">
<li><b>Max-Heap Property</b>: \(A[Parent(i)]) \ge A[i]\)</li>
<li><b>Min-Heap Property</b>: \(A[Parent(i)]) \le A[i]\)</li>
</ul>
<p>Which means that for any node in a MaxHeap, its value is greater than or equal to that of any of its children, and for any node in a MinHeap, the node's value is less than or equal to its children.</p>
<p>The heap has (at least) two attributes.</p>
<ul class="org-ul">
<li><i>A.length</i>: the number of elements in the array</li>
<li><i>A.heap-size</i>: the number of elements in the heap (not all elements in the array need to be in the heap)</li>
</ul>
<p>The first element in the heap is the root (for the Max-Heap it is the largest element, for the Min-Heap it is the smallest).</p>
</div>
</div>
<div class="outline-3" id="outline-container-org4fe497c">
<h3 id="org4fe497c">Some Functions</h3>
<div class="outline-text-3" id="text-org4fe497c">
<p>For any Node in the Heap located at <i>i</i>:</p>
<pre id="parent" style="display:hidden;">
\begin{algorithm}
\caption{Parent}
\begin{algorithmic}
\INPUT The index of a Child Node
\OUTPUT The index of the Child's Parent
\PROCEDURE{Parent}{$i$}
 \RETURN {\(\left \lfloor \frac{i}{2} \right \rfloor\)}
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>
<pre id="left" style="display:hidden;">
\begin{algorithm}
\caption{Left}
\begin{algorithmic}
\INPUT The index of a Parent Node
\OUTPUT The index of the Parent's left child node
\PROCEDURE{Left}{$i$}
 \RETURN 2i
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>
<pre id="right" style="display:hidden;">
\begin{algorithm}
\caption{Right}
\begin{algorithmic}
\INPUT The index of a Parent Node
\OUTPUT The index of the Parent's right child node
\PROCEDURE{Right}{$i$}
 \RETURN 2i + 1
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>
<p>These Functions show the relationship between the location of a node and its children in the array that makes up the heap.</p>
</div>
<div class="outline-4" id="outline-container-org4dfba6c">
<h4 id="org4dfba6c">Some Requirements</h4>
<div class="outline-text-4" id="text-org4dfba6c">
<p>There are also two requirements:</p>
<ul class="org-ul">
<li><b>Shape Requirement</b>: All levels but the last have to be complete (only the rightmost leaves can be incomplete)</li>
<li><b>Dominance Requirement</b>: Every node is greater than or equal to its children (in the Max-Heap, less than or equal for the Min-Heap)</li>
</ul>
<p>That Dominance Requirement is also covered by the Heap Property.</p>
</div>
</div>
<div class="outline-4" id="outline-container-org9440e63">
<h4 id="org9440e63">Heap Properties</h4>
<div class="outline-text-4" id="text-org9440e63">
<p>These are from <a href="posts/itdaa/index.html">Introduction to the Design & Analysis of Algorithms (Levitin)</a>.</p>
<ol class="org-ol">
<li>There exists exactly one essentially complete binary tree with <i>n</i> nodes. It's a binary tree so its height is \(\lfloor \log_2 n\rfloor\).</li>
<li>The root of a (Max) Heap always has the largest element.</li>
<li>A node of a heap with all its descendants is also a heap.</li>
<li>A heap implemented as an array with the heap's elements stored at \(1 \ldots n\) can be constructed using:
<ul class="org-ul">
<li>the parental node keys will be the first \(\lfloor \frac{n}{2} \rfloor\) elements while the leaf nodes will be in the last \(\lceil \frac{n}{2} \rceil\) positions</li>
<li>The childern of a parent node at position <i>i</i> will be in positions <i>2i</i> and <i>2i + 1</i>.</li>
<li>The parent of a child node at position <i>i</i> will be in position \(\lfloor \frac{i}{2}\rfloor\).</li>
</ul>
</li>
</ol>
<p>Property four is what was defined in the functions up above. Levitin also gives a slightly different variation on stating the heap property.</p>
<p>\[ H[i] \ge \max{H[2i], H[2i + 1]} \textrm{ for } i= 1, \ldots, \lfloor \frac{n}{2} \rfloor. \]</p>
<p>This is sort of an inversion of the Max-Heap Property stated above. While the Max-Heap Property was given as every node is less than or equal to its parent, this says that every parent is greater than or equal to its children.</p>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org58c6f42">
<h2 id="org58c6f42">The Max Heap</h2>
<div class="outline-text-2" id="text-org58c6f42"></div>
<div class="outline-3" id="outline-container-orgbf60578">
<h3 id="orgbf60578">The Imports</h3>
<div class="outline-text-3" id="text-orgbf60578">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">MutableSequence</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Generator</span>

<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">contain_exactly</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span><span class="p">,</span> <span class="n">raise_error</span>

<span class="c1"># software under test</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.heap</span> <span class="kn">import</span> <span class="n">MaxHeap</span>

<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">EmbedHoloviews</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"max-heap"</span>
<span class="n">path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"files/posts/</span><span class="si">{</span><span class="n">SLUG</span><span class="si">}</span><span class="s2">/"</span>
<span class="n">Embed</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">EmbedHoloviews</span><span class="p">,</span> <span class="n">folder_path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orge34d1a1">
<h3 id="orge34d1a1">The Class</h3>
<div class="outline-text-3" id="text-orge34d1a1"></div>
<div class="outline-4" id="outline-container-orgde1117d">
<h4 id="orgde1117d">Imports</h4>
<div class="outline-text-4" id="text-orgde1117d">
<div class="highlight">
<pre><span></span><span class="c1"># pypi</span>
<span class="c1"># https://www.attrs.org/en/stable/index.html</span>
<span class="kn">from</span> <span class="nn">attrs</span> <span class="kn">import</span> <span class="n">define</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgf38e1fb">
<h4 id="orgf38e1fb">The Definition</h4>
<div class="outline-text-4" id="text-orgf38e1fb">
<p>Besides declaring the class definition, the MaxHeap will hold some constants to hopefully make the code easier to read.</p>
<div class="highlight">
<pre><span></span><span class="nd">@define</span>
<span class="k">class</span> <span class="nc">MaxHeap</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Build and maintain a max-heap</span>

<span class="sd">    If you pass in the heap as a list pre-pend it with Infinity</span>

<span class="sd">    Otherwise use ~heap = MaxHeap.from_list(elements)~ to build it</span>
<span class="sd">    """</span>
    <span class="n">INFINITY</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">"inf"</span><span class="p">)</span>
    <span class="n">NEGATIVE_INFINITY</span> <span class="o">=</span> <span class="o">-</span><span class="n">INFINITY</span>
    <span class="n">ROOT_NODE</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">heap</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="n">INFINITY</span><span class="p">]</span>
    <span class="n">_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org433877d">
<h4 id="org433877d">From List</h4>
<div class="outline-text-4" id="text-org433877d">
<p>This is a class method to create the list for the heap. The calculations for the locations in the array of parent and child nodes is easier if we have a 1-based list so I'll pad the list being passed in. Additionally, I'll set the first value to \(\infty\) so that the Heap Property will pass for the root node without needing any special consideration for what its parent is.</p>
<div class="highlight">
<pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_list</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">heap</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Builds a max-heap instance from the starter list</span>

<span class="sd">    Args:</span>
<span class="sd">     heap: list of elements to dump on the heap</span>

<span class="sd">    Returns:</span>
<span class="sd">     MaxHeap instance with the heap list added</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">heap</span> <span class="o">=</span> <span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">]</span> <span class="o">+</span> <span class="n">heap</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org9e674a3">
<h4 id="org9e674a3">The Heap Size</h4>
<div class="outline-text-4" id="text-org9e674a3">
<p>Since we padded the list holding the heap the length of the list will never be the same as the number of nodes in the heap. Additionally we'll sometimes manipulate things so things that were in the heap are later excluded but still in the list so the <code>size</code> property will help us to keep track of how big we think our heap is.</p>
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""The size of the max heap"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span>

<span class="nd">@size</span><span class="o">.</span><span class="n">setter</span>
<span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_size</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Set the size of the max heap</span>

<span class="sd">    Args:</span>
<span class="sd">     new_size: how much of the list is in the heap</span>

<span class="sd">    Raises:</span>
<span class="sd">     AssertionError if the size is out of bounds for the list</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">new_size</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="n">new_size</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org4a83d3b">
<h4 id="org4a83d3b">Length</h4>
<div class="outline-text-4" id="text-org4a83d3b">
<p>This is the length of the array, not necessarily of the heap. This one's a little tricky, since the padding throws it off by one it would seem that it should be lowered by one, but if you use it to figure out the last index that will mess it up a little. Since we already have the size for the number of nodes I'll just pass the length of the list on and see what happens.</p>
<p>I was debating whether to use <code>__len__</code> but I decided that this is really an internal measure and <code>size</code> is meant to be the attribute to use. I'm mostly keeping this around so that it matches the CLRS attributes.</p>
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">length</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""The size of the array for the heap</span>

<span class="sd">    Warning:</span>
<span class="sd">     This includes the padding at the beginning of the list</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org612e0da">
<h4 id="org612e0da">Maximum</h4>
<div class="outline-text-4" id="text-org612e0da">
<p>Since this is a max-heap the largest element is in the root, this just makes getting it more explicit.</p>
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">maximum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""The value in the root node"""</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ROOT_NODE</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org1268cea">
<h4 id="org1268cea">Finding the Parent, Left-Child, and Right-Child of a Node</h4>
<div class="outline-text-4" id="text-org1268cea">
<p>These are the implementations of the functions at the start of the post.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Find the parent of a node</span>

<span class="sd">    Args:</span>
<span class="sd">     node: the index of the node to check</span>

<span class="sd">    Returns:</span>
<span class="sd">     the index of the parent of the node</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">node</span><span class="o">//</span><span class="mi">2</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">left_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Find the left child of a parent</span>

<span class="sd">    Args:</span>
<span class="sd">     parent: the index of the parent node</span>

<span class="sd">    Returns:</span>
<span class="sd">     index of the left child of the parent</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">parent</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">right_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Find the right child of a parent</span>

<span class="sd">    Args:</span>
<span class="sd">     parent: the index of the parent node</span>

<span class="sd">    Returns:</span>
<span class="sd">     index of the right child of the parent</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">parent</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org3742565">
<h4 id="org3742565">Heapify A Sub Tree</h4>
<div class="outline-text-4" id="text-org3742565">
<p>CLRS just calls this MaxHeapify. But then the bottoms-up heapification of the tree seemed more like it should be called heapify so I called it <code>heapify_subtree</code> to note that it starts at a specific node which might not be the root.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">heapify_subtree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Heapify the tree rooted at the node</span>

<span class="sd">    Args:</span>
<span class="sd">     node: index of the node to compare to its descendants</span>
<span class="sd">    """</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_child</span><span class="p">(</span><span class="n">node</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_child</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="n">largest</span> <span class="o">=</span> <span class="n">node</span>

    <span class="k">if</span> <span class="n">left</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">left</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">largest</span><span class="p">]:</span>
        <span class="c1"># the left child was larger than the current parent node</span>
        <span class="n">largest</span> <span class="o">=</span> <span class="n">left</span>

    <span class="k">if</span> <span class="n">right</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">right</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">largest</span><span class="p">]:</span>
        <span class="c1"># the right child is larger than the left and the current parent</span>
        <span class="n">largest</span> <span class="o">=</span> <span class="n">right</span>

    <span class="k">if</span> <span class="n">largest</span> <span class="o">!=</span> <span class="n">node</span><span class="p">:</span>
        <span class="c1"># the current parent is out of place, swap it with the larger child</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">largest</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">largest</span><span class="p">],</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">])</span>

        <span class="c1"># after the swap the item at "largest" is the value from the </span>
        <span class="c1"># "node" we started with so try it again with this new location</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heapify_subtree</span><span class="p">(</span><span class="n">largest</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgdc42242">
<h4 id="orgdc42242">The Call</h4>
<div class="outline-text-4" id="text-orgdc42242">
<p>This makes the MaxHeap callable and heapifies the entire heap using a bottoms-up construction.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Heapifies the heap</span>

<span class="sd">    Raises:</span>
<span class="sd">     AssertionError: something bad happened and the Heap Property failed</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">//</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heapify_subtree</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">check_rep</span><span class="p">()</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org768065f">
<h4 id="org768065f">Increase a Key</h4>
<div class="outline-text-4" id="text-org768065f">
<p>When we change the value of a node, if the value is higher than the previous value it might be in the wrong place in the heap (e.g. it might be bigger than its parent) so we need to traverse upward, swapping it with parents smaller than it, until we find where it should go. CLRS made it a requirement that the new value is larger than the old one, which makes sense in light of the name <code>IncreaseKey</code>, but it seems to me that you could just call it <code>ChangeKey</code> and use a conditional instead of raise an exception, but I'll stick with the error for now.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">increase_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Increase the node's value</span>

<span class="sd">    Args:</span>
<span class="sd">     node: index of node in heap to change</span>
<span class="sd">     key: new value for the node</span>

<span class="sd">    Raises:</span>
<span class="sd">     AssertionError if new value isn't larger than the previous value</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="n">key</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">],</span> <span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> not greater than previous value </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="o">.</span><span class="n">node</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">node</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROOT_NODE</span> <span class="ow">and</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="n">node</span><span class="p">)]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="n">node</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="n">node</span><span class="p">)],</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">])</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgeccb8cc">
<h4 id="orgeccb8cc">Insert a Value</h4>
<div class="outline-text-4" id="text-orgeccb8cc">
<p>CLRS describes <code>insert</code> and <code>increase_key</code> as part of updating a priority queue, but Levitin's description of <code>top-down heap construction</code> seems to use them as an alternative way to create the heap. He describes this method of construction (top-down) as starting with an empty heap and repeatedly inserting elements from the original array until you have a heap.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Insert the key into the heap</span>

<span class="sd">    Args:</span>
<span class="sd">     key: orderable item to insert into the heap</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NEGATIVE_INFINITY</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">increase_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org53d9d07">
<h4 id="org53d9d07">Check the Heap Property</h4>
<div class="outline-text-4" id="text-org53d9d07">
<p>This checks that the Heap Property holds for all the nodes.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">check_rep</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Checks the heap property</span>

<span class="sd">    Raises:</span>
<span class="sd">     AssertionError: the heap property has been violated</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="n">node</span><span class="p">)]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">],</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">"Parent node </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="n">node</span><span class="p">)]</span><span class="si">}</span><span class="s2"> "</span>
            <span class="sa">f</span><span class="s2">"not &gt;= </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org2b66a44">
<h4 id="org2b66a44">Get and Set Item</h4>
<div class="outline-text-4" id="text-org2b66a44">
<p>I threw these in because I kept forgetting that the heap is an attribute of the MaxHeap, but it's only for convenience.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Gets an item from the heap</span>

<span class="sd">    Args: </span>
<span class="sd">     node: index of the heap to get the value</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>

<span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Sets the value at the node in the heap</span>

<span class="sd">    Args:</span>
<span class="sd">     node: index of the heap to set the value</span>
<span class="sd">     value: what to set the location in the heap to</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org38fffe8">
<h3 id="org38fffe8">The Tests</h3>
<div class="outline-text-3" id="text-org38fffe8">
<div class="highlight">
<pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">max_heap</span> <span class="o">=</span> <span class="n">MaxHeap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">heap</span><span class="o">=</span><span class="n">start</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">max_heap</span><span class="o">.</span><span class="n">heap</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">([</span><span class="n">max_heap</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">]</span> <span class="o">+</span> <span class="n">start</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">max_heap</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">max_heap</span><span class="o">.</span><span class="n">length</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">max_heap</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">max_heap</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">max_heap</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">max_heap</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">max_heap</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">failure</span><span class="p">():</span> <span class="n">max_heap</span><span class="o">.</span><span class="n">check_rep</span><span class="p">()</span>

<span class="n">expect</span><span class="p">(</span><span class="n">failure</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">raise_error</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">max_heap</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">heap</span> <span class="o">=</span> <span class="n">MaxHeap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span>

<span class="n">heap</span><span class="o">.</span><span class="n">heapify_subtree</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">14</span><span class="p">))</span>

<span class="n">heap</span><span class="o">.</span><span class="n">heapify_subtree</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">14</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">]</span>
<span class="n">heap</span> <span class="o">=</span> <span class="n">MaxHeap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
<span class="n">heap</span><span class="p">()</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">40</span><span class="p">))</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span>
<span class="n">heap</span> <span class="o">=</span> <span class="n">MaxHeap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

<span class="n">heap</span><span class="p">()</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org1e99c6c">
<h2 id="org1e99c6c">Heap Sort</h2>
<div class="outline-text-2" id="text-org1e99c6c">
<div class="highlight">
<pre><span></span><span class="o">&lt;&lt;</span><span class="n">heapsort</span><span class="o">-</span><span class="n">imports</span><span class="o">&gt;&gt;</span>

<span class="o">&lt;&lt;</span><span class="n">heap</span><span class="o">-</span><span class="n">sort</span><span class="o">&gt;&gt;</span>
</pre></div>
</div>
<div class="outline-3" id="outline-container-orgdcf94b0">
<h3 id="orgdcf94b0">Imports</h3>
<div class="outline-text-3" id="text-orgdcf94b0">
<div class="highlight">
<pre><span></span><span class="c1"># pypi</span>
<span class="c1"># https://www.attrs.org/en/stable/index.html</span>
<span class="kn">from</span> <span class="nn">attrs</span> <span class="kn">import</span> <span class="n">define</span>

<span class="c1"># this project</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.heap</span> <span class="kn">import</span> <span class="n">MaxHeap</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org6032aca">
<h3 id="org6032aca">The Heap Sort Class</h3>
<div class="outline-text-3" id="text-org6032aca">
<p>The HeapSort uses the fact that a Max Heap always has the largest element at the root and repeatedly puts the root at the end of the list then shrinks the heap so it doesn't include the value that was moved over.</p>
<div class="highlight">
<pre><span></span><span class="nd">@define</span>
<span class="k">class</span> <span class="nc">HeapSort</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Sort using a heap</span>

<span class="sd">    Args:</span>
<span class="sd">     items: collection of items for the sort</span>
<span class="sd">    """</span>
    <span class="n">items</span><span class="p">:</span> <span class="nb">list</span>
    <span class="n">_heap</span><span class="p">:</span> <span class="n">MaxHeap</span><span class="o">=</span><span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">heap</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MaxHeap</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""The heap of items"""</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_heap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_heap</span> <span class="o">=</span> <span class="n">MaxHeap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_heap</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_heap</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">without_root</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""The items without the root """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="o">.</span><span class="n">ROOT_NODE</span><span class="p">:]</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""sorts the items"""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="o">.</span><span class="n">ROOT_NODE</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="o">.</span><span class="n">size</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">heap</span><span class="p">()</span>
        <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgb01712f">
<h3 id="orgb01712f">The Tests</h3>
<div class="outline-text-3" id="text-orgb01712f">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">bowling.sort.heap</span> <span class="kn">import</span> <span class="n">HeapSort</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">items</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
<span class="n">sorter</span> <span class="o">=</span> <span class="n">HeapSort</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>

<span class="n">sorter</span><span class="p">()</span>

<span class="n">items</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="n">expect</span><span class="p">(</span><span class="n">sorter</span><span class="o">.</span><span class="n">without_root</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">items</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org9794151">
<h2 id="org9794151">A Priority Queue</h2>
<div class="outline-text-2" id="text-org9794151">
<p>Although some books mention that MinHeaps are used for priority queues, CLRS shows a MaxHeap version. This involves adding a couple of methods to the MaxHeap so there's no special class.</p>
</div>
<div class="outline-3" id="outline-container-org61e8578">
<h3 id="org61e8578">The Tests</h3>
<div class="outline-text-3" id="text-org61e8578">
<div class="highlight">
<pre><span></span><span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">heap</span> <span class="o">=</span> <span class="n">MaxHeap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
<span class="n">heap</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">failure</span><span class="p">():</span> <span class="n">heap</span><span class="o">.</span><span class="n">increase_key</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">failure</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">raise_error</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">))</span>

<span class="n">heap</span><span class="o">.</span><span class="n">increase_key</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>

<span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span>
<span class="n">heap</span> <span class="o">=</span> <span class="n">MaxHeap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
<span class="n">heap</span><span class="p">()</span>
<span class="n">heap</span><span class="o">.</span><span class="n">increase_key</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="p">[</span><span class="n">heap</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="mi">1</span><span class="p">)])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">15</span><span class="p">))</span>

<span class="n">heap</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org5ffdff7">
<h2 id="org5ffdff7">Plotting</h2>
<div class="outline-text-2" id="text-org5ffdff7">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">networkx</span> <span class="kn">import</span> <span class="n">Graph</span>
<span class="kn">import</span> <span class="nn">holoviews</span>

<span class="n">graph</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">heap</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">heap</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">heap</span><span class="o">.</span><span class="n">length</span><span class="p">:</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">],</span> <span class="n">heap</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">heap</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="n">node</span><span class="p">)])</span>
    <span class="k">if</span> <span class="n">heap</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">heap</span><span class="o">.</span><span class="n">length</span><span class="p">:</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">heap</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">node</span><span class="p">],</span> <span class="n">heap</span><span class="o">.</span><span class="n">heap</span><span class="p">[</span><span class="n">heap</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="n">node</span><span class="p">)])</span>
<span class="n">positions</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">drawing</span><span class="o">.</span><span class="n">nx_pydot</span><span class="o">.</span><span class="n">graphviz_layout</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">prog</span><span class="o">=</span><span class="s2">"dot"</span><span class="p">)</span>

<span class="n">plot</span> <span class="o">=</span> <span class="n">holoviews</span><span class="o">.</span><span class="n">Graph</span><span class="o">.</span><span class="n">from_networkx</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">positions</span><span class="p">)</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"heap-plot"</span><span class="p">)()</span>
</pre></div>
<object data="posts/max-heap/heap-plot.html" height="800" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
<div class="outline-2" id="outline-container-orgb451d50">
<h2 id="orgb451d50">End</h2>
<div class="outline-text-2" id="text-orgb451d50">
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("parent"));
});
</script>
<script>

window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("left"));
});
</script>
<script>

window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("right"));
});
</script></div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/quicksort/index.html">Quicksort</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/quicksort/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-02-02T16:26:27-08:00" itemprop="datePublished" title="2022-02-02 16:26">2022-02-02 16:26</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/quicksort/index.html#orgce22e1d">The Algorithm</a></li>
<li><a href="posts/quicksort/index.html#org29be109">Implementing It</a>
<ul>
<li>
<ul>
<li><a href="posts/quicksort/index.html#orgc4c5dea">Some Imports</a></li>
</ul>
</li>
<li><a href="posts/quicksort/index.html#org647e109">Some Setup</a></li>
<li><a href="posts/quicksort/index.html#org0f5f9b4">The Partition</a></li>
<li><a href="posts/quicksort/index.html#orgbab2f47">Some Checks</a>
<ul>
<li><a href="posts/quicksort/index.html#orgadd6f96">The First Example</a></li>
<li><a href="posts/quicksort/index.html#org12cb51e">The Pivot Is the Biggest Element</a></li>
</ul>
</li>
<li><a href="posts/quicksort/index.html#orga373aeb">The QuickSort</a>
<ul>
<li><a href="posts/quicksort/index.html#orgf8011d9">Check It Out</a></li>
</ul>
</li>
<li><a href="posts/quicksort/index.html#orgf8bb197">Plotting The Quicksort Runtimes</a>
<ul>
<li><a href="posts/quicksort/index.html#org604779d">With Random Input</a></li>
<li><a href="posts/quicksort/index.html#org3552b3d">Worst-Case Input</a></li>
</ul>
</li>
<li><a href="posts/quicksort/index.html#org2c877e4">Looking At the Sort In Progress</a></li>
</ul>
</li>
<li><a href="posts/quicksort/index.html#orgccd375f">End</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgce22e1d">
<h2 id="orgce22e1d">The Algorithm</h2>
<div class="outline-text-2" id="text-orgce22e1d">
<p>I covered the <code>Partition</code> function in <a href="posts/the-partition/index.html">The Road To Partition</a> and now I'll use it to implement a quicksort. This is the <a href="posts/clrs/index.html">CLRS</a> version.</p>
<pre id="the-quicksort" style="display:hidden;">
\begin{algorithm}
\caption{QuickSort}
\begin{algorithmic}
\INPUT An array and left and right locations defining a subarray
\OUTPUT The subarray is sorted

\PROCEDURE{QuickSort}{A, left, right}

\IF {left &lt; right} 

\STATE pivot $\gets$ \textsc{Partition}(A, left, right)
\STATE \textsc{QuickSort}(A, left, pivot - 1)
\STATE \textsc{QuickSort}(A, pivot + 1, right)

\ENDIF
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre></div>
</div>
<div class="outline-2" id="outline-container-org29be109">
<h2 id="org29be109">Implementing It</h2>
<div class="outline-text-2" id="text-org29be109"></div>
<div class="outline-4" id="outline-container-orgc4c5dea">
<h4 id="orgc4c5dea">Some Imports</h4>
<div class="outline-text-4" id="text-orgc4c5dea">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">MutableSequence</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">log2</span>

<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">contain_exactly</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>

<span class="kn">import</span> <span class="nn">altair</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># this project</span>
<span class="kn">from</span> <span class="nn">bowling.sort.insertion</span> <span class="kn">import</span> <span class="n">insertion_sort</span>
<span class="kn">from</span> <span class="nn">bowling.sort.merge</span> <span class="kn">import</span> <span class="n">mergesort</span>

<span class="c1"># other monkey stuff</span>
<span class="kn">from</span> <span class="nn">graeae.visualization.altair_helpers</span> <span class="kn">import</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">save_chart</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">Timer</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org647e109">
<h3 id="org647e109">Some Setup</h3>
<div class="outline-text-3" id="text-org647e109">
<div class="highlight">
<pre><span></span><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">PartitionOutput</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Keeps the output for the partition funcion"""</span>
    <span class="n">pivot</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">count</span><span class="p">:</span> <span class="nb">int</span>

<span class="n">TIMER</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>

<span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"quicksort"</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="n">output_path</span><span class="p">(</span><span class="n">SLUG</span><span class="p">)</span>
<span class="n">save_it</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">save_chart</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org0f5f9b4">
<h3 id="org0f5f9b4">The Partition</h3>
<div class="outline-text-3" id="text-org0f5f9b4">
<p>Even though I implemented it in that other post I didn't make it so it returns counts so we can estimate the runtime so I'll do that here.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">partition</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">,</span>
              <span class="n">left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PartitionOutput</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Partitions the collection around the last element</span>

<span class="sd">    Args:</span>
<span class="sd">     collection: the list to partition</span>
<span class="sd">     left: index of the first element in the sub-list to partition</span>
<span class="sd">     right: index of the last element in the sub-list to partition</span>

<span class="sd">    Returns:</span>
<span class="sd">     PartitionOutput(pivot, count)</span>
<span class="sd">    """</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">pivot_element</span> <span class="o">=</span> <span class="n">collection</span><span class="p">[</span><span class="n">right</span><span class="p">]</span>
    <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">left</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">upper_bound</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">collection</span><span class="p">[</span><span class="n">upper_bound</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">pivot_element</span><span class="p">:</span>
            <span class="n">lower_bound</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="n">lower_bound</span><span class="p">],</span>
             <span class="n">collection</span><span class="p">[</span><span class="n">upper_bound</span><span class="p">])</span> <span class="o">=</span> <span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="n">upper_bound</span><span class="p">],</span>
                                         <span class="n">collection</span><span class="p">[</span><span class="n">lower_bound</span><span class="p">])</span>
    <span class="n">pivot</span> <span class="o">=</span> <span class="n">lower_bound</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="n">pivot</span><span class="p">],</span>
     <span class="n">collection</span><span class="p">[</span><span class="n">right</span><span class="p">])</span> <span class="o">=</span> <span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="n">right</span><span class="p">],</span>
                           <span class="n">collection</span><span class="p">[</span><span class="n">pivot</span><span class="p">])</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">PartitionOutput</span><span class="p">(</span><span class="n">pivot</span><span class="o">=</span><span class="n">pivot</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgbab2f47">
<h3 id="orgbab2f47">Some Checks</h3>
<div class="outline-text-3" id="text-orgbab2f47"></div>
<div class="outline-4" id="outline-container-orgadd6f96">
<h4 id="orgadd6f96">The First Example</h4>
<div class="outline-text-4" id="text-orgadd6f96">
<div class="highlight">
<pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
<span class="n">first_expected_pivot</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">partition</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">pivot</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">first_expected_pivot</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">test</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)))</span>
</pre></div>
<p>And to make sure the sub-list works.</p>
<div class="highlight">
<pre><span></span><span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">999</span><span class="p">,</span> <span class="mi">888</span><span class="p">,</span> <span class="mi">777</span><span class="p">]</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">left</span> <span class="o">+</span> <span class="n">start</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="o">+</span> <span class="n">right</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">partition</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

<span class="c1"># all we did was shift the sub-list to spots to the right</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">pivot</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">first_expected_pivot</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span>

<span class="c1"># only the sub-list should be partitioned</span>
<span class="n">expect</span><span class="p">(</span><span class="n">test</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">expected</span> <span class="o">+</span> <span class="n">right</span><span class="p">)))</span>

<span class="c1"># the count should match our sub-array</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">start</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org12cb51e">
<h4 id="org12cb51e">The Pivot Is the Biggest Element</h4>
<div class="outline-text-4" id="text-org12cb51e">
<div class="highlight">
<pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">partition</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="c1"># the pivot should be the last element</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">pivot</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>

<span class="c1"># nothing changes in the list</span>
<span class="n">expect</span><span class="p">(</span><span class="n">test</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">start</span><span class="p">))</span>

<span class="c1"># once again, count should match the size of the input</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-orga373aeb">
<h3 id="orga373aeb">The QuickSort</h3>
<div class="outline-text-3" id="text-orga373aeb">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">quicksort</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">,</span> <span class="n">left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Recursive quicksort</span>

<span class="sd">    Args:</span>
<span class="sd">     collection: list to sort</span>
<span class="sd">     left: index of start of sub-list in collection to sort</span>
<span class="sd">     right: index of end of sub-list in collection to sort</span>

<span class="sd">    Returns:</span>
<span class="sd">     count of comparisons</span>
<span class="sd">    """</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">left</span> <span class="o">&lt;</span> <span class="n">right</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">partition</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>

        <span class="n">count</span> <span class="o">+=</span> <span class="n">output</span><span class="o">.</span><span class="n">count</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="n">quicksort</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">pivot</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="n">quicksort</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">pivot</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">count</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-orgf8011d9">
<h4 id="orgf8011d9">Check It Out</h4>
<div class="outline-text-4" id="text-orgf8011d9">
<div class="highlight">
<pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">items</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
<span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>

<span class="n">count</span> <span class="o">=</span> <span class="n">quicksort</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"count: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Theoretical Average: </span><span class="si">{</span><span class="n">length</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">log2</span><span class="p">(</span><span class="n">length</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Theoretical Worst: </span><span class="si">{</span><span class="n">length</span><span class="o">**</span><span class="mi">2</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">items</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">start</span><span class="p">))</span>
</pre></div>
<pre class="example">
count: 37
Theoretical Average: 33.22
Theoretical Worst: 100
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgf8bb197">
<h3 id="orgf8bb197">Plotting The Quicksort Runtimes</h3>
<div class="outline-text-3" id="text-orgf8bb197">
<div class="highlight">
<pre><span></span><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">QuicksortOutput</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Holds the output of the quicksort counts"""</span>
    <span class="n">comparisons</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">size</span><span class="p">:</span> <span class="nb">int</span>


<span class="k">def</span> <span class="nf">quicksorter</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QuicksortOutput</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""runs the quicksort and outputs count and size of collection</span>

<span class="sd">    Args:</span>
<span class="sd">     collection: thing to sort</span>

<span class="sd">    Returns:</span>
<span class="sd">     QuicksortOutput(count, size)</span>
<span class="sd">    """</span>
    <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">quicksort</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">QuicksortOutput</span><span class="p">(</span><span class="n">comparisons</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-org604779d">
<h4 id="org604779d">With Random Input</h4>
<div class="outline-text-4" id="text-org604779d">
<div class="highlight">
<pre><span></span><span class="n">things_to_sort</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">))</span> <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">things</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">:</span>
    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">things</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">quick_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
    <span class="n">delayed</span><span class="p">(</span><span class="n">quicksorter</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">)</span>
</pre></div>
<pre class="example">
Started: 2022-02-05 00:57:12.120397
Ended: 2022-02-05 00:57:14.397235
Elapsed: 0:00:02.276838
</pre>
<div class="highlight">
<pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">merge_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
    <span class="n">delayed</span><span class="p">(</span><span class="n">mergesort</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">)</span>
</pre></div>
<pre class="example">
Started: 2022-02-05 00:58:40.087042
Ended: 2022-02-05 00:58:42.326204
Elapsed: 0:00:02.239162
</pre>
<p><b>Note to future self:</b> Pypy is much faster with the python inputs and much slower with numpy inputs.</p>
<div class="highlight">
<pre><span></span><span class="n">counts</span> <span class="o">=</span> <span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">comparisons</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">quick_output</span><span class="p">]</span>
<span class="n">sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">quick_output</span><span class="p">]</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"Size"</span><span class="p">:</span> <span class="n">sizes</span><span class="p">,</span> <span class="s2">"QuickSort"</span><span class="p">:</span> <span class="n">counts</span><span class="p">})</span>
<span class="n">frame</span><span class="p">[</span><span class="s2">"Merge Sort"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">output</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">merge_output</span><span class="p">]</span>

<span class="n">melted</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Size"</span><span class="p">],</span>
                    <span class="n">var_name</span><span class="o">=</span><span class="s2">"Sort Algorithm"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Size"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Sort Algorithm"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Size"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
             <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Comparisons"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
             <span class="s2">"Sort Algorithm"</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"QuickSort vs Merge Sort"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"quicksort-runtime"</span><span class="p">)</span>
</pre></div>
<object data="posts/quicksort/quicksort-runtime.html" height="600" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>I originally had Insertion Sort in the plot too, but it does so poorly that it just squashes both the Merge Sort and Quick Sort runtimes to a flat line. This is kind of an interesting plot. Quick Sort does much, much better than Insertion Sort, but it still doesn't quite keep up with Merge Sort. The trade-off being that Quick Sort does its sorting in place while Merge Sort creates all these temporary copies.</p>
</div>
</div>
<div class="outline-4" id="outline-container-org3552b3d">
<h4 id="org3552b3d">Worst-Case Input</h4>
<div class="outline-text-4" id="text-org3552b3d">
<p>Remember that case in the <a href="posts/the-partition/index.html">the partition</a> post where the last item (the pivot) was the largest item, and how it resulted in nothing being moved around? What if no matter what sub-array you picked, the last item was always the largest? In other words, what if it's already sorted?</p>
<p>For one thing with really big inputs the interpreter throws an error because you've made too many recursive calls, so that tells you that something bad is happening.</p>
<div class="highlight">
<pre><span></span><span class="n">things_to_sort</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">))</span> <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="mi">100</span><span class="p">)]</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">quick_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
    <span class="n">delayed</span><span class="p">(</span><span class="n">quicksorter</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">)</span>
</pre></div>
<pre class="example">
Started: 2022-02-05 01:06:19.614254
Ended: 2022-02-05 01:06:20.159874
Elapsed: 0:00:00.545620
</pre>
<div class="highlight">
<pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">merge_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
    <span class="n">delayed</span><span class="p">(</span><span class="n">mergesort</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">)</span>
</pre></div>
<pre class="example">
Started: 2022-02-05 01:06:23.592928
Ended: 2022-02-05 01:06:23.661150
Elapsed: 0:00:00.068222
</pre>
<p><b>Note to future self:</b> Pypy is much faster with the python inputs and much slower with numpy inputs.</p>
<div class="highlight">
<pre><span></span><span class="n">counts</span> <span class="o">=</span> <span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">comparisons</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">quick_output</span><span class="p">]</span>
<span class="n">sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">size</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">quick_output</span><span class="p">]</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"Size"</span><span class="p">:</span> <span class="n">sizes</span><span class="p">,</span> <span class="s2">"QuickSort"</span><span class="p">:</span> <span class="n">counts</span><span class="p">})</span>
<span class="n">frame</span><span class="p">[</span><span class="s2">"Merge Sort"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">output</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">merge_output</span><span class="p">]</span>

<span class="n">melted</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Size"</span><span class="p">],</span>
                    <span class="n">var_name</span><span class="o">=</span><span class="s2">"Sort Algorithm"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Size"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Sort Algorithm"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Size"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
             <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Comparisons"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
             <span class="s2">"Sort Algorithm"</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"QuickSort vs Merge Sort (Worst-Case)"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"quicksort-runtime-worst"</span><span class="p">)</span>
</pre></div>
<object data="posts/quicksort/quicksort-runtime-worst.html" height="600" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
</div>
<div class="outline-3" id="outline-container-org2c877e4">
<h3 id="org2c877e4">Looking At the Sort In Progress</h3>
<div class="outline-text-3" id="text-org2c877e4">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">quicksort_tracer</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">,</span>
                     <span class="n">left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">tracer</span><span class="p">:</span> <span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Recursive quicksort</span>

<span class="sd">    Args:</span>
<span class="sd">     collection: list to sort</span>
<span class="sd">     left: index of start of sub-list in collection to sort</span>
<span class="sd">     right: index of end of sub-list in collection to sort</span>
<span class="sd">     tracer: dict of element: list of locations</span>

<span class="sd">    Returns:</span>
<span class="sd">     tracer dict</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">tracer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tracer</span> <span class="o">=</span> <span class="p">{</span><span class="n">element</span><span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">collection</span><span class="p">)}</span>

    <span class="k">if</span> <span class="n">left</span> <span class="o">&lt;</span> <span class="n">right</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">partition</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>

        <span class="n">quicksort_tracer</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">pivot</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tracer</span><span class="p">)</span>
        <span class="n">quicksort_tracer</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">pivot</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">tracer</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">collection</span><span class="p">):</span>
            <span class="n">tracer</span><span class="p">[</span><span class="n">element</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tracer</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">size</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">start</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">inputs</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

<span class="n">tracer</span> <span class="o">=</span> <span class="n">quicksort_tracer</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tracer</span><span class="p">)</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"Quicksort Call"</span><span class="p">})</span>
<span class="n">melted</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Quicksort Call"</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">"Element"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Location"</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Quicksort Call"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Location"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Element"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"Quicksort Call"</span><span class="p">,</span> <span class="s2">"Location"</span><span class="p">,</span> <span class="s2">"Element"</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Quicksort Trace (Reversed Input)"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"quicksort-trace-backwards"</span><span class="p">)</span>
</pre></div>
<object data="posts/quicksort/quicksort-trace-backwards.html" height="600" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<div class="highlight">
<pre><span></span><span class="n">size</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">start</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

<span class="n">tracer</span> <span class="o">=</span> <span class="n">quicksort_tracer</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tracer</span><span class="p">)</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"Quicksort Call"</span><span class="p">})</span>
<span class="n">melted</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Quicksort Call"</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">"Element"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Location"</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Quicksort Call"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Location"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Element"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"Quicksort Call"</span><span class="p">,</span> <span class="s2">"Location"</span><span class="p">,</span> <span class="s2">"Element"</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Quicksort Trace (Shuffled Input)"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"quicksort-trace-shuffled"</span><span class="p">)</span>
</pre></div>
<object data="posts/quicksort/quicksort-trace-shuffled.html" height="600" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
</div>
<div class="outline-2" id="outline-container-orgccd375f">
<h2 id="orgccd375f">End</h2>
<div class="outline-text-2" id="text-orgccd375f">
<ul class="org-ul">
<li><a href="posts/clrs/index.html">Introduction To Algorithms (CLRS)</a></li>
<li><a href="posts/itdaa/index.html">Introduction to the Design & Analysis of Algorithms (Levitin)</a></li>
</ul>
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("the-quicksort"));
});
</script></div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/the-master-theorem/index.html">The Master Theorem</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/the-master-theorem/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-01-26T14:12:02-08:00" itemprop="datePublished" title="2022-01-26 14:12">2022-01-26 14:12</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div class="outline-2" id="outline-container-orgf8afd42">
<h2 id="orgf8afd42">The General Divide and Conquer Recurrence</h2>
<div class="outline-text-2" id="text-orgf8afd42">
<p>When we have a <a href="posts/divide-and-conquer/index.html">Divide and Conquer</a> algorithm that we solve via recursion we can estimate the running time using the <b>General Divide and Conquer Recurrence</b>.</p>
<ul class="org-ul">
<li>\(T(n)\) is the total runtime.</li>
<li>\(n\) is the size of the problem (the number of instances in the input).</li>
<li>\(a\) is the number of the sub-problems that we create that need to be solved.</li>
<li>\(b\) is the number of sub-problems we create (we'll mostly see cases where \(a=b=2\)).</li>
<li>\(f(n)\) is the time spent dividing the problem and later recombining the sub-problems.</li>
</ul>
<p>Which we combine into this equation.</p>
<p>\[ T(n) = aT \left(\frac{n}{b} \right) + f(n) \]</p>
</div>
</div>
<div class="outline-2" id="outline-container-org47653c0">
<h2 id="org47653c0">The Master Theorem</h2>
<div class="outline-text-2" id="text-org47653c0">
<p>In the case where \(f(n) \in \Theta \left (n^d \right)\) and \(d â‰¥ 0\) (so it's either 1 or a power of n), we can use the following conditional cases to estimate the runtime.</p>
<p>\[ T(n) \in \begin{cases} \Theta\left (n^d \right ) & \textrm{if }a &lt; b^d \\ \Theta\left (n^d \log n \right ) & \textrm{if }a = b^d \\ \Theta\left (n^{\log_b a} \right) & \textrm{if }a &gt; b^d \end{cases} \]</p>
</div>
</div>
<div class="outline-2" id="outline-container-org27d4312">
<h2 id="org27d4312">Source</h2>
<div class="outline-text-2" id="text-org27d4312">
<ul class="org-ul">
<li><a href="posts/itdaa/index.html">Introduction to the Design & Analysis of Algorithms (Levitin)</a></li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/the-mergesort/index.html">The Mergesort</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/the-mergesort/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-01-25T17:49:38-08:00" itemprop="datePublished" title="2022-01-25 17:49">2022-01-25 17:49</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/the-mergesort/index.html#org6272423">Beginning</a></li>
<li><a href="posts/the-mergesort/index.html#org5b91fae">Middle</a>
<ul>
<li><a href="posts/the-mergesort/index.html#org11a1d76">The CLRS Algorithm</a></li>
<li><a href="posts/the-mergesort/index.html#org9476670">Runtime</a></li>
<li><a href="posts/the-mergesort/index.html#org96058a0">The Levitin</a>
<ul>
<li><a href="posts/the-mergesort/index.html#org9505a84">Implement It</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="posts/the-mergesort/index.html#org27194ee">Comparing Sorts</a></li>
<li><a href="posts/the-mergesort/index.html#orgc80018a">Looking at the Mergesort</a>
<ul>
<li><a href="posts/the-mergesort/index.html#org502dede">A Shuffle Input</a></li>
<li><a href="posts/the-mergesort/index.html#org7f4a78d">A Reversed Input</a></li>
</ul>
</li>
<li><a href="posts/the-mergesort/index.html#orga545426">End</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org6272423">
<h2 id="org6272423">Beginning</h2>
<div class="outline-text-2" id="text-org6272423">
<p>This is a look at the <a href="https://en.wikipedia.org/wiki/Merge_sort"><i>Mergesort</i></a>, an example of the <a href="posts/divide-and-conquer/index.html">Divide and Conquer</a> strategy for sorting collections.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org5b91fae">
<h2 id="org5b91fae">Middle</h2>
<div class="outline-text-2" id="text-org5b91fae"></div>
<div class="outline-3" id="outline-container-org11a1d76">
<h3 id="org11a1d76">The CLRS Algorithm</h3>
<div class="outline-text-3" id="text-org11a1d76">
<p>Our <i>Mergesort</i> repeatedly divides the given list into two parts and then recursively calls itself with the sub-problems and then takes advantage of our previously defined <a href="posts/the-merge/index.html">Merge</a> function to combine the solutions together once we are down to one item to sort (\(p = r\)).</p>
<pre id="the-mergesort" style="display:hidden;">
\begin{algorithm}
\caption{Mergesort}
\begin{algorithmic}
\INPUT An array and left and right locations of the subarray in the array
\OUTPUT The array in sorted order

\PROCEDURE{Mergesort}{$A, p, r$}
\IF {p &lt; r}
         \STATE \textbf{Divide}
         \STATE $q \gets \left \lfloor \frac{p + r}{2} \right \rfloor$
         
         \STATE \\ \textbf{Conquer}
         \STATE \textsc{MergeSort}(A, p, q)
         \STATE \textsc{MergeSort}(A, q + 1, r)

         \STATE \\ \textbf{Combine}
         \STATE \textsc{Merge}(A, p, q, r)
\ENDIF
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre></div>
</div>
<div class="outline-3" id="outline-container-org9476670">
<h3 id="org9476670">Runtime</h3>
<div class="outline-text-3" id="text-org9476670">
<ul class="org-ul">
<li><b>Divide:</b> \(D(n) = \Theta(1)\)</li>
<li><b>Conquer:</b> \(2T\left (\frac{n}{2}\right)\)</li>
<li><b>Combine:</b> \(C(n) = \Theta(n)\)</li>
</ul>
\begin{align} T(n) &amp;= 2T \left( \frac{n}{2} \right) + \Theta(1) + \Theta(n) \\ &amp;= 2T \left( \frac{n}{2} \right) + \Theta(n) \\ &amp;= \Theta(n \log_2 n) \end{align}</div>
</div>
<div class="outline-3" id="outline-container-org96058a0">
<h3 id="org96058a0">The Levitin</h3>
<div class="outline-text-3" id="text-org96058a0">
<pre id="the-mergesort-levitin" style="display:hidden;">
\begin{algorithm}
\caption{Levitin's Mergesort}
\begin{algorithmic}
\INPUT Array $A[0 \ldots n - 1]$ of orderable elements.
\OUTPUT Array $A[0 \ldots n - 1]$ sorted in non-decreasing order.

\PROCEDURE{MergeSort}{A}
\IF {n &gt; 1}
         \STATE \textbf{Divide}
         \STATE Copy $A\left[0 \ldots \left\lfloor \frac{n}{2} \right\rfloor - 1 \right]$ to $B \left[0 \ldots \left\lfloor \frac{n}{2} \right\rfloor - 1 \right]$
         \STATE Copy $A \left[\left\lfloor \frac{n}{2}\right\rfloor \ldots n - 1 \right]$ to $C \left[0 \ldots \left\lfloor \frac{n}{2} \right\rfloor - 1 \right]$
         
         \STATE \\ \textbf{Conquer}
         \STATE \textsc{MergeSort}(B)
         \STATE \textsc{MergeSort}(C)

         \STATE \\ \textbf{Combine}
         \STATE \textsc{Merge}(B, C, A)
\ENDIF
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre></div>
<div class="outline-4" id="outline-container-org9505a84">
<h4 id="org9505a84">Implement It</h4>
<div class="outline-text-4" id="text-org9505a84">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">MutableSequence</span><span class="p">,</span> <span class="n">Sequence</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">log2</span>

<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">contain_exactly</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">left_stack</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">,</span>
          <span class="n">right_stack</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">,</span>
          <span class="n">target</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Merges values from left and right stacks into target collection</span>

<span class="sd">    Args:</span>
<span class="sd">     left_stack: sorted collection of items to merge</span>
<span class="sd">     right_stack: sorted collection of items to merge</span>
<span class="sd">     target: collection into which to merge the items</span>

<span class="sd">    Returns:</span>
<span class="sd">     count of basic operations</span>
<span class="sd">    """</span>
    <span class="n">left_size</span><span class="p">,</span> <span class="n">right_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">left_stack</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">right_stack</span><span class="p">)</span>
    <span class="n">next_left</span> <span class="o">=</span> <span class="n">next_right</span> <span class="o">=</span> <span class="n">put_item_here</span> <span class="o">=</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="n">next_left</span> <span class="o">&lt;</span> <span class="n">left_size</span> <span class="ow">and</span> <span class="n">next_right</span> <span class="o">&lt;</span> <span class="n">right_size</span><span class="p">:</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">left_stack</span><span class="p">[</span><span class="n">next_left</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">right_stack</span><span class="p">[</span><span class="n">next_right</span><span class="p">]:</span>
            <span class="n">target</span><span class="p">[</span><span class="n">put_item_here</span><span class="p">]</span> <span class="o">=</span> <span class="n">left_stack</span><span class="p">[</span><span class="n">next_left</span><span class="p">]</span>
            <span class="n">next_left</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">target</span><span class="p">[</span><span class="n">put_item_here</span><span class="p">]</span> <span class="o">=</span> <span class="n">right_stack</span><span class="p">[</span><span class="n">next_right</span><span class="p">]</span>
            <span class="n">next_right</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">put_item_here</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">next_left</span> <span class="o">==</span> <span class="n">left_size</span> <span class="ow">and</span> <span class="n">next_right</span> <span class="o">&lt;</span> <span class="n">right_size</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">stack_offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">left_size</span> <span class="o">+</span> <span class="n">right_size</span> <span class="o">-</span> <span class="n">put_item_here</span><span class="p">):</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">target</span><span class="p">[</span><span class="n">put_item_here</span> <span class="o">+</span> <span class="n">stack_offset</span><span class="p">]</span> <span class="o">=</span> <span class="n">right_stack</span><span class="p">[</span><span class="n">next_right</span> <span class="o">+</span> <span class="n">stack_offset</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">next_left</span> <span class="o">&lt;</span> <span class="n">left_size</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">stack_offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">left_size</span> <span class="o">+</span> <span class="n">right_size</span> <span class="o">-</span> <span class="n">put_item_here</span><span class="p">):</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">target</span><span class="p">[</span><span class="n">put_item_here</span> <span class="o">+</span> <span class="n">stack_offset</span><span class="p">]</span> <span class="o">=</span> <span class="n">left_stack</span><span class="p">[</span><span class="n">next_left</span> <span class="o">+</span> <span class="n">stack_offset</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">count</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">mergesort</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Sorts the collection using a recursive mergesort</span>

<span class="sd">    Args:</span>
<span class="sd">     collection: a mutable sequence</span>

<span class="sd">    Returns:</span>
<span class="sd">     runtime count</span>
<span class="sd">    """</span>
    <span class="n">items</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">items</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">middle</span> <span class="o">=</span> <span class="n">items</span><span class="o">//</span><span class="mi">2</span>
        <span class="n">left_stack</span> <span class="o">=</span> <span class="n">collection</span><span class="p">[:</span><span class="n">middle</span><span class="p">]</span>
        <span class="n">right_stack</span> <span class="o">=</span> <span class="n">collection</span><span class="p">[</span><span class="n">middle</span><span class="p">:]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">left_stack</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">right_stack</span><span class="p">)</span> <span class="o">==</span> <span class="n">items</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="n">mergesort</span><span class="p">(</span><span class="n">left_stack</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="n">mergesort</span><span class="p">(</span><span class="n">right_stack</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="n">merge</span><span class="p">(</span><span class="n">left_stack</span><span class="p">,</span> <span class="n">right_stack</span><span class="p">,</span> <span class="n">collection</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">count</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">size</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">10</span>
<span class="n">items</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)),</span> <span class="n">k</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
<span class="n">starting</span> <span class="o">=</span> <span class="n">items</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">runtime</span> <span class="o">=</span> <span class="n">mergesort</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">runtime</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">size</span> <span class="o">*</span> <span class="n">log2</span><span class="p">(</span><span class="n">size</span><span class="p">)))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">items</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">starting</span><span class="p">))))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">size</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">log2</span><span class="p">(</span><span class="n">size</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">runtime</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
10,240.0
10,240
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org27194ee">
<h2 id="org27194ee">Comparing Sorts</h2>
<div class="outline-text-2" id="text-org27194ee">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">njit</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>

<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">default_rng</span>

<span class="kn">import</span> <span class="nn">altair</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># this project</span>
<span class="kn">from</span> <span class="nn">bowling.sort.insertion</span> <span class="kn">import</span> <span class="n">insertion_sort</span>

<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">Timer</span>
<span class="kn">from</span> <span class="nn">graeae.visualization.altair_helpers</span> <span class="kn">import</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">save_chart</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">numba_random</span> <span class="o">=</span> <span class="n">default_rng</span><span class="p">(</span><span class="mi">2022</span><span class="p">)</span>
<span class="n">TIMER</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>

<span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"the-mergesort"</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="n">output_path</span><span class="p">(</span><span class="n">SLUG</span><span class="p">)</span>
<span class="n">save_it</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">save_chart</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">merger</span><span class="p">(</span><span class="n">thing_to_sort</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""A thing to add the size of the input to the output</span>

<span class="sd">    Args:</span>
<span class="sd">     thing_to_sort: collection of items to sort</span>

<span class="sd">    Returns:</span>
<span class="sd">     number of things to sort, count of merges</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">thing_to_sort</span><span class="p">),</span> <span class="n">mergesort</span><span class="p">(</span><span class="n">thing_to_sort</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">ninsertion</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="n">insertion_sort</span><span class="p">)</span>

<span class="n">things_to_sort</span> <span class="o">=</span> <span class="p">[</span><span class="n">numba_random</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>
                  <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)]</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">insertion_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
        <span class="n">delayed</span><span class="p">(</span><span class="n">ninsertion</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">)</span>
</pre></div>
<pre class="example">
Started: 2022-01-28 01:12:10.628102
Ended: 2022-01-28 01:12:22.681161
Elapsed: 0:00:12.053059
</pre>
<div class="highlight">
<pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">merge_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
        <span class="n">delayed</span><span class="p">(</span><span class="n">merger</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">)</span>
</pre></div>
<pre class="example">
Started: 2022-01-28 01:12:33.278574
Ended: 2022-01-28 01:12:38.850064
Elapsed: 0:00:05.571490
</pre>
<div class="highlight">
<pre><span></span><span class="n">SIZE</span><span class="p">,</span> <span class="n">COMPARISONS</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
<span class="n">unzipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">merge_output</span><span class="p">))</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"Size"</span><span class="p">:</span> <span class="n">unzipped</span><span class="p">[</span><span class="n">SIZE</span><span class="p">],</span>
<span class="s2">"Mergesort"</span><span class="p">:</span> <span class="n">unzipped</span><span class="p">[</span><span class="n">COMPARISONS</span><span class="p">]})</span>

<span class="n">unzipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">insertion_output</span><span class="p">))</span>
<span class="n">frame</span><span class="p">[</span><span class="s2">"Insertion Sort"</span><span class="p">]</span> <span class="o">=</span> <span class="n">unzipped</span><span class="p">[</span><span class="n">COMPARISONS</span><span class="p">]</span>

<span class="n">melted</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Size"</span><span class="p">],</span>
                    <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Mergesort"</span><span class="p">,</span> <span class="s2">"Insertion Sort"</span><span class="p">],</span>
                    <span class="n">var_name</span><span class="o">=</span><span class="s2">"Sort Algorithm"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Size"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Sort Algorithm"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Size"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
             <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Comparisons"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
             <span class="s2">"Sort Algorithm"</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Insertion vs Merge Sort"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"insertion-vs-merge"</span><span class="p">)</span>
</pre></div>
<object data="posts/the-mergesort/insertion-vs-merge.html" height="600" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<div class="highlight">
<pre><span></span><span class="n">frame</span><span class="p">[</span><span class="s2">"nlog2(n)"</span><span class="p">]</span> <span class="o">=</span> <span class="n">frame</span><span class="p">[</span><span class="s2">"Size"</span><span class="p">]</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">frame</span><span class="p">[</span><span class="s2">"Size"</span><span class="p">])</span>
<span class="k">del</span><span class="p">(</span><span class="n">frame</span><span class="p">[</span><span class="s2">"Insertion Sort"</span><span class="p">])</span>
<span class="n">melted</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Size"</span><span class="p">],</span>
                    <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Mergesort"</span><span class="p">,</span> <span class="s2">"nlog2(n)"</span><span class="p">],</span>
                    <span class="n">var_name</span><span class="o">=</span><span class="s2">"Source"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Size"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Source"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Size"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
             <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Comparisons"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
             <span class="s2">"Source"</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Merge Sort vs Theoretical"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"merge-by-logn"</span><span class="p">)</span>
</pre></div>
<object data="posts/the-mergesort/merge-by-logn.html" height="600" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
<div class="outline-2" id="outline-container-orgc80018a">
<h2 id="orgc80018a">Looking at the Mergesort</h2>
<div class="outline-text-2" id="text-orgc80018a">
<p>The version of mergesort I implemented above is based on Levitin's algorithm, which I thought was clearer, since the copying was happening outside of the merge. This makes it harder to plot the progress of the sort, though, so I'm going to use the CLRS algorithm here to get some kind of visualization (hopefully).</p>
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">bowling.sort.merge</span> <span class="kn">import</span> <span class="n">merge_clrs</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">mergesort_tracer</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">,</span> <span class="n">left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                     <span class="n">tracer</span><span class="p">:</span> <span class="nb">dict</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Sorts the collection using a recursive mergesort</span>

<span class="sd">    This uses the CLRS merge-sort to build dict of the locations of the</span>
<span class="sd">    elements as the merging is done</span>

<span class="sd">    Args:</span>
<span class="sd">     collection: a mutable sequence</span>
<span class="sd">     left: the index of the beginning element of the sub-array</span>
<span class="sd">     right: the index of the ending element of the sub-array</span>
<span class="sd">     tracer: the dictionary to track the indices of the items</span>

<span class="sd">    Returns:</span>
<span class="sd">     tracer updated with post-merge locations of the items in tracer</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">tracer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tracer</span> <span class="o">=</span> <span class="p">{</span><span class="n">element</span><span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">collection</span><span class="p">)}</span>

    <span class="k">if</span> <span class="n">left</span> <span class="o">&lt;</span> <span class="n">right</span><span class="p">:</span>
        <span class="n">middle</span> <span class="o">=</span> <span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
        <span class="n">mergesort_tracer</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">middle</span><span class="p">,</span> <span class="n">tracer</span><span class="p">)</span>
        <span class="n">mergesort_tracer</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">middle</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">tracer</span><span class="p">)</span>
        <span class="n">merge_clrs</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">middle</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">collection</span><span class="p">):</span>
            <span class="n">tracer</span><span class="p">[</span><span class="n">element</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tracer</span>
</pre></div>
</div>
<div class="outline-3" id="outline-container-org502dede">
<h3 id="org502dede">A Shuffle Input</h3>
<div class="outline-text-3" id="text-org502dede">
<div class="highlight">
<pre><span></span><span class="n">elements</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">start</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">elements</span><span class="p">))</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">tracer</span> <span class="o">=</span> <span class="n">mergesort_tracer</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">start</span><span class="p">))</span>

<span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tracer</span><span class="p">)</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"Merge"</span><span class="p">})</span>
<span class="n">melted</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Merge"</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">"Element"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Location"</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Merge"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">tickMinStep</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Location"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">tickMinStep</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span>
    <span class="n">color</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">"Element"</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"Merge"</span><span class="p">,</span> <span class="s2">"Location"</span><span class="p">,</span> <span class="s2">"Element"</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Mergesort Tracing"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"mergesort-trace"</span><span class="p">)</span>
</pre></div>
<object data="posts/the-mergesort/mergesort-trace.html" height="600" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>You can kind of see what's going on, every time you see a bunch of crossed lines it's because the merge moved items aroundâ€¦ but maybe an artificial case will be clearer.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org7f4a78d">
<h3 id="org7f4a78d">A Reversed Input</h3>
<div class="outline-text-3" id="text-org7f4a78d">
<p>Let's use an input that's sorted but backwards to see the swaps more clearly.</p>
<div class="highlight">
<pre><span></span><span class="n">elements</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">start</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">elements</span><span class="p">))</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">inputs</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
<span class="n">tracer</span> <span class="o">=</span> <span class="n">mergesort_tracer</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">start</span><span class="p">))</span>

<span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tracer</span><span class="p">)</span>
<span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"Merge"</span><span class="p">})</span>
<span class="n">melted</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Merge"</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">"Element"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Location"</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Merge"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">tickMinStep</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Location"</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">tickMinStep</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span>
    <span class="n">color</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s2">"Element"</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"Merge"</span><span class="p">,</span> <span class="s2">"Location"</span><span class="p">,</span> <span class="s2">"Element"</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Mergesort Tracing (From Backwards Source)"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"mergesort-trace-backwards"</span><span class="p">)</span>
</pre></div>
<object data="posts/the-mergesort/mergesort-trace-backwards.html" height="600" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
</div>
<div class="outline-2" id="outline-container-orga545426">
<h2 id="orga545426">End</h2>
<div class="outline-text-2" id="text-orga545426">
<ul class="org-ul">
<li><a href="posts/clrs/index.html">Introduction To Algorithms (CLRS)</a></li>
<li><a href="posts/itdaa/index.html">Introduction to the Design & Analysis of Algorithms (Levitin)</a></li>
</ul>
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("the-mergesort"));
});
</script>
<script>

window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("the-mergesort-levitin"));
});
</script></div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/divide-and-conquer/index.html">Divide and Conquer</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/divide-and-conquer/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-01-25T17:12:58-08:00" itemprop="datePublished" title="2022-01-25 17:12">2022-01-25 17:12</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div class="outline-2" id="outline-container-org1fee4d7">
<h2 id="org1fee4d7">Description</h2>
<div class="outline-text-2" id="text-org1fee4d7">
<p>The Divide-and-Conquer approach involves three parts.</p>
<ul class="org-ul">
<li><b>Divide:</b> Break the problem up into sub-problems that are smaller instances of the same problem.</li>
<li><b>Conquer:</b> If the problem is small enough solve it, otherwise recursively solve the sub-problem.</li>
<li><b>Combine:</b> Combine the solutions to the sub-problems into a solution for the original problem.</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org7fcd8a9">
<h2 id="org7fcd8a9">See</h2>
<div class="outline-text-2" id="text-org7fcd8a9">
<ul class="org-ul">
<li><a href="posts/clrs/index.html">Introduction To Algorithms (CLRS)</a></li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/the-merge/index.html">The Merge</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/the-merge/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-01-23T17:32:22-08:00" itemprop="datePublished" title="2022-01-23 17:32">2022-01-23 17:32</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/the-merge/index.html#org70ec4b5">The Merge</a>
<ul>
<li><a href="posts/the-merge/index.html#org2d6a109">CLRS</a>
<ul>
<li><a href="posts/the-merge/index.html#org96cb47f">Implement It</a></li>
<li><a href="posts/the-merge/index.html#orgaff8807">Runtime</a></li>
</ul>
</li>
<li><a href="posts/the-merge/index.html#org2799028">Levitin</a>
<ul>
<li><a href="posts/the-merge/index.html#org4dacec7">Implement It</a></li>
<li><a href="posts/the-merge/index.html#orgf9e97a0">Runtime</a></li>
</ul>
</li>
<li><a href="posts/the-merge/index.html#org87bb515">A Hybrid</a></li>
</ul>
</li>
<li><a href="posts/the-merge/index.html#org9b90b42">End</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org70ec4b5">
<h2 id="org70ec4b5">The Merge</h2>
<div class="outline-text-2" id="text-org70ec4b5">
<p>This is an implementation of the merge portion of the merge-sort. It takes two sorted sections of a collection and merges them together in place.</p>
</div>
<div class="outline-3" id="outline-container-org2d6a109">
<h3 id="org2d6a109">CLRS</h3>
<div class="outline-text-3" id="text-org2d6a109">
<p>The precondition for this to work is that there are two sections within the array passed in to the algorithm that are already sorted and that they are located by the three index-values given to the algorithm. The first sorted section starts at <code>p</code> and ends at <code>q</code> in the array and the second sorted section starts at <code>q + 1</code> and ends at <code>r</code> within the array.</p>
<p>This is the CLRS version with the indexing changed to start at 0.</p>
<pre id="the-merge" style="display:hidden;">
\begin{algorithm}
\caption{Merge}
\begin{algorithmic}
\INPUT An array and left, middle, and right locations in the array
\REQUIRE Sub-arrays from $p$ to $q$ and from $q + 1$ to $r$ are sorted
\OUTPUT The array with the two sections collated in order

\PROCEDURE{Merge}{$A, p, q, r$}

\STATE \textbf{The sizes of the sub-sections}
\STATE $n_1 \gets q - p + 1$
\STATE $n_2 \gets r - q$

\STATE \\ \textbf{Copy the subsections to new arrays.}
\STATE \textit{New arrays have one extra cell to hold a sentinel.}
\STATE $L \gets Array[0\ldots n_1]$
\STATE $R \gets Array[0 \ldots n_2]$

\FOR {$i \in {0 \ldots n_1 - 1}$}
  \STATE $L[i] \gets A[p + i - 1]$
\ENDFOR

\FOR{$j \in {0 \ldots n_2 - 1}$}
  \STATE $R[j] \gets A[q + j]$
\ENDFOR

\STATE \\ \textbf{Add sentinel to indicate end}
\STATE $L[n_1] \gets \infty $
\STATE $R[n_2] \gets \infty $

\STATE \\ \textbf{Collate}
\STATE $i \gets 0$
\STATE $j \gets 0$

\FOR {$k \in {p \ldots r}$}
 \IF {$L[i] \leq R[j]$}
   \STATE $A[k] \gets L[i]$
   \STATE $i' \gets i + 1$
 \ELSE
  \STATE $A[k] \gets R[j]$
  \STATE $j' \gets j + 1$
\ENDIF
\ENDFOR
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>
<p>One way to think about how the algorithm is like you have two stacks of cards, each of which is sorted and you want to merge them together in sorted order. Since they are already sorted, you only have to compare the top cards on the two stacks to each other, chose the lower card and put it in your output stack, and keep repeating this until you've moved all the cards from the two stacks to the output. If one stack runs out of cards you just move the other remaining cards onto the output stack.</p>
<p>Our algorithm starts by copying out the values from the source array into two new arrays to create our stacks. We append an \(\infty\) onto the end of each to simulate the emptying of the stack. Then we keep looking at the top item in each stack and copying the smaller item back into the original array. Because of the copying we are going over the input twice, but that is a relatively small (linear) increase.</p>
</div>
<div class="outline-4" id="outline-container-org96cb47f">
<h4 id="org96cb47f">Implement It</h4>
<div class="outline-text-4" id="text-org96cb47f">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">MutableSequence</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">contain_exactly</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">INFINITY</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">"inf"</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">merge_clrs</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">,</span>
          <span class="n">left_start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
          <span class="n">left_end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
          <span class="n">right_end</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Merge the sub-sections from the collection</span>

<span class="sd">    Args:</span>
<span class="sd">     collection: list or array with sorted sub-sections</span>
<span class="sd">     left_start: index of start of first sub-section</span>
<span class="sd">     left_end: index of last item of first sub-section</span>
<span class="sd">     right_end: index of the last item of second sub-section</span>
<span class="sd">    """</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">left_size</span> <span class="o">=</span> <span class="n">left_end</span> <span class="o">-</span> <span class="n">left_start</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">right_size</span> <span class="o">=</span> <span class="n">right_end</span> <span class="o">-</span> <span class="n">left_end</span>
    <span class="n">right_start</span> <span class="o">=</span> <span class="n">left_end</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">left_stack</span> <span class="o">=</span> <span class="p">([</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">left_size</span><span class="p">)</span>
    <span class="n">right_stack</span> <span class="o">=</span> <span class="p">([</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">right_size</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">stack_location</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">left_size</span><span class="p">):</span>
        <span class="n">left_stack</span><span class="p">[</span><span class="n">stack_location</span><span class="p">]</span> <span class="o">=</span> <span class="n">collection</span><span class="p">[</span><span class="n">left_start</span> <span class="o">+</span> <span class="n">stack_location</span><span class="p">]</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">stack_location</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">right_size</span><span class="p">):</span>
        <span class="n">right_stack</span><span class="p">[</span><span class="n">stack_location</span><span class="p">]</span> <span class="o">=</span> <span class="n">collection</span><span class="p">[</span><span class="n">right_start</span> <span class="o">+</span> <span class="n">stack_location</span><span class="p">]</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">left_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">INFINITY</span><span class="p">)</span>
    <span class="n">right_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">INFINITY</span><span class="p">)</span>

    <span class="n">next_left</span> <span class="o">=</span> <span class="n">next_right</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">put_next_item_here</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">left_start</span><span class="p">,</span> <span class="n">right_end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">left_stack</span><span class="p">[</span><span class="n">next_left</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">right_stack</span><span class="p">[</span><span class="n">next_right</span><span class="p">]:</span>
            <span class="n">collection</span><span class="p">[</span><span class="n">put_next_item_here</span><span class="p">]</span> <span class="o">=</span> <span class="n">left_stack</span><span class="p">[</span><span class="n">next_left</span><span class="p">]</span>
            <span class="n">next_left</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">collection</span><span class="p">[</span><span class="n">put_next_item_here</span><span class="p">]</span> <span class="o">=</span> <span class="n">right_stack</span><span class="p">[</span><span class="n">next_right</span><span class="p">]</span>
            <span class="n">next_right</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">count</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">merge_check</span><span class="p">(</span><span class="n">merger</span><span class="p">):</span>
    <span class="n">first</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">second</span> <span class="o">=</span> <span class="n">first</span><span class="p">[:]</span>
    <span class="n">collection</span> <span class="o">=</span> <span class="n">first</span> <span class="o">+</span> <span class="n">second</span>

    <span class="n">count</span> <span class="o">=</span> <span class="n">merger</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>

    <span class="n">expect</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

    <span class="n">collection</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">+</span> <span class="n">first</span> <span class="o">+</span> <span class="n">second</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">merger</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">11</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

    <span class="n">collection</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">+</span> <span class="n">first</span> <span class="o">+</span> <span class="n">second</span> <span class="o">+</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">merger</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="n">expect</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">11</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="k">return</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">merge_check</span><span class="p">(</span><span class="n">merge_clrs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgaff8807">
<h4 id="orgaff8807">Runtime</h4>
<div class="outline-text-4" id="text-orgaff8807">
<p>Without doing anything fancy we can see that there's three for loops, the first two cover copying over all the sub-list items from the original list to the new lists, so together they execute once for every item (<i>n</i> times). And the loop that does the actual merge also runs once for each item so it also runs <i>n</i> times so altogether it has a run time of <i>2n</i> which we'll say is \(\Theta(n)\). This is actually going to be part of the merge-sort but I thought I'd put that in here since the post is separate.</p>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org2799028">
<h3 id="org2799028">Levitin</h3>
<div class="outline-text-3" id="text-org2799028">
<p>This is the version given in <a href="posts/itdaa/index.html">Introduction to the Design & Analysis of Algorithms (Levitin)</a> which I find a little clearer than the CLRS version. I generally prefer Levitin's versions, but, you know, CLRS is the one you <b>have to</b> have, so it's there too.</p>
<pre id="the-merge-levitin" style="display:hidden;">
\begin{algorithm}
\caption{Merge}
\begin{algorithmic}
\INPUT $B[0 \ldots p-1]$, $C[0 \ldots q - 1]$, $A[0 \ldots p + q - 1]$
\REQUIRE Sub-arrays $B$ and $C$ are sorted
\OUTPUT Sorted array $A$ with the elements of $B$ and $C$.

\PROCEDURE{Merge}{$B, C, A$}

\STATE $i \gets 0$
\STATE $j \gets 0$
\STATE $k \gets 0$

\WHILE {$i &lt; p$ and $j &lt; q$}
 \IF {$B[i] \le C[j]$}
  \STATE $A[k] \gets B[i]$
  \STATE $i \gets i + 1$
 \ELSE
  \STATE $A[k] \gets C[j]$
  \STATE $j \gets j + 1$
 \ENDIF
 \STATE $k \gets k + 1$
\ENDWHILE

\IF {$i=p$}
 \STATE Copy $C[j \ldots q-1]$ to $A[k \ldots p + q - 1]$
\ELSE
 \STATE Copy $B[i \ldots p - 1]$ to $A[k \ldots p + q - 1]$
\ENDIF
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>
<p>There are a couple of noticeable differences between Levitin's version and the CLRS version. The first is that the lists to merge are passed into the function rather than being separated inside the function, which makes the "Divide" step separate from the "Combine" step. Additionally, instead of adding a sentinel to the end of the stacks the conditional checks to see if one of them is empty and copies over the stack that isn't empty outside of the merge-loop. This adds an additional conditional check to the main loop but then takes away the conditional check when copying over the leftovers. I might give the CLRS version a point for being more concise in handling the leftovers for the case where left and right are different sizes.</p>
</div>
<div class="outline-4" id="outline-container-org4dacec7">
<h4 id="org4dacec7">Implement It</h4>
<div class="outline-text-4" id="text-org4dacec7">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Sequence</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">merge_levitin</span><span class="p">(</span><span class="n">left_stack</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">right_stack</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">,</span>
                  <span class="n">target</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Merges values from left and right stacks into target collection</span>

<span class="sd">    Args:</span>
<span class="sd">     left_stack: sorted collection of items to merge</span>
<span class="sd">     right_stack: sorted collection of items to merge</span>
<span class="sd">     target: collection into which to merge the items</span>

<span class="sd">    Returns:</span>
<span class="sd">     count of basic operations</span>
<span class="sd">    """</span>
    <span class="n">left_size</span><span class="p">,</span> <span class="n">right_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">left_stack</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">right_stack</span><span class="p">)</span>
    <span class="n">next_left</span> <span class="o">=</span> <span class="n">next_right</span> <span class="o">=</span> <span class="n">put_item_here</span> <span class="o">=</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="n">next_left</span> <span class="o">&lt;</span> <span class="n">left_size</span> <span class="ow">and</span> <span class="n">next_right</span> <span class="o">&lt;</span> <span class="n">right_size</span><span class="p">:</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">left_stack</span><span class="p">[</span><span class="n">next_left</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">right_stack</span><span class="p">[</span><span class="n">next_right</span><span class="p">]:</span>
            <span class="n">target</span><span class="p">[</span><span class="n">put_item_here</span><span class="p">]</span> <span class="o">=</span> <span class="n">left_stack</span><span class="p">[</span><span class="n">next_left</span><span class="p">]</span>
            <span class="n">next_left</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">target</span><span class="p">[</span><span class="n">put_item_here</span><span class="p">]</span> <span class="o">=</span> <span class="n">right_stack</span><span class="p">[</span><span class="n">next_right</span><span class="p">]</span>
            <span class="n">next_right</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">put_item_here</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">next_left</span> <span class="o">==</span> <span class="n">left_size</span> <span class="ow">and</span> <span class="n">next_right</span> <span class="o">&lt;</span> <span class="n">right_size</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">stack_offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">left_size</span> <span class="o">+</span> <span class="n">right_size</span> <span class="o">-</span> <span class="n">put_item_here</span><span class="p">):</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">target</span><span class="p">[</span><span class="n">put_item_here</span> <span class="o">+</span> <span class="n">stack_offset</span><span class="p">]</span> <span class="o">=</span> <span class="n">right_stack</span><span class="p">[</span><span class="n">next_right</span> <span class="o">+</span> <span class="n">stack_offset</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">next_left</span> <span class="o">&lt;</span> <span class="n">left_size</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">stack_offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">left_size</span> <span class="o">+</span> <span class="n">right_size</span> <span class="o">-</span> <span class="n">put_item_here</span><span class="p">):</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">target</span><span class="p">[</span><span class="n">put_item_here</span> <span class="o">+</span> <span class="n">stack_offset</span><span class="p">]</span> <span class="o">=</span> <span class="n">left_stack</span><span class="p">[</span><span class="n">next_left</span> <span class="o">+</span> <span class="n">stack_offset</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">count</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">first</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">second</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="o">+</span> <span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">first</span><span class="p">)]</span>
<span class="n">collection</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">first</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">second</span><span class="p">))</span>

<span class="n">count</span> <span class="o">=</span> <span class="n">merge_levitin</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">collection</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="n">second</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">first</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="o">+</span> <span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">second</span><span class="p">)]</span>
<span class="n">collection</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">first</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">second</span><span class="p">))</span>

<span class="n">count</span> <span class="o">=</span> <span class="n">merge_levitin</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">collection</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgf9e97a0">
<h4 id="orgf9e97a0">Runtime</h4>
<div class="outline-text-4" id="text-orgf9e97a0">
<p>Since the dividing of the array is moved out of the merge the runtime for the merge is \(n\) so it's also \(\Theta(n)\).</p>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org87bb515">
<h3 id="org87bb515">A Hybrid</h3>
<div class="outline-text-3" id="text-org87bb515">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">left_stack</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">right_stack</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">,</span>
          <span class="n">target</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Merges values from left and right stacks into target collection</span>

<span class="sd">    Args:</span>
<span class="sd">     left_stack: sorted collection of items to merge</span>
<span class="sd">     right_stack: sorted collection of items to merge</span>
<span class="sd">     target: collection into which to merge the items</span>

<span class="sd">    Returns:</span>
<span class="sd">     count of basic operations</span>
<span class="sd">    """</span>
    <span class="n">target_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">left_stack</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">right_stack</span><span class="p">)</span>

    <span class="c1"># since we aren't copying the lists this can be kind of dangerous</span>
    <span class="c1"># passing in the same list more than once will append INFINITY each time</span>
    <span class="n">left_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">INFINITY</span><span class="p">)</span>
    <span class="n">right_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">INFINITY</span><span class="p">)</span>
    <span class="n">next_left</span> <span class="o">=</span> <span class="n">next_right</span> <span class="o">=</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">put_item_here</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">target_size</span><span class="p">):</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">left_stack</span><span class="p">[</span><span class="n">next_left</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">right_stack</span><span class="p">[</span><span class="n">next_right</span><span class="p">]:</span>
            <span class="n">target</span><span class="p">[</span><span class="n">put_item_here</span><span class="p">]</span> <span class="o">=</span> <span class="n">left_stack</span><span class="p">[</span><span class="n">next_left</span><span class="p">]</span>
            <span class="n">next_left</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">target</span><span class="p">[</span><span class="n">put_item_here</span><span class="p">]</span> <span class="o">=</span> <span class="n">right_stack</span><span class="p">[</span><span class="n">next_right</span><span class="p">]</span>
            <span class="n">next_right</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">count</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">first</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">second</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="o">+</span> <span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">first</span><span class="p">)]</span>
<span class="n">collection</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">first</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">second</span><span class="p">))</span>

<span class="n">count</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">collection</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="n">second</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">first</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="o">+</span> <span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">second</span><span class="p">)]</span>
<span class="n">collection</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">first</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">second</span><span class="p">))</span>

<span class="n">count</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">collection</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">count</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org9b90b42">
<h2 id="org9b90b42">End</h2>
<div class="outline-text-2" id="text-org9b90b42">
<ul class="org-ul">
<li><a href="posts/clrs/index.html">Introduction To Algorithms (CLRS)</a></li>
<li><a href="posts/itdaa/index.html">Introduction to the Design & Analysis of Algorithms (Levitin)</a></li>
</ul>
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("the-merge"));
});
</script>
<script>

window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("the-merge-levitin"));
});
</script></div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/binary-search/index.html">Binary Search</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/binary-search/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-01-14T16:22:42-08:00" itemprop="datePublished" title="2022-01-14 16:22">2022-01-14 16:22</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/binary-search/index.html#orgd904a3a">Beginning</a>
<ul>
<li><a href="posts/binary-search/index.html#org452673a">The Algorithm Parts</a></li>
</ul>
</li>
<li><a href="posts/binary-search/index.html#org49388c8">Implementation</a>
<ul>
<li><a href="posts/binary-search/index.html#org846df4c">Imports</a></li>
<li><a href="posts/binary-search/index.html#orga08d31f">Set Up</a></li>
<li><a href="posts/binary-search/index.html#org7d86f9e">Binary Search One</a>
<ul>
<li><a href="posts/binary-search/index.html#org086ab2a">The Pseudocode</a></li>
<li><a href="posts/binary-search/index.html#org854127f">The Function</a></li>
</ul>
</li>
<li><a href="posts/binary-search/index.html#org5520101">Levitin's Version</a>
<ul>
<li><a href="posts/binary-search/index.html#org1410e3b">The Pseudocode</a></li>
<li><a href="posts/binary-search/index.html#org4be6447">The Function</a></li>
</ul>
</li>
<li><a href="posts/binary-search/index.html#org5211a49">Recursive Version</a>
<ul>
<li><a href="posts/binary-search/index.html#org6e95372">The Pseudocode</a></li>
<li><a href="posts/binary-search/index.html#orgc808ee0">The Implementation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="posts/binary-search/index.html#org92b4122">Some Plotting</a>
<ul>
<li><a href="posts/binary-search/index.html#org51acfdb">Left and Right</a></li>
<li><a href="posts/binary-search/index.html#org279c571">Runtime</a></li>
</ul>
</li>
<li><a href="posts/binary-search/index.html#org377085c">See Also</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgd904a3a">
<h2 id="orgd904a3a">Beginning</h2>
<div class="outline-text-2" id="text-orgd904a3a"></div>
<div class="outline-3" id="outline-container-org452673a">
<h3 id="org452673a">The Algorithm Parts</h3>
<div class="outline-text-3" id="text-org452673a">
<ul class="org-ul">
<li><b>Precondition:</b> The input array (A) is sorted in non-decreasing order and the key \(k\) is in \(A\).</li>
<li><b>Postcondition:</b> The index of the matching element is output</li>
<li><b>Loop Invariant:</b> The key is in our current sublist: \(k \in A[left \ldots right]\).</li>
<li><b>Basic Step:</b> Find the midpoint of the sub-array, adjust the sub-array to use the midpoint such that the key is in the new sub-array.</li>
<li><b>Exit Condition:</b> \(left \le right\).</li>
<li><b>Make Progress:</b> After each loop the sublist is half the size of the previous sublist.</li>
<li><b>Maintain the Loop Invariant:</b> Pick the half of the sublist whose boundary value would allow the key.</li>
<li><b>Establish the Loop Invariant:</b> The initial sublist is the original list (\(left = 0, right=A.length -1\)).</li>
<li><b>Worst Case Runtime:</b> Since the input is repeatedly halved, the worst-case is \(\Theta(\log_{2} n)\).</li>
</ul>
<p>Rather than saying "if k is in A" over and over, the search precondition requires that \(k\) is in \(A\) and if it isn't it's considered a failed search - which doesn't mean the algorithm is incorrect, just that the pre-condition wasn't met. We have to handle the other case, but for the purpose of defining the algorithm we'll set a stricter pre-condition.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org49388c8">
<h2 id="org49388c8">Implementation</h2>
<div class="outline-text-2" id="text-org49388c8"></div>
<div class="outline-3" id="outline-container-org846df4c">
<h3 id="org846df4c">Imports</h3>
<div class="outline-text-3" id="text-org846df4c">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Sequence</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">be_false</span><span class="p">,</span> <span class="n">be_none</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span><span class="p">,</span> <span class="n">raise_error</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>

<span class="kn">import</span> <span class="nn">altair</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">Timer</span>
<span class="kn">from</span> <span class="nn">graeae.visualization.altair_helpers</span> <span class="kn">import</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">save_chart</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orga08d31f">
<h3 id="orga08d31f">Set Up</h3>
<div class="outline-text-3" id="text-orga08d31f">
<div class="highlight">
<pre><span></span><span class="n">TIMER</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="n">output_path</span><span class="p">(</span><span class="s2">"binary-search"</span><span class="p">)</span>
<span class="n">save_it</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">save_chart</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">)</span>

<span class="n">SearchOutput</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">"SearchOutput"</span><span class="p">,</span> <span class="p">[</span><span class="s2">"index"</span><span class="p">,</span> <span class="s2">"count"</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org7d86f9e">
<h3 id="org7d86f9e">Binary Search One</h3>
<div class="outline-text-3" id="text-org7d86f9e"></div>
<div class="outline-4" id="outline-container-org086ab2a">
<h4 id="org086ab2a">The Pseudocode</h4>
<div class="outline-text-4" id="text-org086ab2a">
<pre id="binarysearch" style="display:hidden;">
\begin{algorithm}
\caption{BinarySearch}
\begin{algorithmic}
\INPUT Array A of items in non-decreasing order, search key
\OUTPUT If key is in array, the index of the item that matches
\PROCEDURE{BinarySearch}{A, key}
\STATE left $\gets$ 0
\STATE right $\gets$ A.length - 1

\WHILE {right &gt; left}
\STATE middle $\gets \left \lfloor \frac{\textrm{left} + \textrm{right}}{2} \right \rfloor$

\IF {key $\le$ A[middle]}
\STATE right $\gets$ middle
\ELSE
\STATE left $\gets$ middle + 1
\ENDIF
\ENDWHILE

\IF {key = A[left]}
\RETURN left
\ELSE
\RETURN NotFound
\ENDIF
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre></div>
</div>
<div class="outline-4" id="outline-container-org854127f">
<h4 id="org854127f">The Function</h4>
<div class="outline-text-4" id="text-org854127f">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">binary_search</span><span class="p">(</span><span class="n">element</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">elements</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SearchOutput</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Does an iterative binary search for the key</span>

<span class="sd">    Args:</span>
<span class="sd">     element: item in the source to search for</span>
<span class="sd">     elements: sorted (non-decreasing) collection with the key</span>

<span class="sd">    Returns:</span>
<span class="sd">     SearchOutput(index of the key in the source or None if not found, count of comparisons)</span>
<span class="sd">    """</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span><span class="n">elements</span><span class="p">[</span><span class="n">left</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">element</span> <span class="o">&lt;=</span> <span class="n">elements</span><span class="p">[</span><span class="n">right</span><span class="p">]):</span>
        <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">while</span> <span class="n">right</span> <span class="o">&gt;</span> <span class="n">left</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">elements</span><span class="p">[</span><span class="n">left</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">element</span> <span class="o">&lt;=</span> <span class="n">elements</span><span class="p">[</span><span class="n">right</span><span class="p">]</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">middle</span> <span class="o">=</span> <span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>

        <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="p">((</span><span class="n">left</span><span class="p">,</span> <span class="n">middle</span><span class="p">)</span> <span class="k">if</span> <span class="n">element</span> <span class="o">&lt;=</span> <span class="n">elements</span><span class="p">[</span><span class="n">middle</span><span class="p">]</span>
                       <span class="k">else</span> <span class="p">(</span><span class="n">middle</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">right</span><span class="p">))</span>

    <span class="n">location</span> <span class="o">=</span> <span class="n">left</span> <span class="k">if</span> <span class="p">(</span><span class="n">elements</span><span class="p">[</span><span class="n">left</span><span class="p">]</span> <span class="o">==</span> <span class="n">element</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">test_it</span><span class="p">(</span><span class="n">searcher</span><span class="p">):</span>
    <span class="n">test_case</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">11</span><span class="p">))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">searcher</span><span class="p">(</span><span class="n">element</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">elements</span><span class="o">=</span><span class="n">test_case</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>

    <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="mi">50</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">expected</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
        <span class="n">expect</span><span class="p">(</span><span class="n">searcher</span><span class="p">(</span><span class="n">element</span><span class="o">=</span><span class="n">item</span><span class="p">,</span> <span class="n">elements</span><span class="o">=</span><span class="n">items</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">expected</span><span class="p">))</span>

    <span class="n">expect</span><span class="p">(</span><span class="n">searcher</span><span class="p">(</span><span class="n">element</span><span class="o">=-</span><span class="mi">5</span><span class="p">,</span> <span class="n">elements</span><span class="o">=</span><span class="n">items</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_none</span><span class="p">)</span>

    <span class="n">last</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">items</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">last</span> <span class="o">+</span> <span class="mi">100</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">searcher</span><span class="p">(</span><span class="mi">101</span><span class="p">,</span> <span class="n">items</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_none</span><span class="p">)</span>

    <span class="n">expect</span><span class="p">(</span><span class="n">searcher</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="p">[])[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_none</span><span class="p">)</span>

    <span class="n">expect</span><span class="p">(</span><span class="n">searcher</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="k">return</span>

<span class="n">test_it</span><span class="p">(</span><span class="n">binary_search</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org5520101">
<h3 id="org5520101">Levitin's Version</h3>
<div class="outline-text-3" id="text-org5520101">
<p>The version I entered above is one that I found on the web (<a href="https://www.eecs.yorku.ca/course_archive/2013-14/W/2011/lectures/09%20Loop%20Invariants%20and%20Binary%20Search.pdf">PDF Lecture Notes</a>), and is roughly what CLRS has. The one in <a href="posts/itdaa/index.html">Levitin's Book</a> is clearer to me but has one more comparison.</p>
</div>
<div class="outline-4" id="outline-container-org1410e3b">
<h4 id="org1410e3b">The Pseudocode</h4>
<div class="outline-text-4" id="text-org1410e3b">
<pre id="binarysearch2" style="display:hidden;">
\begin{algorithm}
\caption{BinarySearchTwo}
\begin{algorithmic}
\INPUT Array A of items in non-decreasing order, search key in A
\OUTPUT The index of the item that matches key
\PROCEDURE{BinarySearchTwo}{A, key}
\STATE left $\gets$ 0
\STATE right $\gets$ A.length - 1

\WHILE {left $\le$ right}
\STATE middle $\gets \left \lfloor \frac{\textrm{left} + \textrm{right}}{2} \right \rfloor$

\IF {key = A[middle]}
  \RETURN middle
\ELIF {key &lt; A[middle]}
\STATE right $\gets$ middle - 1
\ELSE
\STATE left $\gets$ middle + 1
\ENDIF
\ENDWHILE

\IF {key = A[left]}
\RETURN left
\ELSE
\RETURN NotFound
\ENDIF
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre></div>
</div>
<div class="outline-4" id="outline-container-org4be6447">
<h4 id="org4be6447">The Function</h4>
<div class="outline-text-4" id="text-org4be6447">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">binary_search_two</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SearchOutput</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Iterative Binary Search</span>

<span class="sd">    Args:</span>
<span class="sd">     element: item in the source</span>
<span class="sd">     elements: sorted collection to search</span>

<span class="sd">    Returns:</span>
<span class="sd">     index where key is found in the source or False if not found</span>

<span class="sd">    Raises:</span>
<span class="sd">     AssertionError: key is out of bounds for the source</span>
<span class="sd">    """</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">location</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">while</span> <span class="n">left</span> <span class="o">&lt;=</span> <span class="n">right</span> <span class="ow">and</span> <span class="n">location</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">middle</span> <span class="o">=</span> <span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>

        <span class="k">if</span> <span class="n">element</span> <span class="o">==</span> <span class="n">elements</span><span class="p">[</span><span class="n">middle</span><span class="p">]:</span>
            <span class="n">location</span> <span class="o">=</span> <span class="n">middle</span>

        <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="p">((</span><span class="n">left</span><span class="p">,</span> <span class="n">middle</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">element</span> <span class="o">&lt;=</span> <span class="n">elements</span><span class="p">[</span><span class="n">middle</span><span class="p">]</span> <span class="k">else</span>
                       <span class="p">(</span><span class="n">middle</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">right</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">test_it</span><span class="p">(</span><span class="n">binary_search_two</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org5211a49">
<h3 id="org5211a49">Recursive Version</h3>
<div class="outline-text-3" id="text-org5211a49">
<p>Although it is pretty straightforward as an iterative function, divide and conquer lends itself to recursion so, just for completeness, here's a recursive version of the binary search.</p>
</div>
<div class="outline-4" id="outline-container-org6e95372">
<h4 id="org6e95372">The Pseudocode</h4>
<div class="outline-text-4" id="text-org6e95372">
<pre id="binarysearch3" style="display:hidden;">
\begin{algorithm}
\caption{Recursive Binary Search}
\begin{algorithmic}
\REQUIRE Input Array is in non-decreasing order
\INPUT Array A , search key, left and right indices to limit the search
\OUTPUT The index of the item that matches the key
\PROCEDURE{BinarySearchRecursive}{A, key, left, right}

\IF {left &gt; right}
  \RETURN NotFound
\ENDIF

\STATE middle $\gets \left \lfloor \frac{\textrm{left} + \textrm{right}}{2} \right \rfloor$

\IF {key = A[middle]}
 \RETURN middle
\ELIF {key &lt; A[middle]}
 \STATE right $\gets$ middle - 1
\ELSE
 \STATE left $\gets$ middle + 1
\ENDIF

\RETURN \textsc{BinarySearchRecursive}(elements, key, left, right)

\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre></div>
</div>
<div class="outline-4" id="outline-container-orgc808ee0">
<h4 id="orgc808ee0">The Implementation</h4>
<div class="outline-text-4" id="text-orgc808ee0">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">recursive_binary_search</span><span class="p">(</span><span class="n">elements</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                            <span class="n">left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                            <span class="n">count</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Recursive binary search</span>

<span class="sd">    Args:</span>
<span class="sd">     elements: sorted sequence with element in it</span>
<span class="sd">     key: item in elements to search for</span>
<span class="sd">     left: left index of the current sub-list to search</span>
<span class="sd">     right: right index of the current sub-list to search</span>
<span class="sd">     count: number of times we run the comparison (for plotting)</span>

<span class="sd">    Returns:</span>
<span class="sd">     (index, count) - index of the element in the elements and the comparison count</span>
<span class="sd">    """</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">left</span> <span class="o">&gt;</span> <span class="n">right</span><span class="p">:</span>
        <span class="c1"># we missed it, the element isn't in the elements</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">count</span>

    <span class="n">middle</span> <span class="o">=</span> <span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>

    <span class="k">if</span> <span class="n">elements</span><span class="p">[</span><span class="n">middle</span><span class="p">]</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
        <span class="c1"># we found it</span>
        <span class="k">return</span> <span class="n">middle</span><span class="p">,</span> <span class="n">count</span>

    <span class="c1"># move one of the boundaries to the middle</span>
    <span class="k">if</span> <span class="n">key</span> <span class="o">&lt;</span> <span class="n">elements</span><span class="p">[</span><span class="n">middle</span><span class="p">]:</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">middle</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">left</span> <span class="o">=</span> <span class="n">middle</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">recursive_binary_search</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</pre></div>
<p>This is a helper to get the recursive call started and to handle empty lists or search terms that are outside of the range of the list.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="n">element</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">elements</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""calls the recursive binary search</span>

<span class="sd">    Args:</span>
<span class="sd">     element: an element in source to search for</span>
<span class="sd">     elements: sorted sequence of items     </span>
<span class="sd">    """</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="ow">or</span>  <span class="ow">not</span> <span class="n">elements</span><span class="p">[</span><span class="n">left</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">element</span> <span class="o">&lt;=</span> <span class="n">elements</span><span class="p">[</span><span class="n">right</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">recursive_binary_search</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">test_it</span><span class="p">(</span><span class="n">search</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org92b4122">
<h2 id="org92b4122">Some Plotting</h2>
<div class="outline-text-2" id="text-org92b4122"></div>
<div class="outline-3" id="outline-container-org51acfdb">
<h3 id="org51acfdb">Left and Right</h3>
<div class="outline-text-3" id="text-org51acfdb">
<p>Let's look at how the search updates the left and right boundaries. First we'll need a function that records the locations.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">binary_search_points</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Iterative Binary Search</span>

<span class="sd">    Args:</span>
<span class="sd">     key: item in the source</span>
<span class="sd">     source: sorted collection to search</span>

<span class="sd">    Returns:</span>
<span class="sd">     tuple of left-right locations</span>

<span class="sd">    Raises:</span>
<span class="sd">     AssertionError: key is out of bounds for the source</span>
<span class="sd">    """</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">lefts</span> <span class="o">=</span> <span class="p">[</span><span class="n">left</span><span class="p">]</span>
    <span class="n">rights</span> <span class="o">=</span> <span class="p">[</span><span class="n">right</span><span class="p">]</span>

    <span class="k">while</span> <span class="n">right</span> <span class="o">&gt;</span> <span class="n">left</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">source</span><span class="p">[</span><span class="n">left</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">key</span> <span class="o">&lt;=</span> <span class="n">source</span><span class="p">[</span><span class="n">right</span><span class="p">]</span>
        <span class="n">middle</span> <span class="o">=</span> <span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="n">right</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>

        <span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span> <span class="o">=</span> <span class="p">((</span><span class="n">left</span><span class="p">,</span> <span class="n">middle</span><span class="p">)</span> <span class="k">if</span> <span class="n">key</span> <span class="o">&lt;=</span> <span class="n">source</span><span class="p">[</span><span class="n">middle</span><span class="p">]</span>
                         <span class="k">else</span> <span class="p">(</span><span class="n">middle</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">right</span><span class="p">))</span>
        <span class="n">lefts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">left</span><span class="p">)</span>
        <span class="n">rights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lefts</span><span class="p">,</span> <span class="n">rights</span>
</pre></div>
<p>Now we'll plot it.</p>
<div class="highlight">
<pre><span></span><span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">101</span><span class="p">))</span>
<span class="n">key</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="mi">24</span><span class="p">]</span>
<span class="n">lefts</span><span class="p">,</span> <span class="n">rights</span> <span class="o">=</span> <span class="n">binary_search_points</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">items</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">Left</span><span class="o">=</span><span class="n">lefts</span><span class="p">,</span> <span class="n">Right</span><span class="o">=</span><span class="n">rights</span><span class="p">,</span> <span class="n">Split</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lefts</span><span class="p">)))))</span>

<span class="n">melted</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Split"</span><span class="p">],</span> <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Left"</span><span class="p">,</span> <span class="s2">"Right"</span><span class="p">],</span>
                   <span class="n">var_name</span><span class="o">=</span><span class="s2">"left_or_right"</span><span class="p">,</span>
                   <span class="n">value_name</span><span class="o">=</span><span class="s2">"Index"</span><span class="p">)</span>
<span class="n">base</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span>

<span class="n">lines</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Split:O"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Index"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"left_or_right"</span>
<span class="p">)</span>

<span class="n">points</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Split:O"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Index"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"left_or_right"</span>
<span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="p">(</span><span class="n">lines</span> <span class="o">+</span> <span class="n">points</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Binary Search Left-Right Boundaries"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">550</span>
<span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="o">=</span><span class="n">chart</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"binary-search"</span><span class="p">)</span>
</pre></div>
<object data="posts/binary-search/binary-search.html" height="600" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>So, it isn't really so pretty as with the sorting plots. As the plot confirms, the left and right slowly narrow to find the item in the list.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org279c571">
<h3 id="org279c571">Runtime</h3>
<div class="outline-text-3" id="text-org279c571">
<p>Let's see how the number of loops goes up with the size of the search space.</p>
<div class="highlight">
<pre><span></span><span class="n">EXPONENT</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">numba_search</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="n">binary_search</span><span class="p">)</span>

<span class="n">sizes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="n">EXPONENT</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
<span class="n">random_source</span> <span class="o">=</span> <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">count</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">sizes</span><span class="p">]</span>
<span class="n">random_things</span> <span class="o">=</span> <span class="p">[(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">elements</span><span class="p">),</span> <span class="n">elements</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">elements</span> <span class="ow">in</span> <span class="n">random_source</span><span class="p">]</span>

<span class="n">worst_things</span> <span class="o">=</span> <span class="p">[(</span><span class="n">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">elements</span><span class="p">)</span> <span class="k">for</span> <span class="n">elements</span> <span class="ow">in</span> <span class="n">random_source</span><span class="p">]</span>

<span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">random_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
        <span class="n">delayed</span><span class="p">(</span><span class="n">numba_search</span><span class="p">)(</span><span class="n">element</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span> <span class="ow">in</span> <span class="n">random_things</span><span class="p">)</span>

    <span class="n">worst_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
        <span class="n">delayed</span><span class="p">(</span><span class="n">numba_search</span><span class="p">)(</span><span class="n">element</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span> <span class="ow">in</span> <span class="n">worst_things</span><span class="p">)</span>
</pre></div>
<pre class="example">
Started: 2022-01-16 21:33:07.668315
Ended: 2022-01-16 21:33:08.905390
Elapsed: 0:00:01.237075
</pre>
<div class="highlight">
<pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">Count</span><span class="o">=</span><span class="n">sizes</span><span class="p">,</span>
    <span class="n">Random</span><span class="o">=</span><span class="p">[</span><span class="n">output</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">random_output</span><span class="p">],</span>
    <span class="n">First</span><span class="o">=</span><span class="p">[</span><span class="n">output</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">worst_output</span><span class="p">]</span>
<span class="p">))</span>

<span class="n">melted</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Count"</span><span class="p">],</span> <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Random"</span><span class="p">,</span> <span class="s2">"First"</span><span class="p">],</span>
                   <span class="n">var_name</span><span class="o">=</span><span class="s2">"Location"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Bisections"</span><span class="p">)</span>

<span class="n">theoretical</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">Count</span><span class="o">=</span><span class="n">sizes</span><span class="p">,</span> <span class="n">Theoretical</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">sizes</span><span class="p">)))</span>
</pre></div>
<p>Now, to plot.</p>
<div class="highlight">
<pre><span></span><span class="n">points</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Count"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Bisections"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Location"</span><span class="p">)</span>

<span class="n">line</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">theoretical</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Count"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Theoretical"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Count"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
             <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Theoretical"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">".2f"</span><span class="p">)],</span>
<span class="p">)</span>
<span class="n">chart</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="n">points</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Binary Search Bisections"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">save_chart</span><span class="p">(</span><span class="n">chart</span><span class="o">=</span><span class="n">chart</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"binary-search-comparisons"</span><span class="p">,</span>
           <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">)</span>
</pre></div>
<object data="posts/binary-search/binary-search-comparisons.html" height="600" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
</div>
<div class="outline-2" id="outline-container-org377085c">
<h2 id="org377085c">See Also</h2>
<div class="outline-text-2" id="text-org377085c">
<ul class="org-ul">
<li>Loop Invariants [Internet]. [cited 2022 Jan 15]. Available from: <a href="https://www.cs.cornell.edu/courses/cs2112/2018fa/lectures/lec_loopinv/">https://www.cs.cornell.edu/courses/cs2112/2018fa/lectures/lec_loopinv/</a></li>
<li><a href="posts/itdaa/index.html">Introduction to the Design & Analysis of Algorithms (Levitin)</a></li>
</ul>
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("binarysearch"));
});
</script>
<script>

window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("binarysearch2"));
});
</script>
<script>

window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("binarysearch3"));
});
</script></div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/decrease-and-conquer/index.html">Decrease And Conquer</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/decrease-and-conquer/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-01-11T11:51:54-08:00" itemprop="datePublished" title="2022-01-11 11:51">2022-01-11 11:51</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<p>With <i>Decrease-and-Conquer</i> algorithms you exploit the relationship between the solution to a problem and the solution to a sub-problem. There are three types of Decrease-and-Conquer algorithms:</p>
<ul class="org-ul">
<li>Decrease by a constant (typically one)</li>
<li>Decrease by a constant factor (typically two)</li>
<li>Decrease by a variable amount</li>
</ul>
<div class="outline-2" id="outline-container-orgf1804e2">
<h2 id="orgf1804e2">See Also</h2>
<div class="outline-text-2" id="text-orgf1804e2">
<ul class="org-ul">
<li><a href="posts/itdaa/index.html">Introduction to the Design & Analysis of Algorithms (Levitin)</a></li>
</ul>
</div>
</div>
</div>
</article>
</div>
<ul class="pager postindexpager clearfix">
<li class="previous"><a href="index-4.html" rel="prev">Newer posts</a></li>
<li class="next"><a href="index-2.html" rel="next">Older posts</a></li>
</ul>
<script crossorigin="anonymous" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">

      MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],

            displayMath: [['$$','$$'], ['\\[','\\]']],
            processEscapes: true,
            processEnvironments: true,
        }
    });
</script><!--End of body content-->
<footer id="footer">Scribbles by <a href="mailto:cloisteredmonkey.jmark@slmail.me">The Cloistered Monkey</a> Â© 2024 - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a>
<div id="license" xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/"><span property="dct:title">Ape-Iron</span> is licensed under <a href="http://creativecommons.org/licenses/by-sa/4.0/?ref=chooser-v1" rel="license noopener noreferrer" style="display:inline-block;" target="_blank">CC BY-SA 4.0 <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"><img src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1"></a></div>
</footer>
</div>
<script src="assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script></div>
</body>
</html>
