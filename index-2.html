<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Striking out for data." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Bowling For Data (old posts, page 2) | Bowling For Data</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Bowling-For-Data/index-2.html" rel="canonical">
<link href="index-3.html" rel="prev" type="text/html">
<link href="index-1.html" rel="next" type="text/html"><!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
<script crossorigin="anonymous" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],

            displayMath: [['$$','$$'], ['\\[','\\]']],
            processEscapes: true,
            processEnvironments: true,
        }
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/pseudocode@2.4.1/build/pseudocode.min.js"></script>
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="."><span id="blog-title">Bowling For Data</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="pages/">Pages</a></li>
<li class="nav-item"><a class="nav-link" href="archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="rss.xml">RSS feed</a></li>
<li class="nav-item dropdown"><a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Monkey Pages</a>
<div class="dropdown-menu"><a class="dropdown-item" href="https://necromuralist.github.io/">The Cloistered Monkey</a> <a class="dropdown-item" href="https://necromuralist.github.io/Ape-Iron/">Ape Iron</a> <a class="dropdown-item" href="https://necromuralist.github.io/Beach-Pig-Thigh/">Beach-Pig Rump & Thigh</a> <a class="dropdown-item" href="https://necromuralist.github.io/Neurotic-Networking/">Neurotic Networking</a> <a class="dropdown-item" href="https://necromuralist.github.io/Terribilis-Ludum/">Terribilis Ludum</a> <a class="dropdown-item" href="https://necromuralist.github.io/Visions-Voices-Data/">Visions, Voices, Data</a></div>
</li>
</ul>
<!-- DuckDuckGo custom search -->
<form action="https://duckduckgo.com/" class="navbar-form pull-left" id="search" method="get" name="search"><input name="sites" type="hidden" value="https://necromuralist.github.io/Bowling-For-Data/"><input name="k8" type="hidden" value="#444444"><input name="k9" type="hidden" value="#D51920"><input name="kt" type="hidden" value="h"><input class="span2" maxlength="255" name="q" placeholder="Search…" style="margin-top: 4px;" type="text"><input style="visibility: hidden;" type="submit" value="DuckDuckGo Search"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<div class="postindex">
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/a-first-look-at-dplyr/index.html">A First Look at dplyr</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/a-first-look-at-dplyr/index.html" rel="bookmark"><time class="published dt-published" datetime="2021-12-16T16:59:04-08:00" itemprop="datePublished" title="2021-12-16 16:59">2021-12-16 16:59</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/a-first-look-at-dplyr/index.html#org0b396f6">In the Beginning</a>
<ul>
<li><a href="posts/a-first-look-at-dplyr/index.html#org39ed6e4">Imports</a></li>
</ul>
</li>
<li><a href="posts/a-first-look-at-dplyr/index.html#org7a159d4">The Data</a></li>
<li><a href="posts/a-first-look-at-dplyr/index.html#org73d4fd8">Filter</a>
<ul>
<li><a href="posts/a-first-look-at-dplyr/index.html#org9348ee6">The Basic Filter</a></li>
<li><a href="posts/a-first-look-at-dplyr/index.html#orgaf75884">Or, Not And</a></li>
<li><a href="posts/a-first-look-at-dplyr/index.html#org8af3513">And and Or</a></li>
</ul>
</li>
<li><a href="posts/a-first-look-at-dplyr/index.html#org6f9b21d">Arrange</a>
<ul>
<li><a href="posts/a-first-look-at-dplyr/index.html#org31f4be7">Ascending Order</a></li>
<li><a href="posts/a-first-look-at-dplyr/index.html#orga234080">Descending Order</a></li>
</ul>
</li>
<li><a href="posts/a-first-look-at-dplyr/index.html#org1c73604">Select</a>
<ul>
<li><a href="posts/a-first-look-at-dplyr/index.html#orgf56a97e">Grab Some Columns</a></li>
<li><a href="posts/a-first-look-at-dplyr/index.html#org441b2df">A Range of Columns</a></li>
<li><a href="posts/a-first-look-at-dplyr/index.html#orgb77cf95">Helper Functions</a></li>
</ul>
</li>
<li><a href="posts/a-first-look-at-dplyr/index.html#org42de86b">Renaming</a>
<ul>
<li>
<ul>
<li><a href="posts/a-first-look-at-dplyr/index.html#org5b60094">Some More Useful Renaming</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="posts/a-first-look-at-dplyr/index.html#orgb3c235b">Mutate</a>
<ul>
<li><a href="posts/a-first-look-at-dplyr/index.html#orgfbfceb7">Transmute</a></li>
</ul>
</li>
<li><a href="posts/a-first-look-at-dplyr/index.html#org44ef35d">Summarize</a>
<ul>
<li><a href="posts/a-first-look-at-dplyr/index.html#orgd715421">Grouping</a></li>
<li><a href="posts/a-first-look-at-dplyr/index.html#org3e05c78">Hitting the Pipe</a></li>
</ul>
</li>
<li><a href="posts/a-first-look-at-dplyr/index.html#org3a38996">Link Collection</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org0b396f6">
<h2 id="org0b396f6">In the Beginning</h2>
<div class="outline-text-2" id="text-org0b396f6">
<p>This is a look at <a href="https://dplyr.tidyverse.org/">dplyr</a> based on Chapter Three of <a href="posts/r-for-data-science/index.html">R For Data Science</a>. It focuses on what the book identifies as the six key <code>dplyr</code> functions.</p>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Function</th>
<th class="org-left" scope="col">What It Does</th>
<th class="org-left" scope="col">By Another Name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>filter</code></td>
<td class="org-left">Pick out rows based on their values.</td>
<td class="org-left">Boolean Slice</td>
</tr>
<tr>
<td class="org-left"><code>arrange</code></td>
<td class="org-left">Re-order the rows.</td>
<td class="org-left">Sort</td>
</tr>
<tr>
<td class="org-left"><code>select</code></td>
<td class="org-left">Pick out variables by their names.</td>
<td class="org-left">Column subset</td>
</tr>
<tr>
<td class="org-left"><code>mutate</code></td>
<td class="org-left">Create new variables using existing ones.</td>
<td class="org-left">Feature Engineering</td>
</tr>
<tr>
<td class="org-left"><code>summarize</code></td>
<td class="org-left">Summarize many values as a single value.</td>
<td class="org-left">Statistic</td>
</tr>
<tr>
<td class="org-left"><code>group_by</code></td>
<td class="org-left">Changes scope of other functions to operate on group.</td>
<td class="org-left">&nbsp;</td>
</tr>
</tbody>
</table>
</div>
<div class="outline-3" id="outline-container-org39ed6e4">
<h3 id="org39ed6e4">Imports</h3>
<div class="outline-text-3" id="text-org39ed6e4">
<div class="highlight">
<pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">ascii</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">assertthat</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">knitr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">nycflights13</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
</pre></div>
<p><b>Note:</b> The stuff in the tidyverse tends to clobber built-in functions, which can make it hard to understand sometimes when things go wrong. If you forget to load <code>dplyer</code>, for instance, there's already a <code>filter</code> function, but it doesn't do the same thing as the one you load with <code>dplyr</code> so you'll get weird error messages if you try to use it. Notably I was getting this message:</p>
<div class="highlight">
<pre><span></span><span class="n">Error</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">airlines</span><span class="p">,</span><span class="w"> </span><span class="n">carrier</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">"US"</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="s">'carrier'</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">found</span>
</pre></div>
<p>Anyway, now some options for the packages.</p>
<div class="highlight">
<pre><span></span><span class="nf">options</span><span class="p">(</span><span class="n">asciiType</span><span class="o">=</span><span class="s">"org"</span><span class="p">)</span>
<span class="nf">theme_set</span><span class="p">(</span><span class="nf">theme_minimal</span><span class="p">(</span><span class="n">base_family</span><span class="o">=</span><span class="s">"Palatino"</span><span class="p">))</span>
</pre></div>
<p>And a couple of helpers to print (the <code>tibble</code> objects dump weird characters into the org-mode output).</p>
<div class="highlight">
<pre><span></span><span class="n">khead</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">#' Prints a table of the first lines of the dataframe</span>
<span class="w">  </span><span class="c1">#'</span>
<span class="w">  </span><span class="c1">#' @param data The data to print</span>
<span class="w">  </span><span class="n">table</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">kable</span><span class="p">(</span><span class="nf">head</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="w">  </span><span class="n">table</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">gsub</span><span class="p">(</span><span class="s">":"</span><span class="p">,</span><span class="w"> </span><span class="s">"-"</span><span class="p">,</span><span class="w"> </span><span class="n">table</span><span class="p">[</span><span class="m">2</span><span class="p">])</span>
<span class="w">  </span><span class="n">table</span>
<span class="p">}</span>

<span class="n">okable</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">#' Prints data as an org-mode table</span>
<span class="w">  </span><span class="c1">#'</span>
<span class="w">  </span><span class="c1">#' @param data The data to print</span>
<span class="w">  </span><span class="n">table</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">kable</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="w">  </span><span class="n">table</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">gsub</span><span class="p">(</span><span class="s">":"</span><span class="p">,</span><span class="w"> </span><span class="s">"-"</span><span class="p">,</span><span class="w"> </span><span class="n">table</span><span class="p">[</span><span class="m">2</span><span class="p">])</span>
<span class="w">  </span><span class="n">table</span>
<span class="p">}</span>

<span class="n">got_all_your_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">#' Checks if there's any missing values</span>
<span class="w">  </span><span class="c1">#'</span>
<span class="w">  </span><span class="c1">#' @param data The vector of data to check</span>
<span class="w">  </span><span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org7a159d4">
<h2 id="org7a159d4">The Data</h2>
<div class="outline-text-2" id="text-org7a159d4">
<p>We're going to look at the <code>flights</code> dataframe loaded by the <a href="https://www.rdocumentation.org/packages/nycflights13/versions/1.0.1"><code>nycflights13</code></a> package (which, curiously, R loads using the <code>library</code> function).</p>
<div class="highlight">
<pre><span></span><span class="nf">str</span><span class="p">(</span><span class="n">flights</span><span class="p">)</span>
</pre></div>
<pre class="example" id="org7e2de8f">
tibble [336,776 × 19] (S3: tbl_df/tbl/data.frame)
 $ year          : int [1:336776] 2013 2013 2013 2013 2013 2013 2013 2013 2013 2013 ...
 $ month         : int [1:336776] 1 1 1 1 1 1 1 1 1 1 ...
 $ day           : int [1:336776] 1 1 1 1 1 1 1 1 1 1 ...
 $ dep_time      : int [1:336776] 517 533 542 544 554 554 555 557 557 558 ...
 $ sched_dep_time: int [1:336776] 515 529 540 545 600 558 600 600 600 600 ...
 $ dep_delay     : num [1:336776] 2 4 2 -1 -6 -4 -5 -3 -3 -2 ...
 $ arr_time      : int [1:336776] 830 850 923 1004 812 740 913 709 838 753 ...
 $ sched_arr_time: int [1:336776] 819 830 850 1022 837 728 854 723 846 745 ...
 $ arr_delay     : num [1:336776] 11 20 33 -18 -25 12 19 -14 -8 8 ...
 $ carrier       : chr [1:336776] "UA" "UA" "AA" "B6" ...
 $ flight        : int [1:336776] 1545 1714 1141 725 461 1696 507 5708 79 301 ...
 $ tailnum       : chr [1:336776] "N14228" "N24211" "N619AA" "N804JB" ...
 $ origin        : chr [1:336776] "EWR" "LGA" "JFK" "JFK" ...
 $ dest          : chr [1:336776] "IAH" "IAH" "MIA" "BQN" ...
 $ air_time      : num [1:336776] 227 227 160 183 116 150 158 53 140 138 ...
 $ distance      : num [1:336776] 1400 1416 1089 1576 762 ...
 $ hour          : num [1:336776] 5 5 5 5 6 5 6 6 6 6 ...
 $ minute        : num [1:336776] 15 29 40 45 0 58 0 0 0 0 ...
 $ time_hour     : POSIXct[1:336776], format: "2013-01-01 05:00:00" "2013-01-01 05:00:00" ...
</pre>
<p>The dataset lists all the flights that left New York City airports in 2013 heading to destinations in the United States, Puerto Rico, and the American Virgin Islands.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org73d4fd8">
<h2 id="org73d4fd8">Filter</h2>
<div class="outline-text-2" id="text-org73d4fd8"></div>
<div class="outline-3" id="outline-container-org9348ee6">
<h3 id="org9348ee6">The Basic Filter</h3>
<div class="outline-text-3" id="text-org9348ee6">
<p><code>filter</code> takes the dataframe as the first argument and every argument after that has to be a boolean expression based on the dataframe. If you pass in more than one condition <code>dplyr</code> will and them. Let's see the flights on Christmas.</p>
<div class="highlight">
<pre><span></span><span class="n">christmas</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="n">month</span><span class="o">==</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">day</span><span class="o">==</span><span class="m">25</span><span class="p">)</span>
<span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">christmas</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_bar</span><span class="p">(</span>
<span class="w">    </span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">carrier</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Christmas Flights"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="s">"Origin"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">"Count"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"christmas_flights_counts.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/a-first-look-at-dplyr/christmas_flights_counts.png"></p>
</div>
</div>
<div class="outline-3" id="outline-container-orgaf75884">
<h3 id="orgaf75884">Or, Not And</h3>
<div class="outline-text-3" id="text-orgaf75884">
<p>Since the default is for the <code>filter</code> to and everything together, if you want to use something else (like <code>OR</code>) you need to create a single argument built with the OR operator (<code>|</code>). If you're using a single column for the OR, there's actually a (possibly) easier way that works like python's <code>in</code> where you check if the value is in a collection. Let's see the flights on Christmas and on Christmas Eve .</p>
<div class="highlight">
<pre><span></span><span class="n">both_days</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="n">month</span><span class="o">==</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">day</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">24</span><span class="p">,</span><span class="w"> </span><span class="m">25</span><span class="p">))</span>

<span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">both_days</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_bar</span><span class="p">(</span>
<span class="w">    </span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">day</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">origin</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Christmas Eve and Day Flights"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="s">"Day"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">"Count"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"christmas_day_and_eve.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/a-first-look-at-dplyr/christmas_day_and_eve.png"></p>
</div>
</div>
<div class="outline-3" id="outline-container-org8af3513">
<h3 id="org8af3513">And and Or</h3>
<div class="outline-text-3" id="text-org8af3513">
<p>What if we want New-Years Day and Christmas? In this case we need to keep the month with the day so we can't just use the <code>in</code> operator, but we can use the AND and OR operators to make it work.</p>
<div class="highlight">
<pre><span></span><span class="n">and_new_years</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">month</span><span class="o">==</span><span class="m">12</span><span class="w"> </span><span class="o">&</span><span class="w"> </span><span class="n">day</span><span class="o">==</span><span class="m">25</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">month</span><span class="o">==</span><span class="m">1</span><span class="w"> </span><span class="o">&</span><span class="w"> </span><span class="n">day</span><span class="o">==</span><span class="m">1</span><span class="p">))</span>

<span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">and_new_years</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_bar</span><span class="p">(</span>
<span class="w">    </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">day</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">origin</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Christmas and New Years Day"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="s">"Date"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">"Count"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"christmas_new_years.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/a-first-look-at-dplyr/christmas_new_years.png"></p>
<div class="highlight">
<pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">and_new_years</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_boxplot</span><span class="p">(</span>
<span class="w">    </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">dep_delay</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">origin</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Christmas and New Years Day Delays"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="s">"Departure Airport"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">"Delay (Minutes)"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"christmas_new_years_delay.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/a-first-look-at-dplyr/christmas_new_years_delay.png"></p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org6f9b21d">
<h2 id="org6f9b21d">Arrange</h2>
<div class="outline-text-2" id="text-org6f9b21d">
<p><code>arrange</code> is a function to sort the rows. By default it sorts then in non-decreasing (ascending) order using a column you give it. You can givie it multiple columns in which case whenever there's a tie it will look in the next column you gave it to see if it can break it (the tie, I mean).</p>
</div>
<div class="outline-3" id="outline-container-org31f4be7">
<h3 id="org31f4be7">Ascending Order</h3>
<div class="outline-text-3" id="text-org31f4be7">
<p>What are the shortest flights?</p>
<div class="highlight">
<pre><span></span><span class="nf">khead</span><span class="p">(</span><span class="nf">arrange</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="n">distance</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-right">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">year</th>
<th class="org-right" scope="col">month</th>
<th class="org-right" scope="col">day</th>
<th class="org-right" scope="col">dep_time</th>
<th class="org-right" scope="col">sched_dep_time</th>
<th class="org-right" scope="col">dep_delay</th>
<th class="org-right" scope="col">arr_time</th>
<th class="org-right" scope="col">sched_arr_time</th>
<th class="org-right" scope="col">arr_delay</th>
<th class="org-left" scope="col">carrier</th>
<th class="org-right" scope="col">flight</th>
<th class="org-left" scope="col">tailnum</th>
<th class="org-left" scope="col">origin</th>
<th class="org-left" scope="col">destination</th>
<th class="org-right" scope="col">air_time</th>
<th class="org-right" scope="col">distance</th>
<th class="org-right" scope="col">hour</th>
<th class="org-right" scope="col">minute</th>
<th class="org-left" scope="col">time_hour</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">2013</td>
<td class="org-right">7</td>
<td class="org-right">27</td>
<td class="org-right">NA</td>
<td class="org-right">106</td>
<td class="org-right">NA</td>
<td class="org-right">NA</td>
<td class="org-right">245</td>
<td class="org-right">NA</td>
<td class="org-left">US</td>
<td class="org-right">1632</td>
<td class="org-left">NA</td>
<td class="org-left">EWR</td>
<td class="org-left">LGA</td>
<td class="org-right">NA</td>
<td class="org-right">17</td>
<td class="org-right">1</td>
<td class="org-right">6</td>
<td class="org-left">2013-07-27 01:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">3</td>
<td class="org-right">2127</td>
<td class="org-right">2129</td>
<td class="org-right">-2</td>
<td class="org-right">2222</td>
<td class="org-right">2224</td>
<td class="org-right">-2</td>
<td class="org-left">EV</td>
<td class="org-right">3833</td>
<td class="org-left">N13989</td>
<td class="org-left">EWR</td>
<td class="org-left">PHL</td>
<td class="org-right">30</td>
<td class="org-right">80</td>
<td class="org-right">21</td>
<td class="org-right">29</td>
<td class="org-left">2013-01-03 21:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">4</td>
<td class="org-right">1240</td>
<td class="org-right">1200</td>
<td class="org-right">40</td>
<td class="org-right">1333</td>
<td class="org-right">1306</td>
<td class="org-right">27</td>
<td class="org-left">EV</td>
<td class="org-right">4193</td>
<td class="org-left">N14972</td>
<td class="org-left">EWR</td>
<td class="org-left">PHL</td>
<td class="org-right">30</td>
<td class="org-right">80</td>
<td class="org-right">12</td>
<td class="org-right">0</td>
<td class="org-left">2013-01-04 12:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">4</td>
<td class="org-right">1829</td>
<td class="org-right">1615</td>
<td class="org-right">134</td>
<td class="org-right">1937</td>
<td class="org-right">1721</td>
<td class="org-right">136</td>
<td class="org-left">EV</td>
<td class="org-right">4502</td>
<td class="org-left">N15983</td>
<td class="org-left">EWR</td>
<td class="org-left">PHL</td>
<td class="org-right">28</td>
<td class="org-right">80</td>
<td class="org-right">16</td>
<td class="org-right">15</td>
<td class="org-left">2013-01-04 16:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">4</td>
<td class="org-right">2128</td>
<td class="org-right">2129</td>
<td class="org-right">-1</td>
<td class="org-right">2218</td>
<td class="org-right">2224</td>
<td class="org-right">-6</td>
<td class="org-left">EV</td>
<td class="org-right">4645</td>
<td class="org-left">N27962</td>
<td class="org-left">EWR</td>
<td class="org-left">PHL</td>
<td class="org-right">32</td>
<td class="org-right">80</td>
<td class="org-right">21</td>
<td class="org-right">29</td>
<td class="org-left">2013-01-04 21:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">5</td>
<td class="org-right">1155</td>
<td class="org-right">1200</td>
<td class="org-right">-5</td>
<td class="org-right">1241</td>
<td class="org-right">1306</td>
<td class="org-right">-25</td>
<td class="org-left">EV</td>
<td class="org-right">4193</td>
<td class="org-left">N14902</td>
<td class="org-left">EWR</td>
<td class="org-left">PHL</td>
<td class="org-right">29</td>
<td class="org-right">80</td>
<td class="org-right">12</td>
<td class="org-right">0</td>
<td class="org-left">2013-01-05 12:00:00</td>
</tr>
</tbody>
</table>
<p>The data uses the three-letter airport codes, but there's another dataframe loaded with <code>ggplot2</code> named <code>airports</code> that we can use to translate them to airport names.</p>
<div class="highlight">
<pre><span></span><span class="nf">okable</span><span class="p">(</span><span class="nf">filter</span><span class="p">(</span><span class="n">airports</span><span class="p">,</span><span class="w"> </span><span class="n">faa</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">"PHL"</span><span class="p">,</span><span class="w"> </span><span class="s">"LGA"</span><span class="p">,</span><span class="w"> </span><span class="s">"EWR"</span><span class="p">)))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">faa</th>
<th class="org-left" scope="col">name</th>
<th class="org-right" scope="col">lat</th>
<th class="org-right" scope="col">lon</th>
<th class="org-right" scope="col">alt</th>
<th class="org-right" scope="col">tz</th>
<th class="org-left" scope="col">dst</th>
<th class="org-left" scope="col">tzone</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">EWR</td>
<td class="org-left">Newark Liberty Intl</td>
<td class="org-right">40.69250</td>
<td class="org-right">-74.16867</td>
<td class="org-right">18</td>
<td class="org-right">-5</td>
<td class="org-left">A</td>
<td class="org-left">America/New_York</td>
</tr>
<tr>
<td class="org-left">LGA</td>
<td class="org-left">La Guardia</td>
<td class="org-right">40.77725</td>
<td class="org-right">-73.87261</td>
<td class="org-right">22</td>
<td class="org-right">-5</td>
<td class="org-left">A</td>
<td class="org-left">America/New_York</td>
</tr>
<tr>
<td class="org-left">PHL</td>
<td class="org-left">Philadelphia Intl</td>
<td class="org-right">39.87194</td>
<td class="org-right">-75.24114</td>
<td class="org-right">36</td>
<td class="org-right">-5</td>
<td class="org-left">A</td>
<td class="org-left">America/New_York</td>
</tr>
</tbody>
</table>
<p>So the shortest flights are from Newark Liberty International to La Guardia airport and the Philadelphia International Airport. I wonder why someone would take a plane to go 17 miles? I guess the traffic must be really bad, or some people just have money (and jet fuel) to burn.</p>
</div>
</div>
<div class="outline-3" id="outline-container-orga234080">
<h3 id="orga234080">Descending Order</h3>
<div class="outline-text-3" id="text-orga234080">
<p>To get the data to sort in descending order you have to pass in another function call (<code>desc</code>). Weird.</p>
<p>What are the longest flights?</p>
<div class="highlight">
<pre><span></span><span class="nf">khead</span><span class="p">(</span><span class="nf">arrange</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="nf">desc</span><span class="p">(</span><span class="n">distance</span><span class="p">)))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-right">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">year</th>
<th class="org-right" scope="col">month</th>
<th class="org-right" scope="col">day</th>
<th class="org-right" scope="col">dep_time</th>
<th class="org-right" scope="col">sched_dep_time</th>
<th class="org-right" scope="col">dep_delay</th>
<th class="org-right" scope="col">arr_time</th>
<th class="org-right" scope="col">sched_arr_time</th>
<th class="org-right" scope="col">arr_delay</th>
<th class="org-left" scope="col">carrier</th>
<th class="org-right" scope="col">flight</th>
<th class="org-left" scope="col">tailnum</th>
<th class="org-left" scope="col">origin</th>
<th class="org-left" scope="col">destination</th>
<th class="org-right" scope="col">air_time</th>
<th class="org-right" scope="col">distance</th>
<th class="org-right" scope="col">hour</th>
<th class="org-right" scope="col">minute</th>
<th class="org-left" scope="col">time_hour</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">857</td>
<td class="org-right">900</td>
<td class="org-right">-3</td>
<td class="org-right">1516</td>
<td class="org-right">1530</td>
<td class="org-right">-14</td>
<td class="org-left">HA</td>
<td class="org-right">51</td>
<td class="org-left">N380HA</td>
<td class="org-left">JFK</td>
<td class="org-left">HNL</td>
<td class="org-right">659</td>
<td class="org-right">4983</td>
<td class="org-right">9</td>
<td class="org-right">0</td>
<td class="org-left">2013-01-01 09:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">2</td>
<td class="org-right">909</td>
<td class="org-right">900</td>
<td class="org-right">9</td>
<td class="org-right">1525</td>
<td class="org-right">1530</td>
<td class="org-right">-5</td>
<td class="org-left">HA</td>
<td class="org-right">51</td>
<td class="org-left">N380HA</td>
<td class="org-left">JFK</td>
<td class="org-left">HNL</td>
<td class="org-right">638</td>
<td class="org-right">4983</td>
<td class="org-right">9</td>
<td class="org-right">0</td>
<td class="org-left">2013-01-02 09:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">3</td>
<td class="org-right">914</td>
<td class="org-right">900</td>
<td class="org-right">14</td>
<td class="org-right">1504</td>
<td class="org-right">1530</td>
<td class="org-right">-26</td>
<td class="org-left">HA</td>
<td class="org-right">51</td>
<td class="org-left">N380HA</td>
<td class="org-left">JFK</td>
<td class="org-left">HNL</td>
<td class="org-right">616</td>
<td class="org-right">4983</td>
<td class="org-right">9</td>
<td class="org-right">0</td>
<td class="org-left">2013-01-03 09:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">4</td>
<td class="org-right">900</td>
<td class="org-right">900</td>
<td class="org-right">0</td>
<td class="org-right">1516</td>
<td class="org-right">1530</td>
<td class="org-right">-14</td>
<td class="org-left">HA</td>
<td class="org-right">51</td>
<td class="org-left">N384HA</td>
<td class="org-left">JFK</td>
<td class="org-left">HNL</td>
<td class="org-right">639</td>
<td class="org-right">4983</td>
<td class="org-right">9</td>
<td class="org-right">0</td>
<td class="org-left">2013-01-04 09:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">5</td>
<td class="org-right">858</td>
<td class="org-right">900</td>
<td class="org-right">-2</td>
<td class="org-right">1519</td>
<td class="org-right">1530</td>
<td class="org-right">-11</td>
<td class="org-left">HA</td>
<td class="org-right">51</td>
<td class="org-left">N381HA</td>
<td class="org-left">JFK</td>
<td class="org-left">HNL</td>
<td class="org-right">635</td>
<td class="org-right">4983</td>
<td class="org-right">9</td>
<td class="org-right">0</td>
<td class="org-left">2013-01-05 09:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">6</td>
<td class="org-right">1019</td>
<td class="org-right">900</td>
<td class="org-right">79</td>
<td class="org-right">1558</td>
<td class="org-right">1530</td>
<td class="org-right">28</td>
<td class="org-left">HA</td>
<td class="org-right">51</td>
<td class="org-left">N385HA</td>
<td class="org-left">JFK</td>
<td class="org-left">HNL</td>
<td class="org-right">611</td>
<td class="org-right">4983</td>
<td class="org-right">9</td>
<td class="org-right">0</td>
<td class="org-left">2013-01-06 09:00:00</td>
</tr>
</tbody>
</table>
<p>You can probably guess the airports from the codes, but we'll look them up anyway.</p>
<div class="highlight">
<pre><span></span><span class="nf">okable</span><span class="p">(</span><span class="nf">filter</span><span class="p">(</span><span class="n">airports</span><span class="p">,</span><span class="w"> </span><span class="n">faa</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">"JFK"</span><span class="p">,</span><span class="w"> </span><span class="s">"HNL"</span><span class="p">)))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">faa</th>
<th class="org-left" scope="col">name</th>
<th class="org-right" scope="col">lat</th>
<th class="org-right" scope="col">lon</th>
<th class="org-right" scope="col">alt</th>
<th class="org-right" scope="col">tz</th>
<th class="org-left" scope="col">dst</th>
<th class="org-left" scope="col">tzone</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">HNL</td>
<td class="org-left">Honolulu Intl</td>
<td class="org-right">21.31868</td>
<td class="org-right">-157.92243</td>
<td class="org-right">13</td>
<td class="org-right">-10</td>
<td class="org-left">N</td>
<td class="org-left">Pacific/Honolulu</td>
</tr>
<tr>
<td class="org-left">JFK</td>
<td class="org-left">John F Kennedy Intl</td>
<td class="org-right">40.63975</td>
<td class="org-right">-73.77893</td>
<td class="org-right">13</td>
<td class="org-right">-5</td>
<td class="org-left">A</td>
<td class="org-left">America/New_York</td>
</tr>
</tbody>
</table>
<p>And the longest flights are from John F. Kennedy International airport to Honolulu International airport.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org1c73604">
<h2 id="org1c73604">Select</h2>
<div class="outline-text-2" id="text-org1c73604">
<p><code>select</code> helps with getting subsets of columns. At first glance this seems like something that should be easy to do without needing a separate function, but it adds more ways to grab the columns than just passing in the names.</p>
</div>
<div class="outline-3" id="outline-container-orgf56a97e">
<h3 id="orgf56a97e">Grab Some Columns</h3>
<div class="outline-text-3" id="text-orgf56a97e">
<p>The basic way to get a subset of columns is to pass them in as arguments.</p>
<div class="highlight">
<pre><span></span><span class="nf">khead</span><span class="p">(</span><span class="nf">select</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="n">flight</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">month</th>
<th class="org-right" scope="col">flight</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">1545</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">1714</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">1141</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">725</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">461</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-right">1696</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-3" id="outline-container-org441b2df">
<h3 id="org441b2df">A Range of Columns</h3>
<div class="outline-text-3" id="text-org441b2df">
<p>If you want to grab a section of contiguous columns you can pass in the first and last ones separated by a colon (the `:` character, not the vital organ).</p>
<div class="highlight">
<pre><span></span><span class="nf">khead</span><span class="p">(</span><span class="nf">select</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="n">dep_time</span><span class="o">:</span><span class="n">arr_time</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">dep_time</th>
<th class="org-right" scope="col">sched_dep_time</th>
<th class="org-right" scope="col">dep_delay</th>
<th class="org-right" scope="col">arr_time</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">517</td>
<td class="org-right">515</td>
<td class="org-right">2</td>
<td class="org-right">830</td>
</tr>
<tr>
<td class="org-right">533</td>
<td class="org-right">529</td>
<td class="org-right">4</td>
<td class="org-right">850</td>
</tr>
<tr>
<td class="org-right">542</td>
<td class="org-right">540</td>
<td class="org-right">2</td>
<td class="org-right">923</td>
</tr>
<tr>
<td class="org-right">544</td>
<td class="org-right">545</td>
<td class="org-right">-1</td>
<td class="org-right">1004</td>
</tr>
<tr>
<td class="org-right">554</td>
<td class="org-right">600</td>
<td class="org-right">-6</td>
<td class="org-right">812</td>
</tr>
<tr>
<td class="org-right">554</td>
<td class="org-right">558</td>
<td class="org-right">-4</td>
<td class="org-right">740</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-3" id="outline-container-orgb77cf95">
<h3 id="orgb77cf95">Helper Functions</h3>
<div class="outline-text-3" id="text-orgb77cf95">
<p>Like <code>arrange</code> <code>select</code> uses functions passed in to alter the behavior. Most of them are string-methods-ish.</p>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Function</th>
<th class="org-left" scope="col">What it does</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>starts_with("&lt;prefix&gt;")</code></td>
<td class="org-left">Pick columns by a prefix.</td>
</tr>
<tr>
<td class="org-left"><code>ends_with("&lt;suffix&gt;")</code></td>
<td class="org-left">Pick columns with a suffix.</td>
</tr>
<tr>
<td class="org-left"><code>contains("&lt;sub-string&gt;")</code></td>
<td class="org-left">Pick columns with a sub-string of the name.</td>
</tr>
<tr>
<td class="org-left"><code>matches("&lt;regular-expression&gt;")</code></td>
<td class="org-left">Pick out stuff using a regular expression.</td>
</tr>
<tr>
<td class="org-left"><code>num_range("&lt;prefix&gt;", &lt;number range&gt;)</code></td>
<td class="org-left">Grab columns with the prefix followed by each of the numbers</td>
</tr>
<tr>
<td class="org-left"><code>last_col()</code></td>
<td class="org-left">Get the last column (negative index).</td>
</tr>
<tr>
<td class="org-left"><code>all_of(&lt;vector&gt;)</code></td>
<td class="org-left">Grab the columns in the vector.</td>
</tr>
<tr>
<td class="org-left"><code>any_of(&lt;vector&gt;)</code></td>
<td class="org-left">Same as <code>all_of</code> but ignores non-existent columns in the vector</td>
</tr>
<tr>
<td class="org-left"><code>where(&lt;function&gt;)</code></td>
<td class="org-left">Applies the function to the columns and picks the ones that return true</td>
</tr>
</tbody>
</table>
<p>You can also use logical AND and OR operators or a vector to combine the selections, but we'll just do a basic one-function call. Let's grab all the columns with an underscore in their name.</p>
<div class="highlight">
<pre><span></span><span class="nf">khead</span><span class="p">(</span><span class="nf">select</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="nf">contains</span><span class="p">(</span><span class="s">"_"</span><span class="p">)))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">dep_time</th>
<th class="org-right" scope="col">sched_dep_time</th>
<th class="org-right" scope="col">dep_delay</th>
<th class="org-right" scope="col">arr_time</th>
<th class="org-right" scope="col">sched_arr_time</th>
<th class="org-right" scope="col">arr_delay</th>
<th class="org-right" scope="col">air_time</th>
<th class="org-left" scope="col">time_hour</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">517</td>
<td class="org-right">515</td>
<td class="org-right">2</td>
<td class="org-right">830</td>
<td class="org-right">819</td>
<td class="org-right">11</td>
<td class="org-right">227</td>
<td class="org-left">2013-01-01 05:00:00</td>
</tr>
<tr>
<td class="org-right">533</td>
<td class="org-right">529</td>
<td class="org-right">4</td>
<td class="org-right">850</td>
<td class="org-right">830</td>
<td class="org-right">20</td>
<td class="org-right">227</td>
<td class="org-left">2013-01-01 05:00:00</td>
</tr>
<tr>
<td class="org-right">542</td>
<td class="org-right">540</td>
<td class="org-right">2</td>
<td class="org-right">923</td>
<td class="org-right">850</td>
<td class="org-right">33</td>
<td class="org-right">160</td>
<td class="org-left">2013-01-01 05:00:00</td>
</tr>
<tr>
<td class="org-right">544</td>
<td class="org-right">545</td>
<td class="org-right">-1</td>
<td class="org-right">1004</td>
<td class="org-right">1022</td>
<td class="org-right">-18</td>
<td class="org-right">183</td>
<td class="org-left">2013-01-01 05:00:00</td>
</tr>
<tr>
<td class="org-right">554</td>
<td class="org-right">600</td>
<td class="org-right">-6</td>
<td class="org-right">812</td>
<td class="org-right">837</td>
<td class="org-right">-25</td>
<td class="org-right">116</td>
<td class="org-left">2013-01-01 06:00:00</td>
</tr>
<tr>
<td class="org-right">554</td>
<td class="org-right">558</td>
<td class="org-right">-4</td>
<td class="org-right">740</td>
<td class="org-right">728</td>
<td class="org-right">12</td>
<td class="org-right">150</td>
<td class="org-left">2013-01-01 05:00:00</td>
</tr>
</tbody>
</table>
<p>You can also negate the selections using an exclamation point (<code>!</code>), so we can grab all the columns that don't have an underscore in their name like this.</p>
<div class="highlight">
<pre><span></span><span class="nf">khead</span><span class="p">(</span><span class="nf">select</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="o">!</span><span class="nf">contains</span><span class="p">(</span><span class="s">"_"</span><span class="p">)))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-right">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">year</th>
<th class="org-right" scope="col">month</th>
<th class="org-right" scope="col">day</th>
<th class="org-left" scope="col">carrier</th>
<th class="org-right" scope="col">flight</th>
<th class="org-left" scope="col">tailnum</th>
<th class="org-left" scope="col">origin</th>
<th class="org-left" scope="col">dest</th>
<th class="org-right" scope="col">distance</th>
<th class="org-right" scope="col">hour</th>
<th class="org-right" scope="col">minute</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-left">UA</td>
<td class="org-right">1545</td>
<td class="org-left">N14228</td>
<td class="org-left">EWR</td>
<td class="org-left">IAH</td>
<td class="org-right">1400</td>
<td class="org-right">5</td>
<td class="org-right">15</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-left">UA</td>
<td class="org-right">1714</td>
<td class="org-left">N24211</td>
<td class="org-left">LGA</td>
<td class="org-left">IAH</td>
<td class="org-right">1416</td>
<td class="org-right">5</td>
<td class="org-right">29</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-left">AA</td>
<td class="org-right">1141</td>
<td class="org-left">N619AA</td>
<td class="org-left">JFK</td>
<td class="org-left">MIA</td>
<td class="org-right">1089</td>
<td class="org-right">5</td>
<td class="org-right">40</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-left">B6</td>
<td class="org-right">725</td>
<td class="org-left">N804JB</td>
<td class="org-left">JFK</td>
<td class="org-left">BQN</td>
<td class="org-right">1576</td>
<td class="org-right">5</td>
<td class="org-right">45</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-left">DL</td>
<td class="org-right">461</td>
<td class="org-left">N668DN</td>
<td class="org-left">LGA</td>
<td class="org-left">ATL</td>
<td class="org-right">762</td>
<td class="org-right">6</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-left">UA</td>
<td class="org-right">1696</td>
<td class="org-left">N39463</td>
<td class="org-left">EWR</td>
<td class="org-left">ORD</td>
<td class="org-right">719</td>
<td class="org-right">5</td>
<td class="org-right">58</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org42de86b">
<h2 id="org42de86b">Renaming</h2>
<div class="outline-text-2" id="text-org42de86b">
<p>The book mentions renaming under the <code>select</code> section because it says that it is a special case of selection, but it has a dedicated function to do that named <code>rename</code> that you should use instead. Let's rename the first column (<code>year</code>).</p>
<div class="highlight">
<pre><span></span><span class="nf">khead</span><span class="p">(</span><span class="nf">rename</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="n">Jahr</span><span class="o">=</span><span class="n">year</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-right">
<col class="org-left">
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">Jahr</th>
<th class="org-right" scope="col">month</th>
<th class="org-right" scope="col">day</th>
<th class="org-right" scope="col">dep_time</th>
<th class="org-right" scope="col">sched_dep_time</th>
<th class="org-right" scope="col">dep_delay</th>
<th class="org-right" scope="col">arr_time</th>
<th class="org-right" scope="col">sched_arr_time</th>
<th class="org-right" scope="col">arr_delay</th>
<th class="org-left" scope="col">carrier</th>
<th class="org-right" scope="col">flight</th>
<th class="org-left" scope="col">tailnum</th>
<th class="org-left" scope="col">origin</th>
<th class="org-left" scope="col">dest</th>
<th class="org-right" scope="col">air_time</th>
<th class="org-right" scope="col">distance</th>
<th class="org-right" scope="col">hour</th>
<th class="org-right" scope="col">minute</th>
<th class="org-left" scope="col">time_hour</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">517</td>
<td class="org-right">515</td>
<td class="org-right">2</td>
<td class="org-right">830</td>
<td class="org-right">819</td>
<td class="org-right">11</td>
<td class="org-left">UA</td>
<td class="org-right">1545</td>
<td class="org-left">N14228</td>
<td class="org-left">EWR</td>
<td class="org-left">IAH</td>
<td class="org-right">227</td>
<td class="org-right">1400</td>
<td class="org-right">5</td>
<td class="org-right">15</td>
<td class="org-left">2013-01-01 05:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">533</td>
<td class="org-right">529</td>
<td class="org-right">4</td>
<td class="org-right">850</td>
<td class="org-right">830</td>
<td class="org-right">20</td>
<td class="org-left">UA</td>
<td class="org-right">1714</td>
<td class="org-left">N24211</td>
<td class="org-left">LGA</td>
<td class="org-left">IAH</td>
<td class="org-right">227</td>
<td class="org-right">1416</td>
<td class="org-right">5</td>
<td class="org-right">29</td>
<td class="org-left">2013-01-01 05:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">542</td>
<td class="org-right">540</td>
<td class="org-right">2</td>
<td class="org-right">923</td>
<td class="org-right">850</td>
<td class="org-right">33</td>
<td class="org-left">AA</td>
<td class="org-right">1141</td>
<td class="org-left">N619AA</td>
<td class="org-left">JFK</td>
<td class="org-left">MIA</td>
<td class="org-right">160</td>
<td class="org-right">1089</td>
<td class="org-right">5</td>
<td class="org-right">40</td>
<td class="org-left">2013-01-01 05:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">544</td>
<td class="org-right">545</td>
<td class="org-right">-1</td>
<td class="org-right">1004</td>
<td class="org-right">1022</td>
<td class="org-right">-18</td>
<td class="org-left">B6</td>
<td class="org-right">725</td>
<td class="org-left">N804JB</td>
<td class="org-left">JFK</td>
<td class="org-left">BQN</td>
<td class="org-right">183</td>
<td class="org-right">1576</td>
<td class="org-right">5</td>
<td class="org-right">45</td>
<td class="org-left">2013-01-01 05:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">554</td>
<td class="org-right">600</td>
<td class="org-right">-6</td>
<td class="org-right">812</td>
<td class="org-right">837</td>
<td class="org-right">-25</td>
<td class="org-left">DL</td>
<td class="org-right">461</td>
<td class="org-left">N668DN</td>
<td class="org-left">LGA</td>
<td class="org-left">ATL</td>
<td class="org-right">116</td>
<td class="org-right">762</td>
<td class="org-right">6</td>
<td class="org-right">0</td>
<td class="org-left">2013-01-01 06:00:00</td>
</tr>
<tr>
<td class="org-right">2013</td>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">554</td>
<td class="org-right">558</td>
<td class="org-right">-4</td>
<td class="org-right">740</td>
<td class="org-right">728</td>
<td class="org-right">12</td>
<td class="org-left">UA</td>
<td class="org-right">1696</td>
<td class="org-left">N39463</td>
<td class="org-left">EWR</td>
<td class="org-left">ORD</td>
<td class="org-right">150</td>
<td class="org-right">719</td>
<td class="org-right">5</td>
<td class="org-right">58</td>
<td class="org-left">2013-01-01 05:00:00</td>
</tr>
</tbody>
</table>
<p><b>Note:</b> Pay attention to the funky syntax - the new name comes first and the original name comes after the equal sign.</p>
</div>
<div class="outline-4" id="outline-container-org5b60094">
<h4 id="org5b60094">Some More Useful Renaming</h4>
<div class="outline-text-4" id="text-org5b60094">
<p>That wasn't really helpful, so how about we rename some other columns?</p>
<div class="highlight">
<pre><span></span><span class="n">flights</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rename</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="n">destination</span><span class="o">=</span><span class="n">dest</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgb3c235b">
<h2 id="orgb3c235b">Mutate</h2>
<div class="outline-text-2" id="text-orgb3c235b">
<p>The <code>mutate</code> function adds a column (or columns) to the end of the dataframe based on things you tell it to do to one or more other columns.</p>
<p>First, we'll grabs a subset of columns to make this easier to see.</p>
<div class="highlight">
<pre><span></span><span class="n">subset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="nf">ends_with</span><span class="p">(</span><span class="s">"delay"</span><span class="p">),</span><span class="w"> </span><span class="n">air_time</span><span class="p">,</span><span class="w"> </span><span class="n">distance</span><span class="p">)</span>
<span class="nf">khead</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">dep_delay</th>
<th class="org-right" scope="col">arr_delay</th>
<th class="org-right" scope="col">air_time</th>
<th class="org-right" scope="col">distance</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">2</td>
<td class="org-right">11</td>
<td class="org-right">227</td>
<td class="org-right">1400</td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-right">20</td>
<td class="org-right">227</td>
<td class="org-right">1416</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-right">33</td>
<td class="org-right">160</td>
<td class="org-right">1089</td>
</tr>
<tr>
<td class="org-right">-1</td>
<td class="org-right">-18</td>
<td class="org-right">183</td>
<td class="org-right">1576</td>
</tr>
<tr>
<td class="org-right">-6</td>
<td class="org-right">-25</td>
<td class="org-right">116</td>
<td class="org-right">762</td>
</tr>
<tr>
<td class="org-right">-4</td>
<td class="org-right">12</td>
<td class="org-right">150</td>
<td class="org-right">719</td>
</tr>
</tbody>
</table>
<p>Now to add a couple of columns giving the difference between how late they arrived and how late they left and the average speed.</p>
<div class="highlight">
<pre><span></span><span class="nf">khead</span><span class="p">(</span><span class="nf">mutate</span><span class="p">(</span><span class="n">subset</span><span class="p">,</span>
<span class="w">             </span><span class="n">Time_Made_Up</span><span class="o">=</span><span class="n">dep_delay</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">arr_delay</span><span class="p">,</span>
<span class="w">             </span><span class="n">Miles_Per_Minute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">distance</span><span class="o">/</span><span class="n">air_time</span>
<span class="w">             </span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">dep_delay</th>
<th class="org-right" scope="col">arr_delay</th>
<th class="org-right" scope="col">air_time</th>
<th class="org-right" scope="col">distance</th>
<th class="org-right" scope="col">Time_Made_Up</th>
<th class="org-right" scope="col">Miles_Per_Minute</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">2</td>
<td class="org-right">11</td>
<td class="org-right">227</td>
<td class="org-right">1400</td>
<td class="org-right">-9</td>
<td class="org-right">6.167401</td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-right">20</td>
<td class="org-right">227</td>
<td class="org-right">1416</td>
<td class="org-right">-16</td>
<td class="org-right">6.237885</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-right">33</td>
<td class="org-right">160</td>
<td class="org-right">1089</td>
<td class="org-right">-31</td>
<td class="org-right">6.806250</td>
</tr>
<tr>
<td class="org-right">-1</td>
<td class="org-right">-18</td>
<td class="org-right">183</td>
<td class="org-right">1576</td>
<td class="org-right">17</td>
<td class="org-right">8.612022</td>
</tr>
<tr>
<td class="org-right">-6</td>
<td class="org-right">-25</td>
<td class="org-right">116</td>
<td class="org-right">762</td>
<td class="org-right">19</td>
<td class="org-right">6.568966</td>
</tr>
<tr>
<td class="org-right">-4</td>
<td class="org-right">12</td>
<td class="org-right">150</td>
<td class="org-right">719</td>
<td class="org-right">-16</td>
<td class="org-right">4.793333</td>
</tr>
</tbody>
</table>
</div>
<div class="outline-3" id="outline-container-orgfbfceb7">
<h3 id="orgfbfceb7">Transmute</h3>
<div class="outline-text-3" id="text-orgfbfceb7">
<p>This is like the <code>mutate</code> function but it only keeps the new columns you created, not the original columns.</p>
<div class="highlight">
<pre><span></span><span class="nf">khead</span><span class="p">(</span><span class="nf">transmute</span><span class="p">(</span><span class="n">subset</span><span class="p">,</span>
<span class="w">       </span><span class="n">Time_Made_Up</span><span class="o">=</span><span class="n">dep_delay</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">arr_delay</span><span class="p">,</span>
<span class="w">       </span><span class="n">Miles_Per_Hour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">distance</span><span class="o">/</span><span class="p">(</span><span class="n">air_time</span><span class="o">/</span><span class="m">60</span><span class="p">)</span>
<span class="w">       </span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">Time_Made_Up</th>
<th class="org-right" scope="col">Miles_Per_Hour</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">-9</td>
<td class="org-right">370.0441</td>
</tr>
<tr>
<td class="org-right">-16</td>
<td class="org-right">374.2731</td>
</tr>
<tr>
<td class="org-right">-31</td>
<td class="org-right">408.3750</td>
</tr>
<tr>
<td class="org-right">17</td>
<td class="org-right">516.7213</td>
</tr>
<tr>
<td class="org-right">19</td>
<td class="org-right">394.1379</td>
</tr>
<tr>
<td class="org-right">-16</td>
<td class="org-right">287.6000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org44ef35d">
<h2 id="org44ef35d">Summarize</h2>
<div class="outline-text-2" id="text-org44ef35d">
<p><code>summarize</code> reduces a collection of numbers to a single summary statistic. As an example we can look at the median departure delay. First, let's check if it has any missing values.</p>
<div class="highlight">
<pre><span></span><span class="nf">got_all_your_data</span><span class="p">(</span><span class="n">flights</span><span class="o">$</span><span class="n">dep_delay</span><span class="p">)</span>
</pre></div>
<pre class="example">
[1] FALSE
attr(,"msg")
[1] "data contains 8255 missing values"
</pre>
<p>Okay, so we'll just tell <code>median</code> to ignore it.</p>
<div class="highlight">
<pre><span></span><span class="nf">okable</span><span class="p">(</span><span class="nf">summarize</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="n">median_departure_delay</span><span class="o">=</span><span class="nf">median</span><span class="p">(</span><span class="n">dep_delay</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">median_departure_delay</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">-2</td>
</tr>
</tbody>
</table>
<p>What if we hadn't ignored the missing?</p>
<div class="highlight">
<pre><span></span><span class="nf">okable</span><span class="p">(</span><span class="nf">summarize</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="n">median_departure_delay</span><span class="o">=</span><span class="nf">median</span><span class="p">(</span><span class="n">dep_delay</span><span class="p">)))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">median_departure_delay</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">NA</td>
</tr>
</tbody>
</table>
<p>The R summary functions like <code>median</code> and <code>mean</code> consider any missing data invalid unless you tell it to ignore the missing. How is this use of <code>summarize</code> different from just calling <code>median</code>?</p>
<div class="highlight">
<pre><span></span><span class="nf">median</span><span class="p">(</span><span class="n">flights</span><span class="o">$</span><span class="n">dep_delay</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
</pre></div>
<pre class="example">
[1] -2
</pre>
<p>Well, it doesn't look quite as nice. So, you might think, well, all we did was add a columns name, was that useful?</p>
</div>
<div class="outline-3" id="outline-container-orgd715421">
<h3 id="orgd715421">Grouping</h3>
<div class="outline-text-3" id="text-orgd715421">
<p>The reason for <code>summarize</code> is that it works in tandem with groups. Instead of finding the median for the whole column, we can find the median by group.</p>
<div class="highlight">
<pre><span></span><span class="n">by_month</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">group_by</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span><span class="w"> </span><span class="n">month</span><span class="p">)</span>

<span class="nf">okable</span><span class="p">(</span><span class="nf">summarize</span><span class="p">(</span><span class="n">by_month</span><span class="p">,</span><span class="w"> </span><span class="n">median_monthly_delay</span><span class="o">=</span><span class="nf">median</span><span class="p">(</span><span class="n">dep_delay</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">month</th>
<th class="org-right" scope="col">median_monthly_delay</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">-2</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-right">-2</td>
</tr>
<tr>
<td class="org-right">3</td>
<td class="org-right">-1</td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-right">-2</td>
</tr>
<tr>
<td class="org-right">5</td>
<td class="org-right">-1</td>
</tr>
<tr>
<td class="org-right">6</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">7</td>
<td class="org-right">0</td>
</tr>
<tr>
<td class="org-right">8</td>
<td class="org-right">-1</td>
</tr>
<tr>
<td class="org-right">9</td>
<td class="org-right">-3</td>
</tr>
<tr>
<td class="org-right">10</td>
<td class="org-right">-3</td>
</tr>
<tr>
<td class="org-right">11</td>
<td class="org-right">-3</td>
</tr>
<tr>
<td class="org-right">12</td>
<td class="org-right">0</td>
</tr>
</tbody>
</table>
<p>Is that right? Let's look at a boxplot of the dataset and check.</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">by_month</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_boxplot</span><span class="p">(</span>
<span class="w">    </span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">dep_delay</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="nf">factor</span><span class="p">(</span><span class="n">month</span><span class="p">)),</span><span class="w"> </span>
<span class="w">    </span><span class="n">outlier.shape</span><span class="o">=</span><span class="kc">NA</span><span class="p">,</span>
<span class="w">    </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">limits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">quantile</span><span class="p">(</span><span class="n">by_month</span><span class="o">$</span><span class="n">dep_delay</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0.9</span><span class="p">),</span>
<span class="w">                                       </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Monthly Delays"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="s">"Month"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">"Delay (Minutes)"</span><span class="p">)</span>


<span class="nf">ggsave</span><span class="p">(</span><span class="s">"monthly_delay_boxplot.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/a-first-look-at-dplyr/monthly_delay_boxplot.png"></p>
<p>So, that isn't so exciting, but it does show that the median values tend to be negative (meaning they left early) like our summary said.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org3e05c78">
<h3 id="org3e05c78">Hitting the Pipe</h3>
<div class="outline-text-3" id="text-org3e05c78">
<p><code>dplyr</code> adds an operator called the "pipe" (<code>%&gt;%</code>) that works like a unix pipe does, sending the output of one function to another, allowing you to save some keystrokes adding temporary variables or nesting function calls.</p>
<p>So, here's what we're going to do.</p>
<ul class="org-ul">
<li>We're going to pass the <code>flights</code> dataset to the <code>group_by</code> function and group the data by destination</li>
<li>Then we're going to pass that output to the <code>summarize</code> function and summarize by:
<ul class="org-ul">
<li>the counts</li>
<li>mean distance of the flight</li>
<li>and the mean arrival delay of each group</li>
</ul>
</li>
<li>Then we're going to pass the summarized data to <code>filter</code> to get the top 20 that didn't go to Honolulu.</li>
</ul>
<p>First let's do a check for missing values.</p>
<div class="highlight">
<pre><span></span><span class="nf">got_all_your_data</span><span class="p">(</span><span class="n">flights</span><span class="o">$</span><span class="n">arr_delay</span><span class="p">)</span>
<span class="nf">got_all_your_data</span><span class="p">(</span><span class="n">flights</span><span class="o">$</span><span class="n">distance</span><span class="p">)</span>
</pre></div>
<pre class="example">
[1] FALSE
attr(,"msg")
[1] "data contains 9430 missing values"
[1] TRUE
</pre>
<p>There's no missing distances but there are missing arrival delays.</p>
<div class="highlight">
<pre><span></span><span class="n">delays_vs_distance</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">flights</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">group_by</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">summarize</span><span class="p">(</span>
<span class="w">    </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">n</span><span class="p">(),</span>
<span class="w">    </span><span class="n">distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span>
<span class="w">    </span><span class="n">delay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">mean</span><span class="p">(</span><span class="n">arr_delay</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">destination</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">"HNL"</span><span class="p">)</span>

<span class="nf">khead</span><span class="p">(</span><span class="n">delays_vs_distance</span><span class="p">)</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">destination</th>
<th class="org-right" scope="col">count</th>
<th class="org-right" scope="col">distance</th>
<th class="org-right" scope="col">delay</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">ABQ</td>
<td class="org-right">254</td>
<td class="org-right">1826.0000</td>
<td class="org-right">4.381890</td>
</tr>
<tr>
<td class="org-left">ACK</td>
<td class="org-right">265</td>
<td class="org-right">199.0000</td>
<td class="org-right">4.852273</td>
</tr>
<tr>
<td class="org-left">ALB</td>
<td class="org-right">439</td>
<td class="org-right">143.0000</td>
<td class="org-right">14.397129</td>
</tr>
<tr>
<td class="org-left">ATL</td>
<td class="org-right">17215</td>
<td class="org-right">757.1082</td>
<td class="org-right">11.300113</td>
</tr>
<tr>
<td class="org-left">AUS</td>
<td class="org-right">2439</td>
<td class="org-right">1514.2530</td>
<td class="org-right">6.019909</td>
</tr>
<tr>
<td class="org-left">AVL</td>
<td class="org-right">275</td>
<td class="org-right">583.5818</td>
<td class="org-right">8.003831</td>
</tr>
</tbody>
</table>
<p>Note that we're using the mean here, not the median, so there's going to be more variation because of all the outliers. Also, because there are some missing values we had to tell the <code>mean</code> function to ignore them - otherwise the default is to return <code>NA</code> if any values are missing. There weren't any missing <code>distance</code> rows, but passing that argument in doesn't do any harm, I don't think. Now let's plot it.</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">delays_vs_distance</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">distance</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">delay</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">count</span><span class="p">),</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">0.4</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_smooth</span><span class="p">(</span><span class="n">se</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Distance Traveled vs Arrival Delay"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="s">"Distance (Miles)"</span><span class="p">,</span>
<span class="w">       </span><span class="n">y</span><span class="o">=</span><span class="s">"Delay (Minutes)"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"distance_vs_delay.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/a-first-look-at-dplyr/distance_vs_delay.png"></p>
<p>It looks like up to a point the further you travel the worse the delay, and then it starts going in the opposite direction, with longer flights having shorter delays in their arrival times.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org3a38996">
<h2 id="org3a38996">Link Collection</h2>
<div class="outline-text-2" id="text-org3a38996">
<ul class="org-ul">
<li><a href="https://cran.r-project.org/web/packages/ascii/index.html">ascii</a>: The R package to help change R-output to work better with org-mode.</li>
<li><a href="https://github.com/hadley/assertthat">assertthat</a>: R assertions.</li>
<li><a href="https://www.bts.gov/">Bureau of Transportation Statistics</a>: This is where the <code>flights</code> dataset originally comes from.</li>
<li><a href="https://dplyr.tidyverse.org/">dplyr</a>: the tidyverse page for this package</li>
<li><a href="https://bookdown.org/yihui/rmarkdown-cookbook/kable.html">rmarkdown-cookbook</a>: This page is about <code>knitr's</code> <code>kable</code> command.</li>
<li><a href="https://www.rdocumentation.org/packages/nycflights13/versions/1.0.1"><code>nycflights13</code></a>: A description of the datasets in this package.</li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/r-for-data-science/index.html">R For Data Science</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/r-for-data-science/index.html" rel="bookmark"><time class="published dt-published" datetime="2021-12-14T16:10:01-08:00" itemprop="datePublished" title="2021-12-14 16:10">2021-12-14 16:10</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div class="outline-2" id="outline-container-org1112ac9">
<h2 id="org1112ac9">Table Of Contents</h2>
<div class="outline-text-2" id="text-org1112ac9">
<ul class="org-ul">
<li>Preface</li>
<li>Explore
<ul class="org-ul">
<li>Data Visualization with GGPlot2</li>
<li>Workflow: Basics</li>
<li>Data Transformation With DPlyr</li>
<li>Workflow: Scripts</li>
<li>Exploratory Data Analysis</li>
<li>Workflow: Projects</li>
</ul>
</li>
<li>Wrangle
<ul class="org-ul">
<li>Tibbles With Tibble</li>
<li>Data Import With Readr</li>
<li>Tidy Data With Tidyr</li>
<li>Relational Data With Dplyr</li>
<li>Strings With Stringr</li>
<li>Factors With Forcats</li>
<li>Dates and Times With Lubridate</li>
</ul>
</li>
<li>Program
<ul class="org-ul">
<li>Pipes With Magrittr</li>
<li>Functions</li>
<li>Vectors</li>
<li>Iterations With Purrr</li>
</ul>
</li>
<li>Model
<ul class="org-ul">
<li>Model Basics With Modelr</li>
<li>Model Building</li>
<li>Many Models With Purrr and Broom</li>
</ul>
</li>
<li>Communicate
<ul class="org-ul">
<li>R Markdown</li>
<li>Graphics For Communication With GGPlot2</li>
<li>R Markdown Formats</li>
<li>R Markdown Workflow</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgdd08b81">
<h2 id="orgdd08b81">Links</h2>
<div class="outline-text-2" id="text-orgdd08b81">
<ul class="org-ul">
<li>Online Version: <a href="https://r4ds.had.co.nz/">https://r4ds.had.co.nz/</a></li>
<li>Github Source (for the book, written in R Markdown): <a href="https://github.com/hadley/r4ds/blob/main/index.Rmd">https://github.com/hadley/r4ds/blob/main/index.Rmd</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgf9e38aa">
<h2 id="orgf9e38aa">Citation</h2>
<div class="outline-text-2" id="text-orgf9e38aa">
<ul class="org-ul">
<li>[RFDS] Wickham H, Grolemund G. R for data science: import, tidy, transform, visualize, and model data. First edition. Sebastopol, CA: O’Reilly; 2016. 492 p.</li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/a-look-at-ggplot/index.html">A Look At ggplot</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/a-look-at-ggplot/index.html" rel="bookmark"><time class="published dt-published" datetime="2021-12-13T14:34:19-08:00" itemprop="datePublished" title="2021-12-13 14:34">2021-12-13 14:34</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/a-look-at-ggplot/index.html#org72f76ba">Introduction</a></li>
<li><a href="posts/a-look-at-ggplot/index.html#orgfac81e7">Set Up Stuff</a>
<ul>
<li><a href="posts/a-look-at-ggplot/index.html#org54b53f8">Imports</a></li>
<li><a href="posts/a-look-at-ggplot/index.html#orga77a128">Constants</a></li>
<li><a href="posts/a-look-at-ggplot/index.html#org2bc5e3f">The GGPlot2 Theme</a></li>
</ul>
</li>
<li><a href="posts/a-look-at-ggplot/index.html#orgabb7a30">The MPG Dataset</a>
<ul>
<li><a href="posts/a-look-at-ggplot/index.html#orgb5ef995">The Variables</a></li>
<li><a href="posts/a-look-at-ggplot/index.html#org616a5e2">Renaming Some Columns</a></li>
<li><a href="posts/a-look-at-ggplot/index.html#orgb5a65ba">Looking at the Data</a></li>
<li><a href="posts/a-look-at-ggplot/index.html#org311cc30">Some Renaming</a>
<ul>
<li><a href="posts/a-look-at-ggplot/index.html#org83a3f84">The Drive Trains</a></li>
<li><a href="posts/a-look-at-ggplot/index.html#org2b5c419">Fuel Types</a></li>
<li><a href="posts/a-look-at-ggplot/index.html#org26a7eec">Transmission</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="posts/a-look-at-ggplot/index.html#orga8a93f9">Displacement Vs Highway Mileage</a></li>
<li><a href="posts/a-look-at-ggplot/index.html#org865a3b8">Ditching the Highway (Mileage)</a>
<ul>
<li><a href="posts/a-look-at-ggplot/index.html#orgdb85834">Combined Mileage</a></li>
<li><a href="posts/a-look-at-ggplot/index.html#orgc5c95b3">Comparing the Two</a></li>
<li><a href="posts/a-look-at-ggplot/index.html#orgc3571ed">Gallons Per Mile</a></li>
</ul>
</li>
<li><a href="posts/a-look-at-ggplot/index.html#org951f1ce">Displacement With Class</a>
<ul>
<li><a href="posts/a-look-at-ggplot/index.html#org62f681a">Efficiency</a></li>
<li><a href="posts/a-look-at-ggplot/index.html#org8fa6ab1">Faceting The Classes</a></li>
<li><a href="posts/a-look-at-ggplot/index.html#org169a75d">Smoothing the Line</a></li>
<li><a href="posts/a-look-at-ggplot/index.html#org7531845">Different Datasets to the Geometries</a></li>
<li><a href="posts/a-look-at-ggplot/index.html#org0dc1fcd">Small Four-Wheel Drive Automobiles</a></li>
</ul>
</li>
<li><a href="posts/a-look-at-ggplot/index.html#org597e438">Bar Plots</a>
<ul>
<li><a href="posts/a-look-at-ggplot/index.html#org8f1c12a">By Count</a></li>
<li><a href="posts/a-look-at-ggplot/index.html#org2231a04">By Proportion</a></li>
<li><a href="posts/a-look-at-ggplot/index.html#orgb6b544f">Un-Stacked</a></li>
<li><a href="posts/a-look-at-ggplot/index.html#org2edbb30">Proportions Not Counts</a></li>
</ul>
</li>
<li><a href="posts/a-look-at-ggplot/index.html#org9667a4c">Stat Summary</a>
<ul>
<li><a href="posts/a-look-at-ggplot/index.html#org842385e">Boxplot</a></li>
</ul>
</li>
<li><a href="posts/a-look-at-ggplot/index.html#org449a289">The End</a></li>
<li><a href="posts/a-look-at-ggplot/index.html#org45647f2">Link Collection</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org72f76ba">
<h2 id="org72f76ba">Introduction</h2>
<div class="outline-text-2" id="text-org72f76ba">
<p>This is a quick walk-through of some aspects of <a href="https://ggplot2.tidyverse.org/">ggplot2</a> based on the first chapter of {% doc %}r-for-data-science{% /doc %}.</p>
</div>
</div>
<div class="outline-2" id="outline-container-orgfac81e7">
<h2 id="orgfac81e7">Set Up Stuff</h2>
<div class="outline-text-2" id="text-orgfac81e7"></div>
<div class="outline-3" id="outline-container-org54b53f8">
<h3 id="org54b53f8">Imports</h3>
<div class="outline-text-3" id="text-org54b53f8">
<p><b>Note:</b> When you run the first code block to start the session, remember to give it the path to the posts-output folder so you don't need the path when saving the plots.</p>
<div class="highlight">
<pre><span></span><span class="nf">library</span><span class="p">(</span><span class="s">"assertthat"</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="s">"ggplot2"</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="s">"knitr"</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="s">"tidyverse"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orga77a128">
<h3 id="orga77a128">Constants</h3>
<div class="outline-text-3" id="text-orga77a128">
<p>These are stuff that get re-used in the plotting.</p>
<div class="highlight">
<pre><span></span><span class="n">DISPLACEMENT</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">"Engine Displacement (Liters)"</span>
<span class="n">EFFICIENCY</span><span class="w"> </span><span class="o">&lt;-</span><span class="s">"Gallons Per Mile (Combined)"</span>
<span class="n">DISPLACEMENT_VS_EFFICIENCY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">partial</span><span class="p">(</span><span class="n">labs</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="n">DISPLACEMENT</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">EFFICIENCY</span><span class="p">)</span>

<span class="n">BLUE</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">"#4687b7"</span>
<span class="n">RED</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">"#ce7b6d"</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org2bc5e3f">
<h3 id="org2bc5e3f">The GGPlot2 Theme</h3>
<div class="outline-text-3" id="text-org2bc5e3f">
<div class="highlight">
<pre><span></span><span class="nf">theme_set</span><span class="p">(</span><span class="nf">theme_minimal</span><span class="p">(</span><span class="n">base_family</span><span class="o">=</span><span class="s">"Palatino"</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgabb7a30">
<h2 id="orgabb7a30">The MPG Dataset</h2>
<div class="outline-text-2" id="text-orgabb7a30">
<p>For some reason loading <code>ggplot2</code> also loads this dataset. Its short description is "Fuel economy data from 1999 to 2008 for 38 popular models of cars". The long description:</p>
<blockquote>
<p>This dataset contains a subset of the fuel economy data that the EPA makes available on &lt;URL: <a href="https://fueleconomy.gov/">https://fueleconomy.gov/</a>&gt;. It contains only models which had a new release every year between 1999 and 2008 - this was used as a proxy for the popularity of the car.</p>
</blockquote>
</div>
<div class="outline-3" id="outline-container-orgb5ef995">
<h3 id="orgb5ef995">The Variables</h3>
<div class="outline-text-3" id="text-orgb5ef995">
<p>It's a data frame with 234 rows and 11 variables:</p>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Variable</th>
<th class="org-left" scope="col">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">manufacturer</td>
<td class="org-left">manufacturer name</td>
</tr>
<tr>
<td class="org-left">model</td>
<td class="org-left">model name</td>
</tr>
<tr>
<td class="org-left">displ</td>
<td class="org-left">engine displacement, in litres</td>
</tr>
<tr>
<td class="org-left">year</td>
<td class="org-left">year of manufacture</td>
</tr>
<tr>
<td class="org-left">cyl</td>
<td class="org-left">number of cylinders</td>
</tr>
<tr>
<td class="org-left">trans</td>
<td class="org-left">type of transmission</td>
</tr>
<tr>
<td class="org-left">drv</td>
<td class="org-left">drive train (<a href="posts/a-look-at-ggplot/index.html#org83a3f84">listed below</a>)</td>
</tr>
<tr>
<td class="org-left">cty</td>
<td class="org-left">city miles per gallon</td>
</tr>
<tr>
<td class="org-left">hwy</td>
<td class="org-left">highway miles per gallon</td>
</tr>
<tr>
<td class="org-left">fl</td>
<td class="org-left">fuel type</td>
</tr>
<tr>
<td class="org-left">class</td>
<td class="org-left">"type" of car</td>
</tr>
</tbody>
</table>
<p>I'll do some column renaming here since I keep forgetting what abbreviations they used.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org616a5e2">
<h3 id="org616a5e2">Renaming Some Columns</h3>
<div class="outline-text-3" id="text-org616a5e2">
<div class="highlight">
<pre><span></span><span class="n">mpg</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mpg</span><span class="w"> </span><span class="o">%&gt;%</span>
<span class="w">  </span><span class="nf">rename</span><span class="p">(</span>
<span class="w">    </span><span class="n">displacement</span><span class="o">=</span><span class="n">displ</span><span class="p">,</span>
<span class="w">    </span><span class="n">cylinders</span><span class="o">=</span><span class="n">cyl</span><span class="p">,</span>
<span class="w">    </span><span class="n">transmission</span><span class="o">=</span><span class="n">trans</span><span class="p">,</span>
<span class="w">    </span><span class="n">drive_train</span><span class="o">=</span><span class="n">drv</span><span class="p">,</span>
<span class="w">    </span><span class="n">city_mpg</span><span class="o">=</span><span class="n">cty</span><span class="p">,</span>
<span class="w">    </span><span class="n">highway_mpg</span><span class="o">=</span><span class="n">hwy</span><span class="p">,</span>
<span class="w">    </span><span class="n">fuel_type</span><span class="o">=</span><span class="n">fl</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>

<span class="nf">str</span><span class="p">(</span><span class="n">mpg</span><span class="p">)</span>
</pre></div>
<pre class="example" id="orgc3667dc">
tibble [234 × 11] (S3: tbl_df/tbl/data.frame)
 $ manufacturer: chr [1:234] "audi" "audi" "audi" "audi" ...
 $ model       : chr [1:234] "a4" "a4" "a4" "a4" ...
 $ displacement: num [1:234] 1.8 1.8 2 2 2.8 2.8 3.1 1.8 1.8 2 ...
 $ year        : int [1:234] 1999 1999 2008 2008 1999 1999 2008 1999 1999 2008 ...
 $ cylinders   : int [1:234] 4 4 4 4 6 6 6 4 4 4 ...
 $ transmission: chr [1:234] "auto(l5)" "manual(m5)" "manual(m6)" "auto(av)" ...
 $ drive_train : chr [1:234] "f" "f" "f" "f" ...
 $ city_mpg    : int [1:234] 18 21 20 21 16 18 18 18 16 20 ...
 $ highway_mpg : int [1:234] 29 29 31 30 26 26 27 26 25 28 ...
 $ fuel_type   : chr [1:234] "p" "p" "p" "p" ...
 $ class       : chr [1:234] "compact" "compact" "compact" "compact" ...
</pre></div>
</div>
<div class="outline-3" id="outline-container-orgb5a65ba">
<h3 id="orgb5a65ba">Looking at the Data</h3>
<div class="outline-text-3" id="text-orgb5a65ba">
<div class="highlight">
<pre><span></span><span class="nf">kable</span><span class="p">(</span><span class="nf">head</span><span class="p">(</span><span class="n">mpg</span><span class="p">),</span><span class="w"> </span><span class="n">caption</span><span class="o">=</span><span class="s">"MPG Dataset (EPA Automobile Data)"</span><span class="p">)</span>
</pre></div>
<p>Table: MPG Dataset (EPA Automobile Data)</p>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">manufacturer</th>
<th class="org-left" scope="col">model</th>
<th class="org-right" scope="col">displacement</th>
<th class="org-right" scope="col">year</th>
<th class="org-right" scope="col">cylinders</th>
<th class="org-left" scope="col">transmission</th>
<th class="org-left" scope="col">drive_train</th>
<th class="org-right" scope="col">city_mpg</th>
<th class="org-right" scope="col">highway_mpg</th>
<th class="org-left" scope="col">fuel_type</th>
<th class="org-left" scope="col">class</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">audi</td>
<td class="org-left">a4</td>
<td class="org-right">1.8</td>
<td class="org-right">1999</td>
<td class="org-right">4</td>
<td class="org-left">auto(l5)</td>
<td class="org-left">f</td>
<td class="org-right">18</td>
<td class="org-right">29</td>
<td class="org-left">p</td>
<td class="org-left">compact</td>
</tr>
<tr>
<td class="org-left">audi</td>
<td class="org-left">a4</td>
<td class="org-right">1.8</td>
<td class="org-right">1999</td>
<td class="org-right">4</td>
<td class="org-left">manual(m5)</td>
<td class="org-left">f</td>
<td class="org-right">21</td>
<td class="org-right">29</td>
<td class="org-left">p</td>
<td class="org-left">compact</td>
</tr>
<tr>
<td class="org-left">audi</td>
<td class="org-left">a4</td>
<td class="org-right">2.0</td>
<td class="org-right">2008</td>
<td class="org-right">4</td>
<td class="org-left">manual(m6)</td>
<td class="org-left">f</td>
<td class="org-right">20</td>
<td class="org-right">31</td>
<td class="org-left">p</td>
<td class="org-left">compact</td>
</tr>
<tr>
<td class="org-left">audi</td>
<td class="org-left">a4</td>
<td class="org-right">2.0</td>
<td class="org-right">2008</td>
<td class="org-right">4</td>
<td class="org-left">auto(av)</td>
<td class="org-left">f</td>
<td class="org-right">21</td>
<td class="org-right">30</td>
<td class="org-left">p</td>
<td class="org-left">compact</td>
</tr>
<tr>
<td class="org-left">audi</td>
<td class="org-left">a4</td>
<td class="org-right">2.8</td>
<td class="org-right">1999</td>
<td class="org-right">6</td>
<td class="org-left">auto(l5)</td>
<td class="org-left">f</td>
<td class="org-right">16</td>
<td class="org-right">26</td>
<td class="org-left">p</td>
<td class="org-left">compact</td>
</tr>
<tr>
<td class="org-left">audi</td>
<td class="org-left">a4</td>
<td class="org-right">2.8</td>
<td class="org-right">1999</td>
<td class="org-right">6</td>
<td class="org-left">manual(m5)</td>
<td class="org-left">f</td>
<td class="org-right">18</td>
<td class="org-right">26</td>
<td class="org-left">p</td>
<td class="org-left">compact</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-3" id="outline-container-org311cc30">
<h3 id="org311cc30">Some Renaming</h3>
<div class="outline-text-3" id="text-org311cc30"></div>
<div class="outline-4" id="outline-container-org83a3f84">
<h4 id="org83a3f84">The Drive Trains</h4>
<div class="outline-text-4" id="text-org83a3f84">
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Abbreviation</th>
<th class="org-left" scope="col">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">f</td>
<td class="org-left">Front-Wheel Drive</td>
</tr>
<tr>
<td class="org-left">r</td>
<td class="org-left">Rear-Wheel Drive</td>
</tr>
<tr>
<td class="org-left">4</td>
<td class="org-left">Four-Wheel Drive</td>
</tr>
</tbody>
</table>
<p>These aren't too obscure, but I think I'll rename them anyway.</p>
<div class="highlight">
<pre><span></span><span class="n">mpg</span><span class="o">$</span><span class="n">drive_train</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">recode</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">drive_train</span><span class="p">,</span>
<span class="w">                          </span><span class="n">f</span><span class="o">=</span><span class="s">"Front-Wheel"</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="o">=</span><span class="s">"Rear-Wheel"</span><span class="p">,</span><span class="w"> </span><span class="n">`4`</span><span class="o">=</span><span class="s">"Four-Wheel"</span><span class="w"> </span><span class="p">)</span>
<span class="nf">kable</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">drive_train</span><span class="p">),</span><span class="w"> </span><span class="n">col.names</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">"Drives"</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Drives</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Front-Wheel</td>
</tr>
<tr>
<td class="org-left">Four-Wheel</td>
</tr>
<tr>
<td class="org-left">Rear-Wheel</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="nf">assert_that</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">drive_train</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org2b5c419">
<h4 id="org2b5c419">Fuel Types</h4>
<div class="outline-text-4" id="text-org2b5c419">
<p>Although this is about <code>ggplot2</code>, and the data is sort of a side effect, since I had to look some of this data up to figure out what it meant (at <a href="https://www.fueleconomy.gov/">fueleconomy.gov</a>) I'll use this opportunity to document it by updating the data.</p>
<div class="highlight">
<pre><span></span><span class="n">mpg</span><span class="o">$</span><span class="n">fuel_type</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">recode</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">fuel_type</span><span class="p">,</span>
<span class="w">                        </span><span class="n">p</span><span class="o">=</span><span class="s">"Premium Unleaded"</span><span class="p">,</span>
<span class="w">                        </span><span class="n">r</span><span class="o">=</span><span class="s">"Regular Unleaded"</span><span class="p">,</span>
<span class="w">                        </span><span class="n">e</span><span class="o">=</span><span class="s">"Ethanol"</span><span class="p">,</span>
<span class="w">                        </span><span class="n">d</span><span class="o">=</span><span class="s">"Diesel Fuel"</span><span class="p">,</span>
<span class="w">                        </span><span class="n">c</span><span class="o">=</span><span class="s">"Compressed Natural Gas"</span><span class="p">)</span>

<span class="nf">kable</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">fuel_type</span><span class="p">),</span><span class="w"> </span><span class="n">col.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">"Fuel Type"</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Fuel Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Premium Unleaded</td>
</tr>
<tr>
<td class="org-left">Regular Unleaded</td>
</tr>
<tr>
<td class="org-left">Ethanol</td>
</tr>
<tr>
<td class="org-left">Diesel Fuel</td>
</tr>
<tr>
<td class="org-left">Compressed Natural Gas</td>
</tr>
</tbody>
</table>
<p>For some reason I couldn't find a table that directly mapped to the data set so I'm sort of guessing that this is what they stood for based on the 1999 guide on their <a href="https://www.fueleconomy.gov/feg/download.shtml">download page</a>. There's also a <code>L</code> for <b>Liquified Petroleum Gas (Propane)</b> in the guide but it's not in the data set.</p>
<div class="highlight">
<pre><span></span><span class="nf">assert_that</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">fuel_type</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org26a7eec">
<h4 id="org26a7eec">Transmission</h4>
<div class="outline-text-4" id="text-org26a7eec">
<div class="highlight">
<pre><span></span><span class="n">mpg</span><span class="o">$</span><span class="n">transmission</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">recode</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">transmission</span><span class="p">,</span>
<span class="w">                           </span><span class="n">`auto(av)`</span><span class="o">=</span><span class="s">"Continuously Variable"</span><span class="p">,</span>
<span class="w">                           </span><span class="n">`auto(s4)`</span><span class="o">=</span><span class="s">"Automatic 4-Speed"</span><span class="p">,</span>
<span class="w">                           </span><span class="n">`auto(s5)`</span><span class="o">=</span><span class="s">"Automatic 5-Speed"</span><span class="p">,</span>
<span class="w">                           </span><span class="n">`auto(s6)`</span><span class="o">=</span><span class="s">"Automatic 6-Speed"</span><span class="p">,</span>
<span class="w">                           </span><span class="n">`auto(l3)`</span><span class="o">=</span><span class="s">"Automatic Lockup 3-Speed"</span><span class="p">,</span>
<span class="w">                           </span><span class="n">`auto(l4)`</span><span class="o">=</span><span class="s">"Automatic Lockup 4-Speed"</span><span class="p">,</span>
<span class="w">                           </span><span class="n">`auto(l5)`</span><span class="o">=</span><span class="s">"Automatic Lockup 5-Speed"</span><span class="p">,</span>
<span class="w">                           </span><span class="n">`auto(l6)`</span><span class="o">=</span><span class="s">"Automatic Lockup 6-Speed"</span><span class="p">,</span>
<span class="w">                           </span><span class="n">`manual(m5)`</span><span class="o">=</span><span class="s">"Manual 5-Speed"</span><span class="p">,</span>
<span class="w">                           </span><span class="n">`manual(m6)`</span><span class="o">=</span><span class="s">"Manual 6-Speed"</span>
<span class="w">                           </span><span class="p">)</span>

<span class="nf">kable</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">transmission</span><span class="p">),</span><span class="w"> </span><span class="n">col.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">"Transmission"</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Transmission</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Automatic Lockup 5-Speed</td>
</tr>
<tr>
<td class="org-left">Manual 5-Speed</td>
</tr>
<tr>
<td class="org-left">Manual 6-Speed</td>
</tr>
<tr>
<td class="org-left">Continuously Variable</td>
</tr>
<tr>
<td class="org-left">Automatic 6-Speed</td>
</tr>
<tr>
<td class="org-left">Automatic Lockup 4-Speed</td>
</tr>
<tr>
<td class="org-left">Automatic Lockup 3-Speed</td>
</tr>
<tr>
<td class="org-left">Automatic Lockup 6-Speed</td>
</tr>
<tr>
<td class="org-left">Automatic 5-Speed</td>
</tr>
<tr>
<td class="org-left">Automatic 4-Speed</td>
</tr>
</tbody>
</table>
<p>Strangely, there's no listing for 4-speed manual transmissions.</p>
<div class="highlight">
<pre><span></span><span class="nf">assert_that</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">transmission</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orga8a93f9">
<h2 id="orga8a93f9">Displacement Vs Highway Mileage</h2>
<div class="outline-text-2" id="text-orga8a93f9">
<p>Now we come to the basic thing that the chapter in <code>R For Data Science</code> looks at (mostly) - what affects mileage for automobiles. The first thing we'll do is look at how the size of the engine affects the mileage.</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displacement</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">highway_mpg</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">highway_mpg</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">DISPLACEMENT</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">"Highway MPG"</span><span class="p">,</span>
<span class="w">       </span><span class="n">title</span><span class="o">=</span><span class="s">"Displacement vs Mileage"</span><span class="p">)</span>

<span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"displacement_vs_mileage.png"</span>
<span class="nf">ggsave</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/a-look-at-ggplot/displacement_vs_mileage.png"></p>
<p>It has a roughly linear relationship, as you might expect, but the rest of this post is about how to get more information out of the data using <code>ggplot2</code>.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org865a3b8">
<h2 id="org865a3b8">Ditching the Highway (Mileage)</h2>
<div class="outline-text-2" id="text-org865a3b8"></div>
<div class="outline-3" id="outline-container-orgdb85834">
<h3 id="orgdb85834">Combined Mileage</h3>
<div class="outline-text-3" id="text-orgdb85834">
<p>The EPA uses a weighted average to create a combined metric that uses both Highway and City mileage.</p>
<p>\[ \textrm{Combined Fuel Economy} = 0.55 \times \textit{city} + 0.45 \times \textit{highway} \]</p>
<p>I've also seen it done as the harmonic mean (<a href="https://tasks.illustrativemathematics.org/content-standards/tasks/825">on Illustrative Mathematics</a>), but if you round to the nearest whole number it comes out about the same.</p>
<div class="highlight">
<pre><span></span><span class="n">mpg</span><span class="o">$</span><span class="n">combined_fuel_economy</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.55</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">mpg</span><span class="o">$</span><span class="n">city_mpg</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0.45</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">mpg</span><span class="o">$</span><span class="n">highway_mpg</span>

<span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displacement</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">combined_fuel_economy</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">combined_fuel_economy</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">DISPLACEMENT</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">"Combined MPG"</span><span class="p">,</span>
<span class="w">       </span><span class="n">title</span><span class="o">=</span><span class="s">"Displacement vs Mileage"</span><span class="p">)</span>

<span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"displacement_vs_combined_mileage.png"</span>
<span class="nf">ggsave</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/a-look-at-ggplot/displacement_vs_combined_mileage.png"></p>
</div>
</div>
<div class="outline-3" id="outline-container-orgc5c95b3">
<h3 id="orgc5c95b3">Comparing the Two</h3>
<div class="outline-text-3" id="text-orgc5c95b3">
<p>We can plot them together to see how much the combined MPG differs from the highway MPG.</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_smooth</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displacement</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">combined_fuel_economy</span><span class="p">),</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s">"red"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_smooth</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displacement</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">highway_mpg</span><span class="p">),</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s">"blue"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">DISPLACEMENT</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">"MPG"</span><span class="p">,</span>
<span class="w">       </span><span class="n">title</span><span class="o">=</span><span class="s">"Displacement vs Mileage (Highway and Combined)"</span><span class="p">)</span>

<span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"highway_vs_combined_mileage.png"</span>
<span class="nf">ggsave</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/a-look-at-ggplot/highway_vs_combined_mileage.png"></p>
<p>Adding the city mileage drops the mileage somewhat, although the line looks to be about the same shape.</p>
</div>
</div>
<div class="outline-3" id="outline-container-orgc3571ed">
<h3 id="orgc3571ed">Gallons Per Mile</h3>
<div class="outline-text-3" id="text-orgc3571ed">
<p>The EPA's explanation of their <a href="https://www.epa.gov/fueleconomy/text-version-gasoline-label">vehicle labels</a> mentions that the reason why they put a <b>Fuel Consumption Rate</b> is that the <b>Miles Per Gallon</b> metric is actually not a good way to compare mileage - it is subject to a "Miles Per Gallon Illusion" (<a href="https://www.realclearscience.com/blog/2019/02/14/the_miles_per_gallon_illusion.html#!">ReaClearScience</a> has an article about it). Here's how the number of gallons used per 1,000 miles driven changes with miles-per-gallon.</p>
<div class="highlight">
<pre><span></span><span class="n">mileage</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">)</span>
<span class="n">miles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000</span>
<span class="n">gallons_per_1000_miles</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">miles</span><span class="o">/</span><span class="n">mileage</span>

<span class="n">improvement</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">MPG</span><span class="o">=</span><span class="n">mileage</span><span class="p">,</span>
<span class="w">                          </span><span class="n">gallons</span><span class="o">=</span><span class="n">gallons_per_1000_miles</span><span class="p">)</span>
<span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">improvement</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">mileage</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">gallons</span><span class="p">),</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s">"blue"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_line</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">mileage</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">gallons</span><span class="p">),</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s">"blue"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Fuel Consumption vs MPG"</span><span class="p">,</span>
<span class="w">       </span><span class="n">x</span><span class="o">=</span><span class="s">"Miles Per Gallon"</span><span class="p">,</span>
<span class="w">       </span><span class="n">y</span><span class="o">=</span><span class="s">"Gallons Used Per 1,000 Miles"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"gallons_vs_mpg.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/a-look-at-ggplot/gallons_vs_mpg.png"></p>
<p>As you can see the improvement in the number of gallons used goes down pretty fast as the miles-per-gallon goes up. Let's see about adding a fuel-efficency column. What happens when you switch to Gallons Per Mile?</p>
<div class="highlight">
<pre><span></span><span class="n">gallons_per_mile</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mileage</span>
<span class="n">gallons_per_1000_miles</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">miles</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gallons_per_mile</span>

<span class="n">improvement</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">gpm</span><span class="o">=</span><span class="n">gallons_per_mile</span><span class="p">,</span>
<span class="w">                          </span><span class="n">gallons</span><span class="o">=</span><span class="n">gallons_per_1000_miles</span><span class="p">)</span>
<span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">improvement</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">gpm</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">gallons</span><span class="p">),</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s">"blue"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_line</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">gpm</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">gallons</span><span class="p">),</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="s">"blue"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Fuel Consumption vs Gallons Per Mile"</span><span class="p">,</span>
<span class="w">       </span><span class="n">x</span><span class="o">=</span><span class="s">"Gallons Per Mile"</span><span class="p">,</span>
<span class="w">       </span><span class="n">y</span><span class="o">=</span><span class="s">"Gallons Used Per 1,000 Miles"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"gallons_vs_efficiency.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/a-look-at-ggplot/gallons_vs_efficiency.png"></p>
<p>I suppose you could just figure that that'd be the case, but this <i>is</i> about plotting.</p>
<div class="highlight">
<pre><span></span><span class="n">mpg</span><span class="o">$</span><span class="n">gallons_per_mile</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="n">mpg</span><span class="o">$</span><span class="n">combined_fuel_economy</span>

<span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displacement</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">gallons_per_mile</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">DISPLACEMENT_VS_EFFICIENCY</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Displacement vs Fuel Efficiency"</span><span class="p">)</span>

<span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"displacement_vs_fuel_efficiency.png"</span>
<span class="nf">ggsave</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/a-look-at-ggplot/displacement_vs_fuel_efficiency.png"></p>
<p>Even though this is just the inverse of the MPG plot it seems more intuitive to me. I didn't really notice that big outlier at the top when I plotted it using MPG, so I think I'll stick with this.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org951f1ce">
<h2 id="org951f1ce">Displacement With Class</h2>
<div class="outline-text-2" id="text-org951f1ce">
<p>The displacement seems to mostly have a linear relationship with mileage, but there's exceptions, let's see if showing the class of the car reveals any interesting patterns.</p>
<div class="highlight">
<pre><span></span><span class="nf">unique</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">class</span><span class="p">)</span>
</pre></div>
<pre class="example">
[1] "compact"    "midsize"    "suv"        "2seater"    "minivan"   
[6] "pickup"     "subcompact"
</pre></div>
<div class="outline-3" id="outline-container-org62f681a">
<h3 id="org62f681a">Efficiency</h3>
<div class="outline-text-3" id="text-org62f681a">
<div class="highlight">
<pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displacement</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">gallons_per_mile</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">class</span><span class="p">),</span>
<span class="w">             </span><span class="n">position</span><span class="o">=</span><span class="s">"jitter"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">DISPLACEMENT_VS_EFFICIENCY</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Displacement vs Fuel Efficiency"</span><span class="p">)</span>

<span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"displacement_vs_mileage_with_class.png"</span>
<span class="nf">ggsave</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/a-look-at-ggplot/displacement_vs_mileage_with_class.png"></p>
<p>I added a little jitter because it looked like the top outlier was just one point. It looks like 2-seaters and one of the mid-sized cars had unusually good mileage given their engine displacement. What's a two-seater?</p>
<div class="highlight">
<pre><span></span><span class="nf">kable</span><span class="p">(</span><span class="nf">filter</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">class</span><span class="o">==</span><span class="s">"2seater"</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">manufacturer</th>
<th class="org-left" scope="col">model</th>
<th class="org-right" scope="col">displacement</th>
<th class="org-right" scope="col">year</th>
<th class="org-right" scope="col">cylinders</th>
<th class="org-left" scope="col">transmission</th>
<th class="org-left" scope="col">drive_train</th>
<th class="org-right" scope="col">city_mpg</th>
<th class="org-right" scope="col">highway_mpg</th>
<th class="org-left" scope="col">fuel_type</th>
<th class="org-left" scope="col">class</th>
<th class="org-right" scope="col">combined_fuel_economy</th>
<th class="org-right" scope="col">gallons_per_mile</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">chevrolet</td>
<td class="org-left">corvette</td>
<td class="org-right">5.7</td>
<td class="org-right">1999</td>
<td class="org-right">8</td>
<td class="org-left">Manual 6-Speed</td>
<td class="org-left">Rear-Wheel</td>
<td class="org-right">16</td>
<td class="org-right">26</td>
<td class="org-left">Premium Unleaded</td>
<td class="org-left">2seater</td>
<td class="org-right">20.50</td>
<td class="org-right">0.0487805</td>
</tr>
<tr>
<td class="org-left">chevrolet</td>
<td class="org-left">corvette</td>
<td class="org-right">5.7</td>
<td class="org-right">1999</td>
<td class="org-right">8</td>
<td class="org-left">Automatic Lockup 4-Speed</td>
<td class="org-left">Rear-Wheel</td>
<td class="org-right">15</td>
<td class="org-right">23</td>
<td class="org-left">Premium Unleaded</td>
<td class="org-left">2seater</td>
<td class="org-right">18.60</td>
<td class="org-right">0.0537634</td>
</tr>
<tr>
<td class="org-left">chevrolet</td>
<td class="org-left">corvette</td>
<td class="org-right">6.2</td>
<td class="org-right">2008</td>
<td class="org-right">8</td>
<td class="org-left">Manual 6-Speed</td>
<td class="org-left">Rear-Wheel</td>
<td class="org-right">16</td>
<td class="org-right">26</td>
<td class="org-left">Premium Unleaded</td>
<td class="org-left">2seater</td>
<td class="org-right">20.50</td>
<td class="org-right">0.0487805</td>
</tr>
<tr>
<td class="org-left">chevrolet</td>
<td class="org-left">corvette</td>
<td class="org-right">6.2</td>
<td class="org-right">2008</td>
<td class="org-right">8</td>
<td class="org-left">Automatic 6-Speed</td>
<td class="org-left">Rear-Wheel</td>
<td class="org-right">15</td>
<td class="org-right">25</td>
<td class="org-left">Premium Unleaded</td>
<td class="org-left">2seater</td>
<td class="org-right">19.50</td>
<td class="org-right">0.0512821</td>
</tr>
<tr>
<td class="org-left">chevrolet</td>
<td class="org-left">corvette</td>
<td class="org-right">7.0</td>
<td class="org-right">2008</td>
<td class="org-right">8</td>
<td class="org-left">Manual 6-Speed</td>
<td class="org-left">Rear-Wheel</td>
<td class="org-right">15</td>
<td class="org-right">24</td>
<td class="org-left">Premium Unleaded</td>
<td class="org-left">2seater</td>
<td class="org-right">19.05</td>
<td class="org-right">0.0524934</td>
</tr>
</tbody>
</table>
<p>Just Corvettes here.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org8fa6ab1">
<h3 id="org8fa6ab1">Faceting The Classes</h3>
<div class="outline-text-3" id="text-org8fa6ab1">
<p>While the use of color is useful for comparing the classes on the same plot, sometimes it can be easier to interpret plots that have the categorical classes separated into sub-plots (called <b>facets</b>).</p>
<p>By default the faceting functions use aphabetical order, I'm going to use a slightly different ordering to see if it makes it clearer how the classes compare (this is based on the medians that I plotted <a href="posts/a-look-at-ggplot/index.html#org9667a4c">below</a>).</p>
<div class="highlight">
<pre><span></span><span class="n">mpg</span><span class="o">$</span><span class="n">class_order</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">class</span><span class="p">,</span>
<span class="w">                          </span><span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">"compact"</span><span class="p">,</span><span class="w"> </span><span class="s">"subcompact"</span><span class="p">,</span><span class="w"> </span><span class="s">"midsize"</span><span class="p">,</span>
<span class="w">                                   </span><span class="s">"2seater"</span><span class="p">,</span>
<span class="w">                                   </span><span class="s">"minivan"</span><span class="p">,</span><span class="w"> </span><span class="s">"suv"</span><span class="p">,</span><span class="w"> </span><span class="s">"pickup"</span><span class="p">))</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displacement</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">gallons_per_mile</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">gallons_per_mile</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">facet_grid</span><span class="p">(</span><span class="n">.</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">class_order</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">  </span><span class="nf">DISPLACEMENT_VS_EFFICIENCY</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Displacement vs Efficiency"</span><span class="p">)</span>

<span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"displacement_vs_mileage_faceted_classes.png"</span>
<span class="nf">ggsave</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
<p>I'm using <code>facet_grid</code> here, which is actually meant to use two variables (creating row and column separation). By putting the <code>.</code> before the <code>~</code> we're telling it to only facet using columns. There's also a <code>facet_wrap</code> function that only does one variable but adds the ability to specify the number of rows you want to use, which might be helpful if you have a lot of classes.</p>
<p><img alt="nil" src="posts/a-look-at-ggplot/displacement_vs_mileage_faceted_classes.png"></p>
<p>I wouldn't have thought it, but the Corvette falls between the minivan and the sub-compact for fuel efficiency. I guess when you consider that it can only be used to transport two people and not anything relatively large it's still inefficient, just not as much if you're only using it to commute.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org169a75d">
<h3 id="org169a75d">Smoothing the Line</h3>
<div class="outline-text-3" id="text-org169a75d">
<p>Instead of plotting a scatterpoint, you can use <code>geom_smooth</code> to fit a single line representing the trend for the data (using a linear model).</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displacement</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">gallons_per_mile</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_smooth</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">facet_grid</span><span class="p">(</span><span class="n">class_order</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">drive_train</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">DISPLACEMENT_VS_EFFICIENCY</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Displacement vs Efficiency By Type"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"displacement_vs_mileage_smooth.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/a-look-at-ggplot/displacement_vs_mileage_smooth.png"></p>
<p>One interesting thing here is that the four-wheel-drive compact and sub-compact cars did better than some of the front-wheel drive cars in the same class.</p>
<p>If you look at the front-wheel-drive sub-compact cars you'll see that the curve-fitting can get a little funky if you're not careful.</p>
<p>Note the syntax for the plot. Before we were passing the <code>aes</code> mapping to the geometry object. You can do that here too, but if you pass it to the <code>ggplot</code> call then it will automatically apply it to all the geometries. If you wanted to then change one of them you could pass in the <code>aes</code> mapping to it and override the base mapping you gave to <code>ggplot</code>.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org7531845">
<h3 id="org7531845">Different Datasets to the Geometries</h3>
<div class="outline-text-3" id="text-org7531845">
<p>Besides passing in different <code>aes</code> mappings, you can also pass in different sub-sets of the data to each geometry (using <a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr's filter</a> to isolate the SUVs here).</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displacement</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">gallons_per_mile</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_smooth</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nf">filter</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">class</span><span class="o">==</span><span class="s">"suv"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">class</span><span class="p">),</span><span class="w"> </span><span class="n">position</span><span class="o">=</span><span class="s">"jitter"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">DISPLACEMENT_VS_EFFICIENCY</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Displacement vs Fuel Efficiency"</span><span class="p">)</span>

<span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"displacement_vs_mileage_subsets.png"</span>
<span class="nf">ggsave</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/a-look-at-ggplot/displacement_vs_mileage_subsets.png"></p>
<p>Looking at the trend-line for <b>SUVs</b> you can see that it encompasses a surprising swath of the displacements, and it is mostly upwardly linear to begin with but then flattens out.</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span>
<span class="w">  </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mpg</span><span class="p">,</span>
<span class="w">  </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">displacement</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gallons_per_mile</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">drive_train</span><span class="p">)</span>
<span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_smooth</span><span class="p">(</span><span class="n">se</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">DISPLACEMENT_VS_EFFICIENCY</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Effect of Drive (Four, Front, or Rear) on Mileage"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"displacement_exercise_2.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/a-look-at-ggplot/displacement_exercise_2.png"></p>
<p>It kind of looks like an emerging pattern that up to a point gasoline consumption goes up with engine size but then once a certain point is passed consumption flattens out, even as the engines get bigger.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org0dc1fcd">
<h3 id="org0dc1fcd">Small Four-Wheel Drive Automobiles</h3>
<div class="outline-text-3" id="text-org0dc1fcd">
<p>Just out of curiosity, I'd like to see what those small four-wheel drive cars are.</p>
<div class="highlight">
<pre><span></span><span class="n">small</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">filter</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">displacement</span><span class="o">&lt;</span><span class="m">3</span><span class="w"> </span><span class="o">&</span><span class="w"> </span><span class="n">drive_train</span><span class="o">==</span><span class="s">"Four-Wheel"</span><span class="p">)</span>
<span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span>
<span class="w">  </span><span class="n">data</span><span class="o">=</span><span class="n">small</span><span class="p">,</span>
<span class="w">  </span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displacement</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">gallons_per_mile</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>
<span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">facet_grid</span><span class="p">(</span><span class="n">class_order</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">manufacturer</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">DISPLACEMENT_VS_EFFICIENCY</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"4WD Less Than 3 Liters"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"small_4wd.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/a-look-at-ggplot/small_4wd.png"></p>
<p>There are only three companies making these small four-wheel-drive automobiles, with Audi being the one focused on sedans.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org597e438">
<h2 id="org597e438">Bar Plots</h2>
<div class="outline-text-2" id="text-org597e438"></div>
<div class="outline-3" id="outline-container-org8f1c12a">
<h3 id="org8f1c12a">By Count</h3>
<div class="outline-text-3" id="text-org8f1c12a">
<p>The Bar Plot is an example of what the Grammar of Graphics calls a Statistical Transformation (I guess the scatter plots are so called "Identity" transformations, but, whatever). It doesn't display the values in the data (unless you tell it to) but instead shows how often categorical values appear in the data. We can also have it set the color to create a stacked bar plot.</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_bar</span><span class="p">(</span>
<span class="w">    </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class_order</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">drive_train</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Count of Cars by Class"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="s">"Class Ordered by Median MPG"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">"Count"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"class_count.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/a-look-at-ggplot/class_count.png"></p>
<p>So most models of car are SUVs, how disheartening. This is only a sub-set of cars, though, and it doesn't reflect sales, just model counts.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org2231a04">
<h3 id="org2231a04">By Proportion</h3>
<div class="outline-text-3" id="text-org2231a04">
<p>Instead of using counts we can use proportions to show how the sub-category portions compare across categories.</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_bar</span><span class="p">(</span>
<span class="w">    </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class_order</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">drive_train</span><span class="p">),</span>
<span class="w">    </span><span class="n">position</span><span class="o">=</span><span class="s">"fill"</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Proportion of Drives by Class"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="s">"Class Ordered by Median MPG"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">"Proportion"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"class_count_filled.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/a-look-at-ggplot/class_count_filled.png"></p>
<p>This shows what proportion if each class of car has what type of drive.</p>
</div>
</div>
<div class="outline-3" id="outline-container-orgb6b544f">
<h3 id="orgb6b544f">Un-Stacked</h3>
<div class="outline-text-3" id="text-orgb6b544f">
<p>To make it easier to see how sub-categories compare within the class, we can change the positioning so that the bars are put side-by-side.</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_bar</span><span class="p">(</span>
<span class="w">    </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class_order</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">drive_train</span><span class="p">),</span>
<span class="w">    </span><span class="n">position</span><span class="o">=</span><span class="s">"dodge"</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Count of Model Drives by Class"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="s">"Class Ordered by Median MPG"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">"Count"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"class_count_dodged.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/a-look-at-ggplot/class_count_dodged.png"></p>
</div>
</div>
<div class="outline-3" id="outline-container-org2edbb30">
<h3 id="org2edbb30">Proportions Not Counts</h3>
<div class="outline-text-3" id="text-org2edbb30">
<p>Our original bar graph showed the counts, but we can show the same plot using the proportion that each categories' count is of the total count as the y-axis.</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">,</span><span class="w"> </span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">class</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_bar</span><span class="p">(</span>
<span class="w">    </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class_order</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">..prop..</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="m">1</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Proportion of Cars by Class"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="s">"Class Ordered by Median MPG"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s">"Proportion"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"class_proportion.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/a-look-at-ggplot/class_proportion.png"></p>
<p>Two things:</p>
<ul class="org-ul">
<li>That funky <code>..prop..</code> is really how R specifies that argument</li>
<li>The <code>group=1</code> argument tells ggplot that there's only one group for the whole dataset, otherwise each category is taken as a separate group and they are all end up as 100% of their group.</li>
<li>I couldn't get ggplot to set the colors based on the class</li>
</ul>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org9667a4c">
<h2 id="org9667a4c">Stat Summary</h2>
<div class="outline-text-2" id="text-org9667a4c">
<p>This is a way to plot different kinds of summary statistics for the dataset.</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">stat_summary</span><span class="p">(</span>
<span class="w">    </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class_order</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">gallons_per_mile</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">class_order</span><span class="p">),</span>
<span class="w">    </span><span class="n">fun.min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">min</span><span class="p">,</span>
<span class="w">    </span><span class="n">fun.max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">,</span>
<span class="w">    </span><span class="n">fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">median</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Spread of Efficiency by Class"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">EFFICIENCY</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="s">"Class"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"mpg_class_spread.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/a-look-at-ggplot/mpg_class_spread.png"></p>
</div>
<div class="outline-3" id="outline-container-org842385e">
<h3 id="org842385e">Boxplot</h3>
<div class="outline-text-3" id="text-org842385e">
<p>That was a nice clean way to show it, and it's flexible, but maybe a good old-fashioned box-plot is the best, in the end.</p>
<div class="highlight">
<pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_boxplot</span><span class="p">(</span>
<span class="w">    </span><span class="n">mapping</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class_order</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">gallons_per_mile</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">class_order</span><span class="p">),</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Spread of Efficiency by Class"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">EFFICIENCY</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">=</span><span class="s">"Class"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"mpg_class_boxplot.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/a-look-at-ggplot/mpg_class_boxplot.png"></p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org449a289">
<h2 id="org449a289">The End</h2>
<div class="outline-text-2" id="text-org449a289">
<p>Well, that's more than enough of that. The Chapter in <a href="posts/r-for-data-science/index.html">R For Data Science</a> has other stuff in there, in particular there's a section on changing the coordinate system, but I think it's time to move on.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org45647f2">
<h2 id="org45647f2">Link Collection</h2>
<div class="outline-text-2" id="text-org45647f2">
<ul class="org-ul">
<li><a href="https://fueleconomy.gov/">fueleconomy.gov</a>: the federal government's site on fuel efficiency for cars sold in the United States</li>
<li><a href="https://ggplot2.tidyverse.org/">ggplot2</a> main page</li>
<li><a href="https://www.realclearscience.com/blog/2019/02/14/the_miles_per_gallon_illusion.html#!">RealClear Science</a> on the MPG Illusion</li>
<li><a href="https://cfss.uchicago.edu/notes/grammar-of-graphics/">The Grammar of Graphics:</a> This is a page on the University of Chicago's <a href="https://cfss.uchicago.edu/">Computing For Social Sciences</a> site that has an explanation of what makes up the Layered Grammar of Graphics that <code>ggplot2</code> is based on.</li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/nypd-shooting-incident-data/index.html">NYPD Shooting Incident Data</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/nypd-shooting-incident-data/index.html" rel="bookmark"><time class="published dt-published" datetime="2021-12-11T14:34:41-08:00" itemprop="datePublished" title="2021-12-11 14:34">2021-12-11 14:34</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/nypd-shooting-incident-data/index.html#orge99cc51">NYPD Shooting Incident Data</a>
<ul>
<li><a href="posts/nypd-shooting-incident-data/index.html#org3bc9218">Loading the Data</a></li>
<li><a href="posts/nypd-shooting-incident-data/index.html#org034432a">Tidying and Transforming the Data</a>
<ul>
<li><a href="posts/nypd-shooting-incident-data/index.html#org1dc1802">Incident Key</a></li>
<li><a href="posts/nypd-shooting-incident-data/index.html#org2c8cbe9">Occur Date</a></li>
<li><a href="posts/nypd-shooting-incident-data/index.html#org851d687">Occur Time</a></li>
<li><a href="posts/nypd-shooting-incident-data/index.html#org22033b2">Boro</a></li>
<li><a href="posts/nypd-shooting-incident-data/index.html#org8b2fc30">Precinct</a></li>
<li><a href="posts/nypd-shooting-incident-data/index.html#org1f78c22">Jurisdiction Code</a></li>
<li><a href="posts/nypd-shooting-incident-data/index.html#orgffe795c">Location Description</a></li>
<li><a href="posts/nypd-shooting-incident-data/index.html#org5844044">Statistical Murder Flag</a></li>
<li><a href="posts/nypd-shooting-incident-data/index.html#org9f3dbc3">Perpetrator's Age Group</a></li>
<li><a href="posts/nypd-shooting-incident-data/index.html#orgde2c3d3">Peprpetrator's Sex</a></li>
<li><a href="posts/nypd-shooting-incident-data/index.html#org0f63c57">Perpetrator's Race</a></li>
<li><a href="posts/nypd-shooting-incident-data/index.html#orgfca4333">Victim's Age Group</a></li>
<li><a href="posts/nypd-shooting-incident-data/index.html#orgd658770">Victim's Sex</a></li>
<li><a href="posts/nypd-shooting-incident-data/index.html#org143b24d">Victim's Race</a></li>
<li><a href="posts/nypd-shooting-incident-data/index.html#org857c5ba">X-Coordinate</a></li>
<li><a href="posts/nypd-shooting-incident-data/index.html#org43a284e">Y-Coordinate</a></li>
<li><a href="posts/nypd-shooting-incident-data/index.html#org15c9658">Latitude</a></li>
<li><a href="posts/nypd-shooting-incident-data/index.html#org461181f">Longitude</a></li>
<li><a href="posts/nypd-shooting-incident-data/index.html#org5cb6534">Longitude and Latitude</a></li>
</ul>
</li>
<li><a href="posts/nypd-shooting-incident-data/index.html#org4fcb58c">Visualization</a>
<ul>
<li><a href="posts/nypd-shooting-incident-data/index.html#orgdc64216">Annually</a></li>
<li><a href="posts/nypd-shooting-incident-data/index.html#org42de00b">Monthly</a></li>
<li><a href="posts/nypd-shooting-incident-data/index.html#org6355627">By Map</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orge99cc51">
<h2 id="orge99cc51">NYPD Shooting Incident Data</h2>
<div class="outline-text-2" id="text-orge99cc51">
<p>This is a project that looks at the <a href="https://catalog.data.gov/dataset/nypd-shooting-incident-data-historic">NYPD Shooting Incident Data (Historic)</a> from the <a href="https://catalog.data.gov/dataset">DATA.gov</a> catalog of datasets. This dataset lists every shooting incident in New York City from 2006 through the end of the previous calendar year. It is compiled by <a href="https://opendata.cityofnewyork.us/">NYC Open Data</a> and was last updated on December 11, 2021.</p>
<p>Each row in the data is a "shooting incident" and there are 19 columns.</p>
</div>
<div class="outline-3" id="outline-container-org3bc9218">
<h3 id="org3bc9218">Loading the Data</h3>
<div class="outline-text-3" id="text-org3bc9218">
<div class="highlight">
<pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">assertthat</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">knitr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">lubridate</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
</pre></div>
<p>Lubridate is part of the tidyverse but it has to be loaded for some reason.</p>
<div class="highlight">
<pre><span></span><span class="n">DATA_URL</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">"https://data.cityofnewyork.us/api/views/833y-fsy8/rows.csv?accessType=DOWNLOAD"</span><span class="w"> </span>

<span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">read_csv</span><span class="p">(</span><span class="n">DATA_URL</span><span class="p">)</span>
</pre></div>
<pre class="example" id="org6cbaba4">

[1mindexed[0m [32m0B[0m in [36m 0s[0m, [32m0B/s[0m
[1mindexed[0m [32m393.21kB[0m in [36m 0s[0m, [32m983.15kB/s[0m
                                                                              
[1mindexed[0m [32m524.28kB[0m in [36m 1s[0m, [32m1.03MB/s[0m
[1mindexed[0m [32m655.36kB[0m in [36m 1s[0m, [32m1.22MB/s[0m
[1mindexed[0m [32m786.43kB[0m in [36m 1s[0m, [32m1.24MB/s[0m
[1mindexed[0m [32m917.50kB[0m in [36m 1s[0m, [32m1.23MB/s[0m
                                                                              
[1mindexed[0m [32m1.05MB[0m in [36m 1s[0m, [32m1.18MB/s[0m
[1mindexed[0m [32m1.18MB[0m in [36m 1s[0m, [32m1.18MB/s[0m
[1mindexed[0m [32m1.31MB[0m in [36m 1s[0m, [32m1.06MB/s[0m
[1mindexed[0m [32m1.44MB[0m in [36m 2s[0m, [32m947.54kB/s[0m
                                                                              
[1mindexed[0m [32m1.57MB[0m in [36m 2s[0m, [32m1.00MB/s[0m
[1mindexed[0m [32m1.70MB[0m in [36m 2s[0m, [32m1.04MB/s[0m
[1mindexed[0m [32m1.83MB[0m in [36m 2s[0m, [32m1.04MB/s[0m
[1mindexed[0m [32m1.97MB[0m in [36m 2s[0m, [32m1.02MB/s[0m
[1mindexed[0m [32m2.10MB[0m in [36m 2s[0m, [32m1.03MB/s[0m
[1mindexed[0m [32m2.23MB[0m in [36m 2s[0m, [32m994.69kB/s[0m
[1mindexed[0m [32m2.36MB[0m in [36m 2s[0m, [32m965.18kB/s[0m
[1mindexed[0m [32m2.49MB[0m in [36m 3s[0m, [32m939.81kB/s[0m
[1mindexed[0m [32m2.62MB[0m in [36m 3s[0m, [32m951.26kB/s[0m
[1mindexed[0m [32m2.75MB[0m in [36m 3s[0m, [32m919.65kB/s[0m
[1mindexed[0m [32m2.88MB[0m in [36m 3s[0m, [32m855.66kB/s[0m
[1mindexed[0m [32m3.01MB[0m in [36m 3s[0m, [32m892.99kB/s[0m
[1mindexed[0m [32m3.15MB[0m in [36m 3s[0m, [32m904.11kB/s[0m
[1mindexed[0m [32m3.28MB[0m in [36m 4s[0m, [32m867.67kB/s[0m
[1mindexed[0m [32m3.41MB[0m in [36m 4s[0m, [32m878.71kB/s[0m
[1mindexed[0m [32m3.54MB[0m in [36m 4s[0m, [32m888.47kB/s[0m
[1mindexed[0m [32m3.67MB[0m in [36m 4s[0m, [32m899.43kB/s[0m
[1mindexed[0m [32m3.80MB[0m in [36m 4s[0m, [32m846.12kB/s[0m
[1mindexed[0m [32m3.93MB[0m in [36m 5s[0m, [32m861.49kB/s[0m
[1mindexed[0m [32m4.06MB[0m in [36m 5s[0m, [32m876.08kB/s[0m
[1mindexed[0m [32m4.19MB[0m in [36m 5s[0m, [32m854.40kB/s[0m
[1mindexed[0m [32m4.33MB[0m in [36m 5s[0m, [32m877.77kB/s[0m
[1mindexed[0m [32m4.46MB[0m in [36m 5s[0m, [32m855.56kB/s[0m
[1mindexed[0m [32m4.59MB[0m in [36m 5s[0m, [32m865.02kB/s[0m
[1mindexed[0m [32m4.72MB[0m in [36m 6s[0m, [32m855.32kB/s[0m
[1mindexed[0m [32m4.85MB[0m in [36m 6s[0m, [32m847.74kB/s[0m
[1mindexed[0m [32m4.98MB[0m in [36m 6s[0m, [32m870.08kB/s[0m
[1mindexed[0m [32m5.11MB[0m in [36m 6s[0m, [32m892.61kB/s[0m
[1mindexed[0m [32m5.11MB[0m in [36m 6s[0m, [32m892.93kB/s[0m
[1mindexed[0m [32m1.00TB[0m in [36m 6s[0m, [32m174.56GB/s[0m
                                                                              
[1mRows: [22m[34m23585[39m [1mColumns: [22m[34m19[39m
[36m──[39m [1mColumn specification[22m [36m──────────────────────────────────────────────────────────────────────────────[39m
[1mDelimiter:[22m ","
[31mchr[39m  (10): OCCUR_DATE, BORO, LOCATION_DESC, PERP_AGE_GROUP, PERP_SEX, PERP_R...
[32mdbl[39m   (7): INCIDENT_KEY, PRECINCT, JURISDICTION_CODE, X_COORD_CD, Y_COORD_CD...
[33mlgl[39m   (1): STATISTICAL_MURDER_FLAG
[34mtime[39m  (1): OCCUR_TIME

[36mℹ[39m Use [30m[47m[30m[47m`spec()`[47m[30m[49m[39m to retrieve the full column specification for this data.
[36mℹ[39m Specify the column types or set [30m[47m[30m[47m`show_col_types = FALSE`[47m[30m[49m[39m to quiet this message.
</pre></div>
</div>
<div class="outline-3" id="outline-container-org034432a">
<h3 id="org034432a">Tidying and Transforming the Data</h3>
<div class="outline-text-3" id="text-org034432a">
<div class="highlight">
<pre><span></span><span class="nf">spec</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
<pre class="example" id="org7056c50">
cols(
  INCIDENT_KEY = [32mcol_double()[39m,
  OCCUR_DATE = [31mcol_character()[39m,
  OCCUR_TIME = [34mcol_time(format = "")[39m,
  BORO = [31mcol_character()[39m,
  PRECINCT = [32mcol_double()[39m,
  JURISDICTION_CODE = [32mcol_double()[39m,
  LOCATION_DESC = [31mcol_character()[39m,
  STATISTICAL_MURDER_FLAG = [33mcol_logical()[39m,
  PERP_AGE_GROUP = [31mcol_character()[39m,
  PERP_SEX = [31mcol_character()[39m,
  PERP_RACE = [31mcol_character()[39m,
  VIC_AGE_GROUP = [31mcol_character()[39m,
  VIC_SEX = [31mcol_character()[39m,
  VIC_RACE = [31mcol_character()[39m,
  X_COORD_CD = [32mcol_double()[39m,
  Y_COORD_CD = [32mcol_double()[39m,
  Latitude = [32mcol_double()[39m,
  Longitude = [32mcol_double()[39m,
  Lon_Lat = [31mcol_character()[39m
)
</pre></div>
<div class="outline-4" id="outline-container-org1dc1802">
<h4 id="org1dc1802">Incident Key</h4>
<div class="outline-text-4" id="text-org1dc1802">
<p>According to the <a href="https://data.cityofnewyork.us/Public-Safety/NYPD-Shooting-Incident-Data-Historic-/833y-fsy8">Data Description</a> the "Incident Key" is a randomly generated identifier for the incident. This is a likely candidate to remove unless we look at specific incidents.</p>
</div>
</div>
<div class="outline-4" id="outline-container-org2c8cbe9">
<h4 id="org2c8cbe9">Occur Date</h4>
<div class="outline-text-4" id="text-org2c8cbe9">
<p>This is the date that the shooting happened. It was loaded as a string so we should convert it to a date.</p>
<div class="highlight">
<pre><span></span><span class="n">data</span><span class="o">$</span><span class="n">OCCUR_DATE</span><span class="p">[</span><span class="m">1</span><span class="p">]</span>
</pre></div>
<pre class="example">
[1] "08/27/2006"
</pre>
<div class="highlight">
<pre><span></span><span class="n">data</span><span class="o">$</span><span class="n">DATE</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.Date</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">OCCUR_DATE</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="o">=</span><span class="s">"%m/%d/%Y"</span><span class="p">)</span>
<span class="nf">str</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">DATE</span><span class="p">)</span>
<span class="n">data</span><span class="o">$</span><span class="n">DATE</span><span class="p">[</span><span class="m">1</span><span class="p">]</span>
<span class="nf">assert_that</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">DATE</span><span class="p">))</span>
</pre></div>
<pre class="example">
 Date[1:23585], format: "2006-08-27" "2011-03-11" "2019-10-06" "2011-09-04" "2013-05-27" ...
[1] "2006-08-27"
[1] TRUE
</pre></div>
</div>
<div class="outline-4" id="outline-container-org851d687">
<h4 id="org851d687">Occur Time</h4>
<div class="outline-text-4" id="text-org851d687">
<p>This is the time of the shooting. It appears to have already been read in as a time.</p>
<div class="highlight">
<pre><span></span><span class="nf">str</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">OCCUR_TIME</span><span class="p">)</span>
<span class="nf">assert_that</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">OCCUR_TIME</span><span class="p">))</span>
</pre></div>
<pre class="example">
 'hms' num [1:23585] 05:35:00 12:03:00 01:09:00 03:35:00 ...
 - attr(*, "units")= chr "secs"
[1] TRUE
</pre></div>
</div>
<div class="outline-4" id="outline-container-org22033b2">
<h4 id="org22033b2">Boro</h4>
<div class="outline-text-4" id="text-org22033b2">
<p>This is the NYC Borough where the shooting happened.</p>
<div class="highlight">
<pre><span></span><span class="n">data</span><span class="o">$</span><span class="n">Borough</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">BORO</span><span class="p">)</span>
<span class="nf">assert_that</span><span class="p">(</span><span class="nf">is.factor</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Borough</span><span class="p">))</span>
<span class="nf">assert_that</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Borough</span><span class="p">))</span>
</pre></div>
<pre class="example">
[1] TRUE
[1] TRUE
</pre>
<p><a href="https://bookdown.org/yihui/rmarkdown-cookbook/kable.html">knitr.kable</a> reformats the dataframe to a more readable table. Kind of like tabulate but less flexible.</p>
<div class="highlight">
<pre><span></span><span class="n">big_mark</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span><span class="w"> </span><span class="n">columns</span><span class="p">){</span>
<span class="w">    </span><span class="nf">kable</span><span class="p">(</span><span class="nf">table</span><span class="p">(</span><span class="n">vector</span><span class="p">),</span><span class="w"> </span><span class="n">col.names</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span><span class="w"> </span><span class="n">format.args</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">big.mark</span><span class="o">=</span><span class="s">","</span><span class="p">))</span>
<span class="p">}</span>
<span class="nf">big_mark</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Borough</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">"Borough"</span><span class="p">,</span><span class="w"> </span><span class="s">"Shootings"</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Borough</th>
<th class="org-left" scope="col">Shootings</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">BRONX</td>
<td class="org-left">6,701</td>
</tr>
<tr>
<td class="org-left">BROOKLYN</td>
<td class="org-left">9,734</td>
</tr>
<tr>
<td class="org-left">MANHATTAN</td>
<td class="org-left">2,922</td>
</tr>
<tr>
<td class="org-left">QUEENS</td>
<td class="org-left">3,532</td>
</tr>
<tr>
<td class="org-left">STATEN ISLAND</td>
<td class="org-left">696</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-4" id="outline-container-org8b2fc30">
<h4 id="org8b2fc30">Precinct</h4>
<div class="outline-text-4" id="text-org8b2fc30">
<p>This is the precinct number where the shooting happened.</p>
<div class="highlight">
<pre><span></span><span class="nf">n_distinct</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">PRECINCT</span><span class="p">)</span>
<span class="nf">str</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">PRECINCT</span><span class="p">)</span>
<span class="n">data</span><span class="o">$</span><span class="n">PRECINCT_FACTOR</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">PRECINCT</span><span class="p">)</span>
<span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">PRECINCT</span><span class="p">))</span>
</pre></div>
<pre class="example">
[1] 77
 num [1:23585] 52 106 77 40 100 67 77 81 101 106 ...
[1] TRUE
</pre></div>
</div>
<div class="outline-4" id="outline-container-org1f78c22">
<h4 id="org1f78c22">Jurisdiction Code</h4>
<div class="outline-text-4" id="text-org1f78c22">
<p>The jurisdiction where the shooting occurred. There are three jurisdictions that are NYC jurisdictions:</p>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">Code</th>
<th class="org-left" scope="col">Jurisdiction</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-left">Patrol</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-left">Transit</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-left">Housing</td>
</tr>
</tbody>
</table>
<p>Any numbers higher than this are non-NYC jurisdictions.</p>
<div class="highlight">
<pre><span></span><span class="n">data</span><span class="o">$</span><span class="n">JURISDICTION</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">JURISDICTION_CODE</span><span class="p">)</span>
<span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">JURISDICTION</span><span class="p">))</span>
</pre></div>
<pre class="example">
[1] FALSE
attr(,"msg")
[1] "data$JURISDICTION contains 2 missing values"
</pre>
<div class="highlight">
<pre><span></span><span class="nf">big_mark</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">JURISDICTION</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">"Jurisdiction"</span><span class="p">,</span><span class="w"> </span><span class="s">"Shootings"</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">Jurisdiction</th>
<th class="org-left" scope="col">Shootings</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-left">19,629</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-left">54</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-left">3,900</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-4" id="outline-container-orgffe795c">
<h4 id="orgffe795c">Location Description</h4>
<div class="outline-text-4" id="text-orgffe795c">
<div class="highlight">
<pre><span></span><span class="n">data</span><span class="o">$</span><span class="n">LOCATION_DESC</span><span class="p">[</span><span class="m">1</span><span class="p">]</span>
<span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">LOCATION_DESC</span><span class="p">))</span>
</pre></div>
<pre class="example">
[1] NA
[1] FALSE
attr(,"msg")
[1] "data$LOCATION_DESC contains 13581 missing values"
</pre>
<div class="highlight">
<pre><span></span><span class="nf">n_distinct</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">LOCATION_DESC</span><span class="p">)</span>
</pre></div>
<pre class="example">
[1] 40
</pre>
<p>Here's what the first filled-in entry looks like.</p>
<div class="highlight">
<pre><span></span><span class="nf">first</span><span class="p">(</span><span class="nf">na.omit</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">LOCATION_DESC</span><span class="p">))</span>
</pre></div>
<pre class="example">
[1] "MULTI DWELL - PUBLIC HOUS"
</pre>
<p>Too bad there's so many missing values.</p>
<div class="highlight">
<pre><span></span><span class="nf">big_mark</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">LOCATION_DESC</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">"Location"</span><span class="p">,</span><span class="w"> </span><span class="s">"Shootings"</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Location</th>
<th class="org-right" scope="col">Shootings</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">ATM</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">BANK</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">BAR/NIGHT CLUB</td>
<td class="org-right">562</td>
</tr>
<tr>
<td class="org-left">BEAUTY/NAIL SALON</td>
<td class="org-right">100</td>
</tr>
<tr>
<td class="org-left">CANDY STORE</td>
<td class="org-right">6</td>
</tr>
<tr>
<td class="org-left">CHAIN STORE</td>
<td class="org-right">5</td>
</tr>
<tr>
<td class="org-left">CHECK CASH</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">CLOTHING BOUTIQUE</td>
<td class="org-right">14</td>
</tr>
<tr>
<td class="org-left">COMMERCIAL BLDG</td>
<td class="org-right">234</td>
</tr>
<tr>
<td class="org-left">DEPT STORE</td>
<td class="org-right">5</td>
</tr>
<tr>
<td class="org-left">DOCTOR/DENTIST</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">DRUG STORE</td>
<td class="org-right">11</td>
</tr>
<tr>
<td class="org-left">DRY CLEANER/LAUNDRY</td>
<td class="org-right">30</td>
</tr>
<tr>
<td class="org-left">FACTORY/WAREHOUSE</td>
<td class="org-right">6</td>
</tr>
<tr>
<td class="org-left">FAST FOOD</td>
<td class="org-right">98</td>
</tr>
<tr>
<td class="org-left">GAS STATION</td>
<td class="org-right">53</td>
</tr>
<tr>
<td class="org-left">GROCERY/BODEGA</td>
<td class="org-right">574</td>
</tr>
<tr>
<td class="org-left">GYM/FITNESS FACILITY</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-left">HOSPITAL</td>
<td class="org-right">38</td>
</tr>
<tr>
<td class="org-left">HOTEL/MOTEL</td>
<td class="org-right">24</td>
</tr>
<tr>
<td class="org-left">JEWELRY STORE</td>
<td class="org-right">12</td>
</tr>
<tr>
<td class="org-left">LIQUOR STORE</td>
<td class="org-right">36</td>
</tr>
<tr>
<td class="org-left">LOAN COMPANY</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">MULTI DWELL - APT BUILD</td>
<td class="org-right">2,553</td>
</tr>
<tr>
<td class="org-left">MULTI DWELL - PUBLIC HOUS</td>
<td class="org-right">4,240</td>
</tr>
<tr>
<td class="org-left">NONE</td>
<td class="org-right">175</td>
</tr>
<tr>
<td class="org-left">PHOTO/COPY STORE</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">PVT HOUSE</td>
<td class="org-right">857</td>
</tr>
<tr>
<td class="org-left">RESTAURANT/DINER</td>
<td class="org-right">188</td>
</tr>
<tr>
<td class="org-left">SCHOOL</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">SHOE STORE</td>
<td class="org-right">9</td>
</tr>
<tr>
<td class="org-left">SMALL MERCHANT</td>
<td class="org-right">25</td>
</tr>
<tr>
<td class="org-left">SOCIAL CLUB/POLICY LOCATI</td>
<td class="org-right">66</td>
</tr>
<tr>
<td class="org-left">STORAGE FACILITY</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">STORE UNCLASSIFIED</td>
<td class="org-right">35</td>
</tr>
<tr>
<td class="org-left">SUPERMARKET</td>
<td class="org-right">19</td>
</tr>
<tr>
<td class="org-left">TELECOMM. STORE</td>
<td class="org-right">5</td>
</tr>
<tr>
<td class="org-left">VARIETY STORE</td>
<td class="org-right">11</td>
</tr>
<tr>
<td class="org-left">VIDEO STORE</td>
<td class="org-right">2</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-4" id="outline-container-org5844044">
<h4 id="org5844044">Statistical Murder Flag</h4>
<div class="outline-text-4" id="text-org5844044">
<p>This is a checkbox indicating that the victim died as a result of the shooting.</p>
<div class="highlight">
<pre><span></span><span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">STATISTICAL_MURDER_FLAG</span><span class="p">))</span>
</pre></div>
<pre class="example">
[1] TRUE
</pre>
<div class="highlight">
<pre><span></span><span class="nf">big_mark</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">STATISTICAL_MURDER_FLAG</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">"Victim Died"</span><span class="p">,</span><span class="w"> </span><span class="s">"Count"</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Victim Died</th>
<th class="org-left" scope="col">Count</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">FALSE</td>
<td class="org-left">19,085</td>
</tr>
<tr>
<td class="org-left">TRUE</td>
<td class="org-left">4,500</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-4" id="outline-container-org9f3dbc3">
<h4 id="org9f3dbc3">Perpetrator's Age Group</h4>
<div class="outline-text-4" id="text-org9f3dbc3">
<div class="highlight">
<pre><span></span><span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">PERP_AGE_GROUP</span><span class="p">))</span>
<span class="n">data</span><span class="o">$</span><span class="n">PERP_AGE</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">PERP_AGE_GROUP</span><span class="p">)</span>
</pre></div>
<pre class="example">
[1] FALSE
attr(,"msg")
[1] "data$PERP_AGE_GROUP contains 8295 missing values"
</pre>
<div class="highlight">
<pre><span></span><span class="nf">big_mark</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">PERP_AGE</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">"Perpetrator's Age Group"</span><span class="p">,</span><span class="w"> </span><span class="s">"Shootings"</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">Perpetrator's Age Group</th>
<th class="org-right" scope="col">Shootings</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">&lt;18</td>
<td class="org-right">1,368</td>
</tr>
<tr>
<td class="org-right">1020</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">18-24</td>
<td class="org-right">5,508</td>
</tr>
<tr>
<td class="org-right">224</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">25-44</td>
<td class="org-right">4,714</td>
</tr>
<tr>
<td class="org-right">45-64</td>
<td class="org-right">495</td>
</tr>
<tr>
<td class="org-right">65+</td>
<td class="org-right">54</td>
</tr>
<tr>
<td class="org-right">940</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">UNKNOWN</td>
<td class="org-right">3,148</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-4" id="outline-container-orgde2c3d3">
<h4 id="orgde2c3d3">Peprpetrator's Sex</h4>
<div class="outline-text-4" id="text-orgde2c3d3">
<p>There are three values for "Sex" - Female (F), Male (M), or Unknown (U).</p>
<div class="highlight">
<pre><span></span><span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">PERP_SEX</span><span class="p">))</span>
<span class="n">data</span><span class="o">$</span><span class="n">PERP_SEX</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">PERP_SEX</span><span class="p">)</span>
</pre></div>
<pre class="example">
[1] FALSE
attr(,"msg")
[1] "data$PERP_SEX contains 8261 missing values"
</pre>
<div class="highlight">
<pre><span></span><span class="nf">big_mark</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">PERP_SEX</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">"Perpetrator's Sex"</span><span class="p">,</span><span class="w"> </span><span class="s">"Shootings"</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Perpetartor's Sex</th>
<th class="org-left" scope="col">Shootings</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">F</td>
<td class="org-left">335</td>
</tr>
<tr>
<td class="org-left">M</td>
<td class="org-left">13,490</td>
</tr>
<tr>
<td class="org-left">U</td>
<td class="org-left">1,499</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-4" id="outline-container-org0f63c57">
<h4 id="org0f63c57">Perpetrator's Race</h4>
<div class="outline-text-4" id="text-org0f63c57">
<div class="highlight">
<pre><span></span><span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">PERP_RACE</span><span class="p">))</span>
<span class="n">data</span><span class="o">$</span><span class="n">PERP_RACE</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">PERP_RACE</span><span class="p">)</span>
</pre></div>
<pre class="example">
[1] FALSE
attr(,"msg")
[1] "data$PERP_RACE contains 8261 missing values"
</pre>
<div class="highlight">
<pre><span></span><span class="nf">big_mark</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">PERP_RACE</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">"Perpetrator's Race"</span><span class="p">,</span><span class="w"> </span><span class="s">"Shootings"</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Perpetrator's Race</th>
<th class="org-left" scope="col">Shootings</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">AMERICAN INDIAN/ALASKAN NATIVE</td>
<td class="org-left">2</td>
</tr>
<tr>
<td class="org-left">ASIAN / PACIFIC ISLANDER</td>
<td class="org-left">122</td>
</tr>
<tr>
<td class="org-left">BLACK</td>
<td class="org-left">10,025</td>
</tr>
<tr>
<td class="org-left">BLACK HISPANIC</td>
<td class="org-left">1,096</td>
</tr>
<tr>
<td class="org-left">UNKNOWN</td>
<td class="org-left">1,836</td>
</tr>
<tr>
<td class="org-left">WHITE</td>
<td class="org-left">255</td>
</tr>
<tr>
<td class="org-left">WHITE HISPANIC</td>
<td class="org-left">1,988</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-4" id="outline-container-orgfca4333">
<h4 id="orgfca4333">Victim's Age Group</h4>
<div class="outline-text-4" id="text-orgfca4333">
<div class="highlight">
<pre><span></span><span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">VIC_AGE_GROUP</span><span class="p">))</span>
<span class="n">data</span><span class="o">$</span><span class="n">VIC_AGE_GROUP</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">VIC_AGE_GROUP</span><span class="p">)</span>
</pre></div>
<pre class="example">
[1] TRUE
</pre>
<div class="highlight">
<pre><span></span><span class="nf">big_mark</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">VIC_AGE_GROUP</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">"Victim's Age Group"</span><span class="p">,</span><span class="w"> </span><span class="s">"Shootings"</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">Victim's Age Group</th>
<th class="org-left" scope="col">Shootings</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">&lt;18</td>
<td class="org-left">2,525</td>
</tr>
<tr>
<td class="org-right">18-24</td>
<td class="org-left">9,003</td>
</tr>
<tr>
<td class="org-right">25-44</td>
<td class="org-left">10,303</td>
</tr>
<tr>
<td class="org-right">45-64</td>
<td class="org-left">1,541</td>
</tr>
<tr>
<td class="org-right">65+</td>
<td class="org-left">154</td>
</tr>
<tr>
<td class="org-right">UNKNOWN</td>
<td class="org-left">59</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-4" id="outline-container-orgd658770">
<h4 id="orgd658770">Victim's Sex</h4>
<div class="outline-text-4" id="text-orgd658770">
<div class="highlight">
<pre><span></span><span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">VIC_SEX</span><span class="p">))</span>
<span class="n">data</span><span class="o">$</span><span class="n">VIC_SEX</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">VIC_SEX</span><span class="p">)</span>
</pre></div>
<pre class="example">
[1] TRUE
</pre>
<div class="highlight">
<pre><span></span><span class="nf">big_mark</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">VIC_SEX</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">"Victims' Sex"</span><span class="p">,</span><span class="w"> </span><span class="s">"Shootings"</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Victims' Sex</th>
<th class="org-left" scope="col">Shootings</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">F</td>
<td class="org-left">2,204</td>
</tr>
<tr>
<td class="org-left">M</td>
<td class="org-left">21,370</td>
</tr>
<tr>
<td class="org-left">U</td>
<td class="org-left">11</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-4" id="outline-container-org143b24d">
<h4 id="org143b24d">Victim's Race</h4>
<div class="outline-text-4" id="text-org143b24d">
<div class="highlight">
<pre><span></span><span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">VIC_RACE</span><span class="p">))</span>
<span class="n">data</span><span class="o">$</span><span class="n">VIC_RACE</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">VIC_RACE</span><span class="p">)</span>
</pre></div>
<pre class="example">
[1] TRUE
</pre>
<div class="highlight">
<pre><span></span><span class="nf">big_mark</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">VIC_RACE</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">"Victim's Race"</span><span class="p">,</span><span class="w"> </span><span class="s">"Shootings"</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Victim's Race</th>
<th class="org-right" scope="col">Shootings</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">AMERICAN INDIAN/ALASKAN NATIVE</td>
<td class="org-right">9</td>
</tr>
<tr>
<td class="org-left">ASIAN / PACIFIC ISLANDER</td>
<td class="org-right">327</td>
</tr>
<tr>
<td class="org-left">BLACK</td>
<td class="org-right">16,869</td>
</tr>
<tr>
<td class="org-left">BLACK HISPANIC</td>
<td class="org-right">2,245</td>
</tr>
<tr>
<td class="org-left">UNKNOWN</td>
<td class="org-right">65</td>
</tr>
<tr>
<td class="org-left">WHITE</td>
<td class="org-right">620</td>
</tr>
<tr>
<td class="org-left">WHITE HISPANIC</td>
<td class="org-right">3,450</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="outline-4" id="outline-container-org857c5ba">
<h4 id="org857c5ba">X-Coordinate</h4>
<div class="outline-text-4" id="text-org857c5ba">
<p>"Midblock X-coordinate for New York State Plane Coordinate System, Long Island Zone, NAD 83, units feet (FIPS 3104)."</p>
<div class="highlight">
<pre><span></span><span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">X_COORD_CD</span><span class="p">))</span>
<span class="nf">n_distinct</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">X_COORD_CD</span><span class="p">)</span>
</pre></div>
<pre class="example">
[1] TRUE
[1] 9911
</pre></div>
</div>
<div class="outline-4" id="outline-container-org43a284e">
<h4 id="org43a284e">Y-Coordinate</h4>
<div class="outline-text-4" id="text-org43a284e">
<div class="highlight">
<pre><span></span><span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Y_COORD_CD</span><span class="p">))</span>
<span class="nf">n_distinct</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Y_COORD_CD</span><span class="p">)</span>
</pre></div>
<pre class="example">
[1] TRUE
[1] 9986
</pre></div>
</div>
<div class="outline-4" id="outline-container-org15c9658">
<h4 id="org15c9658">Latitude</h4>
<div class="outline-text-4" id="text-org15c9658">
<p>Latitude coordinate for Global Coordinate System, WGS 1984, decimal degrees (EPSG 4326).</p>
<div class="highlight">
<pre><span></span><span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Latitude</span><span class="p">))</span>
<span class="nf">n_distinct</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Latitude</span><span class="p">)</span>
</pre></div>
<pre class="example">
[1] TRUE
[1] 10055
</pre></div>
</div>
<div class="outline-4" id="outline-container-org461181f">
<h4 id="org461181f">Longitude</h4>
<div class="outline-text-4" id="text-org461181f">
<p>Latitude coordinate for Global Coordinate System, WGS 1984, decimal degrees (EPSG 4326).</p>
<div class="highlight">
<pre><span></span><span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Longitude</span><span class="p">))</span>
<span class="nf">n_distinct</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Longitude</span><span class="p">)</span>
<span class="nf">str</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Longitude</span><span class="p">)</span>
</pre></div>
<pre class="example">
[1] TRUE
[1] 10055
 num [1:23585] -73.9 -73.8 -74 -73.9 -73.8 ...
</pre></div>
</div>
<div class="outline-4" id="outline-container-org5cb6534">
<h4 id="org5cb6534">Longitude and Latitude</h4>
<div class="outline-text-4" id="text-org5cb6534">
<p>Longitude and Latitude Coordinates for mapping</p>
<div class="highlight">
<pre><span></span><span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Lon_Lat</span><span class="p">))</span>
<span class="nf">n_distinct</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Lon_Lat</span><span class="p">)</span>
<span class="nf">str</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Lon_Lat</span><span class="p">)</span>
</pre></div>
<pre class="example">
[1] TRUE
[1] 10055
 chr [1:23585] "POINT (-73.87963173099996 40.86905819000003)" ...
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org4fcb58c">
<h3 id="org4fcb58c">Visualization</h3>
<div class="outline-text-3" id="text-org4fcb58c">
<p><a href="https://lubridate.tidyverse.org/reference/round_date.html"><code>floor_date</code></a> is a function from <a href="https://lubridate.tidyverse.org/index.html">lubridate</a> that comes as part of the <a href="https://www.tidyverse.org/">tidyverse</a>. It's called floor because it acts like the <code>floor</code> function in math (round down).</p>
</div>
<div class="outline-4" id="outline-container-orgdc64216">
<h4 id="orgdc64216">Annually</h4>
<div class="outline-text-4" id="text-orgdc64216">
<div class="highlight">
<pre><span></span><span class="n">dates</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span>
<span class="n">dates</span><span class="o">$</span><span class="n">Year</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">floor_date</span><span class="p">(</span><span class="n">dates</span><span class="o">$</span><span class="n">DATE</span><span class="p">,</span><span class="w"> </span><span class="s">"year"</span><span class="p">)</span>

<span class="n">annual_shootings</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dates</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">group_by</span><span class="p">(</span><span class="n">Year</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">summarise</span><span class="p">(</span><span class="n">Shootings</span><span class="o">=</span><span class="nf">n</span><span class="p">())</span>
<span class="nf">kable</span><span class="p">(</span><span class="n">annual_shootings</span><span class="p">,</span>
<span class="w">      </span><span class="n">format.args</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">big.mark</span><span class="o">=</span><span class="s">","</span><span class="p">))</span>
</pre></div>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-right">
<col class="org-left"></colgroup>
<thead>
<tr>
<th class="org-right" scope="col">Year</th>
<th class="org-left" scope="col">Shootings</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">2006-01-01</td>
<td class="org-left">2,055</td>
</tr>
<tr>
<td class="org-right">2007-01-01</td>
<td class="org-left">1,887</td>
</tr>
<tr>
<td class="org-right">2008-01-01</td>
<td class="org-left">1,959</td>
</tr>
<tr>
<td class="org-right">2009-01-01</td>
<td class="org-left">1,828</td>
</tr>
<tr>
<td class="org-right">2010-01-01</td>
<td class="org-left">1,912</td>
</tr>
<tr>
<td class="org-right">2011-01-01</td>
<td class="org-left">1,939</td>
</tr>
<tr>
<td class="org-right">2012-01-01</td>
<td class="org-left">1,717</td>
</tr>
<tr>
<td class="org-right">2013-01-01</td>
<td class="org-left">1,339</td>
</tr>
<tr>
<td class="org-right">2014-01-01</td>
<td class="org-left">1,464</td>
</tr>
<tr>
<td class="org-right">2015-01-01</td>
<td class="org-left">1,434</td>
</tr>
<tr>
<td class="org-right">2016-01-01</td>
<td class="org-left">1,208</td>
</tr>
<tr>
<td class="org-right">2017-01-01</td>
<td class="org-left">970</td>
</tr>
<tr>
<td class="org-right">2018-01-01</td>
<td class="org-left">958</td>
</tr>
<tr>
<td class="org-right">2019-01-01</td>
<td class="org-left">967</td>
</tr>
<tr>
<td class="org-right">2020-01-01</td>
<td class="org-left">1,948</td>
</tr>
</tbody>
</table>
<div class="highlight">
<pre><span></span><span class="nf">theme_set</span><span class="p">(</span><span class="nf">theme_minimal</span><span class="p">())</span>
<span class="n">PATH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"../files/posts/nypd-shooting-incident-data/"</span>
<span class="n">join_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">partial</span><span class="p">(</span><span class="n">paste</span><span class="p">,</span><span class="w"> </span><span class="n">PATH</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">annual_shootings</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">Shootings</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_x_date</span><span class="p">(</span><span class="n">date_labels</span><span class="o">=</span><span class="s">"%Y"</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="s">"Year"</span><span class="p">,</span><span class="w"> </span><span class="n">date_breaks</span><span class="o">=</span><span class="s">"1 year"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"NYPD Annual Shootings Incidents Reported"</span><span class="p">)</span>
<span class="nf">ggsave</span><span class="p">(</span><span class="nf">join_path</span><span class="p">(</span><span class="s">"annual_shootings.png"</span><span class="p">),</span>
<span class="w">       </span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/nypd-shooting-incident-data/annual_shootings.png"></p>
</div>
<ul class="org-ul">
<li><a id="org0f9adc8"></a>By Borough<br>
<div class="outline-text-5" id="text-org0f9adc8">
<div class="highlight">
<pre><span></span><span class="n">borough_shootings</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dates</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">group_by</span><span class="p">(</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Borough</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">summarise</span><span class="p">(</span><span class="n">Shootings</span><span class="o">=</span><span class="nf">n</span><span class="p">())</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">file_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"annual_shootings_boroughs.png"</span>
<span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">borough_shootings</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">Shootings</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="o">=</span><span class="n">Borough</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">Borough</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_x_date</span><span class="p">(</span><span class="n">date_labels</span><span class="o">=</span><span class="s">"%Y"</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="s">"Year"</span><span class="p">,</span><span class="w"> </span><span class="n">date_breaks</span><span class="o">=</span><span class="s">"1 year"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"NYPD Annual Shootings by Borough"</span><span class="p">)</span>
<span class="nf">ggsave</span><span class="p">(</span><span class="nf">join_path</span><span class="p">(</span><span class="n">file_name</span><span class="p">),</span>
<span class="w">       </span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/nypd-shooting-incident-data/annual_shootings_boroughs.png"></p>
</div>
</li>
</ul>
</div>
<div class="outline-4" id="outline-container-org42de00b">
<h4 id="org42de00b">Monthly</h4>
<div class="outline-text-4" id="text-org42de00b">
<div class="highlight">
<pre><span></span><span class="n">dates</span><span class="o">$</span><span class="n">year_month</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">floor_date</span><span class="p">(</span><span class="n">dates</span><span class="o">$</span><span class="n">DATE</span><span class="p">,</span><span class="w"> </span><span class="s">"month"</span><span class="p">)</span>
<span class="n">monthly_shootings</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dates</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">group_by</span><span class="p">(</span><span class="n">year_month</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">summarise</span><span class="p">(</span><span class="n">Shootings</span><span class="o">=</span><span class="nf">n</span><span class="p">())</span>

<span class="n">monthly_shootings</span><span class="o">$</span><span class="n">month_number</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span>
<span class="w">  </span><span class="nf">format</span><span class="p">(</span><span class="nf">as.Date</span><span class="p">(</span><span class="n">monthly_shootings</span><span class="o">$</span><span class="n">year_month</span><span class="p">),</span><span class="w"> </span><span class="s">"%m"</span><span class="p">))</span>
<span class="n">monthly_shootings</span><span class="o">$</span><span class="n">Month</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">months</span><span class="p">(</span><span class="nf">as.Date</span><span class="p">(</span><span class="n">monthly_shootings</span><span class="o">$</span><span class="n">year_month</span><span class="p">),</span>
<span class="w">                                  </span><span class="n">abbreviate</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="n">monthly_shootings</span><span class="o">$</span><span class="n">Year</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">year</span><span class="p">(</span><span class="nf">ymd</span><span class="p">(</span><span class="n">monthly_shootings</span><span class="o">$</span><span class="n">year_month</span><span class="p">))</span>
<span class="n">monthly_shootings</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">monthly_shootings</span><span class="p">,</span>
<span class="w">              </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">month_number</span><span class="p">,</span>
<span class="w">                  </span><span class="n">y</span><span class="o">=</span><span class="n">Shootings</span><span class="p">,</span>
<span class="w">                  </span><span class="n">group</span><span class="o">=</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">Year</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="n">monthly_shootings</span><span class="o">$</span><span class="n">month_number</span><span class="p">,</span>
<span class="w">                     </span><span class="n">labels</span><span class="o">=</span><span class="n">monthly_shootings</span><span class="o">$</span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="s">"Month"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"NYPD Shootings by Month (Year-Over-Year)"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"../files/posts/nypd-shooting-incident-data/monthly_shootings.png"</span><span class="p">,</span>
<span class="w">       </span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/nypd-shooting-incident-data/monthly_shootings.png"></p>
<div class="highlight">
<pre><span></span><span class="n">three_years</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">monthly_shootings</span><span class="p">[</span><span class="nf">which</span><span class="p">(</span><span class="n">monthly_shootings</span><span class="o">$</span><span class="n">Year</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2006</span><span class="p">,</span><span class="w"> </span><span class="m">2018</span><span class="p">,</span><span class="w"> </span><span class="m">2020</span><span class="p">)),]</span>

<span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">three_years</span><span class="p">,</span>
<span class="w">              </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">month_number</span><span class="p">,</span>
<span class="w">                  </span><span class="n">y</span><span class="o">=</span><span class="n">Shootings</span><span class="p">,</span>
<span class="w">                  </span><span class="n">group</span><span class="o">=</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">Year</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="n">three_years</span><span class="o">$</span><span class="n">month_number</span><span class="p">,</span>
<span class="w">                     </span><span class="n">labels</span><span class="o">=</span><span class="n">three_years</span><span class="o">$</span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="s">"Month"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"NYPD Shootings by Month (2006, 2018, 2020)"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"../files/posts/nypd-shooting-incident-data/monthly_shootings_three-years.png"</span><span class="p">,</span>
<span class="w">       </span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/nypd-shooting-incident-data/monthly_shootings_three-years.png"></p>
</div>
<ul class="org-ul">
<li><a id="org0bc6d5d"></a>By Borough<br>
<div class="outline-text-5" id="text-org0bc6d5d">
<div class="highlight">
<pre><span></span><span class="n">borough_monthly</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dates</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">group_by</span><span class="p">(</span><span class="n">year_month</span><span class="p">,</span><span class="w"> </span><span class="n">BORO</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">summarise</span><span class="p">(</span><span class="n">Shootings</span><span class="o">=</span><span class="nf">n</span><span class="p">())</span>

<span class="n">borough_monthly</span><span class="o">$</span><span class="n">monthly_number</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span>
<span class="w">  </span><span class="nf">format</span><span class="p">(</span><span class="nf">as.Date</span><span class="p">(</span><span class="n">borough_monthly</span><span class="o">$</span><span class="n">year_month</span><span class="p">),</span><span class="w"> </span><span class="s">"%m"</span><span class="p">))</span>
<span class="n">borough_monthly</span><span class="o">$</span><span class="n">Month</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">months</span><span class="p">(</span><span class="nf">as.Date</span><span class="p">(</span><span class="n">borough_monthly</span><span class="o">$</span><span class="n">year_month</span><span class="p">),</span>
<span class="w">                                </span><span class="n">abbreviate</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="n">borough_monthly</span><span class="o">$</span><span class="n">Year</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">year</span><span class="p">(</span><span class="nf">ymd</span><span class="p">(</span><span class="n">borough_monthly</span><span class="o">$</span><span class="n">year_month</span><span class="p">))</span>
<span class="n">borough_monthly</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">boroughs_2020</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">borough_monthly</span><span class="p">[</span><span class="nf">which</span><span class="p">(</span><span class="n">borough_monthly</span><span class="o">$</span><span class="n">Year</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2020</span><span class="p">)),]</span>

<span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">boroughs_2020</span><span class="p">,</span>
<span class="w">              </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">monthly_number</span><span class="p">,</span>
<span class="w">                  </span><span class="n">y</span><span class="o">=</span><span class="n">Shootings</span><span class="p">,</span>
<span class="w">                  </span><span class="n">group</span><span class="o">=</span><span class="n">BORO</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="o">=</span><span class="n">BORO</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="n">boroughs_2020</span><span class="o">$</span><span class="n">monthly_number</span><span class="p">,</span>
<span class="w">                     </span><span class="n">labels</span><span class="o">=</span><span class="n">boroughs_2020</span><span class="o">$</span><span class="n">Month</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="s">"Month"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"NYPD Shootings by Borough (2020)"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="nf">join_path</span><span class="p">(</span><span class="s">"monthly_shootings_by_borough.png"</span><span class="p">),</span>
<span class="w">       </span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/nypd-shooting-incident-data/monthly_shootings_by_borough.png"></p>
</div>
</li>
</ul>
</div>
<div class="outline-4" id="outline-container-org6355627">
<h4 id="org6355627">By Map</h4>
<div class="outline-text-4" id="text-org6355627">
<div class="highlight">
<pre><span></span><span class="n">dates</span><span class="o">$</span><span class="n">Year</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">year</span><span class="p">(</span><span class="nf">ymd</span><span class="p">(</span><span class="n">dates</span><span class="o">$</span><span class="n">year_month</span><span class="p">))</span>
<span class="n">last_year</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dates</span><span class="p">[</span><span class="n">dates</span><span class="o">$</span><span class="n">Year</span><span class="o">==</span><span class="m">2020</span><span class="p">,]</span>
<span class="n">last_year</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">minimum_latitude</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">last_year</span><span class="o">$</span><span class="n">Latitude</span><span class="p">)</span>
<span class="n">maximum_latitude</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">last_year</span><span class="o">$</span><span class="n">Latitude</span><span class="p">)</span>
<span class="n">minimum_longitude</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">last_year</span><span class="o">$</span><span class="n">Longitude</span><span class="p">)</span>
<span class="n">maximum_longitude</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">last_year</span><span class="o">$</span><span class="n">Longitude</span><span class="p">)</span>


<span class="n">plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">last_year</span><span class="p">,</span>
<span class="w">              </span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Longitude</span><span class="p">,</span>
<span class="w">                  </span><span class="n">y</span><span class="o">=</span><span class="n">Latitude</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">BORO</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">minimum_longitude</span><span class="p">,</span><span class="w"> </span><span class="n">maximum_longitude</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">minimum_latitude</span><span class="p">,</span><span class="w"> </span><span class="n">maximum_latitude</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"NYPD Shootings by Latitude and Longitude (2020)"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="nf">join_path</span><span class="p">(</span><span class="s">"monthly_shootings_latitude_longitude.png"</span><span class="p">),</span>
<span class="w">       </span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/nypd-shooting-incident-data/monthly_shootings_latitude_longitude.png"></p>
</div>
</div>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/r-babel-test/index.html">R Babel Test</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/r-babel-test/index.html" rel="bookmark"><time class="published dt-published" datetime="2021-12-09T17:08:17-08:00" itemprop="datePublished" title="2021-12-09 17:08">2021-12-09 17:08</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div class="highlight">
<pre><span></span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rnorm</span><span class="p">(</span><span class="m">100</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
<pre class="example">
    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
-1.93398 -0.79415  0.01453 -0.01418  0.67102  2.20682
</pre>
<p>Does it keep the variables alive between blocks?</p>
<div class="highlight">
<pre><span></span><span class="nf">summary</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
<pre class="example">
    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
-1.93398 -0.79415  0.01453 -0.01418  0.67102  2.20682
</pre>
<p>Looks like it.</p>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/insertion-sort/index.html">Insertion Sort</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/insertion-sort/index.html" rel="bookmark"><time class="published dt-published" datetime="2021-11-30T17:15:24-08:00" itemprop="datePublished" title="2021-11-30 17:15">2021-11-30 17:15</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/insertion-sort/index.html#org5825b6c">The Insertion Sort</a></li>
<li><a href="posts/insertion-sort/index.html#orga4cb608">The Algorithm Parts</a></li>
<li><a href="posts/insertion-sort/index.html#org95dcec9">The Pseudocode</a></li>
<li><a href="posts/insertion-sort/index.html#org34291e0">Runtime</a></li>
<li><a href="posts/insertion-sort/index.html#org37dbe42">Implement It</a>
<ul>
<li><a href="posts/insertion-sort/index.html#org923048c">Imports</a></li>
<li><a href="posts/insertion-sort/index.html#org1cb8004">Some Types</a></li>
<li><a href="posts/insertion-sort/index.html#org8e8bdc8">The Counter</a></li>
<li><a href="posts/insertion-sort/index.html#orgaa72d0d">Some Simple Testing</a>
<ul>
<li><a href="posts/insertion-sort/index.html#org579e9ca">Importing</a></li>
<li><a href="posts/insertion-sort/index.html#org5db5b27">Set Up</a></li>
<li><a href="posts/insertion-sort/index.html#orgc506190">Worst Case</a></li>
<li><a href="posts/insertion-sort/index.html#orgac41b75">Best Case</a></li>
<li><a href="posts/insertion-sort/index.html#orgc93f1c4">Random</a></li>
</ul>
</li>
<li><a href="posts/insertion-sort/index.html#org05c61f3">Comparisons and Swaps</a></li>
<li><a href="posts/insertion-sort/index.html#org2ec982b">Best and Worst Cases</a></li>
<li><a href="posts/insertion-sort/index.html#orgfbd390a">The Swaps</a>
<ul>
<li><a href="posts/insertion-sort/index.html#orgcac0353">Random Case</a></li>
<li><a href="posts/insertion-sort/index.html#org14daafd">Worst Case Swaps</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="posts/insertion-sort/index.html#orgfeb3435">Compare The Three Amigos</a></li>
<li><a href="posts/insertion-sort/index.html#org826b423">Sources</a></li>
</ul>
</div>
</div>
<p>\(\def\sc#1{\dosc#1\csod} \def\dosc#1#2\csod{{\rm #1{\small #2}}}\)</p>
<div class="outline-2" id="outline-container-org5825b6c">
<h2 id="org5825b6c">The Insertion Sort</h2>
<div class="outline-text-2" id="text-org5825b6c">
<p>The insertion sort is an instance of a <a href="posts/decrease-and-conquer/index.html">Decrease And Conquer</a> algorithm and is another case where you maintain a sorted sub-list at the beginning of the list of elements to sort (similar to {<a href="posts/selection-sort/index.html">selection sort</a>) but instead of scanning the entire unsorted section for the next smallest item to pick (as in "selection sort") you pick the next item in the unsorted and scan down through the sorted section until you find the right place to insert it. This has the slight advantage over selection sort in that you might not have to scan the entire sorted section to find where to insert the next item, while you always have to scan the entire unsorted section to find the next item to select in the selection sort. On the other hand, instead of swapping just two items at the end of each loop, as in the selection sort, with the insertion sort you have to shift every item above where the next item is going to be inserted in order to make a space for it.</p>
</div>
</div>
<div class="outline-2" id="outline-container-orga4cb608">
<h2 id="orga4cb608">The Algorithm Parts</h2>
<div class="outline-text-2" id="text-orga4cb608">
<p>This is taken pretty straight from <a href="posts/HTTAA/index.html">How To Think About Algorithms</a>.</p>
<ul class="org-ul">
<li><b>Specification:</b> This is a <a href="posts/the-sorting-problem/index.html">Sorting Problem</a>.</li>
<li><b>Basic Steps:</b> Repeatedly insert an item where it belongs.</li>
<li><b>Measure of Progress:</b> The number of elements we've inserted so far.</li>
<li><b>The Loop Invariant:</b> The inserted elements are in sorted order.</li>
<li><b>Main Steps:</b> Take an unselected item and insert it into the correct place in the sorted list.</li>
<li><b>Make Progress:</b> We always insert an item.</li>
<li><b>Maintain the Loop Invariant:</b>
<ul class="org-ul">
<li>\( \langle \textit{Loop Invariant} \rangle\): Insertion List is sorted.</li>
<li>\(\lnot \langle \textit{Exit-Condition} \rangle \): There's more to sort.</li>
<li>\(\sc{CodeLoop}\): The item that was chosen was inserted in the place that maintains the loop invariant.</li>
</ul>
</li>
<li><b>Establish the Loop Invariant:</b> Pick the first item from the unsorted list giving us a sorted list with one item.</li>
<li><b>Exit Condition:</b> We've inserted all the items.</li>
<li><b>Ending:</b>
<ul class="org-ul">
<li>\(\langle \textit{Exit-Condition} \rangle\): All elements were inserted.</li>
<li>\(\langle \textit{Loop Invariant} \rangle\): All inserted elements are in the right order.</li>
<li>\(\rightarrow \langle \textit{Post-Condition} \rangle\): All the elements are in sorted order.</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org95dcec9">
<h2 id="org95dcec9">The Pseudocode</h2>
<div class="outline-text-2" id="text-org95dcec9">
<pre id="insertionsort" style="display:hidden;">
\begin{algorithm}
\caption{InsertionSort}
\begin{algorithmic}
\INPUT An array of orderable items
\OUTPUT The array sorted in ascending order
\PROCEDURE{InsertionSort}{$A$}
  \FOR{$i \gets 1$ to $n - 1$}
    \STATE $v \gets A[i]$
    \STATE $j \gets i - 1$
    \WHILE{$j \geq 0$ and $A[j] &gt; v$}
       \STATE $A[j + 1] \gets A[j]$
       \STATE $j \gets j - 1$
    \ENDWHILE
    \STATE $A[j + 1] \gets v$
  \ENDFOR
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>
<p>The outer loop tracks the boundary between the sorted section of the list (elements whose index is less than <i>i</i>) and the unsorted section (<i>i</i> to the end of the list). Every time through the outer loop we pick the next item to insert (and assign it to <i>v</i>) then in the <code>while</code> loop we traverse the list backwards, moving the items up one in the list until we find a place where the value to insert isn't less than the next item in the array (or we haven't reached the start of the list). Once we end up at the place to insert the value we exit the <code>while</code> loop and insert the value where we stopped. Then we move our outer loop up one and start again until everything's sorted.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org34291e0">
<h2 id="org34291e0">Runtime</h2>
<div class="outline-text-2" id="text-org34291e0">
<p>Given the two loops you can probably guess that it's going to be \(\Theta(n^2)\), but I'll go through it so I don't forget later on.</p>
\begin{align} C_{worst} &amp;= \sum_{i=1}^{n - 1} \sum_{j=0}^{i-1} 1\\ &amp;= \sum_{i=1}^{n - 1} ((i - 1) - 0 + 1) \\ &amp;= \sum_{i=1}^{n - 1} i \end{align}
<p>This is pretty similar to what I had in the <a href="posts/bubble-sort-runtime-explained/index.html">Bubble Sort: Runtime Explained</a> post so I won't go over the reasons for the steps, but at this point we can use the summing backwards and forwards of the series trick to see what our worst-case runtime is.</p>
\begin{array}{ccccccccc} & 1 & + & 2 & + & \cdots & + & (n - 2) & + & (n - 1) \\ + & (n - 1) & + & (n - 2) & + & \cdots & + & 2 & + & 1 \\ \hline & n & + & n & + & \cdots & + & n & + & n\\ \end{array}
<p>So we have <i>n - 1</i> terms of <i>n</i> in our doubled runtime which we can then halve to get:</p>
<p>\[ C_{worst} = \frac{n (n - 1)}{2} \in \Theta(n^2) \]</p>
</div>
</div>
<div class="outline-2" id="outline-container-org37dbe42">
<h2 id="org37dbe42">Implement It</h2>
<div class="outline-text-2" id="text-org37dbe42">
<p>I'll try and copy the way the selection and bubble sorts looked to make it easier to compare them later.</p>
</div>
<div class="outline-3" id="outline-container-org923048c">
<h3 id="org923048c">Imports</h3>
<div class="outline-text-3" id="text-org923048c">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">MutableSequence</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org1cb8004">
<h3 id="org1cb8004">Some Types</h3>
<div class="outline-text-3" id="text-org1cb8004">
<p><b>Note:</b> For my future self: using the <code>dataclass</code> is the python way to make a data object, but numba doesn't like it, so we can't use it.</p>
<div class="highlight">
<pre><span></span><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">InsertionOutput</span><span class="p">:</span>
    <span class="n">element_count</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">comparisons</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">swaps</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">elements</span><span class="p">:</span> <span class="n">MutableSequence</span>
</pre></div>
<p>I'll use the regular <code>namedtuple</code> instead.</p>
<div class="highlight">
<pre><span></span><span class="n">InsertionOutput</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">"InsertionOutput"</span><span class="p">,</span> <span class="p">[</span><span class="s2">"element_count"</span><span class="p">,</span>
                                                 <span class="s2">"comparisons"</span><span class="p">,</span>
                                                 <span class="s2">"swaps"</span><span class="p">,</span>
                                                 <span class="s2">"elements"</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org8e8bdc8">
<h3 id="org8e8bdc8">The Counter</h3>
<div class="outline-text-3" id="text-org8e8bdc8">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">insertion_sort</span><span class="p">(</span><span class="n">elements</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InsertionOutput</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Sorts elements using iterative insertion-sort</span>

<span class="sd">    Args:</span>
<span class="sd">     elements: sortable collection of elements</span>

<span class="sd">    Returns:</span>
<span class="sd">     count of elements, comparisons made, swaps made, sorted elements</span>
<span class="sd">    """</span>
    <span class="n">comparisons</span> <span class="o">=</span> <span class="n">swaps</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">next_unsorted_cell</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)):</span>
        <span class="n">thing_to_insert</span> <span class="o">=</span> <span class="n">elements</span><span class="p">[</span><span class="n">next_unsorted_cell</span><span class="p">]</span>

        <span class="n">in_front_of_me</span><span class="p">,</span> <span class="n">to_the_right</span> <span class="o">=</span> <span class="p">(</span><span class="n">next_unsorted_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                        <span class="n">next_unsorted_cell</span><span class="p">)</span>

        <span class="k">while</span> <span class="ow">not</span> <span class="p">(</span><span class="n">in_front_of_me</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span>
                   <span class="n">elements</span><span class="p">[</span><span class="n">in_front_of_me</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">thing_to_insert</span><span class="p">):</span>
            <span class="n">comparisons</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">swaps</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">elements</span><span class="p">[</span><span class="n">to_the_right</span><span class="p">]</span> <span class="o">=</span> <span class="n">elements</span><span class="p">[</span><span class="n">in_front_of_me</span><span class="p">]</span>
            <span class="n">in_front_of_me</span><span class="p">,</span> <span class="n">to_the_right</span> <span class="o">=</span> <span class="p">(</span><span class="n">in_front_of_me</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                            <span class="n">in_front_of_me</span><span class="p">)</span>

        <span class="n">elements</span><span class="p">[</span><span class="n">to_the_right</span><span class="p">]</span> <span class="o">=</span> <span class="n">thing_to_insert</span>
        <span class="n">swaps</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">InsertionOutput</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">),</span> <span class="n">comparisons</span><span class="p">,</span> <span class="n">swaps</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span>
</pre></div>
<p>I negated the while-condition and re-stated the body to make more sense to me. Hopefully it's still clear what's going on.</p>
</div>
</div>
<div class="outline-3" id="outline-container-orgaa72d0d">
<h3 id="orgaa72d0d">Some Simple Testing</h3>
<div class="outline-text-3" id="text-orgaa72d0d"></div>
<div class="outline-4" id="outline-container-org579e9ca">
<h4 id="org579e9ca">Importing</h4>
<div class="outline-text-4" id="text-org579e9ca">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">contain_exactly</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">njit</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">default_rng</span>

<span class="kn">import</span> <span class="nn">altair</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># this project</span>
<span class="kn">from</span> <span class="nn">bowling.sort.insertion</span> <span class="kn">import</span> <span class="n">insertion_sort</span>

<span class="c1"># my stuff</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">Timer</span>
<span class="kn">from</span> <span class="nn">graeae.visualization.altair_helpers</span> <span class="kn">import</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">save_chart</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org5db5b27">
<h4 id="org5db5b27">Set Up</h4>
<div class="outline-text-4" id="text-org5db5b27">
<div class="highlight">
<pre><span></span><span class="n">numba_random</span> <span class="o">=</span> <span class="n">default_rng</span><span class="p">(</span><span class="mi">2022</span><span class="p">)</span>
<span class="n">TIMER</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>

<span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"insertion-sort"</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="n">output_path</span><span class="p">(</span><span class="n">SLUG</span><span class="p">)</span>
<span class="n">save_it</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">save_chart</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgc506190">
<h4 id="orgc506190">Worst Case</h4>
<div class="outline-text-4" id="text-orgc506190">
<div class="highlight">
<pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)))</span>
<span class="n">expected</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">copy</span><span class="p">()))</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">insertion_sort</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">comparisons</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">((</span><span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgac41b75">
<h4 id="orgac41b75">Best Case</h4>
<div class="outline-text-4" id="text-orgac41b75">
<div class="highlight">
<pre><span></span><span class="n">inputs</span> <span class="o">=</span> <span class="n">expected</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">insertion_sort</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">comparisons</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">swaps</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
<p>Maybe <code>comparisons</code> is the wrong term since it's really counting the number of times we get past the sentinel in the <code>while</code> statement, but I don't think there's a good way to count how many times the sentinel gets checked, so the swaps has to act as a proxy for this best-case scenario where we never drop into the while loop.</p>
</div>
</div>
<div class="outline-4" id="outline-container-orgc93f1c4">
<h4 id="orgc93f1c4">Random</h4>
<div class="outline-text-4" id="text-orgc93f1c4">
<div class="highlight">
<pre><span></span><span class="n">inputs</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">copy</span><span class="p">()))</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">insertion_sort</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>

<span class="nb">print</span><span class="p">((</span><span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">comparisons</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">swaps</span><span class="p">)</span>
</pre></div>
<pre class="example">
4950.0
2585
2684
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org05c61f3">
<h3 id="org05c61f3">Comparisons and Swaps</h3>
<div class="outline-text-3" id="text-org05c61f3">
<div class="highlight">
<pre><span></span><span class="n">numba_sort</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="n">insertion_sort</span><span class="p">)</span>
<span class="n">things_to_sort</span> <span class="o">=</span> <span class="p">[</span><span class="n">numba_random</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>
                  <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)]</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">sort_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
        <span class="n">delayed</span><span class="p">(</span><span class="n">numba_sort</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">)</span>
</pre></div>
<pre class="example">
Started: 2022-01-16 22:55:12.336777
Ended: 2022-01-16 22:55:23.534382
Elapsed: 0:00:11.197605
</pre>
<div class="highlight">
<pre><span></span><span class="n">SIZE</span><span class="p">,</span> <span class="n">COMPARISONS</span><span class="p">,</span> <span class="n">SWAPS</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
<span class="n">unzipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">sort_output</span><span class="p">))</span>
<span class="n">count_frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"Elements"</span><span class="p">:</span> <span class="n">unzipped</span><span class="p">[</span><span class="n">SIZE</span><span class="p">],</span>
                                <span class="s2">"Insertion"</span><span class="p">:</span> <span class="n">unzipped</span><span class="p">[</span><span class="n">SWAPS</span><span class="p">]})</span>

<span class="n">count_frame</span><span class="p">[</span><span class="s2">"n^2"</span><span class="p">]</span> <span class="o">=</span> <span class="n">count_frame</span><span class="o">.</span><span class="n">Elements</span><span class="o">**</span><span class="mi">2</span>

<span class="n">melted</span> <span class="o">=</span> <span class="n">count_frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Elements"</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">"Source"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Runtime"</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">tooltip</span> <span class="o">=</span> <span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Elements"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
           <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Runtime"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span> 
           <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Source:N"</span><span class="p">)]</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span> <span class="o">=</span> <span class="s2">"Elements"</span><span class="p">,</span>
    <span class="n">y</span> <span class="o">=</span> <span class="s2">"Runtime"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Source:N"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="n">tooltip</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">"Insertion Sort"</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"insertion-sort-comparisons"</span><span class="p">)</span>
</pre></div>
<object data="posts/insertion-sort/insertion-sort-comparisons.html" height="600" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>With our random input the Insertion Sort does better than the theoretical worst case.</p>
</div>
</div>
<div class="outline-3" id="outline-container-org2ec982b">
<h3 id="org2ec982b">Best and Worst Cases</h3>
<div class="outline-text-3" id="text-org2ec982b">
<p>Let's get rid of the \(n^2\) and add the best-case and worst-case data.</p>
<div class="highlight">
<pre><span></span><span class="n">frame</span> <span class="o">=</span> <span class="n">count_frame</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"Insertion"</span><span class="p">:</span> <span class="s2">"Random"</span><span class="p">})</span>
<span class="k">del</span> <span class="n">frame</span><span class="p">[</span><span class="s2">"n^2"</span><span class="p">]</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">best_things</span> <span class="o">=</span> <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)]</span>
<span class="n">worst_things</span> <span class="o">=</span> <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">things</span><span class="p">)</span> <span class="k">for</span> <span class="n">things</span> <span class="ow">in</span> <span class="n">best_things</span><span class="p">]</span>

<span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">worst_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
        <span class="n">delayed</span><span class="p">(</span><span class="n">numba_sort</span><span class="p">)(</span><span class="n">thing</span><span class="p">)</span> <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="n">worst_things</span>
<span class="p">)</span>
</pre></div>
<pre class="example">
Started: 2022-01-16 22:56:34.282090
Ended: 2022-01-16 22:56:56.373266
Elapsed: 0:00:22.091176
</pre>
<div class="highlight">
<pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">best_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
        <span class="n">delayed</span><span class="p">(</span><span class="n">numba_sort</span><span class="p">)(</span><span class="n">thing</span><span class="p">)</span> <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="n">best_things</span>
<span class="p">)</span>
</pre></div>
<pre class="example">
Started: 2022-01-16 22:57:04.941850
Ended: 2022-01-16 22:57:05.067092
Elapsed: 0:00:00.125242
</pre>
<div class="highlight">
<pre><span></span><span class="n">best_unzipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">best_output</span><span class="p">))</span>
<span class="n">worst_unzipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">worst_output</span><span class="p">))</span>

<span class="n">frame</span><span class="p">[</span><span class="s2">"Best"</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_unzipped</span><span class="p">[</span><span class="n">SWAPS</span><span class="p">]</span>
<span class="n">frame</span><span class="p">[</span><span class="s2">"Worst"</span><span class="p">]</span> <span class="o">=</span> <span class="n">worst_unzipped</span><span class="p">[</span><span class="n">SWAPS</span><span class="p">]</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">melted</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Elements"</span><span class="p">],</span>
                    <span class="n">var_name</span><span class="o">=</span><span class="s2">"Input"</span><span class="p">,</span>
                    <span class="n">value_name</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Elements"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Input"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Elements"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
             <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Comparisons"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
             <span class="s2">"Input"</span><span class="p">],</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Insertion Sort Best, Worst, Random"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span>
<span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"best-worst-random"</span><span class="p">)</span>
</pre></div>
<object data="posts/insertion-sort/best-worst-random.html" height="600" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>Here we can see why Insertion Sort is considered better than Bubble and Selection Sort. In those cases they have to traverse the entire unsorted collection every time but Insertion Sort only picks whatever is the next unsorted item and searches the sorted until it finds the right place to insert it. In the worst case they're all the same, but whenever it isn't the worst case insertion sort offers a little improvement.</p>
</div>
</div>
<div class="outline-3" id="outline-container-orgfbd390a">
<h3 id="orgfbd390a">The Swaps</h3>
<div class="outline-text-3" id="text-orgfbd390a">
<p>Let's look at what plotting the location of the elements as they are swapped looks like.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">insertion_swaps</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Keeps track of the element indexes as they are swapped</span>

<span class="sd">    Args:</span>
<span class="sd">     elements: list of orderable elements</span>

<span class="sd">    Returns:</span>
<span class="sd">     dict mapping element to list of indices where it was in the elements list</span>
<span class="sd">    """</span>
    <span class="n">swaps</span> <span class="o">=</span> <span class="p">{</span><span class="n">element</span><span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elements</span><span class="p">)}</span>

    <span class="n">number_of_elements</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">next_unsorted_cell</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)):</span>
        <span class="n">thing_to_insert</span> <span class="o">=</span> <span class="n">elements</span><span class="p">[</span><span class="n">next_unsorted_cell</span><span class="p">]</span>

        <span class="n">in_front_of_me</span><span class="p">,</span> <span class="n">to_the_right</span> <span class="o">=</span> <span class="p">(</span><span class="n">next_unsorted_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                        <span class="n">next_unsorted_cell</span><span class="p">)</span>

        <span class="k">while</span> <span class="ow">not</span> <span class="p">(</span><span class="n">in_front_of_me</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span>
               <span class="n">elements</span><span class="p">[</span><span class="n">in_front_of_me</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">thing_to_insert</span><span class="p">):</span>
            <span class="n">elements</span><span class="p">[</span><span class="n">to_the_right</span><span class="p">]</span> <span class="o">=</span> <span class="n">elements</span><span class="p">[</span><span class="n">in_front_of_me</span><span class="p">]</span>
            <span class="n">in_front_of_me</span><span class="p">,</span> <span class="n">to_the_right</span> <span class="o">=</span> <span class="p">(</span><span class="n">in_front_of_me</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                            <span class="n">in_front_of_me</span><span class="p">)</span>

        <span class="n">elements</span><span class="p">[</span><span class="n">to_the_right</span><span class="p">]</span> <span class="o">=</span> <span class="n">thing_to_insert</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elements</span><span class="p">):</span>
            <span class="n">swaps</span><span class="p">[</span><span class="n">element</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">swaps</span>
</pre></div>
<p>A little sanity check.</p>
<div class="highlight">
<pre><span></span><span class="n">inputs</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">copy</span><span class="p">()))</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">insertion_swaps</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-orgcac0353">
<h4 id="orgcac0353">Random Case</h4>
<div class="outline-text-4" id="text-orgcac0353">
<div class="highlight">
<pre><span></span><span class="n">COUNT</span> <span class="o">=</span> <span class="mi">50</span>

<span class="n">inputs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">COUNT</span><span class="p">))</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">swaps</span> <span class="o">=</span> <span class="n">insertion_swaps</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

<span class="n">track_frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">swaps</span><span class="p">)</span>
<span class="n">re_indexed</span> <span class="o">=</span> <span class="n">track_frame</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"Swap"</span><span class="p">})</span>
<span class="n">melted</span> <span class="o">=</span> <span class="n">re_indexed</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">var_name</span><span class="o">=</span><span class="s2">"Value To Sort"</span><span class="p">,</span>
                         <span class="n">value_name</span><span class="o">=</span><span class="s2">"Location In Array"</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="s2">"Swap"</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Swap"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Location In Array"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Value To Sort:O"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"Swap"</span><span class="p">,</span> <span class="s2">"Location In Array"</span><span class="p">,</span> <span class="s2">"Value To Sort"</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Insertion Sort Insertions"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"insertion-sort-swaps"</span><span class="p">)</span>
</pre></div>
<object data="posts/insertion-sort/insertion-sort-swaps.html" height="600" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>To interpret the chart, the y-axis values are the indices of the input list and as we move left to right along the x-axis we are traversing the outer loop. Everytime a line goes from horizontal to a downward slope that means that the element at the <i>y</i> location was plucked from the unsorted section and inserted into the previously sorted section. The longer the downward line, the further back it had to go in the sorted section before being inserted (and so the more items had to be moved aside for it to find its place).</p>
</div>
</div>
<div class="outline-4" id="outline-container-org14daafd">
<h4 id="org14daafd">Worst Case Swaps</h4>
<div class="outline-text-4" id="text-org14daafd">
<p>Now we'll take a look at what the swaps look like when the collection to be sorted is in exactly the reversed order.</p>
<div class="highlight">
<pre><span></span><span class="n">COUNT</span> <span class="o">=</span> <span class="mi">50</span>

<span class="n">inputs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">COUNT</span><span class="p">)))</span>
<span class="n">swaps</span> <span class="o">=</span> <span class="n">insertion_swaps</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

<span class="n">track_frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">swaps</span><span class="p">)</span>
<span class="n">re_indexed</span> <span class="o">=</span> <span class="n">track_frame</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"Swap"</span><span class="p">})</span>
<span class="n">melted</span> <span class="o">=</span> <span class="n">re_indexed</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">var_name</span><span class="o">=</span><span class="s2">"Value To Sort"</span><span class="p">,</span>
                         <span class="n">value_name</span><span class="o">=</span><span class="s2">"Location In Array"</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="s2">"Swap"</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Swap"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Location In Array"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Value To Sort:O"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"Swap"</span><span class="p">,</span> <span class="s2">"Location In Array"</span><span class="p">,</span> <span class="s2">"Value To Sort"</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Insertion Sort Insertions (Worst-Case)"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"worst-case-insertion-sort-swaps"</span><span class="p">)</span>
</pre></div>
<object data="posts/insertion-sort/worst-case-insertion-sort-swaps.html" height="600" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>So, here we don't have the mostly short lines of the previous chart because every element had to be inserted at the beginning of the previously sorted section of the list.</p>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgfeb3435">
<h2 id="orgfeb3435">Compare The Three Amigos</h2>
<div class="outline-text-2" id="text-orgfeb3435">
<p>We've had three brute-force sorters so far, let's see if there's a noticeable difference in their comparisons.</p>
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">bowling.sort.bubble.bubble</span> <span class="kn">import</span> <span class="n">bubba</span>
<span class="kn">from</span> <span class="nn">bowling.sort.selection</span> <span class="kn">import</span> <span class="n">selection_counter</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">numba_bubble</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="n">bubba</span><span class="p">)</span>
<span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">bubble_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
        <span class="n">delayed</span><span class="p">(</span><span class="n">numba_bubble</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">)</span>
</pre></div>
<pre class="example">
Started: 2022-01-11 23:38:40.676138
Ended: 2022-01-11 23:40:07.211075
Elapsed: 0:01:26.534937
</pre>
<div class="highlight">
<pre><span></span><span class="n">numba_selection</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="n">selection_counter</span><span class="p">)</span>
<span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">selection_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
        <span class="n">delayed</span><span class="p">(</span><span class="n">numba_selection</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">)</span>
</pre></div>
<pre class="example">
Started: 2022-01-11 23:00:03.404894
Ended: 2022-01-11 23:00:43.390039
Elapsed: 0:00:39.985145
</pre>
<div class="highlight">
<pre><span></span><span class="n">unzipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">bubble_output</span><span class="p">))</span>

<span class="n">count_frame</span><span class="p">[</span><span class="s2">"Bubble"</span><span class="p">]</span> <span class="o">=</span> <span class="n">unzipped</span><span class="p">[</span><span class="n">COMPARISONS</span><span class="p">]</span>

<span class="n">unzipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">selection_output</span><span class="p">))</span>

<span class="n">count_frame</span><span class="p">[</span><span class="s2">"Selection"</span><span class="p">]</span> <span class="o">=</span> <span class="n">unzipped</span><span class="p">[</span><span class="n">COMPARISONS</span><span class="p">]</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">count_frame</span> <span class="o">=</span> <span class="n">count_frame</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"Insertion Comparisons"</span><span class="p">:</span> <span class="s2">"Insertion"</span><span class="p">})</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">frame</span> <span class="o">=</span> <span class="n">count_frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Elements"</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">"Sorter"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">tooltip</span> <span class="o">=</span> <span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Elements"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
           <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Comparisons"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span> 
           <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Sorter"</span><span class="p">)]</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Elements"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Sorter"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="n">tooltip</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">550</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">"The Three Amigos"</span>
<span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"three-amigos-comparisons"</span><span class="p">)</span>
</pre></div>
<object data="posts/insertion-sort/three-amigos-comparisons.html" height="600" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>You might be looking at the chart and wondering - "Where's the Bubble Sort?". Well, since Selection Sort always checks all the unsorted for the next item, it has to do just as many comparisons as Bubble Sort does so they are (almost) overlapping - since I used the short-circuiting Bubble Sort if you zoom way, way in you'll see that the Bubble Sort's points are actually usually slighly lower than the Selection Sort's line.</p>
<p>I guess the main takeaway is that because the Insertion Sort has an out that lets it short-circuit each inner while-loop it generally will perform better than the other two sorts, although it's still a quadratic sort.</p>
</div>
</div>
<div class="outline-2" id="outline-container-org826b423">
<h2 id="org826b423">Sources</h2>
<div class="outline-text-2" id="text-org826b423">
<ul class="org-ul">
<li><a href="posts/HTTAA/index.html">How To Think About Algorithms</a></li>
<li><a href="posts/itdaa/index.html">Introduction to the Design & Analysis of Algorithms (Levitin)</a></li>
</ul>
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("insertionsort"));
});
</script></div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/bubble-sort-an-archeological-algorithmic-analysis/index.html">Bubble Sort: An Archeological Algorithmic Analysis</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/bubble-sort-an-archeological-algorithmic-analysis/index.html" rel="bookmark"><time class="published dt-published" datetime="2021-11-25T16:38:05-08:00" itemprop="datePublished" title="2021-11-25 16:38">2021-11-25 16:38</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div class="outline-2" id="outline-container-org4e8ad76">
<h2 id="org4e8ad76">Source</h2>
<div class="outline-text-2" id="text-org4e8ad76">
<ul class="org-ul">
<li><a href="https://users.cs.duke.edu/~ola/bubble/bubble.html">HTML Version</a></li>
<li><a href="https://users.cs.duke.edu/~ola/papers/bubble.pdf">Link to PDF</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgba48a46">
<h2 id="orgba48a46">Citation</h2>
<div class="outline-text-2" id="text-orgba48a46">
<ul class="org-ul">
<li>Astrachan O. Bubble sort: an archaeological algorithmic analysis. SIGCSE Bull. 2003 Jan 11;35(1):1–5.</li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/iterative-algorithms/index.html">Iterative Algorithms</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/iterative-algorithms/index.html" rel="bookmark"><time class="published dt-published" datetime="2021-11-23T16:16:37-08:00" itemprop="datePublished" title="2021-11-23 16:16">2021-11-23 16:16</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<p>Iterative algorithms are characterized by loops - the word iteration has at <a href="https://www.etymonline.com/word/iteration">at its roots</a> the notion of repetition.</p>
<div class="outline-2" id="outline-container-orge1cf9df">
<h2 id="orge1cf9df">The Metaphor</h2>
<div class="outline-text-2" id="text-orge1cf9df">
<p><a href="posts/iterative-algorithms/index.html#org90be021">HTTAA</a> describes the iterative algorithms as being like a long journey where you can't see the entire route and could possibly take a misstep and fall into a ditch, so you need a way to know that you're making progress as well as a way to know you haven't veered off the road. Since we're dealing with repetitions I kind of think a racetrack might make more sense, or at least something that loops, but anyway…</p>
<p>There are some basic questions we have to be able to answer to make a successful trip:</p>
<ul class="org-ul">
<li>How do I get onto the road?</li>
<li>How do I take a step without falling off the road?</li>
<li>How do I know when I've gone far enough?</li>
<li>Once I've gone far enough, how do I get off the road and to my ultimate destination?</li>
</ul>
<p>Too answer these questions we'll be using some basic parts:</p>
<ul class="org-ul">
<li>Our starting point is our <b>Preconditions</b> and to get onto the road we need some pre-loop code to set up the <b>Loop-Invariant</b>.</li>
<li>We take a step with our loop-code and keep from falling off the road by maintaining the <b>Loop-Invariant</b>.</li>
<li>We know we've gone far enough when our <b>Exit-Condition</b> is met.</li>
<li>Once we've gone far enough we use some post-loop code to clean up and end up at our <b>Postconditions</b>.</li>
</ul>
<p>Translating that to mathishness shorthand:</p>
<ul class="org-ul">
<li>\( \langle \textit{Pre-Conditions} \rangle \land \text{Code}_\textit{Pre-Loop} \Rightarrow \langle \textit{Loop-Invariant} \rangle \)</li>
<li>\( \langle \textit{Loop-Invariant} \rangle \land \lnot \langle \textit{Exit-Condition} \rangle \land \text{Code}_\textit{Loop} \Rightarrow \langle \textit{Loop-Invariant'} \rangle \)</li>
<li>\( \langle \textit{Loop-Invariant} \rangle \land \langle \textit{Exit-Condition} \rangle \land \text{Code}_\textit{Post-Loop} \Rightarrow \langle \textit{Post-Conditions} \rangle \)</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgc3310fa">
<h2 id="orgc3310fa">Source</h2>
<div class="outline-text-2" id="text-orgc3310fa">
<ul class="org-ul">
<li><a id="org90be021"></a> <a href="posts/HTTAA/index.html">How To Think About Algorithms</a></li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/more-of-the-output/index.html">More of the Output</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/more-of-the-output/index.html" rel="bookmark"><time class="published dt-published" datetime="2021-11-23T16:10:58-08:00" itemprop="datePublished" title="2021-11-23 16:10">2021-11-23 16:10</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<p>The <i>More of the Output</i> algorithms are <a href="posts/iterative-algorithms/index.html">Iterative Algorithms</a> that are characterized by the fact that after each pass through the loop the output has been added to - so the Measure of Progress is based on the size of the output.</p>
<div class="outline-2" id="outline-container-orgbc00388">
<h2 id="orgbc00388">Source</h2>
<div class="outline-text-2" id="text-orgbc00388">
<ul class="org-ul">
<li><a href="posts/HTTAA/index.html">How To Think About Algorithms</a></li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/the-sorting-problem/index.html">The Sorting Problem</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/the-sorting-problem/index.html" rel="bookmark"><time class="published dt-published" datetime="2021-11-23T15:47:00-08:00" itemprop="datePublished" title="2021-11-23 15:47">2021-11-23 15:47</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div class="outline-2" id="outline-container-org0a03716">
<h2 id="org0a03716">English(ish)</h2>
<div class="outline-text-2" id="text-org0a03716">
<p>The sorting problem involves taking a list of things that can be compared to each other to decide their order and then sorting them into ascending order (actually non-decreasing, since you can have multiple items with the same value, but, this was supposed to be the plain-English version).</p>
</div>
</div>
<div class="outline-2" id="outline-container-org406289a">
<h2 id="org406289a">Specification</h2>
<div class="outline-text-2" id="text-org406289a">
<ul class="org-ul">
<li><b>Preconditions:</b> The input is a list of <i>n</i> orderable items, possibly with repetitions.</li>
<li><b>Postconditions:</b> The output is a list of the same <i>n</i> items in non-decreasing order.</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org2fa02e1">
<h2 id="org2fa02e1">Examples</h2>
<div class="outline-text-2" id="text-org2fa02e1">
<ul class="org-ul">
<li><a href="pages/the-bubble-sort/index.html">The Bubble Sort</a></li>
<li><a href="posts/selection-sort/index.html">Selection Sort</a></li>
<li><a href="posts/insertion-sort/index.html">Insertion Sort</a></li>
<li><a href="posts/the-mergesort/index.html">The Mergesort</a></li>
<li><a href="posts/quicksort/index.html">Quicksort</a></li>
<li><a href="posts/max-heap/index.html">Heap!</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgda10312">
<h2 id="orgda10312">Sources</h2>
<div class="outline-text-2" id="text-orgda10312">
<ul class="org-ul">
<li><a href="posts/HTTAA/index.html">How To Think About Algorithms</a></li>
<li><a href="posts/itdaa/index.html">Introduction to the Design & Analysis of Algorithms (Levitin)</a></li>
</ul>
</div>
</div>
</div>
</article>
</div>
<ul class="pager postindexpager clearfix">
<li class="previous"><a href="index-3.html" rel="prev">Newer posts</a></li>
<li class="next"><a href="index-1.html" rel="next">Older posts</a></li>
</ul>
<script crossorigin="anonymous" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">

      MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],

            displayMath: [['$$','$$'], ['\\[','\\]']],
            processEscapes: true,
            processEnvironments: true,
        }
    });
</script><!--End of body content-->
<footer id="footer">Scribbles by <a href="mailto:cloisteredmonkey.jmark@slmail.me">The Cloistered Monkey</a> © 2024 - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a>
<div id="license" xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/"><span property="dct:title">Ape-Iron</span> is licensed under <a href="http://creativecommons.org/licenses/by-sa/4.0/?ref=chooser-v1" rel="license noopener noreferrer" style="display:inline-block;" target="_blank">CC BY-SA 4.0 <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"><img src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1"></a></div>
</footer>
</div>
<script src="assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script></div>
</body>
</html>
