<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Striking out for data.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Bowling For Data (old posts, page 2) | Bowling For Data</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="rss.xml">
<link rel="canonical" href="https://necromuralist.github.io/Bowling-For-Data/index-2.html">
<link rel="prev" href="index-3.html" type="text/html">
<link rel="next" href="index-1.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.css">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-light
bg-light
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href=".">

            <span id="blog-title">Bowling For Data</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="categories/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="rss.xml" class="nav-link">RSS feed</a>

                
            </li>
</ul>
<!-- DuckDuckGo custom search --><form method="get" id="search" action="https://duckduckgo.com/" class="navbar-form pull-left">
 <input type="hidden" name="sites" value="https://necromuralist.github.io/Bowling-For-Data/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="Search…" class="span2" style="margin-top: 4px;"><input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
</form>
 <!-- End of custom search -->
 

            <ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/r-for-data-science/" class="u-url">R For Data Science</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/r-for-data-science/" rel="bookmark">
            <time class="published dt-published" datetime="2021-12-14T16:10:01-08:00" itemprop="datePublished" title="2021-12-14 16:10">2021-12-14 16:10</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="outline-container-org042d2b1" class="outline-2">
<h2 id="org042d2b1">Table Of Contents</h2>
<div class="outline-text-2" id="text-org042d2b1">
<ul class="org-ul">
<li>Preface</li>
<li>Explore
<ul class="org-ul">
<li>Data Visualization with GGPlot2</li>
<li>Workflow: Basics</li>
<li>Data Transformation With DPlyr</li>
<li>Workflow: Scripts</li>
<li>Exploratory Data Analysis</li>
<li>Workflow: Projects</li>
</ul>
</li>
<li>Wrangle
<ul class="org-ul">
<li>Tibbles With Tibble</li>
<li>Data Import With Readr</li>
<li>Tidy Data With Tidyr</li>
<li>Relational Data With Dplyr</li>
<li>Strings With Stringr</li>
<li>Factors With Forcats</li>
<li>Dates and Times With Lubridate</li>
</ul>
</li>
<li>Program
<ul class="org-ul">
<li>Pipes With Magrittr</li>
<li>Functions</li>
<li>Vectors</li>
<li>Iterations With Purrr</li>
</ul>
</li>
<li>Model
<ul class="org-ul">
<li>Model Basics With Modelr</li>
<li>Model Building</li>
<li>Many Models With Purrr and Broom</li>
</ul>
</li>
<li>Communicate
<ul class="org-ul">
<li>R Markdown</li>
<li>Graphics For Communication With GGPlot2</li>
<li>R Markdown Formats</li>
<li>R Markdown Workflow</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org18bee64" class="outline-2">
<h2 id="org18bee64">Links</h2>
<div class="outline-text-2" id="text-org18bee64">
<ul class="org-ul">
<li>Online Version: <a href="https://r4ds.had.co.nz/">https://r4ds.had.co.nz/</a>
</li>
<li>Github Source (for the book, written in R Markdown): <a href="https://github.com/hadley/r4ds/blob/main/index.Rmd">https://github.com/hadley/r4ds/blob/main/index.Rmd</a>
</li>
</ul>
</div>
</div>
<div id="outline-container-org47d4c95" class="outline-2">
<h2 id="org47d4c95">Citation</h2>
<div class="outline-text-2" id="text-org47d4c95">
<ul class="org-ul">
<li>[RFDS] Wickham H, Grolemund G. R for data science: import, tidy, transform, visualize, and model data. First edition. Sebastopol, CA: O’Reilly; 2016. 492 p.</li>
</ul>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/a-look-at-ggplot/" class="u-url">A Look At ggplot</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/a-look-at-ggplot/" rel="bookmark">
            <time class="published dt-published" datetime="2021-12-13T14:34:19-08:00" itemprop="datePublished" title="2021-12-13 14:34">2021-12-13 14:34</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/a-look-at-ggplot/#orge813ecc">Introduction</a></li>
<li>
<a href="posts/a-look-at-ggplot/#org644bbe8">Set Up Stuff</a>
<ul>
<li><a href="posts/a-look-at-ggplot/#orgda36591">Imports</a></li>
<li><a href="posts/a-look-at-ggplot/#orgf3aebe1">Constants</a></li>
<li><a href="posts/a-look-at-ggplot/#orge9e52c5">The GGPlot2 Theme</a></li>
</ul>
</li>
<li>
<a href="posts/a-look-at-ggplot/#orgaec679e">The MPG Dataset</a>
<ul>
<li><a href="posts/a-look-at-ggplot/#org3683d1c">The Variables</a></li>
<li><a href="posts/a-look-at-ggplot/#orga2b37a1">Renaming Some Columns</a></li>
<li><a href="posts/a-look-at-ggplot/#org4f82e8d">Looking at the Data</a></li>
<li>
<a href="posts/a-look-at-ggplot/#org5041e91">Some Renaming</a>
<ul>
<li><a href="posts/a-look-at-ggplot/#org0a08925">The Drive Trains</a></li>
<li><a href="posts/a-look-at-ggplot/#org27b3d88">Fuel Types</a></li>
<li><a href="posts/a-look-at-ggplot/#org75da78d">Transmission</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="posts/a-look-at-ggplot/#org8c7d0fd">Displacement Vs Highway Mileage</a></li>
<li>
<a href="posts/a-look-at-ggplot/#org1fd29f9">Ditching the Highway (Mileage)</a>
<ul>
<li><a href="posts/a-look-at-ggplot/#org0d5d40e">Combined Mileage</a></li>
<li><a href="posts/a-look-at-ggplot/#org201a2a2">Comparing the Two</a></li>
<li><a href="posts/a-look-at-ggplot/#org2038d5b">Gallons Per Mile</a></li>
</ul>
</li>
<li>
<a href="posts/a-look-at-ggplot/#org458d91e">Displacement With Class</a>
<ul>
<li><a href="posts/a-look-at-ggplot/#org9398b7c">Efficiency</a></li>
<li><a href="posts/a-look-at-ggplot/#org8c90e99">Faceting The Classes</a></li>
<li><a href="posts/a-look-at-ggplot/#org2a80542">Smoothing the Line</a></li>
<li><a href="posts/a-look-at-ggplot/#orgc4b6d75">Different Datasets to the Geometries</a></li>
<li><a href="posts/a-look-at-ggplot/#orgb71e124">Small Four-Wheel Drive Automobiles</a></li>
</ul>
</li>
<li>
<a href="posts/a-look-at-ggplot/#org47a6f2a">Bar Plots</a>
<ul>
<li><a href="posts/a-look-at-ggplot/#org10ab9b4">By Count</a></li>
<li><a href="posts/a-look-at-ggplot/#org4405a5e">By Proportion</a></li>
<li><a href="posts/a-look-at-ggplot/#org4249897">Un-Stacked</a></li>
<li><a href="posts/a-look-at-ggplot/#orga9a8116">Proportions Not Counts</a></li>
</ul>
</li>
<li>
<a href="posts/a-look-at-ggplot/#org90980d3">Stat Summary</a>
<ul>
<li><a href="posts/a-look-at-ggplot/#org5ae7b26">Boxplot</a></li>
</ul>
</li>
<li><a href="posts/a-look-at-ggplot/#orgfcc96a5">The End</a></li>
<li><a href="posts/a-look-at-ggplot/#orga56c38a">Link Collection</a></li>
</ul>
</div>
</div>

<div id="outline-container-orge813ecc" class="outline-2">
<h2 id="orge813ecc">Introduction</h2>
<div class="outline-text-2" id="text-orge813ecc">
<p>
This is a quick walk-through of some aspects of <a href="https://ggplot2.tidyverse.org/">ggplot2</a> based on the first chapter of {% doc %}r-for-data-science{% /doc %}.
</p>
</div>
</div>
<div id="outline-container-org644bbe8" class="outline-2">
<h2 id="org644bbe8">Set Up Stuff</h2>
<div class="outline-text-2" id="text-org644bbe8">
</div>
<div id="outline-container-orgda36591" class="outline-3">
<h3 id="orgda36591">Imports</h3>
<div class="outline-text-3" id="text-orgda36591">
<p>
   <b><b>Note:</b></b> 
When you run the first code block to start the session, remember to give it the path to the posts-output folder so you don't need the path when saving the plots.
</p>
<div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="s">"assertthat"</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="s">"ggplot2"</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="s">"knitr"</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="s">"tidyverse"</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgf3aebe1" class="outline-3">
<h3 id="orgf3aebe1">Constants</h3>
<div class="outline-text-3" id="text-orgf3aebe1">
<p>
These are stuff that get re-used in the plotting.
</p>

<div class="highlight"><pre><span></span><span class="n">DISPLACEMENT</span> <span class="o">&lt;-</span> <span class="s">"Engine Displacement (Liters)"</span>
<span class="n">EFFICIENCY</span> <span class="o">&lt;-</span><span class="s">"Gallons Per Mile (Combined)"</span>
<span class="n">DISPLACEMENT_VS_EFFICIENCY</span> <span class="o">=</span> <span class="nf">partial</span><span class="p">(</span><span class="n">labs</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">DISPLACEMENT</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">EFFICIENCY</span><span class="p">)</span>

<span class="n">BLUE</span> <span class="o">&lt;-</span> <span class="s">"#4687b7"</span>
<span class="n">RED</span> <span class="o">&lt;-</span> <span class="s">"#ce7b6d"</span>
</pre></div>
</div>
</div>

<div id="outline-container-orge9e52c5" class="outline-3">
<h3 id="orge9e52c5">The GGPlot2 Theme</h3>
<div class="outline-text-3" id="text-orge9e52c5">
<div class="highlight"><pre><span></span><span class="nf">theme_set</span><span class="p">(</span><span class="nf">theme_minimal</span><span class="p">(</span><span class="n">base_family</span><span class="o">=</span><span class="s">"Palatino"</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-orgaec679e" class="outline-2">
<h2 id="orgaec679e">The MPG Dataset</h2>
<div class="outline-text-2" id="text-orgaec679e">
<p>
For some reason loading <code>ggplot2</code> also loads this dataset. Its short description is "Fuel economy data from 1999 to 2008 for 38 popular models of cars". The long description:
</p>

<blockquote>
<p>
This dataset contains a subset of the fuel economy data that the
EPA makes available on &lt;URL: <a href="https://fueleconomy.gov/">https://fueleconomy.gov/</a>&gt;. It
contains only models which had a new release every year between
1999 and 2008 - this was used as a proxy for the popularity of the
car.
</p>
</blockquote>
</div>

<div id="outline-container-org3683d1c" class="outline-3">
<h3 id="org3683d1c">The Variables</h3>
<div class="outline-text-3" id="text-org3683d1c">
<p>
It's a data frame with 234 rows and 11 variables:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Variable</th>
<th scope="col" class="org-left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">manufacturer</td>
<td class="org-left">manufacturer name</td>
</tr>
<tr>
<td class="org-left">model</td>
<td class="org-left">model name</td>
</tr>
<tr>
<td class="org-left">displ</td>
<td class="org-left">engine displacement, in litres</td>
</tr>
<tr>
<td class="org-left">year</td>
<td class="org-left">year of manufacture</td>
</tr>
<tr>
<td class="org-left">cyl</td>
<td class="org-left">number of cylinders</td>
</tr>
<tr>
<td class="org-left">trans</td>
<td class="org-left">type of transmission</td>
</tr>
<tr>
<td class="org-left">drv</td>
<td class="org-left">drive train (<a href="posts/a-look-at-ggplot/#org0a08925">listed below</a>)</td>
</tr>
<tr>
<td class="org-left">cty</td>
<td class="org-left">city miles per gallon</td>
</tr>
<tr>
<td class="org-left">hwy</td>
<td class="org-left">highway miles per gallon</td>
</tr>
<tr>
<td class="org-left">fl</td>
<td class="org-left">fuel type</td>
</tr>
<tr>
<td class="org-left">class</td>
<td class="org-left">"type" of car</td>
</tr>
</tbody>
</table>
<p>
I'll do some column renaming here since I keep forgetting what abbreviations they used.
</p>
</div>
</div>

<div id="outline-container-orga2b37a1" class="outline-3">
<h3 id="orga2b37a1">Renaming Some Columns</h3>
<div class="outline-text-3" id="text-orga2b37a1">
<div class="highlight"><pre><span></span><span class="n">mpg</span> <span class="o">&lt;-</span> <span class="n">mpg</span> <span class="o">%&gt;%</span>
  <span class="nf">rename</span><span class="p">(</span>
    <span class="n">displacement</span><span class="o">=</span><span class="n">displ</span><span class="p">,</span>
    <span class="n">cylinders</span><span class="o">=</span><span class="n">cyl</span><span class="p">,</span>
    <span class="n">transmission</span><span class="o">=</span><span class="n">trans</span><span class="p">,</span>
    <span class="n">drive_train</span><span class="o">=</span><span class="n">drv</span><span class="p">,</span>
    <span class="n">city_mpg</span><span class="o">=</span><span class="n">cty</span><span class="p">,</span>
    <span class="n">highway_mpg</span><span class="o">=</span><span class="n">hwy</span><span class="p">,</span>
    <span class="n">fuel_type</span><span class="o">=</span><span class="n">fl</span><span class="p">,</span>
    <span class="p">)</span>

<span class="nf">str</span><span class="p">(</span><span class="n">mpg</span><span class="p">)</span>
</pre></div>

<pre class="example">
tibble [234 × 11] (S3: tbl_df/tbl/data.frame)
 $ manufacturer: chr [1:234] "audi" "audi" "audi" "audi" ...
 $ model       : chr [1:234] "a4" "a4" "a4" "a4" ...
 $ displacement: num [1:234] 1.8 1.8 2 2 2.8 2.8 3.1 1.8 1.8 2 ...
 $ year        : int [1:234] 1999 1999 2008 2008 1999 1999 2008 1999 1999 2008 ...
 $ cylinders   : int [1:234] 4 4 4 4 6 6 6 4 4 4 ...
 $ transmission: chr [1:234] "auto(l5)" "manual(m5)" "manual(m6)" "auto(av)" ...
 $ drive_train : chr [1:234] "f" "f" "f" "f" ...
 $ city_mpg    : int [1:234] 18 21 20 21 16 18 18 18 16 20 ...
 $ highway_mpg : int [1:234] 29 29 31 30 26 26 27 26 25 28 ...
 $ fuel_type   : chr [1:234] "p" "p" "p" "p" ...
 $ class       : chr [1:234] "compact" "compact" "compact" "compact" ...
</pre>
</div>
</div>

<div id="outline-container-org4f82e8d" class="outline-3">
<h3 id="org4f82e8d">Looking at the Data</h3>
<div class="outline-text-3" id="text-org4f82e8d">
<div class="highlight"><pre><span></span><span class="nf">kable</span><span class="p">(</span><span class="nf">head</span><span class="p">(</span><span class="n">mpg</span><span class="p">),</span> <span class="n">caption</span><span class="o">=</span><span class="s">"MPG Dataset (EPA Automobile Data)"</span><span class="p">)</span>
</pre></div>

<p>
Table: MPG Dataset (EPA Automobile Data)
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">manufacturer</th>
<th scope="col" class="org-left">model</th>
<th scope="col" class="org-right">displacement</th>
<th scope="col" class="org-right">year</th>
<th scope="col" class="org-right">cylinders</th>
<th scope="col" class="org-left">transmission</th>
<th scope="col" class="org-left">drive_train</th>
<th scope="col" class="org-right">city_mpg</th>
<th scope="col" class="org-right">highway_mpg</th>
<th scope="col" class="org-left">fuel_type</th>
<th scope="col" class="org-left">class</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">audi</td>
<td class="org-left">a4</td>
<td class="org-right">1.8</td>
<td class="org-right">1999</td>
<td class="org-right">4</td>
<td class="org-left">auto(l5)</td>
<td class="org-left">f</td>
<td class="org-right">18</td>
<td class="org-right">29</td>
<td class="org-left">p</td>
<td class="org-left">compact</td>
</tr>
<tr>
<td class="org-left">audi</td>
<td class="org-left">a4</td>
<td class="org-right">1.8</td>
<td class="org-right">1999</td>
<td class="org-right">4</td>
<td class="org-left">manual(m5)</td>
<td class="org-left">f</td>
<td class="org-right">21</td>
<td class="org-right">29</td>
<td class="org-left">p</td>
<td class="org-left">compact</td>
</tr>
<tr>
<td class="org-left">audi</td>
<td class="org-left">a4</td>
<td class="org-right">2.0</td>
<td class="org-right">2008</td>
<td class="org-right">4</td>
<td class="org-left">manual(m6)</td>
<td class="org-left">f</td>
<td class="org-right">20</td>
<td class="org-right">31</td>
<td class="org-left">p</td>
<td class="org-left">compact</td>
</tr>
<tr>
<td class="org-left">audi</td>
<td class="org-left">a4</td>
<td class="org-right">2.0</td>
<td class="org-right">2008</td>
<td class="org-right">4</td>
<td class="org-left">auto(av)</td>
<td class="org-left">f</td>
<td class="org-right">21</td>
<td class="org-right">30</td>
<td class="org-left">p</td>
<td class="org-left">compact</td>
</tr>
<tr>
<td class="org-left">audi</td>
<td class="org-left">a4</td>
<td class="org-right">2.8</td>
<td class="org-right">1999</td>
<td class="org-right">6</td>
<td class="org-left">auto(l5)</td>
<td class="org-left">f</td>
<td class="org-right">16</td>
<td class="org-right">26</td>
<td class="org-left">p</td>
<td class="org-left">compact</td>
</tr>
<tr>
<td class="org-left">audi</td>
<td class="org-left">a4</td>
<td class="org-right">2.8</td>
<td class="org-right">1999</td>
<td class="org-right">6</td>
<td class="org-left">manual(m5)</td>
<td class="org-left">f</td>
<td class="org-right">18</td>
<td class="org-right">26</td>
<td class="org-left">p</td>
<td class="org-left">compact</td>
</tr>
</tbody>
</table>
</div>
</div>


<div id="outline-container-org5041e91" class="outline-3">
<h3 id="org5041e91">Some Renaming</h3>
<div class="outline-text-3" id="text-org5041e91">
</div>
<div id="outline-container-org0a08925" class="outline-4">
<h4 id="org0a08925">The Drive Trains</h4>
<div class="outline-text-4" id="text-org0a08925">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Abbreviation</th>
<th scope="col" class="org-left">Meaning</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">f</td>
<td class="org-left">Front-Wheel Drive</td>
</tr>
<tr>
<td class="org-left">r</td>
<td class="org-left">Rear-Wheel Drive</td>
</tr>
<tr>
<td class="org-left">4</td>
<td class="org-left">Four-Wheel Drive</td>
</tr>
</tbody>
</table>
<p>
These aren't too obscure, but I think I'll rename them anyway.
</p>

<div class="highlight"><pre><span></span><span class="n">mpg</span><span class="o">$</span><span class="n">drive_train</span> <span class="o">&lt;-</span> <span class="nf">recode</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">drive_train</span><span class="p">,</span>
			  <span class="n">f</span><span class="o">=</span><span class="s">"Front-Wheel"</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="s">"Rear-Wheel"</span><span class="p">,</span> <span class="n">`4`</span><span class="o">=</span><span class="s">"Four-Wheel"</span> <span class="p">)</span>
<span class="nf">kable</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">drive_train</span><span class="p">),</span> <span class="n">col.names</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">"Drives"</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="org-left"></colgroup>
<thead><tr>
<th scope="col" class="org-left">Drives</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">Front-Wheel</td>
</tr>
<tr>
<td class="org-left">Four-Wheel</td>
</tr>
<tr>
<td class="org-left">Rear-Wheel</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><span class="nf">assert_that</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">drive_train</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org27b3d88" class="outline-4">
<h4 id="org27b3d88">Fuel Types</h4>
<div class="outline-text-4" id="text-org27b3d88">
<p>
Although this is about <code>ggplot2</code>, and the data is sort of a side effect, since I had to look some of this data up to figure out what it meant (at <a href="https://www.fueleconomy.gov/">fueleconomy.gov</a>) I'll use this opportunity to document it by updating the data.
</p>

<div class="highlight"><pre><span></span><span class="n">mpg</span><span class="o">$</span><span class="n">fuel_type</span> <span class="o">&lt;-</span> <span class="nf">recode</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">fuel_type</span><span class="p">,</span>
			<span class="n">p</span><span class="o">=</span><span class="s">"Premium Unleaded"</span><span class="p">,</span>
			<span class="n">r</span><span class="o">=</span><span class="s">"Regular Unleaded"</span><span class="p">,</span>
			<span class="n">e</span><span class="o">=</span><span class="s">"Ethanol"</span><span class="p">,</span>
			<span class="n">d</span><span class="o">=</span><span class="s">"Diesel Fuel"</span><span class="p">,</span>
			<span class="n">c</span><span class="o">=</span><span class="s">"Compressed Natural Gas"</span><span class="p">)</span>

<span class="nf">kable</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">fuel_type</span><span class="p">),</span> <span class="n">col.names</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">"Fuel Type"</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="org-left"></colgroup>
<thead><tr>
<th scope="col" class="org-left">Fuel Type</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">Premium Unleaded</td>
</tr>
<tr>
<td class="org-left">Regular Unleaded</td>
</tr>
<tr>
<td class="org-left">Ethanol</td>
</tr>
<tr>
<td class="org-left">Diesel Fuel</td>
</tr>
<tr>
<td class="org-left">Compressed Natural Gas</td>
</tr>
</tbody>
</table>
<p>
For some reason I couldn't find a table that directly mapped to the data set so I'm sort of guessing that this is what they stood for based on the 1999 guide on their <a href="https://www.fueleconomy.gov/feg/download.shtml">download page</a>. There's also a <code>L</code> for <b>Liquified Petroleum Gas (Propane)</b> in the guide but it's not in the data set.
</p>

<div class="highlight"><pre><span></span><span class="nf">assert_that</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">fuel_type</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div id="outline-container-org75da78d" class="outline-4">
<h4 id="org75da78d">Transmission</h4>
<div class="outline-text-4" id="text-org75da78d">
<div class="highlight"><pre><span></span><span class="n">mpg</span><span class="o">$</span><span class="n">transmission</span> <span class="o">&lt;-</span> <span class="nf">recode</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">transmission</span><span class="p">,</span>
			   <span class="n">`auto(av)`</span><span class="o">=</span><span class="s">"Continuously Variable"</span><span class="p">,</span>
			   <span class="n">`auto(s4)`</span><span class="o">=</span><span class="s">"Automatic 4-Speed"</span><span class="p">,</span>
			   <span class="n">`auto(s5)`</span><span class="o">=</span><span class="s">"Automatic 5-Speed"</span><span class="p">,</span>
			   <span class="n">`auto(s6)`</span><span class="o">=</span><span class="s">"Automatic 6-Speed"</span><span class="p">,</span>
			   <span class="n">`auto(l3)`</span><span class="o">=</span><span class="s">"Automatic Lockup 3-Speed"</span><span class="p">,</span>
			   <span class="n">`auto(l4)`</span><span class="o">=</span><span class="s">"Automatic Lockup 4-Speed"</span><span class="p">,</span>
			   <span class="n">`auto(l5)`</span><span class="o">=</span><span class="s">"Automatic Lockup 5-Speed"</span><span class="p">,</span>
			   <span class="n">`auto(l6)`</span><span class="o">=</span><span class="s">"Automatic Lockup 6-Speed"</span><span class="p">,</span>
			   <span class="n">`manual(m5)`</span><span class="o">=</span><span class="s">"Manual 5-Speed"</span><span class="p">,</span>
			   <span class="n">`manual(m6)`</span><span class="o">=</span><span class="s">"Manual 6-Speed"</span>
			   <span class="p">)</span>

<span class="nf">kable</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">transmission</span><span class="p">),</span> <span class="n">col.names</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">"Transmission"</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="org-left"></colgroup>
<thead><tr>
<th scope="col" class="org-left">Transmission</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">Automatic Lockup 5-Speed</td>
</tr>
<tr>
<td class="org-left">Manual 5-Speed</td>
</tr>
<tr>
<td class="org-left">Manual 6-Speed</td>
</tr>
<tr>
<td class="org-left">Continuously Variable</td>
</tr>
<tr>
<td class="org-left">Automatic 6-Speed</td>
</tr>
<tr>
<td class="org-left">Automatic Lockup 4-Speed</td>
</tr>
<tr>
<td class="org-left">Automatic Lockup 3-Speed</td>
</tr>
<tr>
<td class="org-left">Automatic Lockup 6-Speed</td>
</tr>
<tr>
<td class="org-left">Automatic 5-Speed</td>
</tr>
<tr>
<td class="org-left">Automatic 4-Speed</td>
</tr>
</tbody>
</table>
<p>
Strangely, there's no listing for 4-speed manual transmissions.
</p>

<div class="highlight"><pre><span></span><span class="nf">assert_that</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">transmission</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div id="outline-container-org8c7d0fd" class="outline-2">
<h2 id="org8c7d0fd">Displacement Vs Highway Mileage</h2>
<div class="outline-text-2" id="text-org8c7d0fd">
<p>
Now we come to the basic thing that the chapter in <code>R For Data Science</code> looks at (mostly) - what affects mileage for automobiles. The first thing we'll do is look at how the size of the engine affects the mileage.
</p>

<div class="highlight"><pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displacement</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">highway_mpg</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">highway_mpg</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">DISPLACEMENT</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">"Highway MPG"</span><span class="p">,</span>
       <span class="n">title</span><span class="o">=</span><span class="s">"Displacement vs Mileage"</span><span class="p">)</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s">"displacement_vs_mileage.png"</span>
<span class="nf">ggsave</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>

<p>
<img src="posts/a-look-at-ggplot/displacement_vs_mileage.png" alt="nil"></p>

<p>
It has a roughly linear relationship, as you might expect, but the rest of this post is about how to get more information out of the data using <code>ggplot2</code>.
</p>
</div>
</div>

<div id="outline-container-org1fd29f9" class="outline-2">
<h2 id="org1fd29f9">Ditching the Highway (Mileage)</h2>
<div class="outline-text-2" id="text-org1fd29f9">
</div>
<div id="outline-container-org0d5d40e" class="outline-3">
<h3 id="org0d5d40e">Combined Mileage</h3>
<div class="outline-text-3" id="text-org0d5d40e">
<p>
The EPA uses a weighted average to create a combined metric that uses both Highway and City mileage.
</p>

<p>
\[
\textrm{Combined Fuel Economy} = 0.55 \times \textit{city} + 0.45 \times \textit{highway}
\]
</p>

<p>
I've also seen it done as the harmonic mean (<a href="https://tasks.illustrativemathematics.org/content-standards/tasks/825">on Illustrative Mathematics</a>), but if you round to the nearest whole number it comes out about the same.
</p>

<div class="highlight"><pre><span></span><span class="n">mpg</span><span class="o">$</span><span class="n">combined_fuel_economy</span> <span class="o">&lt;-</span> <span class="m">0.55</span> <span class="o">*</span> <span class="n">mpg</span><span class="o">$</span><span class="n">city_mpg</span> <span class="o">+</span> <span class="m">0.45</span> <span class="o">*</span> <span class="n">mpg</span><span class="o">$</span><span class="n">highway_mpg</span>

<span class="n">plot</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displacement</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">combined_fuel_economy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">combined_fuel_economy</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">DISPLACEMENT</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">"Combined MPG"</span><span class="p">,</span>
       <span class="n">title</span><span class="o">=</span><span class="s">"Displacement vs Mileage"</span><span class="p">)</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s">"displacement_vs_combined_mileage.png"</span>
<span class="nf">ggsave</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>

<p>
<img src="posts/a-look-at-ggplot/displacement_vs_combined_mileage.png" alt="nil"></p>
</div>
</div>

<div id="outline-container-org201a2a2" class="outline-3">
<h3 id="org201a2a2">Comparing the Two</h3>
<div class="outline-text-3" id="text-org201a2a2">
<p>
We can plot them together to see how much the combined MPG differs from the highway MPG.
</p>

<div class="highlight"><pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_smooth</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displacement</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">combined_fuel_economy</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s">"red"</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_smooth</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displacement</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">highway_mpg</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s">"blue"</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">DISPLACEMENT</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">"MPG"</span><span class="p">,</span>
       <span class="n">title</span><span class="o">=</span><span class="s">"Displacement vs Mileage (Highway and Combined)"</span><span class="p">)</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s">"highway_vs_combined_mileage.png"</span>
<span class="nf">ggsave</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>

<p>
<img src="posts/a-look-at-ggplot/highway_vs_combined_mileage.png" alt="nil"></p>

<p>
Adding the city mileage drops the mileage somewhat, although the line looks to be about the same shape.
</p>
</div>
</div>

<div id="outline-container-org2038d5b" class="outline-3">
<h3 id="org2038d5b">Gallons Per Mile</h3>
<div class="outline-text-3" id="text-org2038d5b">
<p>
The EPA's explanation of their <a href="https://www.epa.gov/fueleconomy/text-version-gasoline-label">vehicle labels</a> mentions that the reason why they put a <b>Fuel Consumption Rate</b> is that the <b>Miles Per Gallon</b> metric is actually not a good way to compare mileage - it is subject to a "Miles Per Gallon Illusion" (<a href="https://www.realclearscience.com/blog/2019/02/14/the_miles_per_gallon_illusion.html#!">ReaClearScience</a> has an article about it). Here's how the number of gallons used per 1,000 miles driven changes with miles-per-gallon.
</p>

<div class="highlight"><pre><span></span><span class="n">mileage</span> <span class="o">&lt;-</span> <span class="nf">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">100</span><span class="p">)</span>
<span class="n">miles</span> <span class="o">=</span> <span class="m">1000</span>
<span class="n">gallons_per_1000_miles</span> <span class="o">&lt;-</span> <span class="n">miles</span><span class="o">/</span><span class="n">mileage</span>

<span class="n">improvement</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">MPG</span><span class="o">=</span><span class="n">mileage</span><span class="p">,</span>
			  <span class="n">gallons</span><span class="o">=</span><span class="n">gallons_per_1000_miles</span><span class="p">)</span>
<span class="n">plot</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">improvement</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">mileage</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">gallons</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">"blue"</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">mileage</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">gallons</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s">"blue"</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Fuel Consumption vs MPG"</span><span class="p">,</span>
       <span class="n">x</span><span class="o">=</span><span class="s">"Miles Per Gallon"</span><span class="p">,</span>
       <span class="n">y</span><span class="o">=</span><span class="s">"Gallons Used Per 1,000 Miles"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"gallons_vs_mpg.png"</span><span class="p">)</span>
</pre></div>

<p>
<img src="posts/a-look-at-ggplot/gallons_vs_mpg.png" alt="nil"></p>

<p>
As you can see the improvement in the number of gallons used goes down pretty fast as the miles-per-gallon goes up. Let's see about adding a fuel-efficency column. What happens when you switch to Gallons Per Mile?
</p>

<div class="highlight"><pre><span></span><span class="n">gallons_per_mile</span> <span class="o">&lt;-</span> <span class="n">mileage</span>
<span class="n">gallons_per_1000_miles</span> <span class="o">&lt;-</span> <span class="n">miles</span> <span class="o">*</span> <span class="n">gallons_per_mile</span>

<span class="n">improvement</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">gpm</span><span class="o">=</span><span class="n">gallons_per_mile</span><span class="p">,</span>
			  <span class="n">gallons</span><span class="o">=</span><span class="n">gallons_per_1000_miles</span><span class="p">)</span>
<span class="n">plot</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">improvement</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">gpm</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">gallons</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">"blue"</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">gpm</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">gallons</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s">"blue"</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Fuel Consumption vs Gallons Per Mile"</span><span class="p">,</span>
       <span class="n">x</span><span class="o">=</span><span class="s">"Gallons Per Mile"</span><span class="p">,</span>
       <span class="n">y</span><span class="o">=</span><span class="s">"Gallons Used Per 1,000 Miles"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"gallons_vs_efficiency.png"</span><span class="p">)</span>
</pre></div>

<p>
<img src="posts/a-look-at-ggplot/gallons_vs_efficiency.png" alt="nil"></p>

<p>
I suppose you could just figure that that'd be the case, but this <i>is</i> about plotting.
</p>

<div class="highlight"><pre><span></span><span class="n">mpg</span><span class="o">$</span><span class="n">gallons_per_mile</span> <span class="o">&lt;-</span> <span class="m">1</span><span class="o">/</span><span class="n">mpg</span><span class="o">$</span><span class="n">combined_fuel_economy</span>

<span class="n">plot</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displacement</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">gallons_per_mile</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">DISPLACEMENT_VS_EFFICIENCY</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Displacement vs Fuel Efficiency"</span><span class="p">)</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s">"displacement_vs_fuel_efficiency.png"</span>
<span class="nf">ggsave</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>

<p>
<img src="posts/a-look-at-ggplot/displacement_vs_fuel_efficiency.png" alt="nil"></p>

<p>
Even though this is just the inverse of the MPG plot it seems more intuitive to me. I didn't really notice that big outlier at the top when I plotted it using MPG, so I think I'll stick with this.
</p>
</div>
</div>
</div>

<div id="outline-container-org458d91e" class="outline-2">
<h2 id="org458d91e">Displacement With Class</h2>
<div class="outline-text-2" id="text-org458d91e">
<p>
The displacement seems to mostly have a linear relationship with mileage, but there's exceptions, let's see if showing the class of the car reveals any interesting patterns.
</p>

<div class="highlight"><pre><span></span><span class="nf">unique</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">class</span><span class="p">)</span>
</pre></div>

<pre class="example">
[1] "compact"    "midsize"    "suv"        "2seater"    "minivan"   
[6] "pickup"     "subcompact"
</pre>
</div>

<div id="outline-container-org9398b7c" class="outline-3">
<h3 id="org9398b7c">Efficiency</h3>
<div class="outline-text-3" id="text-org9398b7c">
<div class="highlight"><pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displacement</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">gallons_per_mile</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">class</span><span class="p">),</span>
	     <span class="n">position</span><span class="o">=</span><span class="s">"jitter"</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">DISPLACEMENT_VS_EFFICIENCY</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Displacement vs Fuel Efficiency"</span><span class="p">)</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s">"displacement_vs_mileage_with_class.png"</span>
<span class="nf">ggsave</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>

<p>
<img src="posts/a-look-at-ggplot/displacement_vs_mileage_with_class.png" alt="nil"></p>

<p>
I added a little jitter because it looked like the top outlier was just one point. It looks like 2-seaters and one of the mid-sized cars had unusually good mileage given their engine displacement. What's a two-seater?
</p>

<div class="highlight"><pre><span></span><span class="nf">kable</span><span class="p">(</span><span class="nf">filter</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">class</span><span class="o">==</span><span class="s">"2seater"</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
<col class="org-left">
<col class="org-left">
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">manufacturer</th>
<th scope="col" class="org-left">model</th>
<th scope="col" class="org-right">displacement</th>
<th scope="col" class="org-right">year</th>
<th scope="col" class="org-right">cylinders</th>
<th scope="col" class="org-left">transmission</th>
<th scope="col" class="org-left">drive_train</th>
<th scope="col" class="org-right">city_mpg</th>
<th scope="col" class="org-right">highway_mpg</th>
<th scope="col" class="org-left">fuel_type</th>
<th scope="col" class="org-left">class</th>
<th scope="col" class="org-right">combined_fuel_economy</th>
<th scope="col" class="org-right">gallons_per_mile</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">chevrolet</td>
<td class="org-left">corvette</td>
<td class="org-right">5.7</td>
<td class="org-right">1999</td>
<td class="org-right">8</td>
<td class="org-left">Manual 6-Speed</td>
<td class="org-left">Rear-Wheel</td>
<td class="org-right">16</td>
<td class="org-right">26</td>
<td class="org-left">Premium Unleaded</td>
<td class="org-left">2seater</td>
<td class="org-right">20.50</td>
<td class="org-right">0.0487805</td>
</tr>
<tr>
<td class="org-left">chevrolet</td>
<td class="org-left">corvette</td>
<td class="org-right">5.7</td>
<td class="org-right">1999</td>
<td class="org-right">8</td>
<td class="org-left">Automatic Lockup 4-Speed</td>
<td class="org-left">Rear-Wheel</td>
<td class="org-right">15</td>
<td class="org-right">23</td>
<td class="org-left">Premium Unleaded</td>
<td class="org-left">2seater</td>
<td class="org-right">18.60</td>
<td class="org-right">0.0537634</td>
</tr>
<tr>
<td class="org-left">chevrolet</td>
<td class="org-left">corvette</td>
<td class="org-right">6.2</td>
<td class="org-right">2008</td>
<td class="org-right">8</td>
<td class="org-left">Manual 6-Speed</td>
<td class="org-left">Rear-Wheel</td>
<td class="org-right">16</td>
<td class="org-right">26</td>
<td class="org-left">Premium Unleaded</td>
<td class="org-left">2seater</td>
<td class="org-right">20.50</td>
<td class="org-right">0.0487805</td>
</tr>
<tr>
<td class="org-left">chevrolet</td>
<td class="org-left">corvette</td>
<td class="org-right">6.2</td>
<td class="org-right">2008</td>
<td class="org-right">8</td>
<td class="org-left">Automatic 6-Speed</td>
<td class="org-left">Rear-Wheel</td>
<td class="org-right">15</td>
<td class="org-right">25</td>
<td class="org-left">Premium Unleaded</td>
<td class="org-left">2seater</td>
<td class="org-right">19.50</td>
<td class="org-right">0.0512821</td>
</tr>
<tr>
<td class="org-left">chevrolet</td>
<td class="org-left">corvette</td>
<td class="org-right">7.0</td>
<td class="org-right">2008</td>
<td class="org-right">8</td>
<td class="org-left">Manual 6-Speed</td>
<td class="org-left">Rear-Wheel</td>
<td class="org-right">15</td>
<td class="org-right">24</td>
<td class="org-left">Premium Unleaded</td>
<td class="org-left">2seater</td>
<td class="org-right">19.05</td>
<td class="org-right">0.0524934</td>
</tr>
</tbody>
</table>
<p>
Just Corvettes here.
</p>
</div>
</div>


<div id="outline-container-org8c90e99" class="outline-3">
<h3 id="org8c90e99">Faceting The Classes</h3>
<div class="outline-text-3" id="text-org8c90e99">
<p>
While the use of color is useful for comparing the classes on the same plot, sometimes it can be easier to interpret plots that have the categorical classes separated into sub-plots (called <b><b>facets</b></b>).
</p>

<p>
By default the faceting functions use aphabetical order, I'm going to use a slightly different ordering to see if it makes it clearer how the classes compare (this is based on the medians that I plotted <a href="posts/a-look-at-ggplot/#org90980d3">below</a>).
</p>

<div class="highlight"><pre><span></span><span class="n">mpg</span><span class="o">$</span><span class="n">class_order</span> <span class="o">&lt;-</span> <span class="nf">factor</span><span class="p">(</span><span class="n">mpg</span><span class="o">$</span><span class="n">class</span><span class="p">,</span>
			  <span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">"compact"</span><span class="p">,</span> <span class="s">"subcompact"</span><span class="p">,</span> <span class="s">"midsize"</span><span class="p">,</span>
				   <span class="s">"2seater"</span><span class="p">,</span>
				   <span class="s">"minivan"</span><span class="p">,</span> <span class="s">"suv"</span><span class="p">,</span> <span class="s">"pickup"</span><span class="p">))</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displacement</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">gallons_per_mile</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">gallons_per_mile</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">facet_grid</span><span class="p">(</span><span class="n">.</span> <span class="o">~</span> <span class="n">class_order</span><span class="p">)</span> <span class="o">+</span> 
  <span class="nf">DISPLACEMENT_VS_EFFICIENCY</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Displacement vs Efficiency"</span><span class="p">)</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s">"displacement_vs_mileage_faceted_classes.png"</span>
<span class="nf">ggsave</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>

<p>
I'm using <code>facet_grid</code> here, which is actually meant to use two variables (creating row and column separation). By putting the <code>.</code> before the <code>~</code> we're telling it to only facet using columns. There's also a <code>facet_wrap</code> function that only does one variable but adds the ability to specify the number of rows you want to use, which might be helpful if you have a lot of classes.
</p>

<p>
<img src="posts/a-look-at-ggplot/displacement_vs_mileage_faceted_classes.png" alt="nil"></p>

<p>
I wouldn't have thought it, but the Corvette falls between the minivan and the sub-compact for fuel efficiency. I guess when you consider that it can only be used to transport two people and not anything relatively large it's still inefficient, just not as much if you're only using it to commute.
</p>
</div>
</div>

<div id="outline-container-org2a80542" class="outline-3">
<h3 id="org2a80542">Smoothing the Line</h3>
<div class="outline-text-3" id="text-org2a80542">
<p>
Instead of plotting a scatterpoint, you can use <code>geom_smooth</code> to fit a single line representing the trend for the data (using a linear model).
</p>

<div class="highlight"><pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displacement</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">gallons_per_mile</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_smooth</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">facet_grid</span><span class="p">(</span><span class="n">class_order</span> <span class="o">~</span> <span class="n">drive_train</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">DISPLACEMENT_VS_EFFICIENCY</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Displacement vs Efficiency By Type"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"displacement_vs_mileage_smooth.png"</span><span class="p">)</span>
</pre></div>

<p>
<img src="posts/a-look-at-ggplot/displacement_vs_mileage_smooth.png" alt="nil"></p>

<p>
One interesting thing here is that the four-wheel-drive compact and sub-compact cars did better than some of the front-wheel drive cars in the same class.
</p>

<p>
If you look at the front-wheel-drive sub-compact cars you'll see that the curve-fitting can get a little funky if you're not careful.
</p>

<p>
Note the syntax for the plot. Before we were passing the <code>aes</code> mapping to the geometry object. You can do that here too, but if you pass it to the <code>ggplot</code> call then it will automatically apply it to all the geometries. If you wanted to then change one of them you could pass in the <code>aes</code> mapping to it and override the base mapping you gave to <code>ggplot</code>.
</p>
</div>
</div>

<div id="outline-container-orgc4b6d75" class="outline-3">
<h3 id="orgc4b6d75">Different Datasets to the Geometries</h3>
<div class="outline-text-3" id="text-orgc4b6d75">
<p>
Besides passing in different <code>aes</code> mappings, you can also pass in different sub-sets of the data to each geometry (using <a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr's filter</a> to isolate the SUVs here).
</p>

<div class="highlight"><pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displacement</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">gallons_per_mile</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_smooth</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nf">filter</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">class</span><span class="o">==</span><span class="s">"suv"</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">class</span><span class="p">),</span> <span class="n">position</span><span class="o">=</span><span class="s">"jitter"</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">DISPLACEMENT_VS_EFFICIENCY</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Displacement vs Fuel Efficiency"</span><span class="p">)</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s">"displacement_vs_mileage_subsets.png"</span>
<span class="nf">ggsave</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>

<p>
<img src="posts/a-look-at-ggplot/displacement_vs_mileage_subsets.png" alt="nil"></p>

<p>
Looking at the trend-line for <b>SUVs</b> you can see that it encompasses a surprising swath of the displacements, and it is mostly upwardly linear to begin with but then flattens out.
</p>

<div class="highlight"><pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">mpg</span><span class="p">,</span>
  <span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">displacement</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">gallons_per_mile</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">drive_train</span><span class="p">)</span>
<span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">geom_smooth</span><span class="p">(</span><span class="n">se</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">DISPLACEMENT_VS_EFFICIENCY</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Effect of Drive (Four, Front, or Rear) on Mileage"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"displacement_exercise_2.png"</span><span class="p">)</span>
</pre></div>

<p>
<img src="posts/a-look-at-ggplot/displacement_exercise_2.png" alt="nil"></p>

<p>
It kind of looks like an emerging pattern that up to a point gasoline consumption goes up with engine size but then once a certain point is passed consumption flattens out, even as the engines get bigger.
</p>
</div>
</div>

<div id="outline-container-orgb71e124" class="outline-3">
<h3 id="orgb71e124">Small Four-Wheel Drive Automobiles</h3>
<div class="outline-text-3" id="text-orgb71e124">
<p>
Just out of curiosity, I'd like to see what those small four-wheel drive cars are.
</p>

<div class="highlight"><pre><span></span><span class="n">small</span> <span class="o">&lt;-</span> <span class="nf">filter</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">displacement</span><span class="o">&lt;</span><span class="m">3</span> <span class="o">&amp;</span> <span class="n">drive_train</span><span class="o">==</span><span class="s">"Four-Wheel"</span><span class="p">)</span>
<span class="n">plot</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span>
  <span class="n">data</span><span class="o">=</span><span class="n">small</span><span class="p">,</span>
  <span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">displacement</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">gallons_per_mile</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>
<span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">facet_grid</span><span class="p">(</span><span class="n">class_order</span> <span class="o">~</span> <span class="n">manufacturer</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">DISPLACEMENT_VS_EFFICIENCY</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"4WD Less Than 3 Liters"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"small_4wd.png"</span><span class="p">)</span>
</pre></div>

<p>
<img src="posts/a-look-at-ggplot/small_4wd.png" alt="nil"></p>

<p>
There are only three companies making these small four-wheel-drive automobiles, with Audi being the one focused on sedans.
</p>
</div>
</div>
</div>

<div id="outline-container-org47a6f2a" class="outline-2">
<h2 id="org47a6f2a">Bar Plots</h2>
<div class="outline-text-2" id="text-org47a6f2a">
</div>
<div id="outline-container-org10ab9b4" class="outline-3">
<h3 id="org10ab9b4">By Count</h3>
<div class="outline-text-3" id="text-org10ab9b4">
<p>
The Bar Plot is an example of what the Grammar of Graphics calls a Statistical Transformation (I guess the scatter plots are so called "Identity" transformations, but, whatever). It doesn't display the values in the data (unless you tell it to) but instead shows how often categorical values appear in the data. We can also have it set the color to create a stacked bar plot.
</p>

<div class="highlight"><pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_bar</span><span class="p">(</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class_order</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">drive_train</span><span class="p">)</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Count of Cars by Class"</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s">"Class Ordered by Median MPG"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">"Count"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"class_count.png"</span><span class="p">)</span>
</pre></div>

<p>
<img src="posts/a-look-at-ggplot/class_count.png" alt="nil"></p>

<p>
So most models of car are SUVs, how disheartening. This is only a sub-set of cars, though, and it doesn't reflect sales, just model counts.
</p>
</div>
</div>

<div id="outline-container-org4405a5e" class="outline-3">
<h3 id="org4405a5e">By Proportion</h3>
<div class="outline-text-3" id="text-org4405a5e">
<p>
Instead of using counts we can use proportions to show how the sub-category portions compare across categories.
</p>

<div class="highlight"><pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_bar</span><span class="p">(</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class_order</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">drive_train</span><span class="p">),</span>
    <span class="n">position</span><span class="o">=</span><span class="s">"fill"</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Proportion of Drives by Class"</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s">"Class Ordered by Median MPG"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">"Proportion"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"class_count_filled.png"</span><span class="p">)</span>
</pre></div>

<p>
<img src="posts/a-look-at-ggplot/class_count_filled.png" alt="nil"></p>

<p>
This shows what proportion if each class of car has what type of drive.
</p>
</div>
</div>

<div id="outline-container-org4249897" class="outline-3">
<h3 id="org4249897">Un-Stacked</h3>
<div class="outline-text-3" id="text-org4249897">
<p>
To make it easier to see how sub-categories compare within the class, we can change the positioning so that the bars are put side-by-side.
</p>

<div class="highlight"><pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_bar</span><span class="p">(</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class_order</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">drive_train</span><span class="p">),</span>
    <span class="n">position</span><span class="o">=</span><span class="s">"dodge"</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Count of Model Drives by Class"</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s">"Class Ordered by Median MPG"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">"Count"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"class_count_dodged.png"</span><span class="p">)</span>
</pre></div>

<p>
<img src="posts/a-look-at-ggplot/class_count_dodged.png" alt="nil"></p>
</div>
</div>

<div id="outline-container-orga9a8116" class="outline-3">
<h3 id="orga9a8116">Proportions Not Counts</h3>
<div class="outline-text-3" id="text-orga9a8116">
<p>
Our original bar graph showed the counts, but we can show the same plot using the proportion that each categories' count is of the total count as the y-axis.
</p>

<div class="highlight"><pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">class</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_bar</span><span class="p">(</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class_order</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">..prop..</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="m">1</span><span class="p">)</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Proportion of Cars by Class"</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s">"Class Ordered by Median MPG"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">"Proportion"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"class_proportion.png"</span><span class="p">)</span>
</pre></div>

<p>
<img src="posts/a-look-at-ggplot/class_proportion.png" alt="nil"></p>

<p>
Two things:
</p>
<ul class="org-ul">
<li>That funky <code>..prop..</code> is really how R specifies that argument</li>
<li>The <code>group=1</code> argument tells ggplot that there's only one group for the whole dataset, otherwise each category is taken as a separate group and they are all end up as 100% of their group.</li>
<li>I couldn't get ggplot to set the colors based on the class</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org90980d3" class="outline-2">
<h2 id="org90980d3">Stat Summary</h2>
<div class="outline-text-2" id="text-org90980d3">
<p>
This is a way to plot different kinds of summary statistics for the dataset.
</p>

<div class="highlight"><pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">stat_summary</span><span class="p">(</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class_order</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">gallons_per_mile</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">class_order</span><span class="p">),</span>
    <span class="n">fun.min</span> <span class="o">=</span> <span class="n">min</span><span class="p">,</span>
    <span class="n">fun.max</span> <span class="o">=</span> <span class="n">max</span><span class="p">,</span>
    <span class="n">fun</span> <span class="o">=</span> <span class="n">median</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Spread of Efficiency by Class"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">EFFICIENCY</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s">"Class"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"mpg_class_spread.png"</span><span class="p">)</span>
</pre></div>

<p>
<img src="posts/a-look-at-ggplot/mpg_class_spread.png" alt="nil"></p>
</div>

<div id="outline-container-org5ae7b26" class="outline-3">
<h3 id="org5ae7b26">Boxplot</h3>
<div class="outline-text-3" id="text-org5ae7b26">
<p>
That was a nice clean way to show it, and it's flexible, but maybe a good old-fashioned box-plot is the best, in the end.
</p>

<div class="highlight"><pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_boxplot</span><span class="p">(</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">class_order</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">gallons_per_mile</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">class_order</span><span class="p">),</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Spread of Efficiency by Class"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">EFFICIENCY</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s">"Class"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"mpg_class_boxplot.png"</span><span class="p">)</span>
</pre></div>

<p>
<img src="posts/a-look-at-ggplot/mpg_class_boxplot.png" alt="nil"></p>
</div>
</div>
</div>

<div id="outline-container-orgfcc96a5" class="outline-2">
<h2 id="orgfcc96a5">The End</h2>
<div class="outline-text-2" id="text-orgfcc96a5">
<p>
Well, that's more than enough of that. The Chapter in <a href="posts/r-for-data-science/">R For Data Science</a> has other stuff in there, in particular there's a section on changing the coordinate system, but I think it's time to move on.
</p>
</div>
</div>
<div id="outline-container-orga56c38a" class="outline-2">
<h2 id="orga56c38a">Link Collection</h2>
<div class="outline-text-2" id="text-orga56c38a">
<ul class="org-ul">
<li>
<a href="https://fueleconomy.gov/">fueleconomy.gov</a>: the federal government's site on fuel efficiency for cars sold in the United States</li>
<li>
<a href="https://ggplot2.tidyverse.org/">ggplot2</a> main page</li>
<li>
<a href="https://www.realclearscience.com/blog/2019/02/14/the_miles_per_gallon_illusion.html#!">RealClear Science</a> on the MPG Illusion</li>
<li>
<a href="https://cfss.uchicago.edu/notes/grammar-of-graphics/">The Grammar of Graphics:</a> This is a page on the University of Chicago's <a href="https://cfss.uchicago.edu/">Computing For Social Sciences</a> site that has an explanation of what makes up the Layered Grammar of Graphics that <code>ggplot2</code> is based on.</li>
</ul>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/nypd-shooting-incident-data/" class="u-url">NYPD Shooting Incident Data</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/nypd-shooting-incident-data/" rel="bookmark">
            <time class="published dt-published" datetime="2021-12-11T14:34:41-08:00" itemprop="datePublished" title="2021-12-11 14:34">2021-12-11 14:34</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li>
<a href="posts/nypd-shooting-incident-data/#org665b011">NYPD Shooting Incident Data</a>
<ul>
<li><a href="posts/nypd-shooting-incident-data/#org2289298">Loading the Data</a></li>
<li>
<a href="posts/nypd-shooting-incident-data/#orgae42e9e">Tidying and Transforming the Data</a>
<ul>
<li><a href="posts/nypd-shooting-incident-data/#orgde4c6a4">Incident Key</a></li>
<li><a href="posts/nypd-shooting-incident-data/#org7ede434">Occur Date</a></li>
<li><a href="posts/nypd-shooting-incident-data/#org97ed362">Occur Time</a></li>
<li><a href="posts/nypd-shooting-incident-data/#org78739af">Boro</a></li>
<li><a href="posts/nypd-shooting-incident-data/#org8117a07">Precinct</a></li>
<li><a href="posts/nypd-shooting-incident-data/#org1611c4a">Jurisdiction Code</a></li>
<li><a href="posts/nypd-shooting-incident-data/#orgdf9f578">Location Description</a></li>
<li><a href="posts/nypd-shooting-incident-data/#orgd85553a">Statistical Murder Flag</a></li>
<li><a href="posts/nypd-shooting-incident-data/#orgee0efb0">Perpetrator's Age Group</a></li>
<li><a href="posts/nypd-shooting-incident-data/#org053a714">Peprpetrator's Sex</a></li>
<li><a href="posts/nypd-shooting-incident-data/#org9d3352d">Perpetrator's Race</a></li>
<li><a href="posts/nypd-shooting-incident-data/#org66d4ffb">Victim's Age Group</a></li>
<li><a href="posts/nypd-shooting-incident-data/#org7b547f5">Victim's Sex</a></li>
<li><a href="posts/nypd-shooting-incident-data/#orgf6b2383">Victim's Race</a></li>
<li><a href="posts/nypd-shooting-incident-data/#org89e141e">X-Coordinate</a></li>
<li><a href="posts/nypd-shooting-incident-data/#org742350b">Y-Coordinate</a></li>
<li><a href="posts/nypd-shooting-incident-data/#org9a616c6">Latitude</a></li>
<li><a href="posts/nypd-shooting-incident-data/#orga6f5411">Longitude</a></li>
<li><a href="posts/nypd-shooting-incident-data/#org0980e01">Longitude and Latitude</a></li>
</ul>
</li>
<li>
<a href="posts/nypd-shooting-incident-data/#orgbd40c78">Visualization</a>
<ul>
<li><a href="posts/nypd-shooting-incident-data/#org17a0b7b">Annually</a></li>
<li><a href="posts/nypd-shooting-incident-data/#orgc344ae9">Monthly</a></li>
<li><a href="posts/nypd-shooting-incident-data/#org1aced50">By Map</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org665b011" class="outline-2">
<h2 id="org665b011">NYPD Shooting Incident Data</h2>
<div class="outline-text-2" id="text-org665b011">
<p>
This is a project that looks at the <a href="https://catalog.data.gov/dataset/nypd-shooting-incident-data-historic">NYPD Shooting Incident Data (Historic)</a> from the <a href="https://catalog.data.gov/dataset">DATA.gov</a> catalog of datasets. This dataset lists every shooting incident in New York City from 2006 through the end of the previous calendar year. It is compiled by <a href="https://opendata.cityofnewyork.us/">NYC Open Data</a> and was last updated on December 11, 2021.
</p>

<p>
Each row in the data is a "shooting incident" and there are 19 columns. 
</p>
</div>

<div id="outline-container-org2289298" class="outline-3">
<h3 id="org2289298">Loading the Data</h3>
<div class="outline-text-3" id="text-org2289298">
<div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">assertthat</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">knitr</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">lubridate</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
</pre></div>

<p>
Lubridate is part of the tidyverse but it has to be loaded for some reason. 
</p>

<div class="highlight"><pre><span></span><span class="n">DATA_URL</span> <span class="o">&lt;-</span> <span class="s">"https://data.cityofnewyork.us/api/views/833y-fsy8/rows.csv?accessType=DOWNLOAD"</span> 

<span class="n">data</span> <span class="o">=</span> <span class="nf">read_csv</span><span class="p">(</span><span class="n">DATA_URL</span><span class="p">)</span>
</pre></div>

<pre class="example">

[1mindexed[0m [32m0B[0m in [36m 0s[0m, [32m0B/s[0m
[1mindexed[0m [32m393.21kB[0m in [36m 0s[0m, [32m983.15kB/s[0m
                                                                              
[1mindexed[0m [32m524.28kB[0m in [36m 1s[0m, [32m1.03MB/s[0m
[1mindexed[0m [32m655.36kB[0m in [36m 1s[0m, [32m1.22MB/s[0m
[1mindexed[0m [32m786.43kB[0m in [36m 1s[0m, [32m1.24MB/s[0m
[1mindexed[0m [32m917.50kB[0m in [36m 1s[0m, [32m1.23MB/s[0m
                                                                              
[1mindexed[0m [32m1.05MB[0m in [36m 1s[0m, [32m1.18MB/s[0m
[1mindexed[0m [32m1.18MB[0m in [36m 1s[0m, [32m1.18MB/s[0m
[1mindexed[0m [32m1.31MB[0m in [36m 1s[0m, [32m1.06MB/s[0m
[1mindexed[0m [32m1.44MB[0m in [36m 2s[0m, [32m947.54kB/s[0m
                                                                              
[1mindexed[0m [32m1.57MB[0m in [36m 2s[0m, [32m1.00MB/s[0m
[1mindexed[0m [32m1.70MB[0m in [36m 2s[0m, [32m1.04MB/s[0m
[1mindexed[0m [32m1.83MB[0m in [36m 2s[0m, [32m1.04MB/s[0m
[1mindexed[0m [32m1.97MB[0m in [36m 2s[0m, [32m1.02MB/s[0m
[1mindexed[0m [32m2.10MB[0m in [36m 2s[0m, [32m1.03MB/s[0m
[1mindexed[0m [32m2.23MB[0m in [36m 2s[0m, [32m994.69kB/s[0m
[1mindexed[0m [32m2.36MB[0m in [36m 2s[0m, [32m965.18kB/s[0m
[1mindexed[0m [32m2.49MB[0m in [36m 3s[0m, [32m939.81kB/s[0m
[1mindexed[0m [32m2.62MB[0m in [36m 3s[0m, [32m951.26kB/s[0m
[1mindexed[0m [32m2.75MB[0m in [36m 3s[0m, [32m919.65kB/s[0m
[1mindexed[0m [32m2.88MB[0m in [36m 3s[0m, [32m855.66kB/s[0m
[1mindexed[0m [32m3.01MB[0m in [36m 3s[0m, [32m892.99kB/s[0m
[1mindexed[0m [32m3.15MB[0m in [36m 3s[0m, [32m904.11kB/s[0m
[1mindexed[0m [32m3.28MB[0m in [36m 4s[0m, [32m867.67kB/s[0m
[1mindexed[0m [32m3.41MB[0m in [36m 4s[0m, [32m878.71kB/s[0m
[1mindexed[0m [32m3.54MB[0m in [36m 4s[0m, [32m888.47kB/s[0m
[1mindexed[0m [32m3.67MB[0m in [36m 4s[0m, [32m899.43kB/s[0m
[1mindexed[0m [32m3.80MB[0m in [36m 4s[0m, [32m846.12kB/s[0m
[1mindexed[0m [32m3.93MB[0m in [36m 5s[0m, [32m861.49kB/s[0m
[1mindexed[0m [32m4.06MB[0m in [36m 5s[0m, [32m876.08kB/s[0m
[1mindexed[0m [32m4.19MB[0m in [36m 5s[0m, [32m854.40kB/s[0m
[1mindexed[0m [32m4.33MB[0m in [36m 5s[0m, [32m877.77kB/s[0m
[1mindexed[0m [32m4.46MB[0m in [36m 5s[0m, [32m855.56kB/s[0m
[1mindexed[0m [32m4.59MB[0m in [36m 5s[0m, [32m865.02kB/s[0m
[1mindexed[0m [32m4.72MB[0m in [36m 6s[0m, [32m855.32kB/s[0m
[1mindexed[0m [32m4.85MB[0m in [36m 6s[0m, [32m847.74kB/s[0m
[1mindexed[0m [32m4.98MB[0m in [36m 6s[0m, [32m870.08kB/s[0m
[1mindexed[0m [32m5.11MB[0m in [36m 6s[0m, [32m892.61kB/s[0m
[1mindexed[0m [32m5.11MB[0m in [36m 6s[0m, [32m892.93kB/s[0m
[1mindexed[0m [32m1.00TB[0m in [36m 6s[0m, [32m174.56GB/s[0m
                                                                              
[1mRows: [22m[34m23585[39m [1mColumns: [22m[34m19[39m
[36m──[39m [1mColumn specification[22m [36m──────────────────────────────────────────────────────────────────────────────[39m
[1mDelimiter:[22m ","
[31mchr[39m  (10): OCCUR_DATE, BORO, LOCATION_DESC, PERP_AGE_GROUP, PERP_SEX, PERP_R...
[32mdbl[39m   (7): INCIDENT_KEY, PRECINCT, JURISDICTION_CODE, X_COORD_CD, Y_COORD_CD...
[33mlgl[39m   (1): STATISTICAL_MURDER_FLAG
[34mtime[39m  (1): OCCUR_TIME

[36mℹ[39m Use [30m[47m[30m[47m`spec()`[47m[30m[49m[39m to retrieve the full column specification for this data.
[36mℹ[39m Specify the column types or set [30m[47m[30m[47m`show_col_types = FALSE`[47m[30m[49m[39m to quiet this message.
</pre>
</div>
</div>

<div id="outline-container-orgae42e9e" class="outline-3">
<h3 id="orgae42e9e">Tidying and Transforming the Data</h3>
<div class="outline-text-3" id="text-orgae42e9e">
<div class="highlight"><pre><span></span><span class="nf">spec</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>

<pre class="example">
cols(
  INCIDENT_KEY = [32mcol_double()[39m,
  OCCUR_DATE = [31mcol_character()[39m,
  OCCUR_TIME = [34mcol_time(format = "")[39m,
  BORO = [31mcol_character()[39m,
  PRECINCT = [32mcol_double()[39m,
  JURISDICTION_CODE = [32mcol_double()[39m,
  LOCATION_DESC = [31mcol_character()[39m,
  STATISTICAL_MURDER_FLAG = [33mcol_logical()[39m,
  PERP_AGE_GROUP = [31mcol_character()[39m,
  PERP_SEX = [31mcol_character()[39m,
  PERP_RACE = [31mcol_character()[39m,
  VIC_AGE_GROUP = [31mcol_character()[39m,
  VIC_SEX = [31mcol_character()[39m,
  VIC_RACE = [31mcol_character()[39m,
  X_COORD_CD = [32mcol_double()[39m,
  Y_COORD_CD = [32mcol_double()[39m,
  Latitude = [32mcol_double()[39m,
  Longitude = [32mcol_double()[39m,
  Lon_Lat = [31mcol_character()[39m
)
</pre>
</div>

<div id="outline-container-orgde4c6a4" class="outline-4">
<h4 id="orgde4c6a4">Incident Key</h4>
<div class="outline-text-4" id="text-orgde4c6a4">
<p>
According to the <a href="https://data.cityofnewyork.us/Public-Safety/NYPD-Shooting-Incident-Data-Historic-/833y-fsy8">Data Description</a> the "Incident Key" is a randomly generated identifier for the incident. This is a likely candidate to remove unless we look at specific incidents.
</p>
</div>
</div>
<div id="outline-container-org7ede434" class="outline-4">
<h4 id="org7ede434">Occur Date</h4>
<div class="outline-text-4" id="text-org7ede434">
<p>
This is the date that the shooting happened. It was loaded as a string so we should convert it to a date.
</p>
<div class="highlight"><pre><span></span><span class="n">data</span><span class="o">$</span><span class="n">OCCUR_DATE</span><span class="p">[</span><span class="m">1</span><span class="p">]</span>
</pre></div>

<pre class="example">
[1] "08/27/2006"
</pre>


<div class="highlight"><pre><span></span><span class="n">data</span><span class="o">$</span><span class="n">DATE</span> <span class="o">&lt;-</span> <span class="nf">as.Date</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">OCCUR_DATE</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">"%m/%d/%Y"</span><span class="p">)</span>
<span class="nf">str</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">DATE</span><span class="p">)</span>
<span class="n">data</span><span class="o">$</span><span class="n">DATE</span><span class="p">[</span><span class="m">1</span><span class="p">]</span>
<span class="nf">assert_that</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">DATE</span><span class="p">))</span>
</pre></div>

<pre class="example">
 Date[1:23585], format: "2006-08-27" "2011-03-11" "2019-10-06" "2011-09-04" "2013-05-27" ...
[1] "2006-08-27"
[1] TRUE
</pre>
</div>
</div>
<div id="outline-container-org97ed362" class="outline-4">
<h4 id="org97ed362">Occur Time</h4>
<div class="outline-text-4" id="text-org97ed362">
<p>
This is the time of the shooting. It appears to have already been read in as a time.
</p>
<div class="highlight"><pre><span></span><span class="nf">str</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">OCCUR_TIME</span><span class="p">)</span>
<span class="nf">assert_that</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">OCCUR_TIME</span><span class="p">))</span>
</pre></div>

<pre class="example">
 'hms' num [1:23585] 05:35:00 12:03:00 01:09:00 03:35:00 ...
 - attr(*, "units")= chr "secs"
[1] TRUE
</pre>
</div>
</div>
<div id="outline-container-org78739af" class="outline-4">
<h4 id="org78739af">Boro</h4>
<div class="outline-text-4" id="text-org78739af">
<p>
This is the NYC Borough where the shooting happened.
</p>

<div class="highlight"><pre><span></span><span class="n">data</span><span class="o">$</span><span class="n">Borough</span> <span class="o">&lt;-</span> <span class="nf">as.factor</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">BORO</span><span class="p">)</span>
<span class="nf">assert_that</span><span class="p">(</span><span class="nf">is.factor</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Borough</span><span class="p">))</span>
<span class="nf">assert_that</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Borough</span><span class="p">))</span>
</pre></div>

<pre class="example">
[1] TRUE
[1] TRUE
</pre>


<p>
<a href="https://bookdown.org/yihui/rmarkdown-cookbook/kable.html">knitr.kable</a> reformats the dataframe to a more readable table. Kind of like tabulate but less flexible.
</p>

<div class="highlight"><pre><span></span><span class="n">big_mark</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">columns</span><span class="p">){</span>
    <span class="nf">kable</span><span class="p">(</span><span class="nf">table</span><span class="p">(</span><span class="n">vector</span><span class="p">),</span> <span class="n">col.names</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span> <span class="n">format.args</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">big.mark</span><span class="o">=</span><span class="s">","</span><span class="p">))</span>
<span class="p">}</span>
<span class="nf">big_mark</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Borough</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">"Borough"</span><span class="p">,</span> <span class="s">"Shootings"</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Borough</th>
<th scope="col" class="org-left">Shootings</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">BRONX</td>
<td class="org-left">6,701</td>
</tr>
<tr>
<td class="org-left">BROOKLYN</td>
<td class="org-left">9,734</td>
</tr>
<tr>
<td class="org-left">MANHATTAN</td>
<td class="org-left">2,922</td>
</tr>
<tr>
<td class="org-left">QUEENS</td>
<td class="org-left">3,532</td>
</tr>
<tr>
<td class="org-left">STATEN ISLAND</td>
<td class="org-left">696</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org8117a07" class="outline-4">
<h4 id="org8117a07">Precinct</h4>
<div class="outline-text-4" id="text-org8117a07">
<p>
This is the precinct number where the shooting happened.
</p>
<div class="highlight"><pre><span></span><span class="nf">n_distinct</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">PRECINCT</span><span class="p">)</span>
<span class="nf">str</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">PRECINCT</span><span class="p">)</span>
<span class="n">data</span><span class="o">$</span><span class="n">PRECINCT_FACTOR</span> <span class="o">&lt;-</span> <span class="nf">as.factor</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">PRECINCT</span><span class="p">)</span>
<span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">PRECINCT</span><span class="p">))</span>
</pre></div>

<pre class="example">
[1] 77
 num [1:23585] 52 106 77 40 100 67 77 81 101 106 ...
[1] TRUE
</pre>
</div>
</div>

<div id="outline-container-org1611c4a" class="outline-4">
<h4 id="org1611c4a">Jurisdiction Code</h4>
<div class="outline-text-4" id="text-org1611c4a">
<p>
The jurisdiction where the shooting occurred. There are three jurisdictions that are NYC jurisdictions:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">Code</th>
<th scope="col" class="org-left">Jurisdiction</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-left">Patrol</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-left">Transit</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-left">Housing</td>
</tr>
</tbody>
</table>
<p>
Any numbers higher than this are non-NYC jurisdictions.
</p>

<div class="highlight"><pre><span></span><span class="n">data</span><span class="o">$</span><span class="n">JURISDICTION</span> <span class="o">&lt;-</span> <span class="nf">as.factor</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">JURISDICTION_CODE</span><span class="p">)</span>
<span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">JURISDICTION</span><span class="p">))</span>
</pre></div>

<pre class="example">
[1] FALSE
attr(,"msg")
[1] "data$JURISDICTION contains 2 missing values"
</pre>


<div class="highlight"><pre><span></span><span class="nf">big_mark</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">JURISDICTION</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">"Jurisdiction"</span><span class="p">,</span> <span class="s">"Shootings"</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">Jurisdiction</th>
<th scope="col" class="org-left">Shootings</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-left">19,629</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-left">54</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-left">3,900</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgdf9f578" class="outline-4">
<h4 id="orgdf9f578">Location Description</h4>
<div class="outline-text-4" id="text-orgdf9f578">
<div class="highlight"><pre><span></span><span class="n">data</span><span class="o">$</span><span class="n">LOCATION_DESC</span><span class="p">[</span><span class="m">1</span><span class="p">]</span>
<span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">LOCATION_DESC</span><span class="p">))</span>
</pre></div>

<pre class="example">
[1] NA
[1] FALSE
attr(,"msg")
[1] "data$LOCATION_DESC contains 13581 missing values"
</pre>


<div class="highlight"><pre><span></span><span class="nf">n_distinct</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">LOCATION_DESC</span><span class="p">)</span>
</pre></div>

<pre class="example">
[1] 40
</pre>


<p>
Here's what the first filled-in entry looks like.
</p>

<div class="highlight"><pre><span></span><span class="nf">first</span><span class="p">(</span><span class="nf">na.omit</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">LOCATION_DESC</span><span class="p">))</span>
</pre></div>

<pre class="example">
[1] "MULTI DWELL - PUBLIC HOUS"
</pre>


<p>
Too bad there's so many missing values.
</p>

<div class="highlight"><pre><span></span><span class="nf">big_mark</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">LOCATION_DESC</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">"Location"</span><span class="p">,</span> <span class="s">"Shootings"</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Location</th>
<th scope="col" class="org-right">Shootings</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">ATM</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">BANK</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">BAR/NIGHT CLUB</td>
<td class="org-right">562</td>
</tr>
<tr>
<td class="org-left">BEAUTY/NAIL SALON</td>
<td class="org-right">100</td>
</tr>
<tr>
<td class="org-left">CANDY STORE</td>
<td class="org-right">6</td>
</tr>
<tr>
<td class="org-left">CHAIN STORE</td>
<td class="org-right">5</td>
</tr>
<tr>
<td class="org-left">CHECK CASH</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">CLOTHING BOUTIQUE</td>
<td class="org-right">14</td>
</tr>
<tr>
<td class="org-left">COMMERCIAL BLDG</td>
<td class="org-right">234</td>
</tr>
<tr>
<td class="org-left">DEPT STORE</td>
<td class="org-right">5</td>
</tr>
<tr>
<td class="org-left">DOCTOR/DENTIST</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">DRUG STORE</td>
<td class="org-right">11</td>
</tr>
<tr>
<td class="org-left">DRY CLEANER/LAUNDRY</td>
<td class="org-right">30</td>
</tr>
<tr>
<td class="org-left">FACTORY/WAREHOUSE</td>
<td class="org-right">6</td>
</tr>
<tr>
<td class="org-left">FAST FOOD</td>
<td class="org-right">98</td>
</tr>
<tr>
<td class="org-left">GAS STATION</td>
<td class="org-right">53</td>
</tr>
<tr>
<td class="org-left">GROCERY/BODEGA</td>
<td class="org-right">574</td>
</tr>
<tr>
<td class="org-left">GYM/FITNESS FACILITY</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-left">HOSPITAL</td>
<td class="org-right">38</td>
</tr>
<tr>
<td class="org-left">HOTEL/MOTEL</td>
<td class="org-right">24</td>
</tr>
<tr>
<td class="org-left">JEWELRY STORE</td>
<td class="org-right">12</td>
</tr>
<tr>
<td class="org-left">LIQUOR STORE</td>
<td class="org-right">36</td>
</tr>
<tr>
<td class="org-left">LOAN COMPANY</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">MULTI DWELL - APT BUILD</td>
<td class="org-right">2,553</td>
</tr>
<tr>
<td class="org-left">MULTI DWELL - PUBLIC HOUS</td>
<td class="org-right">4,240</td>
</tr>
<tr>
<td class="org-left">NONE</td>
<td class="org-right">175</td>
</tr>
<tr>
<td class="org-left">PHOTO/COPY STORE</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">PVT HOUSE</td>
<td class="org-right">857</td>
</tr>
<tr>
<td class="org-left">RESTAURANT/DINER</td>
<td class="org-right">188</td>
</tr>
<tr>
<td class="org-left">SCHOOL</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">SHOE STORE</td>
<td class="org-right">9</td>
</tr>
<tr>
<td class="org-left">SMALL MERCHANT</td>
<td class="org-right">25</td>
</tr>
<tr>
<td class="org-left">SOCIAL CLUB/POLICY LOCATI</td>
<td class="org-right">66</td>
</tr>
<tr>
<td class="org-left">STORAGE FACILITY</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-left">STORE UNCLASSIFIED</td>
<td class="org-right">35</td>
</tr>
<tr>
<td class="org-left">SUPERMARKET</td>
<td class="org-right">19</td>
</tr>
<tr>
<td class="org-left">TELECOMM. STORE</td>
<td class="org-right">5</td>
</tr>
<tr>
<td class="org-left">VARIETY STORE</td>
<td class="org-right">11</td>
</tr>
<tr>
<td class="org-left">VIDEO STORE</td>
<td class="org-right">2</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgd85553a" class="outline-4">
<h4 id="orgd85553a">Statistical Murder Flag</h4>
<div class="outline-text-4" id="text-orgd85553a">
<p>
This is a checkbox indicating that the victim died as a result of the shooting.
</p>

<div class="highlight"><pre><span></span><span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">STATISTICAL_MURDER_FLAG</span><span class="p">))</span>
</pre></div>

<pre class="example">
[1] TRUE
</pre>


<div class="highlight"><pre><span></span><span class="nf">big_mark</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">STATISTICAL_MURDER_FLAG</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">"Victim Died"</span><span class="p">,</span> <span class="s">"Count"</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Victim Died</th>
<th scope="col" class="org-left">Count</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">FALSE</td>
<td class="org-left">19,085</td>
</tr>
<tr>
<td class="org-left">TRUE</td>
<td class="org-left">4,500</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgee0efb0" class="outline-4">
<h4 id="orgee0efb0">Perpetrator's Age Group</h4>
<div class="outline-text-4" id="text-orgee0efb0">
<div class="highlight"><pre><span></span><span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">PERP_AGE_GROUP</span><span class="p">))</span>
<span class="n">data</span><span class="o">$</span><span class="n">PERP_AGE</span> <span class="o">&lt;-</span> <span class="nf">as.factor</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">PERP_AGE_GROUP</span><span class="p">)</span>
</pre></div>

<pre class="example">
[1] FALSE
attr(,"msg")
[1] "data$PERP_AGE_GROUP contains 8295 missing values"
</pre>


<div class="highlight"><pre><span></span><span class="nf">big_mark</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">PERP_AGE</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">"Perpetrator's Age Group"</span><span class="p">,</span> <span class="s">"Shootings"</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">Perpetrator's Age Group</th>
<th scope="col" class="org-right">Shootings</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">&lt;18</td>
<td class="org-right">1,368</td>
</tr>
<tr>
<td class="org-right">1020</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">18-24</td>
<td class="org-right">5,508</td>
</tr>
<tr>
<td class="org-right">224</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">25-44</td>
<td class="org-right">4,714</td>
</tr>
<tr>
<td class="org-right">45-64</td>
<td class="org-right">495</td>
</tr>
<tr>
<td class="org-right">65+</td>
<td class="org-right">54</td>
</tr>
<tr>
<td class="org-right">940</td>
<td class="org-right">1</td>
</tr>
<tr>
<td class="org-right">UNKNOWN</td>
<td class="org-right">3,148</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org053a714" class="outline-4">
<h4 id="org053a714">Peprpetrator's Sex</h4>
<div class="outline-text-4" id="text-org053a714">
<p>
There are three values for "Sex" - Female (F), Male (M), or Unknown (U).
</p>
<div class="highlight"><pre><span></span><span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">PERP_SEX</span><span class="p">))</span>
<span class="n">data</span><span class="o">$</span><span class="n">PERP_SEX</span> <span class="o">&lt;-</span> <span class="nf">as.factor</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">PERP_SEX</span><span class="p">)</span>
</pre></div>

<pre class="example">
[1] FALSE
attr(,"msg")
[1] "data$PERP_SEX contains 8261 missing values"
</pre>


<div class="highlight"><pre><span></span><span class="nf">big_mark</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">PERP_SEX</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">"Perpetrator's Sex"</span><span class="p">,</span> <span class="s">"Shootings"</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Perpetartor's Sex</th>
<th scope="col" class="org-left">Shootings</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">F</td>
<td class="org-left">335</td>
</tr>
<tr>
<td class="org-left">M</td>
<td class="org-left">13,490</td>
</tr>
<tr>
<td class="org-left">U</td>
<td class="org-left">1,499</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org9d3352d" class="outline-4">
<h4 id="org9d3352d">Perpetrator's Race</h4>
<div class="outline-text-4" id="text-org9d3352d">
<div class="highlight"><pre><span></span><span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">PERP_RACE</span><span class="p">))</span>
<span class="n">data</span><span class="o">$</span><span class="n">PERP_RACE</span> <span class="o">&lt;-</span> <span class="nf">as.factor</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">PERP_RACE</span><span class="p">)</span>
</pre></div>

<pre class="example">
[1] FALSE
attr(,"msg")
[1] "data$PERP_RACE contains 8261 missing values"
</pre>


<div class="highlight"><pre><span></span><span class="nf">big_mark</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">PERP_RACE</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">"Perpetrator's Race"</span><span class="p">,</span> <span class="s">"Shootings"</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Perpetrator's Race</th>
<th scope="col" class="org-left">Shootings</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">AMERICAN INDIAN/ALASKAN NATIVE</td>
<td class="org-left">2</td>
</tr>
<tr>
<td class="org-left">ASIAN / PACIFIC ISLANDER</td>
<td class="org-left">122</td>
</tr>
<tr>
<td class="org-left">BLACK</td>
<td class="org-left">10,025</td>
</tr>
<tr>
<td class="org-left">BLACK HISPANIC</td>
<td class="org-left">1,096</td>
</tr>
<tr>
<td class="org-left">UNKNOWN</td>
<td class="org-left">1,836</td>
</tr>
<tr>
<td class="org-left">WHITE</td>
<td class="org-left">255</td>
</tr>
<tr>
<td class="org-left">WHITE HISPANIC</td>
<td class="org-left">1,988</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org66d4ffb" class="outline-4">
<h4 id="org66d4ffb">Victim's Age Group</h4>
<div class="outline-text-4" id="text-org66d4ffb">
<div class="highlight"><pre><span></span><span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">VIC_AGE_GROUP</span><span class="p">))</span>
<span class="n">data</span><span class="o">$</span><span class="n">VIC_AGE_GROUP</span> <span class="o">&lt;-</span> <span class="nf">as.factor</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">VIC_AGE_GROUP</span><span class="p">)</span>
</pre></div>

<pre class="example">
[1] TRUE
</pre>


<div class="highlight"><pre><span></span><span class="nf">big_mark</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">VIC_AGE_GROUP</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">"Victim's Age Group"</span><span class="p">,</span> <span class="s">"Shootings"</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">Victim's Age Group</th>
<th scope="col" class="org-left">Shootings</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">&lt;18</td>
<td class="org-left">2,525</td>
</tr>
<tr>
<td class="org-right">18-24</td>
<td class="org-left">9,003</td>
</tr>
<tr>
<td class="org-right">25-44</td>
<td class="org-left">10,303</td>
</tr>
<tr>
<td class="org-right">45-64</td>
<td class="org-left">1,541</td>
</tr>
<tr>
<td class="org-right">65+</td>
<td class="org-left">154</td>
</tr>
<tr>
<td class="org-right">UNKNOWN</td>
<td class="org-left">59</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org7b547f5" class="outline-4">
<h4 id="org7b547f5">Victim's Sex</h4>
<div class="outline-text-4" id="text-org7b547f5">
<div class="highlight"><pre><span></span><span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">VIC_SEX</span><span class="p">))</span>
<span class="n">data</span><span class="o">$</span><span class="n">VIC_SEX</span> <span class="o">&lt;-</span> <span class="nf">as.factor</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">VIC_SEX</span><span class="p">)</span>
</pre></div>

<pre class="example">
[1] TRUE
</pre>


<div class="highlight"><pre><span></span><span class="nf">big_mark</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">VIC_SEX</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">"Victims' Sex"</span><span class="p">,</span> <span class="s">"Shootings"</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Victims' Sex</th>
<th scope="col" class="org-left">Shootings</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">F</td>
<td class="org-left">2,204</td>
</tr>
<tr>
<td class="org-left">M</td>
<td class="org-left">21,370</td>
</tr>
<tr>
<td class="org-left">U</td>
<td class="org-left">11</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgf6b2383" class="outline-4">
<h4 id="orgf6b2383">Victim's Race</h4>
<div class="outline-text-4" id="text-orgf6b2383">
<div class="highlight"><pre><span></span><span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">VIC_RACE</span><span class="p">))</span>
<span class="n">data</span><span class="o">$</span><span class="n">VIC_RACE</span> <span class="o">&lt;-</span> <span class="nf">as.factor</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">VIC_RACE</span><span class="p">)</span>
</pre></div>

<pre class="example">
[1] TRUE
</pre>


<div class="highlight"><pre><span></span><span class="nf">big_mark</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">VIC_RACE</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="s">"Victim's Race"</span><span class="p">,</span> <span class="s">"Shootings"</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-right">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Victim's Race</th>
<th scope="col" class="org-right">Shootings</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left">AMERICAN INDIAN/ALASKAN NATIVE</td>
<td class="org-right">9</td>
</tr>
<tr>
<td class="org-left">ASIAN / PACIFIC ISLANDER</td>
<td class="org-right">327</td>
</tr>
<tr>
<td class="org-left">BLACK</td>
<td class="org-right">16,869</td>
</tr>
<tr>
<td class="org-left">BLACK HISPANIC</td>
<td class="org-right">2,245</td>
</tr>
<tr>
<td class="org-left">UNKNOWN</td>
<td class="org-right">65</td>
</tr>
<tr>
<td class="org-left">WHITE</td>
<td class="org-right">620</td>
</tr>
<tr>
<td class="org-left">WHITE HISPANIC</td>
<td class="org-right">3,450</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org89e141e" class="outline-4">
<h4 id="org89e141e">X-Coordinate</h4>
<div class="outline-text-4" id="text-org89e141e">
<p>
"Midblock X-coordinate for New York State Plane Coordinate System, Long Island Zone, NAD 83, units feet (FIPS 3104)."
</p>

<div class="highlight"><pre><span></span><span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">X_COORD_CD</span><span class="p">))</span>
<span class="nf">n_distinct</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">X_COORD_CD</span><span class="p">)</span>
</pre></div>

<pre class="example">
[1] TRUE
[1] 9911
</pre>
</div>
</div>

<div id="outline-container-org742350b" class="outline-4">
<h4 id="org742350b">Y-Coordinate</h4>
<div class="outline-text-4" id="text-org742350b">
<div class="highlight"><pre><span></span><span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Y_COORD_CD</span><span class="p">))</span>
<span class="nf">n_distinct</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Y_COORD_CD</span><span class="p">)</span>
</pre></div>

<pre class="example">
[1] TRUE
[1] 9986
</pre>
</div>
</div>

<div id="outline-container-org9a616c6" class="outline-4">
<h4 id="org9a616c6">Latitude</h4>
<div class="outline-text-4" id="text-org9a616c6">
<p>
Latitude coordinate for Global Coordinate System, WGS 1984, decimal degrees (EPSG 4326).
</p>
<div class="highlight"><pre><span></span><span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Latitude</span><span class="p">))</span>
<span class="nf">n_distinct</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Latitude</span><span class="p">)</span>
</pre></div>

<pre class="example">
[1] TRUE
[1] 10055
</pre>
</div>
</div>
<div id="outline-container-orga6f5411" class="outline-4">
<h4 id="orga6f5411">Longitude</h4>
<div class="outline-text-4" id="text-orga6f5411">
<p>
Latitude coordinate for Global Coordinate System, WGS 1984, decimal degrees (EPSG 4326).
</p>
<div class="highlight"><pre><span></span><span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Longitude</span><span class="p">))</span>
<span class="nf">n_distinct</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Longitude</span><span class="p">)</span>
<span class="nf">str</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Longitude</span><span class="p">)</span>
</pre></div>

<pre class="example">
[1] TRUE
[1] 10055
 num [1:23585] -73.9 -73.8 -74 -73.9 -73.8 ...
</pre>
</div>
</div>

<div id="outline-container-org0980e01" class="outline-4">
<h4 id="org0980e01">Longitude and Latitude</h4>
<div class="outline-text-4" id="text-org0980e01">
<p>
Longitude and Latitude Coordinates for mapping
</p>

<div class="highlight"><pre><span></span><span class="nf">see_if</span><span class="p">(</span><span class="nf">noNA</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Lon_Lat</span><span class="p">))</span>
<span class="nf">n_distinct</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Lon_Lat</span><span class="p">)</span>
<span class="nf">str</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Lon_Lat</span><span class="p">)</span>
</pre></div>

<pre class="example">
[1] TRUE
[1] 10055
 chr [1:23585] "POINT (-73.87963173099996 40.86905819000003)" ...
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbd40c78" class="outline-3">
<h3 id="orgbd40c78">Visualization</h3>
<div class="outline-text-3" id="text-orgbd40c78">
<p>
<a href="https://lubridate.tidyverse.org/reference/round_date.html"><code>floor_date</code></a> is a function from <a href="https://lubridate.tidyverse.org/index.html">lubridate</a> that comes as part of the <a href="https://www.tidyverse.org/">tidyverse</a>. It's called floor because it acts like the <code>floor</code> function in math (round down).
</p>
</div>
<div id="outline-container-org17a0b7b" class="outline-4">
<h4 id="org17a0b7b">Annually</h4>
<div class="outline-text-4" id="text-org17a0b7b">
<div class="highlight"><pre><span></span><span class="n">dates</span> <span class="o">&lt;-</span> <span class="n">data</span>
<span class="n">dates</span><span class="o">$</span><span class="n">Year</span> <span class="o">&lt;-</span> <span class="nf">floor_date</span><span class="p">(</span><span class="n">dates</span><span class="o">$</span><span class="n">DATE</span><span class="p">,</span> <span class="s">"year"</span><span class="p">)</span>

<span class="n">annual_shootings</span> <span class="o">&lt;-</span> <span class="n">dates</span> <span class="o">%&gt;%</span> <span class="nf">group_by</span><span class="p">(</span><span class="n">Year</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">summarise</span><span class="p">(</span><span class="n">Shootings</span><span class="o">=</span><span class="nf">n</span><span class="p">())</span>
<span class="nf">kable</span><span class="p">(</span><span class="n">annual_shootings</span><span class="p">,</span>
      <span class="n">format.args</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">big.mark</span><span class="o">=</span><span class="s">","</span><span class="p">))</span>
</pre></div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-right">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-right">Year</th>
<th scope="col" class="org-left">Shootings</th>
</tr></thead>
<tbody>
<tr>
<td class="org-right">2006-01-01</td>
<td class="org-left">2,055</td>
</tr>
<tr>
<td class="org-right">2007-01-01</td>
<td class="org-left">1,887</td>
</tr>
<tr>
<td class="org-right">2008-01-01</td>
<td class="org-left">1,959</td>
</tr>
<tr>
<td class="org-right">2009-01-01</td>
<td class="org-left">1,828</td>
</tr>
<tr>
<td class="org-right">2010-01-01</td>
<td class="org-left">1,912</td>
</tr>
<tr>
<td class="org-right">2011-01-01</td>
<td class="org-left">1,939</td>
</tr>
<tr>
<td class="org-right">2012-01-01</td>
<td class="org-left">1,717</td>
</tr>
<tr>
<td class="org-right">2013-01-01</td>
<td class="org-left">1,339</td>
</tr>
<tr>
<td class="org-right">2014-01-01</td>
<td class="org-left">1,464</td>
</tr>
<tr>
<td class="org-right">2015-01-01</td>
<td class="org-left">1,434</td>
</tr>
<tr>
<td class="org-right">2016-01-01</td>
<td class="org-left">1,208</td>
</tr>
<tr>
<td class="org-right">2017-01-01</td>
<td class="org-left">970</td>
</tr>
<tr>
<td class="org-right">2018-01-01</td>
<td class="org-left">958</td>
</tr>
<tr>
<td class="org-right">2019-01-01</td>
<td class="org-left">967</td>
</tr>
<tr>
<td class="org-right">2020-01-01</td>
<td class="org-left">1,948</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><span class="nf">theme_set</span><span class="p">(</span><span class="nf">theme_minimal</span><span class="p">())</span>
<span class="n">PATH</span> <span class="o">=</span> <span class="s">"../files/posts/nypd-shooting-incident-data/"</span>
<span class="n">join_path</span> <span class="o">=</span> <span class="nf">partial</span><span class="p">(</span><span class="n">paste</span><span class="p">,</span> <span class="n">PATH</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">""</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">annual_shootings</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Year</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Shootings</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">()</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">scale_x_date</span><span class="p">(</span><span class="n">date_labels</span><span class="o">=</span><span class="s">"%Y"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">"Year"</span><span class="p">,</span> <span class="n">date_breaks</span><span class="o">=</span><span class="s">"1 year"</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"NYPD Annual Shootings Incidents Reported"</span><span class="p">)</span>
<span class="nf">ggsave</span><span class="p">(</span><span class="nf">join_path</span><span class="p">(</span><span class="s">"annual_shootings.png"</span><span class="p">),</span>
       <span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">)</span>
</pre></div>

<p>
<img src="posts/nypd-shooting-incident-data/annual_shootings.png" alt="nil"></p>
</div>

<ul class="org-ul">
<li>
<a id="org2862aee"></a>By Borough<br><div class="outline-text-5" id="text-org2862aee">
<div class="highlight"><pre><span></span><span class="n">borough_shootings</span> <span class="o">&lt;-</span> <span class="n">dates</span> <span class="o">%&gt;%</span> <span class="nf">group_by</span><span class="p">(</span><span class="n">Year</span><span class="p">,</span> <span class="n">Borough</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">summarise</span><span class="p">(</span><span class="n">Shootings</span><span class="o">=</span><span class="nf">n</span><span class="p">())</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">file_name</span> <span class="o">=</span> <span class="s">"annual_shootings_boroughs.png"</span>
<span class="n">plot</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">borough_shootings</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Year</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Shootings</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">Borough</span><span class="p">,</span> <span class="n">colour</span><span class="o">=</span><span class="n">Borough</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">()</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">scale_x_date</span><span class="p">(</span><span class="n">date_labels</span><span class="o">=</span><span class="s">"%Y"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">"Year"</span><span class="p">,</span> <span class="n">date_breaks</span><span class="o">=</span><span class="s">"1 year"</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"NYPD Annual Shootings by Borough"</span><span class="p">)</span>
<span class="nf">ggsave</span><span class="p">(</span><span class="nf">join_path</span><span class="p">(</span><span class="n">file_name</span><span class="p">),</span>
       <span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">)</span>
</pre></div>

<p>
<img src="posts/nypd-shooting-incident-data/annual_shootings_boroughs.png" alt="nil"></p>
</div>
</li>
</ul>
</div>

<div id="outline-container-orgc344ae9" class="outline-4">
<h4 id="orgc344ae9">Monthly</h4>
<div class="outline-text-4" id="text-orgc344ae9">
<div class="highlight"><pre><span></span><span class="n">dates</span><span class="o">$</span><span class="n">year_month</span> <span class="o">&lt;-</span> <span class="nf">floor_date</span><span class="p">(</span><span class="n">dates</span><span class="o">$</span><span class="n">DATE</span><span class="p">,</span> <span class="s">"month"</span><span class="p">)</span>
<span class="n">monthly_shootings</span> <span class="o">&lt;-</span> <span class="n">dates</span> <span class="o">%&gt;%</span> <span class="nf">group_by</span><span class="p">(</span><span class="n">year_month</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">summarise</span><span class="p">(</span><span class="n">Shootings</span><span class="o">=</span><span class="nf">n</span><span class="p">())</span>

<span class="n">monthly_shootings</span><span class="o">$</span><span class="n">month_number</span> <span class="o">&lt;-</span> <span class="nf">as.numeric</span><span class="p">(</span>
  <span class="nf">format</span><span class="p">(</span><span class="nf">as.Date</span><span class="p">(</span><span class="n">monthly_shootings</span><span class="o">$</span><span class="n">year_month</span><span class="p">),</span> <span class="s">"%m"</span><span class="p">))</span>
<span class="n">monthly_shootings</span><span class="o">$</span><span class="n">Month</span> <span class="o">&lt;-</span> <span class="nf">months</span><span class="p">(</span><span class="nf">as.Date</span><span class="p">(</span><span class="n">monthly_shootings</span><span class="o">$</span><span class="n">year_month</span><span class="p">),</span>
				  <span class="n">abbreviate</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="n">monthly_shootings</span><span class="o">$</span><span class="n">Year</span> <span class="o">&lt;-</span> <span class="nf">year</span><span class="p">(</span><span class="nf">ymd</span><span class="p">(</span><span class="n">monthly_shootings</span><span class="o">$</span><span class="n">year_month</span><span class="p">))</span>
<span class="n">monthly_shootings</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">monthly_shootings</span><span class="p">,</span>
	      <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">month_number</span><span class="p">,</span>
		  <span class="n">y</span><span class="o">=</span><span class="n">Shootings</span><span class="p">,</span>
		  <span class="n">group</span><span class="o">=</span><span class="n">Year</span><span class="p">,</span> <span class="n">colour</span><span class="o">=</span><span class="n">Year</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">()</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="n">monthly_shootings</span><span class="o">$</span><span class="n">month_number</span><span class="p">,</span>
		     <span class="n">labels</span><span class="o">=</span><span class="n">monthly_shootings</span><span class="o">$</span><span class="n">Month</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">"Month"</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"NYPD Shootings by Month (Year-Over-Year)"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"../files/posts/nypd-shooting-incident-data/monthly_shootings.png"</span><span class="p">,</span>
       <span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">)</span>
</pre></div>

<p>
<img src="posts/nypd-shooting-incident-data/monthly_shootings.png" alt="nil"></p>

<div class="highlight"><pre><span></span><span class="n">three_years</span> <span class="o">=</span> <span class="n">monthly_shootings</span><span class="p">[</span><span class="nf">which</span><span class="p">(</span><span class="n">monthly_shootings</span><span class="o">$</span><span class="n">Year</span> <span class="o">%in%</span> <span class="nf">c</span><span class="p">(</span><span class="m">2006</span><span class="p">,</span> <span class="m">2018</span><span class="p">,</span> <span class="m">2020</span><span class="p">)),]</span>

<span class="n">plot</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">three_years</span><span class="p">,</span>
	      <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">month_number</span><span class="p">,</span>
		  <span class="n">y</span><span class="o">=</span><span class="n">Shootings</span><span class="p">,</span>
		  <span class="n">group</span><span class="o">=</span><span class="n">Year</span><span class="p">,</span> <span class="n">colour</span><span class="o">=</span><span class="n">Year</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">()</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="n">three_years</span><span class="o">$</span><span class="n">month_number</span><span class="p">,</span>
		     <span class="n">labels</span><span class="o">=</span><span class="n">three_years</span><span class="o">$</span><span class="n">Month</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">"Month"</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"NYPD Shootings by Month (2006, 2018, 2020)"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="s">"../files/posts/nypd-shooting-incident-data/monthly_shootings_three-years.png"</span><span class="p">,</span>
       <span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">)</span>
</pre></div>

<p>
<img src="posts/nypd-shooting-incident-data/monthly_shootings_three-years.png" alt="nil"></p>
</div>

<ul class="org-ul">
<li>
<a id="orge0a9c33"></a>By Borough<br><div class="outline-text-5" id="text-orge0a9c33">
<div class="highlight"><pre><span></span><span class="n">borough_monthly</span> <span class="o">&lt;-</span> <span class="n">dates</span> <span class="o">%&gt;%</span> <span class="nf">group_by</span><span class="p">(</span><span class="n">year_month</span><span class="p">,</span> <span class="n">BORO</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">summarise</span><span class="p">(</span><span class="n">Shootings</span><span class="o">=</span><span class="nf">n</span><span class="p">())</span>

<span class="n">borough_monthly</span><span class="o">$</span><span class="n">monthly_number</span> <span class="o">&lt;-</span> <span class="nf">as.numeric</span><span class="p">(</span>
  <span class="nf">format</span><span class="p">(</span><span class="nf">as.Date</span><span class="p">(</span><span class="n">borough_monthly</span><span class="o">$</span><span class="n">year_month</span><span class="p">),</span> <span class="s">"%m"</span><span class="p">))</span>
<span class="n">borough_monthly</span><span class="o">$</span><span class="n">Month</span> <span class="o">&lt;-</span> <span class="nf">months</span><span class="p">(</span><span class="nf">as.Date</span><span class="p">(</span><span class="n">borough_monthly</span><span class="o">$</span><span class="n">year_month</span><span class="p">),</span>
				<span class="n">abbreviate</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="n">borough_monthly</span><span class="o">$</span><span class="n">Year</span> <span class="o">&lt;-</span> <span class="nf">year</span><span class="p">(</span><span class="nf">ymd</span><span class="p">(</span><span class="n">borough_monthly</span><span class="o">$</span><span class="n">year_month</span><span class="p">))</span>
<span class="n">borough_monthly</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">boroughs_2020</span> <span class="o">=</span> <span class="n">borough_monthly</span><span class="p">[</span><span class="nf">which</span><span class="p">(</span><span class="n">borough_monthly</span><span class="o">$</span><span class="n">Year</span> <span class="o">%in%</span> <span class="nf">c</span><span class="p">(</span><span class="m">2020</span><span class="p">)),]</span>

<span class="n">plot</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">boroughs_2020</span><span class="p">,</span>
	      <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">monthly_number</span><span class="p">,</span>
		  <span class="n">y</span><span class="o">=</span><span class="n">Shootings</span><span class="p">,</span>
		  <span class="n">group</span><span class="o">=</span><span class="n">BORO</span><span class="p">,</span> <span class="n">colour</span><span class="o">=</span><span class="n">BORO</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">()</span> <span class="o">+</span> <span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="n">boroughs_2020</span><span class="o">$</span><span class="n">monthly_number</span><span class="p">,</span>
		     <span class="n">labels</span><span class="o">=</span><span class="n">boroughs_2020</span><span class="o">$</span><span class="n">Month</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">"Month"</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"NYPD Shootings by Borough (2020)"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="nf">join_path</span><span class="p">(</span><span class="s">"monthly_shootings_by_borough.png"</span><span class="p">),</span>
       <span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">)</span>
</pre></div>

<p>
<img src="posts/nypd-shooting-incident-data/monthly_shootings_by_borough.png" alt="nil"></p>
</div>
</li>
</ul>
</div>
<div id="outline-container-org1aced50" class="outline-4">
<h4 id="org1aced50">By Map</h4>
<div class="outline-text-4" id="text-org1aced50">
<div class="highlight"><pre><span></span><span class="n">dates</span><span class="o">$</span><span class="n">Year</span> <span class="o">&lt;-</span> <span class="nf">year</span><span class="p">(</span><span class="nf">ymd</span><span class="p">(</span><span class="n">dates</span><span class="o">$</span><span class="n">year_month</span><span class="p">))</span>
<span class="n">last_year</span> <span class="o">&lt;-</span> <span class="n">dates</span><span class="p">[</span><span class="n">dates</span><span class="o">$</span><span class="n">Year</span><span class="o">==</span><span class="m">2020</span><span class="p">,]</span>
<span class="n">last_year</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">minimum_latitude</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">last_year</span><span class="o">$</span><span class="n">Latitude</span><span class="p">)</span>
<span class="n">maximum_latitude</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">last_year</span><span class="o">$</span><span class="n">Latitude</span><span class="p">)</span>
<span class="n">minimum_longitude</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">last_year</span><span class="o">$</span><span class="n">Longitude</span><span class="p">)</span>
<span class="n">maximum_longitude</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">last_year</span><span class="o">$</span><span class="n">Longitude</span><span class="p">)</span>


<span class="n">plot</span> <span class="o">=</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">last_year</span><span class="p">,</span>
	      <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Longitude</span><span class="p">,</span>
		  <span class="n">y</span><span class="o">=</span><span class="n">Latitude</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">BORO</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">1</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">minimum_longitude</span><span class="p">,</span> <span class="n">maximum_longitude</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">scale_y_continuous</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">minimum_latitude</span><span class="p">,</span> <span class="n">maximum_latitude</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"NYPD Shootings by Latitude and Longitude (2020)"</span><span class="p">)</span>

<span class="nf">ggsave</span><span class="p">(</span><span class="nf">join_path</span><span class="p">(</span><span class="s">"monthly_shootings_latitude_longitude.png"</span><span class="p">),</span>
       <span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">)</span>
</pre></div>

<p>
<img src="posts/nypd-shooting-incident-data/monthly_shootings_latitude_longitude.png" alt="nil"></p>
</div>
</div>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/r-babel-test/" class="u-url">R Babel Test</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/r-babel-test/" rel="bookmark">
            <time class="published dt-published" datetime="2021-12-09T17:08:17-08:00" itemprop="datePublished" title="2021-12-09 17:08">2021-12-09 17:08</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">rnorm</span><span class="p">(</span><span class="m">100</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>

<pre class="example">
    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
-1.93398 -0.79415  0.01453 -0.01418  0.67102  2.20682
</pre>


<p>
Does it keep the variables alive between blocks?
</p>

<div class="highlight"><pre><span></span><span class="nf">summary</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>

<pre class="example">
    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
-1.93398 -0.79415  0.01453 -0.01418  0.67102  2.20682
</pre>


<p>
Looks like it.
</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/insertion-sort/" class="u-url">Insertion Sort</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/insertion-sort/" rel="bookmark">
            <time class="published dt-published" datetime="2021-11-30T17:15:24-08:00" itemprop="datePublished" title="2021-11-30 17:15">2021-11-30 17:15</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/insertion-sort/#orgdcb5fe8">The Insertion Sort</a></li>
<li><a href="posts/insertion-sort/#orgca46569">The Algorithm Parts</a></li>
<li><a href="posts/insertion-sort/#org0b3492f">The Pseudocode</a></li>
<li><a href="posts/insertion-sort/#org6f698ac">Runtime</a></li>
<li>
<a href="posts/insertion-sort/#orga46f47e">Implement It</a>
<ul>
<li><a href="posts/insertion-sort/#orgc4ceb77">Imports</a></li>
<li><a href="posts/insertion-sort/#org321e7af">Some Types</a></li>
<li><a href="posts/insertion-sort/#orgfb853b0">The Counter</a></li>
<li>
<a href="posts/insertion-sort/#org5cfd6cb">Some Simple Testing</a>
<ul>
<li><a href="posts/insertion-sort/#orgf35450d">Importing</a></li>
<li><a href="posts/insertion-sort/#orgdbf71e5">Set Up</a></li>
<li><a href="posts/insertion-sort/#org2d69910">Worst Case</a></li>
<li><a href="posts/insertion-sort/#org7528ba8">Best Case</a></li>
<li><a href="posts/insertion-sort/#org6d314b1">Random</a></li>
</ul>
</li>
<li><a href="posts/insertion-sort/#orga64480a">Comparisons and Swaps</a></li>
<li><a href="posts/insertion-sort/#org40d0e14">Best and Worst Cases</a></li>
<li>
<a href="posts/insertion-sort/#org0c32fea">The Swaps</a>
<ul>
<li><a href="posts/insertion-sort/#orgb543e39">Random Case</a></li>
<li><a href="posts/insertion-sort/#org38afdbe">Worst Case Swaps</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="posts/insertion-sort/#org099992c">Compare The Three Amigos</a></li>
<li><a href="posts/insertion-sort/#org7b07d74">Sources</a></li>
</ul>
</div>
</div>
<p>
\(\def\sc#1{\dosc#1\csod} \def\dosc#1#2\csod{{\rm #1{\small #2}}}\)
</p>

<div id="outline-container-orgdcb5fe8" class="outline-2">
<h2 id="orgdcb5fe8">The Insertion Sort</h2>
<div class="outline-text-2" id="text-orgdcb5fe8">
<p>
The insertion sort is an instance of a <a href="posts/decrease-and-conquer/">Decrease And Conquer</a> algorithm and is another case where you maintain a sorted sub-list at the beginning of the list of elements to sort (similar to {<a href="posts/selection-sort/">selection sort</a>) but instead of scanning the entire unsorted section for the next smallest item to pick (as in "selection sort") you pick the next item in the unsorted and scan down through the sorted section until you find the right place to insert it. This has the slight advantage over selection sort in that you might not have to scan the entire sorted section to find where to insert the next item, while you always have to scan the entire unsorted section to find the next item to select in the selection sort. On the other hand, instead of swapping just two items at the end of each loop, as in the selection sort, with the insertion sort you have to shift every item above where the next item is going to be inserted in order to make a space for it.
</p>
</div>
</div>

<div id="outline-container-orgca46569" class="outline-2">
<h2 id="orgca46569">The Algorithm Parts</h2>
<div class="outline-text-2" id="text-orgca46569">
<p>
This is taken pretty straight from <a href="posts/HTTAA/">How To Think About Algorithms</a>.
</p>

<ul class="org-ul">
<li>
<b><b>Specification:</b></b> This is a <a href="posts/the-sorting-problem/">Sorting Problem</a>.</li>
<li>
<b><b>Basic Steps:</b></b> Repeatedly insert an item where it belongs.</li>
<li>
<b><b>Measure of Progress:</b></b> The number of elements we've inserted so far.</li>
<li>
<b><b>The Loop Invariant:</b></b> The inserted elements are in sorted order.</li>
<li>
<b><b>Main Steps:</b></b> Take an unselected item and insert it into the correct place in the sorted list.</li>
<li>
<b><b>Make Progress:</b></b> We always insert an item.</li>
<li>
<b><b>Maintain the Loop Invariant:</b></b>
<ul class="org-ul">
<li>\( \langle \textit{Loop Invariant} \rangle\): Insertion List is sorted.</li>
<li>\(\lnot \langle \textit{Exit-Condition} \rangle \): There's more to sort.</li>
<li>\(\sc{CodeLoop}\): The item that was chosen was inserted in the place that maintains the loop invariant.</li>
</ul>
</li>
<li>
<b><b>Establish the Loop Invariant:</b></b> Pick the first item from the unsorted list giving us a sorted list with one item.</li>
<li>
<b><b>Exit Condition:</b></b> We've inserted all the items.</li>
<li>
<b><b>Ending:</b></b>
<ul class="org-ul">
<li>\(\langle \textit{Exit-Condition} \rangle\): All elements were inserted.</li>
<li>\(\langle \textit{Loop Invariant} \rangle\): All inserted elements are in the right order.</li>
<li>\(\rightarrow \langle \textit{Post-Condition} \rangle\): All the elements are in sorted order.</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org0b3492f" class="outline-2">
<h2 id="org0b3492f">The Pseudocode</h2>
<div class="outline-text-2" id="text-org0b3492f">
<pre id="insertionsort" style="display:hidden;">
\begin{algorithm}
\caption{InsertionSort}
\begin{algorithmic}
\INPUT An array of orderable items
\OUTPUT The array sorted in ascending order
\PROCEDURE{InsertionSort}{$A$}
  \FOR{$i \gets 1$ to $n - 1$}
    \STATE $v \gets A[i]$
    \STATE $j \gets i - 1$
    \WHILE{$j \geq 0$ and $A[j] &gt; v$}
       \STATE $A[j + 1] \gets A[j]$
       \STATE $j \gets j - 1$
    \ENDWHILE
    \STATE $A[j + 1] \gets v$
  \ENDFOR
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>

<p>
The outer loop tracks the boundary between the sorted section of the list (elements whose index is less than <i>i</i>) and the unsorted section (<i>i</i> to the end of the list). Every time through the outer loop we pick the next item to insert (and assign it to <i>v</i>) then in the <code>while</code> loop we traverse the list backwards, moving the items up one in the list until we find a place where the value to insert isn't less than the next item in the array (or we haven't reached the start of the list). Once we end up at the place to insert the value we exit the <code>while</code> loop and insert the value where we stopped. Then we move our outer loop up one and start again until everything's sorted.
</p>
</div>
</div>

<div id="outline-container-org6f698ac" class="outline-2">
<h2 id="org6f698ac">Runtime</h2>
<div class="outline-text-2" id="text-org6f698ac">
<p>
Given the two loops you can probably guess that it's going to be \(\Theta(n^2)\), but I'll go through it so I don't forget later on.
</p>

\begin{align}
C_{worst} &amp;= \sum_{i=1}^{n - 1} \sum_{j=0}^{i-1} 1\\
&amp;= \sum_{i=1}^{n - 1} ((i - 1) - 0 + 1) \\
&amp;= \sum_{i=1}^{n - 1} i
\end{align}

<p>
This is pretty similar to what I had in the <a href="posts/bubble-sort-runtime-explained/">Bubble Sort: Runtime Explained</a> post so I won't go over the reasons for the steps, but at this point we can use the summing backwards and forwards of the series trick to see what our worst-case runtime is.
</p>

\begin{array}{ccccccccc}
&amp; 1 &amp; + &amp; 2 &amp; + &amp; \cdots &amp; + &amp; (n - 2) &amp; + &amp; (n - 1) \\
+ &amp; (n - 1) &amp; + &amp; (n - 2) &amp; + &amp; \cdots &amp; + &amp; 2 &amp; + &amp; 1 \\
\hline
&amp; n &amp; + &amp; n &amp; + &amp; \cdots &amp; + &amp; n &amp; + &amp; n\\
\end{array}

<p>
So we have <i>n - 1</i> terms of <i>n</i> in our doubled runtime which we can then halve to get:
</p>

<p>
\[
C_{worst} = \frac{n (n - 1)}{2} \in \Theta(n^2)
\]
</p>
</div>
</div>

<div id="outline-container-orga46f47e" class="outline-2">
<h2 id="orga46f47e">Implement It</h2>
<div class="outline-text-2" id="text-orga46f47e">
<p>
I'll try and copy the way the selection and bubble sorts looked to make it easier to compare them later.
</p>
</div>

<div id="outline-container-orgc4ceb77" class="outline-3">
<h3 id="orgc4ceb77">Imports</h3>
<div class="outline-text-3" id="text-orgc4ceb77">
<div class="highlight"><pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">MutableSequence</span>
</pre></div>
</div>
</div>

<div id="outline-container-org321e7af" class="outline-3">
<h3 id="org321e7af">Some Types</h3>
<div class="outline-text-3" id="text-org321e7af">
<p>
<b><b>Note:</b></b> For my future self: using the <code>dataclass</code> is the python way to make a data object, but numba doesn't like it, so we can't use it.
</p>

<div class="highlight"><pre><span></span><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">InsertionOutput</span><span class="p">:</span>
    <span class="n">element_count</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">comparisons</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">swaps</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">elements</span><span class="p">:</span> <span class="n">MutableSequence</span>
</pre></div>

<p>
I'll use the regular <code>namedtuple</code> instead.
</p>

<div class="highlight"><pre><span></span><span class="n">InsertionOutput</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">"InsertionOutput"</span><span class="p">,</span> <span class="p">[</span><span class="s2">"element_count"</span><span class="p">,</span>
						 <span class="s2">"comparisons"</span><span class="p">,</span>
						 <span class="s2">"swaps"</span><span class="p">,</span>
						 <span class="s2">"elements"</span><span class="p">])</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgfb853b0" class="outline-3">
<h3 id="orgfb853b0">The Counter</h3>
<div class="outline-text-3" id="text-orgfb853b0">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">insertion_sort</span><span class="p">(</span><span class="n">elements</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InsertionOutput</span><span class="p">:</span>
    <span class="sd">"""Sorts elements using iterative insertion-sort</span>

<span class="sd">    Args:</span>
<span class="sd">     elements: sortable collection of elements</span>

<span class="sd">    Returns:</span>
<span class="sd">     count of elements, comparisons made, swaps made, sorted elements</span>
<span class="sd">    """</span>
    <span class="n">comparisons</span> <span class="o">=</span> <span class="n">swaps</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">next_unsorted_cell</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)):</span>
	<span class="n">thing_to_insert</span> <span class="o">=</span> <span class="n">elements</span><span class="p">[</span><span class="n">next_unsorted_cell</span><span class="p">]</span>

	<span class="n">in_front_of_me</span><span class="p">,</span> <span class="n">to_the_right</span> <span class="o">=</span> <span class="p">(</span><span class="n">next_unsorted_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
					<span class="n">next_unsorted_cell</span><span class="p">)</span>

	<span class="k">while</span> <span class="ow">not</span> <span class="p">(</span><span class="n">in_front_of_me</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span>
		   <span class="n">elements</span><span class="p">[</span><span class="n">in_front_of_me</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">thing_to_insert</span><span class="p">):</span>
	    <span class="n">comparisons</span> <span class="o">+=</span> <span class="mi">1</span>
	    <span class="n">swaps</span> <span class="o">+=</span> <span class="mi">1</span>
	    <span class="n">elements</span><span class="p">[</span><span class="n">to_the_right</span><span class="p">]</span> <span class="o">=</span> <span class="n">elements</span><span class="p">[</span><span class="n">in_front_of_me</span><span class="p">]</span>
	    <span class="n">in_front_of_me</span><span class="p">,</span> <span class="n">to_the_right</span> <span class="o">=</span> <span class="p">(</span><span class="n">in_front_of_me</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
					    <span class="n">in_front_of_me</span><span class="p">)</span>

	<span class="n">elements</span><span class="p">[</span><span class="n">to_the_right</span><span class="p">]</span> <span class="o">=</span> <span class="n">thing_to_insert</span>
	<span class="n">swaps</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">InsertionOutput</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">),</span> <span class="n">comparisons</span><span class="p">,</span> <span class="n">swaps</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span>
</pre></div>

<p>
I negated the while-condition and re-stated the body to make more sense to me. Hopefully it's still clear what's going on.
</p>
</div>
</div>

<div id="outline-container-org5cfd6cb" class="outline-3">
<h3 id="org5cfd6cb">Some Simple Testing</h3>
<div class="outline-text-3" id="text-org5cfd6cb">
</div>
<div id="outline-container-orgf35450d" class="outline-4">
<h4 id="orgf35450d">Importing</h4>
<div class="outline-text-4" id="text-orgf35450d">
<div class="highlight"><pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">contain_exactly</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">njit</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">default_rng</span>

<span class="kn">import</span> <span class="nn">altair</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># this project</span>
<span class="kn">from</span> <span class="nn">bowling.sort.insertion</span> <span class="kn">import</span> <span class="n">insertion_sort</span>

<span class="c1"># my stuff</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">Timer</span>
<span class="kn">from</span> <span class="nn">graeae.visualization.altair_helpers</span> <span class="kn">import</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">save_chart</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgdbf71e5" class="outline-4">
<h4 id="orgdbf71e5">Set Up</h4>
<div class="outline-text-4" id="text-orgdbf71e5">
<div class="highlight"><pre><span></span><span class="n">numba_random</span> <span class="o">=</span> <span class="n">default_rng</span><span class="p">(</span><span class="mi">2022</span><span class="p">)</span>
<span class="n">TIMER</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>

<span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"insertion-sort"</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="n">output_path</span><span class="p">(</span><span class="n">SLUG</span><span class="p">)</span>
<span class="n">save_it</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">save_chart</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-org2d69910" class="outline-4">
<h4 id="org2d69910">Worst Case</h4>
<div class="outline-text-4" id="text-org2d69910">
<div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)))</span>
<span class="n">expected</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">copy</span><span class="p">()))</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">insertion_sort</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">comparisons</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">((</span><span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org7528ba8" class="outline-4">
<h4 id="org7528ba8">Best Case</h4>
<div class="outline-text-4" id="text-org7528ba8">
<div class="highlight"><pre><span></span><span class="n">inputs</span> <span class="o">=</span> <span class="n">expected</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">insertion_sort</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">comparisons</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">swaps</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>

<p>
Maybe <code>comparisons</code> is the wrong term since it's really counting the number of times we get past the sentinel in the <code>while</code> statement, but I don't think there's a good way to count how many times the sentinel gets checked, so the swaps has to act as a proxy for this best-case scenario where we never drop into the while loop.
</p>
</div>
</div>

<div id="outline-container-org6d314b1" class="outline-4">
<h4 id="org6d314b1">Random</h4>
<div class="outline-text-4" id="text-org6d314b1">
<div class="highlight"><pre><span></span><span class="n">inputs</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">copy</span><span class="p">()))</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">insertion_sort</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>

<span class="nb">print</span><span class="p">((</span><span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">comparisons</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">swaps</span><span class="p">)</span>
</pre></div>

<pre class="example">
4950.0
2585
2684
</pre>
</div>
</div>
</div>

<div id="outline-container-orga64480a" class="outline-3">
<h3 id="orga64480a">Comparisons and Swaps</h3>
<div class="outline-text-3" id="text-orga64480a">
<div class="highlight"><pre><span></span><span class="n">numba_sort</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="n">insertion_sort</span><span class="p">)</span>
<span class="n">things_to_sort</span> <span class="o">=</span> <span class="p">[</span><span class="n">numba_random</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>
		  <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)]</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">sort_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
	<span class="n">delayed</span><span class="p">(</span><span class="n">numba_sort</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">)</span>
</pre></div>

<pre class="example">
Started: 2022-01-16 22:55:12.336777
Ended: 2022-01-16 22:55:23.534382
Elapsed: 0:00:11.197605
</pre>


<div class="highlight"><pre><span></span><span class="n">SIZE</span><span class="p">,</span> <span class="n">COMPARISONS</span><span class="p">,</span> <span class="n">SWAPS</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
<span class="n">unzipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">sort_output</span><span class="p">))</span>
<span class="n">count_frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"Elements"</span><span class="p">:</span> <span class="n">unzipped</span><span class="p">[</span><span class="n">SIZE</span><span class="p">],</span>
				<span class="s2">"Insertion"</span><span class="p">:</span> <span class="n">unzipped</span><span class="p">[</span><span class="n">SWAPS</span><span class="p">]})</span>

<span class="n">count_frame</span><span class="p">[</span><span class="s2">"n^2"</span><span class="p">]</span> <span class="o">=</span> <span class="n">count_frame</span><span class="o">.</span><span class="n">Elements</span><span class="o">**</span><span class="mi">2</span>

<span class="n">melted</span> <span class="o">=</span> <span class="n">count_frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Elements"</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">"Source"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Runtime"</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">tooltip</span> <span class="o">=</span> <span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Elements"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	   <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Runtime"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span> 
	   <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Source:N"</span><span class="p">)]</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span> <span class="o">=</span> <span class="s2">"Elements"</span><span class="p">,</span>
    <span class="n">y</span> <span class="o">=</span> <span class="s2">"Runtime"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Source:N"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="n">tooltip</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">"Insertion Sort"</span>
<span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"insertion-sort-comparisons"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/insertion-sort/insertion-sort-comparisons.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>

<p>
With our random input the Insertion Sort does better than the theoretical worst case. 
</p>
</div>
</div>

<div id="outline-container-org40d0e14" class="outline-3">
<h3 id="org40d0e14">Best and Worst Cases</h3>
<div class="outline-text-3" id="text-org40d0e14">
<p>
Let's get rid of the \(n^2\) and add the best-case and worst-case data.
</p>

<div class="highlight"><pre><span></span><span class="n">frame</span> <span class="o">=</span> <span class="n">count_frame</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"Insertion"</span><span class="p">:</span> <span class="s2">"Random"</span><span class="p">})</span>
<span class="k">del</span> <span class="n">frame</span><span class="p">[</span><span class="s2">"n^2"</span><span class="p">]</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">best_things</span> <span class="o">=</span> <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)]</span>
<span class="n">worst_things</span> <span class="o">=</span> <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">things</span><span class="p">)</span> <span class="k">for</span> <span class="n">things</span> <span class="ow">in</span> <span class="n">best_things</span><span class="p">]</span>

<span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">worst_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
	<span class="n">delayed</span><span class="p">(</span><span class="n">numba_sort</span><span class="p">)(</span><span class="n">thing</span><span class="p">)</span> <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="n">worst_things</span>
<span class="p">)</span>
</pre></div>

<pre class="example">
Started: 2022-01-16 22:56:34.282090
Ended: 2022-01-16 22:56:56.373266
Elapsed: 0:00:22.091176
</pre>


<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">best_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
	<span class="n">delayed</span><span class="p">(</span><span class="n">numba_sort</span><span class="p">)(</span><span class="n">thing</span><span class="p">)</span> <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="n">best_things</span>
<span class="p">)</span>
</pre></div>

<pre class="example">
Started: 2022-01-16 22:57:04.941850
Ended: 2022-01-16 22:57:05.067092
Elapsed: 0:00:00.125242
</pre>


<div class="highlight"><pre><span></span><span class="n">best_unzipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">best_output</span><span class="p">))</span>
<span class="n">worst_unzipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">worst_output</span><span class="p">))</span>

<span class="n">frame</span><span class="p">[</span><span class="s2">"Best"</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_unzipped</span><span class="p">[</span><span class="n">SWAPS</span><span class="p">]</span>
<span class="n">frame</span><span class="p">[</span><span class="s2">"Worst"</span><span class="p">]</span> <span class="o">=</span> <span class="n">worst_unzipped</span><span class="p">[</span><span class="n">SWAPS</span><span class="p">]</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">melted</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Elements"</span><span class="p">],</span>
		    <span class="n">var_name</span><span class="o">=</span><span class="s2">"Input"</span><span class="p">,</span>
		    <span class="n">value_name</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Elements"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Input"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Elements"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Comparisons"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="s2">"Input"</span><span class="p">],</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Insertion Sort Best, Worst, Random"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span>
<span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"best-worst-random"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/insertion-sort/best-worst-random.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>

<p>
Here we can see why Insertion Sort is considered better than Bubble and Selection Sort. In those cases they have to traverse the entire unsorted collection every time but Insertion Sort only picks whatever is the next unsorted item and searches the sorted until it finds the right place to insert it. In the worst case they're all the same, but whenever it isn't the worst case insertion sort offers a little improvement.
</p>
</div>
</div>

<div id="outline-container-org0c32fea" class="outline-3">
<h3 id="org0c32fea">The Swaps</h3>
<div class="outline-text-3" id="text-org0c32fea">
<p>
Let's look at what plotting the location of the elements as they are swapped looks like.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">insertion_swaps</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">"""Keeps track of the element indexes as they are swapped</span>

<span class="sd">    Args:</span>
<span class="sd">     elements: list of orderable elements</span>

<span class="sd">    Returns:</span>
<span class="sd">     dict mapping element to list of indices where it was in the elements list</span>
<span class="sd">    """</span>
    <span class="n">swaps</span> <span class="o">=</span> <span class="p">{</span><span class="n">element</span><span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elements</span><span class="p">)}</span>

    <span class="n">number_of_elements</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">next_unsorted_cell</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)):</span>
	<span class="n">thing_to_insert</span> <span class="o">=</span> <span class="n">elements</span><span class="p">[</span><span class="n">next_unsorted_cell</span><span class="p">]</span>

	<span class="n">in_front_of_me</span><span class="p">,</span> <span class="n">to_the_right</span> <span class="o">=</span> <span class="p">(</span><span class="n">next_unsorted_cell</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
					<span class="n">next_unsorted_cell</span><span class="p">)</span>

	<span class="k">while</span> <span class="ow">not</span> <span class="p">(</span><span class="n">in_front_of_me</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span>
	       <span class="n">elements</span><span class="p">[</span><span class="n">in_front_of_me</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">thing_to_insert</span><span class="p">):</span>
	    <span class="n">elements</span><span class="p">[</span><span class="n">to_the_right</span><span class="p">]</span> <span class="o">=</span> <span class="n">elements</span><span class="p">[</span><span class="n">in_front_of_me</span><span class="p">]</span>
	    <span class="n">in_front_of_me</span><span class="p">,</span> <span class="n">to_the_right</span> <span class="o">=</span> <span class="p">(</span><span class="n">in_front_of_me</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
					    <span class="n">in_front_of_me</span><span class="p">)</span>

	<span class="n">elements</span><span class="p">[</span><span class="n">to_the_right</span><span class="p">]</span> <span class="o">=</span> <span class="n">thing_to_insert</span>

	<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elements</span><span class="p">):</span>
	    <span class="n">swaps</span><span class="p">[</span><span class="n">element</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">swaps</span>
</pre></div>

<p>
A little sanity check.
</p>

<div class="highlight"><pre><span></span><span class="n">inputs</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">copy</span><span class="p">()))</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">insertion_swaps</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>
</pre></div>
</div>

<div id="outline-container-orgb543e39" class="outline-4">
<h4 id="orgb543e39">Random Case</h4>
<div class="outline-text-4" id="text-orgb543e39">
<div class="highlight"><pre><span></span><span class="n">COUNT</span> <span class="o">=</span> <span class="mi">50</span>

<span class="n">inputs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">COUNT</span><span class="p">))</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">swaps</span> <span class="o">=</span> <span class="n">insertion_swaps</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

<span class="n">track_frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">swaps</span><span class="p">)</span>
<span class="n">re_indexed</span> <span class="o">=</span> <span class="n">track_frame</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"Swap"</span><span class="p">})</span>
<span class="n">melted</span> <span class="o">=</span> <span class="n">re_indexed</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">var_name</span><span class="o">=</span><span class="s2">"Value To Sort"</span><span class="p">,</span>
			 <span class="n">value_name</span><span class="o">=</span><span class="s2">"Location In Array"</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="s2">"Swap"</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Swap"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Location In Array"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Value To Sort:O"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"Swap"</span><span class="p">,</span> <span class="s2">"Location In Array"</span><span class="p">,</span> <span class="s2">"Value To Sort"</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Insertion Sort Insertions"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"insertion-sort-swaps"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/insertion-sort/insertion-sort-swaps.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>

<p>
To interpret the chart, the y-axis values are the indices of the input list and as we move left to right along the x-axis we are traversing the outer loop. Everytime a line goes from horizontal to a downward slope that means that the element at the <i>y</i> location was plucked from the unsorted section and inserted into the previously sorted section. The longer the downward line, the further back it had to go in the sorted section before being inserted (and so the more items had to be moved aside for it to find its place).
</p>
</div>
</div>

<div id="outline-container-org38afdbe" class="outline-4">
<h4 id="org38afdbe">Worst Case Swaps</h4>
<div class="outline-text-4" id="text-org38afdbe">
<p>
Now we'll take a look at what the swaps look like when the collection to be sorted is in exactly the reversed order.
</p>

<div class="highlight"><pre><span></span><span class="n">COUNT</span> <span class="o">=</span> <span class="mi">50</span>

<span class="n">inputs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">COUNT</span><span class="p">)))</span>
<span class="n">swaps</span> <span class="o">=</span> <span class="n">insertion_swaps</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

<span class="n">track_frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">swaps</span><span class="p">)</span>
<span class="n">re_indexed</span> <span class="o">=</span> <span class="n">track_frame</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"Swap"</span><span class="p">})</span>
<span class="n">melted</span> <span class="o">=</span> <span class="n">re_indexed</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">var_name</span><span class="o">=</span><span class="s2">"Value To Sort"</span><span class="p">,</span>
			 <span class="n">value_name</span><span class="o">=</span><span class="s2">"Location In Array"</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="s2">"Swap"</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Swap"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Location In Array"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Value To Sort:O"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"Swap"</span><span class="p">,</span> <span class="s2">"Location In Array"</span><span class="p">,</span> <span class="s2">"Value To Sort"</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Insertion Sort Insertions (Worst-Case)"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"worst-case-insertion-sort-swaps"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/insertion-sort/worst-case-insertion-sort-swaps.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>

<p>
So, here we don't have the mostly short lines of the previous chart because every element had to be inserted at the beginning of the previously sorted section of the list.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org099992c" class="outline-2">
<h2 id="org099992c">Compare The Three Amigos</h2>
<div class="outline-text-2" id="text-org099992c">
<p>
We've had three brute-force sorters so far, let's see if there's a noticeable difference in their comparisons.
</p>

<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bowling.sort.bubble.bubble</span> <span class="kn">import</span> <span class="n">bubba</span>
<span class="kn">from</span> <span class="nn">bowling.sort.selection</span> <span class="kn">import</span> <span class="n">selection_counter</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">numba_bubble</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="n">bubba</span><span class="p">)</span>
<span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">bubble_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
	<span class="n">delayed</span><span class="p">(</span><span class="n">numba_bubble</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">)</span>
</pre></div>

<pre class="example">
Started: 2022-01-11 23:38:40.676138
Ended: 2022-01-11 23:40:07.211075
Elapsed: 0:01:26.534937
</pre>


<div class="highlight"><pre><span></span><span class="n">numba_selection</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="n">selection_counter</span><span class="p">)</span>
<span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">selection_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
	<span class="n">delayed</span><span class="p">(</span><span class="n">numba_selection</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">)</span>
</pre></div>

<pre class="example">
Started: 2022-01-11 23:00:03.404894
Ended: 2022-01-11 23:00:43.390039
Elapsed: 0:00:39.985145
</pre>


<div class="highlight"><pre><span></span><span class="n">unzipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">bubble_output</span><span class="p">))</span>

<span class="n">count_frame</span><span class="p">[</span><span class="s2">"Bubble"</span><span class="p">]</span> <span class="o">=</span> <span class="n">unzipped</span><span class="p">[</span><span class="n">COMPARISONS</span><span class="p">]</span>

<span class="n">unzipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">selection_output</span><span class="p">))</span>

<span class="n">count_frame</span><span class="p">[</span><span class="s2">"Selection"</span><span class="p">]</span> <span class="o">=</span> <span class="n">unzipped</span><span class="p">[</span><span class="n">COMPARISONS</span><span class="p">]</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">count_frame</span> <span class="o">=</span> <span class="n">count_frame</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"Insertion Comparisons"</span><span class="p">:</span> <span class="s2">"Insertion"</span><span class="p">})</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">frame</span> <span class="o">=</span> <span class="n">count_frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Elements"</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">"Sorter"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">tooltip</span> <span class="o">=</span> <span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Elements"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	   <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Comparisons"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span> 
	   <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Sorter"</span><span class="p">)]</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Elements"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Sorter"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="n">tooltip</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">550</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">"The Three Amigos"</span>
<span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"three-amigos-comparisons"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/insertion-sort/three-amigos-comparisons.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>

<p>
You might be looking at the chart and wondering - "Where's the Bubble Sort?". Well, since Selection Sort always checks all the unsorted for the next item, it has to do just as many comparisons as Bubble Sort does so they are (almost) overlapping - since I used the short-circuiting Bubble Sort if you zoom way, way in you'll see that the Bubble Sort's points are actually usually slighly lower than the Selection Sort's line.
</p>

<p>
I guess the main takeaway is that because the Insertion Sort has an out that lets it short-circuit each inner while-loop it generally will perform better than the other two sorts, although it's still a quadratic sort.
</p>
</div>
</div>

<div id="outline-container-org7b07d74" class="outline-2">
<h2 id="org7b07d74">Sources</h2>
<div class="outline-text-2" id="text-org7b07d74">
<ul class="org-ul">
<li><a href="posts/HTTAA/">How To Think About Algorithms</a></li>
<li><a href="posts/itdaa/">Introduction to the Design &amp; Analysis of Algorithms (Levitin)</a></li>
</ul>
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("insertionsort"));
});
</script>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/bubble-sort-an-archeological-algorithmic-analysis/" class="u-url">Bubble Sort: An Archeological Algorithmic Analysis</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/bubble-sort-an-archeological-algorithmic-analysis/" rel="bookmark">
            <time class="published dt-published" datetime="2021-11-25T16:38:05-08:00" itemprop="datePublished" title="2021-11-25 16:38">2021-11-25 16:38</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="outline-container-orge9fdea0" class="outline-2">
<h2 id="orge9fdea0">Source</h2>
<div class="outline-text-2" id="text-orge9fdea0">
<ul class="org-ul">
<li><a href="https://users.cs.duke.edu/~ola/bubble/bubble.html">HTML Version</a></li>
<li><a href="https://users.cs.duke.edu/~ola/papers/bubble.pdf">Link to PDF</a></li>
</ul>
</div>
</div>
<div id="outline-container-org4283436" class="outline-2">
<h2 id="org4283436">Citation</h2>
<div class="outline-text-2" id="text-org4283436">
<ul class="org-ul">
<li>Astrachan O. Bubble sort: an archaeological algorithmic analysis. SIGCSE Bull. 2003 Jan 11;35(1):1–5.</li>
</ul>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/iterative-algorithms/" class="u-url">Iterative Algorithms</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/iterative-algorithms/" rel="bookmark">
            <time class="published dt-published" datetime="2021-11-23T16:16:37-08:00" itemprop="datePublished" title="2021-11-23 16:16">2021-11-23 16:16</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>
Iterative algorithms are characterized by loops - the word iteration has at <a href="https://www.etymonline.com/word/iteration">at its roots</a> the notion of repetition.
</p>

<div id="outline-container-org8e851e2" class="outline-2">
<h2 id="org8e851e2">The Metaphor</h2>
<div class="outline-text-2" id="text-org8e851e2">
<p>
<a href="posts/iterative-algorithms/#org497377f">HTTAA</a> describes the iterative algorithms as being like a long journey where you can't see the entire route and could possibly take a misstep and fall into a ditch, so you need a way to know that you're making progress as well as a way to know you haven't veered off the road. 
Since we're dealing with repetitions I kind of think a racetrack might make more sense, or at least something that loops, but anyway…
</p>

<p>
There are some basic questions we have to be able to answer to make a successful trip:
</p>

<ul class="org-ul">
<li>How do I get onto the road?</li>
<li>How do I take a step without falling off the road?</li>
<li>How do I know when I've gone far enough?</li>
<li>Once I've gone far enough, how do I get off the road and to my ultimate destination?</li>
</ul>
<p>
Too answer these questions we'll be using some basic parts:
</p>

<ul class="org-ul">
<li>Our starting point is our <b>Preconditions</b> and to get onto the road we need some pre-loop code to set up the <b>Loop-Invariant</b>.</li>
<li>We take a step with our loop-code and keep from falling off the road by maintaining the <b>Loop-Invariant</b>.</li>
<li>We know we've gone far enough when our <b>Exit-Condition</b> is met.</li>
<li>Once we've gone far enough we use some post-loop code to clean up and end up at our <b>Postconditions</b>.</li>
</ul>
<p>
Translating that to mathishness shorthand:
</p>

<ul class="org-ul">
<li>\( \langle \textit{Pre-Conditions} \rangle \land \text{Code}_\textit{Pre-Loop} \Rightarrow \langle \textit{Loop-Invariant} \rangle  \)</li>
<li>\( \langle \textit{Loop-Invariant} \rangle \land \lnot \langle \textit{Exit-Condition} \rangle \land \text{Code}_\textit{Loop} \Rightarrow \langle \textit{Loop-Invariant'} \rangle \)</li>
<li>\( \langle \textit{Loop-Invariant} \rangle \land \langle \textit{Exit-Condition} \rangle \land \text{Code}_\textit{Post-Loop} \Rightarrow \langle \textit{Post-Conditions} \rangle \)</li>
</ul>
</div>
</div>

<div id="outline-container-org113dcc4" class="outline-2">
<h2 id="org113dcc4">Source</h2>
<div class="outline-text-2" id="text-org113dcc4">
<ul class="org-ul">
<li>
<a id="org497377f"></a> <a href="posts/HTTAA/">How To Think About Algorithms</a>
</li>
</ul>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/more-of-the-output/" class="u-url">More of the Output</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/more-of-the-output/" rel="bookmark">
            <time class="published dt-published" datetime="2021-11-23T16:10:58-08:00" itemprop="datePublished" title="2021-11-23 16:10">2021-11-23 16:10</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>
The <i>More of the Output</i> algorithms are <a href="posts/iterative-algorithms/">Iterative Algorithms</a> that are characterized by the fact that after each pass through the loop the output has been added to - so the Measure of Progress is based on the size of the output.
</p>

<div id="outline-container-org924161c" class="outline-2">
<h2 id="org924161c">Source</h2>
<div class="outline-text-2" id="text-org924161c">
<ul class="org-ul">
<li><a href="posts/HTTAA/">How To Think About Algorithms</a></li>
</ul>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/the-sorting-problem/" class="u-url">The Sorting Problem</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/the-sorting-problem/" rel="bookmark">
            <time class="published dt-published" datetime="2021-11-23T15:47:00-08:00" itemprop="datePublished" title="2021-11-23 15:47">2021-11-23 15:47</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="outline-container-orge497d4a" class="outline-2">
<h2 id="orge497d4a">English(ish)</h2>
<div class="outline-text-2" id="text-orge497d4a">
<p>
The sorting problem involves taking a list of things that can be compared to each other to decide their order and then sorting them into ascending order (actually non-decreasing, since you can have multiple items with the same value, but, this was supposed to be the plain-English version).
</p>
</div>
</div>
<div id="outline-container-org4ec345b" class="outline-2">
<h2 id="org4ec345b">Specification</h2>
<div class="outline-text-2" id="text-org4ec345b">
<ul class="org-ul">
<li>
<b>Preconditions:</b> The input is a list of <i>n</i> orderable items, possibly with repetitions.</li>
<li>
<b>Postconditions:</b> The output is a list of the same <i>n</i> items in non-decreasing order.</li>
</ul>
</div>
</div>
<div id="outline-container-org8f14efc" class="outline-2">
<h2 id="org8f14efc">Examples</h2>
<div class="outline-text-2" id="text-org8f14efc">
<ul class="org-ul">
<li><a href="posts/the-bubble-sort/">The Bubble Sort</a></li>
<li><a href="posts/selection-sort/">Selection Sort</a></li>
<li><a href="posts/insertion-sort/">Insertion Sort</a></li>
<li><a href="posts/the-mergesort/">The Mergesort</a></li>
<li><a href="posts/quicksort/">Quicksort</a></li>
<li><a href="posts/max-heap/">Heap!</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgcbdfe84" class="outline-2">
<h2 id="orgcbdfe84">Sources</h2>
<div class="outline-text-2" id="text-orgcbdfe84">
<ul class="org-ul">
<li><a href="posts/HTTAA/">How To Think About Algorithms</a></li>
<li><a href="posts/itdaa/">Introduction to the Design &amp; Analysis of Algorithms (Levitin)</a></li>
</ul>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/selection-sort/" class="u-url">Selection Sort</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/selection-sort/" rel="bookmark">
            <time class="published dt-published" datetime="2021-11-23T15:17:43-08:00" itemprop="datePublished" title="2021-11-23 15:17">2021-11-23 15:17</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li>
<a href="posts/selection-sort/#org9e9dac0">Umm… Selection Sort?</a>
<ul>
<li><a href="posts/selection-sort/#org6e71e74">Imports</a></li>
<li><a href="posts/selection-sort/#org12f5cfa">Set Up</a></li>
</ul>
</li>
<li><a href="posts/selection-sort/#org5f1ca53">Parts of the Algorithm</a></li>
<li><a href="posts/selection-sort/#org9d886ca">The Pseudocode</a></li>
<li>
<a href="posts/selection-sort/#org9234bc5">The Implementations</a>
<ul>
<li>
<a href="posts/selection-sort/#org73cdfc1">Selection Sort</a>
<ul>
<li><a href="posts/selection-sort/#orgc90b181">Some Checks</a></li>
</ul>
</li>
<li><a href="posts/selection-sort/#org31e4043">Run It</a></li>
</ul>
</li>
<li>
<a href="posts/selection-sort/#orgd86491e">Looking at the Swaps</a>
<ul>
<li><a href="posts/selection-sort/#orgb720642">Worst Case</a></li>
</ul>
</li>
<li><a href="posts/selection-sort/#org8ff760a">Sources</a></li>
</ul>
</div>
</div>
<div id="outline-container-org9e9dac0" class="outline-2">
<h2 id="org9e9dac0">Umm… Selection Sort?</h2>
<div class="outline-text-2" id="text-org9e9dac0">
<p>
Yes, this continues the look at Brute-Force Sorting, begun with the <a href="posts/the-bubble-sort/">The Bubble Sort</a>. With the selection sort you repeatedly select the smallest item in the unsorted section of the data and place it at the end of the sorted data until you have sorted all the items. <a href="posts/HTTAA/">How To Think About Algorithms</a> classifies it as a <a href="posts/more-of-the-output/">More of the Output</a> algorithm, one of the types of <a href="posts/iterative-algorithms/">Iterative Algorithms</a>, while <a href="posts/itdaa/">Introduction to the Design &amp; Analysis of Algorithms (Levitin)</a> classifies it as a <b>Brute Force</b> algorithm.
</p>
</div>

<div id="outline-container-org6e71e74" class="outline-3">
<h3 id="org6e71e74">Imports</h3>
<div class="outline-text-3" id="text-org6e71e74">
<div class="highlight"><pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">shuffle</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">njit</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">contain_exactly</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">default_rng</span>

<span class="kn">import</span> <span class="nn">altair</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># this project</span>
<span class="kn">from</span> <span class="nn">bowling.sort.bubble.bubble</span> <span class="kn">import</span> <span class="n">bubble</span>
<span class="kn">from</span> <span class="nn">bowling.sort.selection</span> <span class="kn">import</span> <span class="n">selection_counter</span>
<span class="kn">from</span> <span class="nn">bowling.sort.selection.selection</span> <span class="kn">import</span> <span class="n">selection_swaps</span>

<span class="c1"># my stuff</span>
<span class="kn">from</span> <span class="nn">graeae.visualization.altair_helpers</span> <span class="kn">import</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">save_chart</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">Timer</span>
</pre></div>
</div>
</div>
<div id="outline-container-org12f5cfa" class="outline-3">
<h3 id="org12f5cfa">Set Up</h3>
<div class="outline-text-3" id="text-org12f5cfa">
<div class="highlight"><pre><span></span><span class="n">random</span> <span class="o">=</span> <span class="n">default_rng</span><span class="p">(</span><span class="mi">2021</span><span class="p">)</span>
<span class="n">TIMER</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>

<span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"selection-sort"</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="n">output_path</span><span class="p">(</span><span class="n">SLUG</span><span class="p">)</span>
<span class="n">save_it</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">save_chart</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div id="outline-container-org5f1ca53" class="outline-2">
<h2 id="org5f1ca53">Parts of the Algorithm</h2>
<div class="outline-text-2" id="text-org5f1ca53">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Item</th>
<th scope="col" class="org-left">Answer</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left"><b>Specification</b></td>
<td class="org-left">This is a <a href="posts/the-sorting-problem/">Sorting Problem</a>.</td>
</tr>
<tr>
<td class="org-left"><b>Basic Steps</b></td>
<td class="org-left">We're going to repeatedly select the smallest item in the unselected.</td>
</tr>
<tr>
<td class="org-left"><b>Measure Progress</b></td>
<td class="org-left">We'll know we're progressing by the number of elements we've selected (<i>k</i>).</td>
</tr>
<tr>
<td class="org-left"><b>Loop Invariant</b></td>
<td class="org-left">None of the selected elements is larger than any element in the unselected and the selected items are in sorted order. The unselected items contain the largest elements in the list.</td>
</tr>
<tr>
<td class="org-left">What are the Main Steps?</td>
<td class="org-left">1. Find the smallest unsorted element</td>
</tr>
<tr>
<td class="org-left"> </td>
<td class="org-left">2. Put the selected element at the end of the previously selected element(s)</td>
</tr>
<tr>
<td class="org-left"><b>Making Progress</b></td>
<td class="org-left">The number of selected items (<i>k</i>) always goes up after each loop.</td>
</tr>
<tr>
<td class="org-left"><b>Loop Invariant Maintenance</b></td>
<td class="org-left">- The previous Loop Invariant tells us that all the unselected items were at least as large or larger than the largest of the selected items.</td>
</tr>
<tr>
<td class="org-left"> </td>
<td class="org-left">- We chose the largest item of the unselected so it's as big or bigger than the biggest selected item.</td>
</tr>
<tr>
<td class="org-left"> </td>
<td class="org-left">- Putting the selected item at the end of the previously selected items maintains the Loop Invariant.</td>
</tr>
<tr>
<td class="org-left"><b>Establish the Loop Invariant</b></td>
<td class="org-left">At the start, no items have been selected so the Loop Invariant is vacuously true.</td>
</tr>
<tr>
<td class="org-left"><b>Exit-Condition</b></td>
<td class="org-left">We stop when all the items have been selected.</td>
</tr>
<tr>
<td class="org-left"><b>Ending</b></td>
<td class="org-left">- <i>Exit-Condition</i>: All items have been selected</td>
</tr>
<tr>
<td class="org-left"> </td>
<td class="org-left">- <i>Loop Invariant</i>: All selected are sorted.</td>
</tr>
<tr>
<td class="org-left"> </td>
<td class="org-left">- So our output has all the original items and they are now sorted, satisfying the <i>Postconditions</i>.</td>
</tr>
</tbody>
</table>
<p>
<b>Running Time</b>
</p>

\begin{align}
C(n) &amp;= \sum_{i=0}^{n-2} \sum_{j=i+1}^{n-1} 1\\
     &amp;= \frac{n(n-1)}{2} \in \Theta{n^2}     
\end{align}
</div>
</div>
<div id="outline-container-org9d886ca" class="outline-2">
<h2 id="org9d886ca">The Pseudocode</h2>
<div class="outline-text-2" id="text-org9d886ca">
<pre id="selectionsort" style="display:hidden;">
\begin{algorithm}
\caption{SelectionSort}
\begin{algorithmic}
\INPUT An array of orderable items
\OUTPUT The array sorted in ascending order
\PROCEDURE{SelectionSort}{$A$}
  \FOR{$i \gets 0$ to $n - 2$}
    \STATE $min \gets i$
    \FOR{$j \gets i + 1$ to $n - 1$}
      \IF{$A[j] &lt; A[min]$}
       \STATE $min \gets j$
      \ENDIF
    \ENDFOR
    \STATE Swap $A[i]$ and $A[min]$
  \ENDFOR
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>

<p>
The outer loop (where <i>i</i> is set) tracks the number of items selected so far (which is the same thing as the size of the sorted section at the beginning of the list). The inner loop goes over the remaining, previously unselected, items in the list and looks for the index of the smallest item, it then puts that smallest item at the beginning of the unselected items and moves what was at the beginning to where the smallest item was. Once the swap is done, the sub-list on the left-side of the list is now bigger by one so the outer loop increments and then we search for the next smallest item, and so on until all the items have been selected (except for the last item) and the list is sorted.
</p>
</div>
</div>

<div id="outline-container-org9234bc5" class="outline-2">
<h2 id="org9234bc5">The Implementations</h2>
<div class="outline-text-2" id="text-org9234bc5">
</div>
<div id="outline-container-org73cdfc1" class="outline-3">
<h3 id="org73cdfc1">Selection Sort</h3>
<div class="outline-text-3" id="text-org73cdfc1">
<p>
This will be a straight translation of the pseudocode (or straight-ish).
</p>

<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">MutableSequence</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">SelectionOutput</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">"SelectionOutput"</span><span class="p">,</span>
			     <span class="p">[</span><span class="s2">"element_count"</span><span class="p">,</span>
			      <span class="s2">"comparisons"</span><span class="p">,</span>
			      <span class="s2">"swaps"</span><span class="p">,</span>
			      <span class="s2">"elements"</span><span class="p">])</span>
<span class="n">Swaps</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span>
<span class="n">Sortable</span> <span class="o">=</span> <span class="n">MutableSequence</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">selection_counter</span><span class="p">(</span><span class="n">elements</span><span class="p">:</span> <span class="n">Sortable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SelectionOutput</span><span class="p">:</span>
    <span class="sd">"""Does the selection sort on the elements</span>

<span class="sd">    Args:</span>
<span class="sd">     elements: list of orderable objects</span>

<span class="sd">    Returns:</span>
<span class="sd">     (number of elements, comparisons, swaps)</span>
<span class="sd">    """</span>
    <span class="n">number_of_elements</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
    <span class="n">comparisons</span> <span class="o">=</span> <span class="n">swaps</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">start_of_unselected</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_elements</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
	<span class="n">smallest_unselected</span> <span class="o">=</span> <span class="n">start_of_unselected</span>
	<span class="k">for</span> <span class="n">next_unselected</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_of_unselected</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
				     <span class="n">number_of_elements</span><span class="p">):</span>
	    <span class="n">comparisons</span> <span class="o">+=</span> <span class="mi">1</span>
	    <span class="k">if</span> <span class="n">elements</span><span class="p">[</span><span class="n">next_unselected</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">elements</span><span class="p">[</span><span class="n">smallest_unselected</span><span class="p">]:</span>
		<span class="n">smallest_unselected</span> <span class="o">=</span> <span class="n">next_unselected</span>
	<span class="n">swaps</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="n">elements</span><span class="p">[</span><span class="n">start_of_unselected</span><span class="p">],</span> <span class="n">elements</span><span class="p">[</span><span class="n">smallest_unselected</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
	    <span class="n">elements</span><span class="p">[</span><span class="n">smallest_unselected</span><span class="p">],</span> <span class="n">elements</span><span class="p">[</span><span class="n">start_of_unselected</span><span class="p">]</span>
	<span class="p">)</span>
    <span class="k">return</span> <span class="n">SelectionOutput</span><span class="p">(</span><span class="n">element_count</span><span class="o">=</span><span class="n">number_of_elements</span><span class="p">,</span>
			   <span class="n">comparisons</span><span class="o">=</span><span class="n">comparisons</span><span class="p">,</span>
			   <span class="n">swaps</span><span class="o">=</span><span class="n">swaps</span><span class="p">,</span>
			   <span class="n">elements</span><span class="o">=</span><span class="n">elements</span><span class="p">)</span>
</pre></div>
</div>

<div id="outline-container-orgc90b181" class="outline-4">
<h4 id="orgc90b181">Some Checks</h4>
<div class="outline-text-4" id="text-orgc90b181">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">comparisons</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">swaps</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">"""Check that the sort worked</span>

<span class="sd">    Args:</span>
<span class="sd">     collection: the sorted collection</span>
<span class="sd">     n: number of elements in the collection</span>
<span class="sd">     comparisons: number of comparisons made</span>
<span class="sd">     swaps: number of swaps made</span>

<span class="sd">    Raises:</span>
<span class="sd">     AssertionError: some check didn't match</span>
<span class="sd">    """</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">collection</span><span class="p">)))</span>
    <span class="n">runtime</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">comparisons</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">runtime</span><span class="p">))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">swaps</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">expect</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">collection</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">collection</span><span class="p">))))</span>
    <span class="k">return</span>

<span class="n">test</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">n</span><span class="p">,</span> <span class="n">comparisons</span><span class="p">,</span> <span class="n">swaps</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">selection_counter</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
<span class="n">check</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">comparisons</span><span class="p">,</span> <span class="n">swaps</span><span class="p">)</span>

<span class="n">test</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">n</span><span class="p">,</span> <span class="n">comparisons</span><span class="p">,</span> <span class="n">swaps</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">selection_counter</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
<span class="n">check</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">comparisons</span><span class="p">,</span> <span class="n">swaps</span><span class="p">)</span>

<span class="n">COUNT</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">COUNT</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">COUNT</span><span class="p">)</span>
<span class="n">n</span><span class="p">,</span> <span class="n">comparisons</span><span class="p">,</span> <span class="n">swaps</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">selection_counter</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
<span class="n">check</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">comparisons</span><span class="p">,</span> <span class="n">swaps</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-org31e4043" class="outline-3">
<h3 id="org31e4043">Run It</h3>
<div class="outline-text-3" id="text-org31e4043">
<p>
So, let's see how it does. We'll set the selection sort up as a numba function and set up the things to sort so that we can compare it to the bubble sort.
</p>

<div class="highlight"><pre><span></span><span class="n">numba_selection</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="n">selection_counter</span><span class="p">)</span>
<span class="n">things_to_sort</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>
		  <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)]</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">elements_comparisons_and_swaps</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
	<span class="n">delayed</span><span class="p">(</span><span class="n">numba_selection</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">)</span>
</pre></div>

<pre class="example">
Started: 2022-01-11 00:05:00.866956
Ended: 2022-01-11 00:05:41.085584
Elapsed: 0:00:40.218628
</pre>


<p>
Let's plot the comparisons and swaps.
</p>

<div class="highlight"><pre><span></span><span class="n">SIZE</span><span class="p">,</span> <span class="n">COMPARISONS</span><span class="p">,</span> <span class="n">SWAPS</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
<span class="n">unzipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">elements_comparisons_and_swaps</span><span class="p">))</span>
<span class="n">count_frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"Elements"</span><span class="p">:</span> <span class="n">unzipped</span><span class="p">[</span><span class="n">SIZE</span><span class="p">],</span>
				<span class="s2">"Selection Comparisons"</span><span class="p">:</span> <span class="n">unzipped</span><span class="p">[</span><span class="n">COMPARISONS</span><span class="p">],</span>
				<span class="s2">"Selection Swaps"</span><span class="p">:</span> <span class="n">unzipped</span><span class="p">[</span><span class="n">SWAPS</span><span class="p">]})</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">base</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">count_frame</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span> <span class="o">=</span> <span class="s2">"Elements"</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">comparisons</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Selection Comparisons"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Elements"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Selection Comparisons"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Selection Swaps"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">)]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Selection Sort Comparisons"</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>

<span class="n">swaps</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">mark_point</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">"DarkRed"</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Elements"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Selection Swaps"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Elements"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Selection Comparisons"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Selection Swaps"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">)]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Selection Sort Swaps"</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="p">(</span><span class="n">comparisons</span> <span class="o">&amp;</span> <span class="n">swaps</span><span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"selection-sort-comparisons"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/selection-sort/selection-sort-comparisons.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>

<p>
It's important to note the scale of the y-axes here - when I tried putting the comparisons and swaps on the same plot it was pretty much impossible to see the slope of the swaps, even when zoomed way in. Unlike the Bubble Sort, the Selection Sort's swaps have a linear growth instead of a quadratic growth.
</p>
</div>
</div>
</div>

<div id="outline-container-orgd86491e" class="outline-2">
<h2 id="orgd86491e">Looking at the Swaps</h2>
<div class="outline-text-2" id="text-orgd86491e">
<p>
Here's where it might be a little more interesting. We can do the same exercise we did with the bubble sort and plot the actual swaps to see if we can see the sorting in action.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">selection_swaps</span><span class="p">(</span><span class="n">elements</span><span class="p">:</span> <span class="n">Sortable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Swaps</span><span class="p">:</span>
    <span class="sd">"""Keeps track of the element indexes as they are swapped</span>

<span class="sd">    Args:</span>
<span class="sd">     elements: list of orderable elements</span>

<span class="sd">    Returns:</span>
<span class="sd">     dict mapping element to list of indices where it was in the elements list</span>
<span class="sd">    """</span>
    <span class="n">swaps</span> <span class="o">=</span> <span class="p">{</span><span class="n">element</span><span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elements</span><span class="p">)}</span>

    <span class="n">number_of_elements</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">start_of_unselected</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_elements</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
	<span class="n">smallest_unselected</span> <span class="o">=</span> <span class="n">start_of_unselected</span>

	<span class="k">for</span> <span class="n">next_unselected</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_of_unselected</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
				     <span class="n">number_of_elements</span><span class="p">):</span>
	    <span class="k">if</span> <span class="n">elements</span><span class="p">[</span><span class="n">next_unselected</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">elements</span><span class="p">[</span><span class="n">smallest_unselected</span><span class="p">]:</span>
		<span class="n">smallest_unselected</span> <span class="o">=</span> <span class="n">next_unselected</span>

	<span class="n">elements</span><span class="p">[</span><span class="n">start_of_unselected</span><span class="p">],</span> <span class="n">elements</span><span class="p">[</span><span class="n">smallest_unselected</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
	    <span class="n">elements</span><span class="p">[</span><span class="n">smallest_unselected</span><span class="p">],</span> <span class="n">elements</span><span class="p">[</span><span class="n">start_of_unselected</span><span class="p">]</span>
	<span class="p">)</span>

	<span class="c1"># record the location of the elements</span>
	<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elements</span><span class="p">):</span>
	    <span class="n">swaps</span><span class="p">[</span><span class="n">element</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">swaps</span>
</pre></div>

<p>
Because we're tracking the swaps with a dict there can't be any  repetitions in the inputs, so I'll use python instead of numpy to make the randomized input since it seems clearer to me.
</p>

<div class="highlight"><pre><span></span><span class="n">COUNT</span> <span class="o">=</span> <span class="mi">50</span>

<span class="n">inputs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">COUNT</span><span class="p">))</span>
<span class="n">shuffle</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">swaps</span> <span class="o">=</span> <span class="n">selection_swaps</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

<span class="n">track_frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">swaps</span><span class="p">)</span>
<span class="n">re_indexed</span> <span class="o">=</span> <span class="n">track_frame</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"Swap"</span><span class="p">})</span>
<span class="n">melted</span> <span class="o">=</span> <span class="n">re_indexed</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">var_name</span><span class="o">=</span><span class="s2">"Value To Sort"</span><span class="p">,</span>
			 <span class="n">value_name</span><span class="o">=</span><span class="s2">"Location In Array"</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="s2">"Swap"</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Swap"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Location In Array"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Value To Sort:O"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"Swap"</span><span class="p">,</span> <span class="s2">"Location In Array"</span><span class="p">,</span> <span class="s2">"Value To Sort"</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Selection Sort Swaps"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"selection-sort-swaps"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/selection-sort/selection-sort-swaps.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>


<p>
Since I put in more inputs than I did with the Bubble Sort, the actual swaps aren't so easy to see, here, but the point of this plot is to show the (imaginary) diagonal line running from the bottom left corner up to the upper right. This shows why it's called a "More of the Output" algorithm - with each loop (represented by a "Swap" on the X-axis) one more sorted item is added to the beginning of the list (the bottom of the chart) from the unsorted part (the section above the imaginary diagonal of the chart) until you end up with a sorted list.
</p>

<p>
Since the Selection Sort always checks all the items in the "unsorted" section, the lengths of the lines above the diagonal as they move up and down don't really have a significance, they're just single swaps. What matters more is that the section below the diagonal is "sorted" and when picking the next item the algorithm has to check every element above the diagonal to find the next smallest item.
</p>
</div>

<div id="outline-container-orgb720642" class="outline-3">
<h3 id="orgb720642">Worst Case</h3>
<div class="outline-text-3" id="text-orgb720642">
<div class="highlight"><pre><span></span><span class="n">COUNT</span> <span class="o">=</span> <span class="mi">50</span>

<span class="n">inputs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">COUNT</span><span class="p">)))</span>
<span class="n">swaps</span> <span class="o">=</span> <span class="n">selection_swaps</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

<span class="n">track_frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">swaps</span><span class="p">)</span>
<span class="n">re_indexed</span> <span class="o">=</span> <span class="n">track_frame</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"Swap"</span><span class="p">})</span>
<span class="n">melted</span> <span class="o">=</span> <span class="n">re_indexed</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">var_name</span><span class="o">=</span><span class="s2">"Value To Sort"</span><span class="p">,</span>
			 <span class="n">value_name</span><span class="o">=</span><span class="s2">"Location In Array"</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="s2">"Swap"</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Swap"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Location In Array"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Value To Sort:O"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"Swap"</span><span class="p">,</span> <span class="s2">"Location In Array"</span><span class="p">,</span> <span class="s2">"Value To Sort"</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Selection Sort Locations (Worst Case)"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"selection-sort-locations-worst-case"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/selection-sort/selection-sort-locations-worst-case.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>

<p>
This produces kind of an interesting figure… Since the input list is in exactly the backwards order (from largest element to smallest), and the selection sort traverses the list from start to end and swaps out each element with the smallest element to the right of the current element, we are always swapping out the largest element remaining for the smallest remaining element, so although the algorithm doesn't specifically try to do it, it's putting both the smallest unsorted element in place and the largest unsorted element in place with each swap, so it's actually done sorting at the halfway point. We could, then create a short-circuit version of this as well, to make it quit if there's no element in the unsorted smaller than the elements sorted so far, but as with the bubble sort, this would most-likely only help in outside cases like these.
</p>
</div>
</div>
</div>

<div id="outline-container-org8ff760a" class="outline-2">
<h2 id="org8ff760a">Sources</h2>
<div class="outline-text-2" id="text-org8ff760a">
<ul class="org-ul">
<li><a href="posts/HTTAA/">How To Think About Algorithms</a></li>
<li><a href="posts/itdaa/">Introduction to the Design &amp; Analysis of Algorithms (Levitin)</a></li>
</ul>
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("selectionsort"));
});
</script>
</div>
</div>
    </div>
    </article>
</div>

        <ul class="pager postindexpager clearfix">
<li class="previous"><a href="index-3.html" rel="prev">Newer posts</a></li>
            <li class="next"><a href="index-1.html" rel="next">Older posts</a></li>
        </ul>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
             MathJax.Hub.Config({
               tex2jax: {
                 inlineMath: [['$','$'], ['\\(','\\)']],
                 displayMath: [['$$','$$'], ['\\[','\\]']],
                 processEscapes: true,
                 processEnvironments: true,
               },
               displayAlign: 'center',
               "HTML-CSS": {
                 styles: {'.MathJax_Display': {"margin": 0}}
               }
             });
            </script><script src="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.js"></script><!--End of body content--><footer id="footer"><a href="mailto:cloisteredmonkey.jmark@slmail.me">The Cloistered Monkey</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
 <img alt="Creative Commons License BY-NC-SA" style="border-width:0; margin-bottom:12px;" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"></a>
            
            
        </footer>
</div>
</div>


        <script src="assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
