<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Striking out for data.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Bowling For Data (old posts, page 1) | Bowling For Data</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="rss.xml">
<link rel="canonical" href="https://necromuralist.github.io/Bowling-For-Data/index-1.html">
<link rel="prev" href="index-2.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.css">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-light
bg-light
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href=".">

            <span id="blog-title">Bowling For Data</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="categories/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="rss.xml" class="nav-link">RSS feed</a>

                
            </li>
</ul>
<!-- DuckDuckGo custom search --><form method="get" id="search" action="https://duckduckgo.com/" class="navbar-form pull-left">
 <input type="hidden" name="sites" value="https://necromuralist.github.io/Bowling-For-Data/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="Search…" class="span2" style="margin-top: 4px;"><input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
</form>
 <!-- End of custom search -->
 

            <ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/selection-sort/" class="u-url">Selection Sort</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/selection-sort/" rel="bookmark">
            <time class="published dt-published" datetime="2021-11-23T15:17:43-08:00" itemprop="datePublished" title="2021-11-23 15:17">2021-11-23 15:17</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li>
<a href="posts/selection-sort/#org9e9dac0">Umm… Selection Sort?</a>
<ul>
<li><a href="posts/selection-sort/#org6e71e74">Imports</a></li>
<li><a href="posts/selection-sort/#org12f5cfa">Set Up</a></li>
</ul>
</li>
<li><a href="posts/selection-sort/#org5f1ca53">Parts of the Algorithm</a></li>
<li><a href="posts/selection-sort/#org9d886ca">The Pseudocode</a></li>
<li>
<a href="posts/selection-sort/#org9234bc5">The Implementations</a>
<ul>
<li>
<a href="posts/selection-sort/#org73cdfc1">Selection Sort</a>
<ul>
<li><a href="posts/selection-sort/#orgc90b181">Some Checks</a></li>
</ul>
</li>
<li><a href="posts/selection-sort/#org31e4043">Run It</a></li>
</ul>
</li>
<li>
<a href="posts/selection-sort/#orgd86491e">Looking at the Swaps</a>
<ul>
<li><a href="posts/selection-sort/#orgb720642">Worst Case</a></li>
</ul>
</li>
<li><a href="posts/selection-sort/#org8ff760a">Sources</a></li>
</ul>
</div>
</div>
<div id="outline-container-org9e9dac0" class="outline-2">
<h2 id="org9e9dac0">Umm… Selection Sort?</h2>
<div class="outline-text-2" id="text-org9e9dac0">
<p>
Yes, this continues the look at Brute-Force Sorting, begun with the <a href="posts/the-bubble-sort/">The Bubble Sort</a>. With the selection sort you repeatedly select the smallest item in the unsorted section of the data and place it at the end of the sorted data until you have sorted all the items. <a href="posts/HTTAA/">How To Think About Algorithms</a> classifies it as a <a href="posts/more-of-the-output/">More of the Output</a> algorithm, one of the types of <a href="posts/iterative-algorithms/">Iterative Algorithms</a>, while <a href="posts/itdaa/">Introduction to the Design &amp; Analysis of Algorithms (Levitin)</a> classifies it as a <b>Brute Force</b> algorithm.
</p>
</div>

<div id="outline-container-org6e71e74" class="outline-3">
<h3 id="org6e71e74">Imports</h3>
<div class="outline-text-3" id="text-org6e71e74">
<div class="highlight"><pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">shuffle</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">njit</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">contain_exactly</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">default_rng</span>

<span class="kn">import</span> <span class="nn">altair</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># this project</span>
<span class="kn">from</span> <span class="nn">bowling.sort.bubble.bubble</span> <span class="kn">import</span> <span class="n">bubble</span>
<span class="kn">from</span> <span class="nn">bowling.sort.selection</span> <span class="kn">import</span> <span class="n">selection_counter</span>
<span class="kn">from</span> <span class="nn">bowling.sort.selection.selection</span> <span class="kn">import</span> <span class="n">selection_swaps</span>

<span class="c1"># my stuff</span>
<span class="kn">from</span> <span class="nn">graeae.visualization.altair_helpers</span> <span class="kn">import</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">save_chart</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">Timer</span>
</pre></div>
</div>
</div>
<div id="outline-container-org12f5cfa" class="outline-3">
<h3 id="org12f5cfa">Set Up</h3>
<div class="outline-text-3" id="text-org12f5cfa">
<div class="highlight"><pre><span></span><span class="n">random</span> <span class="o">=</span> <span class="n">default_rng</span><span class="p">(</span><span class="mi">2021</span><span class="p">)</span>
<span class="n">TIMER</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>

<span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"selection-sort"</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="n">output_path</span><span class="p">(</span><span class="n">SLUG</span><span class="p">)</span>
<span class="n">save_it</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">save_chart</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div id="outline-container-org5f1ca53" class="outline-2">
<h2 id="org5f1ca53">Parts of the Algorithm</h2>
<div class="outline-text-2" id="text-org5f1ca53">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup>
<col class="org-left">
<col class="org-left">
</colgroup>
<thead><tr>
<th scope="col" class="org-left">Item</th>
<th scope="col" class="org-left">Answer</th>
</tr></thead>
<tbody>
<tr>
<td class="org-left"><b>Specification</b></td>
<td class="org-left">This is a <a href="posts/the-sorting-problem/">Sorting Problem</a>.</td>
</tr>
<tr>
<td class="org-left"><b>Basic Steps</b></td>
<td class="org-left">We're going to repeatedly select the smallest item in the unselected.</td>
</tr>
<tr>
<td class="org-left"><b>Measure Progress</b></td>
<td class="org-left">We'll know we're progressing by the number of elements we've selected (<i>k</i>).</td>
</tr>
<tr>
<td class="org-left"><b>Loop Invariant</b></td>
<td class="org-left">None of the selected elements is larger than any element in the unselected and the selected items are in sorted order. The unselected items contain the largest elements in the list.</td>
</tr>
<tr>
<td class="org-left">What are the Main Steps?</td>
<td class="org-left">1. Find the smallest unsorted element</td>
</tr>
<tr>
<td class="org-left"> </td>
<td class="org-left">2. Put the selected element at the end of the previously selected element(s)</td>
</tr>
<tr>
<td class="org-left"><b>Making Progress</b></td>
<td class="org-left">The number of selected items (<i>k</i>) always goes up after each loop.</td>
</tr>
<tr>
<td class="org-left"><b>Loop Invariant Maintenance</b></td>
<td class="org-left">- The previous Loop Invariant tells us that all the unselected items were at least as large or larger than the largest of the selected items.</td>
</tr>
<tr>
<td class="org-left"> </td>
<td class="org-left">- We chose the largest item of the unselected so it's as big or bigger than the biggest selected item.</td>
</tr>
<tr>
<td class="org-left"> </td>
<td class="org-left">- Putting the selected item at the end of the previously selected items maintains the Loop Invariant.</td>
</tr>
<tr>
<td class="org-left"><b>Establish the Loop Invariant</b></td>
<td class="org-left">At the start, no items have been selected so the Loop Invariant is vacuously true.</td>
</tr>
<tr>
<td class="org-left"><b>Exit-Condition</b></td>
<td class="org-left">We stop when all the items have been selected.</td>
</tr>
<tr>
<td class="org-left"><b>Ending</b></td>
<td class="org-left">- <i>Exit-Condition</i>: All items have been selected</td>
</tr>
<tr>
<td class="org-left"> </td>
<td class="org-left">- <i>Loop Invariant</i>: All selected are sorted.</td>
</tr>
<tr>
<td class="org-left"> </td>
<td class="org-left">- So our output has all the original items and they are now sorted, satisfying the <i>Postconditions</i>.</td>
</tr>
</tbody>
</table>
<p>
<b>Running Time</b>
</p>

\begin{align}
C(n) &amp;= \sum_{i=0}^{n-2} \sum_{j=i+1}^{n-1} 1\\
     &amp;= \frac{n(n-1)}{2} \in \Theta{n^2}     
\end{align}
</div>
</div>
<div id="outline-container-org9d886ca" class="outline-2">
<h2 id="org9d886ca">The Pseudocode</h2>
<div class="outline-text-2" id="text-org9d886ca">
<pre id="selectionsort" style="display:hidden;">
\begin{algorithm}
\caption{SelectionSort}
\begin{algorithmic}
\INPUT An array of orderable items
\OUTPUT The array sorted in ascending order
\PROCEDURE{SelectionSort}{$A$}
  \FOR{$i \gets 0$ to $n - 2$}
    \STATE $min \gets i$
    \FOR{$j \gets i + 1$ to $n - 1$}
      \IF{$A[j] &lt; A[min]$}
       \STATE $min \gets j$
      \ENDIF
    \ENDFOR
    \STATE Swap $A[i]$ and $A[min]$
  \ENDFOR
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>

<p>
The outer loop (where <i>i</i> is set) tracks the number of items selected so far (which is the same thing as the size of the sorted section at the beginning of the list). The inner loop goes over the remaining, previously unselected, items in the list and looks for the index of the smallest item, it then puts that smallest item at the beginning of the unselected items and moves what was at the beginning to where the smallest item was. Once the swap is done, the sub-list on the left-side of the list is now bigger by one so the outer loop increments and then we search for the next smallest item, and so on until all the items have been selected (except for the last item) and the list is sorted.
</p>
</div>
</div>

<div id="outline-container-org9234bc5" class="outline-2">
<h2 id="org9234bc5">The Implementations</h2>
<div class="outline-text-2" id="text-org9234bc5">
</div>
<div id="outline-container-org73cdfc1" class="outline-3">
<h3 id="org73cdfc1">Selection Sort</h3>
<div class="outline-text-3" id="text-org73cdfc1">
<p>
This will be a straight translation of the pseudocode (or straight-ish).
</p>

<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">MutableSequence</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">SelectionOutput</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">"SelectionOutput"</span><span class="p">,</span>
			     <span class="p">[</span><span class="s2">"element_count"</span><span class="p">,</span>
			      <span class="s2">"comparisons"</span><span class="p">,</span>
			      <span class="s2">"swaps"</span><span class="p">,</span>
			      <span class="s2">"elements"</span><span class="p">])</span>
<span class="n">Swaps</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span>
<span class="n">Sortable</span> <span class="o">=</span> <span class="n">MutableSequence</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">selection_counter</span><span class="p">(</span><span class="n">elements</span><span class="p">:</span> <span class="n">Sortable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SelectionOutput</span><span class="p">:</span>
    <span class="sd">"""Does the selection sort on the elements</span>

<span class="sd">    Args:</span>
<span class="sd">     elements: list of orderable objects</span>

<span class="sd">    Returns:</span>
<span class="sd">     (number of elements, comparisons, swaps)</span>
<span class="sd">    """</span>
    <span class="n">number_of_elements</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
    <span class="n">comparisons</span> <span class="o">=</span> <span class="n">swaps</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">start_of_unselected</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_elements</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
	<span class="n">smallest_unselected</span> <span class="o">=</span> <span class="n">start_of_unselected</span>
	<span class="k">for</span> <span class="n">next_unselected</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_of_unselected</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
				     <span class="n">number_of_elements</span><span class="p">):</span>
	    <span class="n">comparisons</span> <span class="o">+=</span> <span class="mi">1</span>
	    <span class="k">if</span> <span class="n">elements</span><span class="p">[</span><span class="n">next_unselected</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">elements</span><span class="p">[</span><span class="n">smallest_unselected</span><span class="p">]:</span>
		<span class="n">smallest_unselected</span> <span class="o">=</span> <span class="n">next_unselected</span>
	<span class="n">swaps</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="n">elements</span><span class="p">[</span><span class="n">start_of_unselected</span><span class="p">],</span> <span class="n">elements</span><span class="p">[</span><span class="n">smallest_unselected</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
	    <span class="n">elements</span><span class="p">[</span><span class="n">smallest_unselected</span><span class="p">],</span> <span class="n">elements</span><span class="p">[</span><span class="n">start_of_unselected</span><span class="p">]</span>
	<span class="p">)</span>
    <span class="k">return</span> <span class="n">SelectionOutput</span><span class="p">(</span><span class="n">element_count</span><span class="o">=</span><span class="n">number_of_elements</span><span class="p">,</span>
			   <span class="n">comparisons</span><span class="o">=</span><span class="n">comparisons</span><span class="p">,</span>
			   <span class="n">swaps</span><span class="o">=</span><span class="n">swaps</span><span class="p">,</span>
			   <span class="n">elements</span><span class="o">=</span><span class="n">elements</span><span class="p">)</span>
</pre></div>
</div>

<div id="outline-container-orgc90b181" class="outline-4">
<h4 id="orgc90b181">Some Checks</h4>
<div class="outline-text-4" id="text-orgc90b181">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="n">collection</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">comparisons</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">swaps</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">"""Check that the sort worked</span>

<span class="sd">    Args:</span>
<span class="sd">     collection: the sorted collection</span>
<span class="sd">     n: number of elements in the collection</span>
<span class="sd">     comparisons: number of comparisons made</span>
<span class="sd">     swaps: number of swaps made</span>

<span class="sd">    Raises:</span>
<span class="sd">     AssertionError: some check didn't match</span>
<span class="sd">    """</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">collection</span><span class="p">)))</span>
    <span class="n">runtime</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">comparisons</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">runtime</span><span class="p">))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">swaps</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">expect</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">collection</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">collection</span><span class="p">))))</span>
    <span class="k">return</span>

<span class="n">test</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">n</span><span class="p">,</span> <span class="n">comparisons</span><span class="p">,</span> <span class="n">swaps</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">selection_counter</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
<span class="n">check</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">comparisons</span><span class="p">,</span> <span class="n">swaps</span><span class="p">)</span>

<span class="n">test</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">n</span><span class="p">,</span> <span class="n">comparisons</span><span class="p">,</span> <span class="n">swaps</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">selection_counter</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
<span class="n">check</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">comparisons</span><span class="p">,</span> <span class="n">swaps</span><span class="p">)</span>

<span class="n">COUNT</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">COUNT</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">COUNT</span><span class="p">)</span>
<span class="n">n</span><span class="p">,</span> <span class="n">comparisons</span><span class="p">,</span> <span class="n">swaps</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">selection_counter</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
<span class="n">check</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">comparisons</span><span class="p">,</span> <span class="n">swaps</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-org31e4043" class="outline-3">
<h3 id="org31e4043">Run It</h3>
<div class="outline-text-3" id="text-org31e4043">
<p>
So, let's see how it does. We'll set the selection sort up as a numba function and set up the things to sort so that we can compare it to the bubble sort.
</p>

<div class="highlight"><pre><span></span><span class="n">numba_selection</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="n">selection_counter</span><span class="p">)</span>
<span class="n">things_to_sort</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>
		  <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)]</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">elements_comparisons_and_swaps</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
	<span class="n">delayed</span><span class="p">(</span><span class="n">numba_selection</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">)</span>
</pre></div>

<pre class="example">
Started: 2022-01-11 00:05:00.866956
Ended: 2022-01-11 00:05:41.085584
Elapsed: 0:00:40.218628
</pre>


<p>
Let's plot the comparisons and swaps.
</p>

<div class="highlight"><pre><span></span><span class="n">SIZE</span><span class="p">,</span> <span class="n">COMPARISONS</span><span class="p">,</span> <span class="n">SWAPS</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
<span class="n">unzipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">elements_comparisons_and_swaps</span><span class="p">))</span>
<span class="n">count_frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"Elements"</span><span class="p">:</span> <span class="n">unzipped</span><span class="p">[</span><span class="n">SIZE</span><span class="p">],</span>
				<span class="s2">"Selection Comparisons"</span><span class="p">:</span> <span class="n">unzipped</span><span class="p">[</span><span class="n">COMPARISONS</span><span class="p">],</span>
				<span class="s2">"Selection Swaps"</span><span class="p">:</span> <span class="n">unzipped</span><span class="p">[</span><span class="n">SWAPS</span><span class="p">]})</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">base</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">count_frame</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span> <span class="o">=</span> <span class="s2">"Elements"</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">comparisons</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Selection Comparisons"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Elements"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Selection Comparisons"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Selection Swaps"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">)]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Selection Sort Comparisons"</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>

<span class="n">swaps</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">mark_point</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">"DarkRed"</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Elements"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Selection Swaps"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Elements"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Selection Comparisons"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Selection Swaps"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">)]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Selection Sort Swaps"</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="p">(</span><span class="n">comparisons</span> <span class="o">&amp;</span> <span class="n">swaps</span><span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"selection-sort-comparisons"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/selection-sort/selection-sort-comparisons.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>

<p>
It's important to note the scale of the y-axes here - when I tried putting the comparisons and swaps on the same plot it was pretty much impossible to see the slope of the swaps, even when zoomed way in. Unlike the Bubble Sort, the Selection Sort's swaps have a linear growth instead of a quadratic growth.
</p>
</div>
</div>
</div>

<div id="outline-container-orgd86491e" class="outline-2">
<h2 id="orgd86491e">Looking at the Swaps</h2>
<div class="outline-text-2" id="text-orgd86491e">
<p>
Here's where it might be a little more interesting. We can do the same exercise we did with the bubble sort and plot the actual swaps to see if we can see the sorting in action.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">selection_swaps</span><span class="p">(</span><span class="n">elements</span><span class="p">:</span> <span class="n">Sortable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Swaps</span><span class="p">:</span>
    <span class="sd">"""Keeps track of the element indexes as they are swapped</span>

<span class="sd">    Args:</span>
<span class="sd">     elements: list of orderable elements</span>

<span class="sd">    Returns:</span>
<span class="sd">     dict mapping element to list of indices where it was in the elements list</span>
<span class="sd">    """</span>
    <span class="n">swaps</span> <span class="o">=</span> <span class="p">{</span><span class="n">element</span><span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elements</span><span class="p">)}</span>

    <span class="n">number_of_elements</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">start_of_unselected</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_elements</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
	<span class="n">smallest_unselected</span> <span class="o">=</span> <span class="n">start_of_unselected</span>

	<span class="k">for</span> <span class="n">next_unselected</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_of_unselected</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
				     <span class="n">number_of_elements</span><span class="p">):</span>
	    <span class="k">if</span> <span class="n">elements</span><span class="p">[</span><span class="n">next_unselected</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">elements</span><span class="p">[</span><span class="n">smallest_unselected</span><span class="p">]:</span>
		<span class="n">smallest_unselected</span> <span class="o">=</span> <span class="n">next_unselected</span>

	<span class="n">elements</span><span class="p">[</span><span class="n">start_of_unselected</span><span class="p">],</span> <span class="n">elements</span><span class="p">[</span><span class="n">smallest_unselected</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
	    <span class="n">elements</span><span class="p">[</span><span class="n">smallest_unselected</span><span class="p">],</span> <span class="n">elements</span><span class="p">[</span><span class="n">start_of_unselected</span><span class="p">]</span>
	<span class="p">)</span>

	<span class="c1"># record the location of the elements</span>
	<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elements</span><span class="p">):</span>
	    <span class="n">swaps</span><span class="p">[</span><span class="n">element</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">swaps</span>
</pre></div>

<p>
Because we're tracking the swaps with a dict there can't be any  repetitions in the inputs, so I'll use python instead of numpy to make the randomized input since it seems clearer to me.
</p>

<div class="highlight"><pre><span></span><span class="n">COUNT</span> <span class="o">=</span> <span class="mi">50</span>

<span class="n">inputs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">COUNT</span><span class="p">))</span>
<span class="n">shuffle</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">swaps</span> <span class="o">=</span> <span class="n">selection_swaps</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

<span class="n">track_frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">swaps</span><span class="p">)</span>
<span class="n">re_indexed</span> <span class="o">=</span> <span class="n">track_frame</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"Swap"</span><span class="p">})</span>
<span class="n">melted</span> <span class="o">=</span> <span class="n">re_indexed</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">var_name</span><span class="o">=</span><span class="s2">"Value To Sort"</span><span class="p">,</span>
			 <span class="n">value_name</span><span class="o">=</span><span class="s2">"Location In Array"</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="s2">"Swap"</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Swap"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Location In Array"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Value To Sort:O"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"Swap"</span><span class="p">,</span> <span class="s2">"Location In Array"</span><span class="p">,</span> <span class="s2">"Value To Sort"</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Selection Sort Swaps"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"selection-sort-swaps"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/selection-sort/selection-sort-swaps.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>


<p>
Since I put in more inputs than I did with the Bubble Sort, the actual swaps aren't so easy to see, here, but the point of this plot is to show the (imaginary) diagonal line running from the bottom left corner up to the upper right. This shows why it's called a "More of the Output" algorithm - with each loop (represented by a "Swap" on the X-axis) one more sorted item is added to the beginning of the list (the bottom of the chart) from the unsorted part (the section above the imaginary diagonal of the chart) until you end up with a sorted list.
</p>

<p>
Since the Selection Sort always checks all the items in the "unsorted" section, the lengths of the lines above the diagonal as they move up and down don't really have a significance, they're just single swaps. What matters more is that the section below the diagonal is "sorted" and when picking the next item the algorithm has to check every element above the diagonal to find the next smallest item.
</p>
</div>

<div id="outline-container-orgb720642" class="outline-3">
<h3 id="orgb720642">Worst Case</h3>
<div class="outline-text-3" id="text-orgb720642">
<div class="highlight"><pre><span></span><span class="n">COUNT</span> <span class="o">=</span> <span class="mi">50</span>

<span class="n">inputs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">COUNT</span><span class="p">)))</span>
<span class="n">swaps</span> <span class="o">=</span> <span class="n">selection_swaps</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

<span class="n">track_frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">swaps</span><span class="p">)</span>
<span class="n">re_indexed</span> <span class="o">=</span> <span class="n">track_frame</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"Swap"</span><span class="p">})</span>
<span class="n">melted</span> <span class="o">=</span> <span class="n">re_indexed</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">var_name</span><span class="o">=</span><span class="s2">"Value To Sort"</span><span class="p">,</span>
			 <span class="n">value_name</span><span class="o">=</span><span class="s2">"Location In Array"</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="s2">"Swap"</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Swap"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Location In Array"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Value To Sort:O"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"Swap"</span><span class="p">,</span> <span class="s2">"Location In Array"</span><span class="p">,</span> <span class="s2">"Value To Sort"</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Selection Sort Locations (Worst Case)"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"selection-sort-locations-worst-case"</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/selection-sort/selection-sort-locations-worst-case.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>

<p>
This produces kind of an interesting figure… Since the input list is in exactly the backwards order (from largest element to smallest), and the selection sort traverses the list from start to end and swaps out each element with the smallest element to the right of the current element, we are always swapping out the largest element remaining for the smallest remaining element, so although the algorithm doesn't specifically try to do it, it's putting both the smallest unsorted element in place and the largest unsorted element in place with each swap, so it's actually done sorting at the halfway point. We could, then create a short-circuit version of this as well, to make it quit if there's no element in the unsorted smaller than the elements sorted so far, but as with the bubble sort, this would most-likely only help in outside cases like these.
</p>
</div>
</div>
</div>

<div id="outline-container-org8ff760a" class="outline-2">
<h2 id="org8ff760a">Sources</h2>
<div class="outline-text-2" id="text-org8ff760a">
<ul class="org-ul">
<li><a href="posts/HTTAA/">How To Think About Algorithms</a></li>
<li><a href="posts/itdaa/">Introduction to the Design &amp; Analysis of Algorithms (Levitin)</a></li>
</ul>
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("selectionsort"));
});
</script>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/double-bubble-sort/" class="u-url">Bubble-Sort Revisited</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/double-bubble-sort/" rel="bookmark">
            <time class="published dt-published" datetime="2021-11-19T17:14:43-08:00" itemprop="datePublished" title="2021-11-19 17:14">2021-11-19 17:14</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li>
<a href="posts/double-bubble-sort/#org8247f95">In the Beginning</a>
<ul>
<li>
<a href="posts/double-bubble-sort/#org79f0780">Some Setup</a>
<ul>
<li><a href="posts/double-bubble-sort/#org154467b">Imports</a></li>
<li><a href="posts/double-bubble-sort/#orge15fb2c">Stuff For Later</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="posts/double-bubble-sort/#orgf8b4fba">The Sorters</a>
<ul>
<li>
<a href="posts/double-bubble-sort/#org8a0a5c2">Bubba Sort</a>
<ul>
<li><a href="posts/double-bubble-sort/#orgcc87480">Bubba</a></li>
<li><a href="posts/double-bubble-sort/#org1cfc61a">Bubble</a></li>
<li><a href="posts/double-bubble-sort/#orgd2fb889">Test It Out</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="posts/double-bubble-sort/#org92e58aa">Counting Comparisons</a>
<ul>
<li><a href="posts/double-bubble-sort/#org66a9c87">Set Up Numba</a></li>
<li><a href="posts/double-bubble-sort/#org37d9c94">Run The Bubble Counter</a></li>
<li><a href="posts/double-bubble-sort/#org18439a7">Run the Bubba Counter</a></li>
<li><a href="posts/double-bubble-sort/#org1b7a66c">Best Case, Worst Case</a></li>
</ul>
</li>
<li><a href="posts/double-bubble-sort/#org28c342a">The End, The End</a></li>
</ul>
</div>
</div>
<p>
This is a continuation of a <a href="posts/the-bubble-sort/">series on the Bubble Sort</a>.
</p>

<div id="outline-container-org8247f95" class="outline-2">
<h2 id="org8247f95">In the Beginning</h2>
<div class="outline-text-2" id="text-org8247f95">
<p>
In the <a href="posts/bubble-sort-an-empirical-look/">previous bubble sort post</a> I implemented the basic bubble sort, but there is a variation of it where you short-circuit the search if the collection is already sorted which is what I'll look at here. The short-circuiting means that the bubble sort can sometimes do better than other methods, but only when the data is mostly sorted so it's still not a practical algorithm.
Why do this, then? Eh,  why not?
</p>
</div>

<div id="outline-container-org79f0780" class="outline-3">
<h3 id="org79f0780">Some Setup</h3>
<div class="outline-text-3" id="text-org79f0780">
</div>
<div id="outline-container-org154467b" class="outline-4">
<h4 id="org154467b">Imports</h4>
<div class="outline-text-4" id="text-org154467b">
<div class="highlight"><pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="c1"># pypi</span>
<span class="c1"># from bokeh.models import HoverTool</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">be_below</span><span class="p">,</span> <span class="n">contain_exactly</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">njit</span>
<span class="kn">from</span> <span class="nn">numba.typed</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">default_rng</span>

<span class="kn">import</span> <span class="nn">altair</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># this project</span>
<span class="kn">from</span> <span class="nn">graeae.visualization.altair_helpers</span> <span class="kn">import</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">save_chart</span>
<span class="kn">from</span> <span class="nn">bowling.sort.bubble</span> <span class="kn">import</span> <span class="n">bubble</span><span class="p">,</span> <span class="n">BubbleOutput</span>

<span class="c1"># my other stuff</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">Timer</span>
</pre></div>
</div>
</div>

<div id="outline-container-orge15fb2c" class="outline-4">
<h4 id="orge15fb2c">Stuff For Later</h4>
<div class="outline-text-4" id="text-orge15fb2c">
<div class="highlight"><pre><span></span><span class="n">TIMER</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
<span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"double-bubble-sort"</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="n">output_path</span><span class="p">(</span><span class="n">SLUG</span><span class="p">)</span>
<span class="n">random</span> <span class="o">=</span> <span class="n">default_rng</span><span class="p">(</span><span class="mi">2021</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div id="outline-container-orgf8b4fba" class="outline-2">
<h2 id="orgf8b4fba">The Sorters</h2>
<div class="outline-text-2" id="text-orgf8b4fba">
</div>
<div id="outline-container-org8a0a5c2" class="outline-3">
<h3 id="org8a0a5c2">Bubba Sort</h3>
<div class="outline-text-3" id="text-org8a0a5c2">
<p>
This will be the short-circuiting version of the bubble sort.
</p>
</div>

<div id="outline-container-orgcc87480" class="outline-4">
<h4 id="orgcc87480">Bubba</h4>
<div class="outline-text-4" id="text-orgcc87480">
<p>
This is the short-circuiter. It works pretty much the same way with just an extra if-statement to break out of the loop if nothing was swapped.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">bubba</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BubbleOutput</span><span class="p">:</span>
    <span class="sd">"""Sorts the list in place</span>

<span class="sd">    Args:</span>
<span class="sd">     elements: list of (in-place) sortable elements</span>

<span class="sd">    Returns:</span>
<span class="sd">     number of elements, count of comparisons</span>
<span class="sd">    """</span>
    <span class="n">all_but_one</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">comparisons</span> <span class="o">=</span> <span class="n">swaps</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">items_sorted</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">all_but_one</span><span class="p">):</span>
	<span class="n">swapped_at_least_once</span> <span class="o">=</span> <span class="kc">False</span>
	<span class="k">for</span> <span class="n">in_front_of_us</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">all_but_one</span> <span class="o">-</span> <span class="n">items_sorted</span><span class="p">):</span>
	    <span class="n">comparisons</span> <span class="o">+=</span> <span class="mi">1</span>
	    <span class="n">to_the_right</span> <span class="o">=</span> <span class="n">in_front_of_us</span> <span class="o">+</span> <span class="mi">1</span>
	    <span class="k">if</span> <span class="n">elements</span><span class="p">[</span><span class="n">to_the_right</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">elements</span><span class="p">[</span><span class="n">in_front_of_us</span><span class="p">]:</span>
		<span class="p">(</span><span class="n">elements</span><span class="p">[</span><span class="n">in_front_of_us</span><span class="p">],</span>
		 <span class="n">elements</span><span class="p">[</span><span class="n">to_the_right</span><span class="p">])</span> <span class="o">=</span> <span class="p">(</span><span class="n">elements</span><span class="p">[</span><span class="n">to_the_right</span><span class="p">],</span>
					  <span class="n">elements</span><span class="p">[</span><span class="n">in_front_of_us</span><span class="p">])</span>
		<span class="n">swapped_at_least_once</span> <span class="o">=</span> <span class="kc">True</span>
		<span class="n">swaps</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">swapped_at_least_once</span><span class="p">:</span>
	    <span class="k">break</span>
    <span class="k">return</span> <span class="n">BubbleOutput</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">),</span> <span class="n">comparisons</span><span class="p">,</span> <span class="n">swaps</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div id="outline-container-org1cfc61a" class="outline-4">
<h4 id="org1cfc61a">Bubble</h4>
<div class="outline-text-4" id="text-org1cfc61a">
<p>
I showed how I implement the bubble sort in the <a href="posts/bubble-sort-an-empirical-look/">previous bubble sort post</a> so, since I imported it up above, I'm just going to run it.
</p>
</div>
</div>
<div id="outline-container-orgd2fb889" class="outline-4">
<h4 id="orgd2fb889">Test It Out</h4>
<div class="outline-text-4" id="text-orgd2fb889">
<p>
Once again, let's just make sure everything works.
</p>

<div class="highlight"><pre><span></span><span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>

<span class="n">expected</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">inputs</span><span class="p">))</span>

<span class="n">test_1</span><span class="p">,</span> <span class="n">test_2</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">inputs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">bubba_output</span> <span class="o">=</span> <span class="n">bubba</span><span class="p">(</span><span class="n">test_1</span><span class="p">)</span>
<span class="n">original_output</span> <span class="o">=</span> <span class="n">bubble</span><span class="p">(</span><span class="n">test_2</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">test_1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">test_2</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>

<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">worst</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span>
<span class="n">expect</span><span class="p">(</span><span class="n">bubba_output</span><span class="o">.</span><span class="n">comparisons</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_below</span><span class="p">(</span><span class="n">worst</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">bubba_output</span><span class="o">.</span><span class="n">comparisons</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">15</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">bubba_output</span><span class="o">.</span><span class="n">swaps</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">original_output</span><span class="o">.</span><span class="n">swaps</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">original_output</span><span class="o">.</span><span class="n">comparisons</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">worst</span><span class="p">))</span>

<span class="c1"># try a bigger input</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)),</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">expected</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">inputs</span><span class="p">))</span>

<span class="n">test_1</span><span class="p">,</span> <span class="n">test_2</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">inputs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">bubba_output</span> <span class="o">=</span> <span class="n">bubba</span><span class="p">(</span><span class="n">test_1</span><span class="p">)</span>
<span class="n">original_output</span> <span class="o">=</span> <span class="n">bubble</span><span class="p">(</span><span class="n">test_2</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">test_1</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">test_2</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="n">expected</span><span class="p">))</span>

<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">worst</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span>
<span class="n">expect</span><span class="p">(</span><span class="n">bubba_output</span><span class="o">.</span><span class="n">comparisons</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_below</span><span class="p">(</span><span class="n">worst</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">original_output</span><span class="o">.</span><span class="n">comparisons</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">worst</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">bubba_output</span><span class="o">.</span><span class="n">swaps</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">original_output</span><span class="o">.</span><span class="n">swaps</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">original_output</span><span class="o">.</span><span class="n">comparisons</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">worst</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>

<div id="outline-container-org92e58aa" class="outline-2">
<h2 id="org92e58aa">Counting Comparisons</h2>
<div class="outline-text-2" id="text-org92e58aa">
<p>
Since the actual method of sorting is the same the swaps should be the same in either case (the new version doesn't quit until there's no more swaps to be done) so I'll just look at the comparisons and see if it made any real difference.
</p>
</div>

<div id="outline-container-org66a9c87" class="outline-3">
<h3 id="org66a9c87">Set Up Numba</h3>
<div class="outline-text-3" id="text-org66a9c87">
<div class="highlight"><pre><span></span><span class="n">bubba</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="n">bubba</span><span class="p">,</span> <span class="n">nogil</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">bubble</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="n">bubble</span><span class="p">,</span> <span class="n">nogil</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-org37d9c94" class="outline-3">
<h3 id="org37d9c94">Run The Bubble Counter</h3>
<div class="outline-text-3" id="text-org37d9c94">
<div class="highlight"><pre><span></span><span class="n">things_to_sort</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">)),</span> <span class="n">size</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>
		  <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)]</span>

<span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">bubbles_counts_and_comparisons</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
	<span class="n">delayed</span><span class="p">(</span><span class="n">bubble</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">)</span>
</pre></div>

<pre class="example">
Started: 2022-01-12 23:40:18.730737
Ended: 2022-01-12 23:41:51.143272
Elapsed: 0:01:32.412535
</pre>
</div>
</div>

<div id="outline-container-org18439a7" class="outline-3">
<h3 id="org18439a7">Run the Bubba Counter</h3>
<div class="outline-text-3" id="text-org18439a7">
<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">bubbas_counts_and_comparisons</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">2</span><span class="p">)(</span>
	<span class="n">delayed</span><span class="p">(</span><span class="n">bubba</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">)</span>
</pre></div>

<pre class="example">
Started: 2022-01-12 23:41:58.766180
Ended: 2022-01-12 23:43:38.475355
Elapsed: 0:01:39.709175
</pre>


<p>
Time-wise it seems to have done about the same as the original bubble sort.
</p>


<div class="highlight"><pre><span></span><span class="n">SIZE</span><span class="p">,</span> <span class="n">COMPARISONS</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
<span class="n">bubble_unzipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">bubbles_counts_and_comparisons</span><span class="p">))</span>
<span class="n">bubba_unzipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">bubbas_counts_and_comparisons</span><span class="p">))</span>
<span class="n">bubba_frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"Elements"</span><span class="p">:</span> <span class="n">bubble_unzipped</span><span class="p">[</span><span class="n">SIZE</span><span class="p">],</span>
				<span class="s2">"Bubble"</span><span class="p">:</span> <span class="n">bubble_unzipped</span><span class="p">[</span><span class="n">COMPARISONS</span><span class="p">],</span>
				<span class="s2">"Bubba"</span><span class="p">:</span> <span class="n">bubba_unzipped</span><span class="p">[</span><span class="n">COMPARISONS</span><span class="p">]})</span>

<span class="n">melted</span> <span class="o">=</span> <span class="n">bubba_frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Elements"</span><span class="p">],</span>
			  <span class="n">var_name</span><span class="o">=</span><span class="s2">"Sorter"</span><span class="p">,</span>
			  <span class="n">value_name</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Elements"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Sorter"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Elements"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span> <span class="s2">"Sorter"</span><span class="p">,</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Comparisons"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">)]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Bubble Sort Comparisons (with and without short-circuiting)"</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">save_chart</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"bubble_comparisons"</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
</pre></div>


<object type="text/html" data="posts/double-bubble-sort/bubble_comparisons.html" style="width:100%" height="400">
  <p>Figure Missing</p>
</object>

<p>
At first glance it looks like there's only one grey set of points, but if you zoom in (using the mouse's scroll wheel) you'll see that the grey points are actually (sometimes) created by adjacent points with the short-circuiting version's point (the blue point) slightly lower than the non-short-ciruiting orange point. So there is a difference, but it's small enough that it isn't easy to see.
</p>

<p>
Let's see if it becomes more obvious using the difference between the points instead.
</p>
<div class="highlight"><pre><span></span><span class="n">bubba_frame</span><span class="p">[</span><span class="s2">"Difference"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">bubba_frame</span><span class="p">[</span><span class="s2">"Bubble"</span><span class="p">]</span> <span class="o">-</span>
			     <span class="n">bubba_frame</span><span class="p">[</span><span class="s2">"Bubba"</span><span class="p">])</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">bubba_frame</span><span class="p">)</span><span class="o">.</span><span class="n">mark_trail</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Elements:O"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Difference:Q"</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="s2">"Difference:Q"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Elements"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Difference"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Bubble"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Bubba"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">)]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Difference In Comparisons Between the Bubble Sorts"</span><span class="p">,</span>
	     <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
	     <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">save_chart</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"bubble_differences"</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/double-bubble-sort/bubble_differences.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>

<p>
So, it looks like there are sometimes significant differences between the two sorts, but how do they appear given the total number of comparisons made?
</p>

<div class="highlight"><pre><span></span><span class="n">bubba_frame</span><span class="p">[</span><span class="s2">"Difference/Comparisons"</span><span class="p">]</span> <span class="o">=</span> <span class="n">bubba_frame</span><span class="o">.</span><span class="n">Difference</span><span class="o">/</span><span class="n">bubba_frame</span><span class="o">.</span><span class="n">Bubba</span>
<span class="n">sub_bubba</span> <span class="o">=</span> <span class="n">bubba_frame</span><span class="p">[[</span><span class="s2">"Elements"</span><span class="p">,</span> <span class="s2">"Difference/Comparisons"</span><span class="p">]]</span>
<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">sub_bubba</span><span class="p">)</span><span class="o">.</span><span class="n">mark_trail</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Elements:O"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Difference/Comparisons:Q"</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="s2">"Difference/Comparisons:Q"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Elements"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">),</span>
	     <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Difference/Comparisons"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">".4f"</span><span class="p">)]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Proportion of Difference Between the Bubble Sorts"</span><span class="p">,</span>
	     <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
	     <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">save_chart</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"bubble_difference_proportions"</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">,</span>
	   <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/double-bubble-sort/bubble_difference_proportions.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>

<p>
It looks like as the amount of sorting that's needed goes up, the difference made by the short-circuiting becomes smaller in comparison to the total number of comparisons made, but even the biggest effect proportional to the amount of comparisons made by the short-circuiting sorter only comes to the difference being 0.2% of the total comparisons.
</p>
</div>
</div>

<div id="outline-container-org1b7a66c" class="outline-3">
<h3 id="org1b7a66c">Best Case, Worst Case</h3>
<div class="outline-text-3" id="text-org1b7a66c">
<p>
Now that we know that the short-circuiting isn't that big a deal I'll add some plotting showing how our random cases compare to the best-case and worst case sorting inputs.
</p>

<div class="highlight"><pre><span></span><span class="n">best_things</span> <span class="o">=</span> <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)]</span>
<span class="n">worst_things</span> <span class="o">=</span> <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">things</span><span class="p">)</span> <span class="k">for</span> <span class="n">things</span> <span class="ow">in</span> <span class="n">best_things</span><span class="p">]</span>

<span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">worst_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
	<span class="n">delayed</span><span class="p">(</span><span class="n">bubba</span><span class="p">)(</span><span class="n">thing</span><span class="p">)</span> <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="n">worst_things</span>
<span class="p">)</span>
</pre></div>

<pre class="example">
Started: 2022-01-13 00:01:27.932132
Ended: 2022-01-13 00:02:08.108278
Elapsed: 0:00:40.176146
</pre>


<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">best_output</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
	<span class="n">delayed</span><span class="p">(</span><span class="n">bubba</span><span class="p">)(</span><span class="n">thing</span><span class="p">)</span> <span class="k">for</span> <span class="n">thing</span> <span class="ow">in</span> <span class="n">best_things</span>
<span class="p">)</span>
</pre></div>

<pre class="example">
Started: 2022-01-13 00:08:59.231664
Ended: 2022-01-13 00:09:00.409103
Elapsed: 0:00:01.177439
</pre>


<div class="highlight"><pre><span></span><span class="n">worst_unzipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">worst_output</span><span class="p">))</span>
<span class="n">best_unzipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">best_output</span><span class="p">))</span>

<span class="k">del</span> <span class="n">bubba_frame</span><span class="p">[</span><span class="s2">"Bubble"</span><span class="p">]</span>
<span class="k">del</span> <span class="n">bubba_frame</span><span class="p">[</span><span class="s2">"Difference"</span><span class="p">]</span>
<span class="k">del</span> <span class="n">bubba_frame</span><span class="p">[</span><span class="s2">"Difference/Comparisons"</span><span class="p">]</span>
<span class="n">bubba_frame</span> <span class="o">=</span> <span class="n">bubba_frame</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"Bubba"</span><span class="p">:</span> <span class="s2">"Random"</span><span class="p">})</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">bubba_frame</span><span class="p">[</span><span class="s2">"Worst Case"</span><span class="p">]</span> <span class="o">=</span> <span class="n">worst_unzipped</span><span class="p">[</span><span class="n">COMPARISONS</span><span class="p">]</span>
<span class="n">bubba_frame</span><span class="p">[</span><span class="s2">"Best Case"</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_unzipped</span><span class="p">[</span><span class="n">COMPARISONS</span><span class="p">]</span>

<span class="n">melted</span> <span class="o">=</span> <span class="n">bubba_frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Elements"</span><span class="p">],</span>
			  <span class="n">var_name</span><span class="o">=</span><span class="s2">"Input"</span><span class="p">,</span>
			  <span class="n">value_name</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Elements"</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Input"</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">550</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Bubble Sort Best, Worst, and Random Input Comparisons"</span>
<span class="p">)</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>

<span class="n">save_chart</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"best-worst-random"</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>

<object type="text/html" data="posts/double-bubble-sort/best-worst-random.html" style="width:100%" height="600">
  <p>Figure Missing</p>
</object>

<p>
Once again we run into the problem/case that it looks like the Random input is missing, but if you zoom way in you'll see it does <i>slightly</i> better than the <i>worst-case</i>, but the difference is so small that when you zoom back out they look like they did exactly the same. The <i>best-case</i> does much better, since it only has to pass through the data once to see that it's already sorted and then quit (which isn't really reflected in the plot because our increment of <i>comparisons</i> only happens if the inner loop is entered), but except for this unusual case, random inputs don't do enough better than the worst-case examples to make short-circuiting a noteworthy improvement.
</p>
</div>
</div>
</div>

<div id="outline-container-org28c342a" class="outline-2">
<h2 id="org28c342a">The End, The End</h2>
<div class="outline-text-2" id="text-org28c342a">
<p>
Well, I think I've beaten this dead horse enough for now. The overview for all the posts is <a href="posts/the-bubble-sort/">here</a>, if you didn't get enough of it. Up next: <a href="posts/selection-sort/">Selection Sort</a>.
</p>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/bubble-sort-an-empirical-look/" class="u-url">Bubble Sort: An Empirical Look</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/bubble-sort-an-empirical-look/" rel="bookmark">
            <time class="published dt-published" datetime="2021-11-17T10:57:02-08:00" itemprop="datePublished" title="2021-11-17 10:57">2021-11-17 10:57</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li>
<a href="posts/bubble-sort-an-empirical-look/#org0d186b5">An Empirical Look</a>
<ul>
<li>
<a href="posts/bubble-sort-an-empirical-look/#orgae02c70">Some Setup</a>
<ul>
<li><a href="posts/bubble-sort-an-empirical-look/#orgd74ecca">Stuff For Later</a></li>
<li><a href="posts/bubble-sort-an-empirical-look/#org01ca07f">Numba  Random</a></li>
</ul>
</li>
<li>
<a href="posts/bubble-sort-an-empirical-look/#org10db945">A Counter</a>
<ul>
<li><a href="posts/bubble-sort-an-empirical-look/#orga912ee8">Some Types</a></li>
<li><a href="posts/bubble-sort-an-empirical-look/#orgadc2c9f">The Sorting Function (With Counts)</a></li>
</ul>
</li>
<li>
<a href="posts/bubble-sort-an-empirical-look/#org6db7908">Testing the Counter</a>
<ul>
<li><a href="posts/bubble-sort-an-empirical-look/#org23a02d9">A Random Input</a></li>
<li><a href="posts/bubble-sort-an-empirical-look/#org7bcb98c">The Worst Case</a></li>
</ul>
</li>
<li><a href="posts/bubble-sort-an-empirical-look/#orgf769aef">The Tracker</a></li>
<li>
<a href="posts/bubble-sort-an-empirical-look/#orgb3451b6">Try Them Out</a>
<ul>
<li><a href="posts/bubble-sort-an-empirical-look/#org96af96e">Comparisons</a></li>
</ul>
</li>
<li>
<a href="posts/bubble-sort-an-empirical-look/#org5e72e03">Swaps</a>
<ul>
<li><a href="posts/bubble-sort-an-empirical-look/#orge736be4">Worst Case</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="posts/bubble-sort-an-empirical-look/#orgaeb14d2">Onward</a></li>
</ul>
</div>
</div>
<p>
This is a continuation of a <a href="posts/the-bubble-sort/">series on the Bubble Sort</a>. In the <a href="posts/bubble-sort-the-implementation/">previous post</a> I made an implementation of the Bubble Sort in python. In this post I'll run it with inputs of varying sizes to see how its runtime changes as well as do a plot to get a sense of how it rearranges the items its sorting as it works.
</p>
<div id="outline-container-org0d186b5" class="outline-2">
<h2 id="org0d186b5">An Empirical Look</h2>
<div class="outline-text-2" id="text-org0d186b5">
<p>
The math is nice and all, but let's do some counting. I'm going to re-implement the bubble sort but this time keeping track of the comparisons and swaps. In this case we could calculate the comparisons pretty easily, but to make sure I don't mess up the math I'll just grab it.
</p>
</div>
<div id="outline-container-orgae02c70" class="outline-3">
<h3 id="orgae02c70">Some Setup</h3>
<div class="outline-text-3" id="text-orgae02c70">
<div class="highlight"><pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">MutableSequence</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">default_rng</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="n">HoverTool</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">be_above_or_equal</span><span class="p">,</span> <span class="n">contain_only</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">njit</span>

<span class="kn">import</span> <span class="nn">hvplot.pandas</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># my stuff</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">EmbedHoloviews</span><span class="p">,</span> <span class="n">Timer</span>
</pre></div>
</div>
<div id="outline-container-orgd74ecca" class="outline-4">
<h4 id="orgd74ecca">Stuff For Later</h4>
<div class="outline-text-4" id="text-orgd74ecca">
<div class="highlight"><pre><span></span><span class="n">TIMER</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
<span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"bubble-sort-an-empirical-look"</span>
<span class="n">PATH</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"files/posts/</span><span class="si">{</span><span class="n">SLUG</span><span class="si">}</span><span class="s2">/"</span>
<span class="n">Embed</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">EmbedHoloviews</span><span class="p">,</span> <span class="n">folder_path</span><span class="o">=</span><span class="n">PATH</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div id="outline-container-org01ca07f" class="outline-4">
<h4 id="org01ca07f">Numba  Random</h4>
<div class="outline-text-4" id="text-org01ca07f">
<div class="highlight"><pre><span></span><span class="n">numba_random</span> <span class="o">=</span> <span class="n">default_rng</span><span class="p">(</span><span class="mi">2021</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-org10db945" class="outline-3">
<h3 id="org10db945">A Counter</h3>
<div class="outline-text-3" id="text-org10db945">
<p>
This is going to be a reimplementation of the Bubble Sort function but with variables added to keep track of the counts. I originally did this as class-based so I could re-use the code but once I switched from pypy to numba that started to get problematic, and the functions are short anyway so I guess it's all the same.
</p>
</div>

<div id="outline-container-orga912ee8" class="outline-4">
<h4 id="orga912ee8">Some Types</h4>
<div class="outline-text-4" id="text-orga912ee8">
<div class="highlight"><pre><span></span><span class="n">ElementCount</span> <span class="o">=</span> <span class="nb">int</span>
<span class="n">ComparisonCount</span> <span class="o">=</span> <span class="nb">int</span>
<span class="n">SwapCount</span> <span class="o">=</span> <span class="nb">int</span>
<span class="n">SortedElements</span> <span class="o">=</span> <span class="n">MutableSequence</span>
<span class="n">Counts</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">ElementCount</span><span class="p">,</span> <span class="n">ComparisonCount</span><span class="p">,</span> <span class="n">SwapCount</span><span class="p">,</span> <span class="n">SortedElements</span><span class="p">]</span>

<span class="n">BubbleOutput</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">"BubbleOutput"</span><span class="p">,</span>
			  <span class="p">[</span>
			      <span class="s2">"element_count"</span><span class="p">,</span> <span class="s2">"comparisons"</span><span class="p">,</span>
			      <span class="s2">"swaps"</span><span class="p">,</span>
			      <span class="s2">"elements"</span><span class="p">])</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgadc2c9f" class="outline-4">
<h4 id="orgadc2c9f">The Sorting Function (With Counts)</h4>
<div class="outline-text-4" id="text-orgadc2c9f">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">bubble</span><span class="p">(</span><span class="n">elements</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Counts</span><span class="p">:</span>
    <span class="sd">"""Sorts the list in place</span>

<span class="sd">    Args:</span>
<span class="sd">     elements: list of (in-place) sortable elements</span>

<span class="sd">    Returns:</span>
<span class="sd">     number of elements, count of comparisons, count of swaps, sorted elements</span>
<span class="sd">    """</span>
    <span class="n">all_but_one</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">comparisons</span> <span class="o">=</span> <span class="n">swaps</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">items_sorted</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">all_but_one</span><span class="p">):</span>
	<span class="k">for</span> <span class="n">in_front_of_us</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">all_but_one</span> <span class="o">-</span> <span class="n">items_sorted</span><span class="p">):</span>
	    <span class="n">comparisons</span> <span class="o">+=</span> <span class="mi">1</span>
	    <span class="n">to_the_right</span> <span class="o">=</span> <span class="n">in_front_of_us</span> <span class="o">+</span> <span class="mi">1</span>
	    <span class="k">if</span> <span class="n">elements</span><span class="p">[</span><span class="n">to_the_right</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">elements</span><span class="p">[</span><span class="n">in_front_of_us</span><span class="p">]:</span>
		<span class="p">(</span><span class="n">elements</span><span class="p">[</span><span class="n">in_front_of_us</span><span class="p">],</span>
		 <span class="n">elements</span><span class="p">[</span><span class="n">to_the_right</span><span class="p">])</span> <span class="o">=</span> <span class="p">(</span><span class="n">elements</span><span class="p">[</span><span class="n">to_the_right</span><span class="p">],</span>
					  <span class="n">elements</span><span class="p">[</span><span class="n">in_front_of_us</span><span class="p">])</span>
		<span class="n">swaps</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">BubbleOutput</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">),</span> <span class="n">comparisons</span><span class="p">,</span> <span class="n">swaps</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span>
</pre></div>

<p>
One thing to note is that in the algorithm the outer loop stops at \(n-2\), which it also does here, but since the <code>range</code> function doesn't include the last number our argument is only \(n-1\), which might look confusing at first, and might sound even more confusing when you read this, but the point is they're the same even though they might not look exactly the same.
</p>
</div>
</div>
</div>
<div id="outline-container-org6db7908" class="outline-3">
<h3 id="org6db7908">Testing the Counter</h3>
<div class="outline-text-3" id="text-org6db7908">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_non_decreasing</span><span class="p">(</span><span class="n">elements</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">"""Checks that all the elements in the list are non-decreasing</span>

<span class="sd">    Args:</span>
<span class="sd">     elements: list of comparable sorted items</span>

<span class="sd">    Raises:</span>
<span class="sd">     AssertionError if something is out of order</span>
<span class="sd">    """</span>
    <span class="n">last_one</span> <span class="o">=</span> <span class="n">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
	<span class="n">this_one</span> <span class="o">=</span> <span class="n">elements</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
	<span class="n">expect</span><span class="p">(</span><span class="n">this_one</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_above_or_equal</span><span class="p">(</span><span class="n">last_one</span><span class="p">))</span>
	<span class="n">last_one</span> <span class="o">=</span> <span class="n">this_one</span>
    <span class="k">return</span>
</pre></div>
</div>

<div id="outline-container-org23a02d9" class="outline-4">
<h4 id="org23a02d9">A Random Input</h4>
<div class="outline-text-4" id="text-org23a02d9">
<p>
Because we aren't using any kind of short-circuiting to stop once the data is sorted, it will always loop \(\Omega(n^2)\), but the number of swaps will depend on the input.
</p>

<div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)),</span> <span class="n">k</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">bubble</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

<span class="n">sorted_elements</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">elements</span>
<span class="n">check_non_decreasing</span><span class="p">(</span><span class="n">sorted_elements</span><span class="p">)</span>

<span class="n">expected_runtime</span> <span class="o">=</span> <span class="n">expected_swaps</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">comparisons</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">expected_runtime</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div id="outline-container-org7bcb98c" class="outline-4">
<h4 id="org7bcb98c">The Worst Case</h4>
<div class="outline-text-4" id="text-org7bcb98c">
<p>
In the worst case where it's in the exact opposite sorted order (non-increasing instead of non-decreasing) the number of comparisons should equaly the number of swaps.
</p>

<div class="highlight"><pre><span></span><span class="n">output</span> <span class="o">=</span> <span class="n">bubble</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)))))</span>
<span class="n">check_non_decreasing</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">comparisons</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">expected_runtime</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">swaps</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">expected_swaps</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-orgf769aef" class="outline-3">
<h3 id="orgf769aef">The Tracker</h3>
<div class="outline-text-3" id="text-orgf769aef">
<p>
To visualize what the sort is doing I'm going to update the bubble sort to keep track of the order of the items as it's being sorted. I'm using a dictionary to map the list values to their locations so we can't use inputs where there are repeated elements or more than one list of locations will be mapped to a element value.
</p>

<div class="highlight"><pre><span></span><span class="n">IndexHistory</span> <span class="o">=</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
<span class="n">ElementValue</span> <span class="o">=</span> <span class="nb">int</span>
<span class="n">Swaps</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="n">ElementValue</span><span class="p">,</span> <span class="n">IndexHistory</span><span class="p">]</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">swap_tracker</span><span class="p">(</span><span class="n">elements</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Swaps</span><span class="p">:</span>
    <span class="sd">"""Does the bubble-sort and tracks the locations</span>

<span class="sd">    Args:</span>
<span class="sd">     elements: list of orderable items</span>

<span class="sd">    Returns:</span>
<span class="sd">     dict of element value: list of indices it was at during sort</span>
<span class="sd">    """</span>
    <span class="n">all_but_one</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="n">swaps</span> <span class="o">=</span> <span class="p">{</span><span class="n">element</span><span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elements</span><span class="p">)}</span>

    <span class="k">for</span> <span class="n">items_sorted</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">all_but_one</span><span class="p">):</span>
	<span class="k">for</span> <span class="n">in_front_of_us</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">all_but_one</span> <span class="o">-</span> <span class="n">items_sorted</span><span class="p">):</span>
	    <span class="n">to_the_right</span> <span class="o">=</span> <span class="n">in_front_of_us</span> <span class="o">+</span> <span class="mi">1</span>
	    <span class="k">if</span> <span class="n">elements</span><span class="p">[</span><span class="n">to_the_right</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">elements</span><span class="p">[</span><span class="n">in_front_of_us</span><span class="p">]:</span>
		<span class="p">(</span><span class="n">elements</span><span class="p">[</span><span class="n">in_front_of_us</span><span class="p">],</span>
		 <span class="n">elements</span><span class="p">[</span><span class="n">to_the_right</span><span class="p">])</span> <span class="o">=</span> <span class="p">(</span><span class="n">elements</span><span class="p">[</span><span class="n">to_the_right</span><span class="p">],</span>
					  <span class="n">elements</span><span class="p">[</span><span class="n">in_front_of_us</span><span class="p">])</span>
		<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elements</span><span class="p">):</span>
		    <span class="n">swaps</span><span class="p">[</span><span class="n">element</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">swaps</span>
</pre></div>

<p>
First a little sanity check just to make sure it still works.
</p>

<div class="highlight"><pre><span></span><span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">swaps</span> <span class="o">=</span> <span class="n">swap_tracker</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">swaps</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">)))</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

<span class="n">swaps</span> <span class="o">=</span> <span class="n">swap_tracker</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">swaps</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_only</span><span class="p">(</span><span class="o">*</span><span class="n">inputs</span><span class="p">))</span>

<span class="n">check_non_decreasing</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgb3451b6" class="outline-3">
<h3 id="orgb3451b6">Try Them Out</h3>
<div class="outline-text-3" id="text-orgb3451b6">
</div>
<div id="outline-container-org96af96e" class="outline-4">
<h4 id="org96af96e">Comparisons</h4>
<div class="outline-text-4" id="text-org96af96e">
<p>
Let's look at how the comparisons and swaps change as the input gets bigger. To speed this up I'm going to run the sort in numba.
</p>

<div class="highlight"><pre><span></span><span class="n">numba_bubble</span> <span class="o">=</span> <span class="n">njit</span><span class="p">(</span><span class="n">bubble</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span></span><span class="n">runs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">things_to_sort</span> <span class="o">=</span> <span class="p">[</span><span class="n">numba_random</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">count</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>
		  <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)]</span>

<span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">comparisons_and_swaps</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
	<span class="n">delayed</span><span class="p">(</span><span class="n">numba_bubble</span><span class="p">)(</span><span class="n">thing_to_sort</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">thing_to_sort</span> <span class="ow">in</span> <span class="n">things_to_sort</span><span class="p">)</span>
</pre></div>

<pre class="example">
Started: 2021-12-22 02:49:12.003456
Ended: 2021-12-22 02:50:44.485043
Elapsed: 0:01:32.481587
</pre>



<p>
Now we'll plot it.
</p>

<div class="highlight"><pre><span></span><span class="n">SIZE</span><span class="p">,</span> <span class="n">COMPARISONS</span><span class="p">,</span> <span class="n">SWAPS</span><span class="p">,</span> <span class="n">ELEMENTS</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
<span class="n">unzipped</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">comparisons_and_swaps</span><span class="p">))</span>
<span class="n">bubba_frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"Elements"</span><span class="p">:</span> <span class="n">unzipped</span><span class="p">[</span><span class="n">SIZE</span><span class="p">],</span>
				<span class="s2">"Comparisons"</span><span class="p">:</span> <span class="n">unzipped</span><span class="p">[</span><span class="n">COMPARISONS</span><span class="p">],</span>
				<span class="s2">"Swaps"</span><span class="p">:</span> <span class="n">unzipped</span><span class="p">[</span><span class="n">SWAPS</span><span class="p">]})</span>
<span class="n">bubba_frame</span><span class="p">[</span><span class="s2">"n^2"</span><span class="p">]</span> <span class="o">=</span> <span class="n">bubba_frame</span><span class="p">[</span><span class="s2">"Elements"</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
<span class="n">tooltips_comparisons</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">"Elements"</span><span class="p">,</span> <span class="s2">"@Elements{0,}"</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">"Comparisons"</span><span class="p">,</span> <span class="s2">"@Comparisons{0,}"</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">tooltips_swaps</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">"Elements"</span><span class="p">,</span> <span class="s2">"@Elements{0,}"</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">"Swaps"</span><span class="p">,</span> <span class="s2">"@Swaps{0,}"</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">tooltips_n2</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">"Elements"</span><span class="p">,</span> <span class="s2">"@Elements{0,}"</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">"n^2"</span><span class="p">,</span> <span class="s2">"@{n^2}{0,}"</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">hover_comparisons</span> <span class="o">=</span> <span class="n">HoverTool</span><span class="p">(</span><span class="n">tooltips</span><span class="o">=</span><span class="n">tooltips_comparisons</span><span class="p">)</span>
<span class="n">hover_swaps</span> <span class="o">=</span> <span class="n">HoverTool</span><span class="p">(</span><span class="n">tooltips</span><span class="o">=</span><span class="n">tooltips_swaps</span><span class="p">)</span>
<span class="n">hover_n2</span> <span class="o">=</span> <span class="n">HoverTool</span><span class="p">(</span><span class="n">tooltips</span><span class="o">=</span><span class="n">tooltips_n2</span><span class="p">)</span>

<span class="n">swap_plots</span> <span class="o">=</span> <span class="n">bubba_frame</span><span class="o">.</span><span class="n">hvplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Elements"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Swaps"</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">hover_swaps</span><span class="p">])</span>
<span class="n">comparison_plots</span> <span class="o">=</span> <span class="n">bubba_frame</span><span class="o">.</span><span class="n">hvplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Elements"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">hover_comparisons</span><span class="p">])</span>
<span class="n">n_squared_plot</span> <span class="o">=</span> <span class="n">bubba_frame</span><span class="o">.</span><span class="n">hvplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Elements"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"n^2"</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">hover_n2</span><span class="p">])</span>

<span class="n">plot</span> <span class="o">=</span> <span class="p">(</span><span class="n">swap_plots</span> <span class="o">*</span> <span class="n">comparison_plots</span> <span class="o">*</span> <span class="n">n_squared_plot</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Comparisons, Swaps and n-squared Counts"</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"bubble_sort_comparisons"</span><span class="p">)()</span>
</pre></div>

<object type="text/html" data="posts/bubble-sort-an-empirical-look/bubble_sort_comparisons.html" style="width:100%" height="800">
  <p>Figure Missing</p>
</object>

<p>
The top line (yellow) is the square of the size of the inputs, the middle (red) is the number of swaps, and the bottom line (blue) is the number of comparisons. If you hover over the lines you can see that each line is roughly double the one below it - there are twice as many comparisons as swaps for a given input and \(n^2\) is twice as big as the comparison count for a given input.
</p>
</div>
</div>
</div>
<div id="outline-container-org5e72e03" class="outline-3">
<h3 id="org5e72e03">Swaps</h3>
<div class="outline-text-3" id="text-org5e72e03">
<p>
The comparisons and swaps are pretty much what we expected to see, they just confirm the theoretical assessment, but now let's look at plotting the swaps as they occur to see if we can understand what the bubble sort is doing.
</p>

<div class="highlight"><pre><span></span><span class="n">COUNT</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">COUNT</span><span class="p">)),</span> <span class="n">k</span><span class="o">=</span><span class="n">COUNT</span><span class="p">)</span>
<span class="n">swaps</span> <span class="o">=</span> <span class="n">swap_tracker</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

<span class="c1"># swaps = {str(key): value for key, value in tracker.swaps.items()}</span>
<span class="n">track_frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">swaps</span><span class="p">)</span>
<span class="n">re_indexed</span> <span class="o">=</span> <span class="n">track_frame</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"Swap"</span><span class="p">})</span>
<span class="n">melted</span> <span class="o">=</span> <span class="n">re_indexed</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">var_name</span><span class="o">=</span><span class="s2">"Value To Sort"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Location In Array"</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="s2">"Swap"</span><span class="p">)</span>

<span class="n">tooltips</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">"Item to Sort"</span><span class="p">,</span> <span class="s2">"@{Value To Sort}"</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">"Swap"</span><span class="p">,</span> <span class="s2">"@</span><span class="si">{Swap}</span><span class="s2">"</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">"Current Location"</span><span class="p">,</span> <span class="s2">"@{Location In Array}"</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">hover</span> <span class="o">=</span> <span class="n">HoverTool</span><span class="p">(</span><span class="n">tooltips</span><span class="o">=</span><span class="n">tooltips</span><span class="p">)</span>

<span class="n">ticks</span> <span class="o">=</span> <span class="p">[(</span><span class="n">index</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">COUNT</span><span class="p">)]</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">melted</span><span class="o">.</span><span class="n">hvplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Swap"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Location In Array"</span><span class="p">,</span>
		     <span class="n">by</span><span class="o">=</span><span class="s2">"Value To Sort"</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">hover</span><span class="p">],</span>
					      <span class="n">show_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
		     <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="n">ticks</span><span class="p">,</span>
			    <span class="n">title</span><span class="o">=</span><span class="s2">"Bubble Sort Swaps"</span><span class="p">,)</span>


<span class="n">output</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"bubble_sort_swaps"</span><span class="p">)()</span>
</pre></div>

<object type="text/html" data="posts/bubble-sort-an-empirical-look/bubble_sort_swaps.html" style="width:100%" height="800">
  <p>Figure Missing</p>
</object>

<p>
<b><b>Aside:</b></b>
</p>

<p>
HoloViews seems to not let you set the Tooltips if you use multiple columns, which is why I went through all the rigamarole of melting it. If you just plot it as the DataFrame with each column being one of the tracked locations for a sort value (e.g. the column name is '1' and the rows are the positions in the array at each swap) then the plot comes out okay, but the labels are kind of confusing.
</p>

<p>
Looking at the plot, though, this does seem to be a useful way to figure out what's going on. If you look at the largest unsorted values you can see that once they are the largest of the unsorted values, they "bubble up" in a diagonal but straight line. Before this plot I would have said that the largest elements are the ones that get sorted first, but if you look at the plot (assuming I don't re-run it and change the arrangements) and in particular you look at the least-valued elements (0 and 1) you can see that they reach their final position fairly early, just by virtue of being in a position to get pushed down and being adjacent so they would be swapped to get into the correct order.
</p>
</div>
<div id="outline-container-orge736be4" class="outline-4">
<h4 id="orge736be4">Worst Case</h4>
<div class="outline-text-4" id="text-orge736be4">
<p>
The random-input gives an interesting view of how the algorithm might work in practice, but let's look at the worst-case input where the values are in the opposite of the sorted order.
</p>

<div class="highlight"><pre><span></span><span class="n">COUNT</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">COUNT</span><span class="p">)))</span>
<span class="n">swaps</span> <span class="o">=</span> <span class="n">swap_tracker</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

<span class="n">track_frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">swaps</span><span class="p">)</span>
<span class="n">re_indexed</span> <span class="o">=</span> <span class="n">track_frame</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">"index"</span><span class="p">:</span> <span class="s2">"Swap"</span><span class="p">})</span>
<span class="n">melted</span> <span class="o">=</span> <span class="n">re_indexed</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">var_name</span><span class="o">=</span><span class="s2">"Value To Sort"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Location In Array"</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="s2">"Swap"</span><span class="p">)</span>


<span class="n">ticks</span> <span class="o">=</span> <span class="p">[(</span><span class="n">index</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">COUNT</span><span class="p">)]</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">melted</span><span class="o">.</span><span class="n">hvplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Swap"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Location In Array"</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">"blues"</span><span class="p">,</span>
		     <span class="n">by</span><span class="o">=</span><span class="s2">"Value To Sort"</span><span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">show_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
		     <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="n">ticks</span><span class="p">,</span>
			    <span class="n">title</span><span class="o">=</span><span class="s2">"Bubble Sort Swaps (Worst Case)"</span><span class="p">,)</span>


<span class="n">output</span> <span class="o">=</span> <span class="n">Embed</span><span class="p">(</span><span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s2">"bubble_sort_worst_swaps"</span><span class="p">)()</span>
</pre></div>

<object type="text/html" data="posts/bubble-sort-an-empirical-look/bubble_sort_worst_swaps.html" style="width:100%" height="800">
  <p>Figure Missing</p>
</object>

<p>
This image gives an even better sense of the way that the bubble sort works. Since it emphasizes left-to-right traversal and swapping as you go, the largest values shoot up to their final positions in straight lines, while the lesser values get pushed down a little with each traversal until they reach the correct position.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgaeb14d2" class="outline-2">
<h2 id="orgaeb14d2">Onward</h2>
<div class="outline-text-2" id="text-orgaeb14d2">
<p>
The <a href="posts/double-bubble-sort/">final post in this series</a> (maybe) will look at a variation on the Bubble Sort that can improve the performance in special cases.
</p>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/bubble-sort-the-implementation/" class="u-url">Bubble Sort: The Implementation</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/bubble-sort-the-implementation/" rel="bookmark">
            <time class="published dt-published" datetime="2021-11-17T05:06:51-07:00" itemprop="datePublished" title="2021-11-17 05:06">2021-11-17 05:06</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li>
<a href="posts/bubble-sort-the-implementation/#orgaa36b89">Some Setup</a>
<ul>
<li><a href="posts/bubble-sort-the-implementation/#org427e725">Imports</a></li>
</ul>
</li>
<li>
<a href="posts/bubble-sort-the-implementation/#org8aa05e7">Bubble Sort</a>
<ul>
<li><a href="posts/bubble-sort-the-implementation/#org80fd10c">The Implementation</a></li>
<li><a href="posts/bubble-sort-the-implementation/#org8ea9d8e">Try It Out</a></li>
</ul>
</li>
<li><a href="posts/bubble-sort-the-implementation/#orgb0a89a9">Up Next</a></li>
</ul>
</div>
</div>
<p>
This is part of a <a href="posts/the-bubble-sort/">series on Bubble Sort</a> that began with a look at <a href="posts/bubble-sort-the-algorithm/">the Bubble Sort Algorithm</a> and continues now with a python translation of the algorithm.
</p>
<div id="outline-container-orgaa36b89" class="outline-2">
<h2 id="orgaa36b89">Some Setup</h2>
<div class="outline-text-2" id="text-orgaa36b89">
</div>
<div id="outline-container-org427e725" class="outline-3">
<h3 id="org427e725">Imports</h3>
<div class="outline-text-3" id="text-org427e725">
<div class="highlight"><pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choices</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">contain_exactly</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
</pre></div>
</div>
</div>
</div>
<div id="outline-container-org8aa05e7" class="outline-2">
<h2 id="org8aa05e7">Bubble Sort</h2>
<div class="outline-text-2" id="text-org8aa05e7">
</div>
<div id="outline-container-org80fd10c" class="outline-3">
<h3 id="org80fd10c">The Implementation</h3>
<div class="outline-text-3" id="text-org80fd10c">
<p>
Here's a straight-forward translation of the pseudocode to python.
</p>

<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">bubble_sort</span><span class="p">(</span><span class="n">unsorted</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">"""Sorts the unsorted</span>

<span class="sd">    Args:</span>
<span class="sd">     unsorted: mutable collect of orderable items</span>

<span class="sd">    Returns:</span>
<span class="sd">     original list sorted in ascending order</span>
<span class="sd">    """</span>
    <span class="n">all_but_one</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unsorted</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">items_bubbled_up</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">all_but_one</span><span class="p">):</span>
	<span class="k">for</span> <span class="n">left_hand</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">all_but_one</span> <span class="o">-</span> <span class="n">items_bubbled_up</span><span class="p">):</span>
	    <span class="n">right_hand</span> <span class="o">=</span> <span class="n">left_hand</span> <span class="o">+</span> <span class="mi">1</span>
	    <span class="k">if</span> <span class="n">unsorted</span><span class="p">[</span><span class="n">right_hand</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">unsorted</span><span class="p">[</span><span class="n">left_hand</span><span class="p">]:</span>
		<span class="p">(</span><span class="n">unsorted</span><span class="p">[</span><span class="n">left_hand</span><span class="p">],</span>
		 <span class="n">unsorted</span><span class="p">[</span><span class="n">right_hand</span><span class="p">])</span> <span class="o">=</span> <span class="p">(</span><span class="n">unsorted</span><span class="p">[</span><span class="n">right_hand</span><span class="p">],</span>
					  <span class="n">unsorted</span><span class="p">[</span><span class="n">left_hand</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">unsorted</span>
</pre></div>
</div>
</div>
<div id="outline-container-org8ea9d8e" class="outline-3">
<h3 id="org8ea9d8e">Try It Out</h3>
<div class="outline-text-3" id="text-org8ea9d8e">
<div class="highlight"><pre><span></span><span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">expect</span><span class="p">(</span><span class="n">bubble_sort</span><span class="p">(</span><span class="n">inputs</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">population</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="n">scrambled</span> <span class="o">=</span> <span class="n">choices</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">bubble_sort</span><span class="p">(</span><span class="n">scrambled</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">scrambled</span><span class="p">))))</span>
</pre></div>

<p>
Well, that wasn't so exciting, but that's because I'm going to look more at how the sort performs in the <a href="posts/bubble-sort-an-empirical-look/">next post</a>.
</p>
</div>
</div>
</div>

<div id="outline-container-orgb0a89a9" class="outline-2">
<h2 id="orgb0a89a9">Up Next</h2>
<div class="outline-text-2" id="text-orgb0a89a9">
<p>
In the <a href="posts/bubble-sort-an-empirical-look/">next post</a> I'll run the function over some inputs to see how it performs.
</p>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/bubble-sort-runtime-explained/" class="u-url">Bubble Sort: Runtime Explained</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/bubble-sort-runtime-explained/" rel="bookmark">
            <time class="published dt-published" datetime="2021-11-17T03:45:35-08:00" itemprop="datePublished" title="2021-11-17 03:45">2021-11-17 03:45</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li>
<a href="posts/bubble-sort-runtime-explained/#org23f8c3b">What This Is</a>
<ul>
<li><a href="posts/bubble-sort-runtime-explained/#org566e662">Start With the Loops</a></li>
<li><a href="posts/bubble-sort-runtime-explained/#orgc0d56d2">Decompose the Inner Sum</a></li>
<li><a href="posts/bubble-sort-runtime-explained/#orgc06fa19">Break Apart the Polynomial</a></li>
<li><a href="posts/bubble-sort-runtime-explained/#org460bcc5">That Last Term</a></li>
<li><a href="posts/bubble-sort-runtime-explained/#org8d910d6">Put the Three Terms Back Together</a></li>
</ul>
</li>
<li><a href="posts/bubble-sort-runtime-explained/#org0da3c14">Re-Orienting</a></li>
</ul>
</div>
</div>
<div id="outline-container-org23f8c3b" class="outline-2">
<h2 id="org23f8c3b">What This Is</h2>
<div class="outline-text-2" id="text-org23f8c3b">
<p>
The number of comparisons for the Bubble Sort is equal to the number of times the loops run, so we get \(\Theta(n^2)\). I originally only did a truncated version of showing how you get \(n^2\) but then I had to struggle a little to remember what was going on when I looked back at it so I'm going to break it down more here.
</p>
</div>
<div id="outline-container-org566e662" class="outline-3">
<h3 id="org566e662">Start With the Loops</h3>
<div class="outline-text-3" id="text-org566e662">
<p>
We have an outer loop that runs from \(0\ldots n-2\) and an inner loop that goes from \(0 \dots n - 2 - i \) giving us a summation that looks like this
</p>

<p>
\[
C(n) = \sum_{i=0}^{n-2} \sum_{j=0}^{n - 2 - i} 1
\]
</p>

<p>
It's summing \(1\) because there's one comparison in each of the loops.
</p>
</div>
</div>
<div id="outline-container-orgc0d56d2" class="outline-3">
<h3 id="orgc0d56d2">Decompose the Inner Sum</h3>
<div class="outline-text-3" id="text-orgc0d56d2">
<p>
So first we have to recognize that since we're summing \(1\) (the comparison) what we're doing is adding \(1\) for every item in the summation which is the equivalent of counting how many numbers there are from \(0\) to \(n - 2 - i\). When you have a sequence of consecutive integers (say 5, 6, 7, 8) the way to count the number there are in the sequence is \(\textit{last} - \textit{first} + 1\). So for 5, 6, 7, 8 we have \(8 - 5 + 1 = 4\) so there are four numbers in the sequence. If we apply that to the sequence created by the inner summation we get this
</p>

\begin{align}
C(n) &amp;= \sum_{i=0}^{n-2} \sum_{j=0}^{n - 2 - i} 1\\
     &amp;= \sum_{i=0}^{n-2}  (n - 2 - i)  - 0 + 1\\
     &amp;= \sum_{i=0}^{n-2} n - 1 - i\\
\end{align}
</div>
</div>
<div id="outline-container-orgc06fa19" class="outline-3">
<h3 id="orgc06fa19">Break Apart the Polynomial</h3>
<div class="outline-text-3" id="text-orgc06fa19">
<p>
With summations, if you are summing a polynomial, then you can break additions and subtractions apart into separate summations. Additionally, any multiplications can be moved outside of the summation. So now we get
</p>

\begin{align}
C(n) &amp;= \sum_{i=0}^{n-2} n - 1 - i\\
     &amp;= n \sum_{i=0}^{n-2} 1 - \sum_{i=0}^{n-2} 1 - \sum_{i=0}^{n-2} i\\
\end{align}
</div>
</div>

<div id="outline-container-org460bcc5" class="outline-3">
<h3 id="org460bcc5">That Last Term</h3>
<div class="outline-text-3" id="text-org460bcc5">
<p>
If you squint at the first two terms of that last line you can see that we're summing up \(1\) just like we did with the inner loop so it's going to be a similar outcome just with a different ending point (and we'll also multiply by <i>n</i> for the first term). But that last one is a little trickier. It's a summation of <i>i</i> rather than \(1\) so it'll be \(0 + 1 + \cdots + (n-1) + (n-2)\). This is a sequence that happens often enough that if you do this sort of thing a lot you'll just remember it, but I don't do it a lot and I'm rather of a forgetful bent anyway so I'll show how I remember to get it. 
First you have to remember that the sum of terms is the same no matter the order you put the terms in, so the summation comes out the same even when it's reversed. What we'll do is add the sequence with its reverse term by term we to get something like this
</p>

\begin{array}{ccccccccc}
&amp; 0 &amp; + &amp; 1 &amp; + &amp; \cdots &amp; + &amp; (n - 3) &amp; + &amp; (n - 2) \\
+ &amp; (n - 2) &amp; + &amp; (n - 3) &amp; + &amp; \cdots &amp; + &amp; 1 &amp; + &amp; 0 \\
\hline
&amp; (n - 2) &amp; + &amp; (n - 2) &amp; + &amp; \cdots &amp; + &amp; (n - 2) &amp; + &amp; (n - 2)\\
\end{array}

<p>
And using our counting equation we have
</p>
\begin{align}
end - start + 1 &amp;= n - 2 - 0 + 1 \\
&amp;= n - 1
\end{align}

<p>
So we have \(n - 1\) terms in that sum we got by adding the reverse (each term being \(n - 2\)), but since we added the sequence with its reverse it's now twice as big as it should be so we need to halve it, and the third term of our summation becomes
</p>

<p>
\[
\frac{(n - 1)(n - 2)}{2}
\]
</p>
</div>
</div>

<div id="outline-container-org8d910d6" class="outline-3">
<h3 id="org8d910d6">Put the Three Terms Back Together</h3>
<div class="outline-text-3" id="text-org8d910d6">
<p>
Now, going back to where we were in the summation - if do the expansion of the first two terms using the counting equation and add the third term from the previous section, we get this
</p>

\begin{align}
C(n)   &amp;= n \sum_{i=0}^{n-2} 1 - \sum_{i=0}^{n-2} 1 - \sum_{i=0}^{n-2} i\\
&amp;= n(n - 2 - 0 + 1) - (n - 2 - 0 + 1) - \frac{(n - 1)(n - 2)}{2}\\
&amp;= n(n - 1) - (n - 1)- \frac{n^2 -2n - n + 2}{2}\\
&amp;= (n^2 - n) - (n - 1)  - \frac{n^2 - 3n + 2}{2}\\
&amp;= \frac{2(n^2 - n)}{2} - \frac{2(n - 1)}{2} - \frac{n^2 - 3n + 2}{2}\\
&amp;= \frac{2 n^2 - 2n - 2n + 2 - n^2 + 3n -2}{2}\\
&amp;= \frac{n^2 - n}{2} \in \Theta(n^2)
\end{align}

<p>
Oy. Now don't forget next time.
</p>
</div>
</div>
</div>
<div id="outline-container-org0da3c14" class="outline-2">
<h2 id="org0da3c14">Re-Orienting</h2>
<div class="outline-text-2" id="text-org0da3c14">
<p>
This is part of a <a href="posts/the-bubble-sort/">series on Bubble Sort</a>. More specifically, it expands on the post <a href="posts/bubble-sort-the-algorithm/">looking at the Bubble Sort Algorithms</a>.
</p>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/bubble-sort-the-algorithm/" class="u-url">Bubble Sort: The Algorithm</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/bubble-sort-the-algorithm/" rel="bookmark">
            <time class="published dt-published" datetime="2021-11-17T02:45:55-08:00" itemprop="datePublished" title="2021-11-17 02:45">2021-11-17 02:45</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="posts/bubble-sort-the-algorithm/#orgc74e17a">The Parts</a></li>
<li><a href="posts/bubble-sort-the-algorithm/#org5190941">The Algorithm</a></li>
<li>
<a href="posts/bubble-sort-the-algorithm/#orgab13918">Assessing the Damage</a>
<ul>
<li>
<ul>
<li><a href="posts/bubble-sort-the-algorithm/#orgac71bde">Comparisons</a></li>
<li><a href="posts/bubble-sort-the-algorithm/#org311da9a">Swaps</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="posts/bubble-sort-the-algorithm/#orgaf25f54">Onward</a></li>
<li><a href="posts/bubble-sort-the-algorithm/#org3bafb7c">Sources</a></li>
</ul>
</div>
</div>
<p>
This is part of a <a href="posts/the-bubble-sort/">series on the Bubble Sort</a>. In this post we'll look at the algorithm without worrying about the implementation details.
</p>

<p>
\(\def\sc#1{\dosc#1\csod} \def\dosc#1#2\csod{{\rm #1{\small #2}}}\)
</p>

<div id="outline-container-orgc74e17a" class="outline-2">
<h2 id="orgc74e17a">The Parts</h2>
<div class="outline-text-2" id="text-orgc74e17a">
<ul class="org-ul">
<li>
<b><b>Specification:</b></b> This is an instance of <a href="posts/the-sorting-problem/">The Sorting Problem</a>.</li>
<li>
<b><b>Basic Steps:</b></b> Swap adjacent elements that are out of order.</li>
<li>
<b><b>Measure of Progress:</b></b> The number of items sorted so far.</li>
<li>
<b><b>The Loop Invariant:</b></b> The number of times the loop has been performed (<i>k</i>) is the number of elements at the end of the items which are the largest elements in sorted order.</li>
<li>
<b><b>Main Steps:</b></b> Move from the start of the list swapping adjacent items that are out of order until the largest unsorted item is at the beginning of the sorted items.</li>
<li>
<b><b>Make Progress:</b></b> The main step reduces the unsorted by 1.</li>
<li>
<b><b>Maintain the Loop Invariant:</b></b>
<ul class="org-ul">
<li>\(\langle Loop-Invariant \rangle\): <i>k</i> items at the end of the list are sorted.</li>
<li>\(\lnot \langle Exit-Condition \rangle\): There is more than one item that is unsorted.</li>
<li>\(\sc{CodeLoop}\): The <i>k+1</i> item was the largest of the unsorted items and is now at the beginning of the sorted items.</li>
</ul>
</li>
<li>
<b><b>Establish the Loop Invariant:</b></b> Initially no items are swapped.</li>
<li>
<b><b>Exit Condition:</b></b> Stop when there is only one item in the unsorted items.</li>
<li>
<b><b>Ending:</b></b>
<ul class="org-ul">
<li>\(\langle Exit-Condition \rangle\): All but the smallest item are in the upper list.</li>
<li>\(\langle Loop-Invariant \rangle\): All the items in the upper list are sorted in non-decreasing order.</li>
<li>\(\langle Post-Condition \rangle \): The list is sorted in non-decreasing order.</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org5190941" class="outline-2">
<h2 id="org5190941">The Algorithm</h2>
<div class="outline-text-2" id="text-org5190941">
<p>
The Bubble Sort algorithm is a Brute-Force sort which works by repeatedly traversing the input array, checking adjacent values and swapping them if they are out of order. This has the effect of "bubbling-up" the largest unsorted value, thus the name, probably (see <a href="posts/bubble-sort-an-archeological-algorithmic-analysis/">Astrachan, 2003</a> for some history on it). Here's the algorithm in pseudocode.
</p>

<pre id="bubblesort" style="display:hidden;">
\begin{algorithm}
\caption{BubbleSort}
\begin{algorithmic}
\INPUT An array of orderable items
\OUTPUT The array sorted in ascending order
\PROCEDURE{BubbleSort}{$A$}
  \FOR{$i \gets 0$ to $n - 2$}
    \FOR{$j \gets 0$ to $n - 2 - i$}
      \IF{$A[j+1] &lt; A[j]$}
        \STATE swap $A[j]$ and $A[j+1]$
      \ENDIF
    \ENDFOR
  \ENDFOR
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>

<p>
If you squint a little you'll see that there's only really four lines of code, two for-loops, an if-then conditional, and a "swap", the rest is noise from the algorithmic formatting.
</p>

<p>
In translation, the \(i\) variable holds the amount of items at the end of the list that have been sorted so far, and the \(j\) variable moves from the start of the list up to the end of the unsorted (since the outer loop goes up by one each time and the inner loop is subtracting the outer loop's value when finding where to stop it goes up one less entry with each loop). Then the conditional says that if the item to the right of where we currently are is smaller than the item in front of us, swap the two items so that the bigger item is on the right.
</p>
</div>
</div>
<div id="outline-container-orgab13918" class="outline-2">
<h2 id="orgab13918">Assessing the Damage</h2>
<div class="outline-text-2" id="text-orgab13918">
<p>
Although it's nice to know that the sort works we're really not as concerned about how correct it is, as much as we are interested in how it performs. There's two things we can count:
</p>

<ol class="org-ol">
<li>The Number of comparisons</li>
<li>The Number of swaps.</li>
</ol>
<p>
The fact that you have those two loops makes it pretty likely that it's going to be \(\Theta\left(n^2\right)\) but since Bubble Sort is mostly an academic example let's work it out.
</p>
</div>

<div id="outline-container-orgac71bde" class="outline-4">
<h4 id="orgac71bde">Comparisons</h4>
<div class="outline-text-4" id="text-orgac71bde">
<p>
The number of comparisons is equal to the number of times the loops run, so we get \(\Theta\left(n^2\right)\). I made some notes on how I got that in <a href="posts/bubble-sort-runtime-explained/">this post</a>.
</p>
</div>
</div>

<div id="outline-container-org311da9a" class="outline-4">
<h4 id="org311da9a">Swaps</h4>
<div class="outline-text-4" id="text-org311da9a">
<p>
The number of swaps will depend on how the inputs are arranged, but in the worst case where the array is sorted backwards, every comparison will produce a swap so you'll end up with the same bounds as the comparisons.
</p>

\begin{align}
S_{worst-case} &amp;= C(n)\\
               &amp;= \frac{n^2 - n}{2} \in \Theta(n^2)
\end{align}
</div>
</div>
</div>

<div id="outline-container-orgaf25f54" class="outline-2">
<h2 id="orgaf25f54">Onward</h2>
<div class="outline-text-2" id="text-orgaf25f54">
<p>
The <a href="posts/bubble-sort-the-implementation/">next post</a> will look at translating the algorithm to python.
</p>
</div>
</div>
<div id="outline-container-org3bafb7c" class="outline-2">
<h2 id="org3bafb7c">Sources</h2>
<div class="outline-text-2" id="text-org3bafb7c">
<ul class="org-ul">
<li>(Levitin, 2007) <a href="posts/itdaa/">Introduction to the Design &amp; Analysis of Algorithms (Levitin)</a>
</li>
<li>
<a id="orgf8ed7b1"></a> (Astrachan, 2003) <a href="posts/bubble-sort-an-archeological-algorithmic-analysis/">Bubble Sort: An Archeological Algorithmic Analysis</a>
</li>
</ul>
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("bubblesort"));
});
</script>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/the-bubble-sort/" class="u-url">The Bubble Sort</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/the-bubble-sort/" rel="bookmark">
            <time class="published dt-published" datetime="2021-11-17T01:05:15-08:00" itemprop="datePublished" title="2021-11-17 01:05">2021-11-17 01:05</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="outline-container-org9fbace3" class="outline-2">
<h2 id="org9fbace3">What This Is</h2>
<div class="outline-text-2" id="text-org9fbace3">
<p>
This is an overview page to link together some posts about the Bubble Sort. <i>Bubble Sort?</i> you say. Yes, Bubble Sort. Even though it's often derided it still exists and I'll use it as a base before moving on to other sorting methods.
</p>
</div>
</div>

<div id="outline-container-orgdfafb3d" class="outline-2">
<h2 id="orgdfafb3d">The Parts</h2>
<div class="outline-text-2" id="text-orgdfafb3d">
<ul class="org-ul">
<li><a href="posts/bubble-sort-the-algorithm/">Bubble Sort: The Algorithm</a></li>
<li><a href="posts/bubble-sort-the-implementation/">Bubble Sort: The Implementation</a></li>
<li><a href="posts/bubble-sort-an-empirical-look/">Bubble Sort: An Empirical Look</a></li>
<li><a href="posts/double-bubble-sort/">Bubble Sort Variation I (Double Bubble)</a></li>
</ul>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/HTTAA/" class="u-url">How To Think About Algorithms</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/HTTAA/" rel="bookmark">
            <time class="published dt-published" datetime="2021-10-21T13:19:32-08:00" itemprop="datePublished" title="2021-10-21 13:19">2021-10-21 13:19</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="outline-container-org9cc4a1d" class="outline-2">
<h2 id="org9cc4a1d">Contents</h2>
<div class="outline-text-2" id="text-org9cc4a1d">
<ul class="org-ul">
<li>Introduction</li>
</ul>
</div>
<div id="outline-container-orgb4eec95" class="outline-3">
<h3 id="orgb4eec95">Part One: Iterative Algorithms and Loop Invariants</h3>
<div class="outline-text-3" id="text-orgb4eec95">
<ol class="org-ol">
<li>Iterative Algorithms: Measures of Progress and Loop Invariants</li>
<li>Examples Using More-of-the-Input Loop Invariants</li>
<li>Abstract Data Types</li>
<li>Narrowing the Search Space: Binary Search</li>
<li>Iterative Sorting Algorithms</li>
<li>Euclid's GCD Algorithm</li>
<li>The Loop Invariant for Lower Bounds</li>
</ol>
</div>
</div>
<div id="outline-container-org7a1a737" class="outline-3">
<h3 id="org7a1a737">Part Two: Recursion</h3>
<div class="outline-text-3" id="text-org7a1a737">
<ol class="org-ol">
<li>Abstractions, Technique, and Theory</li>
<li>Some Simple Examples of Recursive Algorithms</li>
<li>Recursion on Trees</li>
<li>Recursive Images</li>
<li>Parsing with Context-Free Grammars</li>
</ol>
</div>
</div>
<div id="outline-container-orgcb85763" class="outline-3">
<h3 id="orgcb85763">Part Three: Optimization Problems</h3>
<div class="outline-text-3" id="text-orgcb85763">
<ol class="org-ol">
<li>Definition of Optimization Problems</li>
<li>Graph Search Algorithms</li>
<li>Network Flows and Linear Programming</li>
<li>Greedy Algorithms</li>
<li>Recursive Backtracking</li>
<li>Dynamic Programming Algorithms</li>
<li>Examples of Dynamic Programming</li>
<li>Reductions and NP-Completeness</li>
<li>Randomized Algorithms</li>
</ol>
</div>
</div>
<div id="outline-container-orgbeb0923" class="outline-3">
<h3 id="orgbeb0923">Part Four: Appendix</h3>
<div class="outline-text-3" id="text-orgbeb0923">
<ol class="org-ol">
<li>Existential and Universal Quantifiers</li>
<li>Time Complexity</li>
<li>Logarithms and Exponentials</li>
<li>Asymptotic Growth</li>
<li>Adding-Made-Easy Approximations</li>
<li>Recurrence Relations</li>
<li>A Formal Proof of Correctness</li>
</ol>
</div>
</div>
<div id="outline-container-org56b80b4" class="outline-3">
<h3 id="org56b80b4">Part Five: Exercise Solutions</h3>
</div>
<div id="outline-container-orgfa2bda9" class="outline-3">
<h3 id="orgfa2bda9">Conclusion</h3>
</div>
</div>
<div id="outline-container-org65e0397" class="outline-2">
<h2 id="org65e0397">Citation</h2>
<div class="outline-text-2" id="text-org65e0397">
<ul class="org-ul">
<li>[HTTAA] Edmonds J. How to think about algorithms. Cambridge ; New York: Cambridge University Press; 2008. 448 p.</li>
</ul>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/itdaa/" class="u-url">Introduction to the Design &amp; Analysis of Algorithms (Levitin)</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/itdaa/" rel="bookmark">
            <time class="published dt-published" datetime="2021-10-20T16:24:56-07:00" itemprop="datePublished" title="2021-10-20 16:24">2021-10-20 16:24</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <p>
Levitin A. 2007. Introduction to the design &amp; analysis of algorithms. 2nd ed. Boston: Pearson Addison-Wesley.
</p>

<div id="outline-container-org1210cef" class="outline-2">
<h2 id="org1210cef">Main Chapters</h2>
<div class="outline-text-2" id="text-org1210cef">
<ol class="org-ol">
<li>Introduction</li>
<li>Fundamentals of the Analysis of Algorithm Efficiency</li>
<li>Brute Force</li>
<li>Divide-and-Conquer</li>
<li>Decrease-and-Conquer</li>
<li>Transform-and-Conquer</li>
<li>Space and Time Tradeoffs</li>
<li>Dynamic Programming</li>
<li>Greedy Technique</li>
<li>Iterative Improvement</li>
<li>Limitations of Algorithm Power</li>
<li>Coping with the Limitations of Algorithm Power</li>
<li>Useful Formulas for the Analysis of Algorithms</li>
<li>Short Tutorial on Recurrence Relations</li>
</ol>
</div>
</div>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/clrs/" class="u-url">Introduction To Algorithms (CLRS)</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                The Cloistered Monkey
            </span></p>
            <p class="dateline">
            <a href="posts/clrs/" rel="bookmark">
            <time class="published dt-published" datetime="2021-08-12T12:39:58-07:00" itemprop="datePublished" title="2021-08-12 12:39">2021-08-12 12:39</time></a>
            </p>
        </div>
    </header><div class="e-content entry-content">
    <div id="outline-container-orgfd42e18" class="outline-2">
<h2 id="orgfd42e18">Citation</h2>
<div class="outline-text-2" id="text-orgfd42e18">
<ul class="org-ul">
<li>Cormen TH, editor. Introduction to algorithms. 3rd ed. Cambridge, Mass: MIT Press; 2009. 1292 p.</li>
</ul>
</div>
</div>
    </div>
    </article>
</div>

        <ul class="pager postindexpager clearfix">
<li class="previous"><a href="index-2.html" rel="prev">Newer posts</a></li>
        </ul>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
             MathJax.Hub.Config({
               tex2jax: {
                 inlineMath: [['$','$'], ['\\(','\\)']],
                 displayMath: [['$$','$$'], ['\\[','\\]']],
                 processEscapes: true,
                 processEnvironments: true,
               },
               displayAlign: 'center',
               "HTML-CSS": {
                 styles: {'.MathJax_Display': {"margin": 0}}
               }
             });
            </script><script src="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.js"></script><!--End of body content--><footer id="footer"><a href="mailto:cloisteredmonkey.jmark@slmail.me">The Cloistered Monkey</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
 <img alt="Creative Commons License BY-NC-SA" style="border-width:0; margin-bottom:12px;" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"></a>
            
            
        </footer>
</div>
</div>


        <script src="assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
