<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
<head>
<meta charset="utf-8">
<meta content="Striking out for data." name="description">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>Bowling For Data (old posts, page 6) | Bowling For Data</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<meta content="Nikola (getnikola.com)" name="generator">
<link href="rss.xml" hreflang="en" rel="alternate" title="RSS" type="application/rss+xml">
<link href="https://necromuralist.github.io/Bowling-For-Data/index-6.html" rel="canonical">
<link href="index-7.html" rel="prev" type="text/html">
<link href="index-5.html" rel="next" type="text/html"><!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
<script crossorigin="anonymous" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],

            displayMath: [['$$','$$'], ['\\[','\\]']],
            processEscapes: true,
            processEnvironments: true,
        }
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/pseudocode@2.4.1/build/pseudocode.min.js"></script>
</head>
<body>
<a class="sr-only sr-only-focusable" href="#content">Skip to main content</a> <!-- Menubar -->
<nav class="navbar navbar-expand-md static-top mb-4 navbar-light bg-light">
<div class="container"><!-- This keeps the margins nice -->
 <a class="navbar-brand" href="."><span id="blog-title">Bowling For Data</span></a> <button aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#bs-navbar" data-toggle="collapse" type="button"><span class="navbar-toggler-icon"></span></button>
<div class="collapse navbar-collapse" id="bs-navbar">
<ul class="navbar-nav mr-auto">
<li class="nav-item"><a class="nav-link" href="pages/">Pages</a></li>
<li class="nav-item"><a class="nav-link" href="archive.html">Archive</a></li>
<li class="nav-item"><a class="nav-link" href="categories/">Tags</a></li>
<li class="nav-item"><a class="nav-link" href="rss.xml">RSS feed</a></li>
<li class="nav-item dropdown"><a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">Monkey Pages</a>
<div class="dropdown-menu"><a class="dropdown-item" href="https://necromuralist.github.io/">The Cloistered Monkey</a> <a class="dropdown-item" href="https://necromuralist.github.io/Ape-Iron/">Ape Iron</a> <a class="dropdown-item" href="https://necromuralist.github.io/Beach-Pig-Thigh/">Beach-Pig Rump & Thigh</a> <a class="dropdown-item" href="https://necromuralist.github.io/Neurotic-Networking/">Neurotic Networking</a> <a class="dropdown-item" href="https://necromuralist.github.io/Terribilis-Ludum/">Terribilis Ludum</a> <a class="dropdown-item" href="https://necromuralist.github.io/Visions-Voices-Data/">Visions, Voices, Data</a></div>
</li>
</ul>
<!-- DuckDuckGo custom search -->
<form action="https://duckduckgo.com/" class="navbar-form pull-left" id="search" method="get" name="search"><input name="sites" type="hidden" value="https://necromuralist.github.io/Bowling-For-Data/"><input name="k8" type="hidden" value="#444444"><input name="k9" type="hidden" value="#D51920"><input name="kt" type="hidden" value="h"><input class="span2" maxlength="255" name="q" placeholder="Searchâ€¦" style="margin-top: 4px;" type="text"><input style="visibility: hidden;" type="submit" value="DuckDuckGo Search"></form>
<!-- End of custom search -->
<ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse --></div>
<!-- /.container --></nav>
<!-- End of Menubar -->
<div class="container" id="content" role="main">
<div class="body-content"><!--Body content-->
<div class="postindex">
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/algorithms-illuminated-part-1/index.html">Algorithms Illuminated - Part 1: The Basics</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/algorithms-illuminated-part-1/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-05-10T15:03:11-07:00" itemprop="datePublished" title="2022-05-10 15:03">2022-05-10 15:03</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div class="outline-2" id="outline-container-org8d50129">
<h2 id="org8d50129">Citation</h2>
<div class="outline-text-2" id="text-org8d50129">
<ul class="org-ul">
<li>Roughgarden T. Algorithms illuminated. Part 1: The Basics. First edition. San Francisco, CA: Soundlikeyourself Publishing; 2021. 213 p.</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org060552c">
<h2 id="org060552c">On The Web</h2>
<div class="outline-text-2" id="text-org060552c">
<ul class="org-ul">
<li><a href="https://algorithmsilluminated.org/">Algorithms Illuminated website</a>: Has links to all four books, videos, test cases, etc.</li>
<li><a href="https://timroughgarden.org/">Tim Roughgarden's (the author) Website</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org3f62c1f">
<h2 id="org3f62c1f">Other Books in the Series</h2>
<div class="outline-text-2" id="text-org3f62c1f">
<ul class="org-ul">
<li><a href="posts/algorithms-illuminated-part-3/index.html">Algorithms Illuminated - Part III: Greedy Algorithms and Dynamic Programming</a></li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/karatsuba-multiplication/index.html">Karatsuba Multiplication</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/karatsuba-multiplication/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-05-10T14:53:24-07:00" itemprop="datePublished" title="2022-05-10 14:53">2022-05-10 14:53</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/karatsuba-multiplication/index.html#org3550574">Imports and Setup</a>
<ul>
<li><a href="posts/karatsuba-multiplication/index.html#orgde42618">Imports</a></li>
<li><a href="posts/karatsuba-multiplication/index.html#org1dbe820">Set Up</a></li>
</ul>
</li>
<li><a href="posts/karatsuba-multiplication/index.html#org2ba2802">The Algorithms</a>
<ul>
<li><a href="posts/karatsuba-multiplication/index.html#orgd0f6567">Grade School Multiplication</a></li>
<li><a href="posts/karatsuba-multiplication/index.html#orgea2c122">Karatsuba Multiplication</a></li>
</ul>
</li>
<li><a href="posts/karatsuba-multiplication/index.html#orgc24f361">An IntList</a>
<ul>
<li><a href="posts/karatsuba-multiplication/index.html#org725accb">Test it</a></li>
</ul>
</li>
<li><a href="posts/karatsuba-multiplication/index.html#org7c9f81a">An Implementation</a>
<ul>
<li><a href="posts/karatsuba-multiplication/index.html#orgca54838">Karatsuba Multiplication</a>
<ul>
<li><a href="posts/karatsuba-multiplication/index.html#orga08bcaa">Test</a></li>
</ul>
</li>
<li><a href="posts/karatsuba-multiplication/index.html#org8e2d48d">Test</a></li>
</ul>
</li>
<li><a href="posts/karatsuba-multiplication/index.html#org4c048bf">Run Time</a>
<ul>
<li><a href="posts/karatsuba-multiplication/index.html#orgb898a95">Using the Master Method</a></li>
<li><a href="posts/karatsuba-multiplication/index.html#org941eb5d">With Padding</a></li>
<li><a href="posts/karatsuba-multiplication/index.html#orgdb3ffe0">Without Padding</a></li>
</ul>
</li>
<li><a href="posts/karatsuba-multiplication/index.html#orgaf627af">Sources</a>
<ul>
<li><a href="posts/karatsuba-multiplication/index.html#orgd435d21">Karatsuba Multiplicatio</a></li>
<li><a href="posts/karatsuba-multiplication/index.html#org8fd4298">Grade-School Multiplication</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org3550574">
<h2 id="org3550574">Imports and Setup</h2>
<div class="outline-text-2" id="text-org3550574"></div>
<div class="outline-3" id="outline-container-orgde42618">
<h3 id="orgde42618">Imports</h3>
<div class="outline-text-3" id="text-orgde42618">
<div class="highlight">
<pre><span></span><span class="c1"># from python</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">sys</span>


<span class="c1"># from pypi</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">be_a</span><span class="p">,</span>
    <span class="n">contain_exactly</span><span class="p">,</span>
    <span class="n">equal</span><span class="p">,</span>
    <span class="n">expect</span><span class="p">,</span>
    <span class="n">raise_error</span>
<span class="p">)</span>

<span class="kn">import</span> <span class="nn">altair</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">Timer</span>
<span class="kn">from</span> <span class="nn">graeae.visualization.altair_helpers</span> <span class="kn">import</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">save_chart</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org1dbe820">
<h3 id="org1dbe820">Set Up</h3>
<div class="outline-text-3" id="text-org1dbe820">
<div class="highlight">
<pre><span></span><span class="n">TIMER</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>
<span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"karatsuba-multiplication"</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="n">output_path</span><span class="p">(</span><span class="n">SLUG</span><span class="p">)</span>
<span class="n">save_it</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">save_chart</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">)</span>

<span class="n">MultiplicationOutput</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">"MultiplicationOutput"</span><span class="p">,</span> <span class="p">[</span><span class="s2">"product"</span><span class="p">,</span> <span class="s2">"count"</span><span class="p">])</span>
<span class="n">PlotMultiplicationOutput</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span>
    <span class="s2">"PlotOutput"</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">"product"</span><span class="p">,</span> <span class="s2">"count"</span><span class="p">,</span> <span class="s2">"digits"</span><span class="p">,</span> <span class="s2">"factor_1"</span><span class="p">,</span> <span class="s2">"factor_2"</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org2ba2802">
<h2 id="org2ba2802">The Algorithms</h2>
<div class="outline-text-2" id="text-org2ba2802"></div>
<div class="outline-3" id="outline-container-orgd0f6567">
<h3 id="orgd0f6567">Grade School Multiplication</h3>
<div class="outline-text-3" id="text-orgd0f6567">
<p>Grade-School multiplication is how most of us are taught to multiply numbers with more than one digit each. Each digit in one number is multiplied by each digit in the other to create a partial product. Once we've gone through all the digits in the first number we sum up all the partial products we calculated to get our final answer.</p>
<pre id="grade-school" style="display:hidden;">
\begin{algorithm}
\caption{Grade-School}
\begin{algorithmic}
\REQUIRE The input arrays are of the same length ($n$)
\INPUT Two arrays representing digits in integers ($a, b$)
\OUTPUT The product of the inputs

\PROCEDURE{GradeSchool}{$number_1, number_2$}

\FOR {$j \in \{0 \ldots n - 1\}$}
  \STATE $carry \gets 0$
  \FOR {$i \in \{0 \ldots n - 1\}$}
    \STATE $product \gets a[i] \times b[j] + carry$
    \STATE $partial[j][i + j] \gets product \bmod 10$
    \STATE $carry \gets product/10$
  \ENDFOR
  \STATE $partial[j][n + j] \gets carry$
\ENDFOR

\STATE $carry \gets 0$

\FOR {$i \in \{0 \ldots 2n - 1\}$}
  \STATE $sum \gets carry$
  \FOR {$j \in \{0 \ldots n - 1\}$}
    \STATE $sum \gets sum + partial[j][i]$
  \ENDFOR
  \STATE $result[i] \gets sum \bmod 10$
  \STATE $carry \gets sum/10$
\ENDFOR

\STATE $result[2n] \gets carry$
\RETURN result
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre></div>
</div>
<div class="outline-3" id="outline-container-orgea2c122">
<h3 id="orgea2c122">Karatsuba Multiplication</h3>
<div class="outline-text-3" id="text-orgea2c122">
<p>Karatsuba Multiplication improves on the Grade-School algorithm using a trick from Frederick Gauss, which is a little too much of a diversion. With all these improvements in multiplication it seems like you need a background in number theory that not all Computer Scientist's have (or at least I don't). Maybe take it on faith for now.</p>
<pre id="karatsuba" style="display:hidden;">
\begin{algorithm}
\caption{Karatsuba}
\begin{algorithmic}
\REQUIRE The input arrays are of the same length
\INPUT Two arrays representing digits in integers
\OUTPUT The product of the inputs

\PROCEDURE{Karatsuba}{$number_1, number_2$}

\STATE $\textit{digits} \gets $ \textsc{Length}($number_1$)

\IF {$\textit{digits} = 1$}
  \RETURN $number_1 \times number_2$
\ENDIF

\STATE $middle \gets \left\lfloor \frac{\textit{digits}}{2} \right\rfloor$

\STATE \\
\STATE $MostSignificant_1, LeastSignificant_1 \gets $ \textsc{Split}($number_1, middle$)
\STATE $MostSignificant_2, LeastSignificant_2 \gets $ \textsc{Split}($number_2, middle$)
\STATE \\
\STATE $MostPlusLeast_1 \gets MostSignificant_1 + LeastSignificant_1$
\STATE $MostPlusLeast_2 \gets MostSignificant_2 + LeastSignificant_2$
\STATE \\

\STATE \textit{left} $\gets $ \textsc{Karatsuba}($MostSignificant_1, MostSignificant_2$)
\STATE \textit{summed} $\gets $ \textsc{Karatsuba}($MostPlusLeast_1, MostPlusLeast_2$)
\STATE \textit{right} $\gets $ \textsc{Karatsuba}($LeastSignificant_1, LeastSignificant_2$)
\STATE \\
\STATE \textit{center} $\gets$ (\textit{summed} - \textit{left} - \textit{right})
\STATE \\
\RETURN \textit{left} $\times 10^{\textit{digits}} + \textit{center} \times 10^{\textit{middle}} + \textit{right}$
\ENDPROCEDURE
\end{algorithmic}
\end{algorithm}
</pre>
<p>This is a mashup of the Wikipedia version and the <a href="posts/algorithms-illuminated-part-1/index.html">Algorithms Illuminated</a> version. It's a little tricky in that we're dealing with integers, in theory, but we have to know the number of digits and how to split it up so in code we're going to have to work with a collection instead, but hopefully this will be clearer in code.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgc24f361">
<h2 id="orgc24f361">An IntList</h2>
<div class="outline-text-2" id="text-orgc24f361">
<div class="highlight">
<pre><span></span><span class="k">class</span> <span class="nc">IntegerDigits</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""A hybrid integer and digits list</span>

<span class="sd">    Args:</span>
<span class="sd">     integer: the number to store</span>
<span class="sd">     padding: number of 0's to add to the left of the digits</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">integer</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">integer</span> <span class="o">=</span> <span class="n">integer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_digits</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">digits</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""The digits for the given integer</span>

<span class="sd">        Raises:</span>
<span class="sd">         ValueError if the given integer isn't really an integer</span>

<span class="sd">        Returns:</span>
<span class="sd">         zero-padded list of digits</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_digits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">digits</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">digit</span><span class="p">)</span> <span class="k">for</span> <span class="n">digit</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">integer</span><span class="p">)]</span>
            <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">digits</span><span class="p">)</span>
            <span class="n">power_of_two</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">length</span><span class="p">))</span>
            <span class="n">padding</span> <span class="o">=</span> <span class="n">power_of_two</span> <span class="o">-</span> <span class="n">length</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_digits</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">padding</span> <span class="o">+</span> <span class="n">digits</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_digits</span>

    <span class="k">def</span> <span class="nf">add_padding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">padding</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Add more zeros to the left of the digits</span>

<span class="sd">        Args:</span>
<span class="sd">         padding: number of zeros to add to the left of the digits</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_digits</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">padding</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">digits</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">set_length</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Set the total length of the digit list</span>

<span class="sd">        Args:</span>
<span class="sd">         target: total number of digits to have</span>

<span class="sd">        Raises:</span>
<span class="sd">         RuntimeError: target is less than the current number of digits</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">target</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"target </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s2"> is less than current </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span><span class="si">}</span><span class="s2"> digits"</span><span class="p">)</span>

        <span class="n">padding</span> <span class="o">=</span> <span class="n">target</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_padding</span><span class="p">(</span><span class="n">padding</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">set_equal_length</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">IntegerDigits</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Set both self and other to have the same number of digits"""</span>
        <span class="n">target</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_length</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="n">other</span><span class="o">.</span><span class="n">set_length</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Clean out any generated attributes"""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_digits</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span>

    <span class="c1"># collection methods</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""The number of digits"""</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IntegerDigits</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Slice the digits"""</span>
        <span class="n">sliced</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">digits</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">sliced</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">sliced</span> <span class="o">=</span> <span class="p">[</span><span class="n">sliced</span><span class="p">]</span>
        <span class="n">gotten</span> <span class="o">=</span> <span class="n">IntegerDigits</span><span class="p">(</span><span class="nb">sum</span><span class="p">((</span><span class="n">value</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sliced</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">index</span><span class="p">)</span>
                                    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sliced</span><span class="p">))))</span>
        <span class="c1"># preserve any padding</span>
        <span class="n">gotten</span><span class="o">.</span><span class="n">_digits</span> <span class="o">=</span> <span class="n">sliced</span>
        <span class="k">return</span> <span class="n">gotten</span>
    <span class="c1"># integer operations</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IntegerDigits</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Add an integer or IntegerDigits to this integer"""</span>
        <span class="k">return</span> <span class="n">IntegerDigits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">integer</span> <span class="o">+</span> <span class="n">value</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span>
                             <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">integer</span> <span class="o">+</span> <span class="n">value</span><span class="o">.</span><span class="n">integer</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IntegerDigits</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Subtract an integer or IntegerDigits from this integer"""</span>
        <span class="k">return</span> <span class="n">IntegerDigits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">integer</span> <span class="o">-</span> <span class="n">value</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span>
                             <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">integer</span> <span class="o">-</span> <span class="n">value</span><span class="o">.</span><span class="n">integer</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IntegerDigits</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""multiply integer by integer or IntegerDigits"""</span>
        <span class="k">return</span> <span class="n">IntegerDigits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">integer</span> <span class="o">*</span> <span class="n">value</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span>
                             <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">integer</span> <span class="o">*</span> <span class="n">value</span><span class="o">.</span><span class="n">integer</span><span class="p">)</span>

    <span class="c1"># comparisons</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Compare to integer or IntegerDigits"""</span>
        <span class="k">return</span> <span class="n">other</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">integer</span>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">integer</span> <span class="o">&lt;</span> <span class="n">other</span>

    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">integer</span> <span class="o">&gt;</span> <span class="n">other</span>

    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">integer</span> <span class="o">&gt;=</span> <span class="n">other</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">"&lt;IntegerDigits: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">integer</span><span class="si">}</span><span class="s2">&gt;"</span>
</pre></div>
</div>
<div class="outline-3" id="outline-container-org725accb">
<h3 id="org725accb">Test it</h3>
<div class="outline-text-3" id="text-org725accb">
<div class="highlight">
<pre><span></span><span class="n">test</span> <span class="o">=</span> <span class="n">IntegerDigits</span><span class="p">(</span><span class="mi">567</span><span class="p">)</span>
<span class="c1"># build the digits padded to power of 2</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">digits</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>

<span class="c1"># implement the length dunder method</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>

<span class="c1"># add slicing</span>
<span class="n">expect</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">test</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># multiplication</span>
<span class="n">product</span> <span class="o">=</span> <span class="n">test</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">expect</span><span class="p">(</span><span class="n">product</span><span class="o">.</span><span class="n">integer</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">567</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">test_2</span> <span class="o">=</span> <span class="n">IntegerDigits</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_2</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">product</span> <span class="o">=</span> <span class="n">test</span> <span class="o">*</span> <span class="n">test_2</span>
<span class="n">expect</span><span class="p">(</span><span class="n">product</span><span class="o">.</span><span class="n">integer</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">567</span><span class="p">))</span>

<span class="c1"># addition</span>
<span class="n">sum_</span> <span class="o">=</span> <span class="n">test</span> <span class="o">+</span> <span class="mi">10</span>
<span class="n">expect</span><span class="p">(</span><span class="n">sum_</span><span class="o">.</span><span class="n">integer</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">577</span><span class="p">))</span>

<span class="n">sum_</span> <span class="o">=</span> <span class="n">test</span> <span class="o">+</span> <span class="n">test_2</span>
<span class="n">expect</span><span class="p">(</span><span class="n">sum_</span><span class="o">.</span><span class="n">integer</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">569</span><span class="p">))</span>

<span class="c1"># subtraction</span>
<span class="n">difference</span> <span class="o">=</span> <span class="n">test</span> <span class="o">-</span> <span class="mi">20</span>
<span class="n">expect</span><span class="p">(</span><span class="n">difference</span><span class="o">.</span><span class="n">integer</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">547</span><span class="p">))</span>

<span class="n">difference</span> <span class="o">=</span> <span class="n">test_2</span> <span class="o">-</span> <span class="n">test</span>
<span class="n">expect</span><span class="p">(</span><span class="n">difference</span><span class="o">.</span><span class="n">integer</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="o">-</span><span class="mi">565</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org7c9f81a">
<h2 id="org7c9f81a">An Implementation</h2>
<div class="outline-text-2" id="text-org7c9f81a"></div>
<div class="outline-3" id="outline-container-orgca54838">
<h3 id="orgca54838">Karatsuba Multiplication</h3>
<div class="outline-text-3" id="text-orgca54838">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">karatsuba</span><span class="p">(</span><span class="n">integer_1</span><span class="p">:</span> <span class="n">IntegerDigits</span><span class="p">,</span>
              <span class="n">integer_2</span><span class="p">:</span> <span class="n">IntegerDigits</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MultiplicationOutput</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Multiply integer_1 and integer_2</span>

<span class="sd">    Args:</span>
<span class="sd">     integer_1, integer_2: arrays with equal number of digits</span>

<span class="sd">    Returns:</span>
<span class="sd">     product of the integers, count</span>
<span class="sd">    """</span>
    <span class="n">digits</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">integer_1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">digits</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">MultiplicationOutput</span><span class="p">(</span><span class="n">integer_1</span> <span class="o">*</span> <span class="n">integer_2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">middle</span> <span class="o">=</span> <span class="n">digits</span><span class="o">//</span><span class="mi">2</span>

    <span class="n">most_significant_1</span><span class="p">,</span> <span class="n">least_significant_1</span> <span class="o">=</span> <span class="n">integer_1</span><span class="p">[:</span><span class="n">middle</span><span class="p">],</span> <span class="n">integer_1</span><span class="p">[</span><span class="n">middle</span><span class="p">:]</span>
    <span class="n">most_significant_2</span><span class="p">,</span> <span class="n">least_significant_2</span> <span class="o">=</span> <span class="n">integer_2</span><span class="p">[:</span><span class="n">middle</span><span class="p">],</span> <span class="n">integer_2</span><span class="p">[</span><span class="n">middle</span><span class="p">:]</span>

    <span class="n">most_plus_least_1</span> <span class="o">=</span> <span class="n">most_significant_1</span> <span class="o">+</span> <span class="n">least_significant_1</span>
    <span class="n">most_plus_least_2</span> <span class="o">=</span> <span class="n">most_significant_2</span> <span class="o">+</span> <span class="n">least_significant_2</span>

    <span class="c1"># a hack to keep them the same number of digits after the addition</span>
    <span class="n">most_plus_least_1</span><span class="o">.</span><span class="n">set_equal_length</span><span class="p">(</span><span class="n">most_plus_least_2</span><span class="p">)</span>

    <span class="n">left</span><span class="p">,</span> <span class="n">count_left</span> <span class="o">=</span> <span class="n">karatsuba</span><span class="p">(</span><span class="n">most_significant_1</span><span class="p">,</span> <span class="n">most_significant_2</span><span class="p">)</span>
    <span class="n">summed</span><span class="p">,</span> <span class="n">count_summed</span> <span class="o">=</span> <span class="n">karatsuba</span><span class="p">(</span><span class="n">most_plus_least_1</span><span class="p">,</span> <span class="n">most_plus_least_2</span><span class="p">)</span>
    <span class="n">right</span><span class="p">,</span> <span class="n">count_right</span>  <span class="o">=</span> <span class="n">karatsuba</span><span class="p">(</span><span class="n">least_significant_1</span><span class="p">,</span> <span class="n">least_significant_2</span><span class="p">)</span>

    <span class="n">center</span> <span class="o">=</span> <span class="n">summed</span> <span class="o">-</span> <span class="n">left</span> <span class="o">-</span> <span class="n">right</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">left</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="n">digits</span> <span class="o">+</span> <span class="n">center</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="n">middle</span> <span class="o">+</span> <span class="n">right</span>

    <span class="k">if</span> <span class="n">output</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"left: </span><span class="si">{</span><span class="n">left</span><span class="si">}</span><span class="s2"> center: </span><span class="si">{</span><span class="n">center</span><span class="si">}</span><span class="s2"> right: </span><span class="si">{</span><span class="n">right</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">MultiplicationOutput</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">count_left</span> <span class="o">+</span> <span class="n">count_summed</span> <span class="o">+</span> <span class="n">count_right</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">karatsuba_multiplication</span><span class="p">(</span><span class="n">integer_1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                             <span class="n">integer_2</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                             <span class="n">count_padding</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PlotMultiplicationOutput</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Sets up and runs the Karatsuba Multiplication</span>

<span class="sd">    Args:</span>
<span class="sd">     integer_1, integer_2: the two values to multiply</span>
<span class="sd">     count_padding: whether the digit count should include the padding</span>

<span class="sd">    Returns:</span>
<span class="sd">     product, count, digits</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="n">integer_1</span> <span class="o">&gt;=</span><span class="mi">0</span>
    <span class="k">assert</span> <span class="n">integer_2</span> <span class="o">&gt;=</span> <span class="mi">0</span>

    <span class="n">integer_1</span> <span class="o">=</span> <span class="n">IntegerDigits</span><span class="p">(</span><span class="n">integer_1</span><span class="p">)</span>
    <span class="n">integer_2</span> <span class="o">=</span> <span class="n">IntegerDigits</span><span class="p">(</span><span class="n">integer_2</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">count_padding</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">digit</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">integer_1</span><span class="o">.</span><span class="n">digits</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">digit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">original_1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">integer_1</span><span class="o">.</span><span class="n">digits</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span>
                <span class="k">break</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">digit</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">integer_2</span><span class="o">.</span><span class="n">digits</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">digit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">original_2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">integer_2</span><span class="o">.</span><span class="n">digits</span><span class="p">[</span><span class="n">index</span><span class="p">:])</span>
                <span class="k">break</span>
        <span class="n">original_digits</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">original_1</span><span class="p">,</span> <span class="n">original_2</span><span class="p">)</span>

    <span class="c1"># make them have the same number of digits</span>
    <span class="n">integer_1</span><span class="o">.</span><span class="n">set_equal_length</span><span class="p">(</span><span class="n">integer_2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">count_padding</span><span class="p">:</span>
        <span class="n">original_digits</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">integer_1</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">karatsuba</span><span class="p">(</span><span class="n">integer_1</span><span class="p">,</span> <span class="n">integer_2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">PlotMultiplicationOutput</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="n">output</span><span class="o">.</span><span class="n">product</span><span class="p">,</span>
                                    <span class="n">count</span><span class="o">=</span><span class="n">output</span><span class="o">.</span><span class="n">count</span><span class="p">,</span>
                                    <span class="n">digits</span><span class="o">=</span><span class="n">original_digits</span><span class="p">,</span>
                                    <span class="n">factor_1</span><span class="o">=</span><span class="n">integer_1</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span>
                                    <span class="n">factor_2</span><span class="o">=</span><span class="n">integer_2</span><span class="o">.</span><span class="n">integer</span><span class="p">)</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-orga08bcaa">
<h4 id="orga08bcaa">Test</h4>
<div class="outline-text-4" id="text-orga08bcaa">
<div class="highlight">
<pre><span></span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">karatsuba_multiplication</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">product</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

<span class="n">a</span> <span class="o">=</span> <span class="mi">222</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">karatsuba_multiplication</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">product</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">666</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org8e2d48d">
<h3 id="org8e2d48d">Test</h3>
<div class="outline-text-3" id="text-org8e2d48d">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">test_karatsuba</span><span class="p">(</span><span class="n">first</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">second</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="n">first</span> <span class="o">*</span> <span class="n">second</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">karatsuba_multiplication</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">)</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">product</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">expected</span><span class="p">))</span>
    <span class="k">return</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">limit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>
<span class="k">for</span> <span class="n">digits</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">limit</span> <span class="o">-</span> <span class="mi">100</span><span class="p">,</span> <span class="n">limit</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">digits</span> <span class="o">-</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">digits</span> <span class="o">+</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">digits</span> <span class="o">-</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">digits</span> <span class="o">+</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">test_karatsuba</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"maxsize: </span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"a: </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"b: </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"a x b: </span><span class="si">{</span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"maxsize - a * b: </span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">raise</span>
</pre></div>
<p>Example values from the Algorithms Illuminated website.</p>
<div class="highlight">
<pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="mi">3141592653589793238462643383279502884197169399375105820974944592</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">2718281828459045235360287471352662497757247093699959574966967627</span>
<span class="n">test_karatsuba</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org4c048bf">
<h2 id="org4c048bf">Run Time</h2>
<div class="outline-text-2" id="text-org4c048bf"></div>
<div class="outline-3" id="outline-container-orgb898a95">
<h3 id="orgb898a95">Using the Master Method</h3>
<div class="outline-text-3" id="text-orgb898a95">
<p>Let's use the Master Method to find the theoretical upper bound for Karatsuba Multiplication.</p>
<p>The basic form of the Master Method is this:</p>
<p>\[ T(n) = a T(\frac{n}{b}) + O(n^d) \]</p>
<table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups">
<colgroup>
<col class="org-left">
<col class="org-left">
<col class="org-right"></colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Variable</th>
<th class="org-left" scope="col">Description</th>
<th class="org-right" scope="col">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">\(a\)</td>
<td class="org-left">Recursive calls within the function</td>
<td class="org-right">3</td>
</tr>
<tr>
<td class="org-left">\(b\)</td>
<td class="org-left">Amount the input is split up</td>
<td class="org-right">2</td>
</tr>
<tr>
<td class="org-left">\(d\)</td>
<td class="org-left">Exponent for the work done outside of the recursion</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>
<p>We make three recursive calls within the Karatsuba function and split the data in half within each call. The amount of work done outside the recursion is constant so \(O\left(n^d\right) = O\left(n^1\right)\). \(a &gt; b^d\) so we have the case where the sub-problems grow faster than the input is reduced, giving us:</p>
\begin{align} T(n) &amp;= O\left(n^{\log_b a}\right) \\ &amp;= O\left(n^{\log_2 3}\right) \end{align}</div>
</div>
<div class="outline-3" id="outline-container-org941eb5d">
<h3 id="org941eb5d">With Padding</h3>
<div class="outline-text-3" id="text-org941eb5d">
<p>Let's plot the base-case counts alongside the theoretical bounds we found using the Master Method.</p>
<p>First we'll create the numbers to multiply.</p>
<div class="highlight">
<pre><span></span><span class="n">digit_supply</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>
<span class="n">things_to_multiply</span> <span class="o">=</span> <span class="p">[(</span><span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">digits</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">10</span><span class="o">**</span><span class="n">digits</span><span class="p">),</span>
                        <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">digits</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">10</span><span class="o">**</span><span class="n">digits</span><span class="p">))</span>
                        <span class="k">for</span> <span class="n">digits</span> <span class="ow">in</span> <span class="n">digit_supply</span><span class="p">]</span>
</pre></div>
<p>Now we'll do the math, running the cases in parallel using Joblib.</p>
<div class="highlight">
<pre><span></span><span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">karatsuba_outputs</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
        <span class="n">delayed</span><span class="p">(</span><span class="n">karatsuba_multiplication</span><span class="p">)(</span><span class="o">*</span><span class="n">thing_to_multiply</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">thing_to_multiply</span> <span class="ow">in</span> <span class="n">things_to_multiply</span><span class="p">)</span>
</pre></div>
<pre class="example">
Started: 2022-05-13 23:52:06.399789
Ended: 2022-05-13 23:52:09.347825
Elapsed: 0:00:02.948036
</pre>
<p>Now a little plotting.</p>
<div class="highlight">
<pre><span></span><span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">"Karatsuba Count"</span><span class="p">:</span> <span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">count</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">karatsuba_outputs</span><span class="p">],</span>
     <span class="s2">"Digits"</span><span class="p">:</span> <span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">digits</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">karatsuba_outputs</span><span class="p">],</span>
     <span class="s2">"digits^log2(3)"</span><span class="p">:</span> <span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">digits</span><span class="o">**</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">karatsuba_outputs</span><span class="p">],</span>
     <span class="s2">"6 x digits^log2(3)"</span><span class="p">:</span> <span class="p">[</span><span class="mi">6</span> <span class="o">*</span> <span class="n">output</span><span class="o">.</span><span class="n">digits</span><span class="o">**</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">karatsuba_outputs</span><span class="p">]</span>     
<span class="p">})</span>

<span class="n">melted</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Digits"</span><span class="p">],</span>  <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Karatsuba Count"</span><span class="p">,</span>
                                                     <span class="s2">"digits^log2(3)"</span><span class="p">,</span>
                                                     <span class="s2">"6 x digits^log2(3)"</span><span class="p">],</span>
                    <span class="n">var_name</span><span class="o">=</span><span class="s2">"Source"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Multiplications"</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">OverlayMarkDef</span><span class="p">())</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Digits"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Multiplications"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Source"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s2">"Digits"</span><span class="p">,</span>
             <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Multiplications"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">)])</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
                 <span class="n">title</span><span class="o">=</span><span class="s2">"Basic Multiplications vs Digits (with Padding)"</span><span class="p">,</span>
                 <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
                 <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"karatsuba-multiplications"</span><span class="p">)</span>
</pre></div>
<object data="posts/karatsuba-multiplication/karatsuba-multiplications.html" height="600" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>Since when I added the padding I made sure that the number of digits was a power of two, the numbers are bunched up around those powers of two (so there's a lot of wasted computation, maybe) but the multiplication counts still fall within a constant multiple of our theoretical runtime.</p>
</div>
</div>
<div class="outline-3" id="outline-container-orgdb3ffe0">
<h3 id="orgdb3ffe0">Without Padding</h3>
<div class="outline-text-3" id="text-orgdb3ffe0">
<p>Since I didn't make the karatsuba work without padding this will just show the points spaced out, but the counts will still be based on there being padding.</p>
<div class="highlight">
<pre><span></span><span class="n">unpadded</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">karatsuba_multiplication</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">count_padding</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="k">with</span> <span class="n">TIMER</span><span class="p">:</span>
    <span class="n">unpadded_outputs</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
        <span class="n">delayed</span><span class="p">(</span><span class="n">unpadded</span><span class="p">)(</span><span class="o">*</span><span class="n">thing_to_multiply</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">thing_to_multiply</span> <span class="ow">in</span> <span class="n">things_to_multiply</span><span class="p">)</span>
</pre></div>
<pre class="example">
Started: 2022-05-13 23:52:20.020179
Ended: 2022-05-13 23:52:22.052011
Elapsed: 0:00:02.031832
</pre>
<div class="highlight">
<pre><span></span><span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">"Karatsuba Count"</span><span class="p">:</span> <span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">count</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">unpadded_outputs</span><span class="p">],</span>
     <span class="s2">"Digits (pre-padding)"</span><span class="p">:</span> <span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">digits</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">unpadded_outputs</span><span class="p">],</span>
     <span class="s2">"digits^log2(3)"</span><span class="p">:</span> <span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">digits</span><span class="o">**</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">karatsuba_outputs</span><span class="p">],</span>
     <span class="s2">"6 x digits^log2(3)"</span><span class="p">:</span> <span class="p">[</span><span class="mi">6</span> <span class="o">*</span> <span class="n">output</span><span class="o">.</span><span class="n">digits</span><span class="o">**</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">karatsuba_outputs</span><span class="p">],</span>
     <span class="s2">"6 x digits^log2(3) (no padding)"</span><span class="p">:</span> <span class="p">[</span><span class="mi">6</span> <span class="o">*</span> <span class="n">output</span><span class="o">.</span><span class="n">digits</span><span class="o">**</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
                                         <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">unpadded_outputs</span><span class="p">],</span>
     <span class="s2">"n^2 (no padding)"</span><span class="p">:</span> <span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">digits</span><span class="o">**</span><span class="mi">2</span>
                          <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">unpadded_outputs</span><span class="p">],</span>
<span class="p">})</span>

<span class="n">melted</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Digits (pre-padding)"</span><span class="p">],</span>  <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Karatsuba Count"</span><span class="p">,</span>
                                                                   <span class="s2">"digits^log2(3)"</span><span class="p">,</span>
                                                                   <span class="s2">"6 x digits^log2(3)"</span><span class="p">,</span>
                                                                   <span class="s2">"6 x digits^log2(3) (no padding)"</span><span class="p">,</span>
                                                                   <span class="s2">"n^2 (no padding)"</span><span class="p">],</span>
                    <span class="n">var_name</span><span class="o">=</span><span class="s2">"Source"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Multiplications"</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">"Digits (pre-padding)"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Multiplications"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Source"</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Digits (pre-padding)"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"quantitative"</span><span class="p">),</span>
             <span class="n">altair</span><span class="o">.</span><span class="n">Tooltip</span><span class="p">(</span><span class="s2">"Multiplications"</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">","</span><span class="p">)])</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
                 <span class="n">title</span><span class="o">=</span><span class="s2">"Basic Multiplications vs Digits (without Padding)"</span><span class="p">,</span>
                 <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
                 <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"karatsuba-multiplications-unpadded"</span><span class="p">)</span>
</pre></div>
<object data="posts/karatsuba-multiplication/karatsuba-multiplications-unpadded.html" height="600" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>Since I don't have an easy way to turn off using padding the Multiplication counts are still based on using padding, but this view spreads the digit-counts out so it's a little easier to see. The Multiplication counts are broken up into bands because the padding is based on keeping the number of digits a power of two.</p>
<p>Just for reference, here's the last product we multiplied.</p>
<div class="highlight">
<pre><span></span><span class="n">output</span> <span class="o">=</span> <span class="n">karatsuba_outputs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">output</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">integer</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">product</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">factor_1</span> <span class="o">*</span> <span class="n">output</span><span class="o">.</span><span class="n">factor_2</span><span class="p">))</span>
</pre></div>
<pre class="example">
56,913,917,723,202,495,576,238,408,244,650,506,926,406,731,625,206,370,840,517,493,281,396,538,892,710,818,017,869,257,379,987,881,688,195,601,612,438,838,803,669,047,089,313,679,236,814,971,999,554,405,895,121,583,263,228,500,933,878,783,310,375,258,385,063,631,332
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-orgaf627af">
<h2 id="orgaf627af">Sources</h2>
<div class="outline-text-2" id="text-orgaf627af"></div>
<div class="outline-3" id="outline-container-orgd435d21">
<h3 id="orgd435d21">Karatsuba Multiplicatio</h3>
<div class="outline-text-3" id="text-orgd435d21">
<ul class="org-ul">
<li><a href="posts/algorithms-illuminated-part-1/index.html">Algorithms Illuminated - Part 1: The Basics</a></li>
<li><a href="https://en.wikipedia.org/wiki/Karatsuba_algorithm">Wikipedia: Karatsuba Algorithm</a></li>
</ul>
</div>
</div>
<div class="outline-3" id="outline-container-org8fd4298">
<h3 id="org8fd4298">Grade-School Multiplication</h3>
<div class="outline-text-3" id="text-org8fd4298">
<p>I took the grade-school algorithm from the Lecture 2 Notes on this course-site.</p>
<ul class="org-ul">
<li>McGill University School of Computer Science: COMP 250 (sec 1) [Internet]. [cited 2022 May 14]. Available from: <a href="http://crypto.cs.mcgill.ca/~crepeau/COMP250/">http://crypto.cs.mcgill.ca/~crepeau/COMP250/</a></li>
</ul>
<script>
window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("karatsuba"));
});
</script>
<script>

window.addEventListener('load', function () {
    pseudocode.renderElement(document.getElementById("grade-school"));
});
</script></div>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/the-maximum-subarray-problem/index.html">The Maximum-Subarray Problem</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/the-maximum-subarray-problem/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-05-07T16:49:09-07:00" itemprop="datePublished" title="2022-05-07 16:49">2022-05-07 16:49</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/the-maximum-subarray-problem/index.html#orge80461d">Imports and Setup</a>
<ul>
<li><a href="posts/the-maximum-subarray-problem/index.html#org83ac760">Imports</a></li>
<li><a href="posts/the-maximum-subarray-problem/index.html#orgc52d894">Set Up</a></li>
</ul>
</li>
<li><a href="posts/the-maximum-subarray-problem/index.html#org54cd503">Implementations</a>
<ul>
<li><a href="posts/the-maximum-subarray-problem/index.html#org850522e">Test Case</a></li>
<li><a href="posts/the-maximum-subarray-problem/index.html#orgef1fd23">Brute Force</a></li>
<li><a href="posts/the-maximum-subarray-problem/index.html#orgff64932">Recursive</a>
<ul>
<li><a href="posts/the-maximum-subarray-problem/index.html#orga6f2f0c">Max-Crossing-Subarray</a></li>
<li><a href="posts/the-maximum-subarray-problem/index.html#org6c38c4c">Max-Subarray</a></li>
</ul>
</li>
<li><a href="posts/the-maximum-subarray-problem/index.html#org6e64d4a">Alternate Version</a></li>
</ul>
</li>
<li><a href="posts/the-maximum-subarray-problem/index.html#org5ee6cac">Comparing the Methods</a>
<ul>
<li>
<ul>
<li><a href="posts/the-maximum-subarray-problem/index.html#org0a649ce">Plot It</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="posts/the-maximum-subarray-problem/index.html#org898eaf3">Sources</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orge80461d">
<h2 id="orge80461d">Imports and Setup</h2>
<div class="outline-text-2" id="text-orge80461d"></div>
<div class="outline-3" id="outline-container-org83ac760">
<h3 id="org83ac760">Imports</h3>
<div class="outline-text-3" id="text-org83ac760">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">inf</span> <span class="k">as</span> <span class="n">infinity</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">log2</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># pypi</span>
<span class="kn">import</span> <span class="nn">altair</span>
<span class="kn">import</span> <span class="nn">pandas</span>

<span class="c1"># my stuff</span>
<span class="kn">from</span> <span class="nn">graeae</span> <span class="kn">import</span> <span class="n">Timer</span>
<span class="kn">from</span> <span class="nn">graeae.visualization.altair_helpers</span> <span class="kn">import</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">save_chart</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgc52d894">
<h3 id="orgc52d894">Set Up</h3>
<div class="outline-text-3" id="text-orgc52d894">
<div class="highlight">
<pre><span></span><span class="n">TIMER</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">()</span>

<span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"the-maximum-subarray-problem"</span>
<span class="n">OUTPUT_PATH</span> <span class="o">=</span> <span class="n">output_path</span><span class="p">(</span><span class="n">SLUG</span><span class="p">)</span>
<span class="n">save_it</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">save_chart</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">OUTPUT_PATH</span><span class="p">)</span>

<span class="n">MAXIMUM_SUBARRAY</span> <span class="o">=</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
<span class="n">Case</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">"Case"</span><span class="p">,</span> <span class="p">[</span><span class="s2">"inputs"</span><span class="p">,</span> <span class="s2">"left"</span><span class="p">,</span> <span class="s2">"right"</span><span class="p">,</span> <span class="s2">"max"</span><span class="p">])</span>

<span class="n">Plot</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">"Plot"</span><span class="p">,</span> <span class="p">[</span><span class="s2">"height"</span><span class="p">,</span> <span class="s2">"width"</span><span class="p">],</span> <span class="n">defaults</span><span class="o">=</span><span class="p">[</span><span class="mi">700</span><span class="p">,</span> <span class="mi">1000</span><span class="p">])</span>
<span class="n">PLOT</span> <span class="o">=</span> <span class="n">Plot</span><span class="p">()</span>

<span class="n">Output</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">"Output"</span><span class="p">,</span> <span class="p">[</span><span class="s2">"start"</span><span class="p">,</span> <span class="s2">"end"</span><span class="p">,</span> <span class="s2">"gain"</span><span class="p">,</span> <span class="s2">"runtime"</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org54cd503">
<h2 id="org54cd503">Implementations</h2>
<div class="outline-text-2" id="text-org54cd503">
<p>The motivation given by the text is that we have some data that varies over time and we want to find the pair of points that maximizes the gain from the first point to the second.</p>
</div>
<div class="outline-3" id="outline-container-org850522e">
<h3 id="org850522e">Test Case</h3>
<div class="outline-text-3" id="text-org850522e">
<div class="highlight">
<pre><span></span><span class="n">CASE_ONE</span> <span class="o">=</span> <span class="n">Case</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">113</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span>
                 <span class="mi">101</span><span class="p">,</span> <span class="mi">94</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span> <span class="mi">94</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">97</span><span class="p">],</span>
                <span class="n">left</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
                <span class="n">right</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
                <span class="nb">max</span><span class="o">=</span><span class="mi">43</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">CASE_ONE</span><span class="o">.</span><span class="n">inputs</span>
<span class="n">changes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>

<span class="n">frame</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"Numbers"</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
                          <span class="s2">"Change"</span><span class="p">:</span> <span class="n">changes</span><span class="p">})</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">melted</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">melted</span> <span class="o">=</span> <span class="n">melted</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"index"</span><span class="p">],</span> <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Numbers"</span><span class="p">,</span> <span class="s2">"Change"</span><span class="p">]</span> <span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">"Data Source"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Data"</span><span class="p">)</span>
<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"index"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"quantitative"</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Data"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"quantitative"</span><span class="p">),</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Data Source"</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">"Sample Input One"</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">PLOT</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"sample-input-one"</span><span class="p">)</span>
</pre></div>
<object data="posts/the-maximum-subarray-problem/sample-input-one.html" height="600" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
<div class="outline-3" id="outline-container-orgef1fd23">
<h3 id="orgef1fd23">Brute Force</h3>
<div class="outline-text-3" id="text-orgef1fd23">
<p>The first way we're going to find the maximum gain is using Brute Force - we're going to calculate the gain for each pair of points and picking the pair with the best gain. Since this involves checking every pair we're essentially looking at a Handshake Problem so the number of comparisons should be \(\frac{n(n - 1)}{2}\) or \(\Theta(n^2)\).</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">brute_force_maximum_subarray</span><span class="p">(</span><span class="n">source</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Output</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Finds the subarray with maximum gain</span>

<span class="sd">    Args:</span>
<span class="sd">     source: sequence with sub-array to maximize</span>

<span class="sd">    Returns:</span>
<span class="sd">     (left-max-index, right-max-index, gain, count)</span>
<span class="sd">    """</span>
    <span class="n">best_left</span> <span class="o">=</span> <span class="n">best_right</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">best_gain</span> <span class="o">=</span> <span class="o">-</span><span class="n">infinity</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">left</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">right</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">left</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">source</span><span class="p">)):</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">gain</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="n">right</span><span class="p">]</span> <span class="o">-</span> <span class="n">source</span><span class="p">[</span><span class="n">left</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">gain</span> <span class="o">&gt;</span> <span class="n">best_gain</span><span class="p">:</span>
                <span class="n">best_left</span><span class="p">,</span> <span class="n">best_right</span><span class="p">,</span> <span class="n">best_gain</span> <span class="o">=</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">gain</span>
    <span class="k">return</span> <span class="n">Output</span><span class="p">(</span><span class="n">best_left</span><span class="p">,</span> <span class="n">best_right</span><span class="p">,</span> <span class="n">best_gain</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">CASE_ONE</span><span class="o">.</span><span class="n">inputs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"n = </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">brute_force_maximum_subarray</span><span class="p">(</span><span class="n">CASE_ONE</span><span class="o">.</span><span class="n">inputs</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">output</span><span class="o">.</span><span class="n">start</span> <span class="o">==</span> <span class="n">CASE_ONE</span><span class="o">.</span><span class="n">left</span>
<span class="k">assert</span> <span class="n">output</span><span class="o">.</span><span class="n">end</span> <span class="o">==</span> <span class="n">CASE_ONE</span><span class="o">.</span><span class="n">right</span>
<span class="k">assert</span> <span class="n">output</span><span class="o">.</span><span class="n">gain</span> <span class="o">==</span> <span class="n">CASE_ONE</span><span class="o">.</span><span class="n">max</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"count = </span><span class="si">{</span><span class="n">output</span><span class="o">.</span><span class="n">runtime</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"n(n-1)/2 = </span><span class="si">{</span><span class="nb">int</span><span class="p">((</span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"n^2 = </span><span class="si">{</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
n = 17
count = 136
n(n-1)/2 = 136
n^2 = 289
</pre></div>
</div>
<div class="outline-3" id="outline-container-orgff64932">
<h3 id="orgff64932">Recursive</h3>
<div class="outline-text-3" id="text-orgff64932">
<p>Looking at the brute-force solution you might think - "That was a check of point-pairs, why is this called 'max-subarray'?". Well, we're going to improve upon the brute-force implementation by doing a data-transformation. If you look at the data that we set up you might notice that there's the point values and then there's the change in value from one point to another. The changes are there because we can re-think our problem not as the maximum of increases between pair points, but instead as the maximum of point-change-sums.</p>
<p>In our <code>CASE_ONE</code> inputs, the biggest gain came from point 7 (with a value of 63) and point 11 (with a value of 106). If we look at the difference between consecutive points from points 7 to 11 we get -23, 18, 20, -7, 12 which sums to 20, which is the maximum sub-array total for this data set. To solve this problem we're going to need to find this sub-array. Since we stated that we're going to use a divide-and-conquer approach we know that we're going to repeatedly break the inputs up into (in this case) two separate sub-sets to solve. Every time we break the inputs into two groups we end up with three possibilities as to where the maximum sub-array lies:</p>
<ul class="org-ul">
<li>in the left half</li>
<li>in the right half</li>
<li>crossing from the left half over the split to the right half</li>
</ul>
</div>
<div class="outline-4" id="outline-container-orga6f2f0c">
<h4 id="orga6f2f0c">Max-Crossing-Subarray</h4>
<div class="outline-text-4" id="text-orga6f2f0c">
<p>This is a function that will find the best subarray in the left and in the right halves of the sub-array and combines them to find the gain across the mid-point of the subarray.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">find_max_crossing_subarray</span><span class="p">(</span><span class="n">source</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">,</span>
                               <span class="n">low</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">mid</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                               <span class="n">high</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Output</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Find the max subarray that crosses the mid-point</span>

<span class="sd">    Args:</span>
<span class="sd">     source: the array to search for the sub-sequence in</span>
<span class="sd">     low: the lower-bound for the indices to search within</span>
<span class="sd">     mid: the mid-index between low and high</span>
<span class="sd">     high: the upper-bound for the indices to search within</span>

<span class="sd">    Returns:</span>
<span class="sd">     left-index, right-index, gain, count</span>
<span class="sd">    """</span>
    <span class="n">count</span><span class="p">,</span> <span class="n">best_left</span><span class="p">,</span> <span class="n">best_right</span><span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="n">left_gain</span> <span class="o">=</span> <span class="n">right_gain</span> <span class="o">=</span> <span class="o">-</span><span class="n">infinity</span>
    <span class="n">gain</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">left</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mid</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">gain</span> <span class="o">+=</span> <span class="n">source</span><span class="p">[</span><span class="n">left</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">gain</span> <span class="o">&gt;</span> <span class="n">left_gain</span><span class="p">:</span>
            <span class="n">left_gain</span> <span class="o">=</span> <span class="n">gain</span>
            <span class="n">best_left</span> <span class="o">=</span> <span class="n">left</span>
    <span class="n">gain</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">right</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">high</span><span class="p">):</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">gain</span> <span class="o">+=</span> <span class="n">source</span><span class="p">[</span><span class="n">right</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">gain</span> <span class="o">&gt;</span> <span class="n">right_gain</span><span class="p">:</span>
            <span class="n">right_gain</span> <span class="o">=</span> <span class="n">gain</span>
            <span class="n">best_right</span> <span class="o">=</span> <span class="n">right</span>
    <span class="k">return</span> <span class="n">Output</span><span class="p">(</span><span class="n">best_left</span><span class="p">,</span> <span class="n">best_right</span><span class="p">,</span> <span class="n">left_gain</span> <span class="o">+</span> <span class="n">right_gain</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org6c38c4c">
<h4 id="org6c38c4c">Max-Subarray</h4>
<div class="outline-text-4" id="text-org6c38c4c">
<p>The <code>find_maximum_subarray</code> function finds the start and end indices for the best gain.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">find_maximum_subarray</span><span class="p">(</span><span class="n">source</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">,</span>
                          <span class="n">low</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">high</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Output</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Find the sub-array that maximizes gain</span>

<span class="sd">    Args:</span>
<span class="sd">     source: sequence to maximize</span>
<span class="sd">     low: lower-bound for indices in source</span>
<span class="sd">     high: upper-bound for indices in source</span>

<span class="sd">    Returns:</span>
<span class="sd">     left-index, right-index, gain, count</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">high</span> <span class="o">==</span> <span class="n">low</span><span class="p">:</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">source</span><span class="p">[</span><span class="n">low</span><span class="p">],</span> <span class="mi">1</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">low</span> <span class="o">+</span> <span class="n">high</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>

        <span class="n">left</span> <span class="o">=</span> <span class="n">find_maximum_subarray</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">mid</span><span class="p">)</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">find_maximum_subarray</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
        <span class="n">cross_mid</span> <span class="o">=</span> <span class="n">find_max_crossing_subarray</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>

        <span class="n">count</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">runtime</span> <span class="o">+</span> <span class="n">right</span><span class="o">.</span><span class="n">runtime</span> <span class="o">+</span> <span class="n">cross_mid</span><span class="o">.</span><span class="n">runtime</span>

        <span class="n">best_gain</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">left</span><span class="o">.</span><span class="n">gain</span><span class="p">,</span> <span class="n">right</span><span class="o">.</span><span class="n">gain</span><span class="p">,</span> <span class="n">cross_mid</span><span class="o">.</span><span class="n">gain</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">left</span><span class="o">.</span><span class="n">gain</span> <span class="o">==</span> <span class="n">best_gain</span><span class="p">:</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">left</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="n">left</span><span class="o">.</span><span class="n">gain</span><span class="p">,</span> <span class="n">count</span>
        <span class="k">elif</span> <span class="n">right</span><span class="o">.</span><span class="n">gain</span> <span class="o">==</span> <span class="n">best_gain</span><span class="p">:</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">right</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="n">right</span><span class="o">.</span><span class="n">gain</span><span class="p">,</span> <span class="n">count</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="p">(</span><span class="n">cross_mid</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">cross_mid</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
                                       <span class="n">cross_mid</span><span class="o">.</span><span class="n">gain</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Output</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</pre></div>
<p>The <code>maximum_subarray</code> converts our list of values to a list of changes between consecutive values so that we can use our divide-and-conquer function.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">maximum_subarray</span><span class="p">(</span><span class="n">source</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Output</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Finds the sub-array with maximum gain</span>

<span class="sd">    Args:</span>
<span class="sd">     source: array to maximize</span>

<span class="sd">    Returns:</span>
<span class="sd">     left-index, right-index, gain, count</span>
<span class="sd">    """</span>
    <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">changes</span> <span class="o">=</span> <span class="p">[</span><span class="n">source</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">source</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">end</span><span class="p">)]</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">find_maximum_subarray</span><span class="p">(</span><span class="n">changes</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># our 'changes' has one fewer entry than the original list so up the right index by 1</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">end</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">Output</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">gain</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">runtime</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">CASE_ONE</span><span class="o">.</span><span class="n">inputs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"n = </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">maximum_subarray</span><span class="p">(</span><span class="n">CASE_ONE</span><span class="o">.</span><span class="n">inputs</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">output</span><span class="o">.</span><span class="n">start</span> <span class="o">==</span> <span class="n">CASE_ONE</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"Expected: </span><span class="si">{</span><span class="n">CASE_ONE</span><span class="o">.</span><span class="n">left</span><span class="si">}</span><span class="s2">, Actual: </span><span class="si">{</span><span class="n">output</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s2">"</span>
<span class="k">assert</span> <span class="n">output</span><span class="o">.</span><span class="n">end</span> <span class="o">==</span> <span class="n">CASE_ONE</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"Expected: </span><span class="si">{</span><span class="n">CASE_ONE</span><span class="o">.</span><span class="n">right</span><span class="si">}</span><span class="s2">, Actual: </span><span class="si">{</span><span class="n">output</span><span class="o">.</span><span class="n">end</span><span class="si">}</span><span class="s2">"</span>
<span class="k">assert</span> <span class="n">output</span><span class="o">.</span><span class="n">gain</span> <span class="o">==</span> <span class="n">CASE_ONE</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"Expected: </span><span class="si">{</span><span class="n">CASE_ONE</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">, Actual: </span><span class="si">{</span><span class="n">output</span><span class="o">.</span><span class="n">gain</span><span class="si">}</span><span class="s2">"</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"left: </span><span class="si">{</span><span class="n">output</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s2">, right: </span><span class="si">{</span><span class="n">output</span><span class="o">.</span><span class="n">end</span><span class="si">}</span><span class="s2">, gain: </span><span class="si">{</span><span class="n">output</span><span class="o">.</span><span class="n">gain</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"count = </span><span class="si">{</span><span class="n">output</span><span class="o">.</span><span class="n">runtime</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"n(n-1)/2 = </span><span class="si">{</span><span class="nb">int</span><span class="p">((</span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"n log n : </span><span class="si">{</span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">log2</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="si">:</span><span class="s2"> 0.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"n^2 = </span><span class="si">{</span><span class="n">n</span><span class="o">**</span><span class="mi">2</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
n = 17
left: 7, right: 11, gain: 43
count = 50
n(n-1)/2 = 136
n log n :  69.49
n^2 = 289
</pre>
<p>By transforming the problem to one that lets us use divide-and-conquer we reduced the number of comparisons from 136 to 50. More generally, if we look at <code>find_maximum_subarray</code> we see that we're splitting the input in half before each of the recursive calls so we're going to make \(log_2 n\) splits and at each level of the recursions tree we're going to have \(2n\) inputs (<code>left</code> and <code>right</code> are each \(\frac{1}{2} n\) and <code>cross_mid</code> uses \(n\)) so we're going from \(\Theta(n^2)\) for the brute-force verios to \(\Theta(n \log n)\) for the divide-and-conquer version.</p>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org6e64d4a">
<h3 id="org6e64d4a">Alternate Version</h3>
<div class="outline-text-3" id="text-org6e64d4a">
<p>Let's try another version that uses the idea of summing the changes between consecutive points but doesn't use recursion (see <a href="https://en.wikipedia.org/wiki/Maximum_subarray_problem#Computing_the_best_subarray's_position">Wikipedia: Kardane's algorithm</a>).</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">max_subarray_2</span><span class="p">(</span><span class="n">source</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Output</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Gets the maximal subarray</span>

<span class="sd">    This is an alternate version that doesn't use recursion or brute-force</span>

<span class="sd">    Args:</span>
<span class="sd">     source: sequence to maximize</span>

<span class="sd">    Returns:</span>
<span class="sd">     left-index, right-index, gain, count</span>
<span class="sd">    """</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">best_total</span> <span class="o">=</span> <span class="o">-</span><span class="n">infinity</span>
    <span class="n">best_start</span> <span class="o">=</span> <span class="n">best_end</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">current_total</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">changes</span> <span class="o">=</span> <span class="p">[</span><span class="n">source</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">source</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">here</span><span class="p">,</span> <span class="n">value_here</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">changes</span><span class="p">):</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">current_total</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">current_start</span> <span class="o">=</span> <span class="n">here</span>
            <span class="n">current_total</span> <span class="o">=</span> <span class="n">value_here</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">current_total</span> <span class="o">+=</span> <span class="n">value_here</span>

        <span class="k">if</span> <span class="n">current_total</span> <span class="o">&gt;</span> <span class="n">best_total</span><span class="p">:</span>
            <span class="n">best_total</span> <span class="o">=</span> <span class="n">current_total</span>
            <span class="n">best_start</span> <span class="o">=</span> <span class="n">current_start</span>
            <span class="n">best_end</span> <span class="o">=</span> <span class="n">here</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">Output</span><span class="p">(</span><span class="n">best_start</span><span class="p">,</span> <span class="n">best_end</span><span class="p">,</span> <span class="n">best_total</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">CASE_ONE</span><span class="o">.</span><span class="n">inputs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"n = </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="n">max_subarray_2</span><span class="p">(</span><span class="n">CASE_ONE</span><span class="o">.</span><span class="n">inputs</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">left</span> <span class="o">==</span> <span class="n">CASE_ONE</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"Expected: </span><span class="si">{</span><span class="n">CASE_ONE</span><span class="o">.</span><span class="n">left</span><span class="si">}</span><span class="s2">, Actual: </span><span class="si">{</span><span class="n">left</span><span class="si">}</span><span class="s2">"</span>
<span class="k">assert</span> <span class="n">right</span> <span class="o">==</span> <span class="n">CASE_ONE</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"Expected: </span><span class="si">{</span><span class="n">CASE_ONE</span><span class="o">.</span><span class="n">right</span><span class="si">}</span><span class="s2">, Actual: </span><span class="si">{</span><span class="n">right</span><span class="si">}</span><span class="s2">"</span>
<span class="k">assert</span> <span class="n">gain</span> <span class="o">==</span> <span class="n">CASE_ONE</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"Expected: </span><span class="si">{</span><span class="n">CASE_ONE</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">, Actual: </span><span class="si">{</span><span class="n">gain</span><span class="si">}</span><span class="s2">"</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"left: </span><span class="si">{</span><span class="n">left</span><span class="si">}</span><span class="s2">, right: </span><span class="si">{</span><span class="n">right</span><span class="si">}</span><span class="s2">, gain: </span><span class="si">{</span><span class="n">gain</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Count: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
n = 17
left: 7, right: 11, gain: 43
Count: 17
</pre>
<p>So, without using divide-and-conquer we get an even better runtime - it was the data transformation that was the most valuable part in improving the performance.</p>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org5ee6cac">
<h2 id="org5ee6cac">Comparing the Methods</h2>
<div class="outline-text-2" id="text-org5ee6cac">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">run_thing</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"*** </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> ***"</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">runtime</span> <span class="o">=</span> <span class="n">thing</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span><span class="o">.</span><span class="n">runtime</span>
    <span class="n">stop</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\t</span><span class="s2">Elapsed Time: </span><span class="si">{</span><span class="n">stop</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">runtime</span>

<span class="n">brutes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">divided</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">linear</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">counts</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">UPPER</span> <span class="o">=</span> <span class="mi">6</span>
<span class="k">for</span> <span class="n">exponent</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">UPPER</span><span class="p">):</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">exponent</span>
    <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"n = </span><span class="si">{</span><span class="n">count</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">"</span>
    <span class="n">underline</span> <span class="o">=</span> <span class="s2">"="</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">underline</span><span class="p">)</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>
    <span class="n">brutes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">run_thing</span><span class="p">(</span><span class="n">brute_force_maximum_subarray</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="s2">"Brute Force"</span><span class="p">))</span>
    <span class="n">divided</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">run_thing</span><span class="p">(</span><span class="n">maximum_subarray</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="s2">"Divide and Conquer"</span><span class="p">))</span>
    <span class="n">linear</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">run_thing</span><span class="p">(</span><span class="n">max_subarray_2</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="s2">"Linear"</span><span class="p">))</span>
    <span class="n">counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
</pre></div>
<pre class="example" id="org8905d07">

n = 10
======
*** Brute Force ***
        Elapsed Time: 0:00:00.001054
*** Divide and Conquer ***
        Elapsed Time: 0:00:00.000249
*** Linear ***
        Elapsed Time: 0:00:00.000127

n = 100
=======
*** Brute Force ***
        Elapsed Time: 0:00:00.002403
*** Divide and Conquer ***
        Elapsed Time: 0:00:00.002198
*** Linear ***
        Elapsed Time: 0:00:00.000175

n = 1,000
=========
*** Brute Force ***
        Elapsed Time: 0:00:00.002527
*** Divide and Conquer ***
        Elapsed Time: 0:00:00.017359
*** Linear ***
        Elapsed Time: 0:00:00.002204

n = 10,000
==========
*** Brute Force ***
        Elapsed Time: 0:00:00.071900
*** Divide and Conquer ***
        Elapsed Time: 0:00:00.044104
*** Linear ***
        Elapsed Time: 0:00:00.000224

n = 100,000
===========
*** Brute Force ***
        Elapsed Time: 0:00:07.506323
*** Divide and Conquer ***
        Elapsed Time: 0:00:00.023113
*** Linear ***
        Elapsed Time: 0:00:00.001233
</pre></div>
<div class="outline-4" id="outline-container-org0a649ce">
<h4 id="org0a649ce">Plot It</h4>
<div class="outline-text-4" id="text-org0a649ce">
<div class="highlight">
<pre><span></span><span class="n">runtimes</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"Brute Force"</span><span class="p">:</span> <span class="n">brutes</span><span class="p">,</span>
                             <span class="s2">"Divide and Conquer"</span><span class="p">:</span> <span class="n">divided</span><span class="p">,</span>
                             <span class="s2">"Linear"</span><span class="p">:</span> <span class="n">linear</span><span class="p">,</span>
                             <span class="s2">"Input Size"</span><span class="p">:</span> <span class="n">counts</span><span class="p">})</span>

<span class="n">melted</span> <span class="o">=</span> <span class="n">runtimes</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Input Size"</span><span class="p">],</span>
                       <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Brute Force"</span><span class="p">,</span> <span class="s2">"Divide and Conquer"</span><span class="p">,</span> <span class="s2">"Linear"</span><span class="p">],</span>
                       <span class="n">var_name</span><span class="o">=</span><span class="s2">"Algorithm"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">OverlayMarkDef</span><span class="p">())</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Input Size"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"quantitative"</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Comparisons"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"quantitative"</span><span class="p">),</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Algorithm"</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Comparison Counts"</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">PLOT</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"algorithm_comparisons"</span><span class="p">)</span>
</pre></div>
<object data="posts/the-maximum-subarray-problem/algorithm_comparisons.html" height="600" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object>
<p>Stepping up to a million with Brute Force takes too long (I've never let it run to the end to see how long). Let's see if the linear and divide and conquer can handle it, though.</p>
<div class="highlight">
<pre><span></span><span class="n">linear_more</span> <span class="o">=</span> <span class="n">linear</span><span class="p">[:]</span>
<span class="n">divided_more</span> <span class="o">=</span> <span class="n">divided</span><span class="p">[:]</span>
<span class="n">counts_more</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[:]</span>

<span class="k">for</span> <span class="n">exponent</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">exponent</span>
    <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"n = </span><span class="si">{</span><span class="n">count</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">"</span>
    <span class="n">underline</span> <span class="o">=</span> <span class="s2">"="</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">underline</span><span class="p">)</span>

    <span class="n">inputs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>

    <span class="n">linear_more</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">run_thing</span><span class="p">(</span><span class="n">max_subarray_2</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="s2">"Linear"</span><span class="p">))</span>
    <span class="n">divided_more</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">run_thing</span><span class="p">(</span><span class="n">maximum_subarray</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="s2">"Divide and Conquer"</span><span class="p">))</span>
    <span class="n">counts_more</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
</pre></div>
<pre class="example" id="org922fc34">

n = 1,000,000
=============
*** Linear ***
        Elapsed Time: 0:00:00.008010
*** Divide and Conquer ***
        Elapsed Time: 0:00:00.294771

n = 10,000,000
==============
*** Linear ***
        Elapsed Time: 0:00:00.169138
*** Divide and Conquer ***
        Elapsed Time: 0:00:02.018406

n = 100,000,000
===============
*** Linear ***
        Elapsed Time: 0:00:00.850640
*** Divide and Conquer ***
        Elapsed Time: 0:00:21.290975

n = 1,000,000,000
=================
*** Linear ***
        Elapsed Time: 0:00:07.666758
*** Divide and Conquer ***
        Elapsed Time: 0:03:32.097027
</pre>
<p>They do pretty well, it seems to be the brute force that dies out.</p>
<div class="highlight">
<pre><span></span><span class="n">longtimes</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">"Linear"</span><span class="p">:</span> <span class="n">linear_more</span><span class="p">,</span>
                              <span class="s2">"Divide & Conquer"</span><span class="p">:</span> <span class="n">divided_more</span><span class="p">,</span>
                              <span class="s2">"Input Size"</span><span class="p">:</span> <span class="n">counts_more</span><span class="p">})</span>

<span class="n">melted</span> <span class="o">=</span> <span class="n">longtimes</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Input Size"</span><span class="p">],</span>
                       <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"Divide & Conquer"</span><span class="p">,</span> <span class="s2">"Linear"</span><span class="p">],</span>
                       <span class="n">var_name</span><span class="o">=</span><span class="s2">"Algorithm"</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">"Comparisons"</span><span class="p">)</span>
<span class="n">chart</span> <span class="o">=</span> <span class="n">altair</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">melted</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">OverlayMarkDef</span><span class="p">())</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">"Input Size"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"quantitative"</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">altair</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">"Comparisons"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"quantitative"</span><span class="p">),</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">"Algorithm"</span><span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">"Comparison Counts"</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">PLOT</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">525</span><span class="p">)</span>

<span class="n">save_it</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="s2">"longer_algorithm_comparisons"</span><span class="p">)</span>
</pre></div>
<object data="posts/the-maximum-subarray-problem/longer_algorithm_comparisons.html" height="600" style="width:100%" type="text/html">
<p>Figure Missing</p>
</object></div>
</div>
</div>
<div class="outline-2" id="outline-container-org898eaf3">
<h2 id="org898eaf3">Sources</h2>
<div class="outline-text-2" id="text-org898eaf3">
<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/Maximum_subarray_problem">Wikipedia: Maximum Subarray Problem</a></li>
<li><a href="posts/clrs/index.html">Introduction To Algorithms (CLRS)</a></li>
</ul>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/shortest-paths-dijkstras-algorithm/index.html">Shortest Paths: Dijkstra's Algorithm</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/shortest-paths-dijkstras-algorithm/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-04-27T19:59:56-07:00" itemprop="datePublished" title="2022-04-27 19:59">2022-04-27 19:59</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/shortest-paths-dijkstras-algorithm/index.html#org014a6c8">Setup</a></li>
<li><a href="posts/shortest-paths-dijkstras-algorithm/index.html#org1e7fd44">Dijkstra's Algorithm</a></li>
<li><a href="posts/shortest-paths-dijkstras-algorithm/index.html#org0ea771d">Test It</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org014a6c8">
<h2 id="org014a6c8">Setup</h2>
<div class="outline-text-2" id="text-org014a6c8">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">queue</span> <span class="kn">import</span> <span class="n">PriorityQueue</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">be</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span> 
<span class="c1"># this project</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.graphs.shortest_paths</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Edge</span><span class="p">,</span>
    <span class="n">Graph</span><span class="p">,</span>
    <span class="n">Vertex</span><span class="p">,</span>
    <span class="n">initialize_single_source</span><span class="p">,</span>
    <span class="n">relax</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org1e7fd44">
<h2 id="org1e7fd44">Dijkstra's Algorithm</h2>
<div class="outline-text-2" id="text-org1e7fd44">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">dijkstras_shortest_paths</span><span class="p">(</span><span class="n">graph</span><span class="p">:</span> <span class="n">Graph</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Vertex</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Find the shortest paths beginning at the source</span>

<span class="sd">    Args:</span>
<span class="sd">     graph: the vertices and edges to use</span>
<span class="sd">     source: the starting vertex for the paths</span>
<span class="sd">    """</span>
    <span class="n">initialize_single_source</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
    <span class="n">shortest</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">queue</span> <span class="o">=</span> <span class="n">PriorityQueue</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
        <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">vertex</span><span class="p">)</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">queue</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
        <span class="n">vertex</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="n">shortest</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vertex</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">adjacent</span><span class="p">[</span><span class="n">vertex</span><span class="p">]:</span>
            <span class="n">relax</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org0ea771d">
<h2 id="org0ea771d">Test It</h2>
<div class="outline-text-2" id="text-org0ea771d">
<div class="highlight">
<pre><span></span><span class="n">nodes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="s2">"stxyz"</span><span class="p">:</span>
    <span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">Vertex</span><span class="p">(</span><span class="n">identifier</span><span class="o">=</span><span class="n">node</span><span class="p">)</span>

<span class="n">graph</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>

<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"s"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"t"</span><span class="p">],</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"s"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"y"</span><span class="p">],</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"t"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"t"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"y"</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>

<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"z"</span><span class="p">],</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"y"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"t"</span><span class="p">],</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"y"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"y"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"z"</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>

<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"z"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"s"</span><span class="p">],</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"z"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">dijkstras_shortest_paths</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"s"</span><span class="p">])</span>

<span class="n">pprint</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vertices</span><span class="p">)</span>

<span class="n">expected</span> <span class="o">=</span> <span class="p">((</span><span class="s2">"s"</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">"y"</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">"s"</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">"z"</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="s2">"y"</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">"t"</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">"y"</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">"x"</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="s2">"t"</span><span class="p">))</span>

<span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">path_estimate</span><span class="p">,</span> <span class="n">predecessor</span> <span class="ow">in</span> <span class="n">expected</span><span class="p">:</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">predecessor</span><span class="p">]</span> <span class="k">if</span> <span class="n">predecessor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">predecessor</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">path_estimate</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">path_estimate</span><span class="p">))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">predecessor</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span>
</pre></div>
<pre class="example">
{s (path-estimate=0),
 y (path-estimate=5),
 z (path-estimate=7),
 t (path-estimate=8),
 x (path-estimate=9)}
</pre></div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/shortest-paths-bellman-ford/index.html">Shortest Paths: Bellman-Ford</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/shortest-paths-bellman-ford/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-04-27T18:25:23-07:00" itemprop="datePublished" title="2022-04-27 18:25">2022-04-27 18:25</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/shortest-paths-bellman-ford/index.html#org5fd539c">Set Up</a></li>
<li><a href="posts/shortest-paths-bellman-ford/index.html#org0febfaf">The Vertex</a>
<ul>
<li><a href="posts/shortest-paths-bellman-ford/index.html#orga7dc0c0">Object Representation</a></li>
<li><a href="posts/shortest-paths-bellman-ford/index.html#org540ef8b">Vertex Hash</a></li>
</ul>
</li>
<li><a href="posts/shortest-paths-bellman-ford/index.html#orga7acb63">The Edge</a>
<ul>
<li><a href="posts/shortest-paths-bellman-ford/index.html#org60a8f0c">The Edge Representation</a></li>
</ul>
</li>
<li><a href="posts/shortest-paths-bellman-ford/index.html#org4c23bcb">The Graph</a>
<ul>
<li><a href="posts/shortest-paths-bellman-ford/index.html#org09d53df">Add Edge</a></li>
</ul>
</li>
<li><a href="posts/shortest-paths-bellman-ford/index.html#org0c80646">Initialize Single Source</a></li>
<li><a href="posts/shortest-paths-bellman-ford/index.html#org9fb931f">Relax</a></li>
<li><a href="posts/shortest-paths-bellman-ford/index.html#orgf30f12e">Bellman-Ford</a>
<ul>
<li><a href="posts/shortest-paths-bellman-ford/index.html#org44a8261">Set Up</a></li>
<li><a href="posts/shortest-paths-bellman-ford/index.html#org45c14a7">The Function</a></li>
</ul>
</li>
<li><a href="posts/shortest-paths-bellman-ford/index.html#orgd4b3d79">Test It</a></li>
</ul>
</div>
</div>
<div class="highlight">
<pre><span></span><span class="o">&lt;&lt;</span><span class="n">constants</span><span class="o">&gt;&gt;</span>


<span class="o">&lt;&lt;</span><span class="n">the</span><span class="o">-</span><span class="n">vertex</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">vertex</span><span class="o">-</span><span class="n">representation</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">vertex</span><span class="o">-</span><span class="nb">hash</span><span class="o">&gt;&gt;</span>


<span class="o">&lt;&lt;</span><span class="n">the</span><span class="o">-</span><span class="n">edge</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">edge</span><span class="o">-</span><span class="n">representation</span><span class="o">&gt;&gt;</span>


<span class="o">&lt;&lt;</span><span class="n">the</span><span class="o">-</span><span class="n">graph</span><span class="o">&gt;&gt;</span>

    <span class="o">&lt;&lt;</span><span class="n">add</span><span class="o">-</span><span class="n">edge</span><span class="o">&gt;&gt;</span>


<span class="o">&lt;&lt;</span><span class="n">initialize</span><span class="o">-</span><span class="n">single</span><span class="o">-</span><span class="n">source</span><span class="o">&gt;&gt;</span>


<span class="o">&lt;&lt;</span><span class="n">relax</span><span class="o">&gt;&gt;</span>
</pre></div>
<div class="outline-2" id="outline-container-org5fd539c">
<h2 id="org5fd539c">Set Up</h2>
<div class="outline-text-2" id="text-org5fd539c">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>

<span class="n">INFINITE</span> <span class="o">=</span> <span class="n">INFINITY</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">"inf"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org0febfaf">
<h2 id="org0febfaf">The Vertex</h2>
<div class="outline-text-2" id="text-org0febfaf">
<div class="highlight">
<pre><span></span><span class="nd">@dataclass</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Vertex</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""A vertex for the single-source shortest paths problem</span>

<span class="sd">    Args:</span>
<span class="sd">     identifier: something to distinguish the vertex</span>
<span class="sd">     path_estimate: the estimate of the path weight</span>
<span class="sd">     predecessor: the vertex that precedes this one in the path</span>
<span class="sd">    """</span>
    <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="n">field</span><span class="p">(</span><span class="n">compare</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">path_estimate</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="n">INFINITE</span>
    <span class="n">predecessor</span><span class="p">:</span> <span class="n">Vertex</span><span class="o">=</span><span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compare</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="outline-3" id="outline-container-orga7dc0c0">
<h3 id="orga7dc0c0">Object Representation</h3>
<div class="outline-text-3" id="text-orga7dc0c0">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s2"> (path-estimate=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path_estimate</span><span class="si">}</span><span class="s2">)"</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org540ef8b">
<h3 id="org540ef8b">Vertex Hash</h3>
<div class="outline-text-3" id="text-org540ef8b">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orga7acb63">
<h2 id="orga7acb63">The Edge</h2>
<div class="outline-text-2" id="text-orga7acb63">
<div class="highlight">
<pre><span></span><span class="k">class</span> <span class="nc">Edge</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""A directed edge</span>

<span class="sd">    Args:</span>
<span class="sd">     source: tail vertex of the edge</span>
<span class="sd">     target: head vertex of the edge</span>
<span class="sd">     weight: the weight of the edge</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Vertex</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Vertex</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span>
        <span class="k">return</span>
</pre></div>
</div>
<div class="outline-3" id="outline-container-org60a8f0c">
<h3 id="org60a8f0c">The Edge Representation</h3>
<div class="outline-text-3" id="text-org60a8f0c">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="si">}</span><span class="s2"> -- </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="si">}</span><span class="s2"> --&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="si">}</span><span class="s2">"</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org4c23bcb">
<h2 id="org4c23bcb">The Graph</h2>
<div class="outline-text-2" id="text-org4c23bcb">
<div class="highlight">
<pre><span></span><span class="k">class</span> <span class="nc">Graph</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Directed Graph for shortest path problem"""</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adjacent</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
        <span class="k">return</span>
</pre></div>
</div>
<div class="outline-3" id="outline-container-org09d53df">
<h3 id="org09d53df">Add Edge</h3>
<div class="outline-text-3" id="text-org09d53df">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">add_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge</span><span class="p">:</span> <span class="n">Edge</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Add the edge to the graph</span>

<span class="sd">    Args:</span>
<span class="sd">     edge: the directed edge to add</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">edge</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">edge</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">adjacent</span><span class="p">[</span><span class="n">edge</span><span class="o">.</span><span class="n">source</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org0c80646">
<h2 id="org0c80646">Initialize Single Source</h2>
<div class="outline-text-2" id="text-org0c80646">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">initialize_single_source</span><span class="p">(</span><span class="n">graph</span><span class="p">:</span> <span class="n">Graph</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Vertex</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Setup the vertices of the graphs for single-source shortest path</span>

<span class="sd">    Args:</span>
<span class="sd">     graph: graph with vertices to set up</span>
<span class="sd">     source: the vertex to use as the start of the shortest paths tree</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
        <span class="n">vertex</span><span class="o">.</span><span class="n">path_estimate</span> <span class="o">=</span> <span class="n">INFINITY</span>
        <span class="n">vertex</span><span class="o">.</span><span class="n">predecessor</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">source</span><span class="o">.</span><span class="n">path_estimate</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org9fb931f">
<h2 id="org9fb931f">Relax</h2>
<div class="outline-text-2" id="text-org9fb931f">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">relax</span><span class="p">(</span><span class="n">edge</span><span class="p">:</span> <span class="n">Edge</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Check if target Vertex is improved using the source vertex</span>

<span class="sd">    Args:</span>
<span class="sd">     edge: directed edge with source, target, and weight</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">edge</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">path_estimate</span> <span class="o">&gt;</span> <span class="n">edge</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">path_estimate</span> <span class="o">+</span> <span class="n">edge</span><span class="o">.</span><span class="n">weight</span><span class="p">:</span>
        <span class="n">edge</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">path_estimate</span> <span class="o">=</span> <span class="n">edge</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">path_estimate</span> <span class="o">+</span> <span class="n">edge</span><span class="o">.</span><span class="n">weight</span>
        <span class="n">edge</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">predecessor</span> <span class="o">=</span> <span class="n">edge</span><span class="o">.</span><span class="n">source</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-orgf30f12e">
<h2 id="orgf30f12e">Bellman-Ford</h2>
<div class="outline-text-2" id="text-orgf30f12e"></div>
<div class="outline-3" id="outline-container-org44a8261">
<h3 id="org44a8261">Set Up</h3>
<div class="outline-text-3" id="text-org44a8261">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">be</span><span class="p">,</span> <span class="n">be_true</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>

<span class="c1"># this project</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.graphs.shortest_paths</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Edge</span><span class="p">,</span>
    <span class="n">Graph</span><span class="p">,</span>
    <span class="n">Vertex</span><span class="p">,</span>
    <span class="n">initialize_single_source</span><span class="p">,</span>
    <span class="n">relax</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">SUCCEEDED</span><span class="p">,</span> <span class="n">NEGATIVE_WEIGHT_CYCLE</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org45c14a7">
<h3 id="org45c14a7">The Function</h3>
<div class="outline-text-3" id="text-org45c14a7">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">bellman_ford</span><span class="p">(</span><span class="n">graph</span><span class="p">:</span> <span class="n">Graph</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Vertex</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Find the shortest paths using the Bellman-Ford algorithm</span>

<span class="sd">    Args:</span>
<span class="sd">     graph: the graph to process</span>
<span class="sd">     source: the vertex to start the paths from</span>

<span class="sd">    Returns:</span>
<span class="sd">     True if finished, False if there was a negtive-weight cycle in the grahp</span>
<span class="sd">    """</span>
    <span class="n">initialize_single_source</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vertices</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
            <span class="n">relax</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">edge</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">path_estimate</span> <span class="o">&gt;</span> <span class="n">edge</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">path_estimate</span> <span class="o">+</span> <span class="n">edge</span><span class="o">.</span><span class="n">weight</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">NEGATIVE_WEIGHT_CYCLE</span>
    <span class="k">return</span> <span class="n">SUCCEEDED</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgd4b3d79">
<h2 id="orgd4b3d79">Test It</h2>
<div class="outline-text-2" id="text-orgd4b3d79">
<div class="highlight">
<pre><span></span><span class="n">nodes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="s2">"stxyz"</span><span class="p">:</span>
    <span class="n">nodes</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">Vertex</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

<span class="n">graph</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"s"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"t"</span><span class="p">],</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"s"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"y"</span><span class="p">],</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"t"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"t"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"y"</span><span class="p">],</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"t"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"z"</span><span class="p">],</span> <span class="o">-</span><span class="mi">4</span><span class="p">))</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"t"</span><span class="p">],</span> <span class="o">-</span><span class="mi">2</span><span class="p">))</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"t"</span><span class="p">],</span> <span class="o">-</span><span class="mi">2</span><span class="p">))</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"y"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span> <span class="o">-</span><span class="mi">3</span><span class="p">))</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"y"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"z"</span><span class="p">],</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"z"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"z"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"s"</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">bellman_ford</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"s"</span><span class="p">]))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_true</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">pprint</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>

<span class="n">expected</span> <span class="o">=</span> <span class="p">((</span><span class="s2">"s"</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">"t"</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">"x"</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">"x"</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">"y"</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">"y"</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="s2">"s"</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">"z"</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"t"</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">path_weight</span><span class="p">,</span> <span class="n">predecessor</span> <span class="ow">in</span> <span class="n">expected</span><span class="p">:</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">path_estimate</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="n">path_weight</span><span class="p">))</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">predecessor</span><span class="p">]</span> <span class="k">if</span> <span class="n">predecessor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">predecessor</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">predecessor</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span>
</pre></div>
<pre class="example">
{'s': s (path-estimate=0),
 't': t (path-estimate=2),
 'x': x (path-estimate=4),
 'y': y (path-estimate=7),
 'z': z (path-estimate=-2)}
</pre></div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/minimum-spanning-trees-kruskals-algorithm/index.html">Minimum Spanning Trees: Kruskal's Algorithm</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/minimum-spanning-trees-kruskals-algorithm/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-04-27T15:30:44-07:00" itemprop="datePublished" title="2022-04-27 15:30">2022-04-27 15:30</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/minimum-spanning-trees-kruskals-algorithm/index.html#org0cca443">Set Up</a></li>
<li><a href="posts/minimum-spanning-trees-kruskals-algorithm/index.html#org5374673">A Vertex</a></li>
<li><a href="posts/minimum-spanning-trees-kruskals-algorithm/index.html#org98ce332">Edges</a></li>
<li><a href="posts/minimum-spanning-trees-kruskals-algorithm/index.html#org7ea0101">A Graph</a></li>
<li><a href="posts/minimum-spanning-trees-kruskals-algorithm/index.html#orgc264dd5">Disjoint Sets</a></li>
<li><a href="posts/minimum-spanning-trees-kruskals-algorithm/index.html#org555f554">Kruskal's Algorithm</a></li>
<li><a href="posts/minimum-spanning-trees-kruskals-algorithm/index.html#org4def539">Try It Out</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org0cca443">
<h2 id="org0cca443">Set Up</h2>
<div class="outline-text-2" id="text-org0cca443">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">be</span><span class="p">,</span> <span class="n">be_true</span><span class="p">,</span> <span class="n">contain_only</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org5374673">
<h2 id="org5374673">A Vertex</h2>
<div class="outline-text-2" id="text-org5374673">
<div class="highlight">
<pre><span></span><span class="k">class</span> <span class="nc">Vertex</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""A node in the graph</span>

<span class="sd">    Args:</span>
<span class="sd">     identifier: something to distinguish the node</span>
<span class="sd">     parent: The node pointing to this node</span>
<span class="sd">     rank: The height of the node</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">Vertex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rank</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span> <span class="o">=</span> <span class="n">identifier</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rank</span> <span class="o">=</span> <span class="n">rank</span>
        <span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_root</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Checks if this vertex is the root of a tree</span>

<span class="sd">        Returns:</span>
<span class="sd">         true if this is a root</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s2">"</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org98ce332">
<h2 id="org98ce332">Edges</h2>
<div class="outline-text-2" id="text-org98ce332">
<div class="highlight">
<pre><span></span><span class="k">class</span> <span class="nc">Edge</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""A weighted edge between two nodes</span>

<span class="sd">    Args:</span>
<span class="sd">     node_1: vertex at one end</span>
<span class="sd">     node_2: vertex at the other end</span>
<span class="sd">     weight: weight of the edge</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_1</span><span class="p">:</span> <span class="n">Vertex</span><span class="p">,</span> <span class="n">node_2</span><span class="p">:</span> <span class="n">Vertex</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_1</span> <span class="o">=</span> <span class="n">node_1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_2</span> <span class="o">=</span> <span class="n">node_2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">node_1</span><span class="si">}</span><span class="s2"> --</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="si">}</span><span class="s2">-- </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">node_2</span><span class="si">}</span><span class="s2">"</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org7ea0101">
<h2 id="org7ea0101">A Graph</h2>
<div class="outline-text-2" id="text-org7ea0101">
<div class="highlight">
<pre><span></span><span class="k">class</span> <span class="nc">Graph</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""An Undirected Graph</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">add_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_1</span><span class="p">:</span> <span class="n">Vertex</span><span class="p">,</span> <span class="n">node_2</span><span class="p">:</span> <span class="n">Vertex</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Add the nodes and an edge between them</span>

<span class="sd">        Note:</span>
<span class="sd">         although the graph is undirected, the (node_2, node_1) edge </span>
<span class="sd">         isn't added, it's assumed that the order of the arguments </span>
<span class="sd">         doesn't matter</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node_1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node_2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Edge</span><span class="p">(</span><span class="n">node_1</span><span class="p">,</span> <span class="n">node_2</span><span class="p">,</span> <span class="n">weight</span><span class="p">))</span>
        <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-orgc264dd5">
<h2 id="orgc264dd5">Disjoint Sets</h2>
<div class="outline-text-2" id="text-orgc264dd5">
<div class="highlight">
<pre><span></span><span class="k">class</span> <span class="nc">Disjoint</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Methods to treat the tree as a set"""</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">make_sets</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">vertices</span><span class="p">:</span> <span class="nb">set</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Initializes the vertices as trees in a forest</span>

<span class="sd">        Args:</span>
<span class="sd">         vertices: collection of nodes to set up</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="n">vertices</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">make_set</span><span class="p">(</span><span class="n">vertex</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">make_set</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">vertex</span><span class="p">:</span> <span class="n">Vertex</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Initialize the values</span>

<span class="sd">        Args:</span>
<span class="sd">         vertex: node to set up</span>
<span class="sd">        """</span>
        <span class="n">vertex</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">vertex</span>
        <span class="n">vertex</span><span class="o">.</span><span class="n">rank</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">find_set</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">vertex</span><span class="p">:</span> <span class="n">Vertex</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Vertex</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Find the root of the set that vertex belongs to</span>

<span class="sd">        Args:</span>
<span class="sd">         vertex: member of set to find</span>

<span class="sd">        Returns:</span>
<span class="sd">         root of set that vertex belongs to</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">vertex</span><span class="o">.</span><span class="n">is_root</span><span class="p">:</span>
            <span class="n">vertex</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">find_set</span><span class="p">(</span><span class="n">vertex</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>            
        <span class="k">return</span> <span class="n">vertex</span><span class="o">.</span><span class="n">parent</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">union</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">vertex_1</span><span class="p">:</span> <span class="n">Vertex</span><span class="p">,</span> <span class="n">vertex_2</span><span class="p">:</span> <span class="n">Vertex</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""merge the trees that the vertices belong to</span>

<span class="sd">        Args:</span>
<span class="sd">         vertex_1: member of first tree</span>
<span class="sd">         vertex_2: member of second tree</span>
<span class="sd">        """</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">find_set</span><span class="p">(</span><span class="n">vertex_1</span><span class="p">),</span> <span class="bp">cls</span><span class="o">.</span><span class="n">find_set</span><span class="p">(</span><span class="n">vertex_2</span><span class="p">))</span>
        <span class="k">return</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">link</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">root_1</span><span class="p">:</span> <span class="n">Vertex</span><span class="p">,</span> <span class="n">root_2</span><span class="p">:</span> <span class="n">Vertex</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""make lower-ranked tree root a child of higher-ranked</span>

<span class="sd">        Args:</span>
<span class="sd">         root_1: root of a tree</span>
<span class="sd">         root_2: root of a different tree</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">root_1</span><span class="o">.</span><span class="n">rank</span> <span class="o">&gt;</span> <span class="n">root_2</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
            <span class="n">root_2</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">root_1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">root_1</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">root_2</span>
            <span class="k">if</span> <span class="n">root_1</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="n">root_2</span><span class="o">.</span><span class="n">rank</span><span class="p">:</span>
                <span class="n">root_2</span><span class="o">.</span><span class="n">rank</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org555f554">
<h2 id="org555f554">Kruskal's Algorithm</h2>
<div class="outline-text-2" id="text-org555f554">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">kruskal</span><span class="p">(</span><span class="n">graph</span><span class="p">:</span> <span class="n">Graph</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Create a Minimum Spanning Tree out of Vertices</span>

<span class="sd">    Args:</span>
<span class="sd">     graph: the graph from which we create the MST</span>

<span class="sd">    Returns:</span>
<span class="sd">     set of edges making up the minimum spanning tree</span>
<span class="sd">    """</span>
    <span class="n">spanning_tree</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">Disjoint</span><span class="o">.</span><span class="n">make_sets</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vertices</span><span class="p">)</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">edge</span><span class="p">:</span> <span class="n">edge</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
        <span class="n">tree_1</span> <span class="o">=</span> <span class="n">Disjoint</span><span class="o">.</span><span class="n">find_set</span><span class="p">(</span><span class="n">edge</span><span class="o">.</span><span class="n">node_1</span><span class="p">)</span>
        <span class="n">tree_2</span> <span class="o">=</span> <span class="n">Disjoint</span><span class="o">.</span><span class="n">find_set</span><span class="p">(</span><span class="n">edge</span><span class="o">.</span><span class="n">node_2</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tree_1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">tree_2</span><span class="p">):</span>
            <span class="n">spanning_tree</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
            <span class="n">Disjoint</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">edge</span><span class="o">.</span><span class="n">node_1</span><span class="p">,</span> <span class="n">edge</span><span class="o">.</span><span class="n">node_2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">spanning_tree</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org4def539">
<h2 id="org4def539">Try It Out</h2>
<div class="outline-text-2" id="text-org4def539">
<div class="highlight">
<pre><span></span><span class="n">nodes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

<span class="k">for</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="s2">"abcdefghi"</span><span class="p">:</span>
    <span class="n">nodes</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">Vertex</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"a"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"b"</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"a"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"h"</span><span class="p">],</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"b"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"h"</span><span class="p">],</span> <span class="mi">11</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"b"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"c"</span><span class="p">],</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"c"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"d"</span><span class="p">],</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"c"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"i"</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"c"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"f"</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"d"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"e"</span><span class="p">],</span> <span class="mi">9</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"d"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"f"</span><span class="p">],</span> <span class="mi">14</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"e"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"f"</span><span class="p">],</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"f"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"g"</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"g"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"h"</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"g"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"i"</span><span class="p">],</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s2">"h"</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="s2">"i"</span><span class="p">],</span> <span class="mi">7</span><span class="p">)</span>

<span class="n">Disjoint</span><span class="o">.</span><span class="n">make_sets</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vertices</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vertices</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_only</span><span class="p">(</span><span class="o">*</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">rank</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

<span class="n">tree</span> <span class="o">=</span> <span class="n">kruskal</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</pre></div>
<pre class="example">
{a --4-- b,
 a --8-- h,
 c --7-- d,
 c --2-- i,
 c --4-- f,
 d --9-- e,
 f --2-- g,
 g --1-- h}
</pre>
<p><b>Note:</b> I originally thought I could check the tree structure, but the disjoint-set methods use Path Compression, so all the nodes end up having the same parent (in this case node "h").</p>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/graphs-strongly-connected-components/index.html">Graphs: Strongly Connected Components</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/graphs-strongly-connected-components/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-04-20T19:43:49-07:00" itemprop="datePublished" title="2022-04-20 19:43">2022-04-20 19:43</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/graphs-strongly-connected-components/index.html#org3517e2d">Beginning</a>
<ul>
<li><a href="posts/graphs-strongly-connected-components/index.html#org069fa5d">Imports For Testing</a></li>
</ul>
</li>
<li><a href="posts/graphs-strongly-connected-components/index.html#orgd3f999d">The Graph Transpose</a>
<ul>
<li><a href="posts/graphs-strongly-connected-components/index.html#orgce7355c">Imports for the Transpose</a></li>
<li><a href="posts/graphs-strongly-connected-components/index.html#orgd5fe862">The Transpose</a>
<ul>
<li><a href="posts/graphs-strongly-connected-components/index.html#org64861c8">The Adjacency Sets</a></li>
<li><a href="posts/graphs-strongly-connected-components/index.html#org20eacbe">The Vertices</a></li>
</ul>
</li>
<li><a href="posts/graphs-strongly-connected-components/index.html#org3520202">Testing the Transpose</a></li>
</ul>
</li>
<li><a href="posts/graphs-strongly-connected-components/index.html#orgfdd2139">Strongly Connected Components</a>
<ul>
<li><a href="posts/graphs-strongly-connected-components/index.html#orgcfd0a8b">The Steps to Build Them</a></li>
<li><a href="posts/graphs-strongly-connected-components/index.html#org3795ed5">The Builder</a>
<ul>
<li><a href="posts/graphs-strongly-connected-components/index.html#orgd83fcb1">The Transpose</a></li>
<li><a href="posts/graphs-strongly-connected-components/index.html#org02c9074">Find the Child</a></li>
<li><a href="posts/graphs-strongly-connected-components/index.html#orgc114e9c">The Call</a></li>
</ul>
</li>
<li><a href="posts/graphs-strongly-connected-components/index.html#orgc51648e">Testing it</a></li>
</ul>
</li>
<li><a href="posts/graphs-strongly-connected-components/index.html#org1bf7681">End</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org3517e2d">
<h2 id="org3517e2d">Beginning</h2>
<div class="outline-text-2" id="text-org3517e2d"></div>
<div class="outline-3" id="outline-container-org069fa5d">
<h3 id="org069fa5d">Imports For Testing</h3>
<div class="outline-text-3" id="text-org069fa5d">
<div class="highlight">
<pre><span></span><span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">be_a</span><span class="p">,</span>
    <span class="n">expect</span><span class="p">,</span>
    <span class="n">contain_exactly</span><span class="p">,</span>
    <span class="n">contain_only</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># this project</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.graphs.depth_first_search</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DepthFirstSearch</span><span class="p">,</span>
    <span class="n">DFSVertex</span><span class="p">,</span>
    <span class="n">DirectedGraph</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">bowling.data_structures.graphs.transpose</span> <span class="kn">import</span> <span class="n">Transpose</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgd3f999d">
<h2 id="orgd3f999d">The Graph Transpose</h2>
<div class="outline-text-2" id="text-orgd3f999d">
<p>A transpose of a directed graph (\(G^T\)) contains the same nodes and the same edges but the direction of each edge is reversed.</p>
</div>
<div class="outline-3" id="outline-container-orgce7355c">
<h3 id="orgce7355c">Imports for the Transpose</h3>
<div class="outline-text-3" id="text-orgce7355c">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="c1"># this project</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.graphs.depth_first_search</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DepthFirstSearch</span><span class="p">,</span>
    <span class="n">DFSVertex</span><span class="p">,</span>
    <span class="n">DirectedGraph</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgd5fe862">
<h3 id="orgd5fe862">The Transpose</h3>
<div class="outline-text-3" id="text-orgd5fe862">
<div class="highlight">
<pre><span></span><span class="k">class</span> <span class="nc">Transpose</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Creates the transpose of a graph</span>

<span class="sd">    Args:</span>
<span class="sd">     graph: the directed graph to transpose</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">:</span> <span class="n">DirectedGraph</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vertices</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-org64861c8">
<h4 id="org64861c8">The Adjacency Sets</h4>
<div class="outline-text-4" id="text-org64861c8">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">adjacent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Vertex: set of adjacente vertices dictionary"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">vertex</span><span class="p">,</span> <span class="n">neighbors</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">adjacent</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">neighbors</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Adding neighbor </span><span class="si">{</span><span class="n">vertex</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span><span class="p">[</span><span class="n">neighbor</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vertex</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adjacent</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org20eacbe">
<h4 id="org20eacbe">The Vertices</h4>
<div class="outline-text-4" id="text-org20eacbe">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">vertices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""The vertices in the directed graph"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vertices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vertices</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vertices</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-org3520202">
<h3 id="org3520202">Testing the Transpose</h3>
<div class="outline-text-3" id="text-org3520202">
<div class="highlight">
<pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">DirectedGraph</span><span class="p">()</span>
<span class="n">vertex_a</span> <span class="o">=</span> <span class="n">DFSVertex</span><span class="p">(</span><span class="s2">"a"</span><span class="p">)</span>
<span class="n">vertex_b</span> <span class="o">=</span> <span class="n">DFSVertex</span><span class="p">(</span><span class="s2">"b"</span><span class="p">)</span>
<span class="n">vertex_e</span> <span class="o">=</span> <span class="n">DFSVertex</span><span class="p">(</span><span class="s2">"e"</span><span class="p">)</span>
<span class="n">vertex_f</span> <span class="o">=</span> <span class="n">DFSVertex</span><span class="p">(</span><span class="s2">"f"</span><span class="p">)</span>

<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vertex_a</span><span class="p">,</span> <span class="n">vertex_b</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vertex_b</span><span class="p">,</span> <span class="n">vertex_e</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vertex_b</span><span class="p">,</span> <span class="n">vertex_f</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vertex_e</span><span class="p">,</span> <span class="n">vertex_a</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vertex_e</span><span class="p">,</span> <span class="n">vertex_f</span><span class="p">)</span>

<span class="n">transpose</span> <span class="o">=</span> <span class="n">Transpose</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>

<span class="n">expect</span><span class="p">(</span><span class="n">transpose</span><span class="o">.</span><span class="n">vertices</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_only</span><span class="p">(</span><span class="n">vertex_a</span><span class="p">,</span> <span class="n">vertex_b</span><span class="p">,</span>
                                           <span class="n">vertex_e</span><span class="p">,</span> <span class="n">vertex_f</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">transpose</span><span class="o">.</span><span class="n">adjacent</span><span class="p">[</span><span class="n">vertex_a</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="n">vertex_e</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">transpose</span><span class="o">.</span><span class="n">adjacent</span><span class="p">[</span><span class="n">vertex_b</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="n">vertex_a</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">transpose</span><span class="o">.</span><span class="n">adjacent</span><span class="p">[</span><span class="n">vertex_e</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_exactly</span><span class="p">(</span><span class="n">vertex_b</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">transpose</span><span class="o">.</span><span class="n">adjacent</span><span class="p">[</span><span class="n">vertex_f</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">contain_only</span><span class="p">(</span><span class="n">vertex_b</span><span class="p">,</span> <span class="n">vertex_e</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-orgfdd2139">
<h2 id="orgfdd2139">Strongly Connected Components</h2>
<div class="outline-text-2" id="text-orgfdd2139">
<p>A Strongly Connected Component of a Directed Graph is a sub-graph where each pair of vertices has an edge in both directions (if <i>a</i> has an edge to <i>b</i> then <i>b</i> has an edge to <i>a</i>).</p>
</div>
<div class="outline-3" id="outline-container-orgcfd0a8b">
<h3 id="orgcfd0a8b">The Steps to Build Them</h3>
<div class="outline-text-3" id="text-orgcfd0a8b">
<ol class="org-ol">
<li>Call <code>DFS(G)</code> to compute the finishing times.</li>
<li>Compute \(G^T\)</li>
<li>Call <code>DFS(</code>\(G^T\) <code>)</code>, going through the vertices in decreasing finish time in the main loop.</li>
<li>Output the Depth-First forest created in step 3 as the Strongly Connected Components.</li>
</ol>
</div>
</div>
<div class="outline-3" id="outline-container-org3795ed5">
<h3 id="org3795ed5">The Builder</h3>
<div class="outline-text-3" id="text-org3795ed5">
<div class="highlight">
<pre><span></span><span class="k">class</span> <span class="nc">StronglyConnectedComponents</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Build the strongly connected components sub-trees</span>

<span class="sd">    Args:</span>
<span class="sd">     graph: directed graph to process</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">:</span> <span class="n">DirectedGraph</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_forest</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-orgd83fcb1">
<h4 id="orgd83fcb1">The Transpose</h4>
<div class="outline-text-4" id="text-orgd83fcb1">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">transpose</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Transpose</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""The transpose of the original graph"""</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span> <span class="o">=</span> <span class="n">Transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transpose</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-org02c9074">
<h4 id="org02c9074">Find the Child</h4>
<div class="outline-text-4" id="text-org02c9074">
<p>Unlike with a Binary Search Tree, our vertices don't keep track of their child nodes, just the predecessor node so this is a helper to get all the children of a node.</p>
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">find_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertices</span><span class="p">:</span> <span class="nb">set</span><span class="p">,</span> <span class="n">predecessor</span><span class="p">:</span> <span class="n">DFSVertex</span><span class="p">,</span>
               <span class="n">path</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Find the child nodes of the given predecessor</span>

<span class="sd">    Note:</span>
<span class="sd">     this is a helper to find the children in a Strongly Connected Component</span>
<span class="sd">     For it to make sense the vertices should have the forest already built</span>

<span class="sd">    Args:</span>
<span class="sd">     vertices: source of nodes</span>
<span class="sd">     predecessor: node in the graph to find the child of</span>
<span class="sd">     path: list to append child nodes to</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="n">vertices</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">vertex</span><span class="o">.</span><span class="n">predecessor</span> <span class="ow">is</span> <span class="n">predecessor</span><span class="p">:</span>
            <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vertex</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_child</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">vertex</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path</span>
</pre></div>
</div>
</div>
<div class="outline-4" id="outline-container-orgc114e9c">
<h4 id="orgc114e9c">The Call</h4>
<div class="outline-text-4" id="text-orgc114e9c">
<div class="highlight">
<pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">forest</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""creates the forest with the strongly connected components</span>

<span class="sd">    Returns:</span>
<span class="sd">     adjacency dict for the strongly connected components</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forest</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># do the search to get the finish times</span>
        <span class="n">searcher</span> <span class="o">=</span> <span class="n">DepthFirstSearch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
        <span class="n">searcher</span><span class="p">()</span>

        <span class="c1"># change the transpose vertices to be in reversed finish order</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span>
                          <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">vertex</span><span class="p">:</span> <span class="n">vertex</span><span class="o">.</span><span class="n">finished</span><span class="p">,</span>
                          <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transpose</span><span class="o">.</span><span class="n">_vertices</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">vertices</span><span class="p">)))</span>

        <span class="c1"># do a depth first search on the graph transpose</span>
        <span class="n">searcher</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transpose</span>
        <span class="n">searcher</span><span class="p">()</span>

        <span class="c1"># at this point the strongly connected components are set up in </span>
        <span class="c1"># self.transpose, but you have to do some figuring to get the trees</span>

        <span class="c1"># get the roots of the trees in the forest</span>
        <span class="n">roots</span> <span class="o">=</span> <span class="p">(</span><span class="n">vertex</span> <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">transpose</span><span class="o">.</span><span class="n">vertices</span>
                 <span class="k">if</span> <span class="n">vertex</span><span class="o">.</span><span class="n">predecessor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># build a forest for each root by finding its children</span>
        <span class="n">forest</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transpose</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="p">[</span><span class="n">root</span><span class="p">])</span>
                  <span class="k">for</span> <span class="n">root</span> <span class="ow">in</span> <span class="n">roots</span><span class="p">)</span>

        <span class="c1"># build a new adjacency dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_forest</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># the neighbors are all the original adjacent nodes without the </span>
        <span class="c1"># tree nodes</span>
        <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">forest</span><span class="p">:</span>
            <span class="n">neighbors</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">:</span>
                <span class="n">neighbors</span> <span class="o">=</span> <span class="n">neighbors</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">adjacent</span><span class="p">[</span><span class="n">node</span><span class="p">])</span>
            <span class="n">neighbors</span> <span class="o">=</span> <span class="n">neighbors</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_forest</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">tree</span><span class="p">)]</span> <span class="o">=</span> <span class="n">neighbors</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forest</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-3" id="outline-container-orgc51648e">
<h3 id="orgc51648e">Testing it</h3>
<div class="outline-text-3" id="text-orgc51648e">
<div class="highlight">
<pre><span></span><span class="kn">from</span> <span class="nn">bowling.data_structures.graphs.transpose</span> <span class="kn">import</span> <span class="n">StronglyConnectedComponents</span>

<span class="n">graph</span> <span class="o">=</span> <span class="n">DirectedGraph</span><span class="p">()</span>
<span class="n">vertex_a</span> <span class="o">=</span> <span class="n">DFSVertex</span><span class="p">(</span><span class="s2">"a"</span><span class="p">)</span>
<span class="n">vertex_b</span> <span class="o">=</span> <span class="n">DFSVertex</span><span class="p">(</span><span class="s2">"b"</span><span class="p">)</span>
<span class="n">vertex_c</span> <span class="o">=</span> <span class="n">DFSVertex</span><span class="p">(</span><span class="s2">"c"</span><span class="p">)</span>
<span class="n">vertex_d</span> <span class="o">=</span> <span class="n">DFSVertex</span><span class="p">(</span><span class="s2">"d"</span><span class="p">)</span>
<span class="n">vertex_e</span> <span class="o">=</span> <span class="n">DFSVertex</span><span class="p">(</span><span class="s2">"e"</span><span class="p">)</span>
<span class="n">vertex_f</span> <span class="o">=</span> <span class="n">DFSVertex</span><span class="p">(</span><span class="s2">"f"</span><span class="p">)</span>
<span class="n">vertex_g</span> <span class="o">=</span> <span class="n">DFSVertex</span><span class="p">(</span><span class="s2">"g"</span><span class="p">)</span>
<span class="n">vertex_h</span> <span class="o">=</span> <span class="n">DFSVertex</span><span class="p">(</span><span class="s2">"h"</span><span class="p">)</span>

<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vertex_a</span><span class="p">,</span> <span class="n">vertex_b</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vertex_b</span><span class="p">,</span> <span class="n">vertex_c</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vertex_b</span><span class="p">,</span> <span class="n">vertex_e</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vertex_b</span><span class="p">,</span> <span class="n">vertex_f</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vertex_c</span><span class="p">,</span> <span class="n">vertex_d</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vertex_c</span><span class="p">,</span> <span class="n">vertex_g</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vertex_d</span><span class="p">,</span> <span class="n">vertex_c</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vertex_d</span><span class="p">,</span> <span class="n">vertex_h</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vertex_e</span><span class="p">,</span> <span class="n">vertex_a</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vertex_e</span><span class="p">,</span> <span class="n">vertex_f</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vertex_f</span><span class="p">,</span> <span class="n">vertex_g</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vertex_g</span><span class="p">,</span> <span class="n">vertex_f</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vertex_g</span><span class="p">,</span> <span class="n">vertex_h</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vertex_h</span><span class="p">,</span> <span class="n">vertex_h</span><span class="p">)</span>

<span class="n">components</span> <span class="o">=</span> <span class="n">StronglyConnectedComponents</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
<span class="n">forest</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">forest</span>
</pre></div>
<p>Let's see what's in the forest.</p>
<p>Since the Depth-First Search created a forest of strongly connected components, we can see how many trees are in the forest by finding the roots (the nodes with no predecessor).</p>
<div class="highlight">
<pre><span></span><span class="k">for</span> <span class="n">root</span> <span class="ow">in</span> <span class="n">forest</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
</pre></div>
<pre class="example" id="org5b51933">
abe
cd
fg
h
[autoreload of bowling.data_structures.graphs.transpose failed: Traceback (most recent call last):
  File "/home/bravo/.virtualenvs/Bowling-For-Data/site-packages/IPython/extensions/autoreload.py", line 245, in check
    superreload(m, reload, self.old_objects)
  File "/home/bravo/.virtualenvs/Bowling-For-Data/site-packages/IPython/extensions/autoreload.py", line 394, in superreload
    module = reload(module)
  File "/usr/lib/pypy3/lib-python/3/imp.py", line 314, in reload
    return importlib.reload(module)
  File "/usr/lib/pypy3/lib-python/3/importlib/__init__.py", line 169, in reload
    _bootstrap._exec(spec, module)
  File "&lt;frozen importlib._bootstrap&gt;", line 639, in _exec
  File "&lt;builtin&gt;/frozen importlib._bootstrap_external", line 737, in exec_module
  File "&lt;builtin&gt;/frozen importlib._bootstrap_external", line 873, in get_code
  File "&lt;builtin&gt;/frozen importlib._bootstrap_external", line 804, in source_to_code
  File "&lt;frozen importlib._bootstrap&gt;", line 228, in _call_with_frames_removed
  File "/home/bravo/Bowling-For-Data/bowling/data_structures/graphs/transpose.py", line 126
    self._forest[tuple(tree])] = neighbors
                           ^
SyntaxError: closing parenthesis ']' does not match opening parenthesis '('
]
</pre>
<p>So We have four Strongly Connected Components.</p>
<div class="highlight">
<pre><span></span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org1bf7681">
<h2 id="org1bf7681">End</h2>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/graphs-topological-ordering/index.html">Graphs: Topological Ordering</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/graphs-topological-ordering/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-04-19T19:17:55-07:00" itemprop="datePublished" title="2022-04-19 19:17">2022-04-19 19:17</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/graphs-topological-ordering/index.html#org106c6a4">Beginning</a></li>
<li><a href="posts/graphs-topological-ordering/index.html#org3e692be">Middle</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-org106c6a4">
<h2 id="org106c6a4">Beginning</h2>
<div class="outline-text-2" id="text-org106c6a4">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="c1"># this project</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.graphs.depth_first_search</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DFSVertex</span><span class="p">,</span>
    <span class="n">DepthFirstSearch</span><span class="p">,</span>
    <span class="n">DirectedGraph</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org3e692be">
<h2 id="org3e692be">Middle</h2>
<div class="outline-text-2" id="text-org3e692be">
<div class="highlight">
<pre><span></span><span class="n">underpants</span> <span class="o">=</span> <span class="n">DFSVertex</span><span class="p">(</span><span class="s2">"underpants"</span><span class="p">)</span>
<span class="n">pants</span> <span class="o">=</span> <span class="n">DFSVertex</span><span class="p">(</span><span class="s2">"pants"</span><span class="p">)</span>
<span class="n">belt</span> <span class="o">=</span> <span class="n">DFSVertex</span><span class="p">(</span><span class="s2">"belt"</span><span class="p">)</span>
<span class="n">socks</span> <span class="o">=</span> <span class="n">DFSVertex</span><span class="p">(</span><span class="s2">"socks"</span><span class="p">)</span>
<span class="n">watch</span> <span class="o">=</span> <span class="n">DFSVertex</span><span class="p">(</span><span class="s2">"watch"</span><span class="p">)</span>
<span class="n">shoes</span> <span class="o">=</span> <span class="n">DFSVertex</span><span class="p">(</span><span class="s2">"shoes"</span><span class="p">)</span>
<span class="n">shirt</span> <span class="o">=</span> <span class="n">DFSVertex</span><span class="p">(</span><span class="s2">"shirt"</span><span class="p">)</span>
<span class="n">tie</span> <span class="o">=</span> <span class="n">DFSVertex</span><span class="p">(</span><span class="s2">"tie"</span><span class="p">)</span>
<span class="n">jacket</span> <span class="o">=</span> <span class="n">DFSVertex</span><span class="p">(</span><span class="s2">"jacket"</span><span class="p">)</span>

<span class="n">graph</span> <span class="o">=</span> <span class="n">DirectedGraph</span><span class="p">()</span>

<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">underpants</span><span class="p">,</span> <span class="n">pants</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">underpants</span><span class="p">,</span> <span class="n">shoes</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">socks</span><span class="p">,</span> <span class="n">shoes</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pants</span><span class="p">,</span> <span class="n">shoes</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pants</span><span class="p">,</span> <span class="n">belt</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">shirt</span><span class="p">,</span> <span class="n">belt</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">shirt</span><span class="p">,</span> <span class="n">tie</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tie</span><span class="p">,</span> <span class="n">jacket</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">belt</span><span class="p">,</span> <span class="n">jacket</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">watch</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">search</span> <span class="o">=</span> <span class="n">DepthFirstSearch</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
<span class="n">search</span><span class="p">()</span>

<span class="n">topologically_sorted</span> <span class="o">=</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">finished</span><span class="p">))</span>
<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">topologically_sorted</span><span class="p">:</span>
    <span class="n">predecessor</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">predecessor</span><span class="o">.</span><span class="n">identifier</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">predecessor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">"None"</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s2"> </span><span class="se">\t</span><span class="s2">finished: </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">finished</span><span class="si">}</span><span class="se">\t</span><span class="s2"> predecessor: </span><span class="si">{</span><span class="n">predecessor</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
<pre class="example">
watch   finished: 18     predecessor: None
shirt   finished: 16     predecessor: None
tie     finished: 15     predecessor: shirt
socks   finished: 12     predecessor: None
underpants      finished: 10     predecessor: None
pants   finished: 9      predecessor: underpants
belt    finished: 8      predecessor: pants
jacket  finished: 7      predecessor: belt
shoes   finished: 4      predecessor: pants
</pre>
<p>This differs from the CLRS solution. The ordering depends on the order in which the edges are encountered (in this case it means the order in which the edges are added to the graph) so the sort won't always be the same. The important feature is that no item later in the list needs to come before any that precede it.</p>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/graphs-depth-first-search/index.html">Graphs: Depth-First-Search</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/graphs-depth-first-search/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-04-16T18:50:06-07:00" itemprop="datePublished" title="2022-04-16 18:50">2022-04-16 18:50</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/graphs-depth-first-search/index.html#orgced98fc">Imports and Setup</a></li>
<li><a href="posts/graphs-depth-first-search/index.html#org3a69088">DFS Vertex</a></li>
<li><a href="posts/graphs-depth-first-search/index.html#org93b7b1e">Directed Graph</a>
<ul>
<li><a href="posts/graphs-depth-first-search/index.html#orge974312">Add</a></li>
</ul>
</li>
<li><a href="posts/graphs-depth-first-search/index.html#org5ddc905">Depth First Search</a>
<ul>
<li><a href="posts/graphs-depth-first-search/index.html#org8e50123">The Class</a></li>
<li><a href="posts/graphs-depth-first-search/index.html#org36b293e">The Call</a></li>
<li><a href="posts/graphs-depth-first-search/index.html#org51327dc">Visiting Adjacent Nodes</a></li>
</ul>
</li>
<li><a href="posts/graphs-depth-first-search/index.html#org05a1a82">Testing It</a></li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgced98fc">
<h2 id="orgced98fc">Imports and Setup</h2>
<div class="outline-text-2" id="text-orgced98fc">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>

<span class="c1"># from pypi</span>
<span class="kn">from</span> <span class="nn">attrs</span> <span class="kn">import</span> <span class="n">define</span>

<span class="c1"># this projects</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.graphs</span> <span class="kn">import</span> <span class="n">graph</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org3a69088">
<h2 id="org3a69088">DFS Vertex</h2>
<div class="outline-text-2" id="text-org3a69088">
<p>The Vertices used in the Depth-First Search also keep track of the "times" so it has two more attributes than our original vertex - <code>discovered</code> and <code>finished</code>. Although, as with color and all the other attributes, we could just let the program stick the attributes into the object, I thought it'd be better to create a new class to make it more obvious that there's a difference. I couldn't get the sets to add the vertices when I used inheritance so I'm going to start from scratch instead of inheriting from the original Vertex.</p>
<div class="highlight">
<pre><span></span><span class="nd">@define</span><span class="p">(</span><span class="n">eq</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">DFSVertex</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">Vertex</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""The Depth-First Search Vertex</span>

<span class="sd">    Args:</span>
<span class="sd">     identifier: something to identify the node</span>
<span class="sd">     color: the 'discovery' state of the node</span>
<span class="sd">     distance: The number of edges to the root</span>
<span class="sd">     predecessor: The 'parent' of the node in a tree</span>
<span class="sd">     discovered: when the node was discovered</span>
<span class="sd">     finished: when the node's adjacent nodes where checked</span>
<span class="sd">    """</span>
    <span class="n">discovered</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">finished</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span> <span class="o">+</span> 
        <span class="sa">f</span><span class="s2">", discovered: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">discovered</span><span class="si">}</span><span class="s2">, finished: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-2" id="outline-container-org93b7b1e">
<h2 id="org93b7b1e">Directed Graph</h2>
<div class="outline-text-2" id="text-org93b7b1e">
<div class="highlight">
<pre><span></span><span class="k">class</span> <span class="nc">DirectedGraph</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">Graph</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""A Directed Graph"""</span>    
</pre></div>
</div>
<div class="outline-3" id="outline-container-orge974312">
<h3 id="orge974312">Add</h3>
<div class="outline-text-3" id="text-orge974312">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">DFSVertex</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">DFSVertex</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Add an edge from source to target</span>

<span class="sd">    Args:</span>
<span class="sd">     source: the vertex where the edge starts</span>
<span class="sd">     target: the vertex where the edge ends</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vertices</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">adjacent</span><span class="p">[</span><span class="n">source</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org5ddc905">
<h2 id="org5ddc905">Depth First Search</h2>
<div class="outline-text-2" id="text-org5ddc905"></div>
<div class="outline-3" id="outline-container-org8e50123">
<h3 id="org8e50123">The Class</h3>
<div class="outline-text-3" id="text-org8e50123">
<div class="highlight">
<pre><span></span><span class="nd">@define</span>
<span class="k">class</span> <span class="nc">DepthFirstSearch</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""depth-first-searcher</span>

<span class="sd">    Args:</span>
<span class="sd">     graph: the graph to process</span>
<span class="sd">    """</span>
    <span class="n">graph</span><span class="p">:</span> <span class="n">graph</span><span class="o">.</span><span class="n">Graph</span>
    <span class="n">time</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org36b293e">
<h3 id="org36b293e">The Call</h3>
<div class="outline-text-3" id="text-org36b293e">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Performs the depth-first-search"""</span>
    <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
        <span class="n">vertex</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">WHITE</span>
        <span class="n">vertex</span><span class="o">.</span><span class="n">predecessor</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">vertex</span><span class="o">.</span><span class="n">color</span> <span class="ow">is</span> <span class="n">graph</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">WHITE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit_adjacent</span><span class="p">(</span><span class="n">vertex</span><span class="p">)</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-org51327dc">
<h3 id="org51327dc">Visiting Adjacent Nodes</h3>
<div class="outline-text-3" id="text-org51327dc">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="nf">visit_adjacent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertex</span><span class="p">:</span> <span class="n">DFSVertex</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Visit the nodes adjacent to the given node</span>

<span class="sd">    Args:</span>
<span class="sd">     vertex: vertex whose adjacency to visit</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">vertex</span><span class="o">.</span><span class="n">discovered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
    <span class="n">vertex</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">GRAY</span>
    <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">adjacent</span><span class="p">[</span><span class="n">vertex</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">neighbor</span><span class="o">.</span><span class="n">color</span> <span class="ow">is</span> <span class="n">graph</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">WHITE</span><span class="p">:</span>
            <span class="n">neighbor</span><span class="o">.</span><span class="n">predecessor</span> <span class="o">=</span> <span class="n">vertex</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visit_adjacent</span><span class="p">(</span><span class="n">neighbor</span><span class="p">)</span>
    <span class="n">vertex</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">vertex</span><span class="o">.</span><span class="n">finished</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org05a1a82">
<h2 id="org05a1a82">Testing It</h2>
<div class="outline-text-2" id="text-org05a1a82">
<div class="highlight">
<pre><span></span><span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">be</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
<span class="c1"># software under test</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.graphs</span> <span class="kn">import</span> <span class="n">graph</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.graphs.depth_first_search</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">DepthFirstSearch</span><span class="p">,</span>
    <span class="n">DFSVertex</span><span class="p">,</span>
    <span class="n">DirectedGraph</span>
<span class="p">)</span>

<span class="n">graph_1</span> <span class="o">=</span> <span class="n">DirectedGraph</span><span class="p">()</span>
<span class="n">node_u</span> <span class="o">=</span> <span class="n">DFSVertex</span><span class="p">(</span><span class="n">identifier</span><span class="o">=</span><span class="s2">"u"</span><span class="p">)</span>
<span class="n">node_v</span> <span class="o">=</span> <span class="n">DFSVertex</span><span class="p">(</span><span class="n">identifier</span><span class="o">=</span><span class="s2">"v"</span><span class="p">)</span>
<span class="n">node_w</span> <span class="o">=</span> <span class="n">DFSVertex</span><span class="p">(</span><span class="n">identifier</span><span class="o">=</span><span class="s2">"w"</span><span class="p">)</span>
<span class="n">node_x</span> <span class="o">=</span> <span class="n">DFSVertex</span><span class="p">(</span><span class="n">identifier</span><span class="o">=</span><span class="s2">"x"</span><span class="p">)</span>
<span class="n">node_y</span> <span class="o">=</span> <span class="n">DFSVertex</span><span class="p">(</span><span class="n">identifier</span><span class="o">=</span><span class="s2">"y"</span><span class="p">)</span>
<span class="n">node_z</span> <span class="o">=</span> <span class="n">DFSVertex</span><span class="p">(</span><span class="n">identifier</span><span class="o">=</span><span class="s2">"z"</span><span class="p">)</span>

<span class="n">graph_1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node_u</span><span class="p">,</span> <span class="n">node_v</span><span class="p">)</span>
<span class="n">graph_1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node_u</span><span class="p">,</span> <span class="n">node_x</span><span class="p">)</span>
<span class="n">graph_1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node_x</span><span class="p">,</span> <span class="n">node_v</span><span class="p">)</span>
<span class="n">graph_1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node_v</span><span class="p">,</span> <span class="n">node_y</span><span class="p">)</span>
<span class="n">graph_1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node_y</span><span class="p">,</span> <span class="n">node_x</span><span class="p">)</span>
<span class="n">graph_1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node_w</span><span class="p">,</span> <span class="n">node_y</span><span class="p">)</span>
<span class="n">graph_1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node_w</span><span class="p">,</span> <span class="n">node_z</span><span class="p">)</span>
<span class="n">graph_1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node_z</span><span class="p">,</span> <span class="n">node_z</span><span class="p">)</span>

<span class="n">searcher</span> <span class="o">=</span> <span class="n">DepthFirstSearch</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">graph_1</span><span class="p">)</span>
<span class="n">searcher</span><span class="p">()</span>
<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">graph_1</span><span class="o">.</span><span class="n">vertices</span><span class="p">:</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">node_u</span><span class="o">.</span><span class="n">discovered</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node_u</span><span class="o">.</span><span class="n">finished</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">node_v</span><span class="o">.</span><span class="n">discovered</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node_v</span><span class="o">.</span><span class="n">finished</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">node_w</span><span class="o">.</span><span class="n">discovered</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">9</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node_w</span><span class="o">.</span><span class="n">finished</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">12</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">node_x</span><span class="o">.</span><span class="n">discovered</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node_x</span><span class="o">.</span><span class="n">finished</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">node_y</span><span class="o">.</span><span class="n">discovered</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node_y</span><span class="o">.</span><span class="n">finished</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">node_z</span><span class="o">.</span><span class="n">discovered</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node_z</span><span class="o">.</span><span class="n">finished</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">11</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">node_u</span><span class="o">.</span><span class="n">predecessor</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node_v</span><span class="o">.</span><span class="n">predecessor</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">node_u</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node_y</span><span class="o">.</span><span class="n">predecessor</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">node_v</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node_x</span><span class="o">.</span><span class="n">predecessor</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">node_y</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">node_z</span><span class="o">.</span><span class="n">predecessor</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">node_w</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">node_w</span><span class="o">.</span><span class="n">predecessor</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</article>
<article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article">
<header>
<h1 class="p-name entry-title"><a class="u-url" href="posts/graphs-breadth-first-search/index.html">Graphs: Breadth-First-Search</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">The Cloistered Monkey</span></p>
<p class="dateline"><a href="posts/graphs-breadth-first-search/index.html" rel="bookmark"><time class="published dt-published" datetime="2022-04-09T16:16:51-07:00" itemprop="datePublished" title="2022-04-09 16:16">2022-04-09 16:16</time></a></p>
</div>
</header>
<div class="e-content entry-content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="posts/graphs-breadth-first-search/index.html#orgdb0b4b9">Breadth First Search</a>
<ul>
<li><a href="posts/graphs-breadth-first-search/index.html#org7df795d">Imports</a></li>
<li><a href="posts/graphs-breadth-first-search/index.html#orgacfe289">Constants</a></li>
<li><a href="posts/graphs-breadth-first-search/index.html#orgda74f87">The Class</a>
<ul>
<li><a href="posts/graphs-breadth-first-search/index.html#org4193730">The Call</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="posts/graphs-breadth-first-search/index.html#org06bbaf6">Testing</a>
<ul>
<li>
<ul>
<li><a href="posts/graphs-breadth-first-search/index.html#org90a7c44">CLRS Example</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="outline-2" id="outline-container-orgdb0b4b9">
<h2 id="orgdb0b4b9">Breadth First Search</h2>
<div class="outline-text-2" id="text-orgdb0b4b9"></div>
<div class="outline-3" id="outline-container-org7df795d">
<h3 id="org7df795d">Imports</h3>
<div class="outline-text-3" id="text-org7df795d">
<div class="highlight">
<pre><span></span><span class="c1"># python</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">from</span> <span class="nn">queue</span> <span class="kn">import</span> <span class="n">Queue</span>

<span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">attrs</span> <span class="kn">import</span> <span class="n">define</span>

<span class="c1"># this project</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.graphs.graph</span> <span class="kn">import</span> <span class="n">Graph</span><span class="p">,</span> <span class="n">Vertex</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.graphs</span> <span class="kn">import</span> <span class="n">graph</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgacfe289">
<h3 id="orgacfe289">Constants</h3>
<div class="outline-text-3" id="text-orgacfe289">
<div class="highlight">
<pre><span></span><span class="n">INFINITY</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">"inf"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="outline-3" id="outline-container-orgda74f87">
<h3 id="orgda74f87">The Class</h3>
<div class="outline-text-3" id="text-orgda74f87">
<div class="highlight">
<pre><span></span><span class="nd">@define</span>
<span class="k">class</span> <span class="nc">BreadthFirstSearch</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Creates a shortest-path tree from a source node to all reachable nodes</span>

<span class="sd">    Note:</span>
<span class="sd">     The vertices should be BFSVertex instances</span>

<span class="sd">    Args:</span>
<span class="sd">     graph: the graph with the adjacency dict for all the vertices</span>
<span class="sd">    """</span>
    <span class="n">graph</span><span class="p">:</span> <span class="n">Graph</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-org4193730">
<h4 id="org4193730">The Call</h4>
<div class="outline-text-4" id="text-org4193730">
<div class="highlight">
<pre><span></span><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">BFSVertex</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Does the breadth first search to create the shortest paths tree"""</span>
    <span class="c1"># reset all the search attributes</span>
    <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">adjacent</span><span class="p">)</span> <span class="o">-</span> <span class="p">{</span><span class="n">source</span><span class="p">}:</span>
        <span class="n">vertex</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="n">vertex</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span> <span class="n">vertex</span><span class="o">.</span><span class="n">predecessor</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">WHITE</span><span class="p">,</span> <span class="n">INFINITY</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">source</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="n">source</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span> <span class="n">source</span><span class="o">.</span><span class="n">predecessor</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">GRAY</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span>
    <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>

    <span class="k">while</span> <span class="ow">not</span> <span class="n">queue</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
        <span class="n">predecessor</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">adjacent</span><span class="p">[</span><span class="n">predecessor</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">vertex</span><span class="o">.</span><span class="n">color</span> <span class="ow">is</span> <span class="n">graph</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">WHITE</span><span class="p">:</span>
                <span class="n">vertex</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="n">vertex</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span> <span class="n">vertex</span><span class="o">.</span><span class="n">predecessor</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">graph</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">GRAY</span><span class="p">,</span> <span class="n">predecessor</span><span class="o">.</span><span class="n">distance</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">predecessor</span><span class="p">)</span>
                <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">vertex</span><span class="p">)</span>
        <span class="n">predecessor</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="outline-2" id="outline-container-org06bbaf6">
<h2 id="org06bbaf6">Testing</h2>
<div class="outline-text-2" id="text-org06bbaf6">
<div class="highlight">
<pre><span></span><span class="c1"># pypi</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">expects</span> <span class="kn">import</span> <span class="n">be</span><span class="p">,</span> <span class="n">be_none</span><span class="p">,</span> <span class="n">equal</span><span class="p">,</span> <span class="n">expect</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">networkx</span>

<span class="c1"># software under test</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.graphs</span> <span class="kn">import</span> <span class="n">graph</span>
<span class="kn">from</span> <span class="nn">bowling.data_structures.graphs.breadth_first_search</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">BreadthFirstSearch</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">bowling.data_structures.graphs.breadth_first_search</span> <span class="k">as</span> <span class="nn">bfs</span>

<span class="n">test</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
<span class="n">source</span> <span class="o">=</span> <span class="n">BFSVertex</span><span class="p">(</span><span class="n">identifier</span><span class="o">=</span><span class="s2">"s"</span><span class="p">)</span>
<span class="n">v1</span> <span class="o">=</span> <span class="n">BFSVertex</span><span class="p">(</span><span class="n">identifier</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">v2</span> <span class="o">=</span> <span class="n">BFSVertex</span><span class="p">(</span><span class="n">identifier</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">v3</span> <span class="o">=</span> <span class="n">BFSVertex</span><span class="p">(</span><span class="n">identifier</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">test</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>
<span class="n">test</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
<span class="n">test</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>

<span class="n">search</span> <span class="o">=</span> <span class="n">BreadthFirstSearch</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
<span class="n">search</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>

<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">):</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">color</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">predecessor</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be_none</span><span class="p">)</span>
<span class="n">expect</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">distance</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">equal</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">v3</span><span class="o">.</span><span class="n">predecessor</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">v3</span><span class="o">.</span><span class="n">distance</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">v2</span><span class="o">.</span><span class="n">predecessor</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">v2</span><span class="o">.</span><span class="n">distance</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

<span class="n">expect</span><span class="p">(</span><span class="n">v1</span><span class="o">.</span><span class="n">predecessor</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="n">v2</span><span class="p">))</span>
<span class="n">expect</span><span class="p">(</span><span class="n">v1</span><span class="o">.</span><span class="n">distance</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">be</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
<div class="outline-4" id="outline-container-org90a7c44">
<h4 id="org90a7c44">CLRS Example</h4>
<div class="outline-text-4" id="text-org90a7c44">
<p>We'll start with the same Graph from the previous example and add more nodes.</p>
<div class="highlight">
<pre><span></span><span class="n">v4</span> <span class="o">=</span> <span class="n">BFSVertex</span><span class="p">(</span><span class="n">identifier</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">v5</span> <span class="o">=</span> <span class="n">BFSVertex</span><span class="p">(</span><span class="n">identifier</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">v6</span> <span class="o">=</span> <span class="n">BFSVertex</span><span class="p">(</span><span class="n">identifier</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">v7</span> <span class="o">=</span> <span class="n">BFSVertex</span><span class="p">(</span><span class="n">identifier</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

<span class="n">test</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span> <span class="n">v4</span><span class="p">)</span>
<span class="n">test</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span> <span class="n">v5</span><span class="p">)</span>
<span class="n">test</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">v4</span><span class="p">,</span> <span class="n">v5</span><span class="p">)</span>
<span class="n">test</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">v4</span><span class="p">,</span> <span class="n">v6</span><span class="p">)</span>
<span class="n">test</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">v5</span><span class="p">,</span> <span class="n">v6</span><span class="p">)</span>
<span class="n">test</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">v5</span><span class="p">,</span> <span class="n">v7</span><span class="p">)</span>
<span class="n">test</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">v6</span><span class="p">,</span> <span class="n">v7</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">plot_adjacent</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">identifier</span><span class="p">:</span> <span class="n">item</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">adjacent</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">adjacents</span> <span class="ow">in</span> <span class="n">plot_adjacent</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">plot_adjacent</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">adjacent</span><span class="o">.</span><span class="n">identifier</span> <span class="k">for</span> <span class="n">adjacent</span> <span class="ow">in</span> <span class="n">adjacents</span><span class="p">]</span>

<span class="n">plot_graph</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">plot_adjacent</span><span class="p">)</span>
<span class="n">pydot_graph</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">nx_pydot</span><span class="o">.</span><span class="n">to_pydot</span><span class="p">(</span><span class="n">plot_graph</span><span class="p">)</span>

<span class="n">SLUG</span> <span class="o">=</span> <span class="s2">"graphs-breadth-first-search"</span>
<span class="n">PATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">"files/posts/</span><span class="si">{</span><span class="n">SLUG</span><span class="si">}</span><span class="s2">/"</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">PATH</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
    <span class="n">PATH</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>

<span class="n">pydot_graph</span><span class="o">.</span><span class="n">write_png</span><span class="p">(</span><span class="n">PATH</span><span class="o">/</span><span class="s2">"clrs_example.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/graphs-breadth-first-search/clrs_example.png"></p>
<div class="highlight">
<pre><span></span><span class="n">search</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
</pre></div>
<div class="highlight">
<pre><span></span><span class="n">nodes</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">adjacent</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">predecessor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>        
        <span class="n">nodes</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">identifier</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">predecessor</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span>
<span class="n">pydot_graph</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">nx_pydot</span><span class="o">.</span><span class="n">to_pydot</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
<span class="n">pydot_graph</span><span class="o">.</span><span class="n">write_png</span><span class="p">(</span><span class="n">PATH</span><span class="o">/</span><span class="s2">"clrs_example_searched.png"</span><span class="p">)</span>
</pre></div>
<p><img alt="nil" src="posts/graphs-breadth-first-search/clrs_example_searched.png"></p>
</div>
</div>
</div>
</div>
</article>
</div>
<ul class="pager postindexpager clearfix">
<li class="previous"><a href="index-7.html" rel="prev">Newer posts</a></li>
<li class="next"><a href="index-5.html" rel="next">Older posts</a></li>
</ul>
<script crossorigin="anonymous" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">

      MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],

            displayMath: [['$$','$$'], ['\\[','\\]']],
            processEscapes: true,
            processEnvironments: true,
        }
    });
</script><!--End of body content-->
<footer id="footer">Scribbles by <a href="mailto:cloisteredmonkey.jmark@slmail.me">The Cloistered Monkey</a> Â© 2024 - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a>
<div id="license" xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/"><span property="dct:title">Ape-Iron</span> is licensed under <a href="http://creativecommons.org/licenses/by-sa/4.0/?ref=chooser-v1" rel="license noopener noreferrer" style="display:inline-block;" target="_blank">CC BY-SA 4.0 <img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"><img src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1"></a></div>
</footer>
</div>
<script src="assets/js/all-nocdn.js"></script>
<script>

    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script></div>
</body>
</html>
