<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Bowling For Data (Posts about testing)</title><link>https://necromuralist.github.io/Bowling-For-Data/</link><description></description><atom:link href="https://necromuralist.github.io/Bowling-For-Data/categories/testing.xml" rel="self" type="application/rss+xml"></atom:link><language>en</language><copyright>Contents Â© 2024 &lt;a href="mailto:cloisteredmonkey.jmark@slmail.me"&gt;The Cloistered Monkey&lt;/a&gt; 
&lt;div id="license" xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/"&gt;&lt;span property="dct:title"&gt;Ape-Iron&lt;/span&gt; is licensed under
&lt;a href="http://creativecommons.org/licenses/by-sa/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;"&gt;CC BY-SA 4.0
&lt;img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"&gt;
&lt;img src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"&gt;
&lt;img src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1"&gt;&lt;/a&gt;&lt;/p&gt; 
</copyright><lastBuildDate>Thu, 21 Mar 2024 02:33:35 GMT</lastBuildDate><generator>Nikola (getnikola.com)</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>Testing the Altair Shortcode</title><link>https://necromuralist.github.io/Bowling-For-Data/posts/testing-the-altair-shortcode/index.html</link><dc:creator>The Cloistered Monkey</dc:creator><description>&lt;div id="table-of-contents" role="doc-toc"&gt;
&lt;h2&gt;Table of Contents&lt;/h2&gt;
&lt;div id="text-table-of-contents" role="doc-toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Bowling-For-Data/posts/testing-the-altair-shortcode/index.html#org6644e31"&gt;Introduction&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Bowling-For-Data/posts/testing-the-altair-shortcode/index.html#org5a88597"&gt;Setup&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Bowling-For-Data/posts/testing-the-altair-shortcode/index.html#org9a02ffc"&gt;Imports&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Bowling-For-Data/posts/testing-the-altair-shortcode/index.html#org6f66d3c"&gt;The Output Path&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Bowling-For-Data/posts/testing-the-altair-shortcode/index.html#org91e8f59"&gt;Constants&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Bowling-For-Data/posts/testing-the-altair-shortcode/index.html#orgecfc18d"&gt;The Data&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Bowling-For-Data/posts/testing-the-altair-shortcode/index.html#orgbd29a50"&gt;Counting the Years&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Bowling-For-Data/posts/testing-the-altair-shortcode/index.html#orgd5a86d3"&gt;A Table To Show the Counts&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Bowling-For-Data/posts/testing-the-altair-shortcode/index.html#orgf94dc83"&gt;Now the Bar-Chart&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Bowling-For-Data/posts/testing-the-altair-shortcode/index.html#org665fb0f"&gt;And a Line Plot&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Bowling-For-Data/posts/testing-the-altair-shortcode/index.html#org4851192"&gt;The End&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://necromuralist.github.io/Bowling-For-Data/posts/testing-the-altair-shortcode/index.html#org816f8f0"&gt;Links&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="notecard" id="orgddb3b85"&gt;
&lt;p&gt;
&lt;b&gt;&lt;b&gt;Note:&lt;/b&gt;&lt;/b&gt; This is an example to myself of a post that uses my nikola/altair setup. It isn't something generally relevant to altair itself.
&lt;/p&gt;

&lt;/div&gt;

&lt;div id="outline-container-org6644e31" class="outline-2"&gt;
&lt;h2 id="org6644e31"&gt;Introduction&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org6644e31"&gt;
&lt;p&gt;
The way I've been using &lt;a href="https://altair-viz.github.io/index.html"&gt;altair&lt;/a&gt; is by saving the charts as HTML documents and then embedding them into the posts as pages within the page. This works, so I don't know if this is a good idea or not, but I'm going to try embedding them as HTML elements only, the way I do with p5.js. This is a check to make sure I've got the parts working so nikola will compile everything the way I'm expecting it to.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org5a88597" class="outline-2"&gt;
&lt;h2 id="org5a88597"&gt;Setup&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org5a88597"&gt;
&lt;/div&gt;
&lt;div id="outline-container-org9a02ffc" class="outline-3"&gt;
&lt;h3 id="org9a02ffc"&gt;Imports&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-org9a02ffc"&gt;
&lt;p&gt;
These initial imports are for the plotting and not really what this post is testing.
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# python&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;pathlib&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Path&lt;/span&gt;

&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;os&lt;/span&gt;

&lt;span class="c1"&gt;# pypi&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;dotenv&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;load_dotenv&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;expects&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;be_true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;expect&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;tabulate&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;tabulate&lt;/span&gt;

&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;altair&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;pandas&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;
Next is the function I'm testing - a new function I created in &lt;code&gt;graeae&lt;/code&gt;, called &lt;code&gt;save_vega_embed&lt;/code&gt;. Which maybe isn't the best name but it shouldn't clash with my other functions, hopefully. Its purpose is to create the JavaScript function that Altair's &lt;code&gt;Chart.save&lt;/code&gt; was creating for me in the earlier posts and then save it where nikola can find it.
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;graeae.visualization.altair_helpers&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;output_path&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;save_vega_embed&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;div class="notecard" id="orgf94524f"&gt;
&lt;p&gt;
&lt;b&gt;&lt;b&gt;Note to self:&lt;/b&gt;&lt;/b&gt; Since I usually run the code to create the plot on a different machine from the one where the nikola code is being run to create this site, the &lt;code&gt;graeae&lt;/code&gt; function has to be installed on the remote machine where the plots are created, then the file(s) created need to be synced back to the nikola machine to compile the site.
&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org6f66d3c" class="outline-3"&gt;
&lt;h3 id="org6f66d3c"&gt;The Output Path&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-org6f66d3c"&gt;
&lt;p&gt;
The &lt;code&gt;output_path&lt;/code&gt; function takes the slug and checks if there's a folder matching it in the &lt;code&gt;files/posts&lt;/code&gt; folder and creates it if it doesn't exist. Its output is a Path to that folder which we can use to tell the code where to save files for the chart.
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;SLUG&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"testing-the-altair-shortcode"&lt;/span&gt;
&lt;span class="n"&gt;OUTPUT_PATH&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;output_path&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;SLUG&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;OUTPUT_PATH&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;is_dir&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;be_true&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org91e8f59" class="outline-3"&gt;
&lt;h3 id="org91e8f59"&gt;Constants&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-org91e8f59"&gt;
&lt;p&gt;
These are some constants so I don't have to remember them later on.
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Chart&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;year&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"year"&lt;/span&gt;
    &lt;span class="n"&gt;height&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;600&lt;/span&gt;
    &lt;span class="n"&gt;width&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"container"&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;div class="notecard" id="org8b0b88d"&gt;
&lt;p&gt;
&lt;b&gt;&lt;b&gt;Note:&lt;/b&gt;&lt;/b&gt; The &lt;code&gt;width = "container"&lt;/code&gt; attribute will tell the chart to use the entire width of the container that the chart is in. In this case it's being put into a &lt;code&gt;&amp;lt;div&amp;gt;&lt;/code&gt; tag. To make the div fill the column the CSS is giving its HTML class (&lt;code&gt;altair-vega&lt;/code&gt;) a width of 100%. By default the chart will sit flush left but this way it's centered (and big).  I'll have to figure out some other solution to get smaller charts centered.
&lt;/p&gt;

&lt;p&gt;
See the &lt;a href="https://vega.github.io/vega-lite/docs/size.html#specifying-responsive-width-and-height"&gt;vega-lite "Responsive Width and Height"&lt;/a&gt; documentation
&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-orgecfc18d" class="outline-2"&gt;
&lt;h2 id="orgecfc18d"&gt;The Data&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-orgecfc18d"&gt;
&lt;p&gt;
To have something to plot I'll use the United Nation's World Happiness data, which I downloaded (as excel spreadsheets) and converted to a CSV.
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;load_dotenv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;override&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="kc"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;table_path&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Path&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getenv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"WORLD_HAPPINESS_TABLE"&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

&lt;span class="n"&gt;expect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;table_path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;is_file&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;to&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;be_true&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;table&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;pandas&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read_csv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;table_path&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;table&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shape&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;pre class="example"&gt;
(2199, 11)
&lt;/pre&gt;


&lt;p&gt;
This is overkill, but I had the idea to do this while in the middle of another post that uses this dataset so it was convenient to cut-and-paste the block here.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-orgbd29a50" class="outline-2"&gt;
&lt;h2 id="orgbd29a50"&gt;Counting the Years&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-orgbd29a50"&gt;
&lt;p&gt;
The test-plot will be a bar-graph showing the number of entries (countries) for each year in the dataset. The data uses "year" as the name of the column with the years so I'll make a little name holder and then create a data-frame with the counts.
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;year_counts&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;table&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;year&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;value_counts&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
               &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;reset_index&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
               &lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sort_values&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Chart&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;year&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;
The &lt;code&gt;value_counts&lt;/code&gt; output has the years as the index of the Series so I'm calling &lt;code&gt;reset_index&lt;/code&gt; to move it into a column, giving us a two-column data-frame (with "year" and "counts" as columns).
&lt;/p&gt;
&lt;/div&gt;

&lt;div id="outline-container-orgd5a86d3" class="outline-3"&gt;
&lt;h3 id="orgd5a86d3"&gt;A Table To Show the Counts&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-orgd5a86d3"&gt;
&lt;p&gt;
This is to show the values that we're going to plot.
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;table_counts&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;year_counts&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;T&lt;/span&gt;

&lt;span class="n"&gt;table_counts&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;columns&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;table_counts&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;iloc&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;table_counts&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;table_counts&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;drop&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;table_counts&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tabulate&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;table_counts&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"keys"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;tablefmt&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"orgtbl"&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"&gt;


&lt;colgroup&gt;
&lt;col class="org-left"&gt;

&lt;col class="org-right"&gt;

&lt;col class="org-right"&gt;

&lt;col class="org-right"&gt;

&lt;col class="org-right"&gt;

&lt;col class="org-right"&gt;

&lt;col class="org-right"&gt;

&lt;col class="org-right"&gt;

&lt;col class="org-right"&gt;

&lt;col class="org-right"&gt;

&lt;col class="org-right"&gt;

&lt;col class="org-right"&gt;

&lt;col class="org-right"&gt;

&lt;col class="org-right"&gt;

&lt;col class="org-right"&gt;

&lt;col class="org-right"&gt;

&lt;col class="org-right"&gt;

&lt;col class="org-right"&gt;

&lt;col class="org-right"&gt;
&lt;/colgroup&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th scope="col" class="org-left"&gt;Â &lt;/th&gt;
&lt;th scope="col" class="org-right"&gt;2005&lt;/th&gt;
&lt;th scope="col" class="org-right"&gt;2006&lt;/th&gt;
&lt;th scope="col" class="org-right"&gt;2007&lt;/th&gt;
&lt;th scope="col" class="org-right"&gt;2008&lt;/th&gt;
&lt;th scope="col" class="org-right"&gt;2009&lt;/th&gt;
&lt;th scope="col" class="org-right"&gt;2010&lt;/th&gt;
&lt;th scope="col" class="org-right"&gt;2011&lt;/th&gt;
&lt;th scope="col" class="org-right"&gt;2012&lt;/th&gt;
&lt;th scope="col" class="org-right"&gt;2013&lt;/th&gt;
&lt;th scope="col" class="org-right"&gt;2014&lt;/th&gt;
&lt;th scope="col" class="org-right"&gt;2015&lt;/th&gt;
&lt;th scope="col" class="org-right"&gt;2016&lt;/th&gt;
&lt;th scope="col" class="org-right"&gt;2017&lt;/th&gt;
&lt;th scope="col" class="org-right"&gt;2018&lt;/th&gt;
&lt;th scope="col" class="org-right"&gt;2019&lt;/th&gt;
&lt;th scope="col" class="org-right"&gt;2020&lt;/th&gt;
&lt;th scope="col" class="org-right"&gt;2021&lt;/th&gt;
&lt;th scope="col" class="org-right"&gt;2022&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td class="org-left"&gt;count&lt;/td&gt;
&lt;td class="org-right"&gt;27&lt;/td&gt;
&lt;td class="org-right"&gt;89&lt;/td&gt;
&lt;td class="org-right"&gt;102&lt;/td&gt;
&lt;td class="org-right"&gt;110&lt;/td&gt;
&lt;td class="org-right"&gt;114&lt;/td&gt;
&lt;td class="org-right"&gt;124&lt;/td&gt;
&lt;td class="org-right"&gt;146&lt;/td&gt;
&lt;td class="org-right"&gt;141&lt;/td&gt;
&lt;td class="org-right"&gt;136&lt;/td&gt;
&lt;td class="org-right"&gt;144&lt;/td&gt;
&lt;td class="org-right"&gt;142&lt;/td&gt;
&lt;td class="org-right"&gt;141&lt;/td&gt;
&lt;td class="org-right"&gt;147&lt;/td&gt;
&lt;td class="org-right"&gt;141&lt;/td&gt;
&lt;td class="org-right"&gt;143&lt;/td&gt;
&lt;td class="org-right"&gt;116&lt;/td&gt;
&lt;td class="org-right"&gt;122&lt;/td&gt;
&lt;td class="org-right"&gt;114&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;


&lt;div id="outline-container-orgf94dc83" class="outline-3"&gt;
&lt;h3 id="orgf94dc83"&gt;Now the Bar-Chart&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-orgf94dc83"&gt;
&lt;p&gt;
So, here's the section where we get to what we're testing.
&lt;/p&gt;

&lt;p&gt;
First, we need an identifier for the HTML &lt;code&gt;div&lt;/code&gt; tag so that we can tell Vega where to stick the chart.
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;DIV_ID&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"value-counts-0d454587"&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;
Now we'll create the altair Chart.
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;value_counts_chart&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;altair&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Chart&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;year_counts&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mark_bar&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;&lt;span class="si"&gt;{}&lt;/span&gt;&lt;span class="s2"&gt;:N"&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Chart&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;year&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"count"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;properties&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;height&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;Chart&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;height&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;width&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;Chart&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;width&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;
Now to save it. Previously I was using Altair's &lt;code&gt;save&lt;/code&gt; method to save it as an HTML document and embedding the entire document within the post using an &lt;code&gt;&amp;lt;object&amp;gt;&lt;/code&gt; tag, which seems to work kind of like a frame. I think. Anyway, this version saves the chart as a JavaScript function instead (using the name we pass in for the file-name) which then gets called by &lt;a href="https://github.com/vega/vega-embed"&gt;vega-embed&lt;/a&gt; to create the chart. The &lt;code&gt;graeae.visualization.altair_helpers.save_vega_embed&lt;/code&gt; function is extracting the JSON schema from the chart (using Altair's &lt;code&gt;Chart.to_json()&lt;/code&gt;) and adding it to a JavaScript function that I copied from the file created by Altair's &lt;code&gt;Chart.save&lt;/code&gt;. The &lt;code&gt;graeae&lt;/code&gt; function prints the shortcode to tell nikola to embed the chart here and then returns a Path object pointing to the saved file.
&lt;/p&gt;

&lt;div class="notecard" id="orgc8f6258"&gt;
&lt;p&gt;
&lt;b&gt;&lt;b&gt;Note:&lt;/b&gt;&lt;/b&gt; I haven't figured out how to get &lt;code&gt;jupyter-emacs&lt;/code&gt; to dump python output without formatting it as a &lt;code&gt;#+RESULTS&lt;/code&gt; block so it will need a little clean up after the function is called. If not, the shortcode will work, but it will also create an empty box underneath it.
&lt;/p&gt;

&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;chart_path&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;save_vega_embed&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;chart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;value_counts_chart&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                             &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"value-counts-bar-chart"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                             &lt;span class="n"&gt;div_id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;DIV_ID&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                             &lt;span class="n"&gt;output_path&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;OUTPUT_PATH&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;
&lt;/p&gt;&lt;div class="altair-vega" id="value-counts-0d454587"&gt;&lt;/div&gt;

&lt;script src="https://necromuralist.github.io/Bowling-For-Data/posts/testing-the-altair-shortcode/value-counts-bar-chart.js"&gt;&lt;/script&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;chart_path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;pre class="example"&gt;
value-counts-bar-chart.js
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org665fb0f" class="outline-2"&gt;
&lt;h2 id="org665fb0f"&gt;And a Line Plot&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org665fb0f"&gt;
&lt;p&gt;
I'm going to re-plot the data as a line chart to make sure there's nothing I created that causes them to mess each other up.
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;line_chart&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;value_counts_chart&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mark_line&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;save_vega_embed&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line_chart&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"value-counts-line-chart"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                &lt;span class="n"&gt;div_id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"line-chart-0d454587"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                &lt;span class="n"&gt;output_path&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;OUTPUT_PATH&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;
&lt;/p&gt;&lt;div class="altair-vega" id="line-chart-0d454587"&gt;&lt;/div&gt;

&lt;script src="https://necromuralist.github.io/Bowling-For-Data/posts/testing-the-altair-shortcode/value-counts-line-chart.js"&gt;&lt;/script&gt;


&lt;div class="notecard" id="orgdfe140c"&gt;
&lt;p&gt;
&lt;b&gt;&lt;b&gt;Note:&lt;/b&gt;&lt;/b&gt; The &lt;code&gt;altairdiv&lt;/code&gt; shortcode sets the HTML class for the chart's div to "altair-vega" in case it needs styling later.
&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org4851192" class="outline-2"&gt;
&lt;h2 id="org4851192"&gt;The End&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org4851192"&gt;
&lt;p&gt;
Well, that seems to work. I was originally going to throw this away once things seemed to be all right, but I'll keep it as a future reference in case I forget how to use this stuff later.
&lt;/p&gt;

&lt;p&gt;
Here's the files that were updated to make this work.
&lt;/p&gt;

&lt;ul class="org-ul"&gt;
&lt;li&gt;shortcodes/altairdiv.tmpl&lt;/li&gt;
&lt;li&gt;themes/custom-jinja/templates/
&lt;ul class="org-ul"&gt;
&lt;li&gt;altair.tmpl&lt;/li&gt;
&lt;li&gt;altair_helper.tmpl&lt;/li&gt;
&lt;li&gt;index.tmpl&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;
As well as &lt;code&gt;graeae.visualization.altair_helpers.save_vega_embed&lt;/code&gt;.
&lt;/p&gt;

&lt;p&gt;
To get the post working it needs &lt;code&gt;.. template: altair.tmpl&lt;/code&gt; in the meta-data and the output of the &lt;code&gt;save_vega_embed&lt;/code&gt; function cleaned up (to get the shortcode to include the chart).
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org816f8f0" class="outline-2"&gt;
&lt;h2 id="org816f8f0"&gt;Links&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org816f8f0"&gt;
&lt;ul class="org-ul"&gt;
&lt;li&gt;Saving Altair Charts â Vega-Altair 5.2.0 documentation [Internet]. [cited 2024 Mar 16]. Available from: &lt;a href="https://altair-viz.github.io/user_guide/saving_charts.html"&gt;https://altair-viz.github.io/user_guide/saving_charts.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;vega/vega-embed [Internet]. Vega; 2024 [cited 2024 Mar 16]. Available from: &lt;a href="https://github.com/vega/vega-embed"&gt;https://github.com/vega/vega-embed&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Vega-Lite [Internet]. [cited 2024 Mar 20]. Customizing Size. Available from: &lt;a href="https://vega.github.io/vega-lite/docs/size.html"&gt;https://vega.github.io/vega-lite/docs/size.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;World Happiness Report [Internet]. 2023 [cited 2023 Dec 11]. Available from: &lt;a href="https://worldhappiness.report/"&gt;https://worldhappiness.report/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;</description><category>altair</category><category>bowling</category><category>testing</category><category>visualization</category><guid>https://necromuralist.github.io/Bowling-For-Data/posts/testing-the-altair-shortcode/index.html</guid><pubDate>Sat, 16 Mar 2024 03:25:34 GMT</pubDate></item></channel></rss>